<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/rscd-items-stuck-on-the-ground-fix/395539 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 02:16:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>RSCD: &quot;Items stuck on the ground&quot; fix - Runescape - moparisthebest.com</title>
    <meta name="description" content="This is the fix for common bug in rscd, altough, I assume that the problem is in serverside, while I did the temporary fix clientside. 

Also it could be that reines messed up with the client, I just assume its serversid&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="395539.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;RSCD: &quot;Items stuck on the ground&quot; fix&#39;" href="395539.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/rscd-items-stuck-on-the-ground-fix/395539" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/rscd-items-stuck-on-the-ground-fix/395539" />
<meta property="og:title" content="RSCD: &quot;Items stuck on the ground&quot; fix" />
<meta name="twitter:title" content="RSCD: &quot;Items stuck on the ground&quot; fix" />
<meta property="og:description" content="This is the fix for common bug in rscd, altough, I assume that the problem is in serverside, while I did the temporary fix clientside.  Also it could be that reines messed up with the client, I just assume its serverside.  Search for for (int j3 = 0; j3 &lt; groundItemCount; j3++) { in loadSection.  Replace the loop with this:  	for (int j3 = 0; j3 &lt; groundItemCount; j3++) { 		if(!withinRange(groundItemX[j3], groundItemY[j3])) { 			groundItemType[j3] = -1; 			groundItemObjectVar[j3] = -1; 			ground..." />
<meta name="twitter:description" content="This is the fix for common bug in rscd, altough, I assume that the problem is in serverside, while I did the temporary fix clientside.  Also it could be that reines messed up with the client, I just assume its serverside.  Search for for (int j3 = 0; j3 &lt; groundItemCount; j3++) { in loadSection.  Replace the loop with this:  	for (int j3 = 0; j3 &lt; groundItemCount; j3++) { 		if(!withinRange(groundItemX[j3], groundItemY[j3])) { 			groundItemType[j3] = -1; 			groundItemObjectVar[j3] = -1; 			ground..." />
<meta property="article:published_time" content="2011-05-18T19:08:48+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="395539.html">RSCD: &quot;Items stuck on the ground&quot; fix</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-05-18T19:08:48Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:53:00Z' class='post-time'>
              August 1, 2016, 11:53am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is the fix for common bug in rscd, altough, I assume that the problem is in serverside, while I did the temporary fix clientside.</p>
<p>Also it could be that reines messed up with the client, I just assume its serverside.</p>
<p>Search for <code>for (int j3 = 0; j3 &lt; groundItemCount; j3++) {</code> in loadSection.</p>
<p>Replace the loop with this:</p>
<pre><code class="lang-auto">	for (int j3 = 0; j3 &lt; groundItemCount; j3++) {
		if(!withinRange(groundItemX[j3], groundItemY[j3])) {
			groundItemType[j3] = -1;
			groundItemObjectVar[j3] = -1;
			groundItemX[j3] = -1;
			groundItemY[j3] = -1;
		}
		groundItemX[j3] -= k1;
		groundItemY[j3] -= l1;
        }</code></pre>
<p>Add this method somewhere:</p>
<pre><code class="lang-auto">	public boolean withinRange(int x, int y) {
		int xDiff = (sectionX + areaX)- x; 
		int yDiff = (sectionY + areaY) - y;
		return xDiff &lt;= 16 &amp;&amp; xDiff &gt;= -15 &amp;&amp; yDiff &lt;= 16 &amp;&amp; yDiff &gt;= -15;
	}</code></pre>
<p>What this will do is to remove the grounditems that aren’t in range/visible.</p>
      </div>

      <meta itemprop='headline' content='RSCD: &quot;Items stuck on the ground&quot; fix'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/IlikeArrays.html'><span itemprop='name'>IlikeArrays</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-05-18T22:46:48Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:53:11Z' class='post-time'>
              August 1, 2016, 11:53am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>In order to fix it your going to need to understand the problem. From the video</p>
<p>If your walking into a different region, the region your currently in disappears?</p>
      </div>

      <meta itemprop='headline' content='RSCD: &quot;Items stuck on the ground&quot; fix'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-05-19T07:05:23Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:53:30Z' class='post-time'>
              August 1, 2016, 11:53am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>It works for the stairs problem, and this is for RSCD, since you have made the region system, it’s possible that it doesn’t work properly, also note that I only tried it on the stairs/ladders, but like Kryptix said </p><blockquote>I think you’re on the right approach kind of…</blockquote>
<p>When entering the new region, you should send the watchedItems again, see the method updateViewedItems() and revalidateViewedItems() at Player class.</p>
<p>EDIT: So did anybody else try this out? There’s a serverside fix coming soon; The real problem is that server doesn’t remove the items that aren’t visible to player anymore, for example player goes downstairs then at revalidate method, it removes the item from watchedItems but NOT from the client. Then when player goes back up it sends it again, but now client has it duplicated because the item before going down wasn’t removed.</p>
<blockquote>[b]	public ArrayList watchedItemsToRemove new ArrayList();[/b]
	public void updateViewedItems() {
		List itemsInView = viewArea.getItemsInView();
		for (Item i : itemsInView) {
			if (!watchedItems.contains(i) &amp;&amp; !i.isRemoved() &amp;&amp; withinRange(i) &amp;&amp; i.visibleTo(this)) {
				watchedItems.add(i);
			}
		}
	}
	public void revalidateWatchedItems() {
		for (Item i : watchedItems.getKnownEntities()) {
			if ([u]!withinRange(i)[/u] || i.isRemoved() || !i.visibleTo(this)) {
				watchedItems.remove(i);
				[b]watchedItemsToRemove.add(i);[/b] //This is what should be done in order to fix it, now just send it at ItemPos builder
			}
		}
	}</blockquote>
      </div>

      <meta itemprop='headline' content='RSCD: &quot;Items stuck on the ground&quot; fix'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/IlikeArrays.html'><span itemprop='name'>IlikeArrays</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-05-31T06:52:01Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:07:11Z' class='post-time'>
              August 1, 2016, 12:07pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>refactoring… gotta love it</p>
      </div>

      <meta itemprop='headline' content='RSCD: &quot;Items stuck on the ground&quot; fix'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-02T18:38:37Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:10:07Z' class='post-time'>
              August 1, 2016, 12:10pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Kryptix, post:4, topic:395542”]More investigating tonight. The server is fine, it’s purely client.</p>
<p>The server knows the items are gone and sends the packet to remove them.</p>
<p>The problem is with this code:</p>
<p><code>public void run() {
	for (int l = 1; l &lt; length;) {
		if (DataOperations.getUnsignedByte(data[l]) == 255) { // ???
			int newCount = 0;
			int newSectionX = sectionX + data[l + 1] &gt;&gt; 3;
			int newSectionY = sectionY + data[l + 2] &gt;&gt; 3;
			l += 3;
			for (int groundItem = 0; groundItem &lt; groundItemCount; groundItem++) {
				int newX = (groundItemX[groundItem] &gt;&gt; 3) - newSectionX;
				int newY = (groundItemY[groundItem] &gt;&gt; 3) - newSectionY;
				if (newX != 0 || newY != 0) {
					if (groundItem != newCount) {
						groundItemX[newCount] = groundItemX[groundItem];
						groundItemY[newCount] = groundItemY[groundItem];
						groundItemType[newCount] = groundItemType[groundItem];
						groundItemObjectVar[newCount] = groundItemObjectVar[groundItem];
					}
					newCount++;
				}
			}
				groundItemCount = newCount;
		} else {
			int i8 = DataOperations.getUnsigned2Bytes(data, l);
			l += 2;
			int k14 = sectionX + data[l++];
			int j19 = sectionY + data[l++];
			if ((i8 &amp; 0x8000) == 0) { //If we're not removing
				groundItemX[groundItemCount] = k14;
				groundItemY[groundItemCount] = j19;
				groundItemType[groundItemCount] = i8;
				groundItemObjectVar[groundItemCount] = 0;
				for (int k23 = 0; k23 &lt; objectCount; k23++) {
					if (objectX[k23] != k14 || objectY[k23] != j19)
						continue;
					groundItemObjectVar[groundItemCount] = EntityHandler.getObjectDef(objectType[k23]).getGroundItemVar();
					break;
				}
				groundItemCount++;
			} else { //Removing
				i8 &amp;= 0x7fff;
				int l23 = 0;
				for (int k26 = 0; k26 &lt; groundItemCount; k26++) {
					if (groundItemX[k26] != k14 || groundItemY[k26] != j19 || groundItemType[k26] != i8) { // Keep how it is
						if (k26 != l23) {
							groundItemX[l23] = groundItemX[k26];
							groundItemY[l23] = groundItemY[k26];
							groundItemType[l23] = groundItemType[k26];
							groundItemObjectVar[l23] = groundItemObjectVar[k26];
						}
						l23++;
					} else { // Remove
							i8 = -123;
						}
					}
					groundItemCount = l23;
				}
			}
		}		
	}
}</code>[/quote]<br>
No, its most likely sent wrong serverside.</p>
      </div>

      <meta itemprop='headline' content='RSCD: &quot;Items stuck on the ground&quot; fix'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/rscd-items-stuck-on-the-ground-fix/395539 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 02:16:52 GMT -->
</html>
