<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Useful BCEL Method (FieldScanner)</title>
    <link>https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991</link>
    <description>This little thing will help developers that need to locate a class to hook fields from. Remember to change Updater.rsClasses to the array or whatever you use to store the loaded runescape classes. Basically it scans all classfiles for a method that contains field references to all the specified VirtualFields.

VirtualField.java:
[code]public class VirtualField {
    public String fieldClass;
    public String fieldName;

    public VirtualField(String fieldClass, String fieldName) {
        this.fieldClass = fieldClass;
        this.fieldName = fieldName;
    }

}[/code]

The Method:
[code]    public static void findField(VirtualField... fields) {
        int count = fields.length;
        int found = 0;
        for(ClassGen cg : Updater.rsClasses.values()) {
            for(Method m : cg.getMethods()) {
                MethodGen mg = new MethodGen(m, m.getName(), cg.getConstantPool());
                if(mg.getInstructionList() != null) {
                    Instruction[] is = mg.getInstructionList().getInstructions();
                    for(VirtualField vf : fields) {
                        for(int i = 0; i &lt; is.length; i++) {
                            if(is[i] instanceof FieldInstruction) {
                                FieldInstruction fi = (FieldInstruction) is[i];
                                if(fi.getFieldName(cg.getConstantPool()).equals(vf.fieldName) &amp;&amp; fi.getClassName(cg.getConstantPool()).equals(vf.fieldClass)) {
                                    found++;
                                }
                            }
                        }
                    }
                    if(found == count) {
                        System.out.println(&quot;[FieldScanner] Found match in class &quot;+cg.getClassName()+&quot;, method &quot;+mg.getMethod().toString());
                    }
                    found = 0;
                }
            }
        }
    }[/code]

Enjoy :)</description>
    
    <lastBuildDate>Wed, 23 Jan 2008 23:05:42 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Useful BCEL Method (FieldScanner)</title>
        <dc:creator><![CDATA[@Ollie Ollie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ollie">@Ollie</a> wrote:</p>
          <blockquote>
              <p>this would be better:</p>
<p>[code]public class VirtualField {<br>
public String fieldClass, fieldName, fieldSignature;</p>
<pre><code>public VirtualField(String fieldClass, String fieldName. String fieldSignature) {
    this.fieldClass = fieldClass;
    this.fieldName = fieldName;
    this.fieldSignature = fieldSignature;
}
</code></pre>
<p>}[/code]</p>
<p><code>
public static void findField(VirtualField... fields) {
        int index = 0;
        for(ClassGen cg : Updater.rsClasses.values()) {
            for(VirtualField field : fields) 
            	if((index = cg.getConstantPool().lookupFieldref(field.fieldClass, field.fieldName, field.fieldSignature) &gt; 0) {
            	    for(Method method : cg.getMethods()) {
            		Instruction[] instructions = new MethodGen(m, m.getName(), cg.getConstantPool()).getInstructionList().getInstructions();
            		for(Instruction instruction : instructions) {
            		    if((instruction instanceof CPInstruction) &amp;&amp; ((CPInstruction) instruction).getIndex() == index) {
            		    	System.out.println(field + " found in " + cg.getClassName() + "." + method + ", at " + instruction.getIndex());
            		    }
            		}	
            	    }
            	}
        }
    }</code></p>
<p>or something similar</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/3</link>
        <pubDate>Wed, 23 Jan 2008 23:05:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-174991-3</guid>
        <source url="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991.rss">Useful BCEL Method (FieldScanner)</source>
      </item>
      <item>
        <title>Useful BCEL Method (FieldScanner)</title>
        <dc:creator><![CDATA[@speedster239 speedster239]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/speedster239">@speedster239</a> wrote:</p>
          <blockquote>
              <p>&lt;3, thank you Speljohan.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/2</link>
        <pubDate>Mon, 21 Jan 2008 21:55:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-174991-2</guid>
        <source url="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991.rss">Useful BCEL Method (FieldScanner)</source>
      </item>
      <item>
        <title>Useful BCEL Method (FieldScanner)</title>
        <dc:creator><![CDATA[@Speljohan Speljohan]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/speljohan">@Speljohan</a> wrote:</p>
          <blockquote>
              <p>This little thing will help developers that need to locate a class to hook fields from. Remember to change Updater.rsClasses to the array or whatever you use to store the loaded runescape classes. Basically it scans all classfiles for a method that contains field references to all the specified VirtualFields.</p>
<p>VirtualField.java:</p>
<p>[code]public class VirtualField {<br>
public String fieldClass;<br>
public String fieldName;</p>
<pre><code>public VirtualField(String fieldClass, String fieldName) {
    this.fieldClass = fieldClass;
    this.fieldName = fieldName;
}
</code></pre>
<p>}[/code]</p>
<p>The Method:</p>
<p><code>    public static void findField(VirtualField... fields) {
        int count = fields.length;
        int found = 0;
        for(ClassGen cg : Updater.rsClasses.values()) {
            for(Method m : cg.getMethods()) {
                MethodGen mg = new MethodGen(m, m.getName(), cg.getConstantPool());
                if(mg.getInstructionList() != null) {
                    Instruction[] is = mg.getInstructionList().getInstructions();
                    for(VirtualField vf : fields) {
                        for(int i = 0; i &lt; is.length; i++) {
                            if(is[i] instanceof FieldInstruction) {
                                FieldInstruction fi = (FieldInstruction) is[i];
                                if(fi.getFieldName(cg.getConstantPool()).equals(vf.fieldName) &amp;&amp; fi.getClassName(cg.getConstantPool()).equals(vf.fieldClass)) {
                                    found++;
                                }
                            }
                        }
                    }
                    if(found == count) {
                        System.out.println("[FieldScanner] Found match in class "+cg.getClassName()+", method "+mg.getMethod().toString());
                    }
                    found = 0;
                }
            }
        }
    }</code></p>
<p>Enjoy <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991/1</link>
        <pubDate>Mon, 21 Jan 2008 12:03:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-174991-1</guid>
        <source url="https://forum.moparisthebest.com/t/useful-bcel-method-fieldscanner/174991.rss">Useful BCEL Method (FieldScanner)</source>
      </item>
  </channel>
</rss>
