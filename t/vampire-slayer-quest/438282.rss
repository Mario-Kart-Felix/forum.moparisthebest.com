<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Vampire Slayer quest</title>
    <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282</link>
    <description>Well this is the Vampire Slayer quest, feel free to use it. Also i need suggestions on how to do the quest ending on the same quest file and not on FigthEvent.  :o

[IMG]http://img62.imageshack.us/img62/2821/vs3c.png[/img]

[IMG]http://img193.imageshack.us/img193/4225/vs4o.png[/img]

VampireSlayer.java
[code]package org.darkquest.gs.plugins.quests;

import org.darkquest.gs.event.FightEvent;
import org.darkquest.gs.event.SingleEvent;
import org.darkquest.gs.external.EntityHandler;
import org.darkquest.gs.model.ChatMessage;
import org.darkquest.gs.model.GameObject;
import org.darkquest.gs.model.InvItem;
import org.darkquest.gs.model.MenuHandler;
import org.darkquest.gs.model.Mob;
import org.darkquest.gs.model.Npc;
import org.darkquest.gs.model.Player;
import org.darkquest.gs.model.World;
import org.darkquest.gs.plugins.Quest;
import org.darkquest.gs.plugins.listeners.action.ObjectActionListener;
import org.darkquest.gs.plugins.listeners.action.TalkToNpcListener;
import org.darkquest.gs.plugins.listeners.executive.ObjectActionExecutiveListener;
import org.darkquest.gs.plugins.listeners.executive.TalkToNpcExecutiveListener;
import org.darkquest.gs.states.Action;
import org.darkquest.gs.states.CombatState;

public class VampireSlayer extends Quest implements TalkToNpcListener, TalkToNpcExecutiveListener,
				ObjectActionListener, ObjectActionExecutiveListener {

	@Override
	public int getQuestId() {
		return 3;
	}

	@Override
	public String getQuestName() {
		return &quot;Vampire Slayer&quot;;
	}
	
	@Override
	public void onTalkToNpc(Player p, final Npc n) {
		// Morgan
		if(n.getID() == 97) {
			// quest start
			if(p.getQuestStage(this) == 0) {
				n.setBusy(true);
				p.setBusy(true);
				System.out.println(&quot;Quest stage: &quot; + 0);
				p.informOfNpcMessage(new ChatMessage(n, &quot;Please please, help us bold hero&quot;, p));
				sleep();
				p.informOfChatMessage(new ChatMessage(p, &quot;What is the problem?&quot;, n));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n,	&quot;Our little village has been dreadfully ravaged by an evil vampire&quot;, p));
				sleep(2400);
				p.informOfNpcMessage(new ChatMessage(n, &quot;There&#39;s is hardly any of us left&quot;, p));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n,	&quot;We need someone to get rid of him once and for good&quot;, p));
				sleep(2400);
				p.getActionSender().sendMessage(&quot;Would you like to start the &quot; + this.getQuestName() + &quot; quest?&quot;);
				String[] options = new String[] { &quot;Yes&quot;, &quot;No&quot; };
			    	p.setMenuHandler(new MenuHandler(options) {
				    	public void handleReply(final int option, final String reply) {
				    		switch (option) {
					            case 0: // Yes
							n.setBusy(true);
							owner.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;OK, I&#39;m up for an adventure&quot;, n));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;I think first you should seek help&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;I&#39;ve a friend who is a retired vampire hunter&quot;, owner));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;called Dr Harlow&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;He may be able to give you some advice&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;he can normally be found in the jolly boar inn these days&quot;, owner));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;He&#39;s a bit of an old soak&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;mention his old friend Morgan&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;I&#39;m sure he wouldn&#39;t want me to be killed by a vampire&quot;, owner));
							sleep(2400);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;I&#39;ll look him up then&quot;, n));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Thank you&quot;, owner));
							sleep();
							owner.setQuestStage(getQuestId(), 1);
							owner.setBusy(false);
							n.setBusy(false);
							break;
						    case 1: // No
							n.setBusy(true);
							owner.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;No. Vampires are scary&quot;, n));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Oh please..&quot;, owner));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
						    default:
							owner.setBusy(false);
							n.setBusy(false);
							return;
						}
					}
				});							
			    	p.getActionSender().sendMenu(options);
				n.setBusy(false);
				p.setBusy(false);
			}
			// quest is finished
			else if (p.getQuestStage(this) == -1) {
				p.setBusy(true);
				n.blockedBy(p);
				p.informOfNpcMessage(new ChatMessage(n, &quot;How are you doing with your quest?&quot;, p));
				sleep();
				p.informOfChatMessage(new ChatMessage(p, &quot;I have slain the foul creature&quot;, n));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n, &quot;Thank you, Thank you&quot;, p));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n, &quot;You will always be a hero in our village&quot;, p));
				sleep();
				p.setBusy(false);
				n.unblock();

			}
			else {
				p.setBusy(true);
				n.blockedBy(p);
				p.informOfNpcMessage(new ChatMessage(n, &quot;How are you doing with your quest?&quot;, p));
				sleep();
				p.informOfChatMessage(new ChatMessage(p, &quot;I&#39;m working on it still&quot;, n));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n, &quot;Please hurry&quot;, p));
				sleep(1800);
				p.informOfNpcMessage(new ChatMessage(n, &quot;Every day we live in fear of our lives&quot;, p));
				sleep();
				p.informOfNpcMessage(new ChatMessage(n, &quot;Afraid that we will be the vampire&#39;s next victim&quot;, p));
				sleep(2400);
				p.setBusy(false);
				n.unblock();
			}
		}
		// dr Harlow
		else if(n.getID() == 98) {
			if(p.getQuestStage(this) == 1) {
				p.setBusy(true);
				n.setBusy(true);
				p.informOfNpcMessage(new ChatMessage(n, &quot;Buy me a drrink pleassh&quot;, p));
				sleep();
				String[] options = new String[] { &quot;No you&#39;ve had enough&quot;, &quot;Morgan needs Your help!&quot; };
				p.setMenuHandler(new MenuHandler(options) {
					public void handleReply(final int option, final String reply) {
						switch (option) {
						    case 0:
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;No you&#39;ve had enough&quot;, n));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							break;
						    case 1:
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;Morgan needs your help&quot;, n));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Morgan you shhay?&quot;, owner));
							sleep();
							owner.informOfChatMessage(new ChatMessage(owner,
									&quot;His village is being terrorised by a vampire&quot;, n));
							sleep();
							owner.informOfChatMessage(new ChatMessage(owner,
									&quot;He wanted me to ask you how should I go about stoping it&quot;, n));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;Buy me a beer then I will teashh you what you need to know&quot;, owner));
							sleep(2400);
							owner.informOfChatMessage(new ChatMessage(owner,
									&quot;But this is your friend Morgan we&#39;re talking about!&quot;, n));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;if you wan&#39;t me to teashh you buy me a beer&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;...OK mate&quot;, owner));
							sleep();
							owner.setQuestStage(getQuestId(), 2);
							owner.setBusy(false);
							n.setBusy(false);
							break;
						    default:
							owner.setBusy(false);
							n.setBusy(false);
							return;
						}
					}
				});
				p.getActionSender().sendMenu(options);
				p.setBusy(false);
				n.setBusy(false);
			} 
			else if(p.getQuestStage(this) == 2) {
				p.setBusy(true);
				n.setBusy(true);
				p.informOfNpcMessage(new ChatMessage(n, &quot;Buy me a drrink pleassh&quot;, p));
				sleep();
				p.informOfChatMessage(new ChatMessage(p, &quot;...&quot;, n));
				sleep();
				String[] options = new String[] { &quot;No you&#39;ve had enough&quot;, &quot;Ok mate&quot; };
				p.setMenuHandler(new MenuHandler(options) {
					public void handleReply(final int option, final String reply) {
						switch (option) {
						    case 0:
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;No you&#39;ve had enough&quot;, n));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							break;
						    case 1:
							// if there is beer on inventory
							if (owner.getInventory().hasItemId(193)) {
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;Ok mate&quot;, n));
							sleep();
							owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
							owner.getActionSender().sendInventory();
							owner.getActionSender().sendMessage(&quot;You give a beer to Dr Harlow&quot;);
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Cheersh matey!&quot;, owner));
							sleep();
							owner.informOfChatMessage(new ChatMessage(owner,
									&quot;So tell me how to kill vampires then&quot;, n));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, 
									&quot;Yesh yesh, I was very good at killing em once&quot;, owner));
							sleep();
							owner.getActionSender().sendMessage(&quot;Dr Harlow appears to sober up slightly&quot;);
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;Well you&#39;re gonna kill it with a stake&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;otherwishe he&#39;ll just regenerate&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;yes your killing blow must be done with the stake&quot;, owner));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;I just happen to have one on me&quot;, owner));
							sleep();
							owner.getActionSender().sendMessage(&quot;Dr Harlow hands you a stake&quot;);
							owner.getInventory().add(new InvItem(217));
							owner.getActionSender().sendInventory();
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;You&#39;ll need a hammer to hand to drive it in properly as well&quot;, owner));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;One last thing&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n, &quot;It&#39;s wise to carry garlic with you&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;vampires are weakened somewath if they smell garlic&quot;, owner));
							sleep(2400);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Dunno were you find that though&quot;, owner));
							sleep();
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;remember even then vampire is a dangerous foe&quot;, owner));
							sleep();
							owner.informOfChatMessage(new ChatMessage(owner, &quot;Thank you very much&quot;, n));
							sleep();
							owner.setQuestStage(getQuestId(), 3);
							owner.setBusy(false);
							n.setBusy(false);
							}
							else {
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;I&#39;ll just go and buy one&quot;, n));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							}
							break;
						    default:
							owner.setBusy(false);
							n.setBusy(false);
							return;
						}
					}
				});							
			    	p.getActionSender().sendMenu(options);
				n.setBusy(false);
				p.setBusy(false);
			}
			else {
				p.setBusy(true);
				n.setBusy(true);
				p.informOfNpcMessage(new ChatMessage(n, &quot;Buy me a drrink pleassh&quot;, p));
				sleep();
				p.informOfChatMessage(new ChatMessage(p, &quot;...&quot;, n));
				sleep();
				String[] options = new String[] { &quot;No you&#39;ve had enough&quot;, &quot;Ok mate&quot; };
				p.setMenuHandler(new MenuHandler(options) {
					public void handleReply(final int option, final String reply) {
						switch (option) {
						    case 0:
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;No you&#39;ve had enough&quot;, n));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							break;
						    case 1:
							if (owner.getQuestStage(3) == 3 &amp;&amp; owner.getInventory().hasItemId(193) 
									&amp;&amp; !owner.getInventory().hasItemId(217)) {
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;Ok mate&quot;, n));
							sleep();
							owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
							owner.getActionSender().sendInventory();
							owner.getActionSender().sendMessage(&quot;You give a beer to Dr Harlow&quot;);
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Cheersh matey!&quot;, owner));
							sleep();
							owner.informOfChatMessage(new ChatMessage(owner,
									&quot;I lost my stake&quot;, n));
							sleep();
							owner.getActionSender().sendMessage(&quot;Dr Harlow hands you a stake&quot;);
							owner.getInventory().add(new InvItem(217));
							owner.getActionSender().sendInventory();
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n,
									&quot;There you go&quot;, owner));
							sleep(2400);
							owner.setBusy(false);
							n.setBusy(false);
							}
							else if (owner.getInventory().hasItemId(193)) {
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;Ok mate&quot;, n));
							sleep();
							owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
							owner.getActionSender().sendInventory();
							owner.getActionSender().sendMessage(&quot;You give a beer to Dr Harlow&quot;);
							sleep(1200);
							owner.informOfNpcMessage(new ChatMessage(n, &quot;Cheersh matey!&quot;, owner));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							}
							else {
							owner.setBusy(true);
							n.setBusy(true);
							sleep(600);
							owner.informOfChatMessage(new ChatMessage(owner, &quot;I&#39;ll just go and buy one&quot;, n));
							sleep();
							owner.setBusy(false);
							n.setBusy(false);
							}
							break;
						    default:
							owner.setBusy(false);
							n.setBusy(false);
							return;
						}
					}
				});
			    	p.getActionSender().sendMenu(options);
				n.setBusy(false);
				p.setBusy(false);
			}
		}
	}

	@Override
	public void onObjectAction(GameObject obj, String command, Player player) {
		if (player.getQuestStage(this) == -1 &amp;&amp; command.equals(&quot;search&quot;) &amp;&amp; obj.getID() == 136 &amp;&amp; obj.getY() == 3380) {
			player.getActionSender().sendMessage(&quot;It is empty..&quot;);
			return;
		}
		else if (command.equals(&quot;search&quot;) &amp;&amp; obj.getID() == 136 &amp;&amp; obj.getY() == 3380) {
			final Npc n = new Npc(96, 206, 3381, player.getX() - 2, player.getX() + 2, player.getY() - 5, player.getY() + 5);
			n.setRespawn(false);
			world.registerNpc(n);
			player.getActionSender().sendMessage(&quot;A vampire jumps out off the coffing!&quot;);
			if (player.getInventory().hasItemId(218)) {
				sleep(1200);
				// TODO do this properly
				player.informOfNpcMessage(new ChatMessage(n, &quot;Arrrg that ghastly smell!&quot;, player));
				n.setWeakend(true);
			}
			else {
				sleep(1200);
				player.informOfNpcMessage(new ChatMessage(n, &quot;Arrrg how dare you!&quot;, player));
			}
			sleep(600);
			if (n != null &amp;&amp; !n.inCombat()) {
				player.getActionSender().sendStats();
				fight(player, n);
				if (n.isWeakend() == true)
					player.getActionSender().sendMessage(&quot;The vampire appears to weaken!&quot;);
				World.getWorld().getDelayedEventHandler().add(new SingleEvent(null, 1200000) {
				    public void action() {
					Mob opponent = n.getOpponent();
					if (opponent != null) {
					    opponent.resetCombat(CombatState.ERROR);
					}
					n.resetCombat(CombatState.ERROR);
					world.unregisterNpc(n);
					n.remove();
				   }
				});
				//  finish quest check FightEvent
			}
			return;
		} 
	}
	private static final World world = World.getWorld();

    	private void fight(Player owner, Npc n) {
		n.resetPath();
		owner.resetPath();
		owner.resetAll();
		owner.setStatus(Action.FIGHTING_MOB);
		owner.getActionSender().sendSound(&quot;underattack&quot;);
		owner.getActionSender().sendMessage(&quot;You are under attack!&quot;);
	
		n.setLocation(owner.getLocation(), true);
		for (Player p : n.getViewArea().getPlayersInView()) {
		    p.removeWatchedNpc(n);
		}
	
		owner.setBusy(true);
		owner.setSprite(9);
		owner.setOpponent(n);
		owner.setCombatTimer();
	
		n.setBusy(true);
		n.setSprite(8);
		n.setOpponent(owner);
		n.setCombatTimer();
		n.setChasing(owner);
		FightEvent fighting = new FightEvent(owner, n, true);
		fighting.setLastRun(0);
		World.getWorld().getDelayedEventHandler().add(fighting);
    	}

	@Override
	public boolean blockTalkToNpc(Player p, Npc n) {
		if(n.getID() == 97 || n.getID() == 98) {
			return true;
		}
		return false;
	}
	
	@Override
	public boolean blockObjectAction(GameObject obj, String command, Player player) {
		if(obj.getID() == 136 &amp;&amp; command.equals(&quot;search&quot;) &amp;&amp; obj.getY() == 3380) {
			return true;
		}
		return false;
	}
}[/code]


FightEvent.java

[code]		if (newHp &lt;= 0) {
			// count Draynor
			if (opponent instanceof Npc &amp;&amp; opponent.getID() == 96) {
			Player p = (Player) attacker;
				// 217 stake and 168 hammer - TODO I think stake can break if str lvl is low ???
				if (p.getInventory().wielding(217) == true &amp;&amp; p.getInventory().hasItemId(168)) {
					p.getInventory().remove(p.getInventory().getLastIndexById(217));
					p.getActionSender().sendInventory();
					p.getActionSender().sendMessage(&quot;You hammer the stake into the vampire chest&quot;);
					opponent.killedBy(attacker, false);
					attacker.resetCombat(CombatState.WON);
					opponent.resetCombat(CombatState.LOST);
					//ends Vampire Slayer quest
					if (p.getQuestStage(3) == 3) {
						p.setQuestStage(3, -1);
						p.incExp(0, 5000, false, false, false);
					}
					this.stop();
				}
				else opponent.setHits(35);
				return;
			}
			else {
				opponent.killedBy(attacker, false);
				attacker.resetCombat(CombatState.WON);
				opponent.resetCombat(CombatState.LOST);
				this.stop();
			}
		}[/code]
Enjoy!</description>
    
    <lastBuildDate>Fri, 06 Apr 2012 11:37:38 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@Nothing1 -Nothing]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nothing1">@Nothing1</a> wrote:</p>
          <blockquote>
              <p>[quote=“Rodgerwilco, post:9, topic:438282”]Quick! Everyone laugh at the rsc noob!</p>
<p>Joke. Brings back good memories though, for some reason I remember talking with that damn guy.[/quote]<br>
Same, I bought him like 3 beers too.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/10</link>
        <pubDate>Fri, 06 Apr 2012 11:37:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-10</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>Quick! Everyone laugh at the rsc noob!</p>
<p>Joke. Brings back good memories though, for some reason I remember talking with that damn guy.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/9</link>
        <pubDate>Thu, 05 Apr 2012 23:58:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-9</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@DealingRocks DealingRocks]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dealingrocks">@DealingRocks</a> wrote:</p>
          <blockquote>
              <p>[quote=“DMXXXX, post:5, topic:438282”]“Otherwishe he’ll just regenerate”</p>
<p>You mean ‘otherwise’?</p>
<p>Surprised you didn’t fix that before you posted a screenshot &gt;_&gt;[/quote]<br>
Play the game ever? The quest NPC is drunk so talks with a lisp/slur. Do you getsh what I am shaying?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/8</link>
        <pubDate>Thu, 05 Apr 2012 20:28:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-8</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@nacional nacional]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nacional">@nacional</a> wrote:</p>
          <blockquote>
              <p>Dr. Harlow is a boss. He can say it however he wants</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/7</link>
        <pubDate>Thu, 05 Apr 2012 15:52:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-7</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@5_1 5 1]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/5_1">@5_1</a> wrote:</p>
          <blockquote>
              <p>[quote=“DMXXXX, post:5, topic:438282”]“Otherwishe he’ll just regenerate”</p>
<p>You mean ‘otherwise’?</p>
<p>Surprised you didn’t fix that before you posted a screenshot &gt;_&gt;[/quote]<br>
He aint even mad tho</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/6</link>
        <pubDate>Thu, 05 Apr 2012 14:02:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-6</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@DMXXXX DMXXXX]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dmxxxx">@DMXXXX</a> wrote:</p>
          <blockquote>
              <p>“Otherwishe he’ll just regenerate”</p>
<p>You mean ‘otherwise’?</p>
<p>Surprised you didn’t fix that before you posted a screenshot &gt;_&gt;</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/5</link>
        <pubDate>Thu, 05 Apr 2012 12:22:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-5</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@latifundio latifundio]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/latifundio">@latifundio</a> wrote:</p>
          <blockquote>
              <p>^ Woa I really missed that, thanks a lot</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/4</link>
        <pubDate>Tue, 03 Apr 2012 13:39:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-4</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <p>yeah i made a NPC death listener, its quite easy.</p>
<p>right below</p>
<pre><code class="lang-auto"></code></pre>
<p>add this</p>
<p><code>if(PluginHandler.getPluginHandler().blockDefaultAction("PlayerKilledNpc", new Object[]{owner, this})) {
   return;
}</code></p>
<p>then you will need the executor</p>
<p>[code=java]package org.darkquest.gs.plugins.listeners.executive;</p>
<p>import org.darkquest.gs.entity.mob.Npc;<br>
import org.darkquest.gs.entity.mob.Player;</p>
<p>public interface PlayerKilledNpcExecutiveListener {<br>
/**<br>
* Return true to prevent the default action on a npcs death (no loot)<br>
*/<br>
public boolean blockPlayerKilledNpc(Player p, Npc n);<br>
}[/code]</p>
<p>if this is in the original DQ, mybad i added a new executive listener, and i could have sworn this was it lol.</p>
<p>EDIT: yeah this is in darkquest already… oops!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/3</link>
        <pubDate>Tue, 03 Apr 2012 00:59:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-3</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@Kryptix Kryptix]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/kryptix">@Kryptix</a> wrote:</p>
          <blockquote>
              <p>I’m not familiar with DQ but you would need a listener for when a NPC dies. Look how the other listeners are done.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/2</link>
        <pubDate>Tue, 03 Apr 2012 00:00:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-2</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
      <item>
        <title>Vampire Slayer quest</title>
        <dc:creator><![CDATA[@latifundio latifundio]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/latifundio">@latifundio</a> wrote:</p>
          <blockquote>
              <p>Well this is the Vampire Slayer quest, feel free to use it. Also i need suggestions on how to do the quest ending on the same quest file and not on FigthEvent.  :o</p>
<p><img src="http://img62.imageshack.us/img62/2821/vs3c.png" alt width="" height=""></p>
<p><img src="http://img193.imageshack.us/img193/4225/vs4o.png" alt width="" height=""></p>
<p>VampireSlayer.java</p>
<p>[code]package org.darkquest.gs.plugins.quests;</p>
<p>import org.darkquest.gs.event.FightEvent;<br>
import org.darkquest.gs.event.SingleEvent;<br>
import org.darkquest.gs.external.EntityHandler;<br>
import org.darkquest.gs.model.ChatMessage;<br>
import org.darkquest.gs.model.GameObject;<br>
import org.darkquest.gs.model.InvItem;<br>
import org.darkquest.gs.model.MenuHandler;<br>
import org.darkquest.gs.model.Mob;<br>
import org.darkquest.gs.model.Npc;<br>
import org.darkquest.gs.model.Player;<br>
import org.darkquest.gs.model.World;<br>
import org.darkquest.gs.plugins.Quest;<br>
import org.darkquest.gs.plugins.listeners.action.ObjectActionListener;<br>
import org.darkquest.gs.plugins.listeners.action.TalkToNpcListener;<br>
import org.darkquest.gs.plugins.listeners.executive.ObjectActionExecutiveListener;<br>
import org.darkquest.gs.plugins.listeners.executive.TalkToNpcExecutiveListener;<br>
import org.darkquest.gs.states.Action;<br>
import org.darkquest.gs.states.CombatState;</p>
<p>public class VampireSlayer extends Quest implements TalkToNpcListener, TalkToNpcExecutiveListener,<br>
ObjectActionListener, ObjectActionExecutiveListener {</p>
<pre><code>@Override
public int getQuestId() {
	return 3;
}

@Override
public String getQuestName() {
	return "Vampire Slayer";
}

@Override
public void onTalkToNpc(Player p, final Npc n) {
	// Morgan
	if(n.getID() == 97) {
		// quest start
		if(p.getQuestStage(this) == 0) {
			n.setBusy(true);
			p.setBusy(true);
			System.out.println("Quest stage: " + 0);
			p.informOfNpcMessage(new ChatMessage(n, "Please please, help us bold hero", p));
			sleep();
			p.informOfChatMessage(new ChatMessage(p, "What is the problem?", n));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n,	"Our little village has been dreadfully ravaged by an evil vampire", p));
			sleep(2400);
			p.informOfNpcMessage(new ChatMessage(n, "There's is hardly any of us left", p));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n,	"We need someone to get rid of him once and for good", p));
			sleep(2400);
			p.getActionSender().sendMessage("Would you like to start the " + this.getQuestName() + " quest?");
			String[] options = new String[] { "Yes", "No" };
		    	p.setMenuHandler(new MenuHandler(options) {
			    	public void handleReply(final int option, final String reply) {
			    		switch (option) {
				            case 0: // Yes
						n.setBusy(true);
						owner.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "OK, I'm up for an adventure", n));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "I think first you should seek help", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"I've a friend who is a retired vampire hunter", owner));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n, "called Dr Harlow", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "He may be able to give you some advice", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"he can normally be found in the jolly boar inn these days", owner));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n, "He's a bit of an old soak", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "mention his old friend Morgan", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"I'm sure he wouldn't want me to be killed by a vampire", owner));
						sleep(2400);
						owner.informOfChatMessage(new ChatMessage(owner, "I'll look him up then", n));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "Thank you", owner));
						sleep();
						owner.setQuestStage(getQuestId(), 1);
						owner.setBusy(false);
						n.setBusy(false);
						break;
					    case 1: // No
						n.setBusy(true);
						owner.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "No. Vampires are scary", n));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "Oh please..", owner));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
					    default:
						owner.setBusy(false);
						n.setBusy(false);
						return;
					}
				}
			});							
		    	p.getActionSender().sendMenu(options);
			n.setBusy(false);
			p.setBusy(false);
		}
		// quest is finished
		else if (p.getQuestStage(this) == -1) {
			p.setBusy(true);
			n.blockedBy(p);
			p.informOfNpcMessage(new ChatMessage(n, "How are you doing with your quest?", p));
			sleep();
			p.informOfChatMessage(new ChatMessage(p, "I have slain the foul creature", n));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n, "Thank you, Thank you", p));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n, "You will always be a hero in our village", p));
			sleep();
			p.setBusy(false);
			n.unblock();

		}
		else {
			p.setBusy(true);
			n.blockedBy(p);
			p.informOfNpcMessage(new ChatMessage(n, "How are you doing with your quest?", p));
			sleep();
			p.informOfChatMessage(new ChatMessage(p, "I'm working on it still", n));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n, "Please hurry", p));
			sleep(1800);
			p.informOfNpcMessage(new ChatMessage(n, "Every day we live in fear of our lives", p));
			sleep();
			p.informOfNpcMessage(new ChatMessage(n, "Afraid that we will be the vampire's next victim", p));
			sleep(2400);
			p.setBusy(false);
			n.unblock();
		}
	}
	// dr Harlow
	else if(n.getID() == 98) {
		if(p.getQuestStage(this) == 1) {
			p.setBusy(true);
			n.setBusy(true);
			p.informOfNpcMessage(new ChatMessage(n, "Buy me a drrink pleassh", p));
			sleep();
			String[] options = new String[] { "No you've had enough", "Morgan needs Your help!" };
			p.setMenuHandler(new MenuHandler(options) {
				public void handleReply(final int option, final String reply) {
					switch (option) {
					    case 0:
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "No you've had enough", n));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						break;
					    case 1:
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "Morgan needs your help", n));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "Morgan you shhay?", owner));
						sleep();
						owner.informOfChatMessage(new ChatMessage(owner,
								"His village is being terrorised by a vampire", n));
						sleep();
						owner.informOfChatMessage(new ChatMessage(owner,
								"He wanted me to ask you how should I go about stoping it", n));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n,
								"Buy me a beer then I will teashh you what you need to know", owner));
						sleep(2400);
						owner.informOfChatMessage(new ChatMessage(owner,
								"But this is your friend Morgan we're talking about!", n));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n,
								"if you wan't me to teashh you buy me a beer", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "...OK mate", owner));
						sleep();
						owner.setQuestStage(getQuestId(), 2);
						owner.setBusy(false);
						n.setBusy(false);
						break;
					    default:
						owner.setBusy(false);
						n.setBusy(false);
						return;
					}
				}
			});
			p.getActionSender().sendMenu(options);
			p.setBusy(false);
			n.setBusy(false);
		} 
		else if(p.getQuestStage(this) == 2) {
			p.setBusy(true);
			n.setBusy(true);
			p.informOfNpcMessage(new ChatMessage(n, "Buy me a drrink pleassh", p));
			sleep();
			p.informOfChatMessage(new ChatMessage(p, "...", n));
			sleep();
			String[] options = new String[] { "No you've had enough", "Ok mate" };
			p.setMenuHandler(new MenuHandler(options) {
				public void handleReply(final int option, final String reply) {
					switch (option) {
					    case 0:
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "No you've had enough", n));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						break;
					    case 1:
						// if there is beer on inventory
						if (owner.getInventory().hasItemId(193)) {
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "Ok mate", n));
						sleep();
						owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
						owner.getActionSender().sendInventory();
						owner.getActionSender().sendMessage("You give a beer to Dr Harlow");
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n, "Cheersh matey!", owner));
						sleep();
						owner.informOfChatMessage(new ChatMessage(owner,
								"So tell me how to kill vampires then", n));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, 
								"Yesh yesh, I was very good at killing em once", owner));
						sleep();
						owner.getActionSender().sendMessage("Dr Harlow appears to sober up slightly");
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n,
								"Well you're gonna kill it with a stake", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"otherwishe he'll just regenerate", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"yes your killing blow must be done with the stake", owner));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n,
								"I just happen to have one on me", owner));
						sleep();
						owner.getActionSender().sendMessage("Dr Harlow hands you a stake");
						owner.getInventory().add(new InvItem(217));
						owner.getActionSender().sendInventory();
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n,
								"You'll need a hammer to hand to drive it in properly as well", owner));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n, "One last thing", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n, "It's wise to carry garlic with you", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"vampires are weakened somewath if they smell garlic", owner));
						sleep(2400);
						owner.informOfNpcMessage(new ChatMessage(n, "Dunno were you find that though", owner));
						sleep();
						owner.informOfNpcMessage(new ChatMessage(n,
								"remember even then vampire is a dangerous foe", owner));
						sleep();
						owner.informOfChatMessage(new ChatMessage(owner, "Thank you very much", n));
						sleep();
						owner.setQuestStage(getQuestId(), 3);
						owner.setBusy(false);
						n.setBusy(false);
						}
						else {
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "I'll just go and buy one", n));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						}
						break;
					    default:
						owner.setBusy(false);
						n.setBusy(false);
						return;
					}
				}
			});							
		    	p.getActionSender().sendMenu(options);
			n.setBusy(false);
			p.setBusy(false);
		}
		else {
			p.setBusy(true);
			n.setBusy(true);
			p.informOfNpcMessage(new ChatMessage(n, "Buy me a drrink pleassh", p));
			sleep();
			p.informOfChatMessage(new ChatMessage(p, "...", n));
			sleep();
			String[] options = new String[] { "No you've had enough", "Ok mate" };
			p.setMenuHandler(new MenuHandler(options) {
				public void handleReply(final int option, final String reply) {
					switch (option) {
					    case 0:
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "No you've had enough", n));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						break;
					    case 1:
						if (owner.getQuestStage(3) == 3 &amp;&amp; owner.getInventory().hasItemId(193) 
								&amp;&amp; !owner.getInventory().hasItemId(217)) {
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "Ok mate", n));
						sleep();
						owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
						owner.getActionSender().sendInventory();
						owner.getActionSender().sendMessage("You give a beer to Dr Harlow");
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n, "Cheersh matey!", owner));
						sleep();
						owner.informOfChatMessage(new ChatMessage(owner,
								"I lost my stake", n));
						sleep();
						owner.getActionSender().sendMessage("Dr Harlow hands you a stake");
						owner.getInventory().add(new InvItem(217));
						owner.getActionSender().sendInventory();
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n,
								"There you go", owner));
						sleep(2400);
						owner.setBusy(false);
						n.setBusy(false);
						}
						else if (owner.getInventory().hasItemId(193)) {
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "Ok mate", n));
						sleep();
						owner.getInventory().remove(owner.getInventory().getLastIndexById(193));
						owner.getActionSender().sendInventory();
						owner.getActionSender().sendMessage("You give a beer to Dr Harlow");
						sleep(1200);
						owner.informOfNpcMessage(new ChatMessage(n, "Cheersh matey!", owner));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						}
						else {
						owner.setBusy(true);
						n.setBusy(true);
						sleep(600);
						owner.informOfChatMessage(new ChatMessage(owner, "I'll just go and buy one", n));
						sleep();
						owner.setBusy(false);
						n.setBusy(false);
						}
						break;
					    default:
						owner.setBusy(false);
						n.setBusy(false);
						return;
					}
				}
			});
		    	p.getActionSender().sendMenu(options);
			n.setBusy(false);
			p.setBusy(false);
		}
	}
}

@Override
public void onObjectAction(GameObject obj, String command, Player player) {
	if (player.getQuestStage(this) == -1 &amp;&amp; command.equals("search") &amp;&amp; obj.getID() == 136 &amp;&amp; obj.getY() == 3380) {
		player.getActionSender().sendMessage("It is empty..");
		return;
	}
	else if (command.equals("search") &amp;&amp; obj.getID() == 136 &amp;&amp; obj.getY() == 3380) {
		final Npc n = new Npc(96, 206, 3381, player.getX() - 2, player.getX() + 2, player.getY() - 5, player.getY() + 5);
		n.setRespawn(false);
		world.registerNpc(n);
		player.getActionSender().sendMessage("A vampire jumps out off the coffing!");
		if (player.getInventory().hasItemId(218)) {
			sleep(1200);
			// TODO do this properly
			player.informOfNpcMessage(new ChatMessage(n, "Arrrg that ghastly smell!", player));
			n.setWeakend(true);
		}
		else {
			sleep(1200);
			player.informOfNpcMessage(new ChatMessage(n, "Arrrg how dare you!", player));
		}
		sleep(600);
		if (n != null &amp;&amp; !n.inCombat()) {
			player.getActionSender().sendStats();
			fight(player, n);
			if (n.isWeakend() == true)
				player.getActionSender().sendMessage("The vampire appears to weaken!");
			World.getWorld().getDelayedEventHandler().add(new SingleEvent(null, 1200000) {
			    public void action() {
				Mob opponent = n.getOpponent();
				if (opponent != null) {
				    opponent.resetCombat(CombatState.ERROR);
				}
				n.resetCombat(CombatState.ERROR);
				world.unregisterNpc(n);
				n.remove();
			   }
			});
			//  finish quest check FightEvent
		}
		return;
	} 
}
private static final World world = World.getWorld();

	private void fight(Player owner, Npc n) {
	n.resetPath();
	owner.resetPath();
	owner.resetAll();
	owner.setStatus(Action.FIGHTING_MOB);
	owner.getActionSender().sendSound("underattack");
	owner.getActionSender().sendMessage("You are under attack!");

	n.setLocation(owner.getLocation(), true);
	for (Player p : n.getViewArea().getPlayersInView()) {
	    p.removeWatchedNpc(n);
	}

	owner.setBusy(true);
	owner.setSprite(9);
	owner.setOpponent(n);
	owner.setCombatTimer();

	n.setBusy(true);
	n.setSprite(8);
	n.setOpponent(owner);
	n.setCombatTimer();
	n.setChasing(owner);
	FightEvent fighting = new FightEvent(owner, n, true);
	fighting.setLastRun(0);
	World.getWorld().getDelayedEventHandler().add(fighting);
	}

@Override
public boolean blockTalkToNpc(Player p, Npc n) {
	if(n.getID() == 97 || n.getID() == 98) {
		return true;
	}
	return false;
}

@Override
public boolean blockObjectAction(GameObject obj, String command, Player player) {
	if(obj.getID() == 136 &amp;&amp; command.equals("search") &amp;&amp; obj.getY() == 3380) {
		return true;
	}
	return false;
}
</code></pre>
<p>}[/code]</p>
<p>FightEvent.java</p>
<p><code>		if (newHp &lt;= 0) {
			// count Draynor
			if (opponent instanceof Npc &amp;&amp; opponent.getID() == 96) {
			Player p = (Player) attacker;
				// 217 stake and 168 hammer - TODO I think stake can break if str lvl is low ???
				if (p.getInventory().wielding(217) == true &amp;&amp; p.getInventory().hasItemId(168)) {
					p.getInventory().remove(p.getInventory().getLastIndexById(217));
					p.getActionSender().sendInventory();
					p.getActionSender().sendMessage("You hammer the stake into the vampire chest");
					opponent.killedBy(attacker, false);
					attacker.resetCombat(CombatState.WON);
					opponent.resetCombat(CombatState.LOST);
					//ends Vampire Slayer quest
					if (p.getQuestStage(3) == 3) {
						p.setQuestStage(3, -1);
						p.incExp(0, 5000, false, false, false);
					}
					this.stop();
				}
				else opponent.setHits(35);
				return;
			}
			else {
				opponent.killedBy(attacker, false);
				attacker.resetCombat(CombatState.WON);
				opponent.resetCombat(CombatState.LOST);
				this.stop();
			}
		}</code><br>
Enjoy!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vampire-slayer-quest/438282/1</link>
        <pubDate>Mon, 02 Apr 2012 22:38:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-438282-1</guid>
        <source url="https://forum.moparisthebest.com/t/vampire-slayer-quest/438282.rss">Vampire Slayer quest</source>
      </item>
  </channel>
</rss>
