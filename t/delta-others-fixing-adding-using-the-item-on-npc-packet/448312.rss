<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
    <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312</link>
    <description>[center][size=18pt][b]Using an item on an npc.[/b][/size]

I discovered on my server, which more delta&#39;s will have, that when you use an item on an npc, you get disconnected.
Other server who didn&#39;t have this error, but also non-delta server didn&#39;t seem to have the packet working.[/center]

[b]So what we are going to do is:[/b]
- Fixing the packet. (credits to google for the packetsizes)
- Fully adding the packet so we can actually use it.
- Setting up how to execute an item on npc action.

[i]This will be written for delta but everyone with a little knowledge should be able to easily convert it.[/i]


[size=14pt][b]Step 1: Fixing the packet size[/b][/size]
 - Open client.java
 - Search for:
 [code=java]packetSizes[][/code]
 [i]You should see a lot of numbers under it, this is where the problem is, the packetsize is not correct so we will adjust it.[/i]

 - Find the 5th line of numbers which looks like this:
 [code=java]0, 0, 0, 12, 0, 0, 0, 0, 8, 0, //50[/code]
 - The 7th number of the line, (right before the 8), has to be changed to 8 to, so change it to 8.
 - It should now look like this:
 [code=java]0, 0, 0, 12, 0, 0, 0, 8, 8, 0, //50[/code]


[size=14pt][b]Step 2: Correctly adding the Item on NPC packet[/b][/size]
 - Search in your client class for your packets.
 [code=java]void parseIncomingPackets()[/code]
 
 - Search if you already have the packet:
   - Search for:
   [code=java]case 57:[/code]

 - If you do, remove everything between &quot;case 57&quot; and &quot;break;&quot;
 - If you don&#39;t, right under &quot;parseincomingpackets () {&quot; add this:
   [code=java]case 57:
break;[/code]

 [i]Your Item on NPC packet is now succesfully added, now it&#39;s just here for the lulz, we want to be able to do something with it.[/i]

 - Right under case 57: add this piece of code:
 [code=java]			//Item on npc: Sent when an item is used on a npc.
			int itemUsedOnNpc = c.inStream.readUnsignedWordA();
			int npcIndex = c.inStream.readUnsignedWordA();
			
			if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (NpcHandler.npcs[npcIndex] == null) || !c.antiHax())
				break;
			
			c.NPCID = NpcHandler.npcs[npcIndex].npcType;
			
			if (c.NPCID != -1) {
				c.faceNPC(npcIndex);
			}[/code]

[i] You now have succesfully added the packet.[/i]


[size=14pt][b]Step 3: Using item On NPC actions[/b][/size]
Now we want to do something with our packet.
 - right under, c.faceNPC(npcIndex); add this piece of code:
 [code=java]
				if (c.NPCID == # &amp;&amp; itemUsedOnNpc == *) {
					c.sM(&quot;test&quot;);
				} else {
					c.sM(&quot;Nothing interesting happens.&quot;);
				}[/code]
 - if the npcId is # and of the item used on that npc is * then the player will get the message &quot;test&quot; sent.
 - else if the above line is false it will sent the player the message &quot;nothing interesting happens.
 - So obviously you put the npcid # and the itemid * and change the action to what you want.
 - If you want more of them you just add more lines.



So once done it should look like this:
[code=java]
		case 57:
			//Item on npc: Sent when an item is used on a npc.
			int itemUsedOnNpc = c.inStream.readUnsignedWordA();
			int npcIndex = c.inStream.readUnsignedWordA();
			
			if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (NpcHandler.npcs[npcIndex] == null) || !c.antiHax())
				break;
			
			c.NPCID = NpcHandler.npcs[npcIndex].npcType;
			
			if (c.NPCID != -1) {
				c.faceNPC(npcIndex);
				
				if (c.NPCID == 845 &amp;&amp; itemUsedOnNpc == 995) {
					c.addItem(995, 10000);
					c.sM(&quot;You received 10,000 coins.&quot;);
				}
				else if (c.NPCID == 946 &amp;&amp; itemUsedOnNpc == 6666) {
					c.triggerTele(2500, 2500, 0);
					c.sM(&quot;You teleport to limbo.&quot;);
				} else {
					c.sM(&quot;Nothing interesting happens.&quot;);
				}
			}
		break;
[/code]


[i][b]For any problems or questions just leave a reply and I will be glad to help.[/b][/i]</description>
    
    <lastBuildDate>Fri, 10 Aug 2012 21:19:28 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@pitchblac23 pitchblac23]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pitchblac23">@pitchblac23</a> wrote:</p>
          <blockquote>
              <p>Hey I finally got around to readding this to my server and did have a problem with it not working and found out it was cuz of your first break; and not adding in a { and } to the first if <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> anti leach? so i added it in and its working now</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/21</link>
        <pubDate>Fri, 10 Aug 2012 21:19:28 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-21</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Loveandpower Loveandpower]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/loveandpower">@Loveandpower</a> wrote:</p>
          <blockquote>
              <p>Sad to see that packet is corrected <img src="https://forum.moparisthebest.com/images/emoji/twitter/frowning.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
<p>Good contribution though!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/20</link>
        <pubDate>Thu, 26 Jul 2012 18:36:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-20</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@zolidthebeast zolidthebeast]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zolidthebeast">@zolidthebeast</a> wrote:</p>
          <blockquote>
              <p>Hello, i got another problem. whenever im using an item and drag the mouse over a npc nothing shows… like if i draw it over an object like Altar it says “Use Shark with Altar” but when i draw it over a npc it just says “Use Shark with…” Would be really nice if you know how to fix this. since i really need it becouse im adding cats. and atm i can’t feed them becouse of this. so im kinda stuck <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/19</link>
        <pubDate>Thu, 26 Jul 2012 18:30:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-19</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“Whackatre, post:17, topic:448312”][quote]<br>
inStream.readUnsignedWordA(); sends the itemId<br>
[/quote]</p>
<p>Anybody can easily configure the client to send the server bad and invalid information.[/quote]</p>
<p>if (!c.playerHasItem(itemId)<br>
return;</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/18</link>
        <pubDate>Sat, 07 Jul 2012 20:47:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-18</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@whackatre Whackatre]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/whackatre">@whackatre</a> wrote:</p>
          <blockquote>
              <h2>[quote=“RandQm, post:16, topic:448312”][quote author=pitchblac23 link=topic=551203.msg4040897#msg4040897 date=1341621652]<br>
i get these errors when compiling</h2>
<h2>Compiler -by RandQm<br>
Current Time Fri 07/06/2012 19:31:05.79</h2>
<p>Compiling…<br>
errors:<br>
client.java:10231: error: package NpcHandler does not exist<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= npcHandler.npcs.length) || (NpcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
client.java:10231: error: cannot find symbol<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (npcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:10234: error: cannot find symbol<br>
NPCID = npcHandler.npcs[npcIndex].npcType;<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:14504: error: variable npcIndex is already defined in method parseIn<br>
comingPackets()<br>
int npcIndex = inStream.readSignedWordBigEndianA();<br>
^<br>
4 errors<br>
.<br>
.<br>
.<br>
.<br>
.<br>
Compiling Finished.<br>
By RandQm<br>
Press any key to continue . . .<br>
Server is already in use.</p>
<p>the client.java:14504 one is on magic on npc the rest i sorda upderstand but not enough to know what to do<br>
[/quote]<br>
…<br>
Obviously you have to change some things sometimes so it fits for your server.<br>
npcHandler will probably have to be NPCHandler</p>
<p>like the error telles npcIndex is already used, (read errors) so just change it to npcIndex2 or something and change all the npcIndex in the method to npcIndex2</p>
<aside class="quote">
<blockquote>
<p>I don’t see any item validation. Or if there is, can somebody point me out to it?</p>
</blockquote>
</aside>
<p>inStream.readUnsignedWordA(); sends the itemId[/quote]</p>
<p>Anybody can easily configure the client to send the server bad and invalid information.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/17</link>
        <pubDate>Sat, 07 Jul 2012 20:13:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-17</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <h2>[quote=“pitchblac23, post:14, topic:448312”]i get these errors when compiling</h2>
<h2>Compiler -by RandQm<br>
Current Time Fri 07/06/2012 19:31:05.79</h2>
<p>Compiling…<br>
errors:<br>
client.java:10231: error: package NpcHandler does not exist<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= npcHandler.npcs.length) || (NpcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
client.java:10231: error: cannot find symbol<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (npcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:10234: error: cannot find symbol<br>
NPCID = npcHandler.npcs[npcIndex].npcType;<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:14504: error: variable npcIndex is already defined in method parseIn<br>
comingPackets()<br>
int npcIndex = inStream.readSignedWordBigEndianA();<br>
^<br>
4 errors<br>
.<br>
.<br>
.<br>
.<br>
.<br>
Compiling Finished.<br>
By RandQm<br>
Press any key to continue . . .<br>
Server is already in use.</p>
<p>the client.java:14504 one is on magic on npc the rest i sorda upderstand but not enough to know what to do[/quote]<br>
…<br>
Obviously you have to change some things sometimes so it fits for your server.<br>
npcHandler will probably have to be NPCHandler</p>
<p>like the error telles npcIndex is already used, (read errors) so just change it to npcIndex2 or something and change all the npcIndex in the method to npcIndex2</p>
<aside class="quote quote-modified" data-post="15" data-topic="448312">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/whackatre/40/7608_1.png" class="avatar"> Whackatre:</div>
<blockquote>
<p>I don’t see any item validation. Or if there is, can somebody point me out to it?</p>
</blockquote>
</aside>
<p>inStream.readUnsignedWordA(); sends the itemId</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/16</link>
        <pubDate>Sat, 07 Jul 2012 18:09:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-16</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@whackatre Whackatre]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/whackatre">@whackatre</a> wrote:</p>
          <blockquote>
              <p>I don’t see any item validation. Or if there is, can somebody point me out to it?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/15</link>
        <pubDate>Sat, 07 Jul 2012 08:19:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-15</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@pitchblac23 pitchblac23]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pitchblac23">@pitchblac23</a> wrote:</p>
          <blockquote>
              <h2>i get these errors when compiling</h2>
<h2>Compiler -by RandQm<br>
Current Time Fri 07/06/2012 19:31:05.79</h2>
<p>Compiling…<br>
errors:<br>
client.java:10231: error: package NpcHandler does not exist<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= npcHandler.npcs.length) || (NpcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
client.java:10231: error: cannot find symbol<br>
if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (npcHa<br>
ndler.npcs[npcIndex] == null) || !antiHax())<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:10234: error: cannot find symbol<br>
NPCID = npcHandler.npcs[npcIndex].npcType;<br>
^<br>
symbol:   variable NpcHandler<br>
location: class client<br>
client.java:14504: error: variable npcIndex is already defined in method parseIn<br>
comingPackets()<br>
int npcIndex = inStream.readSignedWordBigEndianA();<br>
^<br>
4 errors<br>
.<br>
.<br>
.<br>
.<br>
.<br>
Compiling Finished.<br>
By RandQm<br>
Press any key to continue . . .<br>
Server is already in use.</p>
<p>the client.java:14504 one is on magic on npc the rest i sorda upderstand but not enough to know what to do</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/14</link>
        <pubDate>Sat, 07 Jul 2012 00:40:52 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-14</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="12" data-topic="448312">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/illadelph/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Illadelph:</div>
<blockquote>
<p>Errors with your guide.</p>
</blockquote>
</aside>
<p>It would help if we knew what errors you have</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/13</link>
        <pubDate>Fri, 06 Jul 2012 16:42:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-13</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Illadelph Illadelph]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/illadelph">@Illadelph</a> wrote:</p>
          <blockquote>
              <p>Errors with your guide.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/12</link>
        <pubDate>Fri, 06 Jul 2012 03:55:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-12</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Pzezima2 Pzezima2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pzezima2">@Pzezima2</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="8" data-topic="448312">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/lostmyphat/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> lostmyphat:</div>
<blockquote>
<p>^what errors</p>
</blockquote>
</aside>
<p>the following code not work. and if I modify it to something else it cannot recognise the npc thing…</p>
<p>anyway this is useitem.java:</p>
<p><code>	public static void ItemonNpc(Client c, int itemId, int npcId, int slot) {
		switch(itemId) {
		case 7808:
		if(itemId == 7808 &amp;&amp; npcId == 500) {
		c.Quest2 += 1;
		}
		break;
		default:</code></p>
<p>and in NPCHandler I have this:</p>
<p><code>			case 500:
			if(c.Quest2 == 7) {
			npcs[i].forceChat("Ahhhh.. Fuck that hurt!");
				}
			break;</code></p>
<p>But that doesn’t work. I copied npcs[i].forceChat from another code from above which is this:</p>
<p><code>			case 3496:
				random = Misc.random(2);
				if (random == 0 || random == 1) {
					npcs[i].attackType = 0;
				npcs[i].projectileId = -1;
			} else {
			npcs[i].forceChat("Hssssssssssss");
				npcs[i].gfx100(550);
				npcs[i].projectileId = 551;
				npcs[i].endGfx = 552;
					npcs[i].attackType = 2;
				}
			break;</code></p>
<p>and that works fine^^<br>
but it doesn’t work for mine. hopefully you understand this.  ;D</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/11</link>
        <pubDate>Thu, 05 Jul 2012 22:27:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-11</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@lostmyphat lostmyphat]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lostmyphat">@lostmyphat</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="9" data-topic="448312">
<div class="title">
<div class="quote-controls"></div>
 Mario PvP:</div>
<blockquote>
<p>What would happen if your packet size isn’t fixed.</p>
</blockquote>
</aside>
<p>Random disconnections</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/10</link>
        <pubDate>Thu, 05 Jul 2012 18:59:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-10</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Mario_PvP Mario PvP]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mario_pvp">@Mario_PvP</a> wrote:</p>
          <blockquote>
              <p>What would happen if your packet size isn’t fixed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/9</link>
        <pubDate>Thu, 05 Jul 2012 18:46:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-9</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@lostmyphat lostmyphat]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lostmyphat">@lostmyphat</a> wrote:</p>
          <blockquote>
              <p>^what errors</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/8</link>
        <pubDate>Thu, 05 Jul 2012 17:35:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-8</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Pzezima2 Pzezima2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pzezima2">@Pzezima2</a> wrote:</p>
          <blockquote>
              <p>i get errors no matter what</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/7</link>
        <pubDate>Thu, 05 Jul 2012 02:07:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-7</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“Pzezima2, post:5, topic:448312”]Thanks for this!<br>
Now I need to figure out how to make the npc do an emote (die), say “fuck that hurt”, then add an item to invent.<br>
:P[/quote]<br>
set the variables to make an npc die,<br>
add the item to where also slayer xp ect gets added when the npc dies,<br>
update chat when the type of npc is dying</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/6</link>
        <pubDate>Thu, 05 Jul 2012 02:00:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-6</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Pzezima2 Pzezima2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pzezima2">@Pzezima2</a> wrote:</p>
          <blockquote>
              <p>Thanks for this!<br>
Now I need to figure out how to make the npc do an emote (die), say “fuck that hurt”, then add an item to invent.<br>
<img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/5</link>
        <pubDate>Thu, 05 Jul 2012 01:53:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-5</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="448312">
<div class="title">
<div class="quote-controls"></div>
 AtomicInt_:</div>
<blockquote>
<p>When would the npc id ever be below 0? Or is that how shitty DeltaScape is?</p>
</blockquote>
</aside>
<p>I have no idea honestly, it’s used in multiple cases when there’s a player-npc interaction, so I added it there to.<br>
I should run some tests on that since everyone knows delta bases has gone through so many hands that there’s a lot of unneeded crap.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/4</link>
        <pubDate>Thu, 05 Jul 2012 01:50:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-4</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>When would the npc id ever be below 0? Or is that how shitty DeltaScape is?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/3</link>
        <pubDate>Thu, 05 Jul 2012 01:42:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-3</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@Team_Rocket Team_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/team_rocket">@Team_Rocket</a> wrote:</p>
          <blockquote>
              <p>Looks like you did a decent job bro.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/2</link>
        <pubDate>Thu, 05 Jul 2012 01:35:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-2</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
      <item>
        <title>[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[center][size=18pt]<span class="bbcode-b">Using an item on an npc.</span>[/size]</p>
<p>I discovered on my server, which more delta’s will have, that when you use an item on an npc, you get disconnected.<br>
Other server who didn’t have this error, but also non-delta server didn’t seem to have the packet working.[/center]</p>
<p><span class="bbcode-b">So what we are going to do is:</span></p>
<ul>
<li>Fixing the packet. (credits to google for the packetsizes)</li>
<li>Fully adding the packet so we can actually use it.</li>
<li>Setting up how to execute an item on npc action.</li>
</ul>
<p><span class="bbcode-i">This will be written for delta but everyone with a little knowledge should be able to easily convert it.</span></p>
<p>[size=14pt]<span class="bbcode-b">Step 1: Fixing the packet size</span>[/size]</p>
<ul>
<li>Open client.java</li>
<li>Search for:</li>
</ul>
<pre><code class="lang-auto"></code></pre>
<p><span class="bbcode-i">You should see a lot of numbers under it, this is where the problem is, the packetsize is not correct so we will adjust it.</span></p>
<ul>
<li>Find the 5th line of numbers which looks like this:</li>
</ul>
<pre><code class="lang-auto"></code></pre>
<ul>
<li>The 7th number of the line, (right before the 8), has to be changed to 8 to, so change it to 8.</li>
<li>It should now look like this:</li>
</ul>
<pre><code class="lang-auto"></code></pre>
<p>[size=14pt]<span class="bbcode-b">Step 2: Correctly adding the Item on NPC packet</span>[/size]</p>
<ul>
<li>Search in your client class for your packets.</li>
</ul>
<pre><code class="lang-auto"></code></pre>
<ul>
<li>
<p>Search if you already have the packet:</p>
<ul>
<li>Search for:</li>
</ul>
<pre><code class="lang-auto"></code></pre>
</li>
<li>
<p>If you do, remove everything between “case 57” and “break;”</p>
</li>
<li>
<p>If you don’t, right under “parseincomingpackets () {” add this:</p>
<p><code>case 57:
break;</code></p>
</li>
</ul>
<p><span class="bbcode-i">Your Item on NPC packet is now succesfully added, now it’s just here for the lulz, we want to be able to do something with it.</span></p>
<ul>
<li>Right under case 57: add this piece of code:</li>
</ul>
<p>[code=java]			//Item on npc: Sent when an item is used on a npc.<br>
int itemUsedOnNpc = c.inStream.readUnsignedWordA();<br>
int npcIndex = c.inStream.readUnsignedWordA();</p>
<pre><code>		if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (NpcHandler.npcs[npcIndex] == null) || !c.antiHax())
			break;
		
		c.NPCID = NpcHandler.npcs[npcIndex].npcType;
		
		if (c.NPCID != -1) {
			c.faceNPC(npcIndex);
		}[/code]
</code></pre>
<p><span class="bbcode-i"> You now have succesfully added the packet.</span></p>
<p>[size=14pt]<span class="bbcode-b">Step 3: Using item On NPC actions</span>[/size]<br>
Now we want to do something with our packet.</p>
<ul>
<li>right under, c.faceNPC(npcIndex); add this piece of code:</li>
</ul>
<p><code>
				if (c.NPCID == # &amp;&amp; itemUsedOnNpc == *) {
					c.sM("test");
				} else {
					c.sM("Nothing interesting happens.");
				}</code></p>
<ul>
<li>if the npcId is # and of the item used on that npc is * then the player will get the message “test” sent.</li>
<li>else if the above line is false it will sent the player the message "nothing interesting happens.</li>
<li>So obviously you put the npcid # and the itemid * and change the action to what you want.</li>
<li>If you want more of them you just add more lines.</li>
</ul>
<p>So once done it should look like this:</p>
<pre><code class="lang-auto">		case 57:
			//Item on npc: Sent when an item is used on a npc.
			int itemUsedOnNpc = c.inStream.readUnsignedWordA();
			int npcIndex = c.inStream.readUnsignedWordA();
			
			if ((npcIndex &lt; 0) || (npcIndex &gt;= NpcHandler.npcs.length) || (NpcHandler.npcs[npcIndex] == null) || !c.antiHax())
				break;
			
			c.NPCID = NpcHandler.npcs[npcIndex].npcType;
			
			if (c.NPCID != -1) {
				c.faceNPC(npcIndex);
				
				if (c.NPCID == 845 &amp;&amp; itemUsedOnNpc == 995) {
					c.addItem(995, 10000);
					c.sM("You received 10,000 coins.");
				}
				else if (c.NPCID == 946 &amp;&amp; itemUsedOnNpc == 6666) {
					c.triggerTele(2500, 2500, 0);
					c.sM("You teleport to limbo.");
				} else {
					c.sM("Nothing interesting happens.");
				}
			}
		break;</code></pre>
<p><span class="bbcode-i"><span class="bbcode-b">For any problems or questions just leave a reply and I will be glad to help.</span></span></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312/1</link>
        <pubDate>Thu, 05 Jul 2012 00:23:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-448312-1</guid>
        <source url="https://forum.moparisthebest.com/t/delta-others-fixing-adding-using-the-item-on-npc-packet/448312.rss">[Delta][Others] Fixing, Adding &amp; Using the ITEM ON NPC packet</source>
      </item>
  </channel>
</rss>
