<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/my-c-server-so-far/384832 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>My C server so far - Community Inside Talk - moparisthebest.com</title>
    <meta name="description" content="Source code can be found here: https://github.com/Lothy/Dionysus 

I&amp;#39;ve only added it to github this early because I need some feedback -- it doesn&amp;#39;t actually run yet (well, a client can successfully connect to it and re&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="384832.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;My C server so far&#39;" href="384832.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/my-c-server-so-far/384832" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/my-c-server-so-far/384832" />
<meta property="og:title" content="My C server so far" />
<meta name="twitter:title" content="My C server so far" />
<meta property="og:description" content="Source code can be found here: https://github.com/Lothy/Dionysus  I’ve only added it to github this early because I need some feedback – it doesn’t actually run yet (well, a client can successfully connect to it and reach the login screen, but that’s it).  I thought my current packet writing API was great, but didn’t consider setting the size of the packets after writing all of the appropriate data. Libevent API doesn’t support direct access to the underlying uchar array in a defined manner (if ..." />
<meta name="twitter:description" content="Source code can be found here: https://github.com/Lothy/Dionysus  I’ve only added it to github this early because I need some feedback – it doesn’t actually run yet (well, a client can successfully connect to it and reach the login screen, but that’s it).  I thought my current packet writing API was great, but didn’t consider setting the size of the packets after writing all of the appropriate data. Libevent API doesn’t support direct access to the underlying uchar array in a defined manner (if ..." />
<meta property="article:published_time" content="2011-03-04T10:41:35+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="next" href="3848324658.html?page=2">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="384832.html">My C server so far</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/community-inside-talk.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Community Inside Talk</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-04T10:41:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:56:04Z' class='post-time'>
              August 1, 2016,  7:56am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Source code can be found here: <a href="https://github.com/Lothy/Dionysus" rel="nofollow noopener">https://github.com/Lothy/Dionysus</a></p>
<p>I’ve only added it to github this early because I need some feedback – it doesn’t actually run yet (well, a client can successfully connect to it and reach the login screen, but that’s it).</p>
<p>I thought my current packet writing API was great, but didn’t consider setting the size of the packets after writing all of the appropriate data. Libevent API doesn’t support direct access to the underlying uchar array in a defined manner (if at all), so I need to redo it.<br>
This means that I’m going to need to write data into uchar arrays that I control directly before sending the data using Libevent.</p>
<p>Fortunately Libevent supports sending the data in a uchar * by passing it in as a pointer, which means the data isn’t copied several times before actually being sent.<br>
I can pass a pointer to a callback function as well which will be notified when the uchar * has been written.<br>
One obvious solution to this problem is that I simply malloc two uchar * for each game tick.<br>
I don’t really want to do this though, as I don’t believe mallocing/freeing potentially several KB per player (up to 2k players) per game tick (600ms) is ideal.</p>
<p>On the other hand, if you check out my bit_packer files (<a href="https://github.com/Lothy/Dionysus/blob/master/include/bit_packer.h" rel="nofollow noopener">https://github.com/Lothy/Dionysus/blob/master/include/bit_packer.h</a> and <a href="https://github.com/Lothy/Dionysus/blob/master/src/bit_packer.c" rel="nofollow noopener">https://github.com/Lothy/Dionysus/blob/master/src/bit_packer.c</a>) you’ll see that I have a bit_buffer struct.<br>
I could alternatively have an array of a similar struct which contains an underlying uchar *.<br>
I would then have a integer acting as a bitfield to indicate which elements in the array are still in use (marked with a 1 bit) and which are ‘free’ to use for a new write (0 bit).<br>
The upside here is that I’m no longer constantly allocating and freeing a potentially large amount of memory.</p>
<p>The reason I thought of this is because of the Libevent API.<br>
Specifically, the evbuffer_add_reference function (documentation here: <a href="http://www.monkey.org/~provos/libevent/doxygen-2.0.1/buffer_8h.html#8572c7c382489635be20d251039b8673" rel="nofollow noopener">http://www.monkey.org/~provos/libevent/doxygen-2.0.1/buffer_8h.html#8572c7c382489635be20d251039b8673</a>).<br>
When I pass a uchar * in, it will always read from index 0 – this rules out use of a true circular buffer.</p>
<p>Thoughts and opinions?<br>
Also, for those who are C programmers (I’m guessing abraham, super_ and mopar plus maybe frank_ if he sees this), comment on the code.<br>
Evil_ ran it through Valgrind a few days ago and it reported no memory leaks, so that’s a positive start in my opinion. <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>With regards to ‘best practice’, I know that I need to move some variable declarations from header files to the respective source files. I’ll get to that, but I’m more interested in your thoughts on how I can handle the packet writing.</p>
<p>Second question: How does the game tick work client-side? What would happen if I changed the server’s tick from say 600ms to 100ms (and, as a consequence, changed the sending of position updates and so on only every 6th tick to ensure correct movement speed).</p>
<p>Thanks for the help guys.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-05T17:29:39Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:09Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>“Cache IDs” is the 192-bit unique computer ID number, stored in random.dat. “CRC keys” <em>i think</em> are the checksums of each local resource descriptor table file – not positive as it’s been quite a long time since i’ve looked at a client. avoid “update keys” and implement a proper update server. in regards to smaller tick size, i’ve thought about it but i don’t think there is any real reason to.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-05T20:55:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:30Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="2" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
 super_:</div>
<blockquote>
<p>avoid “update keys” and implement a proper update server.</p>
</blockquote>
</aside>
<p>Doesn’t seem like anyone can figure out the right way to do it though:<br>
<a href="https://www.moparisthebest.com/smf/index.php/topic,427511.0.html" class="onebox" target="_blank">https://www.moparisthebest.com/smf/index.php/topic,427511.0.html</a></p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-05T21:59:14Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:35Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>update keys are just crc and length of the indexs as I recall</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T00:10:36Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:44Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m not at all concerned about providing a proper update server as part of my project.<br>
Doing so automatically implies that I basically want to distribute their intellectual property, and that could make it liable (even just for removal from github).</p>
<p>Out of interest, does the client expect to receive update packets (ie, player/npc updates) back-to-back, or can the client receive a player update packet, and then perhaps a packet telling it to display a particular tab, and then the npc update packet?</p>
<p>I did some reading about the performance of malloc/free last night, and some implementations are really shit apparently. Someone mentioned that they’re avoided like the plague in real-time systems.<br>
I was thinking that an 8KB or 16KB circular buffer would solve the problem – there’s no way that a cbuffer that size would wrap around before the contents at the start have been written.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T02:34:29Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:51Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You can provide your own implementations of malloc/free though can’t you?  Perhaps using something nice like a heap? (or your circular buffer)</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T02:52:54Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:57:53Z' class='post-time'>
              August 1, 2016,  7:57am
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="6" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/moparisthebest/40/30_1.png" class="avatar"> Moparisthebest:</div>
<blockquote>
<p>You can provide your own implementations of malloc/free though can’t you?  Perhaps using something nice like a heap? (or your circular buffer)</p>
</blockquote>
</aside>
<p>Well sure, but any allocation function that I was to write would leverage malloc anyway – the difference being that I would, on the first call to the function, just allocate a huge block of heap memory.<br>
Knowing this, I think it’d be better to just have the circular buffer for each player as part of the application’s static memory.<br>
Ignore that dumb moment above too – circular buffers would work fine, because a pointer doesn’t have to point to the start of a block of memory. :rolleyes: Too much java programming.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Graham.html'><span itemprop='name'>Graham</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T08:54:21Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:58:09Z' class='post-time'>
              August 1, 2016,  7:58am
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>In terms of your question about the ticks Lothy, I’m reasonably sure that the official RuneScape server does all game logic processing in multiples of the 600ms tick so there shouldn’t be any need to lower it.</p>
<p>The update server I wrote for 317 is still up on GitHub and hasn’t been removed yet - <a href="https://github.com/apollo-rsps/jagcached" rel="nofollow noopener">https://github.com/apollo-rsps/jagcached</a>.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T09:02:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:58:09Z' class='post-time'>
              August 1, 2016,  7:58am
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The 317 update server in MoparScape 4 works perfectly as well, it’s the 508 no one seems to be able to get right.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T14:16:40Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:58:19Z' class='post-time'>
              August 1, 2016,  7:58am
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Pushed some more changes to github just now before I go to bed.<br>
I’ve implemented a circular buffer struct and associated functions which allow writing of primitive types to the circular buffer.<br>
Having done some rudimentary testing, it seems to be bug free so far. It can wrap around right after an opcode write, right after a size write, or in the case of the size being 2 bytes, it can wrap around in the middle of the size write.</p>
<p>So yeah, seems to operate correctly.</p>
<p>I ported the bit packer code to the circular buffer files as well, and added wraparound functionality.<br>
Just a question regarding that – with a circular buffer, obviously most of the buffer will contain non-zero values after the initial wraparound. When reading bits, does the client ignore any bits after the bits it expects to read? For example, if I write a packet that only uses two bits (ie, 11000000) in the last byte of the payload, will it matter if those remaining, unused, bits (such that 11000000 becomes something like 11001010) are set or not?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Metho_D.html'><span itemprop='name'>Metho_D</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T15:55:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:58:25Z' class='post-time'>
              August 1, 2016,  7:58am
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="9" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/moparisthebest/40/30_1.png" class="avatar"> Moparisthebest:</div>
<blockquote>
<p>The 317 update server in MoparScape 4 works perfectly as well, it’s the 508 no one seems to be able to get right.</p>
</blockquote>
</aside>
<p>I didn’t have any problems implementing an update server for one of the newer clients (600+), and I don’t think 508 is very different.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T21:10:30Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:59:06Z' class='post-time'>
              August 1, 2016,  7:59am
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Metho D, post:11, topic:384832”][quote author=Moparisthebest link=topic=480598.msg3521016#msg3521016 date=1299402155]<br>
The 317 update server in MoparScape 4 works perfectly as well, it’s the 508 no one seems to be able to get right.<br>
[/quote]</p>
<p>I didn’t have any problems implementing an update server for one of the newer clients (600+), and I don’t think 508 is very different.[/quote]</p>
<p>Do you care to share it? Or at least have a look at mine and see where I went wrong?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Metho_D.html'><span itemprop='name'>Metho_D</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T22:17:32Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:59:15Z' class='post-time'>
              August 1, 2016,  7:59am
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Moparisthebest, post:12, topic:384832”][quote author=Metho D link=topic=480598.msg3521284#msg3521284 date=1299426915]</p>
<aside class="quote">
<blockquote>
<p>The 317 update server in MoparScape 4 works perfectly as well, it’s the 508 no one seems to be able to get right.</p>
</blockquote>
</aside>
<p>I didn’t have any problems implementing an update server for one of the newer clients (600+), and I don’t think 508 is very different.<br>
[/quote]</p>
<p>Do you care to share it? Or at least have a look at mine and see where I went wrong?[/quote]</p>
<p>I don’t know if I still have it, but I can take a look at yours if you provide the code.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-06T23:14:24Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:59:17Z' class='post-time'>
              August 1, 2016,  7:59am
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Metho D, post:13, topic:384832”][quote author=Moparisthebest link=topic=480598.msg3521696#msg3521696 date=1299445830]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>The 317 update server in MoparScape 4 works perfectly as well, it’s the 508 no one seems to be able to get right.</p>
</blockquote>
</aside>
<p>I didn’t have any problems implementing an update server for one of the newer clients (600+), and I don’t think 508 is very different.</p>
</blockquote>
</aside>
<p>Do you care to share it? Or at least have a look at mine and see where I went wrong?<br>
[/quote]</p>
<p>I don’t know if I still have it, but I can take a look at yours if you provide the code.[/quote]</p>
<p>maybe you should read his thread.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Metho_D.html'><span itemprop='name'>Metho_D</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-07T01:04:37Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:59:22Z' class='post-time'>
              August 1, 2016,  7:59am
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>At first glance, the only thing that looks problematic is your dumpFile method in the Main class (org.moparscape.cacheutils.v508.Main). It appears that you sometimes write more data to the file than you should. At the end of all files in the cache (with the exception of those with index = 255), a two-byte version value is appended that is used to see if a file is outdated and should be requested. The server doesn’t send this data with the file – the client appends it after the file has been received. If this is the problem, you should be able to fix it by modifying the loop on line 141 to go from [0…data.length - 2] instead of [0…data.length] if index != 255.</p>
<p>Hope that helps.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-07T02:19:41Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:59:27Z' class='post-time'>
              August 1, 2016,  7:59am
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ll have a go at that later and report back, it would be great if it was that simple. <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-07T15:03:51Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:00:15Z' class='post-time'>
              August 1, 2016,  8:00am
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>On a happy note, I’ve just made some changes following frank_'s advice.<br>
Previously I was using an if block to check for wraparound. Now the code uses the modulo operator for all wraparound detection (bitpacker as well).</p>
<p>Basically that part of the code should perform a lot better.<br>
Hopefully I’ll have some time to make some more major progress on Wednesday and Thursday, as those two are uni-free (and with any luck I’ll actually be well rested lol).</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-13T14:45:13Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:08:00Z' class='post-time'>
              August 1, 2016,  8:08am
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Just finished writing a function to append player update blocks to the circular buffer.<br>
If anyone wants to have a quick look over it to make sure I haven’t made any silly mistakes, feel free to: <a href="https://github.com/Lothy/Dionysus/blob/master/src/protocols/508.c" rel="nofollow noopener">https://github.com/Lothy/Dionysus/blob/master/src/protocols/508.c</a></p>
<p>In particular, I need clarification that I have a) included all update blocks, b) have them all in the right order (although wrote a quick class as part of Blake’s server and used the comparator to sort a list of all player and npc update block implementations, and then printed them out in order).</p>
<p>Here’s the code if you CBF going to github for some reason :rolleyes:</p>
<pre><code class="lang-auto">int append_player_update_blocks(struct player *player,
        struct circular_buffer *cbuf)
{
    int i;
    int hp_ratio;
    int app_block_start_index;
    unsigned char app_block_size;
    struct item *equip_item;
    struct item_definition *item_def;

    if (player-&gt;update_flags &amp; PUFLAG_SECONDARY_HIT_UPDATE_REQUIRED) {
        cwrite_byte_S(cbuf, player-&gt;secondary_damage.amount);
        cwrite_byte_A(cbuf, player-&gt;secondary_damage.type);
    }

    if (player-&gt;update_flags &amp; PUFLAG_FACE_MOB_UPDATE_REQUIRED) {
        cwrite_short_B(cbuf, player-&gt;mob_to_face);
    }

    if (player-&gt;update_flags &amp; PUFLAG_FORCED_CHAT_UPDATE_REQUIRED) {
        player-&gt;forced_chat[MAX_FORCED_CHAT_LEN - 1] = '\0';
        cwrite_string(cbuf, player-&gt;forced_chat);
    }

    if (player-&gt;update_flags &amp; PUFLAG_GRAPHICS_UPDATE_REQUIRED) {
        cwrite_short_B(cbuf, player-&gt;graphic.graphic_id);
        cwrite_int_M(cbuf, player-&gt;graphic.height);
    }

    if (player-&gt;update_flags &amp; PUFLAG_FACE_POSITION_UPDATE_REQUIRED) {
        cwrite_short_L(cbuf, (player-&gt;face_position_abs_x * 2) + 1);
        cwrite_short_BA(cbuf, (player-&gt;face_position_abs_y * 2) + 1);
    }

    if (player-&gt;update_flags &amp; PUFLAG_CHAT_UPDATE_REQUIRED) {
        cwrite_short_BA(cbuf, player-&gt;chat.effects);
        cwrite_byte_C(cbuf, player-&gt;rights);
        cwrite_byte_C(cbuf, player-&gt;chat.message_len);
        player-&gt;chat.message[MAX_CHAT_LEN - 1] = '\0';
        for (i = 0; i &lt; player-&gt;chat.message_len; ++i) {
            cwrite_byte(cbuf, player-&gt;chat.message[i]);
        }
    }

    if (player-&gt;update_flags &amp; PUFLAG_ANIM_UPDATE_REQUIRED) {
        cwrite_short_B(cbuf, player-&gt;animation.anim_id);
        cwrite_byte_S(cbuf, player-&gt;animation.delay);
    }

    if (player-&gt;update_flags &amp; PUFLAG_APPEARANCE_UPDATE_REQUIRED) {
        app_block_start_index = cwrite_byte(cbuf, 0); /* Placeholder */

        cwrite_byte(cbuf, player-&gt;appearance.gender);
        if ((player-&gt;appearance.gender &amp; 0x2) == 2) {
            cwrite_byte(cbuf, 0);
            cwrite_byte(cbuf, 0);
        }
        cwrite_byte(cbuf, player-&gt;appearance.skull_icon);
        cwrite_byte(cbuf, player-&gt;appearance.head_icon);

        if (player-&gt;appearance.npc_id == -1) {
            for (i = 0; i &lt; 4; ++i) {
                equip_item = &amp;player-&gt;equipped_items[i];
                if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                    item_def = get_item_definition(equip_item-&gt;item_id);
                    cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
                }
                else {
                    cwrite_byte(cbuf, 0);
                }
            }

            /* Chest slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_CHEST];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                item_def = get_item_definition(equip_item-&gt;item_id);
                cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_CHEST]);
            }

            /* Shield slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_SHIELD];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                item_def = get_item_definition(equip_item-&gt;item_id);
                cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
            }
            else {
                cwrite_byte(cbuf, 0);
            }

            /* Arms slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_CHEST];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                if (!is_full_body(equip_item-&gt;item_id)) {
                    cwrite_short_B(cbuf, 0x100
                            + player-&gt;appearance.looks[APPEARANCE_ARMS]);
                }
                else {
                    cwrite_byte(cbuf, 0);
                }
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_ARMS]);
            }

            /* Legs slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_LEGS];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                item_def = get_item_definition(equip_item-&gt;item_id);
                cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_LEGS]);
            }

            /* Head slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_HAT];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                if (is_full_helm(equip_item-&gt;item_id) || is_full_mask(
                        equip_item-&gt;item_id)) {
                    cwrite_byte(cbuf, 0);
                }
                else {
                    cwrite_short_B(cbuf, 0x100
                            + player-&gt;appearance.looks[APPEARANCE_HEAD]);
                }
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_HEAD]);
            }

            /* Hands slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_HANDS];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                item_def = get_item_definition(equip_item-&gt;item_id);
                cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_HANDS]);
            }

            /* Feet slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_FEET];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                item_def = get_item_definition(equip_item-&gt;item_id);
                cwrite_short_B(cbuf, 32768 + item_def-&gt;equip_id);
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_FEET]);
            }

            /* Beard slot */
            equip_item = &amp;player-&gt;equipped_items[EQUIPMENT_HAT];
            if (equip_item-&gt;item_id != NO_ITEM_EQUIPPED) {
                if (is_full_mask(equip_item-&gt;item_id)) {
                    cwrite_byte(cbuf, 0);
                }
                else {
                    cwrite_short_B(cbuf, 0x100
                            + player-&gt;appearance.looks[APPEARANCE_BEARD]);
                }
            }
            else {
                cwrite_short_B(cbuf, 0x100
                        + player-&gt;appearance.looks[APPEARANCE_BEARD]);
            }
        }
        else {
            cwrite_short_B(cbuf, -1);
            cwrite_short_B(cbuf, player-&gt;appearance.npc_id);
        }

        for (i = 0; i &lt; 7; ++i) {
            cwrite_byte(cbuf, player-&gt;appearance.colours[i]);
        }

        /* Animation indices */
        cwrite_short_B(cbuf, player-&gt;appearance.stand_anim);
        cwrite_short_B(cbuf, 0x337);
        cwrite_short_B(cbuf, player-&gt;appearance.walk_anim);
        cwrite_short_B(cbuf, 0x334);
        cwrite_short_B(cbuf, 0x335);
        cwrite_short_B(cbuf, 0x336);
        cwrite_short_B(cbuf, player-&gt;appearance.run_anim);

        cwrite_long_B(cbuf, player-&gt;username_hash);
        cwrite_byte(cbuf, player-&gt;combat_level);
        cwrite_short_B(cbuf, 0);

        /*
* We now need to write the size of the appearance
* update block into the placeholder that we
* set aside at the start.
* As we're using a circular buffer, we have to test
* for wraparound and deal with it.
*/
        if (cbuf-&gt;write_offset &gt; app_block_start_index) { /* No wraparound */
            app_block_size = cbuf-&gt;write_offset - app_block_start_index;
            cbuf-&gt;buffer[app_block_start_index] = app_block_size;
        }
        else { /* Wraparound occurred */
            app_block_size = cbuf-&gt;write_offset;
            app_block_size += sizeof(cbuf-&gt;buffer) - app_block_start_index;
            cbuf-&gt;buffer[app_block_start_index] = app_block_size;
        }
    }

    if (player-&gt;update_flags &amp; PUFLAG_PRIMARY_HIT_UPDATE_REQUIRED) {
        if (player-&gt;cur_skill_levels[SKILL_HITPOINTS] &lt; 0) {
            player-&gt;cur_skill_levels[SKILL_HITPOINTS] = 0;
        }

        hp_ratio = (player-&gt;cur_skill_levels[SKILL_HITPOINTS] * 255)
                / player-&gt;max_skill_levels[SKILL_HITPOINTS];
        if (hp_ratio &gt; 255) {
            hp_ratio = 255;
        }

        cwrite_byte_S(cbuf, player-&gt;primary_damage.amount);
        cwrite_byte_S(cbuf, player-&gt;primary_damage.type);
        cwrite_byte_S(cbuf, hp_ratio);
    }
    return 1;
}

int append_npc_update_blocks(struct npc *npc, struct circular_buffer *cbuf)
{
    if (npc-&gt;update_flags &amp; NUFLAG_FACE_MOB_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_NPC_TRANSFORM_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_FORCED_CHAT_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_ANIM_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_GRAPHICS_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_SECONDARY_HIT_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_FACE_POSITION_UPDATE_REQUIRED) {

    }

    if (npc-&gt;update_flags &amp; NUFLAG_PRIMARY_HIT_UPDATE_REQUIRED) {

    }
    return 1;
}</code></pre>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Metho_D.html'><span itemprop='name'>Metho_D</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-13T16:48:59Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:08:07Z' class='post-time'>
              August 1, 2016,  8:08am
            </time>
        <span itemprop='position'>#19</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You’re missing the first player update block (indicated by 0x100). It’s used for agility and other purposes, and people generally call it “force movement”.</p>
<p>Everything else seems to be in order.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-13T22:18:41Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:08:32Z' class='post-time'>
              August 1, 2016,  8:08am
            </time>
        <span itemprop='position'>#20</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Okay, I’ll look into that later. That’s probably something that Blake is going to need to add to Osiris as well, seeing as the code above is completely based on his.</p>
<p>Thanks.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><b><a rel="next" itemprop="url" href="3848324658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/my-c-server-so-far/384832 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:09 GMT -->
</html>
