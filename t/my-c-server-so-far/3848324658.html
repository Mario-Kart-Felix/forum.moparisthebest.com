<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/my-c-server-so-far/384832?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>My C server so far - Community Inside Talk - moparisthebest.com</title>
    <meta name="description" content="Source code can be found here: https://github.com/Lothy/Dionysus 

I&amp;#39;ve only added it to github this early because I need some feedback -- it doesn&amp;#39;t actually run yet (well, a client can successfully connect to it and re&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="3848324658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;My C server so far&#39;" href="384832.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/my-c-server-so-far/384832?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/my-c-server-so-far/384832?page=2" />
<meta property="og:title" content="My C server so far" />
<meta name="twitter:title" content="My C server so far" />
<meta property="og:description" content="[quote=“Lothy, post:20, topic:384832”]Okay, I’ll look into that later. That’s probably something that Blake is going to need to add to Osiris as well, seeing as the code above is completely based on his.  Thanks.[/quote]  lol if only blake had the motivation to look into that sort of stuff.  he completely refuses to open a client’s source code, most of the update blocks i added.  [quote=“Graham, post:8, topic:384832”]In terms of your question about the ticks Lothy, I’m reasonably sure that the o..." />
<meta name="twitter:description" content="[quote=“Lothy, post:20, topic:384832”]Okay, I’ll look into that later. That’s probably something that Blake is going to need to add to Osiris as well, seeing as the code above is completely based on his.  Thanks.[/quote]  lol if only blake had the motivation to look into that sort of stuff.  he completely refuses to open a client’s source code, most of the update blocks i added.  [quote=“Graham, post:8, topic:384832”]In terms of your question about the ticks Lothy, I’m reasonably sure that the o..." />
<meta property="article:published_time" content="2011-03-15T16:07:44+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="384832.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="384832.html">My C server so far</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/community-inside-talk.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Community Inside Talk</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/boomer216.html'><span itemprop='name'>boomer216</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-15T16:07:44Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:11:21Z' class='post-time'>
              August 1, 2016,  8:11am
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Lothy, post:20, topic:384832”]Okay, I’ll look into that later. That’s probably something that Blake is going to need to add to Osiris as well, seeing as the code above is completely based on his.</p>
<p>Thanks.[/quote]</p>
<p>lol if only blake had the motivation to look into that sort of stuff.<br>
he completely refuses to open a client’s source code, most of the update blocks i added.</p>
<p>[quote=“Graham, post:8, topic:384832”]In terms of your question about the ticks Lothy, I’m reasonably sure that the official RuneScape server does all game logic processing in multiples of the 600ms tick so there shouldn’t be any need to lower it.</p>
<p>The update server I wrote for 317 is still up on GitHub and hasn’t been removed yet - <a href="https://github.com/apollo-rsps/jagcached.%5B/quote" rel="nofollow noopener">https://github.com/apollo-rsps/jagcached.[/quote</a>]</p>
<p>I actually read in a recent developer blog on their Engine, that they’ve added the ability for game logic to process in 50ms ticks for some of their newer content. At least I think it was 50ms if my memory is correct. But other then that, up until rev 600+, they’ve confirmed that all their logic is processed in 600ms ticks.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Graham.html'><span itemprop='name'>Graham</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-15T19:53:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:11:36Z' class='post-time'>
              August 1, 2016,  8:11am
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="21" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/boomer216/40/409_1.png" class="avatar"> boomer216:</div>
<blockquote>
<p>I actually read in a recent developer blog on their Engine, that they’ve added the ability for game logic to process in 50ms ticks for some of their newer content. At least I think it was 50ms if my memory is correct. But other then that, up until rev 600+, they’ve confirmed that all their logic is processed in 600ms ticks.</p>
</blockquote>
</aside>
<p>That’s interesting. Do you have a link to it? I did some quick searching but couldn’t find it…</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Metho_D.html'><span itemprop='name'>Metho_D</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-15T22:09:02Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:11:46Z' class='post-time'>
              August 1, 2016,  8:11am
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Graham, post:22, topic:384832”][quote author=boomer216 link=topic=480598.msg3531361#msg3531361 date=1300205264]<br>
I actually read in a recent developer blog on their Engine, that they’ve added the ability for game logic to process in 50ms ticks for some of their newer content. At least I think it was 50ms if my memory is correct. But other then that, up until rev 600+, they’ve confirmed that all their logic is processed in 600ms ticks.<br>
[/quote]</p>
<p>That’s interesting. Do you have a link to it? I did some quick searching but couldn’t find it…[/quote]</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="http://www.runescape.com/img/global/favicon.ico?1" class="site-icon" width="32" height="32">
      <a href="http://services.runescape.com/m=forum/forums.ws?25,26,405,62276896" target="_blank" rel="nofollow noopener">RuneScape</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/362;"><img src="http://www.runescape.com/img/microsite/social-share-fb.jpg" class="thumbnail"></div>

<h3><a href="http://services.runescape.com/m=forum/forums.ws?25,26,405,62276896" target="_blank" rel="nofollow noopener">RuneScape Forum - Community Forums for Clans, Feedback &amp; Discussion</a></h3>

<p>Join the discussion on the official RuneScape forum. Share your thoughts with the community, ask questions, find help, learn about events and much more.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Specifically:</p>
<blockquote>Q. As we know and stated by Andrew the game runs at 600ms intervals (one tick). Is there a reason for this exact number? Could the game benefit from lower interval, for example 300ms?
<p>A. Some upcoming features in the server tick at a 50ms rate. The overall 600ms tick remains, as the content relies on having this time interval available as a base, but we’re not limited by it.<br>
Mod_jackh</p>
</blockquote>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rixxx.html'><span itemprop='name'>Rixxx</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-17T11:49:12Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:14:21Z' class='post-time'>
              August 1, 2016,  8:14am
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Out of curiosity, why are you writing this server in C?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-17T14:11:06Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:14:24Z' class='post-time'>
              August 1, 2016,  8:14am
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Boils down to a few things:</p>
<p>a) I’ve never written anything non-trivial in C (or C++ - but I don’t like C++ enough to use it)<br>
b) I wanted to change this, because I was sick of being one of these newfag programmers that ONLY uses C#/Java. Both of these languages are quite good (although now that I’ve come into function pointers, the lack of them in java pisses me off a lot), but using them exclusively is pretty bad imo.<br>
c) Because I wanted to see a server that made use of Lua for scripting<br>
d) The RS emulation scene deserves a native solution just like the WoW scene<br>
e) Because I’m a mushroom cloud laying motherfucker, motherfucker!</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/thiefmn6092.html'><span itemprop='name'>thiefmn6092</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-26T01:08:47Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:27:28Z' class='post-time'>
              August 1, 2016,  8:27am
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hey Lothy, nice project, I checked it out</p>
<p><img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> I will talk to you in IRC about some ideas I have</p>
<p>out of curiosity, why do you think you need function pointers so much?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-26T07:02:33Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:27:56Z' class='post-time'>
              August 1, 2016,  8:27am
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Because Java’s poor man’s function pointers are, for all intents and purposes, implementing an interface over and over again. That’s as close as it comes.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/xEnt.html'><span itemprop='name'>xEnt</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-03-27T04:45:33Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:29:29Z' class='post-time'>
              August 1, 2016,  8:29am
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>looks nice lothy keep it up legend</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cheese_Police.html'><span itemprop='name'>Cheese_Police</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-01T02:10:30Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:37:06Z' class='post-time'>
              August 1, 2016,  8:37am
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have no idea why I looked into this as much as I did, but here we go…</p>
<p><span class="bbcode-b">src/bit_packer.c</span><br>
[hr]</p>
<p>[ul][li][font=andale mono]free_bit_buffer[/font] doesn’t free the buffer allocated[/li]<br>
[li][font=andale mono]free_bit_buffer[/font] and [font=andale mono]free_char_buffer[/font] have inconsistent signatures ([font=andale mono]int[/font] vs [font=andale mono]void[/font] return values).  Is [font=andale mono]free_char_buffer[/font] needed?[/li]<br>
[li][font=andale mono]write_bits[/font] <a href="https://github.com/Lothy/Dionysus/blob/master/src/bit_packer.c#L64" data-bbcode="true" rel="nofollow noopener">@64</a>:  This code should have nothing to do with players directly.  If the function fails, return with an appropriate value and let the calling code take care of it.[/li][/ul]</p>
<p><span class="bbcode-b">src/circular_buffer.c</span><br>
[hr]</p>
<p>[ul][li][font=andale mono]WRAP_WRITE_PTR[/font] should surround its arguments with parentheses: (((x) % (y)).[/li]<br>
[li]Writing to the buffer looks like it could get pretty disgusting (due to long names).  It’s not really avoidable, but it might be worth your time to come up with something to make it more readable (macros?).[/li][/ul]</p>
<p><span class="bbcode-b">src/config.c</span><br>
[hr]</p>
<p>[ul][li]Instead of having a fixed list of options and retaining them as individual global variables, store options in a table (even arbitrary tag names).[/li]<br>
[li]The parsing code should be a bit more flexible (whitespace, possibly allow for comments);  some sanity checks would be good too (bad syntax).[/li][/ul]</p>
<p><span class="bbcode-b">src/item.c</span><br>
[hr]<br>
[ul][li]A fixed amount of items is understandable, but will you always need the same amount? (different revisions)[/li][/ul]</p>
<p><span class="bbcode-b">src/linkedlist.c</span><br>
[hr]<br>
[ul][li][font=andale mono]linkedlist_create[/font] should zero the structure it allocates.[/li]<br>
[li][font=andale mono]linkedlist_insert_tail[/font] should zero the structure it allocates.[/li][/ul]</p>
<p><span class="bbcode-b">src/listener.c</span><br>
[hr]<br>
[ul][li][font=andale mono]load_event_base[/font] should return a null pointer instead of calling [font=andale mono]exit[/font].[/li]<br>
[li][font=andale mono]sock_write_cb[/font] and [font=andale mono]sock_event_cb[/font] should cleanly disconnect and safely deallocate the client (cleanup function for the client structure).[/li][/ul]</p>
<p><span class="bbcode-b">src/module_loader.c</span><br>
[hr]<br>
[ul][li]You should support different platforms (Windows) appropriately:  use POSIX API when available, don’t assume ‘.so’ suffix.[/li]<br>
[li][font=andale mono]load_modules[/font] doesn’t [font=andale mono]closedir[/font] when it returns after error.  In addition, exit shouldn’t be used in the event of failure.[/li]<br>
[li][font=andale mono]load_module[/font] has a fixed (and really short!) length char array for the path.  [font=andale mono]strcat[/font] should be avoided in favor of more secure alternatives.[/li][/ul]</p>
<p><span class="bbcode-b">src/packet_decoder.c</span><br>
[hr]<br>
[ul][li][font=andale mono]set_login_decoder[/font], [font=andale mono]set_packet_decoder_table[/font], and [font=andale mono]set_packet_sizes_table[/font] shouldn’t [font=andale mono]exit[/font] on failure.[/li][/ul]</p>
<p><span class="bbcode-b">src/packet_sender.c</span><br>
[hr]<br>
[ul][li][font=andale mono]set_send_packet_table[/font] shouldn’t [font=andale mono]exit[/font] on failure.[/li][/ul]</p>
<p><span class="bbcode-b">src/region.c</span><br>
[hr]<br>
[ul][li][font=andale mono]init_region_list[/font] can just zero the whole region list at the same time ([font=andale mono]sizeof(struct region) * REGION_COUNT * REGION_COUNT * REGION_HEIGHT[/font]).[/li][/ul]</p>
<p><span class="bbcode-b">src/server.c</span><br>
[hr]<br>
[ul][li]Tests should be completely separate from the main source tree.[/li]<br>
[li][font=andale mono]set_player_update_function[/font] and [font=andale mono]set_npc_update_function[/font] shouldn’t [font=andale mono]exit[/font] on failure.[/li][/ul]</p>
<p>I understand this is still fairly new, and that a lot of things are just hacked together or prototyped, which is fine.  It would be good to check out the way you write code, consistency in naming/signatures and leaning more towards ‘Do one thing and do it well’ will (hopefully) remove some of the pains with writing something like this.</p>
<p>However, it looks OK so far.  You may want to look into <a href="http://software.schmorp.de/pkg/libev.html" data-bbcode="true" rel="nofollow noopener">libev</a> as an alternative to libevent.  It’s updated somewhat often and has something else good about it which I forget, ask Mopman.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-01T10:53:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:37:29Z' class='post-time'>
              August 1, 2016,  8:37am
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey man, thanks for taking the time to look at it in such depth. I’ll try to address things as best I can, and I’ll undoubtedly have questions too before this reply is finished.</p>
<p>Regarding the bit_packer files, particularly the [font=andale mono]free_bit_buffer[/font] function, those two things are intentional.<br>
[font=andale mono]free_char_buffer[/font] actually has that function signature because it was intended to be a callback that would be used by the libevent API.</p>
<p>My original design involved providing a struct bit_buffer which would then be written to, and then committed to libevent. Once that commit was made, my code could free the bit_buffer – when libevent was finished writing the underlying char *, it would then invoke that callback to free it as well.</p>
<p>I decided that this was rather poor design, so bit_packer.h/c are artifacts that I haven’t gotten around to removing yet. I’ve now actually moved the bit packer functions into circular_buffer.c, and they write to the buffer in there.<br>
Sorry about that, but if nothing else at least it’s blatantly obvious now that I made the right decision in ditching that approach.</p>
<p>As for the bit regarding the semantics of [font=andale mono]write_bits[/font], I agree with you. [font=andale mono]cwrite_bits[/font] in circular_buffer.c follows your suggestion.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/circular_buffer.c</span><br>
Hopefully this macro is right now: WRAP_WRITE_PTR(x, y) ((x) % (y))</p>
<p>As for the rest, I’m not sure how I could apply macros in place of functions for the writing to the buffer. I’ll keep it in mind though and do some searching, because there is a large amount of code in there and it would be ideal to improve it where possible.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/config.c</span><br>
I haven’t gotten far with this. Originally I was just playing around seeing how I could parse it. I was actually going to use a lexer, but they all seem to be under GPL (my code, on the other hand, is licensed under the BSD license).<br>
It’s low priority at the moment, mostly because I just want to get it to a working stage.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/item.c</span><br>
I presume you’re talking about the following:</p>
<pre><code class="lang-auto"></code></pre>
<p>As far as I can remember, there are less than 14000 unique items in the game at the moment. I guess I can increase it to 15k or more to future proof it for a while, but I don’t really see the value in making it too much larger than the current item count.</p>
<p>For now, I’ve defined a value as 15000:</p>
<pre><code class="lang-auto">#ifndef MAX_ITEM_DEFINITIONS
#define MAX_ITEM_DEFINITIONS 15000
#endif</code></pre>
<p>Down the track I’ll either a) document it so that people know that they can define the value at build time or, better yet, b) fix configuration loading up nicely and have it set there.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/linkedlist.c</span><br>
Done. Thanks for pointing that out.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/listener.c</span><br>
I’ve changed [font=andale mono]load_event_base[/font]. I’ve also moved the disconnection code to its own function (well, the calls to free the bufferevent and client structs).<br>
Whether this is what you meant by disconnecting cleanly, I’m not entirely sure.<br>
I’ve followed your advice too with regards to the client structure, and it now has its own allocation/deallocation functions (client_create() and client_free()).</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/module_loader.c</span><br>
This is a tricky one for me. <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> As you’ve probably noticed, the only windows-related code is found in the [font=andale mono]load_event_base[/font] function. It’s actually only there because I based that code heavily, if not completely, on their example code.</p>
<p>I don’t actually have access to a windows system to build and test the code on, so it’s pretty futile for me to cater to windows at this stage.<br>
I’m really hoping that someone chooses to come on board at a later stage for that once it’s a working product. Worst case though, it is on my TODO list.</p>
<p>Thanks for catching the lack of [font=andale mono]closedir[/font] calls; I’ve fixed that, and I’ve removed the call to exit() as well.</p>
<p>What are the alternatives to strcat? I know that Theo de Raadt wrote a few functions, specifically strlcat and strlcpy, for OpenBSD. These haven’t been adopted in glibc though, and likely never will be.<br>
According to the wikipedia article (<a href="http://en.wikipedia.org/wiki/Strlcat" rel="nofollow noopener">http://en.wikipedia.org/wiki/Strlcat</a>), strncat and strncpy are fairly shit.<br>
Are there any others that I’ve missed?<br>
For what it’s worth, I’ve ensured that all of the char arrays that I use are null-terminated.</p>
<p>Anyway, I’ve changed it so that [font=andale mono]full_module_name[/font] is allocated on the heap and then freed after the call to [font=andale mono]dlopen[/font]; this should stop any potential buffer overflows.</p>
<p>I imagine the most ideal way to do module loading would be by defining a few macros, with definitions depending on whether it was being built on windows or a unix-like system.<br>
I’ll get to that down the track.</p>
<p>[hr]</p>
<p><span class="bbcode-b">src/packet_decoder.c and src/packet_sender.c</span><br>
Fixed.</p>
<p><span class="bbcode-b">src/region.c</span><br>
Fixed, thanks for that. I wasn’t exactly sure how the allocation of n-dimensional arrays worked.</p>
<p><span class="bbcode-b">src/server.c</span><br>
Fixed. I’ve removed the test code too.</p>
<p>Again, thank you so much for all of that feedback. Obviously not many people on this forum make use of C, so your input is extremely valuable to me.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/system.html'><span itemprop='name'>system</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-01T16:15:09Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:37:49Z' class='post-time'>
              August 1, 2016,  8:37am
            </time>
        <span itemprop='position'>#31</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="25" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/lothy/40/51_1.png" class="avatar"> Lothy:</div>
<blockquote>
<p>although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="25" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/lothy/40/51_1.png" class="avatar"> Lothy:</div>
<blockquote>
<p>although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="25" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/lothy/40/51_1.png" class="avatar"> Lothy:</div>
<blockquote>
<p>although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="25" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/lothy/40/51_1.png" class="avatar"> Lothy:</div>
<blockquote>
<p>although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<aside class="quote quote-modified" data-post="25" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/lothy/40/51_1.png" class="avatar"> Lothy:</div>
<blockquote>
<p>although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<p>This so hard.</p>
<p>On another note, you should’ve used C++ if you wanted this to be open-source for the community to use.   It’s just a more common, widely used, and versatile language than C nowadays.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cheese_Police.html'><span itemprop='name'>Cheese_Police</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-01T17:07:54Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:37:52Z' class='post-time'>
              August 1, 2016,  8:37am
            </time>
        <span itemprop='position'>#32</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>For the fixed size item list, I was referring more to there being less than 14000 items than there being more (older revisions, RT3/RT4).  I would probably have it either be a config option or specified by a module (maybe have support for different revisions be loaded as modules, which can take care of setting protocol de/encoders and anything else).</p>
<p>Supporting modules on Windows isn’t too hard.</p>
<p>[code=c]HMODULE mod;<br>
int (*fn)();</p>
<p>mod = LoadLibrary(full_module_name); /* you might need to specify LoadLibraryA explicitly depending on encoding <em>/<br>
if (mod == NULL) {<br>
/</em> oh no… */<br>
}</p>
<p>fn = (int (<em>(</em>)())) GetProcAddress(mod, “module_init”); /* same as above with GetProcAddressA <em>/<br>
/</em> … */[/code]</p>
<p>For finding modules in a directory</p>
<p>[code=c]WIN32_FIND_DATA ffd;<br>
HANDLE fh;<br>
const char <em>search_path = "modules/</em>.dll";</p>
<p>fh = FindFirstFile(search_path, &amp;ffd);<br>
if (fh == INVALID_HANDLE_VALUE) {<br>
/* oh no… */<br>
}</p>
<p>do {<br>
/* would be good to make this check a bit safer/robust <em>/<br>
/</em> we filter for *.dll anyway, but for the sake of example… <em>/<br>
if (strstr(ffd.cFileName, “.dll”) != NULL) {<br>
/</em> load it up */<br>
}<br>
} while (FindNextFile(fh, &amp;ffd) != 0);</p>
<p>FindClose(fh);[/code]</p>
<p>In regards to the static path size, 2000 is much more reasonable, but I was getting at using something like MAX_PATH on Windows.  I did just look into it though, and apparently MAX_PATH on Windows is pretty much pointless, and consistency among unix-like systems is pretty bad (some define PATH_MAX and FILENAME_MAX, others may not define them and you need to use pathconf or fpathconf to find it, however it can potentially return a ridiculously huge value or -1, indicating that it isn’t bounded).  So at that, I would go for 2048 and call it a day.</p>
<p>strlcat is what I was referring to.  I didn’t know it isn’t included in glibc, I’ve been using BSD-like systems for a while now.<br>
You have a few options here.</p>
<p>[ul][li]Do something like this (from a BSD strcat manpage):[/li][/ul]</p>
<p>[code]SECURITY CONSIDERATIONS<br>
The strcat() function is easily misused in a manner which enables malicious users to arbitrarily change a running program’s functionality through a buffer overflow attack.  (See the<br>
FSA.)</p>
<pre><code> Avoid using strcat().  Instead, use strncat() or strlcat() and ensure that no more characters are copied to the destination buffer than it can hold.

 Note that strncat() can also be problematic.  It may be a security concern for a string to be truncated at all.  Since the truncated string will not be as long as the original, it may
 refer to a completely different resource and usage of the truncated resource could result in very incorrect behavior.  Example:

 void
 foo(const char *arbitrary_string)
 {
         char onstack[8] = "";

 #if defined(BAD)
         /*
          * This first strcat is bad behavior.  Do not use strcat!
          */
         (void)strcat(onstack, arbitrary_string);        /* BAD! */
 #elif defined(BETTER)
         /*
          * The following two lines demonstrate better use of
          * strncat().
          */
         (void)strncat(onstack, arbitrary_string,
             sizeof(onstack) - strlen(onstack) - 1);
 #elif defined(BEST)
         /*
          * These lines are even more robust due to testing for
          * truncation.
          */
         if (strlen(arbitrary_string) + 1 &gt;
             sizeof(onstack) - strlen(onstack))
                 err(1, "onstack would be truncated");
         (void)strncat(onstack, arbitrary_string,
             sizeof(onstack) - strlen(onstack) - 1);
 #endif
 }
</code></pre>
<p>[/code]<br>
[ul][li]Do some compile time checking or use autoconf (config.h, I wouldn’t really go for that), and do something accordingly (If strlcat is present, go ahead and use it.  If not, implement strlcat using the code above or use <a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/lib/libc/string/strlcat.c?rev=1.13;content-type=text%2Fplain" data-bbcode="true" rel="nofollow noopener">strlcat.c</a> with some appropriate modifications).[/li]<br>
[li]Don’t bother checking for existing functions and just implement strlcat as mystrlcat or something.[/li][/ul]</p>
<p>I’m not really sure what I would do to make the writing code better either.  You could try your best to create a pseudo-DSL with macros, but that could get ugly fast.</p>
<p>[code=c]<span class="hashtag">#define</span> P_C(v) ((char) (v))<br>
<span class="hashtag">#define</span> P_S(v) ((char) ((v) &gt;&gt; 8)), ((char) ((v) &amp; 0xff))<br>
<span class="hashtag">#define</span> P_I(v) ((char) ((v) &gt;&gt; 24)), ((char) ((v) &gt;&gt; 16)), <br>
((char) ((v) &gt;&gt; 8)), ((char) ((v) &amp; 0xff))<br>
<span class="hashtag">#define</span> P_END -1</p>
<p>/*<br>
not sure how i would terminate data.  a magic number would be simple, but potentially break with certain packets.<br>
instead of using a char array, maybe use a short array where positive values are simply the unsigned value of the actual byte, and -1 can be a marker for the end of the array.<br>
*/<br>
int c_write(struct circular_buffer <em>buf, char… data) {<br>
/</em> do stuff */<br>
}</p>
<p>void construct_mypacket(struct circular_buffer <em>buf, int foo, short bar) {<br>
/</em> let’s just pretend c_write uses a short array with -1 as a marker */<br>
c_write(buf, P_C(123), P_C(0), P_S(bar), P_I(0xdeadbeef), P_I(foo), P_END);<br>
}[/code]</p>
<p>Well, it’s not much of a DSL, is it?<br>
Ultimately it may just be better to suck it up and use your current API, and if it really becomes a nuisance,  make nifty Lua bindings for packet construction.</p>
<aside class="quote quote-modified" data-post="31" data-topic="384832">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/blakeman8192/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> blakeman8192:</div>
<blockquote>
<p>[quote author=Lothy link=topic=480598.msg3533334#msg3533334 date=1300371066]although now that I’ve come into function pointers, the lack of them in java pisses me off a lot</p>
</blockquote>
</aside>
<p>This so hard.</p>
<p>On another note, you should’ve used C++ if you wanted this to be open-source for the community to use.   It’s just a more common, widely used, and versatile language than C nowadays.[/quote]<br>
Yes, Java not having function pointers is actually a pain in the ass.  Sorry most people don’t like as much boilerplate as you do.</p>
<p>What a crock of shit.  C is still more common/used than C++ is, though the adoption rate is probably less.  What makes C++ more versatile than C?  Some features of C++ would be nice, like exceptions and templates, but much of it isn’t really deal breaking (yes, OOP included, sorry).</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-01T17:11:56Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:37:52Z' class='post-time'>
              August 1, 2016,  8:37am
            </time>
        <span itemprop='position'>#33</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>that item definition stuff looks rather poorly hacked together, and have you considered writing your own lexer/parser?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-02T20:36:07Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:39:31Z' class='post-time'>
              August 1, 2016,  8:39am
            </time>
        <span itemprop='position'>#34</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Lothy, post:30, topic:384832”]I don’t actually have access to a windows system to build and test the code on, so it’s pretty futile for me to cater to windows at this stage.<br>
I’m really hoping that someone chooses to come on board at a later stage for that once it’s a working product. Worst case though, it is on my TODO list.[/quote]</p>
<p>I actually build a decent amount of windows code, and never actually on windows.  Basically ever linux distribution has a package for mingw, and you can use it to build windows executables.  Then of course there is WINE to test them under.  But also, like you said, I don’t know how much I’d worry about it at this stage.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-12T16:35:44Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:09:08Z' class='post-time'>
              August 1, 2016, 11:09am
            </time>
        <span itemprop='position'>#35</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi guys, it’s been a while.</p>
<p>Latest commit lets you log in and walk around, but there’s a curious ‘bug’ (of sorts) which I can’t figure out.</p>
<p>Those familiar with the protocol will know that the first 5 bytes of a walk request packet in version 508 make up two shorts (the absolute x and y of the tile that you clicked) and a byte (which indicates whether or not you had the ctrl key pressed when you clicked the tile).</p>
<p>Following that is the rest of the path.</p>
<p>Anyway, when playing with it I realised that, when clicking on certain tiles, the first short is wildly off.<br>
Here’s some sample output:</p>
<pre><code class="lang-auto">-127 3430
-128 3430
3197 3430
3197 3430
-127 3430
3196 3430
3196 3444
3196 3419
-123 3430
3191 3430
3195 3428
3198 3430
-128 3430
3198 3430
3199 3429
3199 3430
3197 3430
3197 3430
3198 3430
3199 3430
-128 3430
3199 3430
-127 3430
3199 3430
-128 3430
-128 3430
3199 3430</code></pre>
<p>Does anyone know what’s happening? The functions that read from the underlying evbuffer are fine, and it returns the correct value <em>most</em> of the time. But for some reason those first two bytes (which are read as b[0] - 128 | b[1] &lt;&lt; 8) are 0 0.</p>
<p>Notably isn’t an issue when I log in to Blake’s server, Osiris.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/frank.html'><span itemprop='name'>frank</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-13T23:26:05Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:10:49Z' class='post-time'>
              August 1, 2016, 11:10am
            </time>
        <span itemprop='position'>#36</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>should the temp value be an unsigned short?</p>
<p>ps using the obfuscated protocol is still a good idea right… right?</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-14T02:36:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:11:05Z' class='post-time'>
              August 1, 2016, 11:11am
            </time>
        <span itemprop='position'>#37</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The byte ordering doesn’t matter as long as it is read in the same way that it was written to the stream.<br>
Every single client released in the wild makes use of the obfuscated protocol, which is why my server should be able to operate with them out of the box.<br>
With that said though, anyone at any time can refactor a client so that it only uses big endian and then modify the plugin file accordingly.</p>
<p>Regarding the value’s sign, no. Think about it for a second – if -128 is cast to an unsigned short, what will the value equal? Ballpark answer: somewhere around 65500. That’s certainly not a valid absolute x value for use on runescape’s world map.</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/meiscooldude.html'><span itemprop='name'>meiscooldude</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-16T06:24:52Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:13:30Z' class='post-time'>
              August 1, 2016, 11:13am
            </time>
        <span itemprop='position'>#38</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Lothy, post:25, topic:384832”]Boils down to a few things:</p>
<p>a) I’ve never written anything non-trivial in C (or C++ - but I don’t like C++ enough to use it)<br>
b) I wanted to change this, because I was sick of being one of these newfag programmers that ONLY uses C#/Java. Both of these languages are quite good (although now that I’ve come into function pointers, the lack of them in java pisses me off a lot), but using them exclusively is pretty bad imo.<br>
c) Because I wanted to see a server that made use of Lua for scripting<br>
d) The RS emulation scene deserves a native solution just like the WoW scene<br>
e) Because I’m a mushroom cloud laying motherfucker, motherfucker![/quote]</p>
<p>=D!</p>
<p>Edit:</p>
<p>Just happy to see something like this</p>
      </div>

      <meta itemprop='headline' content='My C server so far'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="384832.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/my-c-server-so-far/384832?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:10 GMT -->
</html>
