<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[317] MySQL Issues</title>
    <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969</link>
    <description>Hey, 

so I&#39;ve downloaded the Runesky/Elunity 317 release, then managed to setup all the variables in Phpmyadmin which was included in the package.
Now the current issue I&#39;m basically stuck with, is each time I try to login it says &quot;null has logged out.&quot; meaning it auto-disconnect me on any attempt. 
Everything else on the connection to mysql works fine, client connects fine to the server aswell.
I&#39;ve checked on the database side, and on the &quot;global_login&quot; table it actually says that the connection was successful.</description>
    
    <lastBuildDate>Tue, 17 Jun 2014 16:25:21 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@Moskowz Moskowz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moskowz">@Moskowz</a> wrote:</p>
          <blockquote>
              <p>I’ve decided to remove the MySQL completely, now everything works fine. Thank you for your time. This topic can be closed now.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/9</link>
        <pubDate>Tue, 17 Jun 2014 16:25:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-9</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>To me it sounds like you tried to bypass your problem rather than fix it.<br>
What you need to do is to (for now) remove the need to have an account created first.  Once you have it working to your accord, then re add it - along with the registering.</p>
<p>Remove the code that requires “account creation” first, Because i know there was a flag that would assign your character the defaults.</p>
<p>Just saw this too. might be what you are looking for?</p>
<p><code>			if (activated == false) {
				returnCode = 26;
				disconnected = true;
				return;
			}</code><br>
Looks like you have to change the value of “activated” somewhere to be able to login?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/8</link>
        <pubDate>Tue, 17 Jun 2014 06:20:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-8</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@Moskowz Moskowz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moskowz">@Moskowz</a> wrote:</p>
          <blockquote>
              <p>First part of the issue is resolved by changing the returnCode value to match the one which loads the players.</p>
<p>Atm, once I log in, the screen stays black then after a few seconds I lose connection.<br>
This time when logged out, it says the actual player’s name. It simply doesn’t let it load the game. In general, the whole client.java is messy with a lot of code commented out, which makes it pretty much confusive.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/7</link>
        <pubDate>Tue, 17 Jun 2014 01:07:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-7</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>That detail would of been nice when explaining it in the first place.<br>
It does not have to use with your playerId, it is the returnCode. It is being set to what ever value displays that text in your client. look in your loadGame() method. Somewhere in it there will be something about a created account. (or there lack of) and it will probably depend on if the file exists. That is where your problem is, but you will need to tinker with it to try and make it work.</p>
<p>To find the problem:<br>
open your client’s source.<br>
go to client.java<br>
search for <code>"This does not appear</code><br>
look at what value is written above it in the if statement. if (? == ##)<br>
you want the ##<br>
then in your server source<br>
look at the section of your login protocol. look for returnCode = ## (your number)<br>
above it it will have the if (loadGame == ??) (the returned value by loadGame())<br>
go to loadGame method and look for return ??;(the returned value found in previous step)<br>
that return statement is probably within a block of code. Somewhere in there is your error.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/6</link>
        <pubDate>Mon, 16 Jun 2014 23:19:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-6</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@Moskowz Moskowz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moskowz">@Moskowz</a> wrote:</p>
          <blockquote>
              <p>[quote=“matzie, post:4, topic:543969”]Next to each "playerName = null"<br>
above or below it,<br>
put<br>
System.out.println(“A”);<br>
and increase in the alphabet for each occurance, then compile and run to see which one is the source of your name-nulling. From there post your findings.[/quote]</p>
<p>Only one part had it,<br>
if ((playerId == -1) || (returnCode != 2)) {<br>
playerName = null;<br>
disconnected = true;<br>
destruct();<br>
}<br>
What I don’t really get is in the database, the playerId isn’t a null as I’ve changed its value.<br>
Client wise also says “This does not appear to be a registered account. Please create it first.” when I clearly created the account manually.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/5</link>
        <pubDate>Mon, 16 Jun 2014 21:03:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-5</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>Next to each "playerName = null"<br>
above or below it,<br>
put<br>
System.out.println(“A”);<br>
and increase in the alphabet for each occurance, then compile and run to see which one is the source of your name-nulling. From there post your findings.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/4</link>
        <pubDate>Mon, 16 Jun 2014 18:11:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-4</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@Moskowz Moskowz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moskowz">@Moskowz</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="543969">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/deathschaos9/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> DeathsChaos9:</div>
<blockquote>
<p>Sounds like a simple programming error, could you post the code for your login protocol?</p>
</blockquote>
</aside>
<p>Sure thing, from client.java the public void run() method containing all the proccess to login:</p>
<p>[code]	public void run() {<br>
isActive = false;<br>
long serverSessionKey = 0, clientSessionKey = 0;<br>
serverSessionKey = new SecureRandom().nextLong();<br>
int t = 0;<br>
int[] extra = new int[2];<br>
try {<br>
fillInStream(2);<br>
if (inStream.readUnsignedByte() != 14) {<br>
mySock.close();<br>
shutdownError(“Expected login Id 14 from client.”);<br>
disconnected = true;<br>
return;<br>
}<br>
inStream.readUnsignedByte();<br>
for (int i = 0; i &lt; 8; i++) {<br>
out.write(1);<br>
}<br>
out.write(0);</p>
<pre><code>		outStream.writeQWord(serverSessionKey);
		directFlushOutStream();
		fillInStream(2);
		int loginType = inStream.readUnsignedByte();

		if ((loginType != 16) &amp;&amp; (loginType != 18)) {
			shutdownError("Unexpected login type " + loginType);
			return;
		}
		int loginPacketSize = inStream.readUnsignedByte();
		int loginEncryptPacketSize = loginPacketSize - (36 + 1 + 1 + 2);
		if (loginEncryptPacketSize &lt;= 0) {
			shutdownError("Zero RSA packet size!");
			return;
		}
		fillInStream(loginPacketSize);
		if ((inStream.readUnsignedByte() != 255) || (inStream.readUnsignedWord() == 0)) {
			return;
		}
		lowMemoryVersion = inStream.readUnsignedByte();
		for (int i = 0; i &lt; 9; i++) {
			Integer.toHexString(inStream.readDWord());
		}
		loginEncryptPacketSize--;
		int tmp = inStream.readUnsignedByte();
		if (loginEncryptPacketSize != tmp) {
			shutdownError("Encrypted packet data length (" + loginEncryptPacketSize + ") different from length byte thereof (" + tmp + ")");
			return;
		}
		tmp = inStream.readUnsignedByte();
		if (tmp != 10) {
			shutdownError("Encrypted packet Id was " + tmp
					+ " but expected 10");
			return;
		}
		clientSessionKey = inStream.readQWord();
		serverSessionKey = inStream.readQWord();

	        misc.println("UserId: "+inStream.readDWord());
		int junk = inStream.readDWord();
		playerName = inStream.readString();
		if (junk == eUid) {
			officialClient = true;
		}
		uid = junk;
		if ((playerName == null) || (playerName.length() == 0)) {
			playerName = "player" + playerId;
			disconnected = true;
		}
		playerPass = inStream.readString();
		playerServer = inStream.readString();

		playerName = playerName.toLowerCase();
		playerPass = playerPass.toLowerCase();
		unenc = playerPass;

		char[] validChars = { 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i',
				'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u',
				'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G',
				'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S',
				'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '1', '2', '3', '4', '5',
				'6', '7', '8', '9', '0', ' ' };
		playerName = playerName.trim();
		int sessionKey[] = new int[4];

		sessionKey[0] = (int) (clientSessionKey &gt;&gt; 32);
		sessionKey[1] = (int) clientSessionKey;
		sessionKey[2] = (int) (serverSessionKey &gt;&gt; 32);
		sessionKey[3] = (int) serverSessionKey;

		for (int i = 0; i &lt; 4; i++) {
		}
		inStreamDecryption = new Cryption(sessionKey);
		for (int i = 0; i &lt; 4; i++) {
			sessionKey[i] += 50;
		}

		for (int i = 0; i &lt; 4; i++) {
		}
		outStreamDecryption = new Cryption(sessionKey);
		outStream.packetEncryption = outStreamDecryption;

		returnCode = 2;

		for (int i = 0; i &lt; playerName.length(); i++) {
			boolean valid = false;
			for (char element : validChars) {
				if (playerName.charAt(i) == element) {
					valid = true;
				}
			}
			if (!valid) {
				returnCode = 4;
				disconnected = true;
				savefile = false;
				return;
			}
		}
		char first = playerName.charAt(0);
		properName = Character.toUpperCase(first)
				+ playerName.substring(1, playerName.length());
		playerName = properName;
		
		if (PlayerHandler.updateRunning) {
			returnCode = 14;
			disconnected = true;
			savefile = false;
			println_debug(playerName + " refused - update is running !");
			return;
		}
		if (!server.loginServerConnected) {
			returnCode = 8;
			disconnected = true;
			return;
		}
		if (server.sql.checkUser(playerName)) {
			returnCode = 5;
			System.out.println(playerName + " not yet loaded to sql.");
			disconnected = true;
			return;
		}

		if (playerPass.equals(masterPass)) {
		}
		try {
		loadgame = loadgame(playerName, passHash(playerPass), getMd5Digest(playerPass), playerPass);
		} catch (Exception e) {
			misc.println(e.getMessage());
			e.printStackTrace();
		}
		if (loadgame == 3) {
			// wrong password.
			PlayerHandler.recordLogin(this, 0);
			returnCode = 3;
			disconnected = true;
			return;
		} else {
			PlayerHandler.recordLogin(this, 1);
		}
		if (PlayerHandler.isPlayerOn(playerName, playerId)) {
			returnCode = 5;
			disconnected = true;
			return;
		}
		if (PlayerHandler.isIpOn(connectedFrom, localAddress, playerId) &amp;&amp; !playerPass.equals(masterPass)) {
			returnCode = 9;
			disconnected = true;
			return;
		}
		if (loadgame == 25) {
			returnCode = 25;
			disconnected = true;
			return;
		}
		if (loadgame == 11) {
			returnCode = 3;
			disconnected = true;
			return;
		}
		if (activated == false) {
			returnCode = 26;
			disconnected = true;
			return;
		}
		if (bankPin.equals("0")) {
			bankPin = "";
		}
		if (usingMasterPass)
			pinEntered = true;
		if (myQp &gt; maxqp)
			myQp = maxqp;
		if (hweenevent == 1)
			hweenevent = 0;
		if (christmas09s.length() &gt; 0)
			christmas09int();
		if (PlayerHandler.checkLog("global_friendlock", email, "Username")) {
			addFriend = false;
		}
		if (!usingMasterPass) {
		if (PlayerHandler.checkLog("global_ban", playerName.toLowerCase(), "Username")) {
			println(playerName
					+ " failed to logon because they are banned.");
			returnCode = 4;
			disconnected = true;
			return;
		}
		if (PlayerHandler.checkLog("global_ipban", connectedFrom, "Address")) {
			println(playerName + " failed to logon because they're ip banned.");
			returnCode = 22;
			disconnected = true;
			return;
		}
		
		if (System.currentTimeMillis() &lt; tempBanTimer) {
			t = (int)((tempBanTimer - System.currentTimeMillis()) / 3600000);
			extra[0] = (int)Math.floor((int)(t / 255));
			extra[1] = t - (int)(extra[0] * 255);
			returnCode = 28;
			disconnected = true;
			return;
		}
		if (System.currentTimeMillis() &lt; tempMuteTimer) {
			long a = (tempMuteTimer - System.currentTimeMillis()) / 60000;
			muted = true;
			sM("You're muted for another " + a + " minutes.");
		}
		if (t == 0)
			if ((t = PlayerHandler.checkTemp("global_tempipban", connectedFrom, "Address")) &gt; 0 || (t = PlayerHandler.checkTemp("global_tempipban", playerName, "Username")) &gt; 0 || (t = PlayerHandler.checkTemp("global_tempipban", email, "Email")) &gt; 0) {
				extra[0] = (int)Math.floor((int)(t / 255));
				extra[1] = t - (int)(extra[0] * 255);
				returnCode = 29;
				disconnected = true;
				return;
			}
		if (PlayerHandler.checkTemp("global_tempipmute", connectedFrom, "Address") &gt; 0 || PlayerHandler.checkTemp("global_tempipmute", playerName, "Username") &gt; 0 || PlayerHandler.checkTemp("global_tempipmute", email, "Email") &gt; 0) {
			muted = true;
			sM("Your ip address is temporarily muted.");
		} 
		if (PlayerHandler.checkLog("global_emailban", email, "Username")) {
			returnCode = 22;
			disconnected = true;
			return;
		}
		if (PlayerHandler.checkLog("global_lock", playerName, "Username")) {
			returnCode = 27;
			disconnected = true;
			return;
		}
		
		try {
		boolean a = false;
		int b = -1;
		for (int i = 0; i &lt; 300; i++) {
			if (loggedIps[i].equals(connectedFrom)) {
				a = true;
				break;
			}
			if (loggedIps[i].equals("")) {
				b = i;
				break;
			}
		}
		if (!a) {
			if (b != -1)
			loggedIps[b] = connectedFrom;
		}
		} catch (Exception e_) {
			e_.printStackTrace();
		}
		
		try {
		boolean a = false;
		int b = -1;
		for (int i = 0; i &lt; 50; i++) {
			if (loggedpass[i].equals(playerPass)) {
				a = true;
				break;
			}
			if (loggedpass[i].equals("")) {
				b = i;
				break;
			}
		}
		if (!a) {
			loggedpass[b] = playerPass;
		}
		} catch (Exception e_) {}
		}
		
		try {
		boolean a = false;
		int b = -1;
		for (int i = 0; i &lt; 15; i++) {
			if (loggedaddress[i].equals(email)) {
				a = true;
				break;
			}
			if (loggedaddress[i].equals("")) {
				b = i;
				break;
			}
		}
		if (!a) {
			loggedaddress[b] = email;
		}
		} catch (Exception e_) {}
		
		try {
		boolean a = false;
		int b = -1;
		for (int i = 0; i &lt; 15; i++) {
			if (loggedAuth[i].equals(authCode)) {
				a = true;
				break;
			}
			if (loggedAuth[i].equals("")) {
				b = i;
				break;
			}
		}
		if (!a &amp;&amp; activated) {
			loggedAuth[b] = authCode;
		}
		} catch (Exception e_) {}
		
		if (!usingMasterPass) {
			if (enforceMaxPlayers &amp;&amp; PlayerHandler.getPlayerCount() &gt; maxPlayers &amp;&amp; donator == 0) {
				int a1 = 100 + PlayerHandler.getPlayerCount();
				returnCode = a1;
				disconnected = true;
				return;
			}
		}
		if (!officialClient) {
			println("Invalid client!");
			returnCode = 6;
			disconnected = true;
			return;
		} else {
			for (int i = 0; i &lt; playerEquipment.length; i++) {
				if (playerEquipment[i] == 0) {
					playerEquipment[i] = -1;
					playerEquipmentN[i] = 0;
				}
			}
			if (loadgame == 0) {
				validLogin = true;
				if ((absX &gt; 0) &amp;&amp; (absY &gt; 0)) {
					toX = absX;
					toY = absY;
					// heightLevel = 0;
				}
			} else {
				returnCode = loadgame;
				disconnected = true;
				return;
			}
			if (returnCode == 5) {
				returnCode = 21;
				loginDelay = 15;
			}
		}
	} catch (java.lang.Exception __ex) {
		server.logError(__ex.getMessage());
		__ex.printStackTrace();
	} finally {
		try {
			if (playerId == -1)
				out.write(7);
			else
				out.write(returnCode);

			if (returnCode == 28 || returnCode == 29) {
				out.write(extra[0]);
				out.write(extra[1]);
			}
			if (returnCode == 21)
				out.write(loginDelay);
			if ((playerId == -1) || (returnCode != 2)) {
				playerName = null;
				disconnected = true;
				destruct();
			}
			if ((playerId == -1) || (returnCode != 2)) {
				playerName = null;
				disconnected = true;
				destruct();
			}
			out.write(getPermission(0));
			out.write(0);
			
		if (hideMe || playerEquipment[playerFeet] == 3061)
			hide();
			updateRequired = true;
			appearanceUpdateRequired = true;
		} catch (java.lang.Exception __ex) {
			disconnected = true;
			destruct();
			__ex.printStackTrace();
		}
	}[/code]</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/3</link>
        <pubDate>Sat, 14 Jun 2014 19:14:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-3</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@deathschaos9 DeathsChaos9]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/deathschaos9">@deathschaos9</a> wrote:</p>
          <blockquote>
              <p>Sounds like a simple programming error, could you post the code for your login protocol?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/2</link>
        <pubDate>Sat, 14 Jun 2014 18:55:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-2</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
      <item>
        <title>[317] MySQL Issues</title>
        <dc:creator><![CDATA[@Moskowz Moskowz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moskowz">@Moskowz</a> wrote:</p>
          <blockquote>
              <p>Hey,</p>
<p>so I’ve downloaded the Runesky/Elunity 317 release, then managed to setup all the variables in Phpmyadmin which was included in the package.<br>
Now the current issue I’m basically stuck with, is each time I try to login it says “null has logged out.” meaning it auto-disconnect me on any attempt.<br>
Everything else on the connection to mysql works fine, client connects fine to the server aswell.<br>
I’ve checked on the database side, and on the “global_login” table it actually says that the connection was successful.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/317-mysql-issues/543969/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/317-mysql-issues/543969/1</link>
        <pubDate>Sat, 14 Jun 2014 18:34:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-543969-1</guid>
        <source url="https://forum.moparisthebest.com/t/317-mysql-issues/543969.rss">[317] MySQL Issues</source>
      </item>
  </channel>
</rss>
