<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/control-flow/404461 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 23:00:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Control flow? - Runescape - moparisthebest.com</title>
    <meta name="description" content="Ok, so I&amp;#39;m having a hard time understanding control flow and how to fix it.  I was talking to someone on IRC and they were telling me to locate a boolean in the client class,  and find all the calls to it.  He then said &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="404461.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Control flow?&#39;" href="404461.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/control-flow/404461" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/control-flow/404461" />
<meta property="og:title" content="Control flow?" />
<meta name="twitter:title" content="Control flow?" />
<meta property="og:description" content="Ok, so I’m having a hard time understanding control flow and how to fix it.  I was talking to someone on IRC and they were telling me to locate a boolean in the client class,  and find all the calls to it.  He then said to grab the id of the next istore, and find all the iloads calling that variable.  He told me that if the next instruction is an ifne, just delete the iload and the ifne, and if the next instruction is an ifeq, delete the iload, ifeq, and everything between that and what the ifeq..." />
<meta name="twitter:description" content="Ok, so I’m having a hard time understanding control flow and how to fix it.  I was talking to someone on IRC and they were telling me to locate a boolean in the client class,  and find all the calls to it.  He then said to grab the id of the next istore, and find all the iloads calling that variable.  He told me that if the next instruction is an ifne, just delete the iload and the ifne, and if the next instruction is an ifeq, delete the iload, ifeq, and everything between that and what the ifeq..." />
<meta property="article:published_time" content="2011-07-16T04:52:28+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="404461.html">Control flow?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/m.html'><span itemprop='name'>m.dog311</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-16T04:52:28Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:13:35Z' class='post-time'>
              August 1, 2016,  1:13pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Ok, so I’m having a hard time understanding control flow and how to fix it.  I was talking to someone on IRC and they were telling me to locate a boolean in the client class,  and find all the calls to it.  He then said to grab the id of the next istore, and find all the iloads calling that variable.  He told me that if the next instruction is an ifne, just delete the iload and the ifne, and if the next instruction is an ifeq, delete the iload, ifeq, and everything between that and what the ifeq jumps to.   At first, that sounded like it would be the right thing to do, but then I noticed massive jumps like</p>
<p>//   51: ifeq +122 -&gt; 173</p>
<p>Which would jump to instruction 173, correct?  Not only that, but there appears to be useful stuff actually happening in that space.  So, can someone enlighten me on this?</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-16T05:48:09Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:13:37Z' class='post-time'>
              August 1, 2016,  1:13pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>whoever you talk to is an idiot<br>
i’ve posted about this before, find the thread</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sspoke.html'><span itemprop='name'>sspoke</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-18T00:06:19Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:16:19Z' class='post-time'>
              August 1, 2016,  1:16pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I may be wrong but you can get rid of all the guess work by loading up JBE (Java Bytecode Editor) and clicking on the green Label… it will auto jump for you and you can see where it jumps too… (line number) and (inustruction number)</p>
<p>pretty much<br>
//   51: ifeq +122 -&gt; 173</p>
<p>means it will jump to instruction number 122. not line 173… hell this instruction 122 could even be on line 90 for all you know.</p>
<p>This isn’t a problem if you want to fix control flow and such just cast to BranchInstruction (BCEL) and call method getTargetInstrIndex… then you could do fancy stuff like…</p>
<p>setTargetInstrIndex(getTargetInstrIndex+1) or<br>
setTargetInstrIndex(getTargetInstrIndex - 20)</p>
<p>etc… you get the point.</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/abraham2119.html'><span itemprop='name'>abraham2119</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-18T00:57:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:16:22Z' class='post-time'>
              August 1, 2016,  1:16pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>umm…+122 is referring to the branch’s jump target offset…</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-18T01:33:38Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:16:25Z' class='post-time'>
              August 1, 2016,  1:16pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>mdog what zkm does is introduce opaque predicates to turn your unconditional branches i.e. gotos into conditional ones, specifically ifeq. it introduces one or more fields (i think most people here are only familiar with runescape which iirc uses one they call the control field) which have a runtime apparent value of 0, however this is not so easily deducible using a non-static white-box analysis where the fields are indeed used and modified in dead code that is not reached during normal control flow. they replace goto instructions with ifne instructions that operate on the values of these “flow obstructor” fields. if you know anything about what these instructions do you’ll see the switch is valid and both instructions will have the same outcome:<br>
goto is a simple jump<br>
ifeq pops the top stack word and compares it to 0, if it is it jumps<br>
the constraint here is that the obstructors are ALWAYS 0 therefore you can rewrite it again as a goto<br>
unfortunately jad and jode don’t realize this and instead see a garbled mess of control flow that can’t be matched to source code constructs<br>
oh, thought i’d mention zkm also inserts random ifnes on these obstructors as well, which are effectively nops but also indeed help prevent decompilers from translating back into source code</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/03data.html'><span itemprop='name'>03data</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-29T22:48:05Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:37:35Z' class='post-time'>
              August 1, 2016,  1:37pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sspoke, post:3, topic:404461”]I may be wrong but you can get rid of all the guess work by loading up JBE (Java Bytecode Editor) and clicking on the green Label… it will auto jump for you and you can see where it jumps too… (line number) and (inustruction number)</p>
<p>pretty much<br>
//   51: ifeq +122 -&gt; 173</p>
<p>means it will jump to instruction number 122. not line 173… hell this instruction 122 could even be on line 90 for all you know.</p>
<p>This isn’t a problem if you want to fix control flow and such just cast to BranchInstruction (BCEL) and call method getTargetInstrIndex… then you could do fancy stuff like…</p>
<p>setTargetInstrIndex(getTargetInstrIndex+1) or<br>
setTargetInstrIndex(getTargetInstrIndex - 20)</p>
<p>etc… you get the point.[/quote]</p>
<p>BCEL works a bit different from my lib; you either gotta set the bytecode offset or the target instruction. I don’t think you can directly set the target instruction index.</p>
      </div>

      <meta itemprop='headline' content='Control flow?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/control-flow/404461 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 23:00:51 GMT -->
</html>
