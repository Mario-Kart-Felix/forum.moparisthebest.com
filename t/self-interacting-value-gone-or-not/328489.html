<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/self-interacting-value-gone-or-not/328489 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 01:38:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>&quot;self-interacting&quot; value, gone or not? - Runescape - moparisthebest.com</title>
    <meta name="description" content="From what I can tell after looking at RSbot/Kbot sources, the &amp;quot;self-interacting&amp;quot; value is used to determine wether or not the player is interacting with himself, and change the offset into the character-array accordingly&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="328489.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;&quot;self-interacting&quot; value, gone or not?&#39;" href="328489.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/self-interacting-value-gone-or-not/328489" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/self-interacting-value-gone-or-not/328489" />
<meta property="og:title" content="&quot;self-interacting&quot; value, gone or not?" />
<meta name="twitter:title" content="&quot;self-interacting&quot; value, gone or not?" />
<meta property="og:description" content="From what I can tell after looking at RSbot/Kbot sources,  the “self-interacting” value is used to determine wether or not the player is interacting with himself,  and change the offset into the character-array accordingly (to index 2047, for some reason I didn’t figure out yet).  Taken from RSbot code, this method pretty much explains itself:  (PS:  Should anyone from RSBot read this, the “else if” is redundant)  public RSCharacter getInteracting() {  		final int interact = c.getInteracting(); ..." />
<meta name="twitter:description" content="From what I can tell after looking at RSbot/Kbot sources,  the “self-interacting” value is used to determine wether or not the player is interacting with himself,  and change the offset into the character-array accordingly (to index 2047, for some reason I didn’t figure out yet).  Taken from RSbot code, this method pretty much explains itself:  (PS:  Should anyone from RSBot read this, the “else if” is redundant)  public RSCharacter getInteracting() {  		final int interact = c.getInteracting(); ..." />
<meta property="article:published_time" content="2010-02-06T18:17:04+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="328489.html">&quot;self-interacting&quot; value, gone or not?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/DarKcookie.html'><span itemprop='name'>DarKcookie</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-02-06T18:17:04Z'>
            <time itemprop='dateModified' datetime='2016-07-31T14:34:56Z' class='post-time'>
              July 31, 2016,  2:34pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>From what I can tell after looking at RSbot/Kbot sources,<br>
the “self-interacting” value is used to determine wether or not the player is interacting with himself,<br>
and change the offset into the character-array accordingly (to index 2047, for some reason I didn’t figure out yet).</p>
<p>Taken from RSbot code, this method pretty much explains itself:<br>
(PS:  Should anyone from RSBot read this, the “else if” is redundant)</p>
<pre><code class="lang-auto">public RSCharacter getInteracting() {

		final int interact = c.getInteracting();
		if (interact == -1)
			return null;

		if (interact &lt; 32768)
			return new org.rsbot.script.wrappers.RSNPC(Bot.getClient().getRSNPCArray()[interact]);
		else if (interact &gt;= 32768) {
			int index = interact - 32768;
			//   ANNOYING COMMENT USED AS A POINTER TO THE RELEVANT PART
			if (index == Bot.getClient().getSelfInteracting()) {
				index = 2047;
			}

			return new org.rsbot.script.wrappers.RSPlayer(Bot.getClient().getRSPlayerArray()[index]);
		}

		return null;
	}</code></pre>
<p>So I set out to locate the actual field, find out it’s supposed to be “client.mb” (iirc) and discover that that field is actually the ‘control field’, used to (… better stfu here, have no real clue about the obfuscation atm)</p>
<p>Seeing as this value will always be 0 (in the current <span class="hashtag">#582</span>), it has to be an error. So I travel back in time, to KBot <span class="hashtag">#554</span> and see that he/they hook field “af.h”, which makes perfect sense given this extract …</p>
<pre><code class="lang-auto">        a++;
        if(i1 != 2)
            return;
        if(uf1.Tb == 0)
            return;
        qi1 = uf1.b(-1399);
        if(~uf1.rb != 0 &amp;&amp; uf1.rb &lt; 32768)
        {
            vd vd = ih.E[uf1.rb];
            if(vd != null)
            {
                int i2 = -((uf) (vd)).u + uf1.u;
                int l2 = -((uf) (vd)).yb + uf1.yb;
                if(~i2 != -1 || ~l2 != -1)
                    uf1.Db = (int)(Math.atan2(i2, l2) * 325.94900000000001D) &amp; 0x7ff;
            }
        }
        if(~uf1.rb &lt;= -32769)
        {
            int j1 = uf1.rb - 32768;
            //   ANNOYING COMMENT USED AS A POINTER TO THE RELEVANT PART
            if(~j1 == ~af.h)
                j1 = 2047;
            dl dl1 = rj.C[j1];
            if(dl1 != null)
            {
                int i3 = -((uf) (dl1)).u + uf1.u;
                int l3 = -((uf) (dl1)).yb + uf1.yb;
                if(~i3 != -1 || l3 != 0)
                    uf1.Db = (int)(325.94900000000001D * Math.atan2(i3, l3)) &amp; 0x7ff;
            }
        }</code></pre>
<p>Seems easy enough to find that one. Even I should be able to hook that. So I locate the corresponding <span class="hashtag">#582</span> method, and this is what I get:</p>
<pre><code class="lang-auto">        if(bn1.wb == 0)
            return 0;
        if(~bn1.sb != 0)
        {
            Object obj = null;
            if(~bn1.sb &gt; -32769)
                obj = pn.u[bn1.sb];
            else
            if(bn1.sb &gt;= 32768)
                obj = tb.A[-32768 + bn1.sb];
            if(obj != null)
            {
                int i = -((jo) (obj)).h + ((jo) (bn1)).h;
                int k = ((jo) (bn1)).o - ((jo) (obj)).o;
                if(~i != -1 || ~k != -1)
                    bn1.a((byte)-50, 0x3fff &amp; (int)(Math.atan2(i, k) * 2607.5945876176133D));
            }
        }
        if(byte0 != 11)
            a(((bn) (null)), (byte)-26);</code></pre>
<p>So my question is … where did that “check index X, switch to 2047 if …” go?</p>
<p>If you went through the effort of reading all of the above, I’d appreciate any insights on the matter.<br>
Flaming my (undoubted) stupidity is appreciated aswell, as long as somewhere along the line you shed some light on why exactly I’m stupid <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
      </div>

      <meta itemprop='headline' content='&quot;self-interacting&quot; value, gone or not?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/frank.html'><span itemprop='name'>frank</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-02-06T19:39:05Z'>
            <time itemprop='dateModified' datetime='2016-07-31T14:35:01Z' class='post-time'>
              July 31, 2016,  2:35pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>try looking where the value is assigned?</p>
      </div>

      <meta itemprop='headline' content='&quot;self-interacting&quot; value, gone or not?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/DarKcookie.html'><span itemprop='name'>DarKcookie</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-02-06T21:25:21Z'>
            <time itemprop='dateModified' datetime='2016-07-31T14:35:08Z' class='post-time'>
              July 31, 2016,  2:35pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Well I first ran a check to determine all the classes that had a reference to that field,<br>
and ofcourse I ended up with the sipush 2047 being a gift-wrapped opportunity for a hook.</p>
<p>Following your advice, I tracked the (only) assignment of the field:</p>
<pre><code class="lang-auto">        tf.d.t = 0;
        cd.e = tf.d.c((byte)38);
        bi.m = tf.d.c((byte)95);
        ql.i = tf.d.c((byte)30) == 1;
        hm.K = tf.d.c((byte)-112) == 1;
        ri.o = ~tf.d.c((byte)-122) == -2;
        ra.T = tf.d.c((byte)48) == 1;
        vk.c = ~tf.d.c((byte)111) == -2;
        af.h = tf.d.h((byte)51);   // self-interacting value right here
        am.U = tf.d.c((byte)79) == 1;
        wc.i = tf.d.c((byte)104) == 1;</code></pre>
<p>Given the fact that “tf.d” contains an instance of the I/O class that handles packet data,<br>
I think it’s safe to assume that the order of assignments will always be the same (right?),<br>
so I can ‘just’ take the 3rd integer assignment (or something like that) and I have my goodies.</p>
<p>I checked the <span class="hashtag">#578</span> version of the previously mentioned source (no more free advertisement today),<br>
and it appears to return the same field for both “getBaseX” and “getSelfInteracting”.<br>
I don’t see any way how that could possibly be reasonable, so I’ll just assume bot X has flaws.</p>
<p>Final question (for now I’m afraid, many more are bound to arise as I find this deob/hook thing highly entertaining) …<br>
As shown above, the self-interacting value is used in the bot’s code to switch the index into the array.<br>
However the corresponding code in the client seems to have gone missing (or was just removed).<br>
Doesn’t this mean the bot’s code should be modified accordingly?<br>
Or are they relying on the fact that they return some unrelated value so the condition is never met for the switch?</p>
<p>PS:  Ty frank_ for the answer <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='&quot;self-interacting&quot; value, gone or not?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/self-interacting-value-gone-or-not/328489 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 01:38:14 GMT -->
</html>
