<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Issue with hit counter</title>
    <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829</link>
    <description>I was writing my own hit counter for a php application and the damn thing just dosn&#39;t seem to want to work, My guestimation is its because of the way im writing to the sql database. I also track ips which I&#39;m going to be using a cron to truncate the table every evening.

Let me give you a overview of my site layout

$session which is a object given to all users holds a database, and constants object, I know that they are all functioning because it does fine reading and writing other stuff to the database.

[code]	function addHit($id, $ip){ // id represents page id.
		//TBL_hitsip and TBL_hits both refer to tables defined in the constant object.
		$q = &quot;SELECT # FROM &quot;.TBL_hitsip.&quot; WHERE id = &#39;$id&#39; AND ip = &#39;$ip&#39;&quot;;
		$result = mysql_query($q, $this-&gt;connection);
		if($result == null){ //if ip is not on the ip database
			mysql_query(&quot;INSERT INTO &quot;.TBL_hitsip.&quot; (id, ip) VALUES (&#39;$id&#39;, &#39;$ip&#39;)&quot;);
			$q = &quot;SELECT hits FROM quote_hits WHERE id = &#39;$id&#39;&quot;;
			$result = mysql_query($q, $this-&gt;connection);
			$data = mysql_fetch_row($result);
			
			if($data == null){
				$result = mysql_query(&quot;INSERT INTO &quot;.TBL_hits.&quot; (id, hits) VALUES (&#39;$id&#39;, &#39;1&#39;)&quot;);
				return 1;
			}
			else{	
				$data = mysql_fetch_row($result);
				$data[1]=+1;
				mysql_query(&quot;UPDATE &quot;.TBL_hits.&quot; SET hits = &#39;$data[1]&#39; WHERE id = &#39;$id&#39;&quot;);
				return $data[0];			
			}
			
						
		} // if ip is on the ip database
		$q = &quot;SELECT hits FROM &quot;.TBL_hits.&quot; WHERE id = &#39;$id&#39;&quot;;
		$result = mysql_query($q, $this-&gt;connection);
		$data = mysql_fetch_row($result);	
		return $data[0];	
	}	
	
};
[/code]

its writing to the ip table just fine but it will not write to the hits table. Also here is my table structure for both

[code]CREATE TABLE `the_ip_table_not_valid_naming` (
  `id` int(10) NOT NULL,
  `ip` varchar(15) collate utf8_unicode_ci NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `ip` (`ip`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;[/code]

[code]CREATE TABLE `the_hits_table_not_valid_naming` (
  `id` int(10) NOT NULL,
  `hits` int(10) NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `hits` (`hits`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;[/code]</description>
    
    <lastBuildDate>Sun, 25 May 2008 03:45:32 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p><code>
			$query = mysql_query("SELECT `hits` FROM `quote_hits` WHERE `id`='$id'",$this-&gt;connection);
			$data = mysql_num_rows($query);
			if($data &gt; 0){
				$data = mysql_fetch_row($data);
				$data[1]=+1;
				mysql_query("UPDATE `".TBL_hits."` SET `hits`='$data[1]' WHERE `id`='$id'");
				return $data[1];
			} else {
				$result = mysql_query("INSERT INTO `".TBL_hits."` (`id`, `hits`) VALUES ('$id', 1)");
				return 1;
			}</code></p>
<p>Some cleanup. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/12</link>
        <pubDate>Sun, 25 May 2008 03:45:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-12</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@MastrChief MastrChief]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mastrchief">@MastrChief</a> wrote:</p>
          <blockquote>
              <p>You’ll probably want to do it the same way.</p>
<p>[code]<br>
$q = “SELECT <code>hits</code> FROM <code>quote_hits</code> WHERE <code>id</code>=’$id’”;<br>
$result = mysql_query($q, $this-&gt;connection);<br>
$data = mysql_num_rows($result);</p>
<pre><code>		if($data == 0){
			$result = mysql_query("INSERT INTO `".TBL_hits."` (`id`, `hits`) VALUES ('$id', '1')");
			return 1;
		}
		else{	
			$data = mysql_fetch_row($result);
			$data[1]=+1;
			mysql_query("UPDATE `".TBL_hits."` SET `hits`='$data[1]' WHERE `id`='$id'");
			return $data[1];			
		}[/code]</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/11</link>
        <pubDate>Sun, 25 May 2008 02:48:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-11</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>I changed it just for the sake of argument however if its writing the ip to the ip database its not failing on the part where it checks the row, its failing on the part of writing the hit to the database which would be</p>
<pre><code class="lang-auto">			$q = "SELECT `hits` FROM `quote_hits` WHERE `id`='$id'";
			$result = mysql_query($q, $this-&gt;connection);
			$data = mysql_fetch_row($result);
			
			if($data == null){
				$result = mysql_query("INSERT INTO `".TBL_hits."` (`id`, `hits`) VALUES ('$id', '1')");
				return 1;
			}
			else{	
				$data = mysql_fetch_row($result);
				$data[1]=+1;
				mysql_query("UPDATE `".TBL_hits."` SET `hits`='$data[1]' WHERE `id`='$id'");
				return $data[1];			
			}
			
			</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/10</link>
        <pubDate>Sun, 25 May 2008 01:52:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-10</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>mysql_num_rows works off the mysql_query you just executed. It doesn’t requery the database a second time for the rows.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/9</link>
        <pubDate>Sun, 25 May 2008 01:37:52 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-9</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@sppt sppt]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sppt">@sppt</a> wrote:</p>
          <blockquote>
              <p>mysql_num_rows() shouldn’t add a function</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/8</link>
        <pubDate>Sun, 25 May 2008 01:21:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-8</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>I don’t mind doing it that way except that would cause 2 extra querys would it not, and I’m stressing the database enough with the method as is, Do you know if it does add a query or not?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/7</link>
        <pubDate>Sun, 25 May 2008 01:19:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-7</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:5, topic:207829”][quote author=Zachera link=topic=274032.msg2240853#msg2240853 date=1211677548]<br>
$result = mysql_query($q, $this-&gt;connection);<br>
if($result == null){ //if ip is not on the ip database</p>
<p>You’re checking if a mysql_query is null?</p>
<p>I think you should be checking the mysql_num_rows, not if the mysql_query was successful.</p>
<p>$result = mysql_query($q, $this-&gt;connection);<br>
$rows = mysql_num_rows($result);<br>
if($rows == 0){ //if ip is not on the ip database<br>
[/quote]<br>
wouldn’t that be adding another call to the database, I was under the impression that it will return null if it cannot retrieve anything.[/quote]</p>
<p>When you do mysql_num_rows, it checks how many rows were returned. If no rows were found, obviously, the mysql_num_rows value is going to be zero. I would rather check for the amount of rows returned rather than if the query was successful.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/6</link>
        <pubDate>Sun, 25 May 2008 01:12:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-6</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>[quote=“Zachera, post:4, topic:207829”]$result = mysql_query($q, $this-&gt;connection);<br>
if($result == null){ //if ip is not on the ip database</p>
<p>You’re checking if a mysql_query is null?</p>
<p>I think you should be checking the mysql_num_rows, not if the mysql_query was successful.</p>
<p>$result = mysql_query($q, $this-&gt;connection);<br>
$rows = mysql_num_rows($result);<br>
if($rows == 0){ //if ip is not on the ip database[/quote]<br>
wouldn’t that be adding another call to the database, I was under the impression that it will return null if it cannot retrieve anything.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/5</link>
        <pubDate>Sun, 25 May 2008 01:08:25 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-5</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>$result = mysql_query($q, $this-&gt;connection);<br>
if($result == null){ //if ip is not on the ip database</p>
<p>You’re checking if a mysql_query is null?</p>
<p>I think you should be checking the mysql_num_rows, not if the mysql_query was successful.</p>
<p>$result = mysql_query($q, $this-&gt;connection);<br>
$rows = mysql_num_rows($result);<br>
if($rows == 0){ //if ip is not on the ip database</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/4</link>
        <pubDate>Sun, 25 May 2008 01:05:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-4</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>Still no change, It’s a very weird error because its not throwing any exceptions.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/3</link>
        <pubDate>Sun, 25 May 2008 01:00:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-3</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@MastrChief MastrChief]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mastrchief">@MastrChief</a> wrote:</p>
          <blockquote>
              <p>Try</p>
<p>[code]<br>
function addHit($id, $ip){ // id represents page id.<br>
//TBL_hitsip and TBL_hits both refer to tables defined in the constant object.<br>
$q = “SELECT # FROM <code>".TBL_hitsip."</code> WHERE <code>id</code>=’$id’ AND <code>ip</code>=’$ip’”;<br>
$result = mysql_query($q, $this-&gt;connection);<br>
if($result == null){ //if ip is not on the ip database<br>
mysql_query(“INSERT INTO <code>".TBL_hitsip."</code> (<code>id</code>, <code>ip</code>) VALUES (’$id’, ‘$ip’)”);<br>
$q = “SELECT <code>hits</code> FROM <code>quote_hits</code> WHERE <code>id</code>=’$id’”;<br>
$result = mysql_query($q, $this-&gt;connection);<br>
$data = mysql_fetch_row($result);</p>
<pre><code>		if($data == null){
			$result = mysql_query("INSERT INTO `".TBL_hits."` (`id`, `hits`) VALUES ('$id', '1')");
			return 1;
		}
		else{	
			$data = mysql_fetch_row($result);
			$data[1]=+1;
			mysql_query("UPDATE `".TBL_hits."` SET `hits`='$data[1]' WHERE `id`='$id'");
			return $data[0];			
		}
		
					
	} // if ip is on the ip database
	$q = "SELECT `hits` FROM `".TBL_hits."` WHERE `id`='$id'";
	$result = mysql_query($q, $this-&gt;connection);
	$data = mysql_fetch_row($result);	
	return $data[0];	
}[/code]
</code></pre>
<p>I mainly only removed spaces e.g: WHERE id = ‘$id’, because I remember having problems when I had a space there. If it didn’t help, sorry <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=6" title=":confused:" class="emoji" alt=":confused:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/2</link>
        <pubDate>Sun, 25 May 2008 00:56:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-2</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
      <item>
        <title>Issue with hit counter</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>I was writing my own hit counter for a php application and the damn thing just dosn’t seem to want to work, My guestimation is its because of the way im writing to the sql database. I also track ips which I’m going to be using a cron to truncate the table every evening.</p>
<p>Let me give you a overview of my site layout</p>
<p>$session which is a object given to all users holds a database, and constants object, I know that they are all functioning because it does fine reading and writing other stuff to the database.</p>
<p>[code]	function addHit($id, $ip){ // id represents page id.<br>
//TBL_hitsip and TBL_hits both refer to tables defined in the constant object.<br>
$q = “SELECT # FROM “.TBL_hitsip.” WHERE id = ‘$id’ AND ip = ‘$ip’”;<br>
$result = mysql_query($q, $this-&gt;connection);<br>
if($result == null){ //if ip is not on the ip database<br>
mysql_query(“INSERT INTO “.TBL_hitsip.” (id, ip) VALUES (’$id’, ‘$ip’)”);<br>
$q = “SELECT hits FROM quote_hits WHERE id = ‘$id’”;<br>
$result = mysql_query($q, $this-&gt;connection);<br>
$data = mysql_fetch_row($result);</p>
<pre><code>		if($data == null){
			$result = mysql_query("INSERT INTO ".TBL_hits." (id, hits) VALUES ('$id', '1')");
			return 1;
		}
		else{	
			$data = mysql_fetch_row($result);
			$data[1]=+1;
			mysql_query("UPDATE ".TBL_hits." SET hits = '$data[1]' WHERE id = '$id'");
			return $data[0];			
		}
		
					
	} // if ip is on the ip database
	$q = "SELECT hits FROM ".TBL_hits." WHERE id = '$id'";
	$result = mysql_query($q, $this-&gt;connection);
	$data = mysql_fetch_row($result);	
	return $data[0];	
}	
</code></pre>
<p>};<br>
[/code]</p>
<p>its writing to the ip table just fine but it will not write to the hits table. Also here is my table structure for both</p>
<p><code>CREATE TABLE `the_ip_table_not_valid_naming` (
  `id` int(10) NOT NULL,
  `ip` varchar(15) collate utf8_unicode_ci NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `ip` (`ip`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</code></p>
<p><code>CREATE TABLE `the_hits_table_not_valid_naming` (
  `id` int(10) NOT NULL,
  `hits` int(10) NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `hits` (`hits`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/issue-with-hit-counter/207829/1</link>
        <pubDate>Sun, 25 May 2008 00:46:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-207829-1</guid>
        <source url="https://forum.moparisthebest.com/t/issue-with-hit-counter/207829.rss">Issue with hit counter</source>
      </item>
  </channel>
</rss>
