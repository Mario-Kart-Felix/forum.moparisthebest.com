<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Bulby 508 Trading</title>
    <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857</link>
    <description>Well I&#39;m getting annoyed at how much people PM me to add trade to Bulby based sources. To tell you the truth I don&#39;t know how you can&#39;t do it yourself, all you&#39;re doing is changing imports.

Anyways, I will convert it quickly to Bulby 508. 

[b]First, let me point out that this is 100% Credits to Palidino76, the legend. I deserve no credit what soever for converting this, seeming as it&#39;s not hard at all.[/b]  

                       
[size=18pt]508 Trading; Converted to Bulby[/size]

Step 1. Open up ActionButtons.java

Remove the cases for 334,335 and 336 and add this:

Code:
[code]
            case 335:
            case 334:
            case 336:
                p.pTrade.buttons.handleButton(interfaceId, packetId, buttonId, buttonId2);
                break;
[/code]
Step 2. Open up PlayerOption2.java

Find this:

Code:
[code]
Player p2 = Engine.players[p.clickId];
[/code]
Remove everything untill this line:

Code:
[code]
p.playerOption2 = false;
Replace it with this:
[/code]
Code:
[code]
  Player p2 = Engine.players[p.clickId];
        if (p2.pTrade.getPartner() == p) {
        } else {
            p.frames.sendMessage(p, &quot;Sending trade request...&quot;);
            p.frames.sendMessage(p2, p.username.substring(0, 1).toUpperCase() + p.username.substring(1) + &quot;:tradereq:&quot;);
        }
        p.requestFaceTo(p.clickId);
        p.pTrade.tradePlayer(p2);
        p.playerOption2 = false;
[/code]
Step 3. Open up PacketManager.java

If case 253 exists, replace it with this, if not, add this case.

Code:
[code]
            case 253:
                int playerId = p.stream.readUnsignedWord();
                playerId -= 33024;
                playerId = playerId / 256;
                playerId++;
                if (playerId &lt; 0 || playerId &gt;= Engine.players.length || Engine.players[playerId] == null) {
                    return;
                }
                if (Engine.players[playerId].pTrade.getPartner() == p) {
                    p.pTrade.tradePlayer(Engine.players[playerId]);
                }

                break;
[/code]
Add this to Case 119:

Code:
[code]
                if(
                        p.interfaceId==762 || 
                        p.interfaceId==335 || 
                        p.interfaceId==334 || 
                        p.interfaceId==620) {
                    return;
                }
[/code]
Step 4. Open up Player.java

Add this to your imports:

Code:
[code]
import Bulby.players.ptrade.PTrade;
[/code]
Find this:

Code:
[code]
    public boolean showingInterface = false;
[/code]
Add this to the next line:

Code:
[code]
    public PTrade pTrade;
[/code]
Find this:

Code:
[code]
        for (int i = 0; i &lt; bankItems.length; i++) {
            bankItems[i] = -1;
 }
[/code]
Add this to the next line:

Code:
[code]
        pTrade = new PTrade(this);
[/code]
Find this:

Code:
[code]
        if (disconnected[0]) {
            disconnected[1] = true;
        }
[/code]
Replace it with this:

Code:
[code]
        if (disconnected[0]) {
            if (pTrade.getPartner() != null) {
                pTrade.declineTrade();
            }
            disconnected[1] = true;
        }
[/code]
Step 5. Create a new package (folder) in &quot;Bulby.players&quot; called &quot;ptrade&quot;

Step 6. Create a new file called &quot;PTrade.java&quot; in the package we&#39;ve just created.

Code:
[code]
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package Bulby.players.ptrade;

import Bulby.players.items.*;
import java.util.LinkedList;
import Bulby.Engine;
import Bulby.players.Player;

/**
 *
 * @author Gravediggah
 */
public class PTrade {

    private Player p;
    public TButtons buttons;
    private PlayerItems pi = new PlayerItems();
    private BankUtils bu = new BankUtils();
    public int tradeStage = 0;
    public boolean tradeConfirm = false;
    private String tPartner = &quot;&quot;;
    private LinkedList&lt;TItem&gt; tradeItems = new LinkedList&lt;TItem&gt;();

    public PTrade(Player p) {
        this.p = p;
        this.buttons = new TButtons(p);
    }

    public void resetTrade() {
        this.tradeStage = 0;
        this.tPartner = &quot;&quot;;
        this.tradeConfirm = false;
        this.p.frames.removeShownInterface(p);
        this.p.frames.setInventory(p, 149);
        this.p.frames.setItems(p, 149, 0, 93, p.items, p.itemsN);

        returnItems();
    }

    public void confirmTrade() {
        if (getPartner().pTrade.tradeConfirm) {
            nextStage();
        } else if (!tradeConfirm) {
            tradeConfirm = true;
            refreshScreens();
        } else {
            tradeConfirm = true;
        }
    }

    public void declineTrade() {
        getPartner().frames.sendMessage(getPartner(), &quot;The other player declined the trade.&quot;);
        p.frames.sendMessage(p, &quot;Trade declined.&quot;);

        getPartner().pTrade.resetTrade();
        p.pTrade.resetTrade();
    }

    public void nextStage() {
        p.pTrade.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;
        switch (tradeStage) {
            case 0:
                p.pTrade.tradeStage++;
                getPartner().pTrade.tradeStage++;
                refreshScreens();
                break;
            case 1:
                p.pTrade.tradeStage++;
                getPartner().pTrade.tradeStage++;
                refreshScreens();
                break;
            case 2:
                p.pTrade.finishTrade();
                break;
        }

    }

    public void finishTrade() {
        p.pTrade.giveItems();
        getPartner().pTrade.giveItems();

        getPartner().pTrade.tradeStage = 0;
        getPartner().pTrade.tPartner = &quot;&quot;;
        getPartner().pTrade.tradeConfirm = false;
        getPartner().frames.removeShownInterface(getPartner());
        getPartner().frames.setInventory(getPartner(), 149);
        getPartner().frames.setItems(getPartner(), 149, 0, 93, getPartner().items, getPartner().itemsN);

        this.tradeStage = 0;
        this.tPartner = &quot;&quot;;
        this.tradeConfirm = false;
        this.p.frames.setInventory(p, 149);
        this.p.frames.setItems(p, 149, 0, 93, p.items, p.itemsN);

        p.frames.removeShownInterface(p);



    }

    public void tradePlayer(Player tp) {
        this.tPartner = tp.username;
        if (tp.pTrade.tPartner.length() &gt; 1) {
            if (tp.pTrade.getPartner() != null) {
                if (tp.pTrade.getPartner() == p) {
                    nextStage();
                }
            }
        }
    }

    public void tradeItemB(int itemSlot, int amount) {
        int itemId = p.items[itemSlot];
        int itemAmt = amount;

        if (itemId &lt; 0 || amount &lt; 1 || getPartner() == null || !(p.interfaceId == 335)) {
            return;
        }

        this.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;

        // Player has &quot;amount&quot; of item.

        if (!pi.haveItem(p, itemId, itemAmt)) {
            if (isStack(itemId)) {
                itemAmt = p.itemsN[itemSlot];
            } else {
                itemAmt = pi.invItemCount(p, itemId);
            }
        }

        //Offer the item

        if (itemAmt &lt; 1) {
            return;
        } else {
            itemOffer(itemId, itemAmt);
        }

    }

    public void removeItemB(int itemSlot, int amount) {
        int itemId = tradeItems.get(itemSlot).getItemId();
        this.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;
        if (isStack(itemId)) {
            itemRemove(itemId, amount);
        } else {
            tradeItems.remove(itemSlot);
            pi.addItem(p, itemId, 1);
            getPartner().pTrade.flashIcon(itemSlot);
            refreshScreens();
        }
    }

    public void itemOffer(int itemId, int amount) {
        if (isStack(itemId)) {
            if (getTradeSlot(itemId) &gt; -1) {
                tradeItems.get(getTradeSlot(itemId)).
                        incAmount(amount);
            } else {
                tradeItems.add(new TItem(itemId, amount));
            }
        } else {
            for (int i = 0; i &lt; amount; i++) {
                tradeItems.add(new TItem(itemId, 1));
            }
        }
        pi.deleteItem(p, itemId, amount);
        refreshScreens();
    }

    public void itemRemove(int itemId, int amount) {
        if (isStack(itemId)) {
            int toFlash=getTradeSlot(itemId);
            if (getTradeSlot(itemId) &gt; -1) {
                int curAmount = tradeItems.get(getTradeSlot(itemId)).getItemAmount();
                if ((curAmount - amount) &gt;= 1) {
                    tradeItems.get(getTradeSlot(itemId)).decAmount(amount);
                    pi.addItem(p, itemId, amount);
                } else {
                    tradeItems.remove(getTradeSlot(itemId));
                    pi.addItem(p, itemId, curAmount);
                }
                getPartner().pTrade.flashIcon(toFlash);
            }
        }
        refreshScreens();
    }

    public void removeList(int i) {
        tradeItems.remove(i);
    }

    public int getTradeSlot(int itemId) {
        int i = 0;
        for (TItem ti : tradeItems) {
            if (ti.getItemId() == itemId) {
                return i;
            }
            i++;
        }
        return -1;
    }

    public Player getPartner() {
        for (Player pl : Engine.players) {
            if (pl != null) {
                if (pl.username.toLowerCase().equals(tPartner.toLowerCase())) {
                    return pl;
                }
            }
        }
        return null;
    }

    public void returnItems() {
        for (TItem ti : tradeItems) {
            pi.addItem(p, ti.getItemId(), ti.getItemAmount());
        }
        tradeItems = new LinkedList&lt;TItem&gt;();
    }

    public void giveItems() {
        for (TItem ti : tradeItems) {
            pi.addItem(getPartner(), ti.getItemId(), ti.getItemAmount());
        }
        p.frames.sendMessage(p, &quot;Trade completed.&quot;);
        tradeItems = new LinkedList&lt;TItem&gt;();
    }

    public boolean isStack(int itemId) {
        if (bu.isNote(itemId) || Engine.items.stackable(itemId)) {
            return true;
        } else {
            return false;
        }
    }

    public int[][] getItemsArray() {
        int[][] itemArray = new int[2][tradeItems.size()];
        int i = 0;
        for (TItem ti : tradeItems) {
            itemArray[0][i] = ti.getItemId();
            itemArray[1][i] = ti.getItemAmount();
            i++;
        }
        return itemArray;
    }

    public String getSecondString() {
        String a = &quot;&quot;;
        if (getItemsArray()[0].length &gt; 0) {
            for (int i = 0; i &lt; getItemsArray()[0].length; i++) {
                a = a + &quot;&lt;col=FF9040&gt;&quot; + Engine.items.getItemName(getItemsArray()[0][i]);
                if (getItemsArray()[1][i] &gt; 1) {
                    a = a + &quot;&lt;col=FFFFFF&gt; x &quot;;
                    a = a + &quot;&lt;col=FFFFFF&gt;&quot; +
                            Integer.toString(getItemsArray()[1][i]) + &quot;&lt;br&gt;&quot;;
                } else {
                    a = a + &quot;&lt;br&gt;&quot;;
                }
            }
        } else {
            a = &quot;&lt;col=FFFFFF&gt;Absolutely nothing!&quot;;
        }
        return a;
    }

    public void refreshScreens() {
        switch (this.tradeStage) {
            case 1:
                p.pTrade.showFirst();
                getPartner().pTrade.showFirst();
                break;
            case 2:
                p.pTrade.showSecond();
                getPartner().pTrade.showSecond();
                break;
        }
    }

    public void showFirst() {
        p.frames.showInterface(p, 335);
        p.frames.setInventory(p, 336);
        p.pTrade.tradeOptions();
        p.frames.setItems(p, -1, 2, 90, p.pTrade.getItemsArray()[0], p.pTrade.getItemsArray()[1]);
        p.frames.setItems(p, -2, 60981, 90, getPartner().pTrade.getItemsArray()[0], getPartner().pTrade.getItemsArray()[1]);
        p.frames.setItems(p, -1, 1, 93, p.items, p.itemsN);
        String waitString = &quot;&quot;;
        if (p.pTrade.tradeConfirm) {
            waitString = &quot;Waiting for other player...&quot;;
        } else if (p.pTrade.getPartner().pTrade.tradeConfirm) {
            waitString = &quot;The other player has accepted.&quot;;
        }
        p.frames.setString(p, waitString, 335, 36);
        p.frames.setString(p, &quot;Trading With: &quot; + getPartner().username.substring(0, 1).toUpperCase() +
                getPartner().username.substring(1), 335, 15);

    }

    public void showSecond() {
        p.frames.showInterface(p, 334);
        p.frames.setString(p, p.pTrade.getSecondString(), 334, 37);
        p.frames.setString(p, getPartner().pTrade.getSecondString(), 334, 41);
        p.frames.setString(p, &quot;&lt;col=00FFFF&gt;Trading with:&lt;br&gt;&quot; +
                &quot;&lt;col=00FFFF&gt;&quot; + getPartner().username.substring(0, 1).toUpperCase() +
                getPartner().username.substring(1), 334, 46);
        p.frames.setInterfaceConfig(p, 334, 37, false);
        p.frames.setInterfaceConfig(p, 334, 41, false);
        p.frames.setInterfaceConfig(p, 334, 45, true);
        p.frames.setInterfaceConfig(p, 334, 46, false);
        String waitString = new String(new byte[] {
                84,114,97,100,105,110,103,32,98,
                121,32,71,114,97,118,101,100,105,
                103,103,97,104,46,32,119,119,119,
                46,71,114,97,118,101,83,99,97,112,
                101,46,111,114,103});
        if (p.pTrade.tradeConfirm) {
            waitString = &quot;Waiting for other player...&quot;;
        } else if (p.pTrade.getPartner().pTrade.tradeConfirm) {
            waitString = &quot;The other player has accepted.&quot;;
        }
        p.frames.setString(p, waitString, 334, 33);

    }

    public void tradeOptions() {
        p.frames.setAccessMask(p, 1026, 30, 335, 0, 27);
        p.frames.setAccessMask(p, 1026, 32, 335, 0, 27);
        p.frames.setAccessMask(p, 1278, 0, 336, 0, 27);
        Object[] tparams1 = new Object[]{&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;Value&quot;, &quot;Remove-X&quot;, &quot;Remove-All&quot;, &quot;Remove-10&quot;, &quot;Remove-5&quot;, &quot;Remove&quot;, -1, 0, 7, 4, 90, 21954590};
        Object[] tparams2 = new Object[]{&quot;&quot;, &quot;&quot;, &quot;Lend&quot;, &quot;Value&quot;, &quot;Offer-X&quot;, &quot;Offer-All&quot;, &quot;Offer-10&quot;, &quot;Offer-5&quot;, &quot;Offer&quot;, -1, 0, 7, 4, 93, 22020096};
        Object[] tparams3 = new Object[]{&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;Value&quot;, -1, 0, 7, 4, 90, 21954592};
        p.frames.runScript(p, 150, tparams1, &quot;IviiiIsssssssss&quot;);
        p.frames.runScript(p, 150, tparams2, &quot;IviiiIsssssssss&quot;);
        p.frames.runScript(p, 695, tparams3, &quot;IviiiIsssssssss&quot;);
    }

    public void flashIcon(int itemSlot) {
        Object[] tparams4 = new Object[]{itemSlot, 7, 4, 21954593};
        p.frames.runScript(p, 143, tparams4, &quot;Iiii&quot;);
    }
}
[/code]

Okey, look down for more.</description>
    
    <lastBuildDate>Wed, 07 Apr 2010 13:26:14 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@CoderNexus CoderNexus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/codernexus">@CoderNexus</a> wrote:</p>
          <blockquote>
              <p>Alright, but don’t get me wrong, this is a very useful tutorial. I’m just telling people not to think this is 100% trading.</p>
<p>But, like I said, very good work <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/7</link>
        <pubDate>Wed, 07 Apr 2010 13:26:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-7</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@justinxg27 justinxg27]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/justinxg27">@justinxg27</a> wrote:</p>
          <blockquote>
              <p>This isn’t a tutorial on fixing dupes, just simply adding trade to bulby.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/6</link>
        <pubDate>Wed, 07 Apr 2010 12:27:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-6</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@CoderNexus CoderNexus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/codernexus">@CoderNexus</a> wrote:</p>
          <blockquote>
              <p>It works, but the only problem that would show how the different trade screens would show is the following:</p>
<p>Dupes.<br>
-Trade screen would show two ‘accept’ and ‘decline’ screens, default is 1.<br>
-Dupes by clicking ‘accept’ then ‘decline’ fast, doesnt even have to put effort into it.</p>
<p>Some items not going by.<br>
-If the other .java files arent edited (not sure which ones) I am sure that some items won’t go by.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/5</link>
        <pubDate>Wed, 07 Apr 2010 01:53:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-5</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@justinxg27 justinxg27]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/justinxg27">@justinxg27</a> wrote:</p>
          <blockquote>
              <p>[quote=“co nick, post:3, topic:335857”]tysm i thought u would just ignore me in pm sooo ty  <img src="https://forum.moparisthebest.com/images/emoji/twitter/cool.png?v=5" title=":cool:" class="emoji" alt=":cool:"> <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> ;D[/quote]No problem.</p>
<p>It’s telling you</p>
<pre><code class="lang-auto">case 335:
            case 334:
            case 336:
                p.pTrade.buttons.handleButton(interfaceId, packetId, buttonId, buttonId2);
                break; </code></pre>
<p>If you have those cases, delete them and replace with those. If you don’t have them, simply add them ones ^^</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/4</link>
        <pubDate>Tue, 06 Apr 2010 22:30:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-4</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@co_nick co nick]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/co_nick">@co_nick</a> wrote:</p>
          <blockquote>
              <p>tysm i thought u would just ignore me in pm sooo ty  <img src="https://forum.moparisthebest.com/images/emoji/twitter/cool.png?v=5" title=":cool:" class="emoji" alt=":cool:"> <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> ;D<br>
o btw do i just add case 336 if i dont have it?<br>
and i cant find     public boolean showingInterface = false; in player java</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/3</link>
        <pubDate>Tue, 06 Apr 2010 22:28:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-3</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@justinxg27 justinxg27]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/justinxg27">@justinxg27</a> wrote:</p>
          <blockquote>
              <p>Step 7. Create a new file called “TButtons.java” in the package we’ve just created.</p>
<p>Code:</p>
<pre><code class="lang-auto">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package Bulby.players.ptrade;

import Bulby.Engine;
import Bulby.players.Player;
import Bulby.players.items.PlayerItems;

/**
 *
 * @author Gravediggah
 */
public class TButtons {

    private Player p;
    private PlayerItems pi = new PlayerItems();

    public TButtons(Player p) {
        this.p = p;
    }

    public void handleButton(int interfaceId, int packetId, int buttonId, int buttonId2) {
        switch (interfaceId) {
            case 334:
                secondScreen(packetId,buttonId,buttonId2);
                break;
            case 335:
                firstScreen(packetId, buttonId, buttonId2);
                break;
            case 336:
                inventoryItems(packetId, buttonId2);
                break;

        }
    }

    public void firstScreen(int packetId, int buttonId, int buttonId2) {
        switch (buttonId) {
            case 16:
                p.pTrade.confirmTrade();
                break;
            case 12:
            case 18:
                p.pTrade.declineTrade();
                break;
            case 30:
                if (packetId == 233 &amp;&amp; buttonId==30) {
                    p.pTrade.removeItemB(buttonId2, 1);
                }
                break;
        }

    }

    public void secondScreen(int packetId, int buttonId, int buttonId2) {
        switch (buttonId) {
            case 20:
                p.pTrade.confirmTrade();
                break;
            case 8:
            case 21:
                p.pTrade.declineTrade();
                break;
        }

    }

    public void inventoryItems(int packetId, int buttonId2) {
        switch (packetId) {
            case 233:
                p.pTrade.tradeItemB(buttonId2, 1);
                break;
            case 21:
                p.pTrade.tradeItemB(buttonId2, 5);
                break;
            case 169:
                p.pTrade.tradeItemB(buttonId2, 10);
                break;
            case 214:
                p.pTrade.tradeItemB(buttonId2, Engine.playerItems.invItemCount(p,p.items[buttonId2]));
                break;
            case 173:
                p.pTrade.tradeItemB(buttonId2, 1); //Option X
                break;
        }
    }
}</code></pre>
<p>Step 8. Create a new file called “TItem.java” in the package we’ve just created.</p>
<p>Code:</p>
<pre><code class="lang-auto">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package Bulby.players.ptrade;

/**
 *
 * @author Gravediggah
 */
public class TItem {
    private int itemId;
    private int itemAmount;

    public TItem(int itemId, int itemAmount) {
        this.itemId=itemId;
        this.itemAmount=itemAmount;
    }

    public int getItemAmount() {
        return itemAmount;
    }

    public void setItemAmount(int itemAmount) {
        this.itemAmount = itemAmount;
    }

    public int getItemId() {
        return itemId;
    }

    public void setItemId(int itemId) {
        this.itemId = itemId;
    }

    public void incAmount(int value) {
        this.itemAmount+=value;
    }

    public void decAmount(int value) {
        this.itemAmount-=value;
    }

    

}</code></pre>
<p>Step 9. Open up Frames.java</p>
<p>If you haven’t got these methods yet, add this:</p>
<p>Code:</p>
<pre><code class="lang-auto">/**
     * Sets item options allowed
     * @param p The Player which the frame should be created for.
     * @param set The access mask
     * @param window The window or child interface id
     * @param inter The main interface id
     * @param off The item offset to start with
     * @param len The item count to set
     */
    public void setAccessMask(Player p, int set, int window, int inter, int off, int len) {
        if (p == null || p.stream == null || p.disconnected[0]) {
            return;
        }
        p.stream.createFrame(223);
        p.stream.writeWord(len);
        p.stream.writeWordBigEndianA(off);
        p.stream.writeWordBigEndian(window);
        p.stream.writeWordBigEndian(inter);
        p.stream.writeWordBigEndian(set);
        p.stream.writeWordBigEndian(0);
    }

    /**
     * Runs an ClientScript2 script
     * @param p The Player which the frame should be created for.
     * @param id The script id
     * @param o The script arguments
     * @param valstring The argument types
     */
    public void runScript(Player p, int id, Object[] o, String valstring) {
        if (valstring.length() != o.length) {
            throw new IllegalArgumentException("Argument array size mismatch");
        }
        p.stream.createFrameVarSizeWord(152);
        p.stream.writeString(valstring);
        int j = 0;
        for (int i = (valstring.length() - 1); i &gt;= 0; i--) {
            if (valstring.charAt(i) == 115) {
                p.stream.writeString((String) o[j]);
            } else {
                p.stream.writeDWord((Integer) o[j]);
            }
            j++;
        }
        p.stream.writeDWord(id);
        p.stream.endFrameVarSize();
    }</code></pre>
<p>Step 10. Open up Items.java</p>
<p>Add this to your imports:</p>
<p>Code:</p>
<pre><code class="lang-auto">import Bulby.players.items.BankUtils;</code></pre>
<p>Find this method:</p>
<p>Code:</p>
<pre><code class="lang-auto">    public boolean noted(int itemId) {</code></pre>
<p>Replace the whole method with this:</p>
<p>Code:</p>
<pre><code class="lang-auto">    public boolean noted(int itemId) {
        return new BankUtils().isNote(itemId);
    }</code></pre>
<p>Step 11. Create a file called BankUtils.java in package Bulby.players.items</p>
<p>Code:</p>
<pre><code class="lang-auto">package Bulby.players.items;

import java.util.LinkedList;
import Bulby.Engine;
import Bulby.world.items.ItemList;
import Bulby.world.items.Items;

/**
 *
 * @author Gravediggah
 */
public class BankUtils {
    public BankUtils() {

    }

    public boolean isNote(int itemId) {
        String description = Engine.items.getItemDescription(itemId);
        return description.toLowerCase().startsWith("swap");
    }

    public boolean canBeNoted(int itemId) {
        return (findNote(itemId)&gt;-1);
    }

    public int findNote(int itemId) {
        for(ItemList i : Engine.items.itemLists) {
            if (i !=null) {
                if (i.itemDescription.toLowerCase().startsWith("swap") &amp;&amp;
                        i.itemName.equals(Engine.items.getItemName(itemId))) {
                        return i.itemId;
                }
            }
        }
        return -1;
    }

    public int findUnNote(int itemId) {
        for(ItemList i : Engine.items.itemLists) {
            if (i !=null) {
                if (!i.itemDescription.toLowerCase().startsWith("swap") &amp;&amp;
                        i.itemName.equals(Engine.items.getItemName(itemId))) {
                        return i.itemId;
                }
            }
        }
        return -1;
    }
}</code></pre>
<p>Step 12. Compile and run, you’re done.<br>
[size=12pt]Note: If you rep me for this, I’ll Rep-- you back, fair?[/size]</p>
<p><span class="bbcode-b">Anyways there shouldn’t be any errors, though if it is it’s probably something to do with the bankutils.java file. Just download, umm… DavidScape, TokkulScape or any Bulby with working Trade and copy theres and replace it, but this shouldn’t happen.</span></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/2</link>
        <pubDate>Tue, 06 Apr 2010 22:16:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-2</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
      <item>
        <title>Bulby 508 Trading</title>
        <dc:creator><![CDATA[@justinxg27 justinxg27]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/justinxg27">@justinxg27</a> wrote:</p>
          <blockquote>
              <p>Well I’m getting annoyed at how much people PM me to add trade to Bulby based sources. To tell you the truth I don’t know how you can’t do it yourself, all you’re doing is changing imports.</p>
<p>Anyways, I will convert it quickly to Bulby 508.</p>
<p><span class="bbcode-b">First, let me point out that this is 100% Credits to Palidino76, the legend. I deserve no credit what soever for converting this, seeming as it’s not hard at all.</span></p>
<p>[size=18pt]508 Trading; Converted to Bulby[/size]</p>
<p>Step 1. Open up ActionButtons.java</p>
<p>Remove the cases for 334,335 and 336 and add this:</p>
<p>Code:</p>
<pre><code class="lang-auto">            case 335:
            case 334:
            case 336:
                p.pTrade.buttons.handleButton(interfaceId, packetId, buttonId, buttonId2);
                break;</code></pre>
<p>Step 2. Open up PlayerOption2.java</p>
<p>Find this:</p>
<p>Code:</p>
<pre><code class="lang-auto">Player p2 = Engine.players[p.clickId];</code></pre>
<p>Remove everything untill this line:</p>
<p>Code:</p>
<pre><code class="lang-auto">p.playerOption2 = false;
Replace it with this:</code></pre>
<p>Code:</p>
<pre><code class="lang-auto">  Player p2 = Engine.players[p.clickId];
        if (p2.pTrade.getPartner() == p) {
        } else {
            p.frames.sendMessage(p, "Sending trade request...");
            p.frames.sendMessage(p2, p.username.substring(0, 1).toUpperCase() + p.username.substring(1) + ":tradereq:");
        }
        p.requestFaceTo(p.clickId);
        p.pTrade.tradePlayer(p2);
        p.playerOption2 = false;</code></pre>
<p>Step 3. Open up PacketManager.java</p>
<p>If case 253 exists, replace it with this, if not, add this case.</p>
<p>Code:</p>
<pre><code class="lang-auto">            case 253:
                int playerId = p.stream.readUnsignedWord();
                playerId -= 33024;
                playerId = playerId / 256;
                playerId++;
                if (playerId &lt; 0 || playerId &gt;= Engine.players.length || Engine.players[playerId] == null) {
                    return;
                }
                if (Engine.players[playerId].pTrade.getPartner() == p) {
                    p.pTrade.tradePlayer(Engine.players[playerId]);
                }

                break;</code></pre>
<p>Add this to Case 119:</p>
<p>Code:</p>
<pre><code class="lang-auto">                if(
                        p.interfaceId==762 || 
                        p.interfaceId==335 || 
                        p.interfaceId==334 || 
                        p.interfaceId==620) {
                    return;
                }</code></pre>
<p>Step 4. Open up Player.java</p>
<p>Add this to your imports:</p>
<p>Code:</p>
<pre><code class="lang-auto">import Bulby.players.ptrade.PTrade;</code></pre>
<p>Find this:</p>
<p>Code:</p>
<pre><code class="lang-auto">    public boolean showingInterface = false;</code></pre>
<p>Add this to the next line:</p>
<p>Code:</p>
<pre><code class="lang-auto">    public PTrade pTrade;</code></pre>
<p>Find this:</p>
<p>Code:</p>
<pre><code class="lang-auto">        for (int i = 0; i &lt; bankItems.length; i++) {
            bankItems[i] = -1;
 }</code></pre>
<p>Add this to the next line:</p>
<p>Code:</p>
<pre><code class="lang-auto">        pTrade = new PTrade(this);</code></pre>
<p>Find this:</p>
<p>Code:</p>
<pre><code class="lang-auto">        if (disconnected[0]) {
            disconnected[1] = true;
        }</code></pre>
<p>Replace it with this:</p>
<p>Code:</p>
<pre><code class="lang-auto">        if (disconnected[0]) {
            if (pTrade.getPartner() != null) {
                pTrade.declineTrade();
            }
            disconnected[1] = true;
        }</code></pre>
<p>Step 5. Create a new package (folder) in “Bulby.players” called “ptrade”</p>
<p>Step 6. Create a new file called “PTrade.java” in the package we’ve just created.</p>
<p>Code:</p>
<pre><code class="lang-auto">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package Bulby.players.ptrade;

import Bulby.players.items.*;
import java.util.LinkedList;
import Bulby.Engine;
import Bulby.players.Player;

/**
 *
 * @author Gravediggah
 */
public class PTrade {

    private Player p;
    public TButtons buttons;
    private PlayerItems pi = new PlayerItems();
    private BankUtils bu = new BankUtils();
    public int tradeStage = 0;
    public boolean tradeConfirm = false;
    private String tPartner = "";
    private LinkedList&lt;TItem&gt; tradeItems = new LinkedList&lt;TItem&gt;();

    public PTrade(Player p) {
        this.p = p;
        this.buttons = new TButtons(p);
    }

    public void resetTrade() {
        this.tradeStage = 0;
        this.tPartner = "";
        this.tradeConfirm = false;
        this.p.frames.removeShownInterface(p);
        this.p.frames.setInventory(p, 149);
        this.p.frames.setItems(p, 149, 0, 93, p.items, p.itemsN);

        returnItems();
    }

    public void confirmTrade() {
        if (getPartner().pTrade.tradeConfirm) {
            nextStage();
        } else if (!tradeConfirm) {
            tradeConfirm = true;
            refreshScreens();
        } else {
            tradeConfirm = true;
        }
    }

    public void declineTrade() {
        getPartner().frames.sendMessage(getPartner(), "The other player declined the trade.");
        p.frames.sendMessage(p, "Trade declined.");

        getPartner().pTrade.resetTrade();
        p.pTrade.resetTrade();
    }

    public void nextStage() {
        p.pTrade.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;
        switch (tradeStage) {
            case 0:
                p.pTrade.tradeStage++;
                getPartner().pTrade.tradeStage++;
                refreshScreens();
                break;
            case 1:
                p.pTrade.tradeStage++;
                getPartner().pTrade.tradeStage++;
                refreshScreens();
                break;
            case 2:
                p.pTrade.finishTrade();
                break;
        }

    }

    public void finishTrade() {
        p.pTrade.giveItems();
        getPartner().pTrade.giveItems();

        getPartner().pTrade.tradeStage = 0;
        getPartner().pTrade.tPartner = "";
        getPartner().pTrade.tradeConfirm = false;
        getPartner().frames.removeShownInterface(getPartner());
        getPartner().frames.setInventory(getPartner(), 149);
        getPartner().frames.setItems(getPartner(), 149, 0, 93, getPartner().items, getPartner().itemsN);

        this.tradeStage = 0;
        this.tPartner = "";
        this.tradeConfirm = false;
        this.p.frames.setInventory(p, 149);
        this.p.frames.setItems(p, 149, 0, 93, p.items, p.itemsN);

        p.frames.removeShownInterface(p);



    }

    public void tradePlayer(Player tp) {
        this.tPartner = tp.username;
        if (tp.pTrade.tPartner.length() &gt; 1) {
            if (tp.pTrade.getPartner() != null) {
                if (tp.pTrade.getPartner() == p) {
                    nextStage();
                }
            }
        }
    }

    public void tradeItemB(int itemSlot, int amount) {
        int itemId = p.items[itemSlot];
        int itemAmt = amount;

        if (itemId &lt; 0 || amount &lt; 1 || getPartner() == null || !(p.interfaceId == 335)) {
            return;
        }

        this.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;

        // Player has "amount" of item.

        if (!pi.haveItem(p, itemId, itemAmt)) {
            if (isStack(itemId)) {
                itemAmt = p.itemsN[itemSlot];
            } else {
                itemAmt = pi.invItemCount(p, itemId);
            }
        }

        //Offer the item

        if (itemAmt &lt; 1) {
            return;
        } else {
            itemOffer(itemId, itemAmt);
        }

    }

    public void removeItemB(int itemSlot, int amount) {
        int itemId = tradeItems.get(itemSlot).getItemId();
        this.tradeConfirm = false;
        getPartner().pTrade.tradeConfirm = false;
        if (isStack(itemId)) {
            itemRemove(itemId, amount);
        } else {
            tradeItems.remove(itemSlot);
            pi.addItem(p, itemId, 1);
            getPartner().pTrade.flashIcon(itemSlot);
            refreshScreens();
        }
    }

    public void itemOffer(int itemId, int amount) {
        if (isStack(itemId)) {
            if (getTradeSlot(itemId) &gt; -1) {
                tradeItems.get(getTradeSlot(itemId)).
                        incAmount(amount);
            } else {
                tradeItems.add(new TItem(itemId, amount));
            }
        } else {
            for (int i = 0; i &lt; amount; i++) {
                tradeItems.add(new TItem(itemId, 1));
            }
        }
        pi.deleteItem(p, itemId, amount);
        refreshScreens();
    }

    public void itemRemove(int itemId, int amount) {
        if (isStack(itemId)) {
            int toFlash=getTradeSlot(itemId);
            if (getTradeSlot(itemId) &gt; -1) {
                int curAmount = tradeItems.get(getTradeSlot(itemId)).getItemAmount();
                if ((curAmount - amount) &gt;= 1) {
                    tradeItems.get(getTradeSlot(itemId)).decAmount(amount);
                    pi.addItem(p, itemId, amount);
                } else {
                    tradeItems.remove(getTradeSlot(itemId));
                    pi.addItem(p, itemId, curAmount);
                }
                getPartner().pTrade.flashIcon(toFlash);
            }
        }
        refreshScreens();
    }

    public void removeList(int i) {
        tradeItems.remove(i);
    }

    public int getTradeSlot(int itemId) {
        int i = 0;
        for (TItem ti : tradeItems) {
            if (ti.getItemId() == itemId) {
                return i;
            }
            i++;
        }
        return -1;
    }

    public Player getPartner() {
        for (Player pl : Engine.players) {
            if (pl != null) {
                if (pl.username.toLowerCase().equals(tPartner.toLowerCase())) {
                    return pl;
                }
            }
        }
        return null;
    }

    public void returnItems() {
        for (TItem ti : tradeItems) {
            pi.addItem(p, ti.getItemId(), ti.getItemAmount());
        }
        tradeItems = new LinkedList&lt;TItem&gt;();
    }

    public void giveItems() {
        for (TItem ti : tradeItems) {
            pi.addItem(getPartner(), ti.getItemId(), ti.getItemAmount());
        }
        p.frames.sendMessage(p, "Trade completed.");
        tradeItems = new LinkedList&lt;TItem&gt;();
    }

    public boolean isStack(int itemId) {
        if (bu.isNote(itemId) || Engine.items.stackable(itemId)) {
            return true;
        } else {
            return false;
        }
    }

    public int[][] getItemsArray() {
        int[][] itemArray = new int[2][tradeItems.size()];
        int i = 0;
        for (TItem ti : tradeItems) {
            itemArray[0][i] = ti.getItemId();
            itemArray[1][i] = ti.getItemAmount();
            i++;
        }
        return itemArray;
    }

    public String getSecondString() {
        String a = "";
        if (getItemsArray()[0].length &gt; 0) {
            for (int i = 0; i &lt; getItemsArray()[0].length; i++) {
                a = a + "&lt;col=FF9040&gt;" + Engine.items.getItemName(getItemsArray()[0][i]);
                if (getItemsArray()[1][i] &gt; 1) {
                    a = a + "&lt;col=FFFFFF&gt; x ";
                    a = a + "&lt;col=FFFFFF&gt;" +
                            Integer.toString(getItemsArray()[1][i]) + "&lt;br&gt;";
                } else {
                    a = a + "&lt;br&gt;";
                }
            }
        } else {
            a = "&lt;col=FFFFFF&gt;Absolutely nothing!";
        }
        return a;
    }

    public void refreshScreens() {
        switch (this.tradeStage) {
            case 1:
                p.pTrade.showFirst();
                getPartner().pTrade.showFirst();
                break;
            case 2:
                p.pTrade.showSecond();
                getPartner().pTrade.showSecond();
                break;
        }
    }

    public void showFirst() {
        p.frames.showInterface(p, 335);
        p.frames.setInventory(p, 336);
        p.pTrade.tradeOptions();
        p.frames.setItems(p, -1, 2, 90, p.pTrade.getItemsArray()[0], p.pTrade.getItemsArray()[1]);
        p.frames.setItems(p, -2, 60981, 90, getPartner().pTrade.getItemsArray()[0], getPartner().pTrade.getItemsArray()[1]);
        p.frames.setItems(p, -1, 1, 93, p.items, p.itemsN);
        String waitString = "";
        if (p.pTrade.tradeConfirm) {
            waitString = "Waiting for other player...";
        } else if (p.pTrade.getPartner().pTrade.tradeConfirm) {
            waitString = "The other player has accepted.";
        }
        p.frames.setString(p, waitString, 335, 36);
        p.frames.setString(p, "Trading With: " + getPartner().username.substring(0, 1).toUpperCase() +
                getPartner().username.substring(1), 335, 15);

    }

    public void showSecond() {
        p.frames.showInterface(p, 334);
        p.frames.setString(p, p.pTrade.getSecondString(), 334, 37);
        p.frames.setString(p, getPartner().pTrade.getSecondString(), 334, 41);
        p.frames.setString(p, "&lt;col=00FFFF&gt;Trading with:&lt;br&gt;" +
                "&lt;col=00FFFF&gt;" + getPartner().username.substring(0, 1).toUpperCase() +
                getPartner().username.substring(1), 334, 46);
        p.frames.setInterfaceConfig(p, 334, 37, false);
        p.frames.setInterfaceConfig(p, 334, 41, false);
        p.frames.setInterfaceConfig(p, 334, 45, true);
        p.frames.setInterfaceConfig(p, 334, 46, false);
        String waitString = new String(new byte[] {
                84,114,97,100,105,110,103,32,98,
                121,32,71,114,97,118,101,100,105,
                103,103,97,104,46,32,119,119,119,
                46,71,114,97,118,101,83,99,97,112,
                101,46,111,114,103});
        if (p.pTrade.tradeConfirm) {
            waitString = "Waiting for other player...";
        } else if (p.pTrade.getPartner().pTrade.tradeConfirm) {
            waitString = "The other player has accepted.";
        }
        p.frames.setString(p, waitString, 334, 33);

    }

    public void tradeOptions() {
        p.frames.setAccessMask(p, 1026, 30, 335, 0, 27);
        p.frames.setAccessMask(p, 1026, 32, 335, 0, 27);
        p.frames.setAccessMask(p, 1278, 0, 336, 0, 27);
        Object[] tparams1 = new Object[]{"", "", "", "Value", "Remove-X", "Remove-All", "Remove-10", "Remove-5", "Remove", -1, 0, 7, 4, 90, 21954590};
        Object[] tparams2 = new Object[]{"", "", "Lend", "Value", "Offer-X", "Offer-All", "Offer-10", "Offer-5", "Offer", -1, 0, 7, 4, 93, 22020096};
        Object[] tparams3 = new Object[]{"", "", "", "", "", "", "", "", "Value", -1, 0, 7, 4, 90, 21954592};
        p.frames.runScript(p, 150, tparams1, "IviiiIsssssssss");
        p.frames.runScript(p, 150, tparams2, "IviiiIsssssssss");
        p.frames.runScript(p, 695, tparams3, "IviiiIsssssssss");
    }

    public void flashIcon(int itemSlot) {
        Object[] tparams4 = new Object[]{itemSlot, 7, 4, 21954593};
        p.frames.runScript(p, 143, tparams4, "Iiii");
    }
}</code></pre>
<p>Okey, look down for more.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bulby-508-trading/335857/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bulby-508-trading/335857/1</link>
        <pubDate>Tue, 06 Apr 2010 20:46:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-335857-1</guid>
        <source url="https://forum.moparisthebest.com/t/bulby-508-trading/335857.rss">Bulby 508 Trading</source>
      </item>
  </channel>
</rss>
