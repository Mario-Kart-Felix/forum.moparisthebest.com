<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 13:54:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Write to another program&#39;s stdin in windows? - General Programming - moparisthebest.com</title>
    <meta name="description" content="I have a java program that starts a native program I have written in C++, the java program reads fine what the native program prints to stdout, on all operating systems.  On Linux and OSX the native program reads fine wh&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="4059734658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Write to another program&#39;s stdin in windows?&#39;" href="405973.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973?page=2" />
<meta property="og:title" content="Write to another program&#39;s stdin in windows?" />
<meta name="twitter:title" content="Write to another program&#39;s stdin in windows?" />
<meta property="og:description" content="I thought I wasn’t looking at console input, since it seems to be different than stdin?  edit:  Yes, PeekConsole does nothing since it isn’t being ran from the console.  At this point I’m ready to go with assembly code if I have to, since this part is only targeting x86 windows anyway.  edit2:  Anyone know a good windows-based programming forum where people might be more knowledgeable about this?" />
<meta name="twitter:description" content="I thought I wasn’t looking at console input, since it seems to be different than stdin?  edit:  Yes, PeekConsole does nothing since it isn’t being ran from the console.  At this point I’m ready to go with assembly code if I have to, since this part is only targeting x86 windows anyway.  edit2:  Anyone know a good windows-based programming forum where people might be more knowledgeable about this?" />
<meta property="article:published_time" content="2011-07-27T15:03:31+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="405973.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="405973.html">Write to another program&#39;s stdin in windows?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T15:03:31Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:32:45Z' class='post-time'>
              August 1, 2016,  1:32pm
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I thought I wasn’t looking at console input, since it seems to be different than stdin?</p>
<p>edit:<br>
Yes, PeekConsole does nothing since it isn’t being ran from the console.  At this point I’m ready to go with assembly code if I have to, since this part is only targeting x86 windows anyway.</p>
<p>edit2:<br>
Anyone know a good windows-based programming forum where people might be more knowledgeable about this?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T16:58:12Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:32:52Z' class='post-time'>
              August 1, 2016,  1:32pm
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>this looks excessive but probably works<br>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <a href="https://www.daniweb.com/programming/software-development/threads/349105/timeout-timer-on-cin-stdin-cin-get-etc" target="_blank" rel="nofollow noopener">DaniWeb</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:110/67;"><img src="https://static.daniweb.com/icon.png" class="thumbnail"></div>

<h3><a href="https://www.daniweb.com/programming/software-development/threads/349105/timeout-timer-on-cin-stdin-cin-get-etc" target="_blank" rel="nofollow noopener">Timeout/timer on cin/stdin/cin.get() etc..</a></h3>

<p>Basically If the user does not enter a string or character or press any keys after a certain length of time, program will goto or ask again.. or do whatever.. ...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T17:07:24Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:32:53Z' class='post-time'>
              August 1, 2016,  1:32pm
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I went ahead and wrote up an example program with no dependencies that anyone can compile/run:</p>
<p><a href="https://www.moparisthebest.com/downloads/nonblockingread.7z">https://www.moparisthebest.com/downloads/nonblockingread.7z</a> (139k, complete with win32 and linux x86 executables)</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;cstdarg&gt;
#include &lt;iostream&gt;

bool print_debug = true;
FILE* g_log_file = 0;

void debug( const char* format, ... ) {
	if(!print_debug)
		return;
	printf("DEBUG: ");
	va_list args;
	va_start( args, format );
	vprintf(format, args);
	if (g_log_file){
		fprintf(g_log_file, "DEBUG: ");
		vfprintf(g_log_file, format, args);
		fprintf(g_log_file, "\n");
		fflush(g_log_file);
	}
	va_end( args );
	printf("\n");
	fflush(stdout);
}

#if defined _WIN32 || defined __CYGWIN32__

#if defined(_MSC_VER)
#	define for if (false) {} else for
#endif

#include &lt;windows.h&gt;
//#include &lt;conio.h&gt;

// this always goes directly to the blocking read, whether the first 'resetting' wait is there or not
bool sleep_and_input(char* c, int sleep)
{
	void *input = GetStdHandle(STD_INPUT_HANDLE);
	debug("resetting handle");
	WaitForSingleObject(input, 0);
	debug("starting to wait");
	int wait_result = WaitForSingleObject(input, sleep*1000);
	debug("finished waiting");
	if (wait_result ==  WAIT_TIMEOUT) {
		// it timed out - no input
		debug("wait timed out, no input");
		return false;
	} else if (wait_result == WAIT_OBJECT_0){
		debug("recieved input, calling blocking read");
		// never returns when not running from console
		// *c = _getch();
		// waits for enter to be pressed, includes newline in output
		// std::cin.get(*c);
		// *c = std::cin.get();
		// *c = getc(stdin);
		// waits for enter to be pressed, doesn't include newline
		std::cin &gt;&gt; c;
		debug("blocking read returned '%c', returning true", *c);
		return true;
	} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {
		// some shit went wrong
		debug("somethting went wrong with wait");
		return false;
	}
	return false;
};
/*

bool sleep_and_input(char* c, int sleep)
{
	debug("in sleep_and_input");
	for (int i = 0; i &lt; sleep * 2; ++i)
	{
		// this always just returns 0
		int size = std::cin.rdbuf()-&gt;in_avail();
		debug("cin size: '%d'", size);
		if (size &gt; 0)
		{
			debug("reading character now");
			// *c = fgetc(stdin);
			// *c = getchar();

			// waits for enter to be pressed, doesn't include newline
			std::cin &gt;&gt; c;
			debug("character returned '%c', returning true", *c);
			return true;
		}
		Sleep(500);
	}
	debug("returning false");
	return false;
};

// this works when ran from the windows console, but not any other way
// such as if the process is spawned from java, or ran over cygwin ssh
bool sleep_and_input(char* c, int sleep)
{
	for (int i = 0; i &lt; sleep * 2; ++i)
	{
		if (_kbhit())
		{
			*c = _getch();
			return true;
		}
		Sleep(500);
	}
	return false;
};

// this always says "PeekConsoleInput failed.", presumably from the same reason _kbhit never returns true
// it must be looking in a different buffer than stdin
void peek_print_keypress()
{
  HANDLE input_handle = GetStdHandle(STD_INPUT_HANDLE);
  DWORD events = 0;      // how many events took place
  INPUT_RECORD input_record;  // a record of input events
  DWORD input_size = 1;    // how many characters to read

  BOOL peeked = PeekConsoleInput(input_handle, &amp;input_record, input_size, &amp;events);
  if(!peeked)
  {
    debug("PeekConsoleInput failed.");
    return;
  }

  if(peeked &amp;&amp; input_record.EventType == KEY_EVENT &amp;&amp; input_record.Event.KeyEvent.bKeyDown)
  { // PeekConsoleInput succeeded and a key was pressed, so set control_key and return vk.
	 debug("control key state: '%d', keycode: '%d'", input_record.Event.KeyEvent.dwControlKeyState, input_record.Event.KeyEvent.wVirtualKeyCode);
	 return;
  }

  debug("Key wasn't pressed.");
}
*/
#else

#include &lt;stdlib.h&gt;
#include &lt;cerrno&gt;

#include &lt;termios.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/select.h&gt;

struct set_keypress
{
	set_keypress()
	{
		termios new_settings;
		tcgetattr(0,&amp;stored_settings);
		new_settings = stored_settings;
		// Disable canonical mode, and set buffer size to 1 byte
		new_settings.c_lflag &amp;= (~ICANON);
		new_settings.c_cc[VTIME] = 0;
		new_settings.c_cc[VMIN] = 1;
		tcsetattr(0,TCSANOW,&amp;new_settings);
	}
	~set_keypress() { tcsetattr(0,TCSANOW,&amp;stored_settings); }
	termios stored_settings;
};

// this code works perfectly under Linux and Mac OSX
bool sleep_and_input(char* c, int sleep)
{
	// sets the terminal to single-character mode
	// and resets when destructed
	set_keypress s;
	int ret = 0;

	fd_set set;
	FD_ZERO(&amp;set);
	FD_SET(0, &amp;set);
	timeval tv = {sleep, 0};
	ret = select(1, &amp;set, 0, 0, &amp;tv);
	if (ret &gt; 0)
	{
		*c = getc(stdin);
		return true;
	}
	if (errno == EINTR)
	{
		debug("select failed: %s\n", strerror(errno));
		return false;
	}

	if (ret &lt; 0 &amp;&amp; errno != 0 &amp;&amp; errno != ETIMEDOUT)
		debug("select failed: %s\n", strerror(errno));

	return false;
}

#endif

int main()
{
	int refresh_delay = 1;
	// main loop
	while (true)
	{

		char c = 0;
		while (sleep_and_input(&amp;c, refresh_delay))
		{
			//if(c == '\n') break;
			debug("character read: '%c'", c);

			if (c == 'q'){
				break;
			}

			debug("another key was pressed, handling it...");
		}

		if (c == 'q') break;

		debug("processing stuff... (Press 'q' to quit.)");
		debug("--------------------------------------------------------");
	}

    return 0;
}
</code></pre>
<p>The comments show most of what I have tried and what happens.</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T19:22:55Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:33:11Z' class='post-time'>
              August 1, 2016,  1:33pm
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>so, does it work?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T20:33:05Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:33:16Z' class='post-time'>
              August 1, 2016,  1:33pm
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I don’t know, it is very excessive and I don’t think creating and destroying 2 threads each second is really the way to go…</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-28T19:51:56Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:35:12Z' class='post-time'>
              August 1, 2016,  1:35pm
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>So I guess this is what I’m going to use:</p>
<p>[code=cpp]<span class="hashtag">#include</span> &lt;stdio.h&gt;<br>
<span class="hashtag">#include</span> <br>
<span class="hashtag">#include</span> </p>
<p>bool print_debug = true;<br>
FILE* g_log_file = 0;</p>
<p>void debug( const char* format, … ) {<br>
if(!print_debug)<br>
return;<br>
printf("DEBUG: ");<br>
va_list args;<br>
va_start( args, format );<br>
vprintf(format, args);<br>
if (g_log_file){<br>
fprintf(g_log_file, “DEBUG: “);<br>
vfprintf(g_log_file, format, args);<br>
fprintf(g_log_file, “\n”);<br>
fflush(g_log_file);<br>
}<br>
va_end( args );<br>
printf(”\n”);<br>
fflush(stdout);<br>
}</p>
<p><span class="hashtag">#if</span> defined _WIN32 || defined <strong>CYGWIN32</strong></p>
<p><span class="hashtag">#if</span> defined(_MSC_VER)</p>
<h1>define for if (false) {} else for</h1>
<p><span class="hashtag">#endif</span></p>
<p><span class="hashtag">#include</span> &lt;windows.h&gt;<br>
<span class="hashtag">#include</span> &lt;process.h&gt;<br>
//<span class="hashtag">#include</span> &lt;string.h&gt;<br>
//<span class="hashtag">#include</span> &lt;conio.h&gt;</p>
<p>std::string thread_char;<br>
bool thread_running = false;</p>
<p>void Thread( void* pParams )<br>
{<br>
debug(“thread started”);<br>
// waits for enter to be pressed, doesn’t include newline<br>
//std::cin &gt;&gt; thread_char;<br>
std::getline(std::cin, thread_char);<br>
thread_running = false;<br>
debug(“thread stopped”);<br>
}</p>
<p>bool sleep_and_input(char* c, int sleep)<br>
{<br>
if(thread_running){<br>
Sleep(sleep*1000);<br>
return false;<br>
}<br>
debug(“1 thread_char: ‘%s’ c: ‘%c’”, thread_char.c_str(), *c);<br>
if(!thread_char.empty()){<br>
//strncpy(c, &amp;thread_char, 1);<br>
thread_char.copy(c,1,0);<br>
debug(“2 thread_char: ‘%s’ c: ‘%c’”, thread_char.c_str(), *c);<br>
thread_char.clear();<br>
// we don’t want to start the thread again here, since after we return from<br>
// this function we might want to read from stdin someplace else<br>
debug(“3 thread_char: ‘%s’ c: ‘%c’”, thread_char.c_str(), <em>c);<br>
return true;<br>
}<br>
thread_running = true;<br>
_beginthread( Thread, 0, NULL );<br>
return false;<br>
};<br>
/</em><br>
VOID WINAPI FileIOCompletionRoutine( DWORD fdwError, DWORD cbTransferred,<br>
OVERLAPPED *po )<br>
{<br>
debug(“in FileIOCompletionRoutine”);<br>
char *pszBuf = (char *)po-&gt;hEvent;</p>
<p>pszBuf[cbTransferred] = 0;<br>
printf( “%s\n”, pszBuf );<br>
free( pszBuf );<br>
free( po );<br>
}</p>
<p>void do_async()<br>
{<br>
HANDLE hin;<br>
DWORD dwBytesRead;<br>
char buff[16];</p>
<pre><code>//hin = CreateFile("CONIN$",GENERIC_READ,FILE_SHARE_READ,0,OPEN_EXISTING,0,0);
//hin = CreateFile("STDIN$",GENERIC_READ,FILE_SHARE_READ,0,OPEN_EXISTING | FILE_FLAG_OVERLAPPED,0,0);
hin = GetStdHandle(STD_INPUT_HANDLE);

OVERLAPPED *po = (OVERLAPPED *)malloc(sizeof(OVERLAPPED));
char *pszBuf = (char *)malloc(128);

po-&gt;Offset = 0;
po-&gt;hEvent = (HANDLE)pszBuf;
if ( ReadFileEx( hin, pszBuf, 128, po, FileIOCompletionRoutine ) )
	debug( "ReadFileEx() succeded" );
else
{
	debug( "ReadFileEx() failed" );
	//  free( pszBuf );
	//  free( po );
}
debug("bottom of do_async");

//CloseHandle(hin);
</code></pre>
<p>};</p>
<p>bool sleep_and_input(char* c, int sleep)<br>
{<br>
HANDLE input = GetStdHandle(STD_INPUT_HANDLE);<br>
//debug(“resetting handle”);<br>
//WaitForSingleObject(input, 0);<br>
debug(“starting to wait”);<br>
int wait_result = WaitForSingleObject(input, sleep*1000);<br>
debug(“finished waiting”);<br>
if (wait_result ==  WAIT_TIMEOUT) {<br>
// it timed out - no input<br>
debug(“wait timed out, no input”);<br>
return false;<br>
} else if (wait_result == WAIT_OBJECT_0){<br>
debug(“recieved input, calling blocking read”);<br>
// never returns when not running from console<br>
// *c = _getch();<br>
// waits for enter to be pressed, includes newline in output<br>
// std::cin.get(*c);<br>
// *c = std::cin.get();<br>
// *c = getc(stdin);<br>
// waits for enter to be pressed, doesn’t include newline<br>
std::cin &gt;&gt; c;<br>
debug(“blocking read returned ‘%c’, returning true”, *c);<br>
return true;<br>
} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {<br>
// some shit went wrong<br>
debug(“somethting went wrong with wait”);<br>
return false;<br>
}<br>
return false;<br>
};</p>
<p>// this always goes directly to the blocking read, whether the first ‘resetting’ wait is there or not<br>
void do_conin()<br>
{<br>
HANDLE hin;<br>
DWORD dwBytesRead;<br>
char buff[16];</p>
<pre><code>//hin = CreateFile("CONIN$",GENERIC_READ,FILE_SHARE_READ,0,OPEN_EXISTING,0,0);
hin = GetStdHandle(STD_INPUT_HANDLE);

while(ReadFile(hin, buff, 16, &amp;dwBytesRead, NULL)){
	debug("bytes read: '%d'", dwBytesRead);
	std::cout &lt;&lt; buff &lt;&lt; std::endl;
}

CloseHandle(hin);
</code></pre>
<p>};</p>
<p>// this always goes directly to the blocking read, whether the first ‘resetting’ wait is there or not<br>
bool sleep_and_input(char* c, int sleep)<br>
{<br>
HANDLE input = GetStdHandle(STD_INPUT_HANDLE);<br>
//debug(“resetting handle”);<br>
//WaitForSingleObject(input, 0);<br>
debug(“starting to wait”);<br>
int wait_result = WaitForSingleObject(input, sleep*1000);<br>
debug(“finished waiting”);<br>
if (wait_result ==  WAIT_TIMEOUT) {<br>
// it timed out - no input<br>
debug(“wait timed out, no input”);<br>
return false;<br>
} else if (wait_result == WAIT_OBJECT_0){<br>
debug(“recieved input, calling blocking read”);<br>
// never returns when not running from console<br>
// *c = _getch();<br>
// waits for enter to be pressed, includes newline in output<br>
// std::cin.get(*c);<br>
// *c = std::cin.get();<br>
// *c = getc(stdin);<br>
// waits for enter to be pressed, doesn’t include newline<br>
std::cin &gt;&gt; c;<br>
debug(“blocking read returned ‘%c’, returning true”, *c);<br>
return true;<br>
} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {<br>
// some shit went wrong<br>
debug(“somethting went wrong with wait”);<br>
return false;<br>
}<br>
return false;<br>
};<br>
*/</p>
<p>/*<br>
int mykbhit(void)<br>
{<br>
debug(“in mykbhit”);<br>
int retval = 0;<br>
INPUT_RECORD *ir = NULL;<br>
DWORD count = 0, i;</p>
<pre><code>void *console_in = GetStdHandle(STD_INPUT_HANDLE);

GetNumberOfConsoleInputEvents(console_in, &amp;count);
debug("number of console events: '%d'", count);

if (count &amp;&amp; (ir = (INPUT_RECORD*)malloc(count * sizeof(INPUT_RECORD))) &amp;&amp;
    PeekConsoleInputA(console_in, ir, count, &amp;count))
{
  for(i = 0; i &lt; count - 1; i++)
  {
    if (ir[i].EventType == KEY_EVENT &amp;&amp;
        ir[i].Event.KeyEvent.bKeyDown &amp;&amp;
        ir[i].Event.KeyEvent.uChar.AsciiChar)
    {
      retval = 1;
      break;
    }
  }
free(ir);
}
</code></pre>
<p>return retval;<br>
}</p>
<p>bool keyHit(void)<br>
{<br>
HANDLE  stdIn = GetStdHandle(STD_INPUT_HANDLE);</p>
<p>DWORD   saveMode;<br>
GetConsoleMode(stdIn, &amp;saveMode);<br>
SetConsoleMode(stdIn, ENABLE_PROCESSED_INPUT);</p>
<p>bool  ret = false;</p>
<p>if (WaitForSingleObject(stdIn, 1) == WAIT_OBJECT_0) ret = true;</p>
<p>SetConsoleMode(stdIn, saveMode);</p>
<p>return(ret);<br>
}</p>
<p>bool getChar(TCHAR &amp;ch)<br>
{<br>
bool    ret = false;</p>
<p>HANDLE  stdIn = GetStdHandle(STD_INPUT_HANDLE);</p>
<p>DWORD   saveMode;<br>
GetConsoleMode(stdIn, &amp;saveMode);<br>
SetConsoleMode(stdIn, ENABLE_PROCESSED_INPUT);</p>
<p>if (WaitForSingleObject(stdIn, INFINITE) == WAIT_OBJECT_0)<br>
{<br>
DWORD num;<br>
//ReadConsole(stdIn, &amp;ch, 1, &amp;num, NULL);<br>
ReadFile(stdIn, &amp;ch, 1, &amp;num, NULL);<br>
//std::cin &gt;&gt; ch;</p>
<pre><code>if (num == 1) ret = true;
</code></pre>
<p>}</p>
<p>SetConsoleMode(stdIn, saveMode);</p>
<p>return(ret);<br>
}</p>
<p>TCHAR getChar(void)<br>
{<br>
TCHAR ch = 0;<br>
getChar(ch);<br>
return(ch);<br>
}</p>
<p>bool sleep_and_input(char* c, int sleep)<br>
{<br>
debug(“in sleep_and_input”);<br>
for (int i = 0; i &lt; sleep * 2; ++i)<br>
{<br>
// this always just returns 0<br>
//int size = std::cin.rdbuf()-&gt;in_avail();<br>
//debug(“cin size: ‘%d’”, size);<br>
// never returns true<br>
//if (mykbhit())<br>
Sleep(500);<br>
if(keyHit)<br>
{<br>
debug(“reading character now”);<br>
// *c = fgetc(stdin);<br>
// <em>c = getchar();<br>
<em>c = getChar();<br>
// waits for enter to be pressed, doesn’t include newline<br>
//std::cin &gt;&gt; c;<br>
debug(“character returned ‘%c’, returning true”, <em>c);<br>
return true;<br>
}<br>
}<br>
debug(“returning false”);<br>
return false;<br>
};</em>/<br>
/</em><br>
// this works when ran from the windows console, but not any other way<br>
// such as if the process is spawned from java, or ran over cygwin ssh<br>
bool sleep_and_input(char</em> c, int sleep)<br>
{<br>
for (int i = 0; i &lt; sleep * 2; ++i)<br>
{<br>
if (_kbhit())<br>
{<br>
*c = _getch();<br>
return true;<br>
}<br>
Sleep(500);<br>
}<br>
return false;<br>
};</p>
<p>// this always says “PeekConsoleInput failed.”, presumably from the same reason _kbhit never returns true<br>
// it must be looking in a different buffer than stdin<br>
void peek_print_keypress()<br>
{<br>
HANDLE input_handle = GetStdHandle(STD_INPUT_HANDLE);<br>
DWORD events = 0;      // how many events took place<br>
INPUT_RECORD input_record;  // a record of input events<br>
DWORD input_size = 1;    // how many characters to read</p>
<p>BOOL peeked = PeekConsoleInput(input_handle, &amp;input_record, input_size, &amp;events);<br>
if(!peeked)<br>
{<br>
debug(“PeekConsoleInput failed.”);<br>
return;<br>
}</p>
<p>if(peeked &amp;&amp; input_record.EventType == KEY_EVENT &amp;&amp; input_record.Event.KeyEvent.bKeyDown)<br>
{ // PeekConsoleInput succeeded and a key was pressed, so set control_key and return vk.<br>
debug(“control key state: ‘%d’, keycode: ‘%d’”, input_record.Event.KeyEvent.dwControlKeyState, input_record.Event.KeyEvent.wVirtualKeyCode);<br>
return;<br>
}</p>
<p>debug(“Key wasn’t pressed.”);<br>
}<br>
*/<br>
<span class="hashtag">#else</span></p>
<p><span class="hashtag">#include</span> &lt;stdlib.h&gt;<br>
<span class="hashtag">#include</span> </p>
<p><span class="hashtag">#include</span> &lt;termios.h&gt;<br>
<span class="hashtag">#include</span> &lt;string.h&gt;<br>
<span class="hashtag">#include</span> &lt;sys/ioctl.h&gt;<br>
<span class="hashtag">#include</span> &lt;sys/select.h&gt;</p>
<p>struct set_keypress<br>
{<br>
set_keypress()<br>
{<br>
termios new_settings;<br>
tcgetattr(0,&amp;stored_settings);<br>
new_settings = stored_settings;<br>
// Disable canonical mode, and set buffer size to 1 byte<br>
new_settings.c_lflag &amp;= (~ICANON);<br>
new_settings.c_cc[VTIME] = 0;<br>
new_settings.c_cc[VMIN] = 1;<br>
tcsetattr(0,TCSANOW,&amp;new_settings);<br>
}<br>
~set_keypress() { tcsetattr(0,TCSANOW,&amp;stored_settings); }<br>
termios stored_settings;<br>
};</p>
<p>// this code works perfectly under Linux and Mac OSX<br>
bool sleep_and_input(char* c, int sleep)<br>
{<br>
// sets the terminal to single-character mode<br>
// and resets when destructed<br>
set_keypress s;<br>
int ret = 0;</p>
<pre><code>fd_set set;
FD_ZERO(&amp;set);
FD_SET(0, &amp;set);
timeval tv = {sleep, 0};
ret = select(1, &amp;set, 0, 0, &amp;tv);
if (ret &gt; 0)
{
	*c = getc(stdin);
	return true;
}
if (errno == EINTR)
{
	debug("select failed: %s\n", strerror(errno));
	return false;
}

if (ret &lt; 0 &amp;&amp; errno != 0 &amp;&amp; errno != ETIMEDOUT)
	debug("select failed: %s\n", strerror(errno));

return false;
</code></pre>
<p>}</p>
<p><span class="hashtag">#endif</span></p>
<p>int main()<br>
{<br>
//do_async();	return 0;<br>
int refresh_delay = 3;<br>
// main loop<br>
while (true)<br>
{</p>
<pre><code>	char c = 0;
	while (sleep_and_input(&amp;c, refresh_delay))
	{
		//if(c == '\n') break;
		debug("character read: '%c'", c);

		if (c == 'q'){
			break;
		}

					// add torrent, requires a magnet link, url link, or path to a torrent file, and a save_path
		if(c == 'a'){
			// get magnet_url
			std::string magnet_url, save_path;
			std::getline(std::cin, magnet_url);
			//std::cin.ignore(INT_MAX, '\n');
			// get save_path
			std::getline(std::cin, save_path);
			//std::cin.ignore(INT_MAX, '\n');
			// add torrent, print result
			debug("magnet_url: '%s' save_path: '%s' ", magnet_url.c_str(), save_path.c_str());
			std::cout.flush();
			break;
		}

		debug("another key was pressed, handling it...");
	}

	if (c == 'q') break;

	debug("processing stuff... (Press 'q' to quit.)");
	debug("--------------------------------------------------------");
}

return 0;
</code></pre>
<p>}<br>
[/code]</p>
<p>As you see, I have a dedicated thread that spends most of it’s time blocked in a std::getline() call, which sets a string when getline() returns, then ends the thread.  It’s about as nice of code as I can come up with, judging by all the other code I’ve tried as you can see in the comments.</p>
<p>I don’t suppose anyone has a nice way to just read a single character without having to press enter in windows?  As you see from the comments, _getch() doesn’t work on stdin, and setting the console mode doesn’t make a difference since I’m not reading from the console, I’m reading from stdin.</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-29T14:11:44Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:36:48Z' class='post-time'>
              August 1, 2016,  1:36pm
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>have you tried cin.get() ?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-29T16:08:02Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:36:57Z' class='post-time'>
              August 1, 2016,  1:36pm
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yes, it waits for a newline, here is what I’ve tried so far:</p>
<pre><code class="lang-auto">// never returns when not running from console
*c = _getch();
// waits for enter to be pressed, includes newline in output
std::cin.get(*c);
*c = std::cin.get();
*c = getc(stdin);
// waits for enter to be pressed, doesn't include newline
std::cin &gt;&gt; c;
std::getline(std::cin, thread_char);</code></pre>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/slavemaster.html'><span itemprop='name'>slavemaster</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-08-05T20:01:01Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:49:23Z' class='post-time'>
              August 1, 2016,  1:49pm
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Have you considered using Overlapped I/O on the standard input file handle?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-08-06T00:11:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:49:45Z' class='post-time'>
              August 1, 2016,  1:49pm
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="29" data-topic="405973">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/slavemaster/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> slavemaster:</div>
<blockquote>
<p>Have you considered using Overlapped I/O on the standard input file handle?</p>
</blockquote>
</aside>
<p>I’m pretty sure I tried that, but stdin doesn’t support it, do you know differently?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="405973.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 13:54:31 GMT -->
</html>
