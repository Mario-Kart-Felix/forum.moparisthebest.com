<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 13:49:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Write to another program&#39;s stdin in windows? - General Programming - moparisthebest.com</title>
    <meta name="description" content="I have a java program that starts a native program I have written in C++, the java program reads fine what the native program prints to stdout, on all operating systems.  On Linux and OSX the native program reads fine wh&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="405973.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Write to another program&#39;s stdin in windows?&#39;" href="405973.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973" />
<meta property="og:title" content="Write to another program&#39;s stdin in windows?" />
<meta name="twitter:title" content="Write to another program&#39;s stdin in windows?" />
<meta property="og:description" content="I have a java program that starts a native program I have written in C++, the java program reads fine what the native program prints to stdout, on all operating systems.  On Linux and OSX the native program reads fine what the java program sends it, but on windows nothing ever gets through.  However, if I run the program on the command line on any OS, including windows, whatever key I press is read fine.  I really have no idea what the problem could be here, unless it’s something to do with runn..." />
<meta name="twitter:description" content="I have a java program that starts a native program I have written in C++, the java program reads fine what the native program prints to stdout, on all operating systems.  On Linux and OSX the native program reads fine what the java program sends it, but on windows nothing ever gets through.  However, if I run the program on the command line on any OS, including windows, whatever key I press is read fine.  I really have no idea what the problem could be here, unless it’s something to do with runn..." />
<meta property="article:published_time" content="2011-07-23T20:07:18+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="next" href="4059734658.html?page=2">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="405973.html">Write to another program&#39;s stdin in windows?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-23T20:07:18Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:25Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have a java program that starts a native program I have written in C++, the java program reads fine what the native program prints to stdout, on all operating systems.  On Linux and OSX the native program reads fine what the java program sends it, but on windows nothing ever gets through.  However, if I run the program on the command line on any OS, including windows, whatever key I press is read fine.  I really have no idea what the problem could be here, unless it’s something to do with running the program in the windows command line vs not, I’d appreciate some help.</p>
<p>Here is the native code that reads 1 character from stdin, the top is for windows, bottom is for everything else:</p>
<p>[code=cpp]<span class="hashtag">#ifdef</span> _WIN32<br>
<span class="hashtag">#define</span> EXE “.exe”</p>
<p><span class="hashtag">#if</span> defined(_MSC_VER)</p>
<h1>define for if (false) {} else for</h1>
<p><span class="hashtag">#endif</span></p>
<p><span class="hashtag">#include</span> &lt;windows.h&gt;<br>
<span class="hashtag">#include</span> &lt;conio.h&gt;</p>
<p>bool sleep_and_input(char* c, int sleep)<br>
{<br>
for (int i = 0; i &lt; sleep * 2; ++i)<br>
{<br>
if (_kbhit())<br>
{<br>
*c = _getch();<br>
return true;<br>
}<br>
Sleep(500);<br>
}<br>
return false;<br>
};</p>
<p><span class="hashtag">#else</span><br>
<span class="hashtag">#define</span> EXE “”</p>
<p><span class="hashtag">#include</span> &lt;stdlib.h&gt;<br>
<span class="hashtag">#include</span> &lt;stdio.h&gt;</p>
<p><span class="hashtag">#include</span> &lt;termios.h&gt;<br>
<span class="hashtag">#include</span> &lt;string.h&gt;<br>
<span class="hashtag">#include</span> &lt;sys/ioctl.h&gt;</p>
<p>struct set_keypress<br>
{<br>
set_keypress()<br>
{<br>
termios new_settings;<br>
tcgetattr(0,&amp;stored_settings);<br>
new_settings = stored_settings;<br>
// Disable canonical mode, and set buffer size to 1 byte<br>
new_settings.c_lflag &amp;= (~ICANON);<br>
new_settings.c_cc[VTIME] = 0;<br>
new_settings.c_cc[VMIN] = 1;<br>
tcsetattr(0,TCSANOW,&amp;new_settings);<br>
}<br>
~set_keypress() { tcsetattr(0,TCSANOW,&amp;stored_settings); }<br>
termios stored_settings;<br>
};</p>
<p>bool sleep_and_input(char* c, int sleep)<br>
{<br>
// sets the terminal to single-character mode<br>
// and resets when destructed<br>
set_keypress s;<br>
libtorrent::ptime start = libtorrent::time_now_hires();<br>
int ret = 0;<br>
retry:<br>
fd_set set;<br>
FD_ZERO(&amp;set);<br>
FD_SET(0, &amp;set);<br>
timeval tv = {sleep, 0};<br>
ret = select(1, &amp;set, 0, 0, &amp;tv);<br>
if (ret &gt; 0)<br>
{<br>
*c = getc(stdin);<br>
return true;<br>
}<br>
if (errno == EINTR)<br>
{<br>
if (total_milliseconds(libtorrent::time_now_hires() - start) &lt; sleep * 1000)<br>
goto retry;<br>
return false;<br>
}</p>
<pre><code>if (ret &lt; 0 &amp;&amp; errno != 0 &amp;&amp; errno != ETIMEDOUT)
	debug("select failed: %s\n", strerror(errno));

libtorrent::sleep(500);
return false;
</code></pre>
<p>}</p>
<p><span class="hashtag">#endif</span>[/code]</p>
<p>This is the relevant java code:</p>
<pre><code class="lang-auto">// stdout initialized like this:
stdin = new BufferedReader(new InputStreamReader(proc.getInputStream()));

     private synchronized void inputCommands(String... commands) throws IOException {
        for (String command : commands)
            stdout.write(command, 0, command.length());
        stdout.flush();
    }

// and it is called like this:
inputCommands("r");</code></pre>
<p>No exceptions are ever thrown, by the way.</p>
<p>Any ideas?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-23T21:05:46Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:29Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>do you realize what _kbhit() does</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-23T21:12:46Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:29Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>you’re using c++. use cin, not getch.</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-23T21:16:38Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:30Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="3" data-topic="405973">
<div class="title">
<div class="quote-controls"></div>
 lawl_temp:</div>
<blockquote>
<p>you’re using c++. use cin, not getch.</p>
</blockquote>
</aside>
<p>let alone not _getch() which is conio.h crap</p>
<p>moparisthebest there is a difference between hitting a key and data being in stdin<br>
cin.get() ought to block</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/abraham2119.html'><span itemprop='name'>abraham2119</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-24T02:53:17Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:49Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>im going to assume you’re running it under windows vista or 7, in which case, neither _kbhit nor _getch are supported:</p>
<blockquote>[b]Compatibility:[/b] Windows 95, Windows 98, Windows 98 Second Edition, Windows Millennium Edition, Windows NT 4.0, Windows 2000, Windows XP Home Edition, Windows XP Professional, Windows Server 2003</blockquote>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-24T03:40:04Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:26:51Z' class='post-time'>
              August 1, 2016,  1:26pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“abraham2119, post:5, topic:405973”]im going to assume you’re running it under windows vista or 7, in which case, neither _kbhit nor _getch are supported:</p>
<p>[quote]<br>
<span class="bbcode-b">Compatibility:</span> Windows 95, Windows 98, Windows 98 Second Edition, Windows Millennium Edition, Windows NT 4.0, Windows 2000, Windows XP Home Edition, Windows XP Professional, Windows Server 2003[/quote][/quote]<br>
unless that document is old…</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-24T05:29:01Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:27:01Z' class='post-time'>
              August 1, 2016,  1:27pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m actually running under XP right now, but it needs to work for all windows versions, I didnt write that particular code, but as you see I need it to block but with a timeout, cin.get can’t do that can it?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T02:38:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:30:59Z' class='post-time'>
              August 1, 2016,  1:30pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“super_, post:4, topic:405973”]moparisthebest there is a difference between hitting a key and data being in stdin<br>
cin.get() ought to block[/quote]</p>
<p>There really shouldn’t be a difference, and according to the only docs I found on it, it really says two different things.  It says it checks for a recent keystroke, but then it says it returns a non-zero value if a key is waiting in the buffer, which is the behavior I expected.  (and really, what is a ‘keystroke’ to a command line program if not just data in the stdin buffer?)</p>
<blockquote>The _kbhit function checks the console for a recent keystroke. If the function returns a nonzero value, a keystroke is waiting in the buffer. The program can then call _getch or _getche to get the keystroke.</blockquote>
<p>cin.get() of course does block, but as you see, I don’t want it to block, I need to implement a timeout.  Any ideas windows guru’s?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T02:45:57Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:30:59Z' class='post-time'>
              August 1, 2016,  1:30pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <blockquote>The buffer implemented by the C run-time functions for the stream "stdin" is different from the BIOS keyboard typeahead buffer.</blockquote>
hurrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr
[code]bdos (0xC, 0, 0) ;       // clear BIOS keyboard buffer
//  Alternative method:
//  while (kbhit()) getch();[/code]
there definitely should be a different, especially if the input is piped from another process and it's input is... not from the keyboard buffer
i also do not know how to have a cin.get() timeout
<p>edit:<br>
for a windows only way to timeout on stdin…</p>
<pre><code class="lang-auto">#include &lt;windows.h&gt;

#define INPUT_TIMEOUT 5000

void *input = GetStdHandle(STD_INPUT_HANDLE);
int wait_result = WaitForSingleObject(input, INPUT_TIMEOUT);
if (wait_result ==  WAIT_TIMEOUT) {
    /* it timed out - no input */
} else if (wait_result == WAIT_OBJECT_0){
    /* it signaled in time - input available */
} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {
    /* some shit went wrong */
}</code></pre>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T03:05:42Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:00Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Perhaps it is implemented that way, though for the life of me I can’t imagine any possible reason why a console app should know or care where the characters are coming from, as long as it is getting characters sent to it.  As you can see, in Linux or OSX (assuming any other Unix-like OS too) they don’t care, and the app works the same ran from a bash shell as ran from java.</p>
<p>Some googling hasn’t really helped me any, I see plenty of ‘non-blocking’ windows read code, but so far, it ALL includes kb_hit…</p>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://www.gamedev.net/uploads/themes/monthly_2017_04/favicon.ico.59546a253c4cfb8defa436b7865b4736.ico" class="site-icon" width="32" height="32">
      <a href="http://www.gamedev.net/forums/topic/285863-non-blocking-stdin-read-on-win32/" target="_blank" rel="nofollow noopener">GameDev.net</a>
  </header>
  <article class="onebox-body">
    <img src="https://www.gamedev.net/uploads/themes/monthly_2017_09/Gamedev-Logo-G-200x200.png.6c84cc696e42b794d39d14559abb294a.png" class="thumbnail onebox-avatar" width="200" height="200">

<h3><a href="http://www.gamedev.net/forums/topic/285863-non-blocking-stdin-read-on-win32/" target="_blank" rel="nofollow noopener">Non-blocking stdin read on win32</a></h3>

<p>I am currently in the process of porting the server side of my current project over to win32 from unix-world. Part of the app allows for someone at the console to enter in simple commands via keyboard. On the unix side, this was fairly simple. I...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T03:13:09Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:01Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>stdin doesn’t care where input comes from, but a function designed to manipulate the keyboard buffer is well bound to manipulate the keyboard buffer…</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T03:17:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:01Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I may have found a solution at the bottom of this thread:</p>
<p><a href="http://www.cplusplus.com/forum/general/5304/" class="onebox" target="_blank">http://www.cplusplus.com/forum/general/5304/</a></p>
<p>I’ll have to test it out tomorrow.</p>
<p>edit:<br>
Looks the same as the method super_ edited his post with, looks like it will work, I’ll let you know, thanks much! <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T03:24:51Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:01Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>well duh, the code is straight forward<br>
GetStdHandle(STD_INPUT_HANDLE) gives you the appropriate HANDLE to the stdin file in windows (akin to the file descriptor in unix)<br>
WaitForSingleObject() is like java’s Object.wait(); it waits for a “wake-up” signal and has an optional timeout</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mopman.html'><span itemprop='name'>Mopman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T07:28:07Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:10Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I like how you tried to turn it into a Windows bashing post, when really you just weren’t doing what you thought you were.</p>
<p>It’s all very well to spout off about how files work in Unix and whatever, but you weren’t even reading from one. <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
<p>Linux isn’t magical either.</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T13:57:44Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:20Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Mopman, post:14, topic:405973”]I like how you tried to turn it into a Windows bashing post, when really you just weren’t doing what you thought you were.</p>
<p>It’s all very well to spout off about how files work in Unix and whatever, but you weren’t even reading from one. <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
<p>Linux isn’t magical either.[/quote]</p>
<p>In Linux, reading from stdin, or a socket, or most anything else, is the same as reading from a file.</p>
<p>Anyway, like I said in the previous post, I just can’t imagine a need to ever have 2 buffers in a console program, one for stdin, and one for keyboard input, and somehow a call to cin.getline() draws from both of them?  Why in the hell?</p>
<p>I’m giving this a test now by the way.</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T17:02:21Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:30Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Damnit, even that code doesn’t work, it immediately returns that it has been ‘woken up’ and is ready to read from, even when it isn’t, which causes it to call _getch() and lock up the entire program waiting for input:</p>
<p><code>bool sleep_and_input(char* c, int sleep)
{
	void *input = GetStdHandle(STD_INPUT_HANDLE);
	debug("starting to wait");
	int wait_result = WaitForSingleObject(input, sleep*1000);
	debug("finished waiting");
	if (wait_result ==  WAIT_TIMEOUT) {
		/* it timed out - no input */
		debug("wait timed out, no input");
		return false;
	} else if (wait_result == WAIT_OBJECT_0){
		/* it signaled in time - input available */
		debug("recieved input, calling getch");
		*c = _getch();
		debug("getch returned, returning true");
		return true;
	} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {
		/* some shit went wrong */
		debug("somethting went wrong with wait");
		return false;
	}
	return false;
};</code></p>
<p>Running it turns out like this:<code>
DEBUG: starting to wait
DEBUG: finished waiting
DEBUG: recieved input, calling getch
</code></p>
<p>Then it locks up until I give it input…</p>
<p>edit:<br>
A lot of googling later and I simply can’t find any asynchronous or non-blocking read functions for windows that don’t use kbhit, I’m sure someone somewhere has came across this problem in the past and has a solution, any other ideas?</p>
<p>edit2:<br>
Another of my hopes shot down:<br>
int size = std::cin.rdbuf()-&gt;in_avail();<br>
Just returns 0 on windows every time…</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lawl.html'><span itemprop='name'>lawl</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-26T18:08:56Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:33Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>you need to be more careful with GetStdHandle(), i.e.</p>
<p>void *input = Condom(GetStdHandle(STD_INPUT_HANDLE));</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T00:49:43Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:31:58Z' class='post-time'>
              August 1, 2016,  1:31pm
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>the handle is already signaled; reset it</p>
<pre><code class="lang-auto">WaitForSingleObject(input, 0);</code></pre>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T03:00:02Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:32:09Z' class='post-time'>
              August 1, 2016,  1:32pm
            </time>
        <span itemprop='position'>#19</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“super_, post:18, topic:405973”]the handle is already signaled; reset it</p>
<p><code>
WaitForSingleObject(input, 0);
</code>[/quote]</p>
<p>Nope, same thing:</p>
<p><code>DEBUG: resetting handle
DEBUG: starting to wait
DEBUG: finished waiting
DEBUG: recieved input, calling getch</code></p>
<p>Here is the function as I’m using it:</p>
<p><code>bool sleep_and_input(char* c, int sleep)
{
	void *input = GetStdHandle(STD_INPUT_HANDLE);
	debug("resetting handle");
	WaitForSingleObject(input, 0);
	debug("starting to wait");
	int wait_result = WaitForSingleObject(input, sleep*1000);
	debug("finished waiting");
	if (wait_result ==  WAIT_TIMEOUT) {
		// it timed out - no input 
		debug("wait timed out, no input");
		return false;
	} else if (wait_result == WAIT_OBJECT_0){
		debug("recieved input, calling getch");
		// *c = _getch();
		// waits for enter to be pressed, includes newline in output
		//std::cin.get(*c);
		// *c = std::cin.get();
		// waits for enter to be pressed, doesn't include newline
		std::cin &gt;&gt; c;
		debug("getch returned '%c', returning true", *c);
		return true;
	} else if (wait_result == WAIT_FAILED || wait_result == WAIT_ABANDONED) {
		// some shit went wrong
		debug("somethting went wrong with wait");
		return false;
	}
	return false;
};</code></p>
<p>Any other ideas?</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-27T03:27:03Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:32:13Z' class='post-time'>
              August 1, 2016,  1:32pm
            </time>
        <span itemprop='position'>#20</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>loop with WaitForSingleObject() and PeekConsoleInput() until an INPUT_RECORD.EventType is a KEY_EVENT</p>
      </div>

      <meta itemprop='headline' content='Write to another program&#39;s stdin in windows?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><b><a rel="next" itemprop="url" href="4059734658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/write-to-another-programs-stdin-in-windows/405973 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 13:49:22 GMT -->
</html>
