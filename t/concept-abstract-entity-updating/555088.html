<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/concept-abstract-entity-updating/555088 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>(Concept) Abstract entity updating - Runescape - moparisthebest.com</title>
    <meta name="description" content="This is a concept/design idea that I recently had and decided to sketch out to see if it could work. Not only could it work, there&amp;#39;s also some major performance optimizations that this system brings with it. 

What is ab&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="555088.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;(Concept) Abstract entity updating&#39;" href="555088.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/concept-abstract-entity-updating/555088" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/concept-abstract-entity-updating/555088" />
<meta property="og:title" content="(Concept) Abstract entity updating" />
<meta name="twitter:title" content="(Concept) Abstract entity updating" />
<meta property="og:description" content="This is a concept/design idea that I recently had and decided to sketch out to see if it could work. Not only could it work, there’s also some major performance optimizations that this system brings with it.  What is abstract entity updating?  Well, on some servers you may have seen an efficient abstract combat system; where players and NPCs are treated alike in a single system that processes both.  This very same concept can be applied to the updating process. Players and NPCs have very similar..." />
<meta name="twitter:description" content="This is a concept/design idea that I recently had and decided to sketch out to see if it could work. Not only could it work, there’s also some major performance optimizations that this system brings with it.  What is abstract entity updating?  Well, on some servers you may have seen an efficient abstract combat system; where players and NPCs are treated alike in a single system that processes both.  This very same concept can be applied to the updating process. Players and NPCs have very similar..." />
<meta property="article:published_time" content="2016-03-29T01:43:36+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="555088.html">(Concept) Abstract entity updating</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-03-29T01:43:36Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:53:03Z' class='post-time'>
              August 4, 2016,  5:53pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is a concept/design idea that I recently had and decided to sketch out to see if it could work. Not only could it work, there’s also some major performance optimizations that this system brings with it.</p>
<p><span class="bbcode-b">What is abstract entity updating?</span></p>
<p>Well, on some servers you may have seen an efficient abstract combat system; where players and NPCs are treated alike in a single system that processes both.<br>
This very same concept can be applied to the updating process. Players and NPCs have very similar updating processes, allowing for abstraction. To implement this feature on an existing server would require a major overhaul of the updating process, the Player and NPC classes and a few more, which I will discuss below.</p>
<p><span class="bbcode-b">Why implement it?</span></p>
<p>This system means you will only have to loop through all the entities once per cycle and construct the player updating <span class="bbcode-i">and</span> npc updating packet for a single player in one go. This saves CPU cycles. When combined with an efficient 2D lookup method (I highly suggest a quadtree, but morton codes are a good alternative albeit more tricky to implement but are way more effective), this allows you to drastically speed up the player updating process.</p>
<p><span class="bbcode-b">How to make it work</span></p>
<p>First of all, you have to create either an interface or an abstract class to allow for abstraction. I am unsure if you can cast an interface to the class that implements the interface but I am sure this is the case with abstract classes, so here is one:</p>
<p>(demonstrational; doesn’t work and isn’t finished)</p>
<p>[code=java]public abstract class UpdatableEntity {</p>
<pre><code>...
</code></pre>
<p>}[/code]</p>
<p>The next thing you want to do is to make your Player and NPC classes extend this class, so they become a subclass of UpdatableEntity;</p>
<p>[code=java]public class Player extends UpdatableEntity {</p>
<pre><code>...
</code></pre>
<p>}[/code]</p>
<p>[code=java]public class NPC extends UpdatableEntity {</p>
<pre><code>...
</code></pre>
<p>}[/code]</p>
<p>Now you want to create a central system that stores both Players and NPCs (which can be done now because they both inherit the UpdatableEntity class), like so:</p>
<p><code>ArrayList&lt;UpdatableEntity&gt; updatables = new ArrayList&lt;UpdatableEntity&gt;();
ArrayList&lt;NPC&gt; npcs = new ArrayList&lt;NPC&gt;();
ArrayList&lt;Player&gt; players = new ArrayList&lt;Player&gt;();</code><br>
The reason you also have the <span class="bbcode-i">npcs</span> and <span class="bbcode-i">players</span> lists is because you want to access them when you have to. There is no need to fetch npcs+players if you only want to process the npcs and there is no need to fetch npcs+players if you only want to process the players. (example below)</p>
<p>The next part is optional but definately suggested. You’ll want to create a 2D lookup mechanism, created with the updatable entities.<br>
The reason for this is performance. For all the people currently owning a server, think of it this way: You’re essentially storing all your players and all your npc’s in a single list. It is very unlikely for your server to benefit from any of the performance increases by this system if you’re going to use the standard way of searching entities in a given range.</p>
<p>I suggest using a <a href="https://en.wikipedia.org/wiki/Quadtree" data-bbcode="true" rel="nofollow noopener">quadtree</a> or <a href="https://en.wikipedia.org/wiki/Z-order_curve" data-bbcode="true" rel="nofollow noopener">morton codes</a>.</p>
<p>The implementation would look like this:</p>
<p>[code=java]public void updatePlayers() {<br>
//create a quadtree to hold all the updatables<br>
QuadTree qtree = new QuadTree();<br>
for (UpdatableEntity e : updatables) {<br>
int x = e.getX();<br>
int y = e.getY();<br>
qtree.insert(e, x, y);<br>
}</p>
<pre><code>//update all the players
for (Player p : players) { //this is why we still store npcs and players seperately
	Area area = new Area(p.getX()-15, p.getY()-15, p.getX()+16, p.getY()+16); //32x32 area
	
	//retrieve all the entities in the 32x32 area around the player
	UpdatableEntity[] results = qtree.retrieve(area);
	
	//construct the npc updating and player updating packets
	Packet npcUpdating = new Packet();
	Packet playerUpdating = new Packet();
	
	for (UpdatableEntity e : results) {
		if (e.isNPC()) {
			appendUpdates(npcUpdating, e);
		} else {
			appendUpdates(playerUpdating, e);
		}
	}
	p.sendPacket(npcUpdating);
	p.sendPacket(playerUpdating)
}
</code></pre>
<p>}[/code]</p>
<p>I don’t know if anyone came up with this or has something like this but I haven’t seen it done before.</p>
<p>Also, thanks to Sini for explaining morton codes; I really learned a lot <img src="../../images/emoji/twitter/smileyae52.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>Thank you for reading this and I hope it has given you some inspiration <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='(Concept) Abstract entity updating'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Fabrice_L.html'><span itemprop='name'>Fabrice_L</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-03-29T11:41:54Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:53:03Z' class='post-time'>
              August 4, 2016,  5:53pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ll take a closer look at Quad trees and Morton code, I like experimenting with stuff I don’t know.</p>
<p>Looks nice btw</p>
      </div>

      <meta itemprop='headline' content='(Concept) Abstract entity updating'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-03-29T15:24:03Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:53:04Z' class='post-time'>
              August 4, 2016,  5:53pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Cool</p>
      </div>

      <meta itemprop='headline' content='(Concept) Abstract entity updating'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-03-29T15:49:33Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:53:04Z' class='post-time'>
              August 4, 2016,  5:53pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks</p>
<p>Working on implementing this on my server since I hadn’t touched player updating yet.</p>
      </div>

      <meta itemprop='headline' content='(Concept) Abstract entity updating'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/concept-abstract-entity-updating/555088 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:29 GMT -->
</html>
