<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/562-buying-bug/539439 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 07:01:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>562 Buying Bug - Runescape - moparisthebest.com</title>
    <meta name="description" content="Hello. 

I currently have an issue with my 562 server.  

When players are buying from shop keepers and their inventory is full, it will still remove the money from their cash stack. So for example, if I have 26 dragon p&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="539439.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;562 Buying Bug&#39;" href="539439.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/562-buying-bug/539439" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/562-buying-bug/539439" />
<meta property="og:title" content="562 Buying Bug" />
<meta name="twitter:title" content="562 Buying Bug" />
<meta property="og:description" content="Hello.  I currently have an issue with my 562 server.  When players are buying from shop keepers and their inventory is full, it will still remove the money from their cash stack. So for example, if I have 26 dragon pickaxes and 1000M and I click “Buy 5 Dragon Pickaxes”, it would still remove the money from my stack but it would just say “inventory is full” and I would not receive any of the items. It should be adding 1 Dragon Pickaxe but it’s removing the cash value of 5 and not adding any of t..." />
<meta name="twitter:description" content="Hello.  I currently have an issue with my 562 server.  When players are buying from shop keepers and their inventory is full, it will still remove the money from their cash stack. So for example, if I have 26 dragon pickaxes and 1000M and I click “Buy 5 Dragon Pickaxes”, it would still remove the money from my stack but it would just say “inventory is full” and I would not receive any of the items. It should be adding 1 Dragon Pickaxe but it’s removing the cash value of 5 and not adding any of t..." />
<meta property="article:published_time" content="2014-01-31T01:21:07+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="539439.html">562 Buying Bug</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rickymac6.html'><span itemprop='name'>Rickymac6</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T01:21:07Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:55Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hello.</p>
<p>I currently have an issue with my 562 server.</p>
<p>When players are buying from shop keepers and their inventory is full, it will still remove the money from their cash stack. So for example, if I have 26 dragon pickaxes and 1000M and I click “Buy 5 Dragon Pickaxes”, it would still remove the money from my stack but it would just say “inventory is full” and I would not receive any of the items. It should be adding 1 Dragon Pickaxe but it’s removing the cash value of 5 and not adding any of them. I’ve already tried fixing it but honestly, I’m not sure where to start since this is my first server and I’m quite new at this. Any help would be appreciated, thanks!</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/pure2ownage.html'><span itemprop='name'>pure2ownage</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T01:36:27Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:56Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Find your buy item method, in there use a check before adding the item to the person.<br>
It will look something like:</p>
<p><code>
public void buyItem(Shop shop, int id, int amonut) {
  if (shop.hasItem(id, amount)) {
    // ADD THE CHECK HERE.
    player.addItem(id, amount);
    player.removeItem(995, shop.getCost(id, amount));
  }
}</code></p>
<p>You will need to add a check to see if the player has space, add it right above the block where you remove the player’s money and try to add the item (marked on the previous code block), like so:</p>
<p><code>
if (player.getFreeInventory() &lt; amt) {
   return;
}</code></p>
<p>Your actual variables WILL be different.</p>
<p>You could take it a step further to check if the item is noted, or add just enough to fill up the player’s inventory.</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rickymac6.html'><span itemprop='name'>Rickymac6</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T02:27:44Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:57Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you very much Pure. Sorry if I seem like an idiot to this because I am!  :palm:</p>
<p>I found this in my ShopHandler.java;</p>
<p><code>if(p.getInventory().hasRoomFor(items[slot], amnt)) {
					itemsN[slot]--;
					p.getInventory().deleteItem(995, price);
					p.getInventory().addItem(item, 1);
					clearSlots(p);
				} else {
					p.sm("Not enough space on inventory");
					break;</code></p>
<p><code>if(p.getInventory().addItem(item, amnt));
    p.getInventory().deleteItem(995, (int) value);
   return;</code><br>
Would it be any of these? And where would I insert it?</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/pure2ownage.html'><span itemprop='name'>pure2ownage</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T02:31:59Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:57Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That is close but not quite, search for “inventory is full” and post the code around that please.</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rickymac6.html'><span itemprop='name'>Rickymac6</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T03:10:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:59Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Nothing came up for “Inventory is full” but I found a few things that could be what I’m looking for. Also, it seems it only bugs when I have my cash stack and one other item in my inventory (such as 50M and 1 - 27 dragon pickaxes). If I have more than one different item, it works correctly (such as 26 Dragon Pickaxes, a dragon hatchet, and 50M).</p>
<p>Here’s my inventory.java;</p>
<p>[code=java]package com.rs2hd.model;</p>
<p>/**</p>
<ul>
<li>Manages the player inventory.</li>
<li>
<span class="mention">@author</span> Graham</li>
<li>
</li>
</ul>
<p>*/<br>
public class Inventory {</p>
<pre><code>public static final int SIZE = 28;

public Container inventory = new Container(SIZE, false);

private transient Player player;

public void setPlayer(Player player) {
	this.player = player;
}

public boolean addItem(int item, int amount) {
	if(item &lt; 0) { //tmp fix for items
		return false;
	}
	boolean b = inventory.add(new Item(item, amount));
	if(!b) {
		player.getActionSender().sendMessage("Not enough space in your inventory.");
		return false;
	}
	refresh();
	return true;
}

public void reset() {
	inventory.reset();
	refresh();
}	
public boolean contains(int item, int amount) {
	return inventory.contains(new Item(item, amount));
}

public boolean contains(int item) {
	return inventory.containsOne(new Item(item));
}

public void deleteItem(int item, int amount) {
	if(amount &lt;= 0) {
		return;
	}
	inventory.remove(new Item(item, amount));
	refresh();
}

public void deleteAll(int item) {
	inventory.removeAll(new Item(item));
	refresh();
}

public void refresh() {
	player.getBonuses().refreshWeight();
	player.getActionSender().sendItems(9764864, 93, inventory);
}

public Container getContainer() {
	return inventory;
}

public int getFreeSlots() {
	return inventory.getFreeSlots();
}

public boolean hasRoomFor(int id, int itemAmount) {
	if(ItemDefinition.forId(id).isStackable()) {
		return getFreeSlots() &gt;= 1 || contains(id);
	} else {
		return getFreeSlots() &gt;= itemAmount;
	}
}

public int numberOf(int id) {
	return inventory.getNumberOf(new Item(id, 1));
}

public Item lookup(int id) {
	return inventory.lookup(id);
}

public int lookupSlot(int id) {
	return inventory.lookupSlot(id);
}

public Item get(int slot) {
	return inventory.get(slot);
}
</code></pre>
<p>}[/code]</p>
<p>But I’m assuming it has to be located in shophandler somewhere.</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/pure2ownage.html'><span itemprop='name'>pure2ownage</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T03:16:10Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:37:59Z' class='post-time'>
              August 4, 2016, 11:37am
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I don’t see this a part of this makes sense, but try this (in place of the code in OP):</p>
<p>[code=java]if(p.getInventory().hasRoomFor(items[slot], amnt)) {<br>
if (p.getInventory().addItem(item, 1)) { // pretty sure this should be addItem(item, amnt) though.<br>
itemsN[slot]–;<br>
p.getInventory().deleteItem(995, price);<br>
clearSlots§;<br>
}<br>
} else {<br>
p.sm(“Not enough space on inventory”);<br>
break;</p>
<p>// … rest of code[/code]</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rickymac6.html'><span itemprop='name'>Rickymac6</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T03:44:44Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:38:00Z' class='post-time'>
              August 4, 2016, 11:38am
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hmm, replaced it with that code and still doesn’t work. Is there a way I can send you my shophandler.java so you can check it out? I’m assuming the source I used is a bit on the strange side. I’d post the code but it’s over 2000 characters. <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/pure2ownage.html'><span itemprop='name'>pure2ownage</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-31T03:49:49Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:38:01Z' class='post-time'>
              August 4, 2016, 11:38am
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I told you what needs to be done, I can’t help you anymore than that I’m afraid.<br>
Refer to my initial post:</p>
<p>[quote=“Pure_, post:2, topic:539439”]Find your buy item method, in there use a check before adding the item to the person.<br>
It will look something like:</p>
<p><code>
public void buyItem(Shop shop, int id, int amonut) {
  if (shop.hasItem(id, amount)) {
    // ADD THE CHECK HERE.
    player.addItem(id, amount);
    player.removeItem(995, shop.getCost(id, amount));
  }
}</code></p>
<p>You will need to add a check to see if the player has space, add it right above the block where you remove the player’s money and try to add the item (marked on the previous code block), like so:</p>
<p><code>
if (player.getFreeInventory() &lt; amt) {
   return;
}</code></p>
<p>Your actual variables WILL be different.</p>
<p>You could take it a step further to check if the item is noted, or add just enough to fill up the player’s inventory.[/quote]</p>
      </div>

      <meta itemprop='headline' content='562 Buying Bug'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/562-buying-bug/539439 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 07:01:50 GMT -->
</html>
