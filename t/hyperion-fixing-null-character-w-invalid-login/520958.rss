<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Hyperion - Fixing null character w/ invalid login</title>
    <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958</link>
    <description>In the initial release of Hyperion, if you were to login with no credentials, you would get return code 11 (please try again) and a null character would spawn at the default location, this snippet fixes that.

Within the World class replace [i]load(PlayerDetails)[/i] with:

[code=java]
	public void load(final PlayerDetails pd) {
		engine.submitWork(new Runnable() {
			@Override
			public void run() {
				LoginResult lr = loader.checkLogin(pd);
				int code = lr.getReturnCode();
				if (code == 2) {
					lr.getPlayer().getSession().setAttribute(&quot;player&quot;, lr.getPlayer());
					loader.loadPlayer(lr.getPlayer());
					engine.pushTask(new SessionLoginTask(lr.getPlayer()));
				} else {
					PacketBuilder bldr = new PacketBuilder();
					bldr.put((byte) code);
					pd.getSession().write(bldr.toPacket()).addListener(new IoFutureListener&lt;IoFuture&gt;() {
						@Override
						public void operationComplete(IoFuture future) {
							future.getSession().close(false);
						}
					});
				}
			}
		});
	}[/code]

and replace [i]register(Player)[/i] with:

[code=java]
	public void register(final Player player) {
		// do final checks e.g. is player online? is world full?
		int returnCode = 2;
		if (!NameUtils.isValidName(player.getName())) {
			returnCode = 11;
		} else if (isPlayerOnline(player.getName())) {
			returnCode = 5;
		} else {
			if (!players.add(player)) {
				returnCode = 7;
				logger.info(&quot;Could not register player : &quot; + player + &quot; [world full]&quot;);
			}
		}
		final int finalReturnCode = returnCode;
		PacketBuilder bldr = new PacketBuilder();
		bldr.put((byte) returnCode);
		bldr.put((byte) player.getRights().toInteger());
		bldr.put((byte) 0);
		player.getSession().write(bldr.toPacket()).addListener(new IoFutureListener&lt;IoFuture&gt;() {
			@Override
			public void operationComplete(IoFuture future) {
				if (finalReturnCode != 2) {
					player.getSession().close(false);
				} else {
					player.getActionSender().sendLogin();
				}
			}
		});
		if (returnCode == 2) {
			logger.info(&quot;Registered player : &quot; + player + &quot; [online=&quot; + players.size() + &quot;]&quot;);
		}
	}[/code]

Bam, fixed.</description>
    
    <lastBuildDate>Sun, 09 Jun 2013 21:01:33 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Hyperion - Fixing null character w/ invalid login</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>Ah, never noticed that. Itâ€™s a little different, not much though. I just moved one check from <span class="bbcode-i">load()</span> to <span class="bbcode-i">register()</span> because <span class="bbcode-i">Player</span> construction occurred during <span class="bbcode-i">load()</span>.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/5</link>
        <pubDate>Sun, 09 Jun 2013 21:01:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-520958-5</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss">Hyperion - Fixing null character w/ invalid login</source>
      </item>
      <item>
        <title>Hyperion - Fixing null character w/ invalid login</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://forum.moparisthebest.com/uploads/default/original/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a.png" class="site-icon" width="32" height="32">
      <a href="https://forum.moparisthebest.com/" target="_blank">moparisthebest.com</a>
  </header>
  <article class="onebox-body">
    <img src="https://forum.moparisthebest.com/images/default-apple-touch-icon.png" class="thumbnail onebox-avatar" width="144" height="144">

<h3><a href="https://forum.moparisthebest.com/" target="_blank">moparisthebest.com</a></h3>

<p>programming, irc, cars</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>

<p>Not sure if yours is any different to mine, though. Good job nonetheless.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/4</link>
        <pubDate>Fri, 07 Jun 2013 23:04:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-520958-4</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss">Hyperion - Fixing null character w/ invalid login</source>
      </item>
      <item>
        <title>Hyperion - Fixing null character w/ invalid login</title>
        <dc:creator><![CDATA[@drubrkletern drubrkletern]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/drubrkletern">@drubrkletern</a> wrote:</p>
          <blockquote>
              <p>great <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/3</link>
        <pubDate>Fri, 07 Jun 2013 07:40:04 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-520958-3</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss">Hyperion - Fixing null character w/ invalid login</source>
      </item>
      <item>
        <title>Hyperion - Fixing null character w/ invalid login</title>
        <dc:creator><![CDATA[@Loveandpower Loveandpower]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/loveandpower">@Loveandpower</a> wrote:</p>
          <blockquote>
              <p>rep++</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/2</link>
        <pubDate>Fri, 07 Jun 2013 05:18:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-520958-2</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss">Hyperion - Fixing null character w/ invalid login</source>
      </item>
      <item>
        <title>Hyperion - Fixing null character w/ invalid login</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>In the initial release of Hyperion, if you were to login with no credentials, you would get return code 11 (please try again) and a null character would spawn at the default location, this snippet fixes that.</p>
<p>Within the World class replace <span class="bbcode-i">load(PlayerDetails)</span> with:</p>
<p><code>
	public void load(final PlayerDetails pd) {
		engine.submitWork(new Runnable() {
			@Override
			public void run() {
				LoginResult lr = loader.checkLogin(pd);
				int code = lr.getReturnCode();
				if (code == 2) {
					lr.getPlayer().getSession().setAttribute("player", lr.getPlayer());
					loader.loadPlayer(lr.getPlayer());
					engine.pushTask(new SessionLoginTask(lr.getPlayer()));
				} else {
					PacketBuilder bldr = new PacketBuilder();
					bldr.put((byte) code);
					pd.getSession().write(bldr.toPacket()).addListener(new IoFutureListener&lt;IoFuture&gt;() {
						@Override
						public void operationComplete(IoFuture future) {
							future.getSession().close(false);
						}
					});
				}
			}
		});
	}</code></p>
<p>and replace <span class="bbcode-i">register(Player)</span> with:</p>
<p><code>
	public void register(final Player player) {
		// do final checks e.g. is player online? is world full?
		int returnCode = 2;
		if (!NameUtils.isValidName(player.getName())) {
			returnCode = 11;
		} else if (isPlayerOnline(player.getName())) {
			returnCode = 5;
		} else {
			if (!players.add(player)) {
				returnCode = 7;
				logger.info("Could not register player : " + player + " [world full]");
			}
		}
		final int finalReturnCode = returnCode;
		PacketBuilder bldr = new PacketBuilder();
		bldr.put((byte) returnCode);
		bldr.put((byte) player.getRights().toInteger());
		bldr.put((byte) 0);
		player.getSession().write(bldr.toPacket()).addListener(new IoFutureListener&lt;IoFuture&gt;() {
			@Override
			public void operationComplete(IoFuture future) {
				if (finalReturnCode != 2) {
					player.getSession().close(false);
				} else {
					player.getActionSender().sendLogin();
				}
			}
		});
		if (returnCode == 2) {
			logger.info("Registered player : " + player + " [online=" + players.size() + "]");
		}
	}</code></p>
<p>Bam, fixed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958/1</link>
        <pubDate>Fri, 07 Jun 2013 04:49:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-520958-1</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-fixing-null-character-w-invalid-login/520958.rss">Hyperion - Fixing null character w/ invalid login</source>
      </item>
  </channel>
</rss>
