<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Auto Vote NullPointerException</title>
    <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967</link>
    <description>So I setup the runelocus auto vote with callback system, and for some reason, when I try to claim the reward, it throws this error in the server cmd.
[code]
java.lang.NullPointerException
        at com.rs.utils.Vote.checkVote(Vote.java:75)
        at com.rs.game.player.content.Commands.processNormalCommand(Commands.jav
a:2993)
        at com.rs.game.player.content.Commands.processCommand(Commands.java:87)
        at com.rs.net.decoders.WorldPacketsDecoder.processPackets(WorldPacketsDe
coder.java:1460)
        at com.rs.net.decoders.WorldPacketsDecoder.decode(WorldPacketsDecoder.ja
va:251)
        at com.rs.net.ServerChannelHandler.messageReceived(ServerChannelHandler.
java:96)
        at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleCha
nnelHandler.java:95)
        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultCh
annelPipeline.java:564)
        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultCh
annelPipeline.java:559)
        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:26
8)
        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:25
5)
        at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:94)
        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.processSelectedK
eys(AbstractNioWorker.java:372)
        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioW
orker.java:246)
        at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:38)
        at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnabl
e.java:102)
        at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProof
Worker.java:42)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.
java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor
.java:617)
        at java.lang.Thread.run(Thread.java:745)
[/code]

Now I made the command to claim the reward myself, and I&#39;m not entirely sure if it&#39;s correct.
[code]if (cmd[0].equalsIgnoreCase(&quot;reward&quot;)) {
				if (Vote.checkVote(player.getUsername())) {
            				int tokens = Vote.getVotes(player.getUsername()); //Number of times this user has voted. Number of unclaimed votes.
 					player.getInventory().addItem(995, 20000000 * tokens); // adds 50,000 * token amount of coins to the player&#39;s inventory.
            				Vote.removeVotes(player.getUsername());
        			} else {
            				player.getPackets().sendGameMessage(&quot;You either have not voted, already claimed your reward, or there was an error.&quot;);
            				player.getPackets().sendGameMessage(&quot;Either try again in a few minutes, or contact a staff member.&quot;);
        			}
    			}[/code]

Here is my vote.java that I based my vote command off of.
[code]package com.rs.utils;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import com.rs.game.player.Player;
 
public class Vote {
 
    private static Connection con = null;
    private static Statement stmt;
 
    public static void createConnection() {
        try {
            Class.forName(&quot;com.mysql.jdbc.Driver&quot;).newInstance();
            String IP=&quot;Classified&quot;;
            String DB=&quot;Classified&quot;;
            String User=&quot;Classified&quot;;
            String Pass=&quot;Classified&quot;;
            con = DriverManager.getConnection(&quot;jdbc:mysql://&quot;+IP+&quot;/&quot;+DB, User, Pass);
            stmt = con.createStatement();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
 
    public static void claimVote(Player player) {
        createConnection();
        if (checkVote(player.getUsername())) {
            int tokens = getVotes(player.getUsername()); //Number of times this user has voted. Number of unclaimed votes.
 
            //methods for giving rewards to players goes here.
            //for example, I might give a user 50,000 coins per 1 time they voted, so I would do:
            player.getInventory().addItem(995, 20000000 * tokens); // adds 50,000 * token amount of coins to the player&#39;s inventory.
 
            //remove votes after user as claimed.
            removeVotes(player.getUsername());
        } else {
            player.getPackets().sendGameMessage(&quot;You either have not voted, already claimed your reward, or there was an error.&quot;);
            player.getPackets().sendGameMessage(&quot;Either try again in a few minutes, or contact a staff member.&quot;);
        }
    }
 
    private static ResultSet query(String s) throws SQLException {
        try {
            if (s.toLowerCase().startsWith(&quot;select&quot;)) {
                ResultSet rs = stmt.executeQuery(s);
                return rs;
            } else {
                stmt.executeUpdate(s);
            }
            return null;
        } catch (Exception e) {
            destroyConnection();
            createConnection();
        }
        return null;
    }
 
    private static void destroyConnection() {
        try {
            stmt.close();
            con.close();
        } catch (Exception e) {
 
        }
    }
 
    public static boolean checkVote(String playerName) {
        try {
            String name2 = playerName.replaceAll(&quot;_&quot;, &quot; &quot;);
            Statement statement = con.createStatement();
            String query = &quot;SELECT * FROM players WHERE username = &#39;&quot; + name2 + &quot;&#39;&quot;;
            ResultSet results = statement.executeQuery(query);
                while(results.next()) {
                    int tokens = results.getInt(&quot;tokens&quot;);
                    if(tokens &gt;= 0) {
                         return true;
                    }
                }
        } catch(SQLException e) {
            e.printStackTrace();
        }
        return false;
    }
 
    public static int getVotes(String playerName) {
        try {
            String name2 = playerName.replaceAll(&quot;_&quot;, &quot; &quot;);
            Statement statement = con.createStatement();
            String query = &quot;SELECT * FROM players WHERE username = &#39;&quot; + name2 + &quot;&#39;&quot;;
            ResultSet results = statement.executeQuery(query);
            while(results.next()) {
                int tokens = results.getInt(&quot;productid&quot;);
                if(tokens &gt;= 1) {
                    return tokens;
                }
            }
            } catch(SQLException e) {
                e.printStackTrace();
            }
            return 0;
    }
 
    public static boolean removeVotes(String playerName) {
        try {
            String name2 = playerName.replaceAll(&quot;_&quot;, &quot; &quot;);
            query(&quot;DELETE FROM `players` WHERE username = &#39;&quot;+name2+&quot;&#39;;&quot;);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }
 
}[/code]</description>
    
    <lastBuildDate>Thu, 25 Jun 2015 22:30:44 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="551967">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/hairynips/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> HairyNips:</div>
<blockquote>
<p>I’m not entirely sure what you mean.</p>
</blockquote>
</aside>
<p>If two threads are running at the same time:</p>
<p>Thread A:<br>
con gets initialized.<br>
does other stuff<br>
Thread B:<br>
con gets reinitalized.(but static, so replaced first one)<br>
Thread A:<br>
con gets closed<br>
Thread B:<br>
attempts to use con – error.<br>
wrappingUp:</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/7</link>
        <pubDate>Thu, 25 Jun 2015 22:30:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-7</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@zyle1992 Zymus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zyle1992">@zyle1992</a> wrote:</p>
          <blockquote>
              <p>Can you find anywhere that createConnection() is called?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/6</link>
        <pubDate>Wed, 17 Jun 2015 04:53:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-6</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@HairyNips HairyNips]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hairynips">@HairyNips</a> wrote:</p>
          <blockquote>
              <p>If I’m honest, I have no clue what to do, even knowing that con is null</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/5</link>
        <pubDate>Wed, 17 Jun 2015 03:58:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-5</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@zyle1992 Zymus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zyle1992">@zyle1992</a> wrote:</p>
          <blockquote>
              <p>con is null.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/4</link>
        <pubDate>Mon, 15 Jun 2015 22:43:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-4</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@HairyNips HairyNips]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hairynips">@HairyNips</a> wrote:</p>
          <blockquote>
              <p>I’m not entirely sure what you mean.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/3</link>
        <pubDate>Mon, 15 Jun 2015 22:30:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-3</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>is it possible for this code to be accessed in parallel?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/2</link>
        <pubDate>Sat, 13 Jun 2015 04:03:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-2</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
      <item>
        <title>Auto Vote NullPointerException</title>
        <dc:creator><![CDATA[@HairyNips HairyNips]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hairynips">@HairyNips</a> wrote:</p>
          <blockquote>
              <p>So I setup the runelocus auto vote with callback system, and for some reason, when I try to claim the reward, it throws this error in the server cmd.</p>
<pre><code class="lang-auto">java.lang.NullPointerException
        at com.rs.utils.Vote.checkVote(Vote.java:75)
        at com.rs.game.player.content.Commands.processNormalCommand(Commands.jav
a:2993)
        at com.rs.game.player.content.Commands.processCommand(Commands.java:87)
        at com.rs.net.decoders.WorldPacketsDecoder.processPackets(WorldPacketsDe
coder.java:1460)
        at com.rs.net.decoders.WorldPacketsDecoder.decode(WorldPacketsDecoder.ja
va:251)
        at com.rs.net.ServerChannelHandler.messageReceived(ServerChannelHandler.
java:96)
        at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleCha
nnelHandler.java:95)
        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultCh
annelPipeline.java:564)
        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultCh
annelPipeline.java:559)
        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:26
8)
        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:25
5)
        at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:94)
        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.processSelectedK
eys(AbstractNioWorker.java:372)
        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioW
orker.java:246)
        at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:38)
        at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnabl
e.java:102)
        at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProof
Worker.java:42)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.
java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor
.java:617)
        at java.lang.Thread.run(Thread.java:745)</code></pre>
<p>Now I made the command to claim the reward myself, and I’m not entirely sure if it’s correct.</p>
<p><code>if (cmd[0].equalsIgnoreCase("reward")) {
				if (Vote.checkVote(player.getUsername())) {
            				int tokens = Vote.getVotes(player.getUsername()); //Number of times this user has voted. Number of unclaimed votes.
 					player.getInventory().addItem(995, 20000000 * tokens); // adds 50,000 * token amount of coins to the player's inventory.
            				Vote.removeVotes(player.getUsername());
        			} else {
            				player.getPackets().sendGameMessage("You either have not voted, already claimed your reward, or there was an error.");
            				player.getPackets().sendGameMessage("Either try again in a few minutes, or contact a staff member.");
        			}
    			}</code></p>
<p>Here is my vote.java that I based my vote command off of.</p>
<p>[code]package com.rs.utils;</p>
<p>import java.sql.Connection;<br>
import java.sql.DriverManager;<br>
import java.sql.ResultSet;<br>
import java.sql.SQLException;<br>
import java.sql.Statement;</p>
<p>import com.rs.game.player.Player;</p>
<p>public class Vote {</p>
<pre><code>private static Connection con = null;
private static Statement stmt;

public static void createConnection() {
    try {
        Class.forName("com.mysql.jdbc.Driver").newInstance();
        String IP="Classified";
        String DB="Classified";
        String User="Classified";
        String Pass="Classified";
        con = DriverManager.getConnection("jdbc:mysql://"+IP+"/"+DB, User, Pass);
        stmt = con.createStatement();
    } catch (Exception e) {
        e.printStackTrace();
    }
}

public static void claimVote(Player player) {
    createConnection();
    if (checkVote(player.getUsername())) {
        int tokens = getVotes(player.getUsername()); //Number of times this user has voted. Number of unclaimed votes.

        //methods for giving rewards to players goes here.
        //for example, I might give a user 50,000 coins per 1 time they voted, so I would do:
        player.getInventory().addItem(995, 20000000 * tokens); // adds 50,000 * token amount of coins to the player's inventory.

        //remove votes after user as claimed.
        removeVotes(player.getUsername());
    } else {
        player.getPackets().sendGameMessage("You either have not voted, already claimed your reward, or there was an error.");
        player.getPackets().sendGameMessage("Either try again in a few minutes, or contact a staff member.");
    }
}

private static ResultSet query(String s) throws SQLException {
    try {
        if (s.toLowerCase().startsWith("select")) {
            ResultSet rs = stmt.executeQuery(s);
            return rs;
        } else {
            stmt.executeUpdate(s);
        }
        return null;
    } catch (Exception e) {
        destroyConnection();
        createConnection();
    }
    return null;
}

private static void destroyConnection() {
    try {
        stmt.close();
        con.close();
    } catch (Exception e) {

    }
}

public static boolean checkVote(String playerName) {
    try {
        String name2 = playerName.replaceAll("_", " ");
        Statement statement = con.createStatement();
        String query = "SELECT * FROM players WHERE username = '" + name2 + "'";
        ResultSet results = statement.executeQuery(query);
            while(results.next()) {
                int tokens = results.getInt("tokens");
                if(tokens &gt;= 0) {
                     return true;
                }
            }
    } catch(SQLException e) {
        e.printStackTrace();
    }
    return false;
}

public static int getVotes(String playerName) {
    try {
        String name2 = playerName.replaceAll("_", " ");
        Statement statement = con.createStatement();
        String query = "SELECT * FROM players WHERE username = '" + name2 + "'";
        ResultSet results = statement.executeQuery(query);
        while(results.next()) {
            int tokens = results.getInt("productid");
            if(tokens &gt;= 1) {
                return tokens;
            }
        }
        } catch(SQLException e) {
            e.printStackTrace();
        }
        return 0;
}

public static boolean removeVotes(String playerName) {
    try {
        String name2 = playerName.replaceAll("_", " ");
        query("DELETE FROM `players` WHERE username = '"+name2+"';");
    } catch (Exception e) {
        e.printStackTrace();
        return false;
    }
    return true;
}
</code></pre>
<p>}[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967/1</link>
        <pubDate>Fri, 12 Jun 2015 17:49:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551967-1</guid>
        <source url="https://forum.moparisthebest.com/t/auto-vote-nullpointerexception/551967.rss">Auto Vote NullPointerException</source>
      </item>
  </channel>
</rss>
