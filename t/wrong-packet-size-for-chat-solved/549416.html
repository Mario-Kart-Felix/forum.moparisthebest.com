<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Wrong packet size for chat [solved] - Runescape - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m having a problem with having the wrong data for the chat packet. When talking in chat it will disconnect me and after unpacking the bytes to string format it&amp;#39;s obviously corrupt. 

I asked help for this already but t&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="549416.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Wrong packet size for chat [solved]&#39;" href="549416.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416" />
<meta property="og:title" content="Wrong packet size for chat [solved]" />
<meta name="twitter:title" content="Wrong packet size for chat [solved]" />
<meta property="og:description" content="I’m having a problem with having the wrong data for the chat packet.  When talking in chat it will disconnect me and after unpacking the bytes to string format it’s obviously corrupt.  I asked help for this already but there I wasn’t able to find what’s wrong yet, now I do. Other thread  I printed out packet sizes on mine and another server and they do NOT match.  The only place that it could be wrong as far as I know would be my packet decoding.  But other packet sizes (not the chat packet) see..." />
<meta name="twitter:description" content="I’m having a problem with having the wrong data for the chat packet.  When talking in chat it will disconnect me and after unpacking the bytes to string format it’s obviously corrupt.  I asked help for this already but there I wasn’t able to find what’s wrong yet, now I do. Other thread  I printed out packet sizes on mine and another server and they do NOT match.  The only place that it could be wrong as far as I know would be my packet decoding.  But other packet sizes (not the chat packet) see..." />
<meta property="article:published_time" content="2015-01-26T13:20:32+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="next" href="5494164658.html?page=2">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="549416.html">Wrong packet size for chat [solved]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T13:20:32Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:21Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m having a problem with having the wrong data for the chat packet.<br>
When talking in chat it will disconnect me and after unpacking the bytes to string format it’s obviously corrupt.</p>
<p>I asked help for this already but there I wasn’t able to find what’s wrong yet, now I do. <a href="https://www.moparisthebest.com/smf/index.php/topic,668300.0.html" data-bbcode="true" rel="nofollow noopener">Other thread</a></p>
<p>I printed out packet sizes on mine and another server and they do <span class="bbcode-b">NOT</span> match.<br>
The only place that it could be wrong as far as I know would be my packet decoding.<br>
But other packet sizes (not the chat packet) seem to be right according to the few tests I did,<br>
so I don’t understand how it’s wrong for the chat packet.</p>
<p>Packet decoder where the size is retrieved.<br>
The packet size from the array for the chat packet is -1 which is definitely right.</p>
<pre><code class="lang-auto">@Override
	protected void decode(ChannelHandlerContext context, ByteBuf buffer, List&lt;Object&gt; out) throws Exception {
		if (!context.channel().isOpen() || !context.channel().isActive()) {
			buffer.skipBytes(buffer.readableBytes());
			return;
		}
		if (opcode == -1) {
			if (buffer.readableBytes() &lt; 1) {
				buffer.release();
				return;
			}
			opcode = buffer.readByte() &amp; 0xFF;
			opcode = opcode - player.getConnection().getDecryptor().getNextValue() &amp; 0xFF;
			size = PACKET_SIZES[opcode];
		}
		if (size == -1) {
			if (buffer.readableBytes() &lt; 1) {
				buffer.release();
				return;
			}
			size = buffer.readByte() &amp; 0xFF;
		}
		if (buffer.readableBytes() &gt;= size) {
			final byte[] data = new byte[size];
			buffer.readBytes(data);
			final ByteBuf payload = Unpooled.buffer(size);
			payload.writeBytes(data);
			System.out.println("size: " + size);
			try {
				out.add(new PacketDisassembler(payload, opcode, size));
			} finally {
				opcode = -1;
				size = -1;
			}
		}
	}</code></pre>
<p>Ideas?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T18:22:40Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:23Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Can you post the PACKET_SIZES from client and server, and the opcode for the chat packet?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T19:07:30Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:23Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="2" data-topic="549416">
<div class="title">
<div class="quote-controls"></div>
 Zymus:</div>
<blockquote>
<p>Can you post the PACKET_SIZES from client and server, and the opcode for the chat packet?</p>
</blockquote>
</aside>
<p>I tried 2 clients so I’d be surprised if the problem is client sided.</p>
<p>Chat is opcode: <span class="bbcode-b">4</span></p>
<p>Server sided packet sizes:</p>
<pre><code class="lang-auto">private static final int PACKET_SIZES[] = { 
		0, 0, 0, 1, -1, 0, 0, 0, 0, 0, // 0
		0, 0, 0, 0, 8, 0, 6, 2, 2, 0, // 10
		0, 2, 0, 6, 0, 12, 0, 0, 0, 0, // 20
		0, 0, 0, 0, 0, 8, 4, 0, 0, 2, // 30
		2, 6, 0, 6, 0, -1, 0, 0, 0, 0, // 40
		0, 0, 0, 12, 0, 0, 0, 8, 8, 12, // 50
		8, 8, 0, 0, 0, 0, 0, 0, 0, 0, // 60
		6, 0, 2, 2, 8, 6, 0, -1, 0, 6, // 70
		0, 0, 0, 0, 0, 1, 4, 6, 0, 0, // 80
		0, 0, 0, 0, 0, 3, 0, 0, -1, 0, // 90
		0, 13, 0, -1, 0, 0, 0, 0, 0, 0,// 100
		0, 0, 0, 0, 0, 0, 0, 6, 0, 0, // 110
		1, 0, 6, 0, 0, 0, -1, 0, 2, 6, // 120
		0, 4, 6, 8, 0, 6, 0, 0, 0, 2, // 130
		0, 0, 0, 0, 0, 6, 0, 0, 0, 0, // 140
		0, 0, 1, 2, 0, 2, 6, 0, 0, 0, // 150
		0, 0, 0, 0, -1, -1, 0, 0, 0, 0,// 160
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 170
		0, 8, 0, 3, 0, 2, 0, 0, 8, 1, // 180
		0, 0, 12, 0, 0, 0, 0, 0, 0, 0, // 190
		2, 0, 0, 0, 0, 0, 0, 0, 4, 0, // 200
		4, 0, 0, 0, 7, 8, 0, 0, 10, 0, // 210
		0, 0, 0, 0, 0, 0, -1, 0, 6, 0, // 220
		1, 0, 0, 0, 6, 0, 6, 8, 1, 0, // 230
		0, 4, 0, 0, 0, 0, -1, 0, -1, 4,// 240
		0, 0, 6, 6, 0, 0, 0 // 250
	};</code></pre>
<p>Client sided packet sizes:</p>
<pre><code class="lang-auto">public static final int[] packetSizes = {
		0, 0, 0, 0, 6, 0, 0, 0, 4, 0, 
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
		0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 
		0, 0, 0, 0, -2, 4, 3, 0, 0, 0, 
		0, 0, 0, 0, 5, 0, 0, 6, 0, 0, 
		9, 0, 0, -2, 0, 0, 0, 0, 0, 0, 
		-2, 1, 0, 0, 2, -2, 0, 0, 0, 0, 
		6, 3, 2, 4, 2, 4, 0, 0, 0, 4, 
		0, -2, 0, 0, 7, 2, 0, 6, 0, 0, 
		0, 0, 0, 0, 0, 0, 0, 2, 0, 1, 
		0, 2, 0, 0, -1, 4, 1, 0, 0, 0, 
		1, 0, 0, 0, 2, 0, 0, 15, 0, 0, 
		0, 4, 4, 0, 0, 0, -2, 0, 0, 0, 
		0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 
		0, 0, 2, 0, 0, 0, 0, 14, 0, 0, 
		0, 4, 0, 0, 0, 0, 3, 0, 0, 0, 
		4, 0, 0, 0, 2, 0, 6, 0, 0, 0, 
		0, 3, 0, 0, 5, 0, 10, 6, 0, 0, 
		0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 
		0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 
		4, 0, 0, 0, 0, 0, 3, 0, 2, 0, 
		0, 0, 0, 0, -2, 7, 0, -2, 2, 0, 
		0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
		8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
		2, -2, 0, 0, 0, 0, 6, 0, 4, 3, 
		0, 0, 0, -1, 6, 0, 0
	};</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T19:19:22Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:23Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Is it opcode 4 both sending to the client and to the server?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T19:27:08Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:23Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="4" data-topic="549416">
<div class="title">
<div class="quote-controls"></div>
 Zymus:</div>
<blockquote>
<p>Is it opcode 4 both sending to the client and to the server</p>
</blockquote>
</aside>
<p>Wut? The client receives it with the player update procedure as it’s a player state update.<br>
Server receives it under opcode 4 yes.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T19:59:46Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:24Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Can you post the client send chat packet code? It may be an issue where it’s looking for ± 128</p>
<p>Also, can you post your chat packet decoder?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T20:01:58Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:24Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:6, topic:549416”]Can you post the client send chat packet code? It may be an issue where it’s looking for ± 128</p>
<p>Also, can you post your chat packet decoder?[/quote]</p>
<pre><code class="lang-auto">stream.createFrame(4);
						stream.writeWordBigEndian(0);
						int j3 = stream.currentOffset;
						stream.method425(i3);
						stream.method425(j2);
						aStream_834.currentOffset = 0;
						TextInput.method526(inputString, aStream_834);
						stream.method441(0, aStream_834.buffer, aStream_834.currentOffset);
						stream.writeBytes(stream.currentOffset - j3);</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T20:13:42Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:25Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:7, topic:549416”][quote author=Zymus link=topic=668319.msg4469697#msg4469697 date=1422302386]<br>
Can you post the client send chat packet code? It may be an issue where it’s looking for ± 128</p>
<p>Also, can you post your chat packet decoder?<br>
[/quote]</p>
<p><code>
stream.createFrame(4);
						stream.writeWordBigEndian(0);
						int j3 = stream.currentOffset;
						stream.method425(i3);
						stream.method425(j2);
						aStream_834.currentOffset = 0;
						TextInput.method526(inputString, aStream_834);
						stream.method441(0, aStream_834.buffer, aStream_834.currentOffset);
						stream.writeBytes(stream.currentOffset - j3);
</code>[/quote]</p>
<p>And opcode is definitely being parsed as 4 correct? Do you have a server/client pair that is working correctly?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T20:15:54Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:25Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:8, topic:549416”][quote author=RandQm link=topic=668319.msg4469699#msg4469699 date=1422302518]</p>
<aside class="quote">
<blockquote>
<p>Can you post the client send chat packet code? It may be an issue where it’s looking for ± 128</p>
<p>Also, can you post your chat packet decoder?</p>
</blockquote>
</aside>
<pre><code class="lang-auto">stream.createFrame(4);
						stream.writeWordBigEndian(0);
						int j3 = stream.currentOffset;
						stream.method425(i3);
						stream.method425(j2);
						aStream_834.currentOffset = 0;
						TextInput.method526(inputString, aStream_834);
						stream.method441(0, aStream_834.buffer, aStream_834.currentOffset);
						stream.writeBytes(stream.currentOffset - j3);</code></pre>
<p>[/quote]</p>
<p>And opcode is definitely being parsed as 4 correct? Let me whip up a quick test and check something.[/quote]<br>
Yes I’m sure it is as “packet 4” is being handled.</p>
<pre><code class="lang-auto">@Override
	public void handle(Player player, PacketDisassembler packet) {
		int effects = packet.getSubtrahendByte();
		int color = packet.getSubtrahendByte();
		int chatLength = (packet.getLength() - 2);
		byte[] text = packet.readAdditionalBytesReverse(chatLength);

		if (effects &lt; 0 || color &lt; 0 || chatLength &lt; 0 || text == null)
			return;

		player.addStateUpdate(new ChatState(text, color, effects))
	}</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T20:21:48Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:25Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>All right, and can you post the code for the following methods?</p>
<p>packet.getSubtrahendByte<br>
packet.readAdditionalBytesReverse<br>
stream.writeWordBigEndian<br>
stream.method425<br>
stream.method441<br>
stream.writeBytes</p>
<p>EDIT: I think it may be this whole</p>
<p><code>
stream.writeWordBigEndian(0);</code><br>
bit. For anything to be “big endian”, there must be at least 2 of something. I’m guessing this is a placeholder for the chat size. Because when you’re reading it, you’re expecting</p>
<p><code>
byte: 4|byte: size|byte: effect|byte: color|byte[]: data</code></p>
<p>but it’s being written as</p>
<p><code>
byte:4|byte[2]: size|byte: effect|byte:color|byte[]: data</code></p>
<p>So try changing the packet size to -2 and see if it works? If it does, you can either keep it that way (I’m not sure if there would be any text decoding issues with large strings), or have the client write 1 byte for the size instead of 2.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T21:01:57Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:26Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:10, topic:549416”]All right, and can you post the code for the following methods?</p>
<p>packet.getSubtrahendByte<br>
packet.readAdditionalBytesReverse<br>
stream.writeWordBigEndian<br>
stream.method425<br>
stream.method441<br>
stream.writeBytes</p>
<p>EDIT: I think it may be this whole</p>
<p><code>
stream.writeWordBigEndian(0);</code><br>
bit. For anything to be “big endian”, there must be at least 2 of something. I’m guessing this is a placeholder for the chat size. Because when you’re reading it, you’re expecting</p>
<p><code>
byte: 4|byte: size|byte: effect|byte: color|byte[]: data</code></p>
<p>but it’s being written as</p>
<p><code>
byte:4|byte[2]: size|byte: effect|byte:color|byte[]: data</code></p>
<p>So try changing the packet size to -2 and see if it works? If it does, you can either keep it that way (I’m not sure if there would be any text decoding issues with large strings), or have the client write 1 byte for the size instead of 2.[/quote]</p>
<p>int chatLength = (packet.getLength() - 2);</p>
<p>it already substracts those 2</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T21:40:26Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:26Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:11, topic:549416”][quote author=Zymus link=topic=668319.msg4469705#msg4469705 date=1422303708]<br>
All right, and can you post the code for the following methods?</p>
<p>packet.getSubtrahendByte<br>
packet.readAdditionalBytesReverse<br>
stream.writeWordBigEndian<br>
stream.method425<br>
stream.method441<br>
stream.writeBytes</p>
<p>EDIT: I think it may be this whole</p>
<p><code>
stream.writeWordBigEndian(0);</code><br>
bit. For anything to be “big endian”, there must be at least 2 of something. I’m guessing this is a placeholder for the chat size. Because when you’re reading it, you’re expecting</p>
<p><code>
byte: 4|byte: size|byte: effect|byte: color|byte[]: data</code></p>
<p>but it’s being written as</p>
<p><code>
byte:4|byte[2]: size|byte: effect|byte:color|byte[]: data</code></p>
<p>So try changing the packet size to -2 and see if it works? If it does, you can either keep it that way (I’m not sure if there would be any text decoding issues with large strings), or have the client write 1 byte for the size instead of 2.<br>
[/quote]</p>
<p>int chatLength = (packet.getLength() - 2);</p>
<p>it already substracts those 2[/quote]</p>
<p>I think the 2 it’s subtracting are for the effects and colors. It seems like it’s doing</p>
<p><code>
4|0|0|effect|color|text</code></p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T21:49:50Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:27Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>As I said I tried using another client (official mscp) and the problem was the same so I can’t believe it’s caused client sided.<br>
I also checked another source how they handle it and I’m doing the same.<br>
Tell me what code you all want to see and I’ll dump it all together.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T21:51:27Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:27Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:13, topic:549416”]As I said I tried using another client (official mscp) and the problem was the same so I can’t believe it’s caused client sided.<br>
I also checked another source how they handle it and I’m doing the same.<br>
Tell me what code you all want to see and I’ll dump it all together.[/quote]</p>
<p>On the server side, try changing the PACKET_SIZE[4] to -2 instead of -1 and try. If it doesn’t work, then post the following methods:</p>
<p><code>
packet.getSubtrahendByte
packet.readAdditionalBytesReverse
stream.writeWordBigEndian
stream.method425
stream.method441
stream.writeBytes</code></p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T21:58:26Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:27Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">	public byte getSubtrahendByte() {
		return (byte) (128 - getByte());
	}

	public byte[] readAdditionalBytesReverse(int amount) {
		byte[] data = new byte[amount];
		int dataPosition = 0;
		
		for (int i = getBuffer().readerIndex() + amount - 1; i &gt;= getBuffer().readerIndex(); i--)
			data[dataPosition++] = getAdditionalByte();
		
		return data;
	}</code></pre>
<pre><code class="lang-auto">	public void writeWordBigEndian(int i) {
		buffer[currentOffset++] = (byte)i;
	}

	public void method425(int j) {
		buffer[currentOffset++] = (byte)(128 - j);
	}

	public void method441(int i, byte abyte0[], int j) {
		for(int k = (i + j) - 1; k &gt;= i; k--)
			buffer[currentOffset++] = (byte)(abyte0[k] + 128);

	}

	public void writeBytes(byte abyte0[], int i, int j) {
		for(int k = j; k &lt; j + i; k++)
			buffer[currentOffset++] = abyte0[k];
	}</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-26T23:24:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:28Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>And does <span class="bbcode-i">getAdditionalByte</span> do basically</p>
<pre><code class="lang-auto">return (byte) (getByte() + 128);</code></pre>
<p>?</p>
<p>Also, when you say the sizes are different, if you enter the same string into both, what is the size reported by each?</p>
<p>EDIT: Wait, post your getByte() method.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T15:40:28Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:35Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:16, topic:549416”]And does <span class="bbcode-i">getAdditionalByte</span> do basically</p>
<pre><code class="lang-auto">return (byte) (getByte() + 128);</code></pre>
<p>?</p>
<p>Also, when you say the sizes are different, if you enter the same string into both, what is the size reported by each?</p>
<p>EDIT: Wait, post your getByte() method.[/quote]<br>
The size is always (amount of chars + 1) now, yesterday it was +2 lol, no clue how that happens.</p>
<pre><code class="lang-auto">Server sided, received chat packet (opcode: 4)
  Entered text: "lol"
  Unpacked text from the bytes: "l o  "
  Size: 3

Client sided error at dispatching the updated chat:
  "Error: Error packet size mismatch in getplayer pos:3 psize:2"</code></pre>
<p>Here’s everything I can think of that is related:</p>
<p><span class="bbcode-b">Chat packet listener:</span><br>
<a href="http://pastebin.com/1D1pwJWj" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/1D1pwJWj</a></p>
<p><span class="bbcode-b">Packet disassembler</span><br>
<a href="http://pastebin.com/VCUPAqzr" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/VCUPAqzr</a></p>
<p><span class="bbcode-b">Packet decoder</span><br>
<a href="http://pastebin.com/6W9TVGmG" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/6W9TVGmG</a></p>
<p><span class="bbcode-b">Chat state (player updating)</span><br>
<a href="http://pastebin.com/SqnvYgci" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/SqnvYgci</a></p>
<p><span class="bbcode-b">Packet assembler</span><br>
<a href="http://pastebin.com/KYnVNbNd" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/KYnVNbNd</a></p>
<p><span class="bbcode-b">Text unpacking</span><br>
<a href="http://pastebin.com/KxKa3rCQ" class="onebox" target="_blank" rel="nofollow noopener">http://pastebin.com/KxKa3rCQ</a></p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T16:56:38Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:36Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:17, topic:549416”][quote author=Zymus link=topic=668319.msg4469743#msg4469743 date=1422314659]<br>
And does <span class="bbcode-i">getAdditionalByte</span> do basically</p>
<pre><code class="lang-auto">return (byte) (getByte() + 128);</code></pre>
<p>?</p>
<p>Also, when you say the sizes are different, if you enter the same string into both, what is the size reported by each?</p>
<p>EDIT: Wait, post your getByte() method.<br>
[/quote]<br>
The size is always (amount of chars + 1) now, yesterday it was +2 lol, no clue how that happens.</p>
<pre><code class="lang-auto">Server sided, received chat packet (opcode: 4)
  Entered text: "lol"
  Unpacked text from the bytes: "l o  "
  Size: 3

Client sided error at dispatching the updated chat:
  "Error: Error packet size mismatch in getplayer pos:3 psize:2"</code></pre>
<p>Here’s everything I can think of that is related:</p>
<p><span class="bbcode-b">Chat packet listener:</span><br>
<a href="http://pastebin.com/1D1pwJWj" class="onebox" target="_blank">http://pastebin.com/1D1pwJWj</a></p>
<p><span class="bbcode-b">Packet disassembler</span><br>
<a href="http://pastebin.com/VCUPAqzr" class="onebox" target="_blank">http://pastebin.com/VCUPAqzr</a></p>
<p><span class="bbcode-b">Packet decoder</span><br>
<a href="http://pastebin.com/6W9TVGmG" class="onebox" target="_blank">http://pastebin.com/6W9TVGmG</a></p>
<p><span class="bbcode-b">Chat state (player updating)</span><br>
<a href="http://pastebin.com/SqnvYgci" class="onebox" target="_blank">http://pastebin.com/SqnvYgci</a></p>
<p><span class="bbcode-b">Packet assembler</span><br>
<a href="http://pastebin.com/KYnVNbNd" class="onebox" target="_blank">http://pastebin.com/KYnVNbNd</a></p>
<p><span class="bbcode-b">Text unpacking</span><br>
<a href="http://pastebin.com/KxKa3rCQ%5B/quote%5D" class="onebox" target="_blank">http://pastebin.com/KxKa3rCQ[/quote]</a></p>
<p>Alright, give me a couple of minutes and I’ll see what I can come up with.</p>
<p>Actually, can you also post the chat parsing block on the client side?</p>
<p>EDIT:</p>
<p>Okay I think I know what the issue is. It seems like your readReverseBytesAdditional is slightly broken. Specifically, the for loop:</p>
<p><code>
for (int i = getBuffer().readerIndex() + amount - 1; i &gt;= getBuffer().readerIndex(); i--)</code><br>
and using</p>
<p><code>
getBuffer().readByte();</code><br>
to read the data. Because when you call</p>
<p><code>
readByte();</code> on a ByteBuf from netty, it advances the position of the reader index. And since your checking statement calls reader index, it will only ever process half (well, <span class="bbcode-i">just over</span> half) of the data.</p>
<p>To prove this, you can use the following class:</p>
<pre><code class="lang-auto">public class TestThing {

    public static void main(String[] args) {
        final TestThing test = new TestThing();
        test.setPosition(0);
        for (int i = test.readerPosition() + 10; i &gt;= test.readerPosition(); i--) {
            test.read();
            System.out.println(i);
        }
    }

    public void read() {
        position++;
    }
    
    public int readerPosition() {
        return position;
    }
    
    public void setPosition(final int position) {
        this.position = position;
    }

    private int position;
}</code></pre>
<p>which is following the same process as what netty does in the background. The expected output would be to see it going from 10 to 0, but actually it goes</p>
<pre><code class="lang-auto">10
9
8
7
6
5</code></pre>
<p>because it’s checking the reader index (which is increasing) at every iteration.</p>
<p>Now, for the fix. To test, you could change it to</p>
<p><code>
final int currentPosition = getBuffer().readerPosition();
final int startPosition = currentPosition + amount - 1;
for (int i = startPosition; i &gt;= currentPosition; i--) {</code></p>
<p>and see if that works.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T18:14:22Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:37Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#19</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">	public byte[] getAdditionalBytesReversed(int amount) {
		byte[] data = new byte[amount];
		
		final int currentPosition = getBuffer().readerIndex();
		final int startPosition = currentPosition + amount - 1;
		
		for (int i = startPosition; i &gt;= currentPosition; i--) {
			data[i] = getAdditionalByte();
		}
		return data;</code></pre>
<p>So I think you mean it like this?<br>
It’s not working so either I’m not getting you completely or it’s just not the issue.</p>
<p><span class="bbcode-b">Edit:</span> You got me thinking and I realized the previous method is way to complicated for what it does lol.<br>
Still not working do.</p>
<pre><code class="lang-auto">	public byte[] getAdditionalBytesReversed(int amount) {
		byte[] data = new byte[amount];
		
		for (int i = amount - 1; i &gt;= 0; i --) {
			data[i] = getAdditionalByte();
		}
		return data;
	}</code></pre>
<p>Output for “lol”<br>
(“size” is the size of byte[] data)</p>
<p><code>
index: 2, size: 1
unpacked:  
index: 1, size: 2
unpacked:   o
index: 0, size: 3
unpacked: l o l
size: 3, text:  l o l</code><br>
This one didn’t disconnect me, but when I did another input “derp” it was messed up again and dc’ed me.</p>
<p><code>
index: 3, size: 1
unpacked:  
index: 2, size: 2
unpacked:    
index: 1, size: 3
unpacked:   e r
index: 0, size: 4
unpacked: d e rea
size: 4, text:  d e rea</code></p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T19:22:38Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:37Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#20</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Are those multiple packets being sent? 1, 2, 3, 1, 2, 3, 4?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><b><a rel="next" itemprop="url" href="5494164658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:18 GMT -->
</html>
