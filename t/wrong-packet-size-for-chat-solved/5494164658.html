<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Wrong packet size for chat [solved] - Runescape - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m having a problem with having the wrong data for the chat packet. When talking in chat it will disconnect me and after unpacking the bytes to string format it&amp;#39;s obviously corrupt. 

I asked help for this already but t&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="5494164658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Wrong packet size for chat [solved]&#39;" href="549416.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416?page=2" />
<meta property="og:title" content="Wrong packet size for chat [solved]" />
<meta name="twitter:title" content="Wrong packet size for chat [solved]" />
<meta property="og:description" content="Those ain’t packets, index is the current index in the for-loop and size is the current size in the buffer (byte[] data)  which I printed out from this method:  [code=java]  public byte[] getAdditionalBytesReversed(int amount) {  byte[] data = new.html byte[amount];              for (int i = amount - 1; i &gt;= 0; i --) {                     data[i] = getAdditionalByte();             }             return data;     }[/code]           public byte[] getAdditionalBytesReversed(int amount) {                ..." />
<meta name="twitter:description" content="Those ain’t packets, index is the current index in the for-loop and size is the current size in the buffer (byte[] data)  which I printed out from this method:  [code=java]  public byte[] getAdditionalBytesReversed(int amount) {  byte[] data = new.html byte[amount];              for (int i = amount - 1; i &gt;= 0; i --) {                     data[i] = getAdditionalByte();             }             return data;     }[/code]           public byte[] getAdditionalBytesReversed(int amount) {                ..." />
<meta property="article:published_time" content="2015-01-27T19:39:19+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="549416.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="549416.html">Wrong packet size for chat [solved]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T19:39:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:37Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="20" data-topic="549416">
<div class="title">
<div class="quote-controls"></div>
 Zymus:</div>
<blockquote>
<p>Are those multiple packets being sent? 1, 2, 3, 1, 2, 3, 4?</p>
</blockquote>
</aside>
<p>Those ain’t packets, index is the current index in the for-loop and size is the current size in the buffer (byte[] data)<br>
which I printed out from this method:</p>
<p>[code=java]<br>
public byte[] getAdditionalBytesReversed(int amount) {<br>
byte[] data = new byte[amount];</p>
<pre><code>            for (int i = amount - 1; i &gt;= 0; i --) {
                    data[i] = getAdditionalByte();
            }
            return data;
    }[/code]
</code></pre>
<p><code>
        public byte[] getAdditionalBytesReversed(int amount) {
                byte[] data = new byte[amount];
               int size = 0;
                for (int i = amount - 1; i &gt;= 0; i --) {
                        data[i] = getAdditionalByte();
                        System.out.println("index:" + i + ", size:" + (++size));
                }
                return data;
        }</code></p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T19:46:52Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:37Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:21, topic:549416”][quote author=Zymus link=topic=668319.msg4469873#msg4469873 date=1422386558]<br>
Are those multiple packets being sent? 1, 2, 3, 1, 2, 3, 4?<br>
[/quote]<br>
Those ain’t packets, index is the current index in the for-loop and size is the current size in the buffer (byte[] data)<br>
which I printed out from this method:</p>
<p>[code=java]<br>
public byte[] getAdditionalBytesReversed(int amount) {<br>
byte[] data = new byte[amount];</p>
<pre><code>            for (int i = amount - 1; i &gt;= 0; i --) {
                    data[i] = getAdditionalByte();
            }
            return data;
    }[/code]
</code></pre>
<p><code>
        public byte[] getAdditionalBytesReversed(int amount) {
                byte[] data = new byte[amount];
               int size = 0;
                for (int i = amount - 1; i &gt;= 0; i --) {
                        data[i] = getAdditionalByte();
                        System.out.println("index:" + i + ", size:" + (++size));
                }
                return data;
        }</code>[/quote]</p>
<p>I wouldn’t use 0 as the condition, because you’re reading the packet data from the same ByteBuf, so reading to 0 would also return the packet opcode, effects, and colors.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T19:54:41Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:38Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:22, topic:549416”][quote author=RandQm link=topic=668319.msg4469876#msg4469876 date=1422387559]</p>
<aside class="quote">
<blockquote>
<p>Are those multiple packets being sent? 1, 2, 3, 1, 2, 3, 4?</p>
</blockquote>
</aside>
<p>Those ain’t packets, index is the current index in the for-loop and size is the current size in the buffer (byte[] data)<br>
which I printed out from this method:</p>
<p>[code=java]<br>
public byte[] getAdditionalBytesReversed(int amount) {<br>
byte[] data = new byte[amount];</p>
<pre><code>            for (int i = amount - 1; i &gt;= 0; i --) {
                    data[i] = getAdditionalByte();
            }
            return data;
    }[/code]
</code></pre>
<p><code>
        public byte[] getAdditionalBytesReversed(int amount) {
                byte[] data = new byte[amount];
               int size = 0;
                for (int i = amount - 1; i &gt;= 0; i --) {
                        data[i] = getAdditionalByte();
                        System.out.println("index:" + i + ", size:" + (++size));
                }
                return data;
        }</code></p>
<p>[/quote]</p>
<p>I wouldn’t use 0 as the condition, because you’re reading the packet data from the same ByteBuf, so reading to 0 would also return the packet opcode, effects, and colors.[/quote]<br>
Yeah that would be true if the method would be used in other packets, though right now the chat packet is the only one using it,<br>
and as opcode, effects and colors are already read before calling this and nothing comes behind it should be working.</p>
<p>Anyways I changed it back to the one from my previous post, so let’s continue, what kind of evil is ruining my chat</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T21:43:08Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:39Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sorry for taking so long, I’m at work right now.</p>
<p>For the ByteBuf thing, it’s possible. Let’s say it’s initially</p>
<p><code>
opcode|effect|color|text</code><br>
so</p>
<p><code>
4|0|0|c|b|a
^</code><br>
would be valid. Now, when you get to actually parsing the packet data, you’re here</p>
<p><code>
4|0|0|c|b|a
  ^</code><br>
It reads the effect and color, which brings it to</p>
<p><code>
4|0|0|c|b|a
      ^</code><br>
It then reads the bytes in reverse, starting from the end, so</p>
<p><code>
4|0|0|c|b|a
          ^
4|0|0|c|b|a
        ^
4|0|0|c|b|a
      ^</code><br>
So we would be at the start index now. But, if we keep going to 0, we’ll also get</p>
<p><code>
4|0|0|c|b|a
    ^
4|0|0|c|b|a
  ^
4|0|0|c|b|a
^</code><br>
Giving us the data</p>
<p><code>
['a', 'b', 'c', 0, 0, 4]</code><br>
which isn’t what we want.</p>
<p>Now, to actually see what’s going on, Can you do</p>
<pre><code class="lang-auto">if (buffer.readableBytes() &gt;= size) {
	final byte[] data = new byte[size];
	buffer.readBytes(data);
	final ByteBuf payload = Unpooled.buffer(size);
	payload.writeBytes(data);
	System.out.println("size: " + size);
        System.out.println(Arrays.toString(payload.array()));// add this line
	try {
		out.add(new PacketDisassembler(payload, opcode, size));
	} finally {
		opcode = -1;
		size = -1;
	}
}</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T22:17:06Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:39Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m not in a hurry, I’ve been looking for this issue for a week on and off, a day more or less doesn’t matter.<br>
I appreciate it a lot that you keep helping to get this solved.</p>
<p>input: "hi man"<br>
prints:</p>
<pre><code class="lang-auto">size: 8
[-128, -128, -121, -125, -115, -128, -123, -122]</code></pre>
<p>input: "lol"<br>
prints:</p>
<pre><code class="lang-auto">size: 5
[-128, -128, -117, -124, -117]</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T22:28:39Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:39Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:25, topic:549416”]I’m not in a hurry, I’ve been looking for this issue for a week on and off, a day more or less doesn’t matter.<br>
I appreciate it a lot that you keep helping to get this solved.</p>
<p>input: "hi man"<br>
prints:</p>
<pre><code class="lang-auto">size: 8
[-128, -128, -121, -125, -115, -128, -123, -122]</code></pre>
<p>input: "lol"<br>
prints:</p>
<p><code>
size: 5
[-128, -128, -117, -124, -117]
</code>[/quote]</p>
<p>Alright, give me one minute to look at what’s going on.</p>
<p>EDIT: it looks like it may be a problem with your textUnpack method. I’m looking into it now. It’s been a while since I did this type of thing (nibble arithmetic…)</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T23:03:38Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:40Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:26, topic:549416”][quote author=RandQm link=topic=668319.msg4469910#msg4469910 date=1422397026]<br>
I’m not in a hurry, I’ve been looking for this issue for a week on and off, a day more or less doesn’t matter.<br>
I appreciate it a lot that you keep helping to get this solved.</p>
<p>input: "hi man"<br>
prints:</p>
<pre><code class="lang-auto">size: 8
[-128, -128, -121, -125, -115, -128, -123, -122]</code></pre>
<p>input: "lol"<br>
prints:</p>
<pre><code class="lang-auto">size: 5
[-128, -128, -117, -124, -117]</code></pre>
<p>[/quote]</p>
<p>Alright, give me one minute to look at what’s going on.</p>
<p>EDIT: it looks like it may be a problem with your textUnpack method. I’m looking into it now. It’s been a while since I did this type of thing (nibble arithmetic…)[/quote]</p>
<p>[code=java]<br>
int effects = packet.getSubtrahendByte();<br>
int color = packet.getSubtrahendByte();<br>
int chatLength = (packet.getLength() - 2);<br>
byte[] text = packet.getAdditionalBytesReversed(chatLength);</p>
<pre><code>	System.out.println(Arrays.toString(text)); //PRINTING[/code]
</code></pre>
<p>The output for input “lol” is here:</p>
<pre><code class="lang-auto">[11, 4, 0]</code></pre>
<p>For “hi man”</p>
<pre><code class="lang-auto">[7, 3, 13, 0, 0, 0]</code></pre>
<p>It looks like it’s not assigning correctly, notice the 0’s where there are characters.<br>
I’d assume we need to go back to my "read bytes method?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T23:11:49Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:40Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:27, topic:549416”][quote author=Zymus link=topic=668319.msg4469912#msg4469912 date=1422397719]</p>
<aside class="quote">
<blockquote>
<p>I’m not in a hurry, I’ve been looking for this issue for a week on and off, a day more or less doesn’t matter.<br>
I appreciate it a lot that you keep helping to get this solved.</p>
<p>input: "hi man"<br>
prints:</p>
<pre><code class="lang-auto">size: 8
[-128, -128, -121, -125, -115, -128, -123, -122]</code></pre>
<p>input: "lol"<br>
prints:</p>
<pre><code class="lang-auto">size: 5
[-128, -128, -117, -124, -117]</code></pre>
</blockquote>
</aside>
<p>Alright, give me one minute to look at what’s going on.</p>
<p>EDIT: it looks like it may be a problem with your textUnpack method. I’m looking into it now. It’s been a while since I did this type of thing (nibble arithmetic…)<br>
[/quote]</p>
<p>[code=java]<br>
int effects = packet.getSubtrahendByte();<br>
int color = packet.getSubtrahendByte();<br>
int chatLength = (packet.getLength() - 2);<br>
byte[] text = packet.getAdditionalBytesReversed(chatLength);</p>
<pre><code>	System.out.println(Arrays.toString(text)); //PRINTING[/code]
</code></pre>
<p>The output for input “lol” is here:</p>
<pre><code class="lang-auto">[11, 4, 0]</code></pre>
<p>For “hi man”</p>
<pre><code class="lang-auto">[7, 3, 13, 0, 0, 0]</code></pre>
<p>It looks like it’s not assigning correctly, notice the 0’s where there are characters.<br>
I’d assume we need to go back to my "read bytes method?[/quote]</p>
<p>What exactly is the purpose of the text packing? From my testing, it looks like it reads a byte for each character in the string, subtracts/adds 128 from it, and that gives you the index in the XLATE_TABLE of the character. Is that correct?</p>
<p>Can you get me the same output for the following strings?<br>
“ee”<br>
“eee”<br>
“ew”<br>
“ww”<br>
“wz”<br>
“zz”</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T23:25:24Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:40Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>“ee”<br>
“eee”<br>
“ew”<br>
“ww”<br>
“wz”<br>
“zz”</p>
<pre><code class="lang-auto">[1, 0]
[1, 1, 0]
[14, 0]
[14, 0]
[26, 0]
[26, 0]</code></pre>
<p>Tbh, I don’t know about the text unpacking, I ripped it from Asteria,<br>
checked a PI as well when I noticed the issues and it seems to be done the same.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T23:28:01Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:40Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:29, topic:549416”]“ee”<br>
“eee”<br>
“ew”<br>
“ww”<br>
“wz”<br>
“zz”</p>
<pre><code class="lang-auto">[1, 0]
[1, 1, 0]
[14, 0]
[14, 0]
[26, 0]
[26, 0]</code></pre>
<p>Tbh, I don’t know about the text unpacking, I ripped it from Asteria,<br>
checked a PI as well when I noticed the issues and it seems to be done the same.[/quote]</p>
<p>Okay, and can you get the output after the unpacking for the same strings? assuming it doesn’t crash.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-27T23:30:25Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:40Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#31</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:30, topic:549416”][quote author=RandQm link=topic=668319.msg4469925#msg4469925 date=1422401124]<br>
“ee”<br>
“eee”<br>
“ew”<br>
“ww”<br>
“wz”<br>
“zz”</p>
<pre><code class="lang-auto">[1, 0]
[1, 1, 0]
[14, 0]
[14, 0]
[26, 0]
[26, 0]</code></pre>
<p>Tbh, I don’t know about the text unpacking, I ripped it from Asteria,<br>
checked a PI as well when I noticed the issues and it seems to be done the same.<br>
[/quote]</p>
<p>Okay, and can you get the output after the unpacking for the same strings? assuming it doesn’t crash.[/quote]</p>
<pre><code class="lang-auto">e  
 e e  
 2 
 2 
ed  
ed  </code></pre>
<p>Btw, it crashes when I send it back to the client to update the player, not from reading/unpacking.<br>
But it looks kinda obvious at this point that the data we read is not right,<br>
so it’s logical the client will crash if it receives incorrect data.</p>
<p>note: I have to go, checking back tomorrow, thanks for the effort you’re putting into this.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T17:00:00Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:46Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#32</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:31, topic:549416”][quote author=Zymus link=topic=668319.msg4469926#msg4469926 date=1422401281]</p>
<aside class="quote">
<blockquote>
<p>“ee”<br>
“eee”<br>
“ew”<br>
“ww”<br>
“wz”<br>
“zz”</p>
<pre><code class="lang-auto">[1, 0]
[1, 1, 0]
[14, 0]
[14, 0]
[26, 0]
[26, 0]</code></pre>
<p>Tbh, I don’t know about the text unpacking, I ripped it from Asteria,<br>
checked a PI as well when I noticed the issues and it seems to be done the same.</p>
</blockquote>
</aside>
<p>Okay, and can you get the output after the unpacking for the same strings? assuming it doesn’t crash.<br>
[/quote]</p>
<pre><code class="lang-auto">e  
 e e  
 2 
 2 
ed  
ed  </code></pre>
<p>Btw, it crashes when I send it back to the client to update the player, not from reading/unpacking.<br>
But it looks kinda obvious at this point that the data we read is not right,<br>
so it’s logical the client will crash if it receives incorrect data.</p>
<p>note: I have to go, checking back tomorrow, thanks for the effort you’re putting into this.[/quote]</p>
<p>So, I found something odd. I downloaded the mopar 3.2 client and looked at the textpack method, and when I pack some text with that, and unpack it with your method, it works perfectly. Which client(s) were you checking with?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T20:09:04Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:48Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#33</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Originally I read the first byte that is queued</p>
<pre><code class="lang-auto">readByte();</code></pre>
<p>I had to read the byte at the given index:</p>
<pre><code class="lang-auto"></code></pre>
<p>My array outprint is correct now I think, though text still doesn’t unpack right and I still disconnect at updating</p>
<p>input “i don’t know”</p>
<pre><code class="lang-auto">[5, 0, 10, 4, 7, 50, 2, 0, 22, 7, 4, 14]
 i   d o nat t  eh n o </code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T21:20:56Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:49Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#34</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:33, topic:549416”]Originally I read the first byte that is queued</p>
<pre><code class="lang-auto">readByte();</code></pre>
<p>I had to read the byte at the given index:</p>
<pre><code class="lang-auto"></code></pre>
<p>My array outprint is correct now I think, though text still doesn’t unpack right and I still disconnect at updating</p>
<p>input “i don’t know”</p>
<p><code>
[5, 0, 10, 4, 7, 50, 2, 0, 22, 7, 4, 14]
 i   d o nat t  eh n o 
</code>[/quote]</p>
<p>Can you post the textPack method in the client?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T21:39:48Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:49Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#35</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Zymus, post:34, topic:549416”][quote author=RandQm link=topic=668319.msg4470031#msg4470031 date=1422475744]<br>
Originally I read the first byte that is queued</p>
<pre><code class="lang-auto">readByte();</code></pre>
<p>I had to read the byte at the given index:</p>
<pre><code class="lang-auto"></code></pre>
<p>My array outprint is correct now I think, though text still doesn’t unpack right and I still disconnect at updating</p>
<p>input “i don’t know”</p>
<pre><code class="lang-auto">[5, 0, 10, 4, 7, 50, 2, 0, 22, 7, 4, 14]
 i   d o nat t  eh n o </code></pre>
<p>[/quote]</p>
<p>Can you post the textPack method in the client?[/quote]</p>
<p><span class="bbcode-b">Client text pack:</span></p>
<pre><code class="lang-auto">	public static void method526(String s, Stream stream) {
		if(s.length() &gt; 80)
			s = s.substring(0, 80);
		s = s.toLowerCase();
		int i = -1;
		for(int j = 0; j &lt; s.length(); j++) {
			char c = s.charAt(j); 
			int k = 0;
			for(int l = 0; l &lt; validChars.length; l++) {
				if(c != validChars[l])
					continue;
				k = l;
				break;
			}
			stream.writeWordBigEndian(k);
		}
	}</code></pre>
<p><span class="bbcode-b">Client text unpack:</span></p>
<pre><code class="lang-auto">public static String method525(int i, Stream stream) {
		int j = 0;
		int k = -1;
		for(int l = 0; l &lt; i; l++) {
			int i1 = stream.readUnsignedByte();
					aCharArray631[j++] = validChars[i1];
		}
		boolean flag1 = true;
		for(int k1 = 0; k1 &lt; j; k1++) {
			char c = aCharArray631[k1];
			if(flag1 &amp;&amp; c &gt;= 'a' &amp;&amp; c &lt;= 'z') {
				aCharArray631[k1] += '\uFFE0';
				flag1 = false;
			}
			if(c == '.' || c == '!' || c == '?')
				flag1 = true;
		}
		return new String(aCharArray631, 0, j);
	}</code></pre>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T22:17:27Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:50Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#36</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“RandQm, post:35, topic:549416”][quote author=Zymus link=topic=668319.msg4470049#msg4470049 date=1422480056]</p>
<aside class="quote">
<blockquote>
<p>Originally I read the first byte that is queued</p>
<pre><code class="lang-auto">readByte();</code></pre>
<p>I had to read the byte at the given index:</p>
<pre><code class="lang-auto"></code></pre>
<p>My array outprint is correct now I think, though text still doesn’t unpack right and I still disconnect at updating</p>
<p>input “i don’t know”</p>
<pre><code class="lang-auto">[5, 0, 10, 4, 7, 50, 2, 0, 22, 7, 4, 14]
 i   d o nat t  eh n o </code></pre>
</blockquote>
</aside>
<p>Can you post the textPack method in the client?<br>
[/quote]</p>
<p><span class="bbcode-b">Client text pack:</span></p>
<pre><code class="lang-auto">	public static void method526(String s, Stream stream) {
		if(s.length() &gt; 80)
			s = s.substring(0, 80);
		s = s.toLowerCase();
		int i = -1;
		for(int j = 0; j &lt; s.length(); j++) {
			char c = s.charAt(j); 
			int k = 0;
			for(int l = 0; l &lt; validChars.length; l++) {
				if(c != validChars[l])
					continue;
				k = l;
				break;
			}
			stream.writeWordBigEndian(k);
		}
	}</code></pre>
<p><span class="bbcode-b">Client text unpack:</span></p>
<p><code>
public static String method525(int i, Stream stream) {
		int j = 0;
		int k = -1;
		for(int l = 0; l &lt; i; l++) {
			int i1 = stream.readUnsignedByte();
					aCharArray631[j++] = validChars[i1];
		}
		boolean flag1 = true;
		for(int k1 = 0; k1 &lt; j; k1++) {
			char c = aCharArray631[k1];
			if(flag1 &amp;&amp; c &gt;= 'a' &amp;&amp; c &lt;= 'z') {
				aCharArray631[k1] += '\uFFE0';
				flag1 = false;
			}
			if(c == '.' || c == '!' || c == '?')
				flag1 = true;
		}
		return new String(aCharArray631, 0, j);
	}
</code>[/quote]</p>
<p>What client did you pull this from?</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T22:21:13Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:50Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#37</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Galkon’s Refactored[474-look-alike]</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-28T22:24:59Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:50Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#38</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>It looks like the writeBigWordEndian is just writing the byte value. Is your code still calling readAdditionalByte? If so, try changing to to readByte.</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/RandQm.html'><span itemprop='name'>RandQm</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-01-29T09:09:46Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:17:53Z' class='post-time'>
              August 4, 2016,  2:17pm
            </time>
        <span itemprop='position'>#39</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="38" data-topic="549416">
<div class="title">
<div class="quote-controls"></div>
 Zymus:</div>
<blockquote>
<p>It looks like the writeBigWordEndian is just writing the byte value. Is your code still calling readAdditionalByte? If so, try changing to to readByte.</p>
</blockquote>
</aside>
<p>It has to be additional as it has values around 128, the received bytes array looks right now I think.</p>
<p><span class="bbcode-b">Edit:</span><br>
I took the text unpacking from the client, it also works for my private messages so I assume this is good now.<br>
The array (reading the packet) still looks good as well, seems like I’m almost there.</p>
<pre><code class="lang-auto">public static String bytesToText(byte packedData[], int size) {
    	char[] characters = new char[100];
    	
    	int position = 0;
    	
    	for (int i = 0; i &lt; size; i++) {
    		characters[position++] = XLATE_TABLE[packedData[i]];
		}
		boolean flag1 = true;
		
		for (int i = 0; i &lt; position; i++) {
			char c = characters[i];
			
			if (flag1 &amp;&amp; c &gt;= 'a' &amp;&amp; c &lt;= 'z') {
				characters[i] += '\uFFE0';
			}
		}
		return new String(characters, 0, position).toLowerCase();
    }

    private static char XLATE_TABLE[] = {
		' ', 'e', 't', 'a', 'o', 'i', 'h', 'n', 's', 'r', 
		'd', 'l', 'u', 'm', 'w', 'c', 'y', 'f', 'g', 'p', 
		'b', 'v', 'k', 'x', 'j', 'q', 'z', '0', '1', '2', 
		'3', '4', '5', '6', '7', '8', '9', ' ', '!', '?', 
		'.', ',', ':', ';', '(', ')', '-', '&amp;', '*', '\\', 
		'\'', '@', '#', '+', '=', '\243', '$', '%', '"', '[', 
		']', '&gt;', '&lt;', '^', '/', '_'
	};</code></pre>
<p>Only issue left now is that the chat updating disconnects the player.</p>
<pre><code class="lang-auto">@Override
	public void execute(Mobile mobile, PacketAssembler packet) {
		packet.putLittleEndianShort(((color &amp; 0xff) &lt;&lt; 8) + (effects &amp; 0xff));
		packet.putByte(((Player)mobile).getRights().getProtocolValue());
		packet.putNegatedByte(text.length);
		packet.putBytesReversed(text);
	}</code></pre>
<p><span class="bbcode-b">Edit:</span> The disconnecting had to do with my bit masks, everything seems solved now.<br>
Will perform some tests but it’s looking good.<br>
Thanks a bunch for all the effort in helping me Zymus.</p>
<p>[size=10pt]<span class="bbcode-b">Solved</span>[/size]</p>
      </div>

      <meta itemprop='headline' content='Wrong packet size for chat [solved]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="549416.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/wrong-packet-size-for-chat-solved/549416?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:18 GMT -->
</html>
