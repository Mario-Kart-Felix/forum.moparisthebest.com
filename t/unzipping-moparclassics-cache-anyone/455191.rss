<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Unzipping moparclassic&#39;s cache anyone?</title>
    <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191</link>
    <description>How.

@CodeForFame - You said T X posted a guide, but i spend all last night searching for it, but with no success.
Perhaps you can link me it?</description>
    
    <lastBuildDate>Tue, 18 Sep 2012 21:34:37 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@management management]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/management">@management</a> wrote:</p>
          <blockquote>
              <p>[quote=“latifundio, post:12, topic:455191”]Just found this <a href="http://uppit.com/zwl629p8r1ey/jag2dir.zip" data-bbcode="true" rel="nofollow noopener">jag2dir</a> on another forums and is made by tom and super, and seems to decompress the files to a folder and rename them with the hash.</p>
<p>Just tried with sounds and the hashes where just like eXemplar posted but when i imported them to Audacity couldn’t make them sound properly.</p>
<aside class="quote">
<blockquote>
<p>edit: I wrote a dehashing algorithm</p>
</blockquote>
</aside>
<p>I will see how to use it to get the correct names.[/quote]</p>
<p>Just make sure that when you’re reading from the archive that you use the /long/ data type for the entry hash.<br>
like:</p>
<pre><code class="lang-auto"></code></pre>
<p>Otherwise the entry will most likely negate due to being higher than Integer.MAX_VALUE</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/13</link>
        <pubDate>Tue, 18 Sep 2012 21:34:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-13</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@latifundio latifundio]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/latifundio">@latifundio</a> wrote:</p>
          <blockquote>
              <p>Just found this <a href="http://uppit.com/zwl629p8r1ey/jag2dir.zip" data-bbcode="true" rel="nofollow noopener">jag2dir</a> on another forums and is made by tom and super, and seems to decompress the files to a folder and rename them with the hash.</p>
<p>Just tried with sounds and the hashes where just like eXemplar posted but when i imported them to Audacity couldn’t make them sound properly.</p>
<aside class="quote" data-post="11" data-topic="455191">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/management/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> management:</div>
<blockquote>
<p>edit: I wrote a dehashing algorithm</p>
</blockquote>
</aside>
<p>I will see how to use it to get the correct names.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/12</link>
        <pubDate>Tue, 18 Sep 2012 20:55:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-12</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@management management]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/management">@management</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="10" data-topic="455191">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/latifundio/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> latifundio:</div>
<blockquote>
<p>I wonder if modifying the tom’s cache editor suite would be good solution for this and just use its gui for decompressing the files.</p>
</blockquote>
</aside>
<p>No, AFAIK, you have to know the file name, unless you can de-hash all of the entries names.</p>
<p><code>int hash = 0;
file = file.toUpperCase();
for(int i = 0; i &lt; file.length(); i++)
      hash = (hash * 61 + file.charAt(i)) - 32;</code></p>
<p>edit: I wrote a dehashing algorithm</p>
<p><code>  def dehash(hash: Long) = {
    var h = hash
    val buffer = ArrayBuffer[Byte]()
    while (h &gt; 0) {
      buffer.prepend(((h % 61) + 32).toByte)
      h = (h - 32) / 61
    }
    new String(buffer.toArray)
  }</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/11</link>
        <pubDate>Fri, 24 Aug 2012 14:19:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-11</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@latifundio latifundio]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/latifundio">@latifundio</a> wrote:</p>
          <blockquote>
              <p>I wonder if modifying the tom’s cache editor suite would be good solution for this and just use its gui for decompressing the files.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/10</link>
        <pubDate>Fri, 24 Aug 2012 12:51:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-10</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>[quote=“management, post:8, topic:455191”][quote author=t4 link=topic=558094.msg4085054#msg4085054 date=1345742001]<br>
hint: bz2 decompressor and the like can easily be refactored by looking at libbzip2:</p>
<p><a href="http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz" class="onebox" target="_blank" rel="nofollow noopener">http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz</a><br>
[/quote]<br>
I used apache’s commons compress[/quote]<br>
ah, right - apache made a java impl <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue_winking_eye.png?v=5" title=":stuck_out_tongue_winking_eye:" class="emoji" alt=":stuck_out_tongue_winking_eye:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/9</link>
        <pubDate>Thu, 23 Aug 2012 19:19:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-9</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@management management]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/management">@management</a> wrote:</p>
          <blockquote>
              <p>[quote=“t4, post:7, topic:455191”]hint: bz2 decompressor and the like can easily be refactored by looking at libbzip2:</p>
<p><a href="http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz%5B/quote%5D" class="onebox" target="_blank" rel="nofollow noopener">http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz[/quote]</a><br>
I used apache’s commons compress</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/8</link>
        <pubDate>Thu, 23 Aug 2012 17:29:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-8</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>hint: bz2 decompressor and the like can easily be refactored by looking at libbzip2:</p>
<p><a href="http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz" class="onebox" target="_blank" rel="nofollow noopener">http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/7</link>
        <pubDate>Thu, 23 Aug 2012 17:13:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-7</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@management management]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/management">@management</a> wrote:</p>
          <blockquote>
              <p>[quote=“eXemplar, post:5, topic:455191”]Here’s a list of the sounds <a href="https://docs.google.com/spreadsheet/ccc?key=0AprI27Dki_1rdG02Y3JLc1dBZ0xlZEE2Q1JYeE5WX0E" rel="nofollow noopener">https://docs.google.com/spreadsheet/ccc?key=0AprI27Dki_1rdG02Y3JLc1dBZ0xlZEE2Q1JYeE5WX0E</a><br>
(bar one)<br>
Here’s the bzlib from the client (204) <a href="http://pastebin.com/Hy4FyL8g" rel="nofollow noopener">http://pastebin.com/Hy4FyL8g</a><br>
And the state <a href="http://pastebin.com/QVqGfKDu" rel="nofollow noopener">http://pastebin.com/QVqGfKDu</a></p>
<p>All of that with what super said should get you started[/quote]<br>
Thanks for sharing that, it’s a lot better refactored than mine ^.^</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/6</link>
        <pubDate>Thu, 23 Aug 2012 14:20:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-6</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@eXemplar eXemplar]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/exemplar">@eXemplar</a> wrote:</p>
          <blockquote>
              <p>Here’s a list of the sounds <a href="https://docs.google.com/spreadsheet/ccc?key=0AprI27Dki_1rdG02Y3JLc1dBZ0xlZEE2Q1JYeE5WX0E" rel="nofollow noopener">https://docs.google.com/spreadsheet/ccc?key=0AprI27Dki_1rdG02Y3JLc1dBZ0xlZEE2Q1JYeE5WX0E</a><br>
(bar one)<br>
Here’s the bzlib from the client (204) <a href="http://pastebin.com/Hy4FyL8g" rel="nofollow noopener">http://pastebin.com/Hy4FyL8g</a><br>
And the state <a href="http://pastebin.com/QVqGfKDu" rel="nofollow noopener">http://pastebin.com/QVqGfKDu</a></p>
<p>All of that with what super said should get you started</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/5</link>
        <pubDate>Thu, 23 Aug 2012 03:46:25 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-5</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@management management]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/management">@management</a> wrote:</p>
          <blockquote>
              <p>I have refactored a lot of the BZip2 decompressor, written by jagex.</p>
<p>Jagex’s format:</p>
<pre><code class="lang-auto">	public static int getSoundOffset(String file, byte arc[]) {
		int arc_length = getShort(arc, 0);
		int hash = 0;
		file = file.toUpperCase();
		for(int i = 0; i &lt; file.length(); i++)
			hash = (hash * 61 + file.charAt(i)) - 32;

		int offset = 2 + arc_length * 10;
		for(int i = 0; i &lt; arc_length; i++) {
			int entry_hash = (arc[i * 10 + 2] &amp; 0xff) * 0x1000000 + (arc[i * 10 + 3] &amp; 0xff) * 0x10000 + (arc[i * 10 + 4] &amp; 0xff) * 256 + (arc[i * 10 + 5] &amp; 0xff);
			int entry_length = (arc[i * 10 + 9] &amp; 0xff) * 0x10000 + (arc[i * 10 + 10] &amp; 0xff) * 256 + (arc[i * 10 + 11] &amp; 0xff);
			if(entry_hash == hash) {
				return offset;
			}
			offset += entry_length;
		}

		return 0;
	}

	public static int getSoundLength(String file, byte arc[]) {
		int arc_length = getShort(arc, 0);
		int hash = 0;
		file = file.toUpperCase();
		for(int i = 0; i &lt; file.length(); i++)
			hash = (hash * 61 + file.charAt(i)) - 32;

		for(int i = 0; i &lt; arc_length; i++) {
			int entry_hash = (arc[i * 10 + 2] &amp; 0xff) * 0x1000000 + (arc[i * 10 + 3] &amp; 0xff) * 0x10000 + (arc[i * 10 + 4] &amp; 0xff) * 256 + (arc[i * 10 + 5] &amp; 0xff);
			int entry_length = (arc[i * 10 + 6] &amp; 0xff) * 0x10000 + (arc[i * 10 + 7] &amp; 0xff) * 256 + (arc[i * 10 + 8] &amp; 0xff);
			if(entry_hash == hash) {
				return entry_length;
			}
		}

		return 0;
	}

	public static byte[] loadData(String file, int len, byte[] arc) {
		return loadData(file, len, arc, null);
	}
	
	public static byte[] loadData(String file, int len, byte[] arc, byte[] buffer) {
		int arc_length = (arc[0] &amp; 0xff) * 256 + (arc[1] &amp; 0xff);
		int hash = 0;
		file = file.toUpperCase();
		for(int i = 0; i &lt; file.length(); i++)
			hash = (hash * 61 + file.charAt(i)) - 32;

		int offset = 2 + arc_length * 10;
		for(int i = 0; i &lt; arc_length; i++) {
			int entry_hash = (arc[i * 10 + 2] &amp; 0xff) * 0x1000000 + (arc[i * 10 + 3] &amp; 0xff) * 0x10000 + (arc[i * 10 + 4] &amp; 0xff) * 256 + (arc[i * 10 + 5] &amp; 0xff);
			int decmp_len = (arc[i * 10 + 6] &amp; 0xff) * 0x10000 + (arc[i * 10 + 7] &amp; 0xff) * 256 + (arc[i * 10 + 8] &amp; 0xff);
			int cmp_len = (arc[i * 10 + 9] &amp; 0xff) * 0x10000 + (arc[i * 10 + 10] &amp; 0xff) * 256 + (arc[i * 10 + 11] &amp; 0xff);
			if(entry_hash == hash) {
				if(buffer == null)
					buffer = new byte[decmp_len + len];
				if(decmp_len != cmp_len) {
					BZip2Decoder.unpackData(buffer, decmp_len, arc, cmp_len, offset);
				} else {
					for(int ii = 0; ii &lt; decmp_len; ii++) {
						buffer[ii] = arc[offset + ii];
					}
				}
				return buffer;
			}
			offset += cmp_len;
		}
		return null;
	}</code></pre>
<p>[code=java]public class BZip2Decoder {</p>
<pre><code>public static int unpackData(byte[] buffer, int decmp_len, byte[] arc, int cmp_len, int arc_offset) {
	BZip2Entry entry = new BZip2Entry();
	entry.archive = arc;
	entry.offset = arc_offset;
	entry.buffer = buffer;
	entry.buffer_offset = 0;
	entry.cmp_len = cmp_len;
	entry.decmp_len = decmp_len;
	entry.bs_live_shadow = 0;
	entry.bs_buff_shadow = 0;
	entry.aeh = 0;
	entry.aei = 0;
	entry.aem = 0;
	entry.aen = 0;
	entry.afg = 0;
	get_and_move_to_front_decode(entry);
	decmp_len -= entry.decmp_len;
	return decmp_len;
}

private static void glk(BZip2Entry entry) {
	byte byte4 = entry.afa;
	int i = entry.afb;
	int j = entry.afl;
	int k = entry.afj;
	int limit[] = BZip2Entry.limit_last;
	int l = entry.afi;
	byte buffer[] = entry.buffer;
	int buffer_idx = entry.buffer_offset;
	int decmp_len = entry.decmp_len;
	int demp_2 = decmp_len;
	int l1 = entry.aha + 1;
	label0:
		do {
			if(i &gt; 0) {
				do {
					if (decmp_len == 0)
						break label0;
					if (i == 1)
						break;
					buffer[buffer_idx] = byte4;
					i--;
					buffer_idx++;
					decmp_len--;
				} while (true);
				if (decmp_len == 0) {
					i = 1;
					break;
				}
				buffer[buffer_idx] = byte4;
				buffer_idx++;
				decmp_len--;
			}
			boolean flag = true;
			while(flag)  {
				flag = false;
				if(j == l1) {
					i = 0;
					break label0;
				}
				byte4 = (byte)k;
				l = limit[l];
				byte byte0 = (byte)(l &amp; 0xff);
				l &gt;&gt;= 8;
				j++;
				if(byte0 != k) {
					k = byte0;
					if(decmp_len == 0) {
						i = 1;
					} else {
						buffer[buffer_idx] = byte4;
						buffer_idx++;
						decmp_len--;
						flag = true;
						continue;
					}
					break label0;
				}
				if(j != l1)
					continue;
				if(decmp_len == 0) {
					i = 1;
					break label0;
				}
				buffer[buffer_idx] = byte4;
				buffer_idx++;
				decmp_len--;
				flag = true;
			}
			i = 2;
			l = limit[l];
			byte byte1 = (byte)(l &amp; 0xff);
			l &gt;&gt;= 8;
			if(++j != l1)
				if(byte1 != k) {
					k = byte1;
				} else {
					i = 3;
					l = limit[l];
					byte byte2 = (byte)(l &amp; 0xff);
					l &gt;&gt;= 8;
					if(++j != l1)
						if(byte2 != k) {
							k = byte2;
						} else {
							l = limit[l];
							byte byte3 = (byte)(l &amp; 0xff);
							l &gt;&gt;= 8;
							j++;
							i = (byte3 &amp; 0xff) + 4;
							l = limit[l];
							k = (byte)(l &amp; 0xff);
							l &gt;&gt;= 8;
							j++;
						}
				}
		} while(true);
	int i2 = entry.aem;
	entry.aem += demp_2 - decmp_len;
	if(entry.aem &lt; i2)
		entry.aen++;
	entry.afa = byte4;
	entry.afb = i;
	entry.afl = j;
	entry.afj = k;
	BZip2Entry.limit_last = limit;
	entry.afi = l;
	entry.buffer = buffer;
	entry.buffer_offset = buffer_idx;
	entry.decmp_len = decmp_len;
}

private static void get_and_move_to_front_decode(BZip2Entry entry) {
	int min_len_zt = 0;
	int limit_zt[] = null;
	int base_zt[] = null;
	int perm_zt[] = null;
	entry.block_size = 1;
	if(BZip2Entry.limit_last == null)
		BZip2Entry.limit_last = new int[entry.block_size * 0x186a0];
	boolean ran_bool = true;
	while(ran_bool)  {
		byte ran_byte = bs_read_ubyte(entry);
		if(ran_byte == 23)
			return;
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		entry.afg++;
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read_ubyte(entry);
		ran_byte = bs_read(entry);
		if(ran_byte != 0)
			entry.block_randomized = true;
		else
			entry.block_randomized = false;
		if(entry.block_randomized)
			System.out.println("PANIC! RANDOMISED BLOCK!");
		entry.afh = 0;
		ran_byte = bs_read_ubyte(entry);
		entry.afh = entry.afh &lt;&lt; 8 | ran_byte &amp; 0xff;
		ran_byte = bs_read_ubyte(entry);
		entry.afh = entry.afh &lt;&lt; 8 | ran_byte &amp; 0xff;
		ran_byte = bs_read_ubyte(entry);
		entry.afh = entry.afh &lt;&lt; 8 | ran_byte &amp; 0xff;
		for(int i = 0; i &lt; 16; i++) {
			byte bit = bs_read(entry);
			if(bit == 1)
				entry.in_use_16[i] = true;
			else
				entry.in_use_16[i] = false;
		}

		for(int i = 0; i &lt; 256; i++)
			entry.in_use[i] = false;

		for(int i = 0; i &lt; 16; i++)
			if(entry.in_use_16[i]) {
				for(int j = 0; j &lt; 16; j++) {
					byte bit = bs_read(entry);
					if(bit == 1)
						entry.in_use[i * 16 + j] = true;
				}

			}

		make_maps(entry);
		int alpha_size = entry.in_use_shadow + 2;
		int n_groups = bs_read(3, entry);
		int n_selectors = bs_read(15, entry);
		for(int i = 0; i &lt; n_selectors; i++) {
			int j = 0;
			do {
				byte bit = bs_read(entry);
				if(bit == 0)
					break;
				j++;
			} while(true);
			entry.selector_mtf[i] = (byte) j;
		} 

		byte pos[] = new byte[6];
		/* Undo the MTF values for the selectors. */
		for(byte v = 0; v &lt; n_groups; v++)
			pos[v] = v;

		for(int i = 0; i &lt; n_selectors; i++) {
			byte v = entry.selector_mtf[i];
			byte tmp = pos[v];
			for(; v &gt; 0; v--)
				// nearly all times v is zero, 4 in most other cases
				pos[v] = pos[v - 1];

			pos[0] = tmp;
			entry.selector[i] = tmp;
		}
		//here i think
		for(int t = 0; t &lt; n_groups; t++) {
			int cur = bs_read(5, entry);
			for(int i = 0; i &lt; alpha_size; i++) {
				do {
					byte bit = bs_read(entry);
					if(bit == 0)
						break;
					bit = bs_read(entry);
					if(bit == 0)
						cur++;
					else
						cur--;
				} while(true);
				entry.temp_2d_arr[t][i] = (byte) cur;
			}
		}

		//creates huffman encoding tables
		for(int t = 0; t &lt; n_groups; t++) {
			byte min_len = 32;
			int max_len = 0;
			for(int i = 0; i &lt; alpha_size; i++) {
				if(entry.temp_2d_arr[t][i] &gt; max_len)
					max_len = entry.temp_2d_arr[t][i];
				if(entry.temp_2d_arr[t][i] &lt; min_len)
					min_len = entry.temp_2d_arr[t][i];
			}

			hb_create_decode_tables(entry.limit[t], entry.base[t], entry.perm[t], entry.temp_2d_arr[t], min_len, max_len, alpha_size);
			entry.min_lengths[t] = min_len;
		}

		int in_shadow = entry.in_use_shadow + 1;
		int group_no = -1;
		int group_pos = 0;
		for(int i = 0; i &lt;= 255; i++)
			entry.unzftab[i] = 0;

		int unknown = 4095;
		for(int i = 15; i &gt;= 0; i--) {
			for(int j = 15; j &gt;= 0; j--) {
				entry.yy[unknown] = (byte) (i * 16 + j);
				unknown--;
			}
			entry.agg[i] = unknown + 1;
		}

		int s = 0;
		if(group_pos == 0) {
			group_no++;
			group_pos = 50;
			byte zt = entry.selector[group_no];
			min_len_zt = entry.min_lengths[zt];
			limit_zt = entry.limit[zt];
			perm_zt = entry.perm[zt];
			base_zt = entry.base[zt];
		}
		group_pos--;
		int zn = min_len_zt;
		int l7;
		byte thech;
		for(l7 = bs_read(zn, entry); l7 &gt; limit_zt[zn]; l7 = l7 &lt;&lt; 1 | thech) {
			zn++;
			thech = bs_read(entry);
		}

		for(int zvec = perm_zt[l7 - base_zt[zn]]; zvec != in_shadow;)
			if(zvec == 0 || zvec == 1) {
				int last_shadow = -1;
				int k6 = 1;
				do {
					if(zvec == 0)
						last_shadow += k6;
					else
						if(zvec == 1)
							last_shadow += 2 * k6;
					k6 *= 2;
					if(group_pos == 0) {
						group_no++;
						group_pos = 50;
						byte byte13 = entry.selector[group_no];
						min_len_zt = entry.min_lengths[byte13];
						limit_zt = entry.limit[byte13];
						perm_zt = entry.perm[byte13];
						base_zt = entry.base[byte13];
					}
					group_pos--;
					int j7 = min_len_zt;
					int i8;
					byte byte10;
					for(i8 = bs_read(j7, entry); i8 &gt; limit_zt[j7]; i8 = i8 &lt;&lt; 1 | byte10) {
						j7++;
						byte10 = bs_read(entry);
					}

					zvec = perm_zt[i8 - base_zt[j7]];
				} while(zvec == 0 || zvec == 1);
				last_shadow++;
				byte ch = entry.seq_to_unseq[entry.yy[entry.agg[0]] &amp; 0xff];
				entry.unzftab[ch &amp; 0xff] += last_shadow;
				for(; last_shadow &gt; 0; last_shadow--) {
					BZip2Entry.limit_last[s] = ch &amp; 0xff;
					s++;
				}

			} else {
				int next_sym = zvec - 1;
				byte tmp;
				if(next_sym &lt; 16) {
					int one = entry.agg[0];
					tmp = entry.yy[one + next_sym];
					for(; next_sym &gt; 3; next_sym -= 4) {
						int j = one + next_sym;
						entry.yy[j] = entry.yy[j - 1];
						entry.yy[j - 1] = entry.yy[j - 2];
						entry.yy[j - 2] = entry.yy[j - 3];
						entry.yy[j - 3] = entry.yy[j - 4];
					}

					for(; next_sym &gt; 0; next_sym--)
						entry.yy[one + next_sym] = entry.yy[(one + next_sym) - 1];

					entry.yy[one] = tmp;
				} else {
					int l10 = next_sym / 16;
					int i11 = next_sym % 16;
					int k10 = entry.agg[l10] + i11;
					tmp = entry.yy[k10];
					for(; k10 &gt; entry.agg[l10]; k10--)
						entry.yy[k10] = entry.yy[k10 - 1];

					entry.agg[l10]++;
					for(; l10 &gt; 0; l10--) {
						entry.agg[l10]--;
						entry.yy[entry.agg[l10]] = entry.yy[(entry.agg[l10 - 1] + 16) - 1];
					}

					entry.agg[0]--;
					entry.yy[entry.agg[0]] = tmp;
					if(entry.agg[0] == 0) {
						int ran_int = 4095;
						for(int k9 = 15; k9 &gt;= 0; k9--) {
							for(int l9 = 15; l9 &gt;= 0; l9--) {
								entry.yy[ran_int] = entry.yy[entry.agg[k9] + l9];
								ran_int--;
							}

							entry.agg[k9] = ran_int + 1;
						}

					}
				}
				entry.unzftab[entry.seq_to_unseq[tmp &amp; 0xff] &amp; 0xff]++;
				BZip2Entry.limit_last[s] = entry.seq_to_unseq[tmp &amp; 0xff] &amp; 0xff;
				s++;
				if(group_pos == 0) {
					group_no++;
					group_pos = 50;
					byte zt = entry.selector[group_no];
					min_len_zt = entry.min_lengths[zt];
					limit_zt = entry.limit[zt];
					perm_zt = entry.perm[zt];
					base_zt = entry.base[zt];
				}
				group_pos--;
				int zm = min_len_zt;
				int bs_live_shadow;
				byte thebyte;
				for(bs_live_shadow = bs_read(zm, entry); bs_live_shadow &gt; limit_zt[zm]; bs_live_shadow = bs_live_shadow &lt;&lt; 1 | thebyte) {
					zm++;
					thebyte = bs_read(entry);
				}

				zvec = perm_zt[bs_live_shadow - base_zt[zm]];
			}

		entry.afb = 0;
		entry.afa = 0;
		entry.ctftab[0] = 0;
		for(int i = 1; i &lt;= 256; i++)
			entry.ctftab[i] = entry.unzftab[i - 1];

		for(int i = 1; i &lt;= 256; i++)
			entry.ctftab[i] += entry.ctftab[i - 1];

		for(int i = 0; i &lt; s; i++) {
			byte ch = (byte)(BZip2Entry.limit_last[i] &amp; 0xff);
			BZip2Entry.limit_last[entry.ctftab[ch &amp; 0xff]] |= i &lt;&lt; 8;
			entry.ctftab[ch &amp; 0xff]++;
		}

		entry.afi = BZip2Entry.limit_last[entry.afh] &gt;&gt; 8;
			entry.afl = 0;
			entry.afi = BZip2Entry.limit_last[entry.afi];
			entry.afj = (byte)(entry.afi &amp; 0xff);
			entry.afi &gt;&gt;= 8;
		entry.afl++;
		entry.aha = s;
		glk(entry);
		if(entry.afl == entry.aha + 1 &amp;&amp; entry.afb == 0)
			ran_bool = true;
		else
			ran_bool = false;
	}
}

private static byte bs_read_ubyte(BZip2Entry entry) {
	return (byte) bs_read(8, entry);
}

private static byte bs_read(BZip2Entry entry) {
	return (byte) bs_read(1, entry);
}

private static int bs_read(int n, BZip2Entry entry) {
	int value;
	do {
		if(entry.bs_live_shadow &gt;= n) {
			int thech = entry.bs_buff_shadow &gt;&gt; entry.bs_live_shadow - n &amp; (1 &lt;&lt; n) - 1;
				entry.bs_live_shadow -= n;
				value = thech;
				break;
		}
		entry.bs_buff_shadow = entry.bs_buff_shadow &lt;&lt; 8 | entry.archive[entry.offset] &amp; 0xff;
		entry.bs_live_shadow += 8;
		entry.offset++;
		entry.cmp_len--;
		entry.aeh++;
		if(entry.aeh == 0)
			entry.aei++;
	} while(true);
	return value;
}

private static void make_maps(BZip2Entry entry) {
	entry.in_use_shadow = 0;
	for(int i = 0; i &lt; 256; i++) {
		if(entry.in_use[i]) {
			entry.seq_to_unseq[entry.in_use_shadow] = (byte) i;
			entry.in_use_shadow++;
		}
	}
}

private static void hb_create_decode_tables(int[] limit, int[] base, int[] perm, byte length[], int min_len, int max_len, int alpha_size) {
	for (int i = min_len, pp = 0; i &lt;= max_len; i++) {
		for (int j = 0; j &lt; alpha_size; j++) {
			if (length[j] == i) {
				perm[pp++] = j;
			}
		}
	}

	for(int i = 0; i &lt; 23; i++) {
		base[i] = 0;
		limit[i] = 0;
	}

	for(int i = 0; i &lt; alpha_size; i++) {
		base[length[i] + 1]++;
	}

	for(int i = 1; i &lt; 23; i++) {
		base[i] += base[i - 1];
	}

	int vec = 0;
	for(int i = min_len; i &lt;= max_len; i++) {
		vec += base[i + 1] - base[i];
		limit[i] = vec - 1;
		vec &lt;&lt;= 1;
	}

	for(int i = min_len + 1; i &lt;= max_len; i++) {
		base[i] = (limit[i - 1] + 1 &lt;&lt; 1) - base[i];
	}
}
</code></pre>
<p>}<br>
[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/4</link>
        <pubDate>Tue, 21 Aug 2012 03:05:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-4</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@latifundio latifundio]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/latifundio">@latifundio</a> wrote:</p>
          <blockquote>
              <p>[quote=“super_, post:1, topic:312950”]<code>jag_archive {
   /* if dcmp_size == cmp_size, the archive is compressed as a whole */
   hdr {
       u24 dcmp_sz;
       u24 cmp_sz;
   }
   /* following data is compressed if compressed as whole */
   bdy {
       ent_tbl {
           u16 ent_cnt;
           u32 ent_id_tbl[ent_cnt];
           u32 ent_dcmp_sz_tbl[ent_cnt];
           u32 ent_cmp_sz_tbl[ent_cnt];
       }
       u1 data[dcmp_size];
   }
}</code></p>
<p>data contains the rest of the file data; if ent_dcmp_sz_tbl[ent_idx] != ent_cmp_sz_tbl[ent_idx], then entry ent_idx is compressed. the compression used is bzip without magic header.[/quote]</p>
<p>Hope it helps lol…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/3</link>
        <pubDate>Mon, 20 Aug 2012 22:36:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-3</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@CodeForFame CodeForFame]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/codeforfame">@CodeForFame</a> wrote:</p>
          <blockquote>
              <p>[quote=“Wife Beater, post:1, topic:455191”]How.</p>
<p><a class="mention" href="/u/codeforfame">@CodeForFame</a> - You said T X posted a guide, but i spend all last night searching for it, but with no success.<br>
Perhaps you can link me it?[/quote]Looks like it was deleted. Either way, it’s just bzip2.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/2</link>
        <pubDate>Mon, 20 Aug 2012 22:29:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-2</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
      <item>
        <title>Unzipping moparclassic&#39;s cache anyone?</title>
        <dc:creator><![CDATA[@Wife_Beater Wife Beater]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wife_beater">@Wife_Beater</a> wrote:</p>
          <blockquote>
              <p>How.</p>
<p><a class="mention" href="/u/codeforfame">@CodeForFame</a> - You said T X posted a guide, but i spend all last night searching for it, but with no success.<br>
Perhaps you can link me it?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191/1</link>
        <pubDate>Mon, 20 Aug 2012 22:06:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-455191-1</guid>
        <source url="https://forum.moparisthebest.com/t/unzipping-moparclassics-cache-anyone/455191.rss">Unzipping moparclassic&#39;s cache anyone?</source>
      </item>
  </channel>
</rss>
