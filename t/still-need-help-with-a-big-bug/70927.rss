<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Still need help with a big bug</title>
    <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927</link>
    <description>Ok, my server is huge, i have like 10k lines of modded stuff in my client, so remaking it takes forever, ive done that 7 times now, and now i have a bad bugg i need help with.

When new players log onto my server it killz them constantly, originaly it then would kick everyone after like 5 minutes, but since zerofreezes error fix, now it just kicks them. I use testscape source. Any help... well... helps ty...</description>
    
    <lastBuildDate>Sun, 25 Mar 2007 14:44:18 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@Hiaburi Hiaburi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hiaburi">@Hiaburi</a> wrote:</p>
          <blockquote>
              <p>oh man… ok well if ne1 wants to c the error, my ip is <a href="http://1mixscape1.servegame.com" rel="nofollow noopener">1mixscape1.servegame.com</a>, not advertising but asking for ppl to log in and c if they have saw the error b4</p>
<p>do u know were testscape makes it so ur first login u die? i think that is the problem but i have no idea were it is, i might have got rid of a var it needed or sumthin…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/7</link>
        <pubDate>Sun, 25 Mar 2007 14:44:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-7</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@lothy Lothy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lothy">@lothy</a> wrote:</p>
          <blockquote>
              <p>I had a read through, and I didn’t see anything wrong. If it isn’t there, then I’m not sure where it would be.</p>
<p>EDIT: No, that bit you just added to your last message isn’t the cause. I think it’s because it can’t load a new user’s HP from somewhere, and thus they die.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/6</link>
        <pubDate>Sun, 25 Mar 2007 14:42:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-6</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@Hiaburi Hiaburi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hiaburi">@Hiaburi</a> wrote:</p>
          <blockquote>
              <p>basicaly stock</p>
<pre><code class="lang-auto">public void run() {
		// we just accepted a new connection - handle the login stuff
		isActive = false;
		long serverSessionKey = 0, clientSessionKey = 0;
		// randomize server part of the session key
		serverSessionKey = ((long)(java.lang.Math.random() * 99999999D) &lt;&lt; 32) + (long)(java.lang.Math.random() * 99999999D);

		try {
			fillInStream(2);
			if(inStream.readUnsignedByte() != 14) {
				//shutdownError("Expected login Id 14 from client.");
				disconnected = true;
				PlayerHandler.players[playerId] = null;
				return;
			}
			// this is part of the usename. Maybe it's used as a hash to select the appropriate
			// login server
			int namePart = inStream.readUnsignedByte();
			for(int i = 0; i &lt; 8; i++) out.write(0);		// is being ignored by the client

			// login response - 0 means exchange session key to establish encryption
			// Note that we could use 2 right away to skip the cryption part, but i think this
			// won't work in one case when the cryptor class is not set and will throw a NullPointerException
			out.write(0);

			// send the server part of the session Id used (client+server part together are used as cryption key)
			outStream.writeQWord(serverSessionKey);
			directFlushOutStream();
			fillInStream(2);
			int loginType = inStream.readUnsignedByte();	// this is either 16 (new login) or 18 (reconnect after lost connection)
			if(loginType != 16 &amp;&amp; loginType != 18) {
				//shutdownError("Unexpected login type "+loginType);
				return;
			}
			int loginPacketSize = inStream.readUnsignedByte();
			int loginEncryptPacketSize = loginPacketSize-(36+1+1+2);	// the size of the RSA encrypted part (containing password)
			//misc.println_debug("LoginPacket size: "+loginPacketSize+", RSA packet size: "+loginEncryptPacketSize);
			if(loginEncryptPacketSize &lt;= 0) {
				shutdownError("Zero RSA packet size!");
				return;
			}
			fillInStream(loginPacketSize);
			if(inStream.readUnsignedByte() != 255 || inStream.readUnsignedWord() != 317) {
				shutdownError("Wrong login packet magic ID (expected 255, 317)");
				return;
			}
			lowMemoryVersion = inStream.readUnsignedByte();
			misc.println_debug("Client type: "+((lowMemoryVersion==1) ? "low" : "high")+" memory version");
			for(int i = 0; i &lt; 9; i++) {
                                 String junk = Integer.toHexString(inStream.readDWord());
				//misc.println_debug("dataFileVersion["+i+"]: 0x"+Integer.toHexString(inStream.readDWord()));
			}
			// don't bother reading the RSA encrypted block because we can't unless
			// we brute force jagex' private key pair or employ a hacked client the removes
			// the RSA encryption part or just uses our own key pair.
			// Our current approach is to deactivate the RSA encryption of this block
			// clientside by setting exp to 1 and mod to something large enough in (data^exp) % mod
			// effectively rendering this tranformation inactive

			loginEncryptPacketSize--;		// don't count length byte
			int tmp = inStream.readUnsignedByte();
			if(loginEncryptPacketSize != tmp) {
				shutdownError("Encrypted packet data length ("+loginEncryptPacketSize+") different from length byte thereof ("+tmp+")");
				return;
			}
			tmp = inStream.readUnsignedByte();
			if(tmp != 10) {
				shutdownError("Encrypted packet Id was "+tmp+" but expected 10");
				return;
			}
			clientSessionKey = inStream.readQWord();
			serverSessionKey = inStream.readQWord();
			misc.println("UserId: "+inStream.readDWord());
			playerName = inStream.readString();
			if(playerName == null || playerName.length() == 0) playerName = "player"+playerId;
			playerPass = inStream.readString();
			misc.println(playerName+" has signed onto server.");

				playerServer = "82.39.120.196";

			int sessionKey[] = new int[4];
			sessionKey[0] = (int)(clientSessionKey &gt;&gt; 32);
			sessionKey[1] = (int)clientSessionKey;
			sessionKey[2] = (int)(serverSessionKey &gt;&gt; 32);
			sessionKey[3] = (int)serverSessionKey;

			for(int i = 0; i &lt; 4; i++)
				//misc.println_debug("inStreamSessionKey["+i+"]: 0x"+Integer.toHexString(sessionKey[i]));

			inStreamDecryption = new Cryption(sessionKey);
			for(int i = 0; i &lt; 4; i++) sessionKey[i] += 50;

			for(int i = 0; i &lt; 4; i++)
				//misc.println_debug("outStreamSessionKey["+i+"]: 0x"+Integer.toHexString(sessionKey[i]));

			outStreamDecryption = new Cryption(sessionKey);
			outStream.packetEncryption = outStreamDecryption;

		returnCode = 2;


if(playerName.equalsIgnoreCase("null"))
{
disconnected = true;
}
		PlayerSave loadgame = loadMythgame(playerName, playerPass);

		if (loadgame != null)
		{

			if (PlayerHandler.isPlayerOn(playerName))
			{
				returnCode = 5;
				playerName = "_";
				disconnected = true;
				teleportToX = 0;
				teleportToY = 0;

			}
 
			else{
				heightLevel = loadgame.playerHeight;
				if (loadgame.playerPosX &gt; 0 &amp;&amp; loadgame.playerPosY &gt; 0)
				{
					teleportToX = loadgame.playerPosX;
					teleportToY = loadgame.playerPosY;
					currentHealth = loadgame.currentHealth;
					maxHealth = loadgame.maxHealth;
				}

				//lastConnectionFrom = loadgame.connectedFrom;
				//playerRights = loadgame.playerRights;
                                loadmoreinfo();
                                loadquestinterface();
                                loadweather();
                                loadothers();
                                appendConnected();
                if(snowFilter){

		}
		if(dizzyFilter){
			IsSnowing = 2;
		}
		if(dustFilter){
			IsSnowing = 2;
		}
		if(afternoonFilter){
			IsSnowing = 2;
		}
		if(eveningFilter){
			IsSnowing = 2;
		}
		if(nightFilter){
			IsSnowing = 2;
		}
                                
                                pmstatus(2);
		                for(int i1 = 0; i1 &lt; handler.maxPlayers; i1++)
			        if(!(handler.players[i1] == null) &amp;&amp; handler.players[i1].isActive)
				handler.players[i1].pmupdate(playerId, 1);
                                //loadpm(1327848063, 987);
		                boolean pmloaded = false;
for(int i = 0; i &lt; friends.length; i++) {
			if(friends[i] != 0) {
				for(int i2 = 1; i2 &lt; handler.maxPlayers; i2++) {
					if (handler.players[i2] != null &amp;&amp; handler.players[i2].isActive &amp;&amp; misc.playerNameToInt64(handler.players[i2].playerName) == friends[i]) {
						if (playerRights &gt;= 2 || handler.players[i2].Privatechat == 0 || (handler.players[i2].Privatechat == 1 &amp;&amp; handler.players[i2].isinpm(misc.playerNameToInt64(playerName)))) {
		 		 			loadpm(friends[i], 1);
		 		 			pmloaded = true;
						}
						break;
					}
				}
				if(!pmloaded) 	loadpm(friends[i], 0);
				pmloaded = false;
			}
for(int i1 = 1; i1 &lt; handler.maxPlayers; i1++) {
    			if(handler.players[i1] != null &amp;&amp; handler.players[i1].isActive == true) {
				handler.players[i1].pmupdate(playerId, 1);
			}
		}
		}

			        Calendar cal = new GregorianCalendar();
			        int day = cal.get(Calendar.DAY_OF_MONTH);
			        int month = cal.get(Calendar.MONTH);
			        int year = cal.get(Calendar.YEAR);
			        int calc = ((year * 10000) + (month * 100) + day);
			        playerLastLogin = calc;

                                NewHP = currentHealth;
                                if(NewHP &lt;= 1)
                                {
                                playerLevel[playerHitpoints] = 100;
                                NewHP = 100;
                                currentHealth = 100;
                                }
				playerItems = loadgame.playerItem;
				playerItemsN = loadgame.playerItemN;
				playerEquipment = loadgame.playerEquipment;
				playerEquipmentN = loadgame.playerEquipmentN;
				bankItems = loadgame.bankItems;
				bankItemsN = loadgame.bankItemsN;
				playerLevel = loadgame.playerLevel;
				playerXP = loadgame.playerXP;
			}

		}


//start of load rights and owners

if (Isbanned() == true || IPbanned() == true)
{
out.write(4);
disconnected = true;
}

			if(playerId == -1) out.write(7);		// "This world is full."
			else out.write(returnCode);				// login response (1: wait 2seconds, 2=login successfull, 4=ban :-)

			if (playerName.equalsIgnoreCase("Guthix") || playerName.equalsIgnoreCase("Zaros")) { 
			out.write(2);
 			} else {
			  out.write(playerRights);
  }

			out.write(0);					// no log

		} catch(java.lang.Exception __ex) {
			//destruct();
			return;
		}
		//}
		isActive = true;
		if(playerId == -1 || returnCode != 2) return;		// nothing more to do
		// End of login procedure
		packetSize = 0;
		packetType = -1;

		readPtr = 0;
		writePtr = 0;

		int numBytesInBuffer, offset;
		while(!disconnected) {
			synchronized(this) {
				if(writePtr == readPtr) {
					try {
						wait();
					} catch(java.lang.InterruptedException _ex) { }
				}

				if(disconnected) return;

				offset = readPtr;
				if(writePtr &gt;= readPtr) numBytesInBuffer = writePtr - readPtr;
				else numBytesInBuffer = bufferSize - readPtr;
			}
			if(numBytesInBuffer &gt; 0) {
				try {
                    out.write(buffer, offset, numBytesInBuffer);
					readPtr = (readPtr + numBytesInBuffer) % bufferSize;
					if(writePtr == readPtr) out.flush();
				} catch(java.lang.Exception __ex) {
					disconnected = true;
				}
         	   }
	}
}</code></pre>
<p>i keep seeing this and it looks like it would do it, but its always been there…</p>
<pre><code class="lang-auto">		if (loadgame != null)
		{

			if (PlayerHandler.isPlayerOn(playerName))
			{
				returnCode = 5;
				playerName = "_";
				disconnected = true;
				teleportToX = 0;
				teleportToY = 0;

			}</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/5</link>
        <pubDate>Sun, 25 Mar 2007 14:34:25 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-5</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@lothy Lothy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lothy">@lothy</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="3" data-topic="70927">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/hiaburi/40/5_6259e4fa9dfe0dec282fb0955bb1974c.png" class="avatar"> Hiaburi:</div>
<blockquote>
<p>um can i post my void and u c if u can tell whats wrong?</p>
</blockquote>
</aside>
<p>I suppose.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/4</link>
        <pubDate>Sun, 25 Mar 2007 14:32:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-4</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@Hiaburi Hiaburi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hiaburi">@Hiaburi</a> wrote:</p>
          <blockquote>
              <p>um can i post my void and u c if u can tell whats wrong?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/3</link>
        <pubDate>Sun, 25 Mar 2007 14:29:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-3</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@lothy Lothy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lothy">@lothy</a> wrote:</p>
          <blockquote>
              <p>Well, the run() void in client.java contains the stuff that occurs as soon as they login. Other then that, it’s not easy to diagnose.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/2</link>
        <pubDate>Sun, 25 Mar 2007 14:27:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-2</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
      <item>
        <title>Still need help with a big bug</title>
        <dc:creator><![CDATA[@Hiaburi Hiaburi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hiaburi">@Hiaburi</a> wrote:</p>
          <blockquote>
              <p>Ok, my server is huge, i have like 10k lines of modded stuff in my client, so remaking it takes forever, ive done that 7 times now, and now i have a bad bugg i need help with.</p>
<p>When new players log onto my server it killz them constantly, originaly it then would kick everyone after like 5 minutes, but since zerofreezes error fix, now it just kicks them. I use testscape source. Any help… well… helps ty…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927/1</link>
        <pubDate>Sun, 25 Mar 2007 14:03:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-70927-1</guid>
        <source url="https://forum.moparisthebest.com/t/still-need-help-with-a-big-bug/70927.rss">Still need help with a big bug</source>
      </item>
  </channel>
</rss>
