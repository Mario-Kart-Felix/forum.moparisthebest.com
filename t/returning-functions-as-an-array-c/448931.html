<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/returning-functions-as-an-array-c/448931 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:28:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Returning functions as an array C - General Programming - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m still learning, so bear with me.  This is boggling my mind that I cannot return a function as an array.  Everytime I try i get an error.  Could anyone explain why I can&amp;#39;t return a function as an array and suggest som&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="448931.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Returning functions as an array C&#39;" href="448931.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/returning-functions-as-an-array-c/448931" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/returning-functions-as-an-array-c/448931" />
<meta property="og:title" content="Returning functions as an array C" />
<meta name="twitter:title" content="Returning functions as an array C" />
<meta property="og:description" content="I’m still learning, so bear with me.  This is boggling my mind that I cannot return a function as an array.  Everytime I try i get an error.  Could anyone explain why I can’t return a function as an array and suggest some other ways?  If you still don’t understand…   char readFromFile[60](char file[]) {     FILE *fp;     fp = fopen(file, &quot;r&quot;);     char var[50];     while(fgets(var, 50, fp) != NULL)     {      //   printf(&quot;%s &lt;- is what i found\n&quot;, var);         ;     }     fclose(fp);     return..." />
<meta name="twitter:description" content="I’m still learning, so bear with me.  This is boggling my mind that I cannot return a function as an array.  Everytime I try i get an error.  Could anyone explain why I can’t return a function as an array and suggest some other ways?  If you still don’t understand…   char readFromFile[60](char file[]) {     FILE *fp;     fp = fopen(file, &quot;r&quot;);     char var[50];     while(fgets(var, 50, fp) != NULL)     {      //   printf(&quot;%s &lt;- is what i found\n&quot;, var);         ;     }     fclose(fp);     return..." />
<meta property="article:published_time" content="2012-07-09T08:55:38+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="448931.html">Returning functions as an array C</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imsuperman05.html'><span itemprop='name'>imsuperman05</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T08:55:38Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:27:42Z' class='post-time'>
              August 3, 2016, 12:27pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m still learning, so bear with me.  This is boggling my mind that I cannot return a function as an array.  Everytime I try i get an error.  Could anyone explain why I can’t return a function as an array and suggest some other ways?</p>
<p>If you still don’t understand…</p>
<p><code>
char readFromFile[60](char file[])
{
    FILE *fp;
    fp = fopen(file, "r");
    char var[50];
    while(fgets(var, 50, fp) != NULL)
    {
     //   printf("%s &lt;- is what i found\n", var);
        ;
    }
    fclose(fp);
    return var;
}</code><br>
I want to return the whole char array that’s being read from the file, separately.</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/slavemaster.html'><span itemprop='name'>slavemaster</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T09:10:53Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:27:43Z' class='post-time'>
              August 3, 2016, 12:27pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a href="http://c-faq.com/aryptr/index.html" class="onebox" target="_blank" rel="nofollow noopener">http://c-faq.com/aryptr/index.html</a></p>
<p>Arrays degenerate to pointers when passed as function parameters or when used as return values. As an example, <code>char file[]</code> will degenerate into effectively <code>char *file</code>, pointing to the leading character in the string.<br>
I strongly advise you to avoid returning pointers to automatic local variables, because using them is inherently undefined behavior. Typically, as on my system, <code>var</code> is allocated on the stack, and when <code>readFromFile</code> returns, it provides me a pointer to somewhere on the stack which is easily unintentionally corrupted. It is easier to pass an array in whose memory is guaranteed to not be reused. Here’s an example case:</p>
<p>[code=c]<span class="hashtag">#include</span> &lt;stdio.h&gt;<br>
<span class="hashtag">#include</span> &lt;stdlib.h&gt;<br>
<span class="hashtag">#include</span> &lt;string.h&gt;</p>
<p>char *readFromFile(char file[]) {<br>
FILE *fp = fopen(file, “r”);<br>
char var[50];<br>
while (fgets(var, 50, fp)) {<br>
printf(“var is: %s”, var);<br>
}<br>
fclose(fp);<br>
return var;<br>
}</p>
<p>main() {<br>
char *data = readFromFile(“read-from-file.c”);<br>
printf(“data is: %s\n”, data);<br>
return 0;<br>
}[/code]<br>
Note I use a slightly modified form of your original function. When compiling, gcc warns me of the potential bug:</p>
<p><code>read-from-file.c: In function 'readFromFile':
read-from-file.c:12:3: warning: function returns address of local variable [enab
led by default]</code><br>
and here’s what I get when executing it:</p>
<p><code>var is: #include &lt;stdio.h&gt;
var is: #include &lt;stdlib.h&gt;
var is: #include &lt;string.h&gt;
var is:
var is: char *readFromFile(char file[]) {
var is:   FILE *fp = fopen(file, "r");
var is:   char var[50] = { 0 };
var is:   while (fgets(var, 50, fp)) {
var is:     printf("var is: %s", var);
var is:   }
var is:   fclose(fp);
var is:   return var;
var is: }
var is:
var is: main() {
var is:   char *data = readFromFile("read-from-file.c");
var is:   printf("data is: %s\n", data);
var is:   return 0;
var is: }
data is: \ué0@</code><br>
var was last “}\r\n”, but by the time printf manages to output the string, the memory now reads “\ué0@”.</p>
<p><a>code=asm</a> file read-from-file.exe<br>
Reading symbols from C:\dev\scrap\read-from-file.exe…done.<br>
(gdb) set disassembly-flavor intel<br>
(gdb) disass main<br>
Dump of assembler code for function main:<br>
0x00401402 &lt;+0&gt;:     push   ebp<br>
0x00401403 &lt;+1&gt;:     mov    ebp,esp<br>
0x00401405 &lt;+3&gt;:     and    esp,0xfffffff0<br>
0x00401408 &lt;+6&gt;:     sub    esp,0x20<br>
0x0040140b &lt;+9&gt;:     call   0x401958 &lt;__main&gt;<br>
0x00401410 &lt;+14&gt;:    mov    DWORD PTR [esp],0x403071<br>
0x00401417 &lt;+21&gt;:    call   0x40138c <br>
0x0040141c &lt;+26&gt;:    mov    DWORD PTR [esp+0x1c],eax<br>
0x00401420 &lt;+30&gt;:    mov    eax,DWORD PTR [esp+0x1c]<br>
0x00401424 &lt;+34&gt;:    mov    DWORD PTR [esp+0x4],eax<br>
0x00401428 &lt;+38&gt;:    mov    DWORD PTR [esp],0x403082<br>
0x0040142f &lt;+45&gt;:    call   0x401b98 <br>
0x00401434 &lt;+50&gt;:    mov    eax,0x0<br>
0x00401439 &lt;+55&gt;:    leave<br>
0x0040143a &lt;+56&gt;:    ret<br>
0x0040143b &lt;+57&gt;:    nop<br>
End of assembler dump.<br>
(gdb) disass readFromFile<br>
Dump of assembler code for function readFromFile:<br>
0x0040138c &lt;+0&gt;:     push   ebp<br>
0x0040138d &lt;+1&gt;:     mov    ebp,esp<br>
0x0040138f &lt;+3&gt;:     push   edi<br>
0x00401390 &lt;+4&gt;:     push   ebx<br>
0x00401391 &lt;+5&gt;:     sub    esp,0x50<br>
0x00401394 &lt;+8&gt;:     mov    DWORD PTR [esp+0x4],0x403064<br>
0x0040139c &lt;+16&gt;:    mov    eax,DWORD PTR [ebp+0x8]<br>
0x0040139f &lt;+19&gt;:    mov    DWORD PTR [esp],eax<br>
0x004013a2 &lt;+22&gt;:    call   0x401b90 <br>
0x004013a7 &lt;+27&gt;:    mov    DWORD PTR [ebp-0xc],eax<br>
0x004013aa &lt;+30&gt;:    lea    ebx,[ebp-0x3e]<br>
0x004013ad &lt;+33&gt;:    mov    al,0x0<br>
0x004013af &lt;+35&gt;:    mov    edx,0x32<br>
0x004013b4 &lt;+40&gt;:    mov    edi,ebx<br>
0x004013b6 &lt;+42&gt;:    mov    ecx,edx<br>
0x004013b8 &lt;+44&gt;:    rep stos BYTE PTR es:[edi],al<br>
0x004013ba &lt;+46&gt;:    jmp    0x4013cf &lt;readFromFile+67&gt;<br>
0x004013bc &lt;+48&gt;:    lea    eax,[ebp-0x3e]<br>
0x004013bf &lt;+51&gt;:    mov    DWORD PTR [esp+0x4],eax<br>
0x004013c3 &lt;+55&gt;:    mov    DWORD PTR [esp],0x403066<br>
0x004013ca &lt;+62&gt;:    call   0x401b98 <br>
0x004013cf &lt;+67&gt;:    mov    eax,DWORD PTR [ebp-0xc]<br>
0x004013d2 &lt;+70&gt;:    mov    DWORD PTR [esp+0x8],eax<br>
0x004013d6 &lt;+74&gt;:    mov    DWORD PTR [esp+0x4],0x32<br>
0x004013de &lt;+82&gt;:    lea    eax,[ebp-0x3e]<br>
0x004013e1 &lt;+85&gt;:    mov    DWORD PTR [esp],eax<br>
0x004013e4 &lt;+88&gt;:    call   0x401ba0 <br>
0x004013e9 &lt;+93&gt;:    test   eax,eax<br>
0x004013eb &lt;+95&gt;:    jne    0x4013bc &lt;readFromFile+48&gt;<br>
0x004013ed &lt;+97&gt;:    mov    eax,DWORD PTR [ebp-0xc]<br>
0x004013f0 &lt;+100&gt;:   mov    DWORD PTR [esp],eax<br>
0x004013f3 &lt;+103&gt;:   call   0x401ba8 <br>
0x004013f8 &lt;+108&gt;:   lea    eax,[ebp-0x3e]<br>
0x004013fb &lt;+111&gt;:   add    esp,0x50<br>
0x004013fe &lt;+114&gt;:   pop    ebx<br>
0x004013ff &lt;+115&gt;:   pop    edi<br>
0x00401400 &lt;+116&gt;:   pop    ebp<br>
0x00401401 &lt;+117&gt;:   ret<br>
End of assembler dump.[/code]<br>
The big thing here is this:</p>
<p><code>   0x004013f8 &lt;+108&gt;:   lea    eax,[ebp-0x3e]
   0x004013fb &lt;+111&gt;:   add    esp,0x50
   0x004013fe &lt;+114&gt;:   pop    ebx
   ...
   0x00401401 &lt;+117&gt;:   ret</code><br>
It’s returning the address to the stack-allocated line buffer (<code>var</code>), but also, being a well-behaved function, adjusts the stack and base pointers back to as the caller had them. printf itself also needs to use the stack, thus reusing the memory data pointed to and as a result inadvertently corrupts the result. Is this what you potentially want?<br>
It’s a better approach to pass in an array or pointer to the memory you want to be filled with the last line, just like how <code>fgets</code> takes a <code>char *</code>.</p>
<p>Apart from that, purely aesthetic things… <code>NULL</code> is defined to be <code>((void *) 0)</code> in string.h, so the comparison can be dropped as zero is evaluated as <code>false</code> while non-zero is <code>true</code>.</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T09:52:30Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:27:43Z' class='post-time'>
              August 3, 2016, 12:27pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">char* readFromFile(char* fileName) {
   ...
}</code></pre>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T14:22:29Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:27:52Z' class='post-time'>
              August 3, 2016, 12:27pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ps your function is flawed as it will only return the last 50 characters of the file</p>
<p>edit: what environment/os are you using, btw?</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imsuperman05.html'><span itemprop='name'>imsuperman05</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T17:34:14Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:28:03Z' class='post-time'>
              August 3, 2016, 12:28pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“veer, post:2, topic:448931”]<a href="http://c-faq.com/aryptr/index.html" rel="nofollow noopener">http://c-faq.com/aryptr/index.html</a></p>
<p>Arrays degenerate to pointers when passed as function parameters or when used as return values. As an example, <code>char file[]</code> will degenerate into effectively <code>char *file</code>, pointing to the leading character in the string.<br>
I strongly advise you to avoid returning pointers to automatic local variables, because using them is inherently undefined behavior. Typically, as on my system, <code>var</code> is allocated on the stack, and when <code>readFromFile</code> returns, it provides me a pointer to somewhere on the stack which is easily unintentionally corrupted. It is easier to pass an array in whose memory is guaranteed to not be reused. Here’s an example case:</p>
<p>[code=c]<span class="hashtag">#include</span> &lt;stdio.h&gt;<br>
<span class="hashtag">#include</span> &lt;stdlib.h&gt;<br>
<span class="hashtag">#include</span> &lt;string.h&gt;</p>
<p>char *readFromFile(char file[]) {<br>
FILE *fp = fopen(file, “r”);<br>
char var[50];<br>
while (fgets(var, 50, fp)) {<br>
printf(“var is: %s”, var);<br>
}<br>
fclose(fp);<br>
return var;<br>
}</p>
<p>main() {<br>
char *data = readFromFile(“read-from-file.c”);<br>
printf(“data is: %s\n”, data);<br>
return 0;<br>
}[/code]<br>
Note I use a slightly modified form of your original function. When compiling, gcc warns me of the potential bug:</p>
<p><code>read-from-file.c: In function 'readFromFile':
read-from-file.c:12:3: warning: function returns address of local variable [enab
led by default]</code><br>
and here’s what I get when executing it:</p>
<p><code>var is: #include &lt;stdio.h&gt;
var is: #include &lt;stdlib.h&gt;
var is: #include &lt;string.h&gt;
var is:
var is: char *readFromFile(char file[]) {
var is:   FILE *fp = fopen(file, "r");
var is:   char var[50] = { 0 };
var is:   while (fgets(var, 50, fp)) {
var is:     printf("var is: %s", var);
var is:   }
var is:   fclose(fp);
var is:   return var;
var is: }
var is:
var is: main() {
var is:   char *data = readFromFile("read-from-file.c");
var is:   printf("data is: %s\n", data);
var is:   return 0;
var is: }
data is: \ué0@</code><br>
var was last “}\r\n”, but by the time printf manages to output the string, the memory now reads “\ué0@”.</p>
<p><a>code=asm</a> file read-from-file.exe<br>
Reading symbols from C:\dev\scrap\read-from-file.exe…done.<br>
(gdb) set disassembly-flavor intel<br>
(gdb) disass main<br>
Dump of assembler code for function main:<br>
0x00401402 &lt;+0&gt;:     push   ebp<br>
0x00401403 &lt;+1&gt;:     mov    ebp,esp<br>
0x00401405 &lt;+3&gt;:     and    esp,0xfffffff0<br>
0x00401408 &lt;+6&gt;:     sub    esp,0x20<br>
0x0040140b &lt;+9&gt;:     call   0x401958 &lt;__main&gt;<br>
0x00401410 &lt;+14&gt;:    mov    DWORD PTR [esp],0x403071<br>
0x00401417 &lt;+21&gt;:    call   0x40138c <br>
0x0040141c &lt;+26&gt;:    mov    DWORD PTR [esp+0x1c],eax<br>
0x00401420 &lt;+30&gt;:    mov    eax,DWORD PTR [esp+0x1c]<br>
0x00401424 &lt;+34&gt;:    mov    DWORD PTR [esp+0x4],eax<br>
0x00401428 &lt;+38&gt;:    mov    DWORD PTR [esp],0x403082<br>
0x0040142f &lt;+45&gt;:    call   0x401b98 <br>
0x00401434 &lt;+50&gt;:    mov    eax,0x0<br>
0x00401439 &lt;+55&gt;:    leave<br>
0x0040143a &lt;+56&gt;:    ret<br>
0x0040143b &lt;+57&gt;:    nop<br>
End of assembler dump.<br>
(gdb) disass readFromFile<br>
Dump of assembler code for function readFromFile:<br>
0x0040138c &lt;+0&gt;:     push   ebp<br>
0x0040138d &lt;+1&gt;:     mov    ebp,esp<br>
0x0040138f &lt;+3&gt;:     push   edi<br>
0x00401390 &lt;+4&gt;:     push   ebx<br>
0x00401391 &lt;+5&gt;:     sub    esp,0x50<br>
0x00401394 &lt;+8&gt;:     mov    DWORD PTR [esp+0x4],0x403064<br>
0x0040139c &lt;+16&gt;:    mov    eax,DWORD PTR [ebp+0x8]<br>
0x0040139f &lt;+19&gt;:    mov    DWORD PTR [esp],eax<br>
0x004013a2 &lt;+22&gt;:    call   0x401b90 <br>
0x004013a7 &lt;+27&gt;:    mov    DWORD PTR [ebp-0xc],eax<br>
0x004013aa &lt;+30&gt;:    lea    ebx,[ebp-0x3e]<br>
0x004013ad &lt;+33&gt;:    mov    al,0x0<br>
0x004013af &lt;+35&gt;:    mov    edx,0x32<br>
0x004013b4 &lt;+40&gt;:    mov    edi,ebx<br>
0x004013b6 &lt;+42&gt;:    mov    ecx,edx<br>
0x004013b8 &lt;+44&gt;:    rep stos BYTE PTR es:[edi],al<br>
0x004013ba &lt;+46&gt;:    jmp    0x4013cf &lt;readFromFile+67&gt;<br>
0x004013bc &lt;+48&gt;:    lea    eax,[ebp-0x3e]<br>
0x004013bf &lt;+51&gt;:    mov    DWORD PTR [esp+0x4],eax<br>
0x004013c3 &lt;+55&gt;:    mov    DWORD PTR [esp],0x403066<br>
0x004013ca &lt;+62&gt;:    call   0x401b98 <br>
0x004013cf &lt;+67&gt;:    mov    eax,DWORD PTR [ebp-0xc]<br>
0x004013d2 &lt;+70&gt;:    mov    DWORD PTR [esp+0x8],eax<br>
0x004013d6 &lt;+74&gt;:    mov    DWORD PTR [esp+0x4],0x32<br>
0x004013de &lt;+82&gt;:    lea    eax,[ebp-0x3e]<br>
0x004013e1 &lt;+85&gt;:    mov    DWORD PTR [esp],eax<br>
0x004013e4 &lt;+88&gt;:    call   0x401ba0 <br>
0x004013e9 &lt;+93&gt;:    test   eax,eax<br>
0x004013eb &lt;+95&gt;:    jne    0x4013bc &lt;readFromFile+48&gt;<br>
0x004013ed &lt;+97&gt;:    mov    eax,DWORD PTR [ebp-0xc]<br>
0x004013f0 &lt;+100&gt;:   mov    DWORD PTR [esp],eax<br>
0x004013f3 &lt;+103&gt;:   call   0x401ba8 <br>
0x004013f8 &lt;+108&gt;:   lea    eax,[ebp-0x3e]<br>
0x004013fb &lt;+111&gt;:   add    esp,0x50<br>
0x004013fe &lt;+114&gt;:   pop    ebx<br>
0x004013ff &lt;+115&gt;:   pop    edi<br>
0x00401400 &lt;+116&gt;:   pop    ebp<br>
0x00401401 &lt;+117&gt;:   ret<br>
End of assembler dump.[/code]<br>
The big thing here is this:</p>
<p><code>   0x004013f8 &lt;+108&gt;:   lea    eax,[ebp-0x3e]
   0x004013fb &lt;+111&gt;:   add    esp,0x50
   0x004013fe &lt;+114&gt;:   pop    ebx
   ...
   0x00401401 &lt;+117&gt;:   ret</code><br>
It’s returning the address to the stack-allocated line buffer (<code>var</code>), but also, being a well-behaved function, adjusts the stack and base pointers back to as the caller had them. printf itself also needs to use the stack, thus reusing the memory data pointed to and as a result inadvertently corrupts the result. Is this what you potentially want?<br>
It’s a better approach to pass in an array or pointer to the memory you want to be filled with the last line, just like how <code>fgets</code> takes a <code>char *</code>.</p>
<p>Apart from that, purely aesthetic things… <code>NULL</code> is defined to be <code>((void *) 0)</code> in string.h, so the comparison can be dropped as zero is evaluated as <code>false</code> while non-zero is <code>true</code>.[/quote]<br>
I see what it does now and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.</p>
<p>[quote=“t4, post:4, topic:448931”]ps your function is flawed as it will only return the last 50 characters of the file</p>
<p>edit: what environment/os are you using, btw?[/quote]<br>
Windows 7 Code::Blocks</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/HcoJustin.html'><span itemprop='name'>HcoJustin</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T18:31:47Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:28:07Z' class='post-time'>
              August 3, 2016, 12:28pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“imsuperman05, post:5, topic:448931”][quote author=veer link=topic=551826.msg4043086#msg4043086 date=1341825053]<br>
…<br>
[/quote]<br>
I see what it does not and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.[/quote]</p>
<p>So each index in the array points to a line in the file?</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imsuperman05.html'><span itemprop='name'>imsuperman05</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T20:51:33Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:28:13Z' class='post-time'>
              August 3, 2016, 12:28pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“HcoJustin, post:6, topic:448931”][quote author=imsuperman05 link=topic=551826.msg4043333#msg4043333 date=1341855254]</p>
<aside class="quote">
<blockquote>
<p>…</p>
</blockquote>
</aside>
<p>I see what it does not and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.<br>
[/quote]</p>
<p>So each index in the array points to a line in the file?[/quote]<br>
I don’t even know…</p>
<p>Thanks everyone for helping, I decided to keep what I had and only use it as a reference not for use when trying to get data from a file.</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-09T23:36:54Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:28:29Z' class='post-time'>
              August 3, 2016, 12:28pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“HcoJustin, post:6, topic:448931”][quote author=imsuperman05 link=topic=551826.msg4043333#msg4043333 date=1341855254]</p>
<aside class="quote">
<blockquote>
<p>…</p>
</blockquote>
</aside>
<p>I see what it does not and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.<br>
[/quote]</p>
<p>So each index in the array points to a line in the file?[/quote]<br>
each index in the array points to a character in the file…</p>
<p>OP: use a linux distro, install gcc, vim and make.</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_s11.html'><span itemprop='name'>_s11</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-10T16:21:10Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:29:14Z' class='post-time'>
              August 3, 2016, 12:29pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“t4, post:8, topic:448931”][quote author=HcoJustin link=topic=551826.msg4043390#msg4043390 date=1341858707]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>…</p>
</blockquote>
</aside>
<p>I see what it does not and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.</p>
</blockquote>
</aside>
<p>So each index in the array points to a line in the file?<br>
[/quote]<br>
each index in the array points to a character in the file…</p>
<p>OP: use a linux distro, install gcc, vim and make.[/quote]any half decent distro would come with gcc and make preinstalled since they’re pretty damn essential</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/HcoJustin.html'><span itemprop='name'>HcoJustin</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-10T18:56:40Z'>
            <time itemprop='dateModified' datetime='2016-08-03T12:29:27Z' class='post-time'>
              August 3, 2016, 12:29pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“t4, post:8, topic:448931”][quote author=HcoJustin link=topic=551826.msg4043390#msg4043390 date=1341858707]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>…</p>
</blockquote>
</aside>
<p>I see what it does not and what it returns, but that’s not what I wanted it to return.  I wanted it to return an array of the file from that function, so I could use that for further necessities.</p>
</blockquote>
</aside>
<p>So each index in the array points to a line in the file?<br>
[/quote]<br>
each index in the array points to a character in the file…</p>
<p>OP: use a linux distro, install gcc, vim and make.[/quote]</p>
<p>I was asking if that is what he wanted it to do</p>
      </div>

      <meta itemprop='headline' content='Returning functions as an array C'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/returning-functions-as-an-array-c/448931 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:28:13 GMT -->
</html>
