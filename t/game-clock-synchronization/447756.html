<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/game-clock-synchronization/447756 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:44:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Game clock synchronization - General Programming - moparisthebest.com</title>
    <meta name="description" content="Sort of an interesting idea I had while dreaming. In the old 317 client, 5 packets are parsed per every loop cycle. The packets are parsed before the logic takes place where the &amp;#39;WorldMap&amp;#39;, also called the Pallete or &amp;#39;Wo&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="447756.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Game clock synchronization&#39;" href="447756.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/game-clock-synchronization/447756" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/game-clock-synchronization/447756" />
<meta property="og:title" content="Game clock synchronization" />
<meta name="twitter:title" content="Game clock synchronization" />
<meta property="og:description" content="Sort of an interesting idea I had while dreaming. In the old 317 client, 5 packets are parsed per every loop cycle. The packets are parsed before the logic takes place where the ‘WorldMap’, also called the Pallete or ‘WorldController’, has all its actors removed and then is logically updated and redrawn. Those 5 packets can be a range of things, such as spawning a projectile or item. Most of the time there is an associated delay, like with a projectile. For every client logic cycle, 5 packets ar..." />
<meta name="twitter:description" content="Sort of an interesting idea I had while dreaming. In the old 317 client, 5 packets are parsed per every loop cycle. The packets are parsed before the logic takes place where the ‘WorldMap’, also called the Pallete or ‘WorldController’, has all its actors removed and then is logically updated and redrawn. Those 5 packets can be a range of things, such as spawning a projectile or item. Most of the time there is an associated delay, like with a projectile. For every client logic cycle, 5 packets ar..." />
<meta property="article:published_time" content="2012-07-02T01:21:47+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="447756.html">Game clock synchronization</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-02T01:21:47Z'>
            <time itemprop='dateModified' datetime='2016-08-03T09:59:34Z' class='post-time'>
              August 3, 2016,  9:59am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sort of an interesting idea I had while dreaming. In the old 317 client, 5 packets are parsed per every loop cycle. The packets are parsed before the logic takes place where the ‘WorldMap’, also called the Pallete or ‘WorldController’, has all its actors removed and then is logically updated and redrawn. Those 5 packets can be a range of things, such as spawning a projectile or item. Most of the time there is an associated delay, like with a projectile. For every client logic cycle, 5 packets are parsed. The client logic cycle is NOT synchronized with the game server logic cycle with is traditionally 600 ms.</p>
<pre><code class="lang-auto">     if (packetId == 117) {
            int locationHash = buffer.getUbyte();
            int x = spawnX + (locationHash &gt;&gt; 4 &amp; 7);
            int y = spawnY + (locationHash &amp; 7);
            int destX = x + buffer.getByte();
            int destY = y + buffer.getByte();
            int entityId = buffer.getWord();
            int gfxId = buffer.getUword();
            int heightOffset = buffer.getUbyte() * 4;
            int destHeightOffset = buffer.getUbyte() * 4;
            int startCycleOffset = buffer.getUword();
            int endCycleOffset = buffer.getUword();
            int rotation = buffer.getUbyte();
            int unknwnOffset = buffer.getUbyte();
            if (x &gt;= 0 &amp;&amp; y &gt;= 0 &amp;&amp; x &lt; 104 &amp;&amp; y &lt; 104 &amp;&amp; destX &gt;= 0 &amp;&amp; destY &gt;= 0 &amp;&amp; destX &lt; 104 &amp;&amp; destY &lt; 104 &amp;&amp; gfxId != 65535) {
                x = x * 128 + 64;
                y = y * 128 + 64;
                destX = destX * 128 + 64;
                destY = destY * 128 + 64;
                Projectile projectile = new Projectile(rotation, destHeightOffset, startCycleOffset + loopCycle, endCycleOffset + loopCycle, unknwnOffset, localHeight, getFineHeightPosition(x, y, localHeight) - heightOffset, y, x, entityId, gfxId);
                projectile.updateDestination(destX, destY, getFineHeightPosition(destX, destY, localHeight) - destHeightOffset, startCycleOffset + loopCycle);
                projectiles.addLast(projectile);
            }
}</code></pre>
<p>Say I wanted to first, create a projectile, and then create a still graphic object to splash on the target when the projectile hits.</p>
<p>The projectile is expected to take a time of <span class="bbcode-b">500 client logic ticks.</span> The graphic would have to be sent at the 500 client logic tick which is when the trajectory for the projectile would be at the target. That’d approximately be a 2,500 packet difference, although the splash would appear at the correct time. I was thinking, logically, you can’t expect the client to parse packets 5 at a time so you’d have to send simple keep alive packets (no payload) and then have a queuing system to flush all 5 packets at the same time.</p>
<p>Question is, how would you create a reliable system to synchronize the events of the client with the incoming network packets with this information or do you think that it would not be possible or reliable?</p>
<p>I could see that it wouldn’t be possible because unless there was a constant stream of packets coming inbound then there would be times when a tick was skipped and unaccounted for by the server.</p>
<p>Edit: Having a constant stream of packets would be a requirement, but it’d be a reliable way to keep the client and the client registered to the server on a same timescale.</p>
      </div>

      <meta itemprop='headline' content='Game clock synchronization'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/slavemaster.html'><span itemprop='name'>slavemaster</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-02T03:05:19Z'>
            <time itemprop='dateModified' datetime='2016-08-03T09:59:43Z' class='post-time'>
              August 3, 2016,  9:59am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I can paste code too!</p>
<p><code>    if (opcode == 181) {
      int delta = buffer.read_u8();
      int src_x = region_base_x + (delta &gt;&gt; 4 &amp; 7);
      int src_y = region_base_y + (delta &amp; 7);
      int desturkish idiot = src_x + buffer.read_8();
      int dest_y = src_y + buffer.read_8();
      int target = buffer.read_u16();
      int graphic = buffer.read_u16();
      int src_z_off = buffer.read_u8() * 4;
      int dest_z_off = buffer.read_u8() * 4;
      int end = buffer.read_u16();
      int start = buffer.read_u16();
      int leap_scale = buffer.read_u8();
      int elevation = buffer.read_u8();
      if (src_x &gt;= 0 &amp;&amp; src_y &gt;= 0 &amp;&amp; src_x &lt; 104 &amp;&amp; src_y &lt; 104
          &amp;&amp; desturkish idiot &gt;= 0 &amp;&amp; dest_y &gt;= 0 &amp;&amp; desturkish idiot &lt; 104 &amp;&amp; dest_y &lt; 104 &amp;&amp; graphic != 65535) {
        src_x = src_x * 128 + 64;
        src_y = src_y * 128 + 64;
        desturkish idiot = desturkish idiot * 128 + 64;
        dest_y = dest_y * 128 + 64;
        Projectile projectile = new Projectile(local_plane, src_x, src_y, average_z(src_x, src_y, local_plane) - src_z_off,
            leap_scale, elevation, target, dest_z_off, start + tick, end + tick, graphic);
        projectile.target(desturkish idiot, dest_y, average_z(desturkish idiot, dest_y, local_plane) - dest_z_off, end + tick);
        projectiles.append(projectile);
      }
      return;
    }</code></p>
<p><img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
<p>Is there any reason you want to keep the client and server ticks synchronized? I can’t find any. Not even games with complex physics seek to keep the server and client cycle in tandem… consider this:</p>
<p><code>frame_time = 20;</code> (20 ms per update = 50 Hz)<br>
so the client internal oscillator updates about 30 times as fast (600 ms per update = ~1.67 Hz).</p>
<p>EDIT: The client updates about 50 times per second ideally… however each tick can take up to 10 updates with the highest degree of lag compensation, so you can have up to 100 updates per render in the most extreme case. Also, your ‘rotation’ is a scale used for the initial leap of projectile position when initially targeting:</p>
<p><code>    if (!mobile) {
      double dx = desturkish idiot - source_x;
      double dy = dest_y - source_y;
      double dist = Math.sqrt(dx * dx + dy * dy);
      x = (double) source_x + (dx * (double) leap_scale) / dist;
      y = (double) source_y + (dy * (double) leap_scale) / dist;
      z = source_z_offset;
    }</code><br>
Your ‘unknwnOffset’ is actually the <span class="bbcode-i">angle of elevation</span>, as seen here:</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Ideal_projectile_motion_for_different_angles.svg/500px-Ideal_projectile_motion_for_different_angles.svg.png" alt width="500" height="250"></p>
      </div>

      <meta itemprop='headline' content='Game clock synchronization'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-02T04:17:44Z'>
            <time itemprop='dateModified' datetime='2016-08-03T09:59:45Z' class='post-time'>
              August 3, 2016,  9:59am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Oh babe <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> I’ll post a better response later, just got home.</p>
      </div>

      <meta itemprop='headline' content='Game clock synchronization'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/game-clock-synchronization/447756 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:44:40 GMT -->
</html>
