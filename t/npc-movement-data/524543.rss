<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Npc Movement data</title>
    <link>https://forum.moparisthebest.com/t/npc-movement-data/524543</link>
    <description>So I&#39;m throwing myself into the secrets of npc movement and for learning purposes dismantling all code.
I&#39;m doing this with a Winterlove server btw,

So you might have noticed in the Misc class of WL you&#39;ll see some code like this:
[code=java]
public static int direction(int srcX, int srcY, int x, int y) {
		double dx = (double) x - srcX, dy = (double) y - srcY;
		double angle = Math.atan(dy / dx);
		angle = Math.toDegrees(angle);
		if (Double.isNaN(angle))
			return -1;
		if (Math.signum(dx) &lt; 0)
			angle += 180.0;
		return (int) ((((90 - angle) / 22.5) + 16) % 16);
	}
[/code]

Which is used by this piece of code in your NPC class
[code=java]
public int getNextWalkingDirection() {
		int dir;
		dir = Misc.direction(absX, absY, (absX + moveX), (absY + moveY));
		if (dir == -1)
			return -1;
		dir &gt;&gt;= 1;
		absX += moveX;
		absY += moveY;
		return dir;
	}
[/code]



I tried to find out which the actual direction id&#39;s from this line (the method posted first) are,
but the actual ids, not the ones generated by the method.
[code=java]
Misc.direction(absX, absY, (absX + moveX), (absY + moveY));
[/code]


For anyone interested. After some tests I came to these direction id&#39;s for the client:
[i]directionId = x  y[/i]
0 = 0  +1 (north)
1 = +1 +1 (north-east)
2 = +1 0 (east)
3 = +1 -1 (south - east)
4 = 0 -1 (south)
5 = -1 -1 (south - west)
6 = -1 0 (west)
7 = -1 +1 (north - west)




[b]Some things you could change in your server if you feel like it:[/b]

In your updateNpcMovement method you&#39;ll see this line:
[code=java]str.writeBits(3, Misc.xlateDirectionToClient[direction]);[/code]
This can be replaced by:
[code=java]str.writeBits(3, direction);[/code]
and the method from your Misc class can be deleted since it isn&#39;t used anymore.


Now we will change the getNextWalkingDirection method (I renamed it)
[code=java]
private void updateWalkPath() {
//Add your clipping check here.
		direction = getDirection();
		absX += moveX;
		absY += moveY;
		updateRequested = true;
	}[/code]

We also need the getDirection one ofc
[code=java]private int getDirection() {
		if (moveX == 1 &amp;&amp; targetY == 1)
			return 1;
		else if (moveX == 1 &amp;&amp; moveY == 0)
			return 2;
		else if (moveX == 0 &amp;&amp; moveY == 1)
			return 0;
		else if (moveX == - 1 &amp;&amp; moveY == 0)
			return 6;
		else if (moveX == 0 &amp;&amp; moveY == - 1)
			return 4;
		else if (moveX == - 1 &amp;&amp; moveY == - 1)
			return 5;
		else if (moveX == - 1 &amp;&amp; moveY == 1)
			return 7;
		else if (moveX == 1 &amp;&amp; moveY == - 1)
			return 3;
		return -1;
	}[/code]


For updatig your npc&#39;s movement all you have to do is call the updateWalkPath method,
don&#39;t forget to reset the direction to -1 every cycle when there&#39;s there&#39;s a moverequest for the npc or it&#39;ll keep walking in a straight line until the next move.</description>
    
    <lastBuildDate>Wed, 10 Jul 2013 19:28:33 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Npc Movement data</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“Loveandpower, post:4, topic:524543”]Wont/doesn’t this hurt performance?</p>
<aside class="quote">
<blockquote>
<p>don’t forget to reset the direction to -1 every cycle when there’s there’s a moverequest for the npc or it’ll keep walking in a straight line until the next move.[/quote]</p>
</blockquote>
</aside>
<p>It’s done as well with the original methods, you’ll see when you scan through the methods handling movement.<br>
But I rewrote everything and encountered this issue. It’s a warning for when you plan on re(writing) movement if you’d encounter the problem as well,<br>
of npcs walking in a straight line until the next movement request.<br>
Lemee give you a small example.</p>
<pre><code class="lang-auto">public void requestMove() {
   -&gt; check movement chance percentage
         -&gt; movement : no problem, npc will just move
         -&gt; no movement: no movement should be performed in this cycle, but because the direction isn't reset, the player will SEE the npc moving.
}</code></pre>
<p>so we have to reset the direction every cycle in case the npc shouldn’t move</p>
<pre><code class="lang-auto">public void requestMove() {
direction = -1;
   -&gt; check movement chance percentage
...</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/npc-movement-data/524543/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/npc-movement-data/524543/5</link>
        <pubDate>Wed, 10 Jul 2013 19:28:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-524543-5</guid>
        <source url="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss">Npc Movement data</source>
      </item>
      <item>
        <title>Npc Movement data</title>
        <dc:creator><![CDATA[@Loveandpower Loveandpower]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/loveandpower">@Loveandpower</a> wrote:</p>
          <blockquote>
              <p>Wont/doesn’t this hurt performance?</p>
<blockquote>don't forget to reset the direction to -1 every cycle when there's there's a moverequest for the npc or it'll keep walking in a straight line until the next move.</blockquote>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/npc-movement-data/524543/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/npc-movement-data/524543/4</link>
        <pubDate>Wed, 10 Jul 2013 19:23:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-524543-4</guid>
        <source url="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss">Npc Movement data</source>
      </item>
      <item>
        <title>Npc Movement data</title>
        <dc:creator><![CDATA[@asshole_rule asshole_rule]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/asshole_rule">@asshole_rule</a> wrote:</p>
          <blockquote>
              <p>Good release. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/npc-movement-data/524543/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/npc-movement-data/524543/3</link>
        <pubDate>Wed, 10 Jul 2013 19:17:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-524543-3</guid>
        <source url="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss">Npc Movement data</source>
      </item>
      <item>
        <title>Npc Movement data</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>I will be looking into this when i am reworking my NPC movement.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/npc-movement-data/524543/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/npc-movement-data/524543/2</link>
        <pubDate>Wed, 10 Jul 2013 19:07:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-524543-2</guid>
        <source url="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss">Npc Movement data</source>
      </item>
      <item>
        <title>Npc Movement data</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>So I’m throwing myself into the secrets of npc movement and for learning purposes dismantling all code.<br>
I’m doing this with a Winterlove server btw,</p>
<p>So you might have noticed in the Misc class of WL you’ll see some code like this:</p>
<pre><code class="lang-auto">public static int direction(int srcX, int srcY, int x, int y) {
		double dx = (double) x - srcX, dy = (double) y - srcY;
		double angle = Math.atan(dy / dx);
		angle = Math.toDegrees(angle);
		if (Double.isNaN(angle))
			return -1;
		if (Math.signum(dx) &lt; 0)
			angle += 180.0;
		return (int) ((((90 - angle) / 22.5) + 16) % 16);
	}</code></pre>
<p>Which is used by this piece of code in your NPC class</p>
<pre><code class="lang-auto">public int getNextWalkingDirection() {
		int dir;
		dir = Misc.direction(absX, absY, (absX + moveX), (absY + moveY));
		if (dir == -1)
			return -1;
		dir &gt;&gt;= 1;
		absX += moveX;
		absY += moveY;
		return dir;
	}</code></pre>
<p>I tried to find out which the actual direction id’s from this line (the method posted first) are,<br>
but the actual ids, not the ones generated by the method.</p>
<pre><code class="lang-auto">Misc.direction(absX, absY, (absX + moveX), (absY + moveY));</code></pre>
<p>For anyone interested. After some tests I came to these direction id’s for the client:<br>
<span class="bbcode-i">directionId = x  y</span><br>
0 = 0  +1 (north)<br>
1 = +1 +1 (north-east)<br>
2 = +1 0 (east)<br>
3 = +1 -1 (south - east)<br>
4 = 0 -1 (south)<br>
5 = -1 -1 (south - west)<br>
6 = -1 0 (west)<br>
7 = -1 +1 (north - west)</p>
<p><span class="bbcode-b">Some things you could change in your server if you feel like it:</span></p>
<p>In your updateNpcMovement method you’ll see this line:</p>
<pre><code class="lang-auto"></code></pre>
<p>This can be replaced by:</p>
<pre><code class="lang-auto"></code></pre>
<p>and the method from your Misc class can be deleted since it isn’t used anymore.</p>
<p>Now we will change the getNextWalkingDirection method (I renamed it)</p>
<p><code>
private void updateWalkPath() {
//Add your clipping check here.
		direction = getDirection();
		absX += moveX;
		absY += moveY;
		updateRequested = true;
	}</code></p>
<p>We also need the getDirection one ofc</p>
<p><code>private int getDirection() {
		if (moveX == 1 &amp;&amp; targetY == 1)
			return 1;
		else if (moveX == 1 &amp;&amp; moveY == 0)
			return 2;
		else if (moveX == 0 &amp;&amp; moveY == 1)
			return 0;
		else if (moveX == - 1 &amp;&amp; moveY == 0)
			return 6;
		else if (moveX == 0 &amp;&amp; moveY == - 1)
			return 4;
		else if (moveX == - 1 &amp;&amp; moveY == - 1)
			return 5;
		else if (moveX == - 1 &amp;&amp; moveY == 1)
			return 7;
		else if (moveX == 1 &amp;&amp; moveY == - 1)
			return 3;
		return -1;
	}</code></p>
<p>For updatig your npc’s movement all you have to do is call the updateWalkPath method,<br>
don’t forget to reset the direction to -1 every cycle when there’s there’s a moverequest for the npc or it’ll keep walking in a straight line until the next move.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/npc-movement-data/524543/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/npc-movement-data/524543/1</link>
        <pubDate>Wed, 10 Jul 2013 19:05:53 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-524543-1</guid>
        <source url="https://forum.moparisthebest.com/t/npc-movement-data/524543.rss">Npc Movement data</source>
      </item>
  </channel>
</rss>
