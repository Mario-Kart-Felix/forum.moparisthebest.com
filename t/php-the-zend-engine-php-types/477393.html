<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/php-the-zend-engine-php-types/477393 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>PHP &amp; The Zend Engine - PHP Types - General Programming - moparisthebest.com</title>
    <meta name="description" content="There isn&amp;#39;t alot of practical use to this topic&amp;#39;s subject, but I figure it is cool to know what happens under the hood in PHP. :slight_smile: 

You can find PHP and the Zend Engine&amp;#39;s source code here: http://lxr.php.net/&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="477393.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;PHP &amp; The Zend Engine - PHP Types&#39;" href="477393.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/php-the-zend-engine-php-types/477393" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/php-the-zend-engine-php-types/477393" />
<meta property="og:title" content="PHP &amp; The Zend Engine - PHP Types" />
<meta name="twitter:title" content="PHP &amp; The Zend Engine - PHP Types" />
<meta property="og:description" content="There isnâ€™t alot of practical use to this topicâ€™s subject, but I figure it is cool to know what happens under the hood in PHP. ðŸ™‚  You can find PHP and the Zend Engineâ€™s source code here: http://lxr.php.net/xref/  zend value/zval - A struct (_zval_struct) containing information about a variable. A zval is essentially a variable in PHP.  zval value - A union (zvalue_value) which holds the value of a zval (according to its valueâ€™s type). These values include: a double, long, zend objec..." />
<meta name="twitter:description" content="There isnâ€™t alot of practical use to this topicâ€™s subject, but I figure it is cool to know what happens under the hood in PHP. ðŸ™‚  You can find PHP and the Zend Engineâ€™s source code here: http://lxr.php.net/xref/  zend value/zval - A struct (_zval_struct) containing information about a variable. A zval is essentially a variable in PHP.  zval value - A union (zvalue_value) which holds the value of a zval (according to its valueâ€™s type). These values include: a double, long, zend objec..." />
<meta property="article:published_time" content="2013-01-02T22:01:38+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="477393.html">PHP &amp; The Zend Engine - PHP Types</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/justaguy.html'><span itemprop='name'>justaguy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2013-01-02T22:01:38Z'>
            <time itemprop='dateModified' datetime='2016-08-04T02:01:50Z' class='post-time'>
              August 4, 2016,  2:01am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>There isnâ€™t alot of practical use to this topicâ€™s subject, but I figure it is cool to know what happens under the hood in PHP. <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>You can find PHP and the Zend Engineâ€™s source code here: <a href="http://lxr.php.net/xref/" rel="nofollow noopener">http://lxr.php.net/xref/</a></p>
<p><span class="bbcode-b">zend value/zval</span> - A struct (<span class="bbcode-i">_zval_struct</span>) containing information about a variable. A zval is essentially a variable in PHP.</p>
<p><span class="bbcode-b">zval value</span> - A union (<span class="bbcode-i">zvalue_value</span>) which holds the value of a zval (according to its valueâ€™s type). These values include: a double, long, zend object, HashTable, and string. This proves types such as resources, integers, nulls, and booleans are all represented as longs. A union holds the data of one value at a time.</p>
<p>Types in PHP are defined in the Zend Engine in the <span class="bbcode-b">Zend/zend.h</span> header file. The header file contains the zval struct, which within that contains the <span class="bbcode-i">zvalue_value</span> union which holds the actual <span class="bbcode-i">variable data</span> and a <span class="bbcode-i">type identifier</span>.</p>
<p>[code=c]typedef union _zvalue_value {<br>
long lval;                  /* long value <em>/<br>
double dval;                /</em> double value */<br>
struct {<br>
char *val;<br>
int len;<br>
} str;<br>
HashTable <em>ht;              /</em> hash table value */<br>
zend_object_value obj;<br>
} zvalue_value;</p>
<p>struct _zval_struct {<br>
/* Variable information <em>/<br>
zvalue_value value;     /</em> value <em>/<br>
zend_uint refcount__gc;<br>
zend_uchar type;    /</em> active type */<br>
zend_uchar is_ref__gc;<br>
};[/code]</p>
<p>The <span class="bbcode-i">zvalue_value</span> union defines PHPâ€™s <span class="bbcode-b">internal</span> variable data types. Although integers and floats exist as types in PHP, they arenâ€™t actually stored as these types in variables. Instead, values are stored as:</p>
<p>[ul][li]Booleans, bytes, shorts, and integers are stored as longs.[/li]<br>
[li]Floats are stored as doubles.[/li]<br>
[li]Chars (including a single char) are stored as Strings.[/li]<br>
[li]Resources have a long identifier which is used to identify the resource type.[/li]<br>
[li]Arrays are actually HashTables.[/li]<br>
[li]A null is wellâ€¦ a null.[/li][/ul]</p>
<p>The <span class="bbcode-i">zend_object_value</span> is a special struct specifically for objects which will (hopefully) be covered in later posts.</p>
<p>The <span class="bbcode-i">type</span> field stores a numeric representation of the type of the data which is stored. These types are defined in the same file:</p>
<p><code>/* data types */
/* All data types &lt;= IS_BOOL have their constructor/destructors skipped */
#define IS_NULL     0
#define IS_LONG     1
#define IS_DOUBLE   2
#define IS_BOOL     3
#define IS_ARRAY    4
#define IS_OBJECT   5
#define IS_STRING   6
#define IS_RESOURCE 7
#define IS_CONSTANT 8
#define IS_CONSTANT_ARRAY   9
#define IS_CALLABLE 10</code></p>
<p>Now letâ€™s look into types a bit more; consider PHPâ€™s <a data-bbcode="true">settype()</a> function. Consider the following <a data-bbcode="true">code in PHPâ€™s source code</a>,</p>
<p>[code=c]/* {{{ proto bool settype(mixed var, string type)<br>
Set the type of the variable */<br>
PHP_FUNCTION(settype)<br>
{<br>
zval **var;<br>
char *type;<br>
int type_len = 0;</p>
<pre><code>if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "Zs", &amp;var, &amp;type, &amp;type_len) == FAILURE) {
    return;
}

if (!strcasecmp(type, "integer")) {
    convert_to_long(*var);
} else if (!strcasecmp(type, "int")) {
    convert_to_long(*var);
} else if (!strcasecmp(type, "float")) {
    convert_to_double(*var);
} else if (!strcasecmp(type, "double")) { /* deprecated */
    convert_to_double(*var);
} else if (!strcasecmp(type, "string")) {
    convert_to_string(*var);
} else if (!strcasecmp(type, "array")) {
    convert_to_array(*var);
} else if (!strcasecmp(type, "object")) {
    convert_to_object(*var);
} else if (!strcasecmp(type, "bool")) {
    convert_to_boolean(*var);
} else if (!strcasecmp(type, "boolean")) {
    convert_to_boolean(*var);
} else if (!strcasecmp(type, "null")) {
    convert_to_null(*var);
} else if (!strcasecmp(type, "resource")) {
    php_error_docref(NULL TSRMLS_CC, E_WARNING, "Cannot convert to resource type");
    RETURN_FALSE;
} else {
    php_error_docref(NULL TSRMLS_CC, E_WARNING, "Invalid type");
    RETURN_FALSE;
}
RETVAL_TRUE;
</code></pre>
<p>}<br>
/* }}} */[/code]<br>
This is a simple function which takes a PHP variable (a <span class="bbcode-i">zval</span>, which is defined as a pointer to a pointer in the function) and a type value. The zval points to a PHP variableâ€™s pointer (its zval). The function calls another function to do the actual conversion and takes the dereferenced variable (which is now just a pointer). Subsequent conversions are handled by the Zend Engine.</p>
<p>The simplest of the conversions is probably to the Boolean type, so that is the conversion which will be investigated. The function which does the conversion is <a data-bbcode="true">convert_to_boolean()</a>,</p>
<p>[code=c]ZEND_API void convert_to_boolean(zval <em>op) /</em> {{{ */<br>
{<br>
int tmp;</p>
<pre><code>switch (Z_TYPE_P(op)) {
    case IS_BOOL:
        break;
    case IS_NULL:
        Z_LVAL_P(op) = 0;
        break;
    case IS_RESOURCE: {
            TSRMLS_FETCH();

            zend_list_delete(Z_LVAL_P(op));
        }
        /* break missing intentionally */
    case IS_LONG:
        Z_LVAL_P(op) = (Z_LVAL_P(op) ? 1 : 0);
        break;
    case IS_DOUBLE:
        Z_LVAL_P(op) = (Z_DVAL_P(op) ? 1 : 0);
        break;
    case IS_STRING:
        {
            char *strval = Z_STRVAL_P(op);

            if (Z_STRLEN_P(op) == 0
                || (Z_STRLEN_P(op)==1 &amp;&amp; Z_STRVAL_P(op)[0]=='0')) {
                Z_LVAL_P(op) = 0;
            } else {
                Z_LVAL_P(op) = 1;
            }
            STR_FREE(strval);
        }
        break;
    case IS_ARRAY:
        tmp = (zend_hash_num_elements(Z_ARRVAL_P(op))?1:0);
        zval_dtor(op);
        Z_LVAL_P(op) = tmp;
        break;
    case IS_OBJECT:
        {
            zend_bool retval = 1;
            TSRMLS_FETCH();

            convert_object_to_type(op, IS_BOOL, convert_to_boolean);

            if (Z_TYPE_P(op) == IS_BOOL) {
                return;
            }

            zval_dtor(op);
            ZVAL_BOOL(op, retval);
            break;
        }
    default:
        zval_dtor(op);
        Z_LVAL_P(op) = 0;
        break;
}
Z_TYPE_P(op) = IS_BOOL;
</code></pre>
<p>}<br>
/* }}} */[/code]<br>
The switch statement accesses the zvalâ€™s type. This allows the function to determine exactly which type it has in order to make the proper conversion. <span class="bbcode-i">Z_TYPE_P</span> can be simplified to,</p>
<p><code>#define Z_TYPE(zval)        (zval).type
#define Z_TYPE_P(zval_p)    Z_TYPE(*zval_p)</code><br>
This essentially dereferences the passed variable, passes the variable to <span class="bbcode-i">Z_TYPE</span>, then references the zval unionâ€™s <span class="bbcode-i">type</span> record.</p>
<p>Letâ€™s take a look at how each conversion is done in the switch statement. <span class="bbcode-i">Z_LVAL_P</span> accesses the zval unionâ€™s <span class="bbcode-i">lval</span> record (which holds a long), and simply sets its value of either true or false. Because Booleans are stored as longs, these long values become the variableâ€™s new value.</p>
<p>[ul][li]<span class="bbcode-b">Booleans</span> - Are left alone becauseâ€¦ Thatâ€™s the type that is being converted to.[/li]<br>
[li]<span class="bbcode-b">Nulls</span> - Are always converted to 0.[/li]<br>
[li]<span class="bbcode-b">Resources</span> - Are destroyed and then converted to a long.[/li]<br>
[li]<span class="bbcode-b">Longs</span> &amp; <span class="bbcode-b">Doubles</span> - Checks whether the numeric value results to true or false (ternary operation).[/li]<br>
[li]<span class="bbcode-b">Strings</span> - If the length of the first is 0 or the length is 1 and the character is a NUL, result to false. A regular string returns a 1. The original string is then freed/destroyed.[/li]<br>
[li]<span class="bbcode-b">Arrays</span> - If the length of the array is &gt; 1, true, otherwise it is false. The array is then destroyed.[/li]<br>
[li]<span class="bbcode-b">Objects</span> - This is a more complicated conversion. If the object isnâ€™t able to cast itself, an error is thrown indicated it couldnâ€™t convert the object. If it can, a series of functions are called and the object is then converted to a Boolean true. The object is then destroyed.[/li]<br>
[li]<span class="bbcode-b">Miscellanious</span> - Any other type that gets converted to a Boolean will return a 0.[/li][/ul]</p>
<p>Once the conversions are complete, the function sets its type record to <span class="bbcode-i">IS_BOOL</span>, which is a numeric constant for 3 (as seen above).</p>
<p>The <span class="bbcode-i">refcount__gc</span> and <span class="bbcode-i">is_ref__gc</span> are used for garbage collection, and they are just used to store a count of references to this variable.</p>
<p>Iâ€™m still exploring the Zend Engine, but Iâ€™ll try to answer any questions! <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='PHP &amp; The Zend Engine - PHP Types'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Ruby_Forums_Coder.html'><span itemprop='name'>Ruby_Forums_Coder</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2013-01-04T02:11:51Z'>
            <time itemprop='dateModified' datetime='2016-08-04T02:02:48Z' class='post-time'>
              August 4, 2016,  2:02am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I literally just read an article on the Zend engine the other day, Iâ€™ll eventually look into it. Busy IRL right now so I donâ€™t really have a lot of time to be going through it all, thanks for alerting the community though!</p>
      </div>

      <meta itemprop='headline' content='PHP &amp; The Zend Engine - PHP Types'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/justaguy.html'><span itemprop='name'>justaguy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2013-01-28T21:35:43Z'>
            <time itemprop='dateModified' datetime='2016-08-04T02:26:13Z' class='post-time'>
              August 4, 2016,  2:26am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="2" data-topic="477393">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/ruby/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Ruby:</div>
<blockquote>
<p>I literally just read an article on the Zend engine the other day, Iâ€™ll eventually look into it. Busy IRL right now so I donâ€™t really have a lot of time to be going through it all, thanks for alerting the community though!</p>
</blockquote>
</aside>
<p>Thanks for reading!</p>
<p>Updated the OP to include an example of how types are set in PHP.</p>
      </div>

      <meta itemprop='headline' content='PHP &amp; The Zend Engine - PHP Types'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/php-the-zend-engine-php-types/477393 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:42 GMT -->
</html>
