<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/convert-code-please-protect-java/382892 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 06:49:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Convert code please :) protect.java - Runescape - moparisthebest.com</title>
    <meta name="description" content="ok what im trying to do is protect against spammers who make accounts like &amp;quot;22r2345235452345&amp;quot; now i have a different source but its BULBY and it protects against these spammers. so i would either like to convert the BULB&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="382892.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Convert code please :) protect.java&#39;" href="382892.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/convert-code-please-protect-java/382892" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/convert-code-please-protect-java/382892" />
<meta property="og:title" content="Convert code please :) protect.java" />
<meta name="twitter:title" content="Convert code please :) protect.java" />
<meta property="og:description" content="ok what im trying to do is protect against spammers who make accounts like “22r2345235452345”  now i have a different source but its BULBY and it protects against these spammers. so i would either like to convert the BULBY code to CODEUSA. or if anyone know what to edit in my CODE USA to fix this that would be awesome.  my original code:  FloodDetect.java (CODEUSA)  package net.com.codeusa.net;  import java.io.*; import net.com.codeusa.Engine; import net.com.codeusa.Server; import net.com.codeus..." />
<meta name="twitter:description" content="ok what im trying to do is protect against spammers who make accounts like “22r2345235452345”  now i have a different source but its BULBY and it protects against these spammers. so i would either like to convert the BULBY code to CODEUSA. or if anyone know what to edit in my CODE USA to fix this that would be awesome.  my original code:  FloodDetect.java (CODEUSA)  package net.com.codeusa.net;  import java.io.*; import net.com.codeusa.Engine; import net.com.codeusa.Server; import net.com.codeus..." />
<meta property="article:published_time" content="2011-02-18T03:54:37+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="382892.html">Convert code please :) protect.java</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/b15.html'><span itemprop='name'>b15</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-02-18T03:54:37Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:38:42Z' class='post-time'>
              August 1, 2016,  7:38am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok what im trying to do is protect against spammers who make accounts like “22r2345235452345”<br>
now i have a different source but its BULBY and it protects against these spammers. so i would either like to convert the BULBY code to CODEUSA. or if anyone know what to edit in my CODE USA to fix this that would be awesome.</p>
<p>my original code:</p>
<p>FloodDetect.java (CODEUSA)</p>
<pre><code class="lang-auto">package net.com.codeusa.net;

import java.io.*;
import net.com.codeusa.Engine;
import net.com.codeusa.Server;
import net.com.codeusa.net.SocketListener;
import net.com.codeusa.model.Player;
import net.com.codeusa.util.Misc;

public class FloodDetect {
    static final int MAX_CONNECTIONS = 6,  SIZE_PATTERN = 7, MAX_PATTERN_COUNT = 6;

    public static void checkClient(Player p) {
        if (p != null) {
            checkHost(p);
            checkPattern(p);
        }
    }

    public static void checkHost(Player p) {
        if (p == null) {
            return;
        }
        String cHost = getHost(p);
        int cCount = 0;
        for (Player o : Engine.players) {
            if (o != null) {
                if (getHost(o).equals(cHost)) {
                    cCount++;
                }
            }
        }
        if (cCount &gt;= MAX_CONNECTIONS &amp;&amp; cHost.length() &gt; 0) {
            sendLog("Too much connections: " + cHost + " (" + cCount + " connections)");
            killByHost(cHost);
        }
    }

    public static void banHost(String host) {
        if (host.length() &gt; 0) {
            if (!isBannedHost(host)) {
                addBan(host, true);
            }
            killByHost(host);
        }
    }

    public static void banUser(Player p) {
        if (p != null) {
            if (p.username.length() &gt; 0) {
                if (!isBannedUser(p.username)) {
                    addBan(p.username, false);
                }
                p.disconnected[0] = true;
            }
        }
    }

    public static void killByHost(String host) {
        for (Player o : Engine.players) {
            if (o != null) {
                if (getHost(o).equals(host)) {
                    if (!isBannedUser(o.username)) {
                        banUser(o);
                    }
                    o.disconnected[0] = true;
                }
            }
        }
    }

    public static void checkPattern(Player p) {
        if (p == null) {
            return;
        }
        String pattern = p.username;
        for (Player o : Engine.players) {
            if (o != null) {
                String foundPattern = equString(pattern, o.username);
                if (foundPattern.length() &gt;= SIZE_PATTERN) {
                    pattern = foundPattern;
                }
            }
        }
        if (pattern.length() &gt;= SIZE_PATTERN) {
            if (pattern.length() &gt; SIZE_PATTERN) {
                pattern = pattern.substring(0, SIZE_PATTERN).toLowerCase();
            }
            if (countPattern(pattern) &gt;= MAX_PATTERN_COUNT) {
                sendLog("Banning pattern: " + pattern);
                for (Player o : Engine.players) {
                    if (o != null) {
                        if (o.username.toLowerCase().startsWith(pattern)) {
                            banHost(getHost(o));
                        }
                    }
                }
            }
        }
    }

    public static int countPattern(String pattern) {
        int pCount = 0;
        for (Player o : Engine.players) {
            if (o != null) {
                if (o.username.toLowerCase().startsWith(pattern.toLowerCase())) {
                    pCount++;
                }
            }
        }
        return pCount;
    }

    public static String equString(String a, String b) {
        String equ = "";
        for (int i = 0; i &lt; a.length(); i++) {
            if (b.length() &gt; i) {
                if (a.charAt(i) == b.charAt(i)) {
                    equ = equ + a.charAt(i);
                } else {
                    return equ;
                }
            } else {
                return equ;
            }
        }
        return equ;
    }

    public static String getHost(Player p) {
        if (p != null) {
            return p.socket.socket.getInetAddress().getHostAddress();
        } else {
            return "";
        }
    }

    public static void addBan(String banStr, boolean ipban) {
        BufferedWriter bw = null;
        String toFile;
        if (ipban) {
            toFile = "./data/banned/bannedhosts.dat";
            banHostClient(banStr);
            sendLog("Banned host: " + banStr);
        } else {
            toFile = "./data/banned/bannedusers.dat";
            banClient(banStr);
            sendLog("Banned user: " + banStr);
        }
        try {
            FileWriter fileWriter = new FileWriter(toFile, true);
            bw = new BufferedWriter(fileWriter);
            bw.write(banStr);
            bw.newLine();
            bw.flush();
            bw.close();
            fileWriter = null;
            bw = null;
        } catch (Exception exception) {
            Misc.println("Critical error while writing data: " + toFile);
        }
    }

    public static boolean isBannedHost(String host) {
        return Server.socketListener.checkBanned(host);
    }

    public static void banHostClient(String host) {
        for(int i = 0; i &lt; Server.socketListener.bannedHosts.length;i++) {
            if(Server.socketListener.bannedHosts[i] == null) {
                Server.socketListener.bannedHosts[i] = host;
                return;
            }
        }
    }

    public static void banClient(String username) {
        for (int i = 0; i &lt; Server.bannedUsers.length; i++) {
            if (Server.bannedUsers[i] == null) {
                Server.bannedUsers[i] = username;
            }
        }
    }

    public static boolean isBannedUser(String user) {
        if (user == null) {
            return false;
        }
        for (int i = 0; i &lt; Server.bannedUsers.length; i++) {
            if (Server.bannedUsers[i] != null &amp;&amp; user.equalsIgnoreCase(Server.bannedUsers[i])) {
                return true;
            }
        }
        return false;
    }

    public static void sendLog(String s) {
            System.out.println("[SERVER-PROTECT BY: Brandon] " + s);
        }
    }</code></pre>
<p>Protect.java (BULBY)</p>
<pre><code class="lang-auto">package Bulby.net;

import java.io.BufferedWriter;
import java.io.FileWriter;
import Bulby.Engine;
import Bulby.Server;
import Bulby.players.Player;
import Bulby.util.Misc;

/**
 * Server anti-flood protection.
 *
 * @author Gravediggah
 */
public class Protect {

    /**
     * Maximum amount of connections per host.
     */
    static final int MAX_CONNECTIONS = 6;
    /**
     * Minimum length of a pattern to be handled as a pattern.
     * For example 'SYIpker' has a length of 7 characters.
     */
    static final int SIZE_PATTERN = 7;
    /**
     * Maximum amount of players with the same username
     * pattern are allowed. Note: A pattern is seen as a
     * pattern when the length of a pattern is larger than
     * the length defined in SIZE_PATTERN;
     */
    static final int MAX_PATTERN_COUNT = 6;
    /**
     * If set to true, player's host will be checked.
     */
    static final boolean CHECK_HOST = true;
    /**
     * If set to true, player will be checked for patterns.
     */
    static final boolean CHECK_PATTERN = true;
    /**
     * If set to true, actions related to bans will be logged.
     */
    static final boolean LOG_BANS = true;

    /**
     * Performs all enabled checks.
     *
     * @param p The player to check.
     */
    public static void checkPlayer(Player p) {
        if (p != null) {
            if (CHECK_HOST) {
                checkHost(p);
            }

            if (CHECK_PATTERN) {
                checkPattern(p);
            }
        }

    }

    /**
     * Checks if the Player's host exceeds the maximum
     * amount of connections per host and, if exceeded,
     * IP-ban the player's host.
     *
     * @param p The player to check.
     */
    public static void checkHost(Player p) {
        if (p == null) {
            return;
        }

        String cHost = getHost(p);
        int cCount = 0;

        for (Player o : Engine.players) {
            if (o != null) {
                if (getHost(o).equals(cHost)) {
                    cCount++;
                }
            }
        }

        if (cCount &gt;= MAX_CONNECTIONS &amp;&amp; cHost.length() &gt; 0) {
            sendLog("Too much connections: " + cHost + " (" + cCount + " connections)");
            killByHost(cHost);
        }
    }

    /**
     * This method is used to process an ip-ban.
     * 
     * @param host The host to ban.
     */
    public static void banHost(String host) {
        if (host.length() &gt; 0) {
            if (!isBannedHost(host)) {
                addBan(host, true);
            }
            killByHost(host);
        }
    }

    /**
     * This method is used to process a single-user ban.
     *
     * @param p The player to ban.
     */
    public static void banUser(Player p) {
        if (p != null) {
            if (p.username.length() &gt; 0) {
                if (!isBannedUser(p.username)) {
                    addBan(p.username, false);
                }
                p.disconnected[0] = true;
            }
        }
    }

    /**
     * Disconnects all players with the given host.
     *
     * @param host The host to disconnect.
     */
    public static void killByHost(String host) {
        for (Player o : Engine.players) {
            if (o != null) {
                if (getHost(o).equals(host)) {
                    if (!isBannedUser(o.username)) {
                        banUser(o);
                    }
                    o.disconnected[0] = true;
                }
            }
        }
    }

    /**
     * Checks the Player's username for a pattern, compared
     * to all other Players' usernames. IP-ban all Players
     * with this pattern, if the pattern applies to the defined
     * restrictions: SIZE_PATTERN / MAX_PATTERN_COUNT.
     *
     * @param p The player to check.
     */
    public static void checkPattern(Player p) {
        if (p == null) {
            return;
        }

        String pattern = p.username;

        for (Player o : Engine.players) {
            if (o != null) {
                String foundPattern = equString(pattern, o.username);
                if (foundPattern.length() &gt;= SIZE_PATTERN) {
                    pattern = foundPattern;
                }
            }
        }

        if (pattern.length() &gt;= SIZE_PATTERN) {
            if (pattern.length() &gt; SIZE_PATTERN) {
                pattern = pattern.substring(0, SIZE_PATTERN).toLowerCase();
            }
            if (countPattern(pattern) &gt;= MAX_PATTERN_COUNT) {
                sendLog("Banning pattern: " + pattern);
                for (Player o : Engine.players) {
                    if (o != null) {
                        if (o.username.toLowerCase().startsWith(pattern)) {
                            //Ban all hosts with this pattern, possibility of proxies.
                            banHost(getHost(o));
                        }
                    }
                }
            }
        }
    }

    /**
     * This method is used to count the amount of players with
     * a username starting with the given pattern.
     *
     * @param pattern The pattern to count.
     * @return Amount of usernames, starting with the given pattern.
     */
    public static int countPattern(String pattern) {
        int pCount = 0;
        for (Player o : Engine.players) {
            if (o != null) {
                if (o.username.toLowerCase().startsWith(pattern.toLowerCase())) {
                    pCount++;
                }
            }
        }
        return pCount;
    }

    /**
     * Returns the pattern of two usernames.
     *
     * @param a The first username.
     * @param b The second username.
     * @return The pattern of two usernames.
     */
    public static String equString(String a, String b) {
        String equ = "";

        for (int i = 0; i &lt; a.length(); i++) {
            if (b.length() &gt; i) {
                if (a.charAt(i) == b.charAt(i)) {
                    equ = equ + a.charAt(i);
                } else {
                    return equ;
                }
            } else {
                return equ;
            }
        }
        return equ;
    }

    /**
     * Returns the host of a player.
     *
     * @param p The player to get the host of.
     * @return The host of the given player.
     */
    public static String getHost(Player p) {
        if (p != null) {
            return p.socket.socket.getInetAddress().getHostAddress();
        } else {
            return "";
        }
    }

    /**
     * This method is used to apply a ban. It saves the
     * host or username to the ban-file and loaded lists.
     *
     * @param banStr The value to ban: Host or Username.
     * @param ipban If true, IP-ban host. If false, ban username.
     */
    public static void addBan(String banStr, boolean ipban) {
        BufferedWriter bw = null;
        String toFile;
        if (ipban) {
            toFile = "./data/banned/bannedhosts.dat";
            Server.socketListener.banHost(banStr);
            sendLog("Banned host: " + banStr);
        } else {
            toFile = "./data/banned/bannedusers.dat";
            Server.banUser(banStr);
            sendLog("Banned user: " + banStr);
        }
        try {
            FileWriter fileWriter = new FileWriter(toFile, true);

            bw = new BufferedWriter(fileWriter);
            bw.write(banStr);
            bw.newLine();
            bw.flush();
            bw.close();
            fileWriter = null;
            bw = null;
        } catch (Exception exception) {
            Misc.println("Critical error while writing data: " + toFile);
        }
    }

    /**
     * Checks if the given host is in the bannedhosts array.
     *
     * @param host The host to check.
     * @return Host is banned.
     */
    public static boolean isBannedHost(String host) {
        return Server.socketListener.checkBanned(host);
    }

    /**
     * Checks if the given username is in the bannedusers array.
     *
     * @param host The username to check.
     * @return Username is banned.
     */
    public static boolean isBannedUser(String user) {
        if (user == null) {
            return false;
        }
        for (int i = 0; i &lt; Server.bannedUsers.length; i++) {
            if (Server.bannedUsers[i] != null &amp;&amp; user.equalsIgnoreCase(Server.bannedUsers[i])) {
                return true;
            }
        }
        return false;
    }

    /**
     * Logs actions if LOG_BANS is set to true.
     *
     * @param s The text to log.
     */
    public static void sendLog(String s) {
        if (LOG_BANS) {
            System.out.println("[SERVER-PROTECT] " + s);
        }
    }
}</code></pre>
<p>THANKS!</p>
      </div>

      <meta itemprop='headline' content='Convert code please :) protect.java'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/convert-code-please-protect-java/382892 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 06:49:27 GMT -->
</html>
