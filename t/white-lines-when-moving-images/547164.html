<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/white-lines-when-moving-images/547164 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:06:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>White lines when moving images - General Programming - moparisthebest.com</title>
    <meta name="description" content="Although this question is game-related, I thought it&amp;#39;d be more appropriate to post it in this section. 

In this 2D game I&amp;#39;m writing I use a tile-system. Dimensions: 50 x 50. I want to keep the player centered, therefore&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="547164.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;White lines when moving images&#39;" href="547164.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/white-lines-when-moving-images/547164" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/white-lines-when-moving-images/547164" />
<meta property="og:title" content="White lines when moving images" />
<meta name="twitter:title" content="White lines when moving images" />
<meta property="og:description" content="Although this question is game-related, I thought it’d be more appropriate to post it in this section.  In this 2D game I’m writing I use a tile-system. Dimensions: 50 x 50.  I want to keep the player centered, therefore the map must move.  To improve performance I’m not painting the off screen tiles. This by creating a CopyOnWriteArrayList ‘tilesToBeShown’ which is updated whenever the player moves and is passed to the paint method every game cycle.  Move method of the map (called every game cy..." />
<meta name="twitter:description" content="Although this question is game-related, I thought it’d be more appropriate to post it in this section.  In this 2D game I’m writing I use a tile-system. Dimensions: 50 x 50.  I want to keep the player centered, therefore the map must move.  To improve performance I’m not painting the off screen tiles. This by creating a CopyOnWriteArrayList ‘tilesToBeShown’ which is updated whenever the player moves and is passed to the paint method every game cycle.  Move method of the map (called every game cy..." />
<meta property="article:published_time" content="2014-10-08T09:58:43+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="547164.html">White lines when moving images</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Kattoor.html'><span itemprop='name'>Kattoor</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-10-08T09:58:43Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:51:54Z' class='post-time'>
              August 4, 2016,  1:51pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Although this question is game-related, I thought it’d be more appropriate to post it in this section.</p>
<p>In this 2D game I’m writing I use a tile-system. Dimensions: 50 x 50.<br>
I want to keep the player centered, therefore the map must move.<br>
To improve performance I’m not painting the off screen tiles. This by creating a CopyOnWriteArrayList ‘tilesToBeShown’ which is updated whenever the player moves and is passed to the paint method every game cycle.</p>
<p>Move method of the map (called every game cycle):</p>
<p><code>public void move() {
    if (isMoving[0])
        moveMap(Direction.RIGHT);
    if (isMoving[1])
        moveMap(Direction.DOWN);
    if (isMoving[2])
        moveMap(Direction.LEFT);
    if (isMoving[3])
        moveMap(Direction.UP);
    }</code></p>
<p><code>private void moveMap(Direction direction) {
    for (int i = 0; i &lt; tiles.length; i++) {
        switch (direction) {
            case LEFT: tiles[i].setX(tiles[i].getX() - 2); break;
            case UP: tiles[i].setY(tiles[i].getY() - 2); break;
            case RIGHT: tiles[i].setX(tiles[i].getX() + 2); break;
            case DOWN: tiles[i].setY(tiles[i].getY() + 2);
        }
    }
    initTilesToBeShown();
}</code></p>
<p>My game loop:</p>
<p><code>@Override
public void run() {
    long startTime;
    long stopTime = 0;
    while (true) {
        startTime = System.currentTimeMillis();
        long elapsedTime = stopTime - startTime;
        if (Math.abs(elapsedTime) &gt;= 10) {
            update();
            render();
            while (!paintIsDone) { }                
            stopTime = System.currentTimeMillis();
        }
    }
}</code></p>
<p>The problem:<br>
Whenever the player moves right or down, everything works fine.<br>
However, when the player moves up or left, there are randomly placed white lines between the tiles.<br>
Moving left -&gt; vertical white lines. Moving up -&gt; horizontal white lines.</p>
<p>I was thinking about this happening due to the paint method begin invoked while the map is being moved, but as you can see in my game loop I don’t put my update method on another thread or something else which could cause this.</p>
<p>Also, what I don’t understand:</p>
<p><code>update();
render();
//while (!paintIsDone) { }
stopTime = System.currentTimeMillis();
System.out.println(startTime - stopTime);</code><br>
The printed time difference here is 0ms whilst the printed time difference in the following scenario would be about 5ms.</p>
<p><code>update();
render();
while (!paintIsDone) { }
stopTime = System.currentTimeMillis();
System.out.println(startTime - stopTime);</code></p>
<p>Paint method:</p>
<p>[code]private boolean paintIsDone = false;<br>
<a class="mention" href="../../u/override.html">@Override</a><br>
public void paintComponent(Graphics g) {<br>
super.paintComponent(g);</p>
<pre><code>paintIsDone = false;

for (Tile tile : gameFrame.getController().getTilesToBeShown())
    g.drawImage(tile.getImage(), tile.getX(), tile.getY(), null);
g.drawImage(gameFrame.getController().getPlayerImage(), gameFrame.getController().getPlayerX(), gameFrame.getController().getPlayerY(), this);

paintIsDone = true;
</code></pre>
<p>}[/code]</p>
<p>Since this is being ran on the same thread, why does waiting for ‘paintIsDone’ take so much time? Shouldn’t it wait for the method to finish even though not in that loop?</p>
      </div>

      <meta itemprop='headline' content='White lines when moving images'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Protosstribe.html'><span itemprop='name'>Protosstribe</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-10-08T16:38:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:51:56Z' class='post-time'>
              August 4, 2016,  1:51pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Your first question:</p>
<p>Try changing “getX() - 2” and “getY() - 2” to “getX() - 1” and “getY() - 1”, respectively. It may be that one of them is inclusive, whereas the other is exclusive.</p>
<p>Your second question:</p>
<p>The method paintComponent(Graphics) is called from the AWT Event Dispatch Thread in normal circumstances. That means it may be that it is not running in the Thread that you expect it to. In that case you may have a race condition when it comes to the boolean field paintIsDone. It also means it may cache the result of it, such that one or both of your Threads don’t see any changes made to it from the other Thread, for some time. When they do see any change is pretty hard to tell, though. To remove that, simply add the keyword volatile to it. It makes it write directly to the actual field, not the cache.</p>
      </div>

      <meta itemprop='headline' content='White lines when moving images'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/wildskiller.html'><span itemprop='name'>wildskiller</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-10-09T03:31:15Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:52:00Z' class='post-time'>
              August 4, 2016,  1:52pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>To get maximum performance, create an image out of all tiles within each layer. You can do that by copying all RGB data from the tile images to one <a href="http://docs.oracle.com/javase/7/docs/api/java/awt/image/BufferedImage.html" data-bbcode="true" rel="nofollow noopener">BufferedImage</a>.</p>
<p>It could be something to avoid your issue and increase performance.</p>
      </div>

      <meta itemprop='headline' content='White lines when moving images'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Kattoor.html'><span itemprop='name'>Kattoor</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-10-09T07:19:00Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:52:01Z' class='post-time'>
              August 4, 2016,  1:52pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“object, post:2, topic:547164”]Your first question:</p>
<p>Try changing “getX() - 2” and “getY() - 2” to “getX() - 1” and “getY() - 1”, respectively. It may be that one of them is inclusive, whereas the other is exclusive.</p>
<p>Your second question:</p>
<p>The method paintComponent(Graphics) is called from the AWT Event Dispatch Thread in normal circumstances. That means it may be that it is not running in the Thread that you expect it to. In that case you may have a race condition when it comes to the boolean field paintIsDone. It also means it may cache the result of it, such that one or both of your Threads don’t see any changes made to it from the other Thread, for some time. When they do see any change is pretty hard to tell, though. To remove that, simply add the keyword volatile to it. It makes it write directly to the actual field, not the cache.[/quote]</p>
<p>Thanks, once again! I’m going to try this when I have the time!</p>
<p>I have however solved this issue already, in a manner which I don’t understand how it works.<br>
I move the    <span class="bbcode-i">while (!paintIsDone()) { }</span>    from the game loop in front of the    <span class="bbcode-i">update();</span>    method.</p>
<p>[quote=“wildskiller, post:3, topic:547164”]To get maximum performance, create an image out of all tiles within each layer. You can do that by copying all RGB data from the tile images to one <a href="http://docs.oracle.com/javase/7/docs/api/java/awt/image/BufferedImage.html" data-bbcode="true" rel="nofollow noopener">BufferedImage</a>.</p>
<p>It could be something to avoid your issue and increase performance.[/quote]<br>
Thanks for your reply! I’ve already tried painting everything to a BufferedImage first and then painting that BufferedImage on the frame. This didn’t solve the issue, which confused me even further…</p>
<p>Even though I only painted the whole BufferedImage, it still had this gaps by tiles moving…</p>
      </div>

      <meta itemprop='headline' content='White lines when moving images'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/white-lines-when-moving-images/547164 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:06:02 GMT -->
</html>
