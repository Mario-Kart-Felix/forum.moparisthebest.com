<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Multi-world pming</title>
    <link>https://forum.moparisthebest.com/t/multi-world-pming/539615</link>
    <description>Having a bit of trouble making my pm system multi-world. I&#39;ve got both worlds running, and I can see what players are on both worlds, so the multi-world is working but I am coming into trouble applying this to pming.

I thought now that I have a global list of players, I can apply this to the pm system, instead of using it for one server.

[code=java]
	public void setupPrivateMessaging() {
	setPrivateMessaging(2);

	boolean loaded = false;
	long playerName = Text.nameToLong(c.username);
	for (int i = 0; i &lt; c.friends.length; i++) {
		if (c.friends[i] == 0) {
			continue;
		}
		loaded = false;
		for (OnlinePlayer op : ServerStatus.getServerStatus().getOnlinePlayers()) { //loops the global server list
			Client p = (Client) op.getPlayer(); //gets the player object from the online player
			if (p == null || Text.nameToLong(p.username) != c.friends[i]) {
				continue;
			}
			if (p.privateChatMode == 0 || (p.privateChatMode == 1 &amp;&amp; p.getPA().playerIsFriend(playerName))) {
				sendFriend(c.friends[i], op.getWorld().getAbbreviation().equals(&quot;W1&quot;) ? 1 : 2); //world 1 or world 2
				loaded = true;
				break;
			}
		}

		if (!loaded) {
			sendFriend(c.friends[i], 0); //offline
		}
	}

	sendIgnores();

	for (OnlinePlayer op2 : ServerStatus.getServerStatus().getOnlinePlayers()) {
		Client p = (Client) op2.getPlayer();
		if (p != null &amp;&amp; p.getPA().playerIsFriend(Text.nameToLong(c.username))) {
			p.getPA().updatePM(c.playerId);
		}
	}
}
[/code]

[code=java]
	public void updatePM(int playerId) {
		System.out.println(ServerStatus.getServerStatus().getOnlinePlayers().size());
		for (OnlinePlayer op : ServerStatus.getServerStatus().getOnlinePlayers()) {
			long name = Text.nameToLong(op.getUsername());
			Client p = (Client)op.getPlayer();
			
			/**
			 * continue if not on fl
			 */
			for (int i = 0; i &lt; c.friends.length; i++) {
				if (c.friends[i] != name) {
					continue;
				}
			}	
			if (p.privateChatMode == 0) {
				for (int i = 0; i &lt; c.friends.length; i++) {
						if (name != c.friends[i]) continue;
							sendFriend(name, op.getWorld().getAbbreviation().equals(&quot;W1&quot;) ? 1 : 2);
					}
			} else if (p.privateChatMode == 1) {
				for (int i = 0; i &lt; c.friends.length; i++) {
					if (c.friends[i] != 0) {
						if (name == c.friends[i]) {
							if (p.getPA().playerIsFriend(Text.nameToLong(c.username))) {
								sendFriend(name, op.getWorld().getAbbreviation().equals(&quot;W1&quot;) ? 1 : 2);
								return;
							} else {
								sendFriend(name, 2);
								return;
							}
						}
					}
				}
			} else if (p.privateChatMode == 2) {
				for (int i = 0; i &lt; c.friends.length; i++) {
					if (c.friends[i] != 0) {
						if (name == c.friends[i]) {
							sendFriend(name, 0);
							return;
						}
					}
				}
			}
		}
	}
[/code]

[code=java]
[03/02/2014 02:05 PM]: java.lang.NullPointerException
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerAssistant.updatePM(PlayerAssistant.java:2351)
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerAssistant.setupPrivateMessaging(PlayerAssistant.java:2250)
[03/02/2014 02:05 PM]: 	at server.model.players.Client.initialize(Client.java:422)
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerHandler.process(PlayerHandler.java:133)
[/code]

[code=java]
2351 = if (p.privateChatMode == 0) {
2250 = p.getPA().updatePM(c.playerId);
422 = getPA().setupPrivateMessaging();
[/code]

When my second char logs into the the second world, there is a null pointer thrown and I&#39;m pretty sure it&#39;s the player object. Maybe the logic here is totally wrong so if someone could guide me in the right direction it would be appreciated.

The player object is given a value when the player logs in:
[code=java]
OnlinePlayer op = new OnlinePlayer((Player)this, Server.getWorld());
[/code]</description>
    
    <lastBuildDate>Tue, 04 Feb 2014 16:24:14 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@pure2ownage Pure_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pure2ownage">@pure2ownage</a> wrote:</p>
          <blockquote>
              <p>[quote=“ohokay, post:14, topic:539615”][quote author=Pure_ link=topic=658456.msg4404576#msg4404576 date=1391518051]<br>
Create a separate server to handle server-wide interactions, ie GE, PMing etc. It should be easier to synchronise these events and thus avoid any nullpointers etc, update the player list each time somebody logs in or out.<br>
[/quote]</p>
<p>I already have one but wouldn’t it still causes errors because I still need to pass the player object. I’m not able to get them if the players are on separate worlds[/quote]When connecting and sending a message to the server, you will send a packet, ie packet 01 for logged in: 01, PLAYER_NAME. This will be handled in the player’s login method so it should not throw a null pointer exception. Same concept for logging out, ie packet 02: 02, PLAYER_NAME. Have the server register these player names in perhaps a list of sorts? You can even store their privacy settings in there and their world.</p>
<p>Then when a message is sent you send the player’s name as long (afaik that’s all you need to send private message packet, minus some other stuff of course) and their message. ie, packet 03: 03, PLAYER_NAME_LONG, MSG. There are no player objects on the server so again that cannot throw a null pointer exception.</p>
<p>With this in place I think you can just get rid of your online player object.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/15</link>
        <pubDate>Tue, 04 Feb 2014 16:24:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-15</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="13" data-topic="539615">
<div class="title">
<div class="quote-controls"></div>
 Pure_:</div>
<blockquote>
<p>Create a separate server to handle server-wide interactions, ie GE, PMing etc. It should be easier to synchronise these events and thus avoid any nullpointers etc, update the player list each time somebody logs in or out.</p>
</blockquote>
</aside>
<p>I already have one but wouldn’t it still causes errors because I still need to pass the player object. I’m not able to get them if the players are on separate worlds</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/14</link>
        <pubDate>Tue, 04 Feb 2014 16:14:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-14</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@pure2ownage Pure_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pure2ownage">@pure2ownage</a> wrote:</p>
          <blockquote>
              <p>Create a separate server to handle server-wide interactions, ie GE, PMing etc. It should be easier to synchronise these events and thus avoid any nullpointers etc, update the player list each time somebody logs in or out.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/13</link>
        <pubDate>Tue, 04 Feb 2014 12:47:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-13</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <p>yeah you should really explain your suggestions then. or are you avoiding that so that people never know when your advice is wrong?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/12</link>
        <pubDate>Tue, 04 Feb 2014 09:09:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-12</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="9" data-topic="539615">
<div class="title">
<div class="quote-controls"></div>
 xx matty xx:</div>
<blockquote>
<p>If the class was wrong he’d get a class cast exception. The instance wouldn’t just turn into null.</p>
</blockquote>
</aside>
<p>that’s not what I’m trying to say</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/11</link>
        <pubDate>Mon, 03 Feb 2014 22:40:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-11</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <p>I’ve figured out the problem<br>
<img src="https://dl.dropbox.com/s/83d4bnlo4yuq5lx/Screenshot%202014-02-03%2022.02.42.png" alt width="" height=""></p>
<p>I think it’s searching the one world, for the player on the second world. This is where the nullpointer is coming in. Would I have to modify how it searches for the players? I’m not sure about how to go on this.</p>
<p>This is when both players are on the same world:<br>
<img src="https://dl.dropbox.com/s/635s6bq7574kbcx/Screenshot%202014-02-03%2022.04.50.png" alt width="" height=""></p>
<p>The OnlinePlayer objects are being created correctly, with their player objects, but I’m not able to get them if they’re on separate worlds.</p>
<p>I don’t see why it’s returning null, as a new OnlinePlayer object is created each time a player logs in, and it passes their player object.</p>
<p>Thanks for all the feedback so far.</p>
<p>[quote=“AtomicInt_, post:5, topic:539615”][quote author=ohokay link=topic=658456.msg4404318#msg4404318 date=1391442008]</p>
<aside class="quote">
<blockquote>
<pre><code class="lang-auto">Client p = (Client)op.getPlayer();</code></pre>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.</p>
</blockquote>
</aside>
<p>Yeah that’s what I was thinking but not sure why.</p>
<pre><code class="lang-auto">	public Player getPlayer() {
		return p;
	}</code></pre>
<p>It just returns the player object, and it’s set when a player logs in</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer( (Player)this, Server.getWorld() );</code></pre>
<pre><code class="lang-auto">	public OnlinePlayer(Player p, World world) {
		this.world = world;
		this.p = p;
	}</code></pre>
<p>[/quote]</p>
<p>change the player object to a client object[/quote]</p>
<p>I did now thanks. But I think the main problem is because of the above ^</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/10</link>
        <pubDate>Mon, 03 Feb 2014 22:09:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-10</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <p>If the class was wrong he’d get a class cast exception. The instance wouldn’t just turn into null.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/9</link>
        <pubDate>Mon, 03 Feb 2014 20:44:46 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-9</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>[quote=“xx matty xx, post:7, topic:539615”]Looking at this again I’m now absolutely certain op.getPlayer() is returning null. Make sure that really is the only place OnlinePlayer is getting instantiated and make sure there’s no way it can be passed null. Also make sure Player isn’t getting instantiated through the constructor of another inheriting class… It has to be returning null somehow!!</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<pre><code class="lang-auto">Client p = (Client)op.getPlayer();</code></pre>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.</p>
</blockquote>
</aside>
<p>Yeah that’s what I was thinking but not sure why.</p>
<pre><code class="lang-auto">	public Player getPlayer() {
		return p;
	}</code></pre>
<p>It just returns the player object, and it’s set when a player logs in</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer( (Player)this, Server.getWorld() );</code></pre>
<pre><code class="lang-auto">	public OnlinePlayer(Player p, World world) {
		this.world = world;
		this.p = p;
	}</code></pre>
</blockquote>
</aside>
<p>change the player object to a client object</p>
</blockquote>
</aside>
<p>This isn’t really very clear. Are you telling him to rename the class? Change the cast? <span class="bbcode-b">Change the constructor parameters/fields?</span>[/quote]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/8</link>
        <pubDate>Mon, 03 Feb 2014 20:32:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-8</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <p>Looking at this again I’m now absolutely certain op.getPlayer() is returning null. Make sure that really is the only place OnlinePlayer is getting instantiated and make sure there’s no way it can be passed null. Also make sure Player isn’t getting instantiated through the constructor of another inheriting class… It has to be returning null somehow!!</p>
<p>[quote=“AtomicInt_, post:5, topic:539615”][quote author=ohokay link=topic=658456.msg4404318#msg4404318 date=1391442008]</p>
<aside class="quote">
<blockquote>
<pre><code class="lang-auto">Client p = (Client)op.getPlayer();</code></pre>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.</p>
</blockquote>
</aside>
<p>Yeah that’s what I was thinking but not sure why.</p>
<pre><code class="lang-auto">	public Player getPlayer() {
		return p;
	}</code></pre>
<p>It just returns the player object, and it’s set when a player logs in</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer( (Player)this, Server.getWorld() );</code></pre>
<pre><code class="lang-auto">	public OnlinePlayer(Player p, World world) {
		this.world = world;
		this.p = p;
	}</code></pre>
<p>[/quote]</p>
<p>change the player object to a client object[/quote]<br>
This isn’t really very clear. Are you telling him to rename the class? Change the cast? Change the constructor parameters/fields?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/7</link>
        <pubDate>Mon, 03 Feb 2014 20:01:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-7</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <p>Make sure you’re actually initializing the messaging system like you did with Player</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/6</link>
        <pubDate>Mon, 03 Feb 2014 17:47:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-6</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>[quote=“ohokay, post:3, topic:539615”][quote author=xx matty xx link=topic=658456.msg4404315#msg4404315 date=1391439146]</p>
<pre><code class="lang-auto">Client p = (Client)op.getPlayer();</code></pre>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.<br>
[/quote]</p>
<p>Yeah that’s what I was thinking but not sure why.</p>
<pre><code class="lang-auto">	public Player getPlayer() {
		return p;
	}</code></pre>
<p>It just returns the player object, and it’s set when a player logs in</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer( (Player)this, Server.getWorld() );</code></pre>
<p><code>
	public OnlinePlayer(Player p, World world) {
		this.world = world;
		this.p = p;
	}
</code>[/quote]</p>
<p>change the player object to a client object</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/5</link>
        <pubDate>Mon, 03 Feb 2014 16:39:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-5</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <p>This hierarchy doesn’t make sense to me… so you have an instance of OnlinePlayer, and you call getPlayer() on it to get an instance of Player. Then you cast Player to Client?! None of these names make any sense!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/4</link>
        <pubDate>Mon, 03 Feb 2014 16:35:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-4</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <p>[quote=“xx matty xx, post:2, topic:539615”]<code>
Client p = (Client)op.getPlayer();
</code></p>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.[/quote]</p>
<p>Yeah that’s what I was thinking but not sure why.</p>
<pre><code class="lang-auto">	public Player getPlayer() {
		return p;
	}</code></pre>
<p>It just returns the player object, and it’s set when a player logs in</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer( (Player)this, Server.getWorld() );</code></pre>
<pre><code class="lang-auto">	public OnlinePlayer(Player p, World world) {
		this.world = world;
		this.p = p;
	}</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/3</link>
        <pubDate>Mon, 03 Feb 2014 15:40:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-3</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <pre><code class="lang-auto">Client p = (Client)op.getPlayer();</code></pre>
<p>The getPlayer method called inside updatePM must be returning null. Does that shed any light? If not, post the OnlinePlayer.getPlayer() method.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/2</link>
        <pubDate>Mon, 03 Feb 2014 14:52:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-2</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
      <item>
        <title>Multi-world pming</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <p>Having a bit of trouble making my pm system multi-world. I’ve got both worlds running, and I can see what players are on both worlds, so the multi-world is working but I am coming into trouble applying this to pming.</p>
<p>I thought now that I have a global list of players, I can apply this to the pm system, instead of using it for one server.</p>
<pre><code class="lang-auto">	public void setupPrivateMessaging() {
	setPrivateMessaging(2);

	boolean loaded = false;
	long playerName = Text.nameToLong(c.username);
	for (int i = 0; i &lt; c.friends.length; i++) {
		if (c.friends[i] == 0) {
			continue;
		}
		loaded = false;
		for (OnlinePlayer op : ServerStatus.getServerStatus().getOnlinePlayers()) { //loops the global server list
			Client p = (Client) op.getPlayer(); //gets the player object from the online player
			if (p == null || Text.nameToLong(p.username) != c.friends[i]) {
				continue;
			}
			if (p.privateChatMode == 0 || (p.privateChatMode == 1 &amp;&amp; p.getPA().playerIsFriend(playerName))) {
				sendFriend(c.friends[i], op.getWorld().getAbbreviation().equals("W1") ? 1 : 2); //world 1 or world 2
				loaded = true;
				break;
			}
		}

		if (!loaded) {
			sendFriend(c.friends[i], 0); //offline
		}
	}

	sendIgnores();

	for (OnlinePlayer op2 : ServerStatus.getServerStatus().getOnlinePlayers()) {
		Client p = (Client) op2.getPlayer();
		if (p != null &amp;&amp; p.getPA().playerIsFriend(Text.nameToLong(c.username))) {
			p.getPA().updatePM(c.playerId);
		}
	}
}</code></pre>
<pre><code class="lang-auto">	public void updatePM(int playerId) {
		System.out.println(ServerStatus.getServerStatus().getOnlinePlayers().size());
		for (OnlinePlayer op : ServerStatus.getServerStatus().getOnlinePlayers()) {
			long name = Text.nameToLong(op.getUsername());
			Client p = (Client)op.getPlayer();
			
			/**
			 * continue if not on fl
			 */
			for (int i = 0; i &lt; c.friends.length; i++) {
				if (c.friends[i] != name) {
					continue;
				}
			}	
			if (p.privateChatMode == 0) {
				for (int i = 0; i &lt; c.friends.length; i++) {
						if (name != c.friends[i]) continue;
							sendFriend(name, op.getWorld().getAbbreviation().equals("W1") ? 1 : 2);
					}
			} else if (p.privateChatMode == 1) {
				for (int i = 0; i &lt; c.friends.length; i++) {
					if (c.friends[i] != 0) {
						if (name == c.friends[i]) {
							if (p.getPA().playerIsFriend(Text.nameToLong(c.username))) {
								sendFriend(name, op.getWorld().getAbbreviation().equals("W1") ? 1 : 2);
								return;
							} else {
								sendFriend(name, 2);
								return;
							}
						}
					}
				}
			} else if (p.privateChatMode == 2) {
				for (int i = 0; i &lt; c.friends.length; i++) {
					if (c.friends[i] != 0) {
						if (name == c.friends[i]) {
							sendFriend(name, 0);
							return;
						}
					}
				}
			}
		}
	}</code></pre>
<pre><code class="lang-auto">[03/02/2014 02:05 PM]: java.lang.NullPointerException
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerAssistant.updatePM(PlayerAssistant.java:2351)
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerAssistant.setupPrivateMessaging(PlayerAssistant.java:2250)
[03/02/2014 02:05 PM]: 	at server.model.players.Client.initialize(Client.java:422)
[03/02/2014 02:05 PM]: 	at server.model.players.PlayerHandler.process(PlayerHandler.java:133)</code></pre>
<pre><code class="lang-auto">2351 = if (p.privateChatMode == 0) {
2250 = p.getPA().updatePM(c.playerId);
422 = getPA().setupPrivateMessaging();</code></pre>
<p>When my second char logs into the the second world, there is a null pointer thrown and I’m pretty sure it’s the player object. Maybe the logic here is totally wrong so if someone could guide me in the right direction it would be appreciated.</p>
<p>The player object is given a value when the player logs in:</p>
<pre><code class="lang-auto">OnlinePlayer op = new OnlinePlayer((Player)this, Server.getWorld());</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/multi-world-pming/539615/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/multi-world-pming/539615/1</link>
        <pubDate>Mon, 03 Feb 2014 14:15:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-539615-1</guid>
        <source url="https://forum.moparisthebest.com/t/multi-world-pming/539615.rss">Multi-world pming</source>
      </item>
  </channel>
</rss>
