<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/construct-map-packet-changing-object-position-on-rotation/555677 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Construct map packet changing object position on rotation - Runescape - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m honestly stumped as to what&amp;#39;s causing this because the server isn&amp;#39;t placing the objects. It&amp;#39;s simply setting the rotation value of the room and re-sending the tiles. 

[image] 

I was having a similar issue with my s&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="555677.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Construct map packet changing object position on rotation&#39;" href="555677.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://i.imgur.com/9RXqOyY.gif" />
<meta property="og:image" content="http://i.imgur.com/9RXqOyY.gif" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/construct-map-packet-changing-object-position-on-rotation/555677" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/construct-map-packet-changing-object-position-on-rotation/555677" />
<meta property="og:title" content="Construct map packet changing object position on rotation" />
<meta name="twitter:title" content="Construct map packet changing object position on rotation" />
<meta property="og:description" content="I’m honestly stumped as to what’s causing this because the server isn’t placing the objects. It’s simply setting the rotation value of the room and re-sending the tiles.    I was having a similar issue with my sink space, but that was a result from my placement code being wrong. You could tell because there was two copies of the object instead of just one.   		PlayerRoom room = getRoom(pl, house); 		if (rotateLeft) { 			room.getRoomTile() 					.setRotation(room.getRoomTile().getRotation() &lt; 1 ? ..." />
<meta name="twitter:description" content="I’m honestly stumped as to what’s causing this because the server isn’t placing the objects. It’s simply setting the rotation value of the room and re-sending the tiles.    I was having a similar issue with my sink space, but that was a result from my placement code being wrong. You could tell because there was two copies of the object instead of just one.   		PlayerRoom room = getRoom(pl, house); 		if (rotateLeft) { 			room.getRoomTile() 					.setRotation(room.getRoomTile().getRotation() &lt; 1 ? ..." />
<meta property="article:published_time" content="2016-06-23T23:43:41+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="555677.html">Construct map packet changing object position on rotation</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sk8rdude461.html'><span itemprop='name'>sk8rdude461</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-06-23T23:43:41Z'>
            <time itemprop='dateModified' datetime='2016-08-04T18:32:47Z' class='post-time'>
              August 4, 2016,  6:32pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m honestly stumped as to what’s causing this because the server isn’t placing the objects. It’s simply setting the rotation value of the room and re-sending the tiles.</p>
<p><img src="http://i.imgur.com/9RXqOyY.gif" alt width="516" height="334"></p>
<p>I was having a similar issue with my sink space, but that was a result from my placement code being wrong. You could tell because there was two copies of the object instead of just one.</p>
<p><code>
		PlayerRoom room = getRoom(pl, house);
		if (rotateLeft) {
			room.getRoomTile()
					.setRotation(room.getRoomTile().getRotation() &lt; 1 ? 3 : (room.getRoomTile().getRotation() - 1));
		} else {
			room.getRoomTile()
					.setRotation(room.getRoomTile().getRotation() &gt; 2 ? 0 : (room.getRoomTile().getRotation() + 1));
		}
		pl.getPacketSender().constructMapRegion(pl.getPlayerPalette());</code></p>
<p>PlayerRoom basically consists of:</p>
<p><code>
	private PaletteTile roomTile;
	private GameObject[] roomObjects;
	private int xIndex;
	private int yIndex;
	private int zIndex;</code></p>
<p>Palette (not my class):</p>
<p>[code=java]package server.world;</p>
<p>/**</p>
<ul>
<li>
<p>Manages a palette of map regions for use in the constructed map region</p>
</li>
<li>
<p>packet.</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@author</span> Graham<br>
*/<br>
public class Palette {</p>
<p>/**</p>
<ul>
<li>Normal direction.<br>
*/<br>
public static final int DIRECTION_NORMAL = 0;</li>
</ul>
<p>/**</p>
<ul>
<li>Rotation direction clockwise by 0 degrees.<br>
*/<br>
public static final int DIRECTION_CW_0 = 0;</li>
</ul>
<p>/**</p>
<ul>
<li>Rotation direction clockwise by 90 degrees.<br>
*/<br>
public static final int DIRECTION_CW_90 = 1;</li>
</ul>
<p>/**</p>
<ul>
<li>Rotation direction clockwise by 180 degrees.<br>
*/<br>
public static final int DIRECTION_CW_180 = 2;</li>
</ul>
<p>/**</p>
<ul>
<li>Rotation direction clockwise by 270 degrees.<br>
*/<br>
public static final int DIRECTION_CW_270 = 3;</li>
</ul>
<p>/**</p>
<ul>
<li>Represents a tile to copy in the palette.</li>
<li>
</li>
<li>
<span class="mention">@author</span> Graham Edgecombe</li>
<li>
</li>
</ul>
<p>*/<br>
public static class PaletteTile {</p>
<pre><code> /**
  * X coordinate.
  */
 private int x;

 /**
  * Y coordinate.
  */
 private int y;

 /**
  * Z coordinate.
  */
 private int z;

 /**
  * Rotation.
  */
 private int rot;

 public PaletteTile() {
 	this(0, 0, 0);
 }

 /**
  * Creates a tile.
  * 
  * @param x
  *            The x coordinate.
  * @param y
  *            The y coordinate.
  */
 public PaletteTile(int x, int y) {
 	this(x, y, 0);
 }

 /**
  * Creates a tile.
  * 
  * @param x
  *            The x coordinate.
  * @param y
  *            The y coordinate.
  * @param z
  *            The z coordinate.
  */
 public PaletteTile(int x, int y, int z) {
 	this(x, y, z, DIRECTION_NORMAL);
 }

 /**
  * Creates a tile.
  * 
  * @param x
  *            The x coordinate.
  * @param y
  *            The y coordinate.
  * @param z
  *            The z coordinate.
  * @param rot
  *            The rotation.
  */
 public PaletteTile(int x, int y, int z, int rot) {
 	this.x = x;
 	this.y = y;
 	this.z = z;
 	this.rot = rot;
 }

 /**
  * Gets the x coordinate.
  * 
  * @return The x coordinate divided by 8.
  */
 public int getX() {
 	return x / 8;
 }

 /**
  * Gets the x coordinate.
  * 
  * @return The x coordinate.
  */
 public int getBaseX() {
 	return x;
 }

 /**
  * Gets the y coordinate.
  * 
  * @return The y coordinate divided by 8.
  */
 public int getY() {
 	return y / 8;
 }

 /**
  * Gets the y coordinate.
  * 
  * @return The y coordinate.
  */
 public int getBaseY() {
 	return y;
 }

 /**
  * Gets the z coordinate.
  * 
  * @return The z coordinate divided by 4.
  */
 public int getZ() {
 	return z % 4;
 }

 /**
  * Gets the z coordinate.
  * 
  * @return The z coordinate.
  */
 public int getBaseZ() {
 	return x;
 }

 /**
  * Gets the rotation.
  * 
  * @return The rotation.
  */
 public int getRotation() {
 	return rot % 4;
 }

 public void setRotation(int rot) {
 	this.rot = rot;
 }

 public void setZ(int z) {
 	this.z = z;
 }
</code></pre>
<p>}</p>
<p>/**</p>
<ul>
<li>The array of tiles.<br>
*/<br>
private PaletteTile[][][] tiles = new PaletteTile[14][14][4];</li>
</ul>
<p>/**</p>
<ul>
<li>Gets a tile.</li>
<li>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> x</li>
<li>
<pre><code>       X position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> y</li>
<li>
<pre><code>       Y position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> z</li>
<li>
<pre><code>       Z position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/return.html">@return</a> The tile.<br>
*/<br>
public PaletteTile getTile(int x, int y, int z) {<br>
return tiles[x][y][z % 4];<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Sets a tile.</li>
<li>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> x</li>
<li>
<pre><code>       X position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> y</li>
<li>
<pre><code>       Y position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> z</li>
<li>
<pre><code>       Z position.
</code></pre>
</li>
<li>
<a class="mention" href="../../u/param.html">@param</a> tile</li>
<li>
<pre><code>       The tile.
</code></pre>
</li>
</ul>
<p>*/<br>
public void setTile(int x, int y, int z, PaletteTile tile) {<br>
tiles[x][y][z % 4] = tile;<br>
}<br>
}[/code]</p>
</li>
</ul>
<p>This seems to occur on all fire-place like objects. However, other objects with similar sizes (the sink is the same size) don’t do it.</p>
<p>If it’s any help, this is the code I use to get the object’s offset when the room is rotated:</p>
<p><code>	private static int getObjectOffset(GameObject o, PlayerRoom r, boolean isX) {
		if (o == null || r == null) {
			return 1;
		}
		ObjectDefinition obj = ObjectDefinition.getDefinition(o);
		int newX = o.getObjectX();
		int newY = o.getObjectY();
		int length = obj == null ? 1 : obj.getSizeX();
		int width = obj == null ? 1 : obj.getSizeY();
		switch (r.getRoomTile().getRotation()) {
		case Palette.DIRECTION_CW_270:
			newX = 8 - o.getObjectY() - width;
			newY = o.getObjectX();
			break;
		case Palette.DIRECTION_CW_180:
			newX = 8 - o.getObjectX() - length;
			newY = 8 - o.getObjectY() - width;
			break;
		case Palette.DIRECTION_CW_90:
			newX = o.getObjectY();
			newY = 8 - o.getObjectX() - length;
			break;
		case Palette.DIRECTION_CW_0:
			break;
		}
		if (o.getObjectId() == 15398) {
			System.out.println("L: " + length + " w: " + width + "new x: " + newX + " new y " + newY);
		}
		return isX ? newX : newY;
	}</code><br>
(Not the best but it works)</p>
<p>Edit: I have verified it is <span class="bbcode-b">not the object offset code</span><br>
How? Easy. I disabled it and the issue still showed up.</p>
<p>I compared my construct map packet to a couple different servers - and it appears it’s the same.<br>
One server had a value set to 5 where I had it set to 1, but changing that didn’t appear to change anything.</p>
      </div>

      <meta itemprop='headline' content='Construct map packet changing object position on rotation'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/my-swagger.html'><span itemprop='name'>my-swagger</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-06-24T19:43:15Z'>
            <time itemprop='dateModified' datetime='2016-08-04T18:32:50Z' class='post-time'>
              August 4, 2016,  6:32pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Can you do some checking if the server still thinks the object is there or if it has been moved? If the server thinks the object has not been moved then it’s a client issue.</p>
      </div>

      <meta itemprop='headline' content='Construct map packet changing object position on rotation'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/davidi2.html'><span itemprop='name'>davidi2</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-06-24T20:21:33Z'>
            <time itemprop='dateModified' datetime='2016-08-04T18:32:50Z' class='post-time'>
              August 4, 2016,  6:32pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Object offset code looks familiar <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
      </div>

      <meta itemprop='headline' content='Construct map packet changing object position on rotation'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sk8rdude461.html'><span itemprop='name'>sk8rdude461</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-06-24T20:59:14Z'>
            <time itemprop='dateModified' datetime='2016-08-04T18:32:50Z' class='post-time'>
              August 4, 2016,  6:32pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="2" data-topic="555677">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/my-swagger/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> my-swagger:</div>
<blockquote>
<p>Can you do some checking if the server still thinks the object is there or if it has been moved? If the server thinks the object has not been moved then it’s a client issue.</p>
</blockquote>
</aside>
<p>Yeah the server is having a hard time finding the objects when they’re in the wrong spots.</p>
<aside class="quote" data-post="3" data-topic="555677">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/davidi2/40/2579_1.png" class="avatar"> Davidi2:</div>
<blockquote>
<p>Object offset code looks familiar <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
</blockquote>
</aside>
<p>Wonder why <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
      </div>

      <meta itemprop='headline' content='Construct map packet changing object position on rotation'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/construct-map-packet-changing-object-position-on-rotation/555677 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:05 GMT -->
</html>
