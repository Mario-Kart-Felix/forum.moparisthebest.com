<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/the-runescape-region-system/317793?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 01:44:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>The runescape region system - Runescape - moparisthebest.com</title>
    <meta name="description" content="a ton of people act like they know it, etc, but they don&amp;#39;t. so, how does it work? how big are different regions? what about &amp;#39;bases&amp;#39;? how does it all work? feel free collaborate all information regarding it in this thread&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="3177934658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;The runescape region system&#39;" href="317793.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/the-runescape-region-system/317793?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/the-runescape-region-system/317793?page=2" />
<meta property="og:title" content="The runescape region system" />
<meta name="twitter:title" content="The runescape region system" />
<meta property="og:description" content="[quote=“Killer-99-pkz, post:20, topic:317793”][quote author=c|p link=topic=414306.msg3051422#msg3051422 date=1260117487]   Something like that.  Also, I think it’s important to mention:          x = smallX[0] * 128 + boundingCube * 64;         y = smallY[0] * 128 + boundingCube * 64;  [code]    private void renderPlayers(boolean first)  {  if(myPlayer.x &gt;&gt; 7 == destX &amp;&amp; myPlayer.y &gt;&gt; 7 == destY)  destX = 0;  int player_count = playerCount;  if(first)  player_count = 1;  for(int l = 0; l &lt; player..." />
<meta name="twitter:description" content="[quote=“Killer-99-pkz, post:20, topic:317793”][quote author=c|p link=topic=414306.msg3051422#msg3051422 date=1260117487]   Something like that.  Also, I think it’s important to mention:          x = smallX[0] * 128 + boundingCube * 64;         y = smallY[0] * 128 + boundingCube * 64;  [code]    private void renderPlayers(boolean first)  {  if(myPlayer.x &gt;&gt; 7 == destX &amp;&amp; myPlayer.y &gt;&gt; 7 == destY)  destX = 0;  int player_count = playerCount;  if(first)  player_count = 1;  for(int l = 0; l &lt; player..." />
<meta property="article:published_time" content="2009-12-30T14:05:49+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="317793.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="317793.html">The runescape region system</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/the_bank.html'><span itemprop='name'>the_bank</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-12-30T14:05:49Z'>
            <time itemprop='dateModified' datetime='2016-07-31T13:37:45Z' class='post-time'>
              July 31, 2016,  1:37pm
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Killer-99-pkz, post:20, topic:317793”][quote author=c|p link=topic=414306.msg3051422#msg3051422 date=1260117487]</p>
<aside class="quote no-group">
<blockquote>
<p>so ‘model_bound_radius’ is in fact just a model bounding ‘cube’ width/height ?</p>
</blockquote>
</aside>
<p>Something like that.</p>
<p>Also, I think it’s important to mention:</p>
<p><code>        x = smallX[0] * 128 + boundingCube * 64;
        y = smallY[0] * 128 + boundingCube * 64;</code></p>
<p>[code]    private void renderPlayers(boolean first)<br>
{<br>
if(myPlayer.x &gt;&gt; 7 == destX &amp;&amp; myPlayer.y &gt;&gt; 7 == destY)<br>
destX = 0;<br>
int player_count = playerCount;<br>
if(first)<br>
player_count = 1;<br>
for(int l = 0; l &lt; player_count; l++)<br>
{<br>
Player player;<br>
int i1;<br>
if(first)<br>
{<br>
player = myPlayer;<br>
i1 = myPlayerIndex &lt;&lt; 14;<br>
} else<br>
{<br>
player = playerArray[playerIndices[l]];<br>
i1 = playerIndices[l] &lt;&lt; 14;<br>
}<br>
if(player == null || !player.isVisible())<br>
continue;<br>
player.aBoolean1699 = (lowMem &amp;&amp; playerCount &gt; 50 || playerCount &gt; 200) &amp;&amp; !first &amp;&amp; player.anInt1517 == player.anInt1511;<br>
int tile_x = player.x &gt;&gt; 7;<br>
int tile_y = player.y &gt;&gt; 7;<br>
if(tile_x &lt; 0 || tile_x &gt;= 104 || tile_y &lt; 0 || tile_y &gt;= 104)<br>
continue;</p>
<pre><code>        // what is this?
        if(player.aModel_1714 != null &amp;&amp; loopCycle &gt;= player.anInt1707 &amp;&amp; loopCycle &lt; player.anInt1708)
        {
            player.aBoolean1699 = false;
            player.renderHeight = getEntityTerrainHeightOffset(plane, player.y, player.x);
            worldController.method286(plane, player.y, player, player.orientation, player.anInt1722, player.x, player.renderHeight, player.anInt1719, player.anInt1721, i1, player.anInt1720);
            continue;
        }

        if((player.x &amp; 0x7f) == 64 &amp;&amp; (player.y &amp; 0x7f) == 64)
        {
            if(anIntArrayArray929[tile_x][tile_y] == anInt1265)
                continue;
            anIntArrayArray929[tile_x][tile_y] = anInt1265;
        }
        player.renderHeight = getEntityTerrainHeightOffset(plane, player.y, player.x);
        worldController.placeAnimable(plane, player.orientation, player.renderHeight, i1, player.y, 60, player.x, player, player.aBoolean1541);
    }

}[/code]
</code></pre>
<p>[code]    private int getEntityTerrainHeightOffset(int plane, int y, int x)<br>
{<br>
int tile_x = x &gt;&gt; 7;<br>
int tile_y = y &gt;&gt; 7;<br>
if(tile_x &lt; 0 || tile_y &lt; 0 || tile_x &gt; 103 || tile_y &gt; 103)<br>
return 0;</p>
<pre><code>    int _plane = plane;
    if(_plane &lt; 3 &amp;&amp; (byteGroundArray[1][tile_x][tile_y] &amp; 2) == 2)
        _plane++;
                     
    // XXX: not a scale, refactor
    int tile_xscale = x &amp; 0x7f;
    int tile_yscale = y &amp; 0x7f;
    // calculate average tile height of top row (normalized)
    int top_avg = ((tileMeanHeight[_plane][tile_x][tile_y] * (128 - tile_xscale)) + (tileMeanHeight[_plane][tile_x + 1][tile_y] * tile_xscale)) &gt;&gt; 7;
    // and the bottom row (normalized)
    int bottom_avg = ((tileMeanHeight[_plane][tile_x][tile_y + 1] * (128 - tile_xscale)) + (tileMeanHeight[_plane][tile_x + 1][tile_y + 1] * tile_xscale)) &gt;&gt; 7;
    // average them both (and normalize) and return
    return ((top_avg * (128 - tile_yscale)) + (bottom_avg * tile_yscale)) &gt;&gt; 7;
}[/code]
</code></pre>
<p>Entity.x/Entity.y in moparisthebest’s deob is a packed field (I guess you could call it that).  The last 7 bits determine how much to offset the model (center etc), the rest are the actual tile x/y.   Throughout my refactor so far I’ve been using a rather lame quake-esque name ‘r_screenx’ ‘r_screeny’ ‘r_screenz’:</p>
<p>[code]    private void worldToScreen(Entity entity, int i)<br>
{<br>
worldToScreen(entity.x, i, entity.y);<br>
}</p>
<pre><code>private void worldToScreen(int r_screenx, int _height, int r_screeny)
{
    if(r_screenx &lt; 128 || r_screeny &lt; 128 || r_screenx &gt; 0x3300 || r_screeny &gt; 0x3300)
    {
        wtsScreenX = -1;
        wtsScreenY = -1;
        return;
    }
    int r_screenz = getEntityTerrainHeightOffset(plane, r_screeny, r_screenx) - _height;
    r_screenx -= xCameraPos;
    r_screenz -= zCameraPos;
    r_screeny -= yCameraPos;

    // XXX: refactor
    int sineY = Model.sineTable[cameraPitch];
    int cosineY = Model.cosineTable[cameraPitch];
    int sineX = Model.sineTable[cameraYaw];
    int cosineX = Model.cosineTable[cameraYaw];


    int temp = ((r_screeny * sineX) + (r_screenx * cosineX)) &gt;&gt; 16;

    r_screeny = ((r_screeny * cosineX) - (r_screenx * sineX)) &gt;&gt; 16;
    r_screenx = temp;

    temp = ((r_screenz * cosineY) - (r_screeny * sineY)) &gt;&gt; 16;

    r_screeny = ((r_screenz * sineY) + (r_screeny * cosineY)) &gt;&gt; 16;
    r_screenz = temp;

    if(r_screeny &gt;= 50)
    {
        wtsScreenX = Texture.textureInt1 + (r_screenx &lt;&lt; 9) / r_screeny;
        wtsScreenY = Texture.textureInt2 + (r_screenz &lt;&lt; 9) / r_screeny;
        //String s = String.format("[%d + (%d * 512) / %d, %d + (%d * 512) / %d", Texture.textureInt1, r_screenx, r_screeny,
        //                                                                        Texture.textureInt2, r_screenz, r_screeny);
        //chatTextDrawingArea.drawText(0xff0000, s, wtsScreenY - 10, wtsScreenX);
    } else
    {
        wtsScreenX = -1;
        wtsScreenY = -1;
    }
}[/code]
</code></pre>
<p>The ‘screen’ being the 3d ‘screen’/canvas/whatever the fuck.  Texture.textureInt1/2 in that example are the width/height of the texture of the model currently being rendered.</p>
<p>minor edit: frank_, I know you’re gonna cry about naming.  Don’t worry, it will be cleaned up eventually (probably never).<br>
[/quote]<br>
What cave did u get that out of?[/quote]How do you figure?</p>
      </div>

      <meta itemprop='headline' content='The runescape region system'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Killer-99-pkz.html'><span itemprop='name'>Killer-99-pkz</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-12-30T14:11:07Z'>
            <time itemprop='dateModified' datetime='2016-07-31T13:37:45Z' class='post-time'>
              July 31, 2016,  1:37pm
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hey, could i get change for a 100?<br>
[center]<img src="http://www.moparisthebest.com/smf/Themes/default/images/warnmute.gif" alt width="" height=""> Last few posts have been retarded.[/center]</p>
      </div>

      <meta itemprop='headline' content='The runescape region system'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Zeus14.html'><span itemprop='name'>Zeus14</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-02-04T09:14:09Z'>
            <time itemprop='dateModified' datetime='2016-07-31T14:32:29Z' class='post-time'>
              July 31, 2016,  2:32pm
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“i_own_pking, post:16, topic:317793”]Regions are actually 64x64 tiles and then they have 4 heights, however, more than 1 region is loaded at a time, the regions loaded are done as follows;</p>
<p><code>for(int regionX = (bigRegionX - 6) / 8; regionX &lt;= (bigRegionX + 6) / 8; regionX++)
	for(int regionY = (bigRegionY - 6) / 8; regionY &lt;= (bigRegionY + 6) / 8; regionY++)</code></p>
<p>bigRegionX and bigRegionY are the values the server sends to the client, this is;</p>
<pre><code class="lang-auto">(Actual co-ordinate / 8)</code></pre>
<p>Now, each actual map region should be co-ordinates / 64.</p>
<p>Map regions have an unique id, and each region id is calculated like this;</p>
<pre><code class="lang-auto">(mapRegionX &lt;&lt; 8) + mapRegionY;</code></pre>
<p>This id is then used to locate the landscape map id and object map id, from the “map_index” data chunk.</p>
<p>Now, the 104x104 tile “buffer” is a cut of the current region you are on plus the other loaded regions.</p>
<p>So, im guessing if enter a region from teleporting or logging in and you are in the dead center of it the client will load 9 maps and the 104x104 array will look like the following image;</p>
<p><img src="http://img6.imageshack.us/img6/7317/region.png" alt width="" height="">[/quote]</p>
<p>Yes that is anIntArray1234 so what is anIntArray1235 and anIntArray1236</p>
      </div>

      <meta itemprop='headline' content='The runescape region system'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-02-04T14:57:33Z'>
            <time itemprop='dateModified' datetime='2016-07-31T14:32:36Z' class='post-time'>
              July 31, 2016,  2:32pm
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hey i heard posting random variable names is helpful</p>
      </div>

      <meta itemprop='headline' content='The runescape region system'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="317793.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/the-runescape-region-system/317793?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 01:44:59 GMT -->
</html>
