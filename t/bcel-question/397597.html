<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/bcel-question/397597 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 02:14:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>BCEL Question - Runescape - moparisthebest.com</title>
    <meta name="description" content="Assume class C with field f and method m(arg). I wish to know how I would edit the instructions of method m to perform STDout of the value of f and arg at the end of its execution. 

Thanks. 

Edit: This should have real&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="397597.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;BCEL Question&#39;" href="397597.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/bcel-question/397597" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/bcel-question/397597" />
<meta property="og:title" content="BCEL Question" />
<meta name="twitter:title" content="BCEL Question" />
<meta property="og:description" content="Assume class C with field f and method [i]m/i. I wish to know how I would edit the instructions of method m to perform STDout of the value of f and arg at the end of its execution.  Thanks.  Edit: This should have really been in the Java section, but I suppose this section applies." />
<meta name="twitter:description" content="Assume class C with field f and method [i]m/i. I wish to know how I would edit the instructions of method m to perform STDout of the value of f and arg at the end of its execution.  Thanks.  Edit: This should have really been in the Java section, but I suppose this section applies." />
<meta property="article:published_time" content="2011-06-03T00:14:36+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="397597.html">BCEL Question</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-03T00:14:36Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:10:31Z' class='post-time'>
              August 1, 2016, 12:10pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Assume class <span class="bbcode-i">C</span> with field <span class="bbcode-i">f</span> and method [i]m<a>/i</a>. I wish to know how I would edit the instructions of method <span class="bbcode-i">m</span> to perform STDout of the value of <span class="bbcode-i">f</span> and <span class="bbcode-i">arg</span> at the end of its execution.</p>
<p>Thanks.</p>
<p>Edit: This should have really been in the Java section, but I suppose this section applies.</p>
      </div>

      <meta itemprop='headline' content='BCEL Question'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-03T00:18:41Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:10:35Z' class='post-time'>
              August 1, 2016, 12:10pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“yakman, post:1, topic:112402”]SIMPLE INSERTING INSTRUCTIONS</p>
<p>Now we get to a good part, you know how stuff in java is broken down into instructions, they store their stuff in the stack.<br>
In bcel, they are represented by objects of type Instruction, an abstract class, all instructions actually have their own class, there is also a InstructionHandle class, this is like a referance to an Instruction.<br>
Well, each method has its own store of instructions, there is a special object for that, called InstructionList, its a bit like a glorified Instruction[], (really its an array of InstructionHandle)</p>
<p>Lets start a challange now, lets insert our own instruction in a class,<br>
when I make something with bcel, I always try it on my own class, then try it on the real client</p>
<pre><code class="lang-auto">public class SomeClass {

	public static void main(String[] args) {

		String myStr = "Boo!";
		System.out.println(myStr);
	}
}</code></pre>
<p>The task is to add my own method in there, to examine that string,<br>
Something like this I hope</p>
<pre><code class="lang-auto">String myStr = "Boo!";
Bot.examineString(myStr);
System.out.println(myStr);</code></pre>
<p>first off, lets have a look at the bytecode for the original method, im using JBE, but you can use anything that can view the bytecode, a lot of people use CFParse as well</p>
<p><img src="http://img524.imageshack.us/img524/8302/insertinstructionbytecota5.png" alt width="" height=""></p>
<p>As you can see, the ldc pushes “Boo!”, stores it, gets System.out, loads the string again, and invokes PrintStream.println(),<br>
so what we need to do is insert our own instruction to invoke our own method, it will have a single parameter, the String myStr, it will take it from the stack, so its important to give back to the stack as well, so the method also has to return a string which is placed back on the stack.</p>
<p>This is the class we’ll use, the only reason iv placed the System.out.println there, is so I can check it works.</p>
<pre><code class="lang-auto">public class Bot {

	public static String examineString(String str) {
		System.out.println("called examineString("+str+")");
		return str;
	}
}</code></pre>
<p>Remember InstructionList, these contain all the instruction in that method, we need to find the right one, then insert our own thing<br>
To get an object of type InstructionList, call aMethodGen.getInstructionList(); we should iterate through that list and look for any sort of pattern.<br>
The instruction I’m going to insert behind is the InvokeVirtual which calls PrintStream.println()</p>
<pre><code class="lang-auto">Instruction getFieldInstruction = null;
InstructionHandle[] iHandles = iList.getInstructionHandles();
for(int f=0;f&lt;iHandles.length;f++) {
	if(iHandles[f].getInstruction() instanceof INVOKEVIRTUAL) {
		getFieldInstruction = iHandles[f].getInstruction();
		System.out.println("found the invoke virtual");
		break;
	}
}</code></pre>
<p>So now we have the instruction from the method, lets create our own instruction to insert.<br>
We need to make an InvokeStatic, to call Bot.examineString(), bcel has a little tool for this, the InstructionFactory class, this class creates instruction for us, but it also needs access to the ClassGen and ConstantPoolGen of the instruction.</p>
<p>There is a class called Type, this represents a type of variable, which can be a primative type, null, array type or object type. Type itself is an abstract class, its decendants are the real stuff.</p>
<p>The method we’ll use is createInvoke(), this asks for the name of the class which contains the method, the name of the method, the type it returns, an array of types for the parameters, and the kind of invoke.<br>
for the kind of invoke, we look in the org.apache.bcel.Constants class, it contains many static methods, the one which intrest us the most are INVOKESTATIC, INVOKEVIRTUAL and INVOKESPECIAL, for our purpose, we shall use InvokeStatic.<br>
the Type class already has a constant which represents String, we can just use Type.STRING,</p>
<p>so the next part of our code will be a little like this</p>
<pre><code class="lang-auto">InstructionFactory iFactory = new InstructionFactory(theClassGen,theCPool);
InvokeInstruction callStringExamine = iFactory.createInvoke("Bot","examineString",Type.STRING,new Type[]{Type.STRING},Constants.INVOKESTATIC);</code></pre>
<p>So now we have our instruction-to-be-inserted, and the instruction we’ll insert it behind. The InstructionList class has a method just for that insert(Instruction,Instruction);<br>
so we call<br>
iList.insert(getFieldInstruction,callStringExamine);</p>
<p>Next call aMethodGen.setInstructionList, to replace the list there with your modified one</p>
<pre><code class="lang-auto">mainMethodGen.setInstructionList(iList);</code></pre>
<p>then there are these “clean-up” methods, I admit I dont know why they are used, but everyone else uses them, I find it hard to belive they are wasting their time, so here they are</p>
<pre><code class="lang-auto">iList.setPositions();
mainMethodGen.setMaxStack();
mainMethodGen.setMaxLocals();
mainMethodGen.removeLineNumbers();</code></pre>
<p>finally, we have to replace our modified method, with the method that was already there, we use ClassGen.replaceMethod<br>
theClassGen.replaceMethod(mainMethod,mainMethodGen.getMethod());[/quote]</p>
      </div>

      <meta itemprop='headline' content='BCEL Question'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-03T21:08:14Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:11:45Z' class='post-time'>
              August 1, 2016, 12:11pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>perform STDout? Can you stop trying to forcibly come off as intelligent through formality?</p>
      </div>

      <meta itemprop='headline' content='BCEL Question'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-03T22:00:27Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:11:49Z' class='post-time'>
              August 1, 2016, 12:11pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I will be sure to say misc.print next time</p>
      </div>

      <meta itemprop='headline' content='BCEL Question'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/yakman.html'><span itemprop='name'>yakman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-03T22:51:08Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:11:51Z' class='post-time'>
              August 1, 2016, 12:11pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Wow, people still read my tutorial from 4 years ago.<br>
Just skimmed through it again <em>cringe</em>.</p>
      </div>

      <meta itemprop='headline' content='BCEL Question'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/bcel-question/397597 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 02:14:06 GMT -->
</html>
