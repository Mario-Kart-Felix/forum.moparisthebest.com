<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/c-help/425145 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 09:06:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>C Help - General Programming - moparisthebest.com</title>
    <meta name="description" content="Hi how are we all? 

So I&amp;#39;ve being trying to learn C lately and since I&amp;#39;ve being having a little trouble with grasping pointers/dynamic memory I thought of trying to create a sort of Memory profiling system. I wanted to &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="425145.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;C Help&#39;" href="425145.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/c-help/425145" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/c-help/425145" />
<meta property="og:title" content="C Help" />
<meta name="twitter:title" content="C Help" />
<meta property="og:description" content="Hi how are we all?  So I’ve being trying to learn C lately and since I’ve being having a little trouble with grasping pointers/dynamic memory I thought of trying to create a sort of Memory profiling system. I wanted to hide as much from the user as possible. Although it works I was wondering if the following can be improved on. At the moment it’s messy and MemoryManager was a poor naming choice, I really dislike the macros…  The FILE and LINE would  be for logging if I ever could get to it.  If ..." />
<meta name="twitter:description" content="Hi how are we all?  So I’ve being trying to learn C lately and since I’ve being having a little trouble with grasping pointers/dynamic memory I thought of trying to create a sort of Memory profiling system. I wanted to hide as much from the user as possible. Although it works I was wondering if the following can be improved on. At the moment it’s messy and MemoryManager was a poor naming choice, I really dislike the macros…  The FILE and LINE would  be for logging if I ever could get to it.  If ..." />
<meta property="article:published_time" content="2011-12-13T09:44:38+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="425145.html">C Help</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/surfer25.html'><span itemprop='name'>surfer25</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T09:44:38Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:07Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi how are we all?</p>
<p>So I’ve being trying to learn C lately and since I’ve being having a little trouble with grasping pointers/dynamic memory I thought of trying to create a sort of Memory profiling system. I wanted to hide as much from the user as possible. Although it works I was wondering if the following can be improved on. At the moment it’s messy and MemoryManager was a poor naming choice, I really dislike the macros…</p>
<p>The <span class="bbcode-b"><strong>FILE</strong></span> and <span class="bbcode-b"><strong>LINE</strong></span> would  be for logging if I ever could get to it.<br>
If you’re wondering about the structure names it was a convention in a book I’m learning from which I took a liking too.</p>
<pre><code class="lang-auto">#ifndef MEMORY_MANAGER_H
#define MEMORY_MANAGER_H

#include &lt;assert.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdint.h&gt;

#define alloc(x, y) allocateMemory(x,y, __FILE__, __LINE__)
#define dealloc(x, y) deallocateMemory(x,y, __FILE__, __LINE__)

#ifdef __cplusplus
extern "C" {
#endif

    typedef void* MemoryManager;

    void createMemoryManager(MemoryManager manager);

    void destroyMemoryManager(MemoryManager manager);

    size_t getRemainingMemory(MemoryManager manager);

    void* allocateMemory(MemoryManager manager, size_t mem, const char* file, uint16_t line);

    void deallocateMemory(MemoryManager manager, void* data, const char* file, uint16_t line);

    size_t getAllocatedMemory(MemoryManager manager);

    size_t getMemoryAllocations(MemoryManager manager);

    size_t getPeekMemoryUsage(MemoryManager manager);

#ifdef __cplusplus
}
#endif

#endif</code></pre>
<pre><code class="lang-auto">#include "MemoryManager.h"

typedef struct __memory_node {
    size_t memory_size;
    void* block;
    
    struct __memory_node *next;
    struct __memory_node *previous;
} MemoryNode;

typedef struct {
    size_t allocated_memory;
    size_t memory_allocations;

    size_t peek_memory_usage;

    MemoryNode* memory_nodes;
} __memory_manager;

void createMemoryManager(MemoryManager manager) {
    __memory_manager* m = (__memory_manager*) malloc(sizeof (__memory_manager));
    m-&gt;allocated_memory = 0;
    m-&gt;memory_allocations = 0;
    m-&gt;peek_memory_usage = 0;
    m-&gt;memory_nodes = NULL;
    manager = m;
}

void destroyMemoryManager(MemoryManager manager) {
    __memory_manager* m = (__memory_manager*) manager;
    free(m);
}

size_t getRemainingMemory(MemoryManager m) {
    __memory_manager* manager = (__memory_manager*) m;
    if (manager-&gt;memory_nodes == NULL) {
        return 0;
    }

    size_t remaining = 0;
    MemoryNode* node = manager-&gt;memory_nodes-&gt;next;
    do {
        remaining++;
        node = node-&gt;next;
    } while (node != manager-&gt;memory_nodes);
    return remaining;
}

void* allocateMemory(MemoryManager m, size_t mem, const char* file_name, uint16_t line) {
    __memory_manager* manager = (__memory_manager*) m;
    void* block = malloc(sizeof (MemoryNode) + mem);

    assert(block);

    MemoryNode* node = (MemoryNode*) block;

    node-&gt;memory_size = mem;
    node-&gt;block = block + sizeof (MemoryNode);

    if (manager-&gt;memory_nodes == NULL) {
        manager-&gt;memory_nodes = node;
        node-&gt;next = node-&gt;previous = node;
    } else {
        node-&gt;next = manager-&gt;memory_nodes;
        node-&gt;previous = manager-&gt;memory_nodes-&gt;previous;
        node-&gt;previous-&gt;next = node;
        manager-&gt;memory_nodes-&gt;previous = node;
    }

    manager-&gt;allocated_memory += mem;
    manager-&gt;memory_allocations++;
    if (manager-&gt;peek_memory_usage &lt; manager-&gt;allocated_memory) {
        manager-&gt;peek_memory_usage = manager-&gt;allocated_memory;
    }
    return node-&gt;block;
}

void deallocateMemory(MemoryManager m, void* data, const char* file_name, uint16_t line) {
    __memory_manager* manager = (__memory_manager*) m;
    MemoryNode* node = (MemoryNode*) (data - sizeof (MemoryNode));

    manager-&gt;allocated_memory -= node-&gt;memory_size;
    manager-&gt;memory_allocations--;

    if (manager-&gt;memory_nodes == node &amp;&amp; node-&gt;previous == node) {
        manager-&gt;memory_nodes = NULL;
    } else {
        node-&gt;next-&gt;previous = node-&gt;previous;
        node-&gt;previous-&gt;next = node-&gt;next;
    }
    free((void*) node);
}

size_t getAllocatedMemory(MemoryManager manager) {
    __memory_manager* m = (__memory_manager*) manager;
    return m-&gt;allocated_memory;
}

size_t getMemoryAllocations(MemoryManager manager) {
    __memory_manager* m = (__memory_manager*) manager;
    return m-&gt;memory_allocations;
}

size_t getPeekMemoryUsage(MemoryManager manager) {
    __memory_manager* m = (__memory_manager*) manager;
    return m-&gt;peek_memory_usage;
}
</code></pre>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T16:50:54Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:19Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“surfer25, post:1, topic:425145”]Hi how are we all?</p>
<p><span class="bbcode-b">So I’ve being trying to learn C lately and since I’ve being having a little trouble with grasping pointers/dynamic memory</span> I thought of trying to create a sort of Memory profiling system. <span class="bbcode-b">I wanted to hide as much from the user as possible.</span>[/quote]<br>
Smart pointers (basically an encapsulation of a pointer with the primary pointer operators overridden for the class and a destructor that deletes the memory allocation)?</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mopman.html'><span itemprop='name'>Mopman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T17:37:34Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:21Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>c, not c++.</p>
<p>i’m not sure what your goal is with this, to be honest. if your intention is to cut down on tons of calls out to the OS memory manager, like for example game engines tend to do when allocating lots of little objects regularly, why hide the calls behind potentially dangerous macros? just have the user use your stuff directly.</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T19:02:35Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:23Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Mopman, post:3, topic:425145”]c, not c++.</p>
<p>i’m not sure what your goal is with this, to be honest. if your intention is to cut down on tons of calls out to the OS memory manager, like for example game engines tend to do when allocating lots of little objects regularly, why hide the calls behind potentially dangerous macros? just have the user use your stuff directly.[/quote]<br>
i figured someone would get on me about using the name ‘class’. couldn’t you just use native C structs to accomplish this? or are there more differences between a class and a struct other than naming and permissions?</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mopman.html'><span itemprop='name'>Mopman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T19:48:56Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:25Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>well you also talked about destructors and smart pointers</p>
<p>there is no way to create a smart pointer in c, because there is no way to do automatic destruction in c.</p>
<p>there are massive massive differences between a c struct and c++ class - in c++, struct is just a synonym for class with different access like you say, but a c struct doesnt have the concept of a destructor, for example. theres no way to automatically call a method when a reference drops out of scope, so no smart pointers</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-13T20:07:11Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:27:26Z' class='post-time'>
              August 2, 2016,  2:27pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Mopman, post:5, topic:425145”]well you also talked about destructors and smart pointers</p>
<p>there is no way to create a smart pointer in c, because there is no way to do automatic destruction in c.</p>
<p>there are massive massive differences between a c struct and c++ class - in c++, struct is just a synonym for class with different access like you say, but a c struct doesnt have the concept of a destructor, for example. theres no way to automatically call a method when a reference drops out of scope, so no smart pointers[/quote]<br>
i was not aware struct don’t have destructor. if this is true, which i don’t doubt, then smart pointers are an impossibility as stated.</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/surfer25.html'><span itemprop='name'>surfer25</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-14T06:00:18Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:28:13Z' class='post-time'>
              August 2, 2016,  2:28pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Mopman, post:3, topic:425145”]c, not c++.</p>
<p>i’m not sure what your goal is with this, to be honest. if your intention is to cut down on tons of calls out to the OS memory manager, like for example game engines tend to do when allocating lots of little objects regularly, why hide the calls behind potentially dangerous macros? just have the user use your stuff directly.[/quote]</p>
<p>My original post didn’t really explain what I need at; sorry about that… But nothing like that at all.</p>
<p>I’m was having a lot of trouble grasping memory/pointers so I made this program to just test myself but because I’m new to this I was wondering if there are parts that can be improved on. For example you said ‘dangerous macros’ - why are they dangerous? It’s hard coming from Java to C. Just any pointers (pun intended <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> ) that could make the program… better?</p>
<p>Particularly with hiding the details…</p>
<pre><code class="lang-auto">typedef void* MemoryManager</code></pre>
<p>It just seems… messy</p>
      </div>

      <meta itemprop='headline' content='C Help'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/c-help/425145 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 09:06:15 GMT -->
</html>
