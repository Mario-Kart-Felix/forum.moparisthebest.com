<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/cache-downloads-to-the-folder-but-extracts-as-zip/428751 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:28:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Cache downloads to the folder, but extracts as .zip - Game Development - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;ve been trying to figure out why it keeps on doing this for the past hour or so. 

The cache I&amp;#39;m wanting to download is cache.zip, but inside the cache directory, it downloads cache.zip? Confusing. (Note: I quit the do&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="428751.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Cache downloads to the folder, but extracts as .zip&#39;" href="428751.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://phphf.kodingen.com/public_images/z21my5.png" />
<meta property="og:image" content="http://phphf.kodingen.com/public_images/z21my5.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/cache-downloads-to-the-folder-but-extracts-as-zip/428751" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/cache-downloads-to-the-folder-but-extracts-as-zip/428751" />
<meta property="og:title" content="Cache downloads to the folder, but extracts as .zip" />
<meta name="twitter:title" content="Cache downloads to the folder, but extracts as .zip" />
<meta property="og:description" content="I’ve been trying to figure out why it keeps on doing this for the past hour or so.  The cache I’m wanting to download is cache.zip, but inside the cache directory, it downloads cache.zip? Confusing. (Note: I quit the download at 1MB because I’m not downloading the full 100MB while zipped cache if it’s not working)    How it looks when I open the zipped file.    CacheDownloader.java  import java.io.File; import java.io.IOException; import java.io.OutputStream; import java.io.FileWriter; import ja..." />
<meta name="twitter:description" content="I’ve been trying to figure out why it keeps on doing this for the past hour or so.  The cache I’m wanting to download is cache.zip, but inside the cache directory, it downloads cache.zip? Confusing. (Note: I quit the download at 1MB because I’m not downloading the full 100MB while zipped cache if it’s not working)    How it looks when I open the zipped file.    CacheDownloader.java  import java.io.File; import java.io.IOException; import java.io.OutputStream; import java.io.FileWriter; import ja..." />
<meta property="article:published_time" content="2012-01-10T07:53:44+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="428751.html">Cache downloads to the folder, but extracts as .zip</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming/game-development.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Game Development</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jddogg9.html'><span itemprop='name'>Jddogg9</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T07:53:44Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:19Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ve been trying to figure out why it keeps on doing this for the past hour or so.</p>
<p>The cache I’m wanting to download is cache.zip, but inside the cache directory, it downloads cache.zip? Confusing. (Note: I quit the download at 1MB because I’m not downloading the full 100MB while zipped cache if it’s not working)</p>
<p><img src="http://phphf.kodingen.com/public_images/z21my5.png" alt width="" height=""></p>
<p>How it looks when I open the zipped file.</p>
<p><img src="http://phphf.kodingen.com/public_images/wn9gn7.png" alt width="" height=""></p>
<p>CacheDownloader.java</p>
<pre><code class="lang-auto">import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.io.FileWriter;
import java.io.BufferedWriter;
import java.io.BufferedOutputStream;
import java.io.BufferedInputStream;
import java.io.FileOutputStream;
import java.io.FileInputStream;
import java.io.InputStream;
import java.net.URLConnection;
import java.net.URL;
import java.util.zip.ZipFile;
import java.util.zip.ZipEntry;
import java.util.zip.ZipInputStream;
import java.util.Enumeration;

import sign.signlink;

public class CacheDownloader {

        private client client;

        private final int BUFFER = 1024;

        /*
         * Only things you need to change
         *
         */
        private final int VERSION = 1; // Version of cache
        private String cacheLink = "http://199.71.212.*/.Runited634.zip";

        private String fileToExtract = getCacheDir() + getArchivedName();

        public CacheDownloader(client client) {
                this.client = client;
        }

        private void drawLoadingText(String text) {
            client.drawLoadingText(35, text);
        }


        private void drawLoadingText(int amount, String text) {
                client.drawLoadingText(amount, text);
                System.out.println(text);
        }

        private String getCacheDir() {
                return signlink.findcachedir();
        }

        private String getCacheLink() {
                return cacheLink;
        }

        private int getCacheVersion() {
                return VERSION;
        }

        public CacheDownloader downloadCache() {
                try {
                File location = new File(getCacheDir());
                File version = new File(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat");
                if(!location.exists()) {
                        downloadFile(getCacheLink(), getArchivedName());
                        unZip();
                        BufferedWriter versionFile = new BufferedWriter(new FileWriter(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat"));
                        versionFile.close();
						deleteZIP(getArchivedName());
                } else {
                        if(!version.exists()) {
                                downloadFile(getCacheLink(), getArchivedName());
                                unZip();
                                BufferedWriter versionFile = new BufferedWriter(new FileWriter(getCacheDir() + "/cacheVersion" + getCacheVersion() + ".dat"));
                                versionFile.close();
								deleteZIP(getArchivedName());
                        } else {
                                return null;
                        }
                }
                } catch(Exception e) {
                }
                return null;
        }
        
        private void downloadFile(String adress, String localFileName) {
                OutputStream out = null;
                URLConnection conn;
                InputStream in = null;
                
                try {
                    URL url = new URL(adress);
                    out = new BufferedOutputStream(
                    new FileOutputStream(getCacheDir() + "/" +localFileName)); 

                    conn = url.openConnection();
                    in = conn.getInputStream(); 
                
                    byte[] data = new byte[BUFFER]; 
        
                    int numRead;
                    long numWritten = 0;
                    int length = conn.getContentLength();

        
                        while((numRead = in.read(data)) != -1) {
                                out.write(data, 0, numRead);
                                numWritten += numRead;
                                int percentage = (int)(((double)numWritten / (double)length) * 100D);
                                drawLoadingText(percentage, "Be patient... cache is downloading.");
                        }
                        drawLoadingText(100, "Download finished, unzipping files...");

                } catch (Exception exception) {
                        exception.printStackTrace();
                } finally {
                        try {
                                if (in != null) {
                                        in.close();
                                }
                                if (out != null) {
                                        out.close();
                                }
                        } catch (IOException ioe) {
                        }
                }

        }

        private String getArchivedName() {
                int lastSlashIndex = getCacheLink().lastIndexOf('/');
                if (lastSlashIndex &gt;= 0 
                        &amp;&amp; lastSlashIndex &lt; getCacheLink().length() -1) { 
                        return getCacheLink().substring(lastSlashIndex + 1);
                } else {
                        System.err.println("Can not find archived name.");
                }
                return null;
        }



        private void unZip() {
            try {
                    InputStream in = 
                    new BufferedInputStream(new FileInputStream(fileToExtract));
                ZipInputStream zin = new ZipInputStream(in);
                ZipEntry e;

                while((e=zin.getNextEntry()) != null) {

                    if(e.isDirectory()) {
                        (new File(getCacheDir() + e.getName())).mkdir();
                    } else {
                    if (e.getName().equals(fileToExtract)) {
                        unzip(zin, fileToExtract);
                        break;
                    }
						unzip(zin, getCacheDir() + e.getName());
                    }
                }
                zin.close();

            } catch(Exception e) {
                e.printStackTrace();
            }
        }

        private void unzip(ZipInputStream zin, String s) 
                throws IOException {
                FileOutputStream out = new FileOutputStream(s);
                byte [] b = new byte[BUFFER];
                int len = 0;

                while ((len = zin.read(b)) != -1) {
                        out.write(b,0,len);
                }
                out.close();
        }
		
		private void deleteZIP(String fileName) {
			File f = new File(getCacheDir() + fileName);
			if (!f.exists())
			  throw new IllegalArgumentException(
				  "Delete: no such file or directory: " + fileName);

			if (!f.canWrite())
			  throw new IllegalArgumentException("Delete: write protected: " + fileName);
			if (f.isDirectory()) {
			  String[] files = f.list();
			  if (files.length &gt; 0)
				throw new IllegalArgumentException(
					"Delete: directory not empty: " + fileName);
			}
			boolean success = f.delete();
			if (!success)
			  throw new IllegalArgumentException("Delete: deletion failed");
		}
}</code></pre>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T08:25:43Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:20Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Why is the cache 100MB? That would be my biggest question.</p>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jddogg9.html'><span itemprop='name'>Jddogg9</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T08:35:08Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:20Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="2" data-topic="428751">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/zyle1992/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> zyle1992:</div>
<blockquote>
<p>Why is the cache 100MB? That would be my biggest question.</p>
</blockquote>
</aside>
<p>Does it really matter? If you can’t help answer my question then why are you posting?</p>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T09:53:07Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:21Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Jddogg9, post:3, topic:428751”][quote author=zyle1992 link=topic=531442.msg3882911#msg3882911 date=1326183943]<br>
Why is the cache 100MB? That would be my biggest question.<br>
[/quote]</p>
<p>Does it really matter? If you can’t help answer my question then why are you posting?[/quote]</p>
<p>Perhaps if the cache were smaller, there wouldn’t be a problem.</p>
<p>EDIT: I literally made this in under 5 minutes, and it works as it should</p>
<pre><code class="lang-auto">import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;

import java.util.Enumeration;

import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;

public class ZIPDemo {
    public static void main(String[] args) throws IOException {
        final ZipFile file = new ZipFile(args[0]);
        final File destination = new File(args[1]);
        final Enumeration&lt;? extends ZipEntry&gt; entries = file.entries();
        final byte[] data = new byte[1024];
        while (entries.hasMoreElements()) {
            final ZipEntry entry = entries.nextElement();
            if (entry.isDirectory()) {
                final File dir = new File(destination + "/" + entry.getName());
                dir.mkdirs();
                continue;
            }
            final InputStream input = file.getInputStream(entry);
            final FileOutputStream fos = new FileOutputStream(destination + "/" + entry.getName());
            
            int len = 0;
            while ((len = input.read(data)) != -1) {
                fos.write(data, 0, len);
            }
            fos.close();
        }
    }
}</code></pre>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Loveandpower.html'><span itemprop='name'>Loveandpower</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T17:40:49Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:33Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is because the folder was zipped instead of the folder contents. This ca be resolved by zipping just the contents and then reuploading/adding new link to cachedownloader. Compile then run</p>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zyle1992.html'><span itemprop='name'>zyle1992</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T22:17:52Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:54Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="5" data-topic="428751">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/loveandpower/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Loveandpower:</div>
<blockquote>
<p>This is because the folder was zipped instead of the folder contents. This ca be resolved by zipping just the contents and then reuploading/adding new link to cachedownloader. Compile then run</p>
</blockquote>
</aside>
<p>I tested mine on both and it works fine.</p>
      </div>

      <meta itemprop='headline' content='Cache downloads to the folder, but extracts as .zip'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/cache-downloads-to-the-folder-but-extracts-as-zip/428751 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 01:28:48 GMT -->
</html>
