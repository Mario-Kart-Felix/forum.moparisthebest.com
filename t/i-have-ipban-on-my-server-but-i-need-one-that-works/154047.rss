<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>I have Ipban on my server, but I need one that works.!</title>
    <link>https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047</link>
    <description>Hi, This is my run void in server.java:

[code]public void run() {
	    try {
		shutdownClientHandler = false;
		clientListener = new java.net.ServerSocket(serverlistenerPort, 1, null);
		misc.println(&quot;Pkmad U.K by james has started on port &quot; + clientListener.getLocalPort());
		while(true) {
		    java.net.Socket s = clientListener.accept();
		    s.setTcpNoDelay(true);
		    String connectingHost = s.getInetAddress().getHostName();
		    boolean checkbanned = false;
		    try {
			BufferedReader in = new BufferedReader(new FileReader(&quot;data/bannedips.txt&quot;));
			String data = null;
			while ((data = in.readLine()) != null) {
			    if (connectingHost.startsWith(data)){
				checkbanned = true;
			    }
			}
		    } catch (IOException e) {
			System.err.println(&quot;The banned IPs file could not be accessed.&quot;);
			checkbanned = false;
		    }
		    if(clientListener != null &amp;&amp; checkbanned == false) {
			    int Found = -1;
			    for (int i = 0; i &lt; MaxConnections; i++) {
				if (Connections[i] == connectingHost) {
				    Found = ConnectionCount[i];
				    break;
				}
			    }
			    if (Found &lt; 3) {
				playerHandler.newPlayerClient(s, connectingHost);
			    } else {
				s.close();
			    }
		    } else {
					misc.println(&quot;ClientHandler: Rejected &quot;+connectingHost+&quot;:&quot;+s.getPort());
			s.close();
		    }
		}
	    } catch(java.io.IOException ioe) {
		if(!shutdownClientHandler) {
		    misc.println(&quot;Error: Unable to startup listener on &quot;+serverlistenerPort+&quot; - port already in use?&quot;);
		} else {
		    misc.println(&quot;ClientHandler was shut down.&quot;);
		}
	    }
  

}[/code]

It works sometimes, but when I take them of the list, they are still banned?

This is my IPBAN command:

[code]if(command.startsWith(&quot;ipban&quot;) &amp;&amp; (playerRights &gt;= 2)) {
    String victim = command.substring(6);
    PlayerHandler.kickNick = victim;
    int otherPIndex = PlayerHandler.getPlayerID(victim);
    if(otherPIndex != -1 &amp;&amp; server.playerHandler.players[otherPIndex] != null) {
        client p = (client) server.playerHandler.players[otherPIndex];
        appendToBannedIP(p.connectedFrom);
    }
    System.out.println(&quot;Admin:&quot;+playerName+&quot; is IPbanning &quot;+victim);
    sendMessage(&quot;Player &quot;+victim+&quot; successfully IP banned&quot;);
}[/code]

Thanks</description>
    
    <lastBuildDate>Thu, 25 Oct 2007 14:07:11 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>I have Ipban on my server, but I need one that works.!</title>
        <dc:creator><![CDATA[@X-J-K-X X-J-K-X]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/x-j-k-x">@X-J-K-X</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group quote-modified" data-post="3" data-topic="154047">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/musicmad441/40/5_6bca9977b612b7aeef77ba1ec1cd67b3.png" class="avatar"> musicmad441:</div>
<blockquote>
<p>No, didn’t work sorry.</p>
</blockquote>
</aside>
<p>It does lol… You have to programme your source to read the file. So you have to set a returnCode, etcc…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/4</link>
        <pubDate>Thu, 25 Oct 2007 14:07:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-154047-4</guid>
        <source url="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047.rss">I have Ipban on my server, but I need one that works.!</source>
      </item>
      <item>
        <title>I have Ipban on my server, but I need one that works.!</title>
        <dc:creator><![CDATA[@musicmad441 Musicmad]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/musicmad441">@musicmad441</a> wrote:</p>
          <blockquote>
              <p>No, didn’t work sorry.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/3</link>
        <pubDate>Thu, 25 Oct 2007 13:26:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-154047-3</guid>
        <source url="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047.rss">I have Ipban on my server, but I need one that works.!</source>
      </item>
      <item>
        <title>I have Ipban on my server, but I need one that works.!</title>
        <dc:creator><![CDATA[@X-J-K-X X-J-K-X]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/x-j-k-x">@X-J-K-X</a> wrote:</p>
          <blockquote>
              <p>You don’t really need to edit the run method… Run method really, is for stopping crashers / Nullers / Syi… IP Ban can simply be done by adding 1/2 methods, and a command. Here is mine.<br>
Declare these.</p>
<pre><code class="lang-auto">public void appendToIPBanned(String ip) {

      BufferedWriter bw = null;

      try {
         bw = new BufferedWriter(new FileWriter("data/bannedips.txt", true));
	 bw.write(ip);
	 bw.newLine();
	 bw.flush();
      } catch (IOException ioe) {
	 ioe.printStackTrace();
      } finally {
	 if (bw != null) try {
	    bw.close();
	 } catch (IOException ioe2) {
	    sendMessage("Error IP banning user!");
	 }
      }

   }</code></pre>
<p>[code]public void appendToBanned(String player) {</p>
<pre><code>  BufferedWriter bw = null;

  try {
     bw = new BufferedWriter(new FileWriter("data/bannedusers.txt", true));
 player = player.replaceAll("_", " ");
 bw.write(player);
 bw.newLine();
 bw.flush();
  } catch (IOException ioe) {
 ioe.printStackTrace();
  } finally {
 if (bw != null) try {
    bw.close();
 } catch (IOException ioe2) {
    sendMessage("Error banning user!");
 }
  }
</code></pre>
<p>}<br>
[/code]<br>
Add this command</p>
<pre><code class="lang-auto">if (command.startsWith("ipban") &amp;&amp; (playerRights &gt;= 1)) {
try {
String banned = command.substring(6);
int name = PlayerHandler.getPlayerID(banned);
client b = (client) server.playerHandler.players[name];
b.disconnected = true;
appendToIPBanned(b.connectedFrom);
PlayerHandler.messageToAll = (""+playerName+" has ip banned ["+b.connectedFrom+"] ("+command.substring(6)+")");
sendMessage("You have ip banned "+command.substring(6)+". Connected From: "+b.connectedFrom+"");
} catch(Exception e) {
sendMessage(""+command.substring(6)+" is either offline or name doesnt exist.");
}
BufferedWriter bw = null;
try {
bw = new BufferedWriter(new FileWriter("data/bannedips.txt", true));
bw.write(""+playerName+" IP Banned "+command.substring(6)+"");
bw.newLine();
bw.flush();
} catch (IOException ioe) {
ioe.printStackTrace();
} finally {
if (bw != null) try {
bw.close();
} catch (IOException ioe2) {
sendMessage("Error kicking user.");
}
}
}</code></pre>
<p>H2H</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/2</link>
        <pubDate>Thu, 25 Oct 2007 13:09:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-154047-2</guid>
        <source url="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047.rss">I have Ipban on my server, but I need one that works.!</source>
      </item>
      <item>
        <title>I have Ipban on my server, but I need one that works.!</title>
        <dc:creator><![CDATA[@musicmad441 Musicmad]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/musicmad441">@musicmad441</a> wrote:</p>
          <blockquote>
              <p>Hi, This is my run void in server.java:</p>
<p>[code]public void run() {<br>
try {<br>
shutdownClientHandler = false;<br>
clientListener = new java.net.ServerSocket(serverlistenerPort, 1, null);<br>
misc.println("Pkmad U.K by james has started on port " + clientListener.getLocalPort());<br>
while(true) {<br>
java.net.Socket s = clientListener.accept();<br>
s.setTcpNoDelay(true);<br>
String connectingHost = s.getInetAddress().getHostName();<br>
boolean checkbanned = false;<br>
try {<br>
BufferedReader in = new BufferedReader(new FileReader(“data/bannedips.txt”));<br>
String data = null;<br>
while ((data = in.readLine()) != null) {<br>
if (connectingHost.startsWith(data)){<br>
checkbanned = true;<br>
}<br>
}<br>
} catch (IOException e) {<br>
System.err.println(“The banned IPs file could not be accessed.”);<br>
checkbanned = false;<br>
}<br>
if(clientListener != null &amp;&amp; checkbanned == false) {<br>
int Found = -1;<br>
for (int i = 0; i &lt; MaxConnections; i++) {<br>
if (Connections[i] == connectingHost) {<br>
Found = ConnectionCount[i];<br>
break;<br>
}<br>
}<br>
if (Found &lt; 3) {<br>
playerHandler.newPlayerClient(s, connectingHost);<br>
} else {<br>
s.close();<br>
}<br>
} else {<br>
misc.println(“ClientHandler: Rejected “+connectingHost+”:”+s.getPort());<br>
s.close();<br>
}<br>
}<br>
} catch(java.io.IOException ioe) {<br>
if(!shutdownClientHandler) {<br>
misc.println(“Error: Unable to startup listener on “+serverlistenerPort+” - port already in use?”);<br>
} else {<br>
misc.println(“ClientHandler was shut down.”);<br>
}<br>
}</p>
<p>}[/code]</p>
<p>It works sometimes, but when I take them of the list, they are still banned?</p>
<p>This is my IPBAN command:</p>
<p><code>if(command.startsWith("ipban") &amp;&amp; (playerRights &gt;= 2)) {
    String victim = command.substring(6);
    PlayerHandler.kickNick = victim;
    int otherPIndex = PlayerHandler.getPlayerID(victim);
    if(otherPIndex != -1 &amp;&amp; server.playerHandler.players[otherPIndex] != null) {
        client p = (client) server.playerHandler.players[otherPIndex];
        appendToBannedIP(p.connectedFrom);
    }
    System.out.println("Admin:"+playerName+" is IPbanning "+victim);
    sendMessage("Player "+victim+" successfully IP banned");
}</code></p>
<p>Thanks</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047/1</link>
        <pubDate>Thu, 25 Oct 2007 13:05:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-154047-1</guid>
        <source url="https://forum.moparisthebest.com/t/i-have-ipban-on-my-server-but-i-need-one-that-works/154047.rss">I have Ipban on my server, but I need one that works.!</source>
      </item>
  </channel>
</rss>
