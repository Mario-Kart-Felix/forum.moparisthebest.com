<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/ajax-comment-page/305198 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Aug 2019 09:45:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>AJAX Comment Page - General Programming - moparisthebest.com</title>
    <meta name="description" content="Due to the lack of decent suggestions for my ict project, I decided to make abrahams idea of a dynamic comment posting page for lulz. 

It&amp;#39;s not complete yet but the basic structure is done. I wont be doing any work on i&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="305198.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;AJAX Comment Page&#39;" href="305198.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/ajax-comment-page/305198" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/ajax-comment-page/305198" />
<meta property="og:title" content="AJAX Comment Page" />
<meta name="twitter:title" content="AJAX Comment Page" />
<meta property="og:description" content="Due to the lack of decent suggestions for my ict project, I decided to make abrahams idea of a dynamic comment posting page for lulz.  It’s not complete yet but the basic structure is done. I wont be doing any work on it today so feel free to contribute bits of code for extra stuff like bb code parsing, extra security etc, or just help me improve my existing code where I’ve done stuff like a retard.  [code=php]&lt;?php  mysql_connect(“localhost”, “username”, “password”);  mysql_select_db(“dbname”); ..." />
<meta name="twitter:description" content="Due to the lack of decent suggestions for my ict project, I decided to make abrahams idea of a dynamic comment posting page for lulz.  It’s not complete yet but the basic structure is done. I wont be doing any work on it today so feel free to contribute bits of code for extra stuff like bb code parsing, extra security etc, or just help me improve my existing code where I’ve done stuff like a retard.  [code=php]&lt;?php  mysql_connect(“localhost”, “username”, “password”);  mysql_select_db(“dbname”); ..." />
<meta property="article:published_time" content="2009-09-29T18:06:00+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="305198.html">AJAX Comment Page</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/inertia.html'><span itemprop='name'>inertia</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-09-29T18:06:00Z'>
            <time itemprop='dateModified' datetime='2016-07-31T11:22:20Z' class='post-time'>
              July 31, 2016, 11:22am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Due to the lack of decent suggestions for my ict project, I decided to make abrahams idea of a dynamic comment posting page for lulz.</p>
<p>It’s not complete yet but the basic structure is done. I wont be doing any work on it today so feel free to contribute bits of code for extra stuff like bb code parsing, extra security etc, or just help me improve my existing code where I’ve done stuff like a retard.</p>
<p>[code=php]&lt;?php</p>
<p>mysql_connect(“localhost”, “username”, “password”);<br>
mysql_select_db(“dbname”);</p>
<p>if(!empty($_REQUEST[‘post’])&amp;&amp;!empty($_REQUEST[‘author’])) {</p>
<p>$microtime = explode(" ", microtime());<br>
$microtime = $microtime[1];<br>
$author = mysql_real_escape_string($_REQUEST[‘author’]);<br>
$post = mysql_real_escape_string($_REQUEST[‘post’]);<br>
$ip = mysql_real_escape_string($_SERVER[‘REMOTE_ADDR’]);</p>
<p>$bounds = $microtime-10;</p>
<p>$query = mysql_query(“SELECT poster_ip FROM posts WHERE poster_ip = ‘$ip’ AND time_posted &gt;= $bounds LIMIT 1”);<br>
$rows = mysql_num_rows($query);<br>
if($rows == 0) {<br>
mysql_query(“INSERT INTO posts(author, body, time_posted, poster_ip) VALUES(’$author’, ‘$post’, ‘$microtime’, ‘$ip’)”) or die(mysql_error());<br>
echo date(“H:i M d Y”, $microtime);<br>
} if($rows == 1) {<br>
echo ‘ERROR_1’;<br>
}</p>
<p>die();<br>
}</p>
<p>echo ’</p>
  
    Board Index
    
      body {
        font-family: Tahoma;
        font-size: 14px;
      }
      #name {
        font-weight: bold;
        color: blue;
      }
      #name:hover {
        text-decoration: underline;
        cursor: pointer;
      }
      #time {
        color: gray;
      }
      #commentsModule {
        width: 400px;
      }
    
    
      function getXmlHttpRequestObject() {
        if (window.XMLHttpRequest) {
          return new XMLHttpRequest();
        } else if(window.ActiveXObject) {
          return new ActiveXObject("Microsoft.XMLHTTP");
        }
      }
      var xhro = getXmlHttpRequestObject();
      var postData = "";
      var postAuthor = "";
      function postComment() {
        if ((xhro.readyState == 4 || xhro.readyState == 0)) {
          postData = escape(document.getElementById("postBody").value);
          postAuthor = escape(document.getElementById("postAuthor").value);
          xhro.open("GET", "index.php?post=" + postData + "&amp;author=" + postAuthor, true);
          xhro.onreadystatechange = getPostResponse; 
          xhro.send(null);
        }
        return false;	
      }
      function getPostResponse() {
        if (xhro.readyState == 4) {
          if(xhro.responseText == "ERROR_1") {
            alert("Your last post was less than 10 seconds ago, please wait 10 seconds and try again.");
          } else {
            postData = str_replace("%0A", "<br>", postData);
            postData = unescape(postData);
            appendComment(postData, unescape(postAuthor), xhro.responseText);
          }
        }
      }
      function appendComment(postData, postAuthor, postTime) {
        var commentsDiv = document.getElementById("commentsModule");
        var noComments = document.getElementById("noComments");
        var postBodyInput = document.getElementById("postBody").value = "";
        var postAuthorInput = document.getElementById("postAuthor").value = "";
        commentsDiv.innerHTML = \'<span>\'+postAuthor+\'</span> <span>(\'+postTime+\')</span><br><span>\'+postData+\'</span><hr>\' + commentsDiv.innerHTML;
        postBodyInput.value = "";
        postAuthorInput.value = "";
        noComments.style.display = "none";
     }
     function str_replace (search, replace, subject, count) {
    var i = 0, j = 0, temp = \'\', repl = \'\', sl = 0, fl = 0,
            f = [].concat(search),
            r = [].concat(replace),
            s = subject,
            ra = r instanceof Array, sa = s instanceof Array;
    s = [].concat(s);
    if (count) {
        this.window[count] = 0;
    }
<pre><code>for (i=0, sl=s.length; i &lt; sl; i++) {
    if (s[i] === \'\') {
        continue;
    }
    for (j=0, fl=f.length; j &lt; fl; j++) {
        temp = s[i]+\'\';
        repl = ra ? (r[j] !== undefined ? r[j] : \'\') : r[0];
        s[i] = (temp).split(f[j]).join(repl);
        if (count &amp;&amp; s[i] !== temp) {
            this.window[count] += (temp.length-s[i].length)/f[j].length;}
    }
}
return sa ? s : s[0];
  }
  function checkLength(obj){
    var mlength = obj.getAttribute ? parseInt(obj.getAttribute("maxlength")) : ""
    if (obj.getAttribute &amp;&amp; obj.value.length &gt; mlength)
      obj.value = obj.value.substring(0, mlength)
  }
&lt;/script&gt;
</code></pre>
  
  ';
<p>echo ’<br>
<br>
</p><table>
<br>
<tr>
<br>
<td>
<br>
<br>
</td>
<br>
</tr>
<br>
<tr>
<br>
<td>
<br>
<b>Name</b> <br>
</td>
<br>
<td>
<br>
<br>
</td>
<br>
</tr>
<br>
</table><br>
';
<p>$query = mysql_query(“SELECT author, body, time_posted FROM posts ORDER BY time_posted DESC”);</p>
<p>if(mysql_num_rows($query) == 0) echo ‘<span>There are no comments to show</span>’;</p>
<p>while($rs = mysql_fetch_array($query)) {<br>
$rs[‘body’] = str_replace("\n", “<br>”, $rs[‘body’]);<br>
$postsContent .= ‘NULL<span>’.$rs[‘author’].’</span> <span>(’.date(“H:i M d Y”, $rs[‘time_posted’]).’)</span>’;<br>
$postsContent .= ‘<br><span>’.$rs[‘body’].’</span></p><hr>’;<br>
}
<p>$postsContent = trim($postsContent, “</p><hr>”);<br>
$postsContent = str_replace(“NULL”, “”, $postsContent);
<p>echo ‘</p><div>’.$postsContent.’</div>’;
<p>echo ’<br>
</p>
<pre><code>  //document.getElementById("postBody").value = "Write your message here...";

  function expandPostBody() {
    var postBody = document.getElementById("postBody");
    if(postBody.value == "") {
      postBody.rows = "2";
    }
  }
  function minimisePostBody() {
    var postBody = document.getElementById("postBody");
    if(postBody.value == "") {
      postBody.rows = "1";
    }
  }
  function calcPostBodySize() {
    var postBody = document.getElementById("postBody");
    var bodyContent = postBody.value;
    var lineCount = countChars("\n", bodyContent);
    if(lineCount == 1)
      lineCount = 2;
    if(lineCount &gt;= 10)
      lineCount = 10;
    postBody.rows = lineCount;
  }
  function countChars(characterToCount, origString) {
    var counter = 0;
    var myArray = origString.toLowerCase().split(\'\');
    for (i=0;i&lt;myArray.length;i++) {
      if (myArray[i] == characterToCount) {
        counter++;
      }
    }
    return counter;
  }
&lt;/script&gt;';
</code></pre>
<p>echo ’</p>
  
';
<p>?&gt;[/code]</p>
<p>Main features:</p>
<ul>
<li>Post appears on page without reload.</li>
<li>Post sent using AJAX (without the x…), where the users IP is checked so they can’t mass post (1post/10sec).</li>
<li>Line breaks are converted to br’s, also needs a html_special_chars function somewhere in there.</li>
<li>Basic database sanitization</li>
<li>Poster specifies name and body contents, and the server generates a timestamp to get the date from</li>
<li>Lots of other little shit that doesn’t deserve mentioning</li>
</ul>
<p>Table structure:</p>
<pre><code class="lang-auto">CREATE TABLE IF NOT EXISTS `posts` (
  `post_id` int(11) NOT NULL AUTO_INCREMENT,
  `parent_id` int(11) NOT NULL,
  `author` varchar(50) NOT NULL,
  `body` varchar(1005) NOT NULL,
  `time_posted` int(11) NOT NULL,
  `poster_ip` varchar(16) NOT NULL,
  PRIMARY KEY (`post_id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1;</code></pre>
      </div>

      <meta itemprop='headline' content='AJAX Comment Page'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cumescape.html'><span itemprop='name'>cumescape</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-09-29T18:42:11Z'>
            <time itemprop='dateModified' datetime='2016-07-31T11:22:21Z' class='post-time'>
              July 31, 2016, 11:22am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>No table structure?</p>
      </div>

      <meta itemprop='headline' content='AJAX Comment Page'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/inertia.html'><span itemprop='name'>inertia</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-09-29T19:57:07Z'>
            <time itemprop='dateModified' datetime='2016-07-31T11:22:28Z' class='post-time'>
              July 31, 2016, 11:22am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“cumescape, post:2, topic:305198”]No table structure?[/quote]Okay, I’ve updated the post. I’m sure it wouldn’t have been too demanding to work it out though… :rolleyes:</p>
<p>Also, parent_id isn’t used yet but I was planning on making it so you can make replies under certain comments.</p>
      </div>

      <meta itemprop='headline' content='AJAX Comment Page'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cumescape.html'><span itemprop='name'>cumescape</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-09-29T21:24:43Z'>
            <time itemprop='dateModified' datetime='2016-07-31T11:22:37Z' class='post-time'>
              July 31, 2016, 11:22am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>On lines 149 and 151 you can stop the error when no rows are in the DB from happening by adding a “@”.</p>
<p>It doesn’t post.</p>
      </div>

      <meta itemprop='headline' content='AJAX Comment Page'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/inertia.html'><span itemprop='name'>inertia</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-09-30T07:10:30Z'>
            <time itemprop='dateModified' datetime='2016-07-31T11:23:27Z' class='post-time'>
              July 31, 2016, 11:23am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“cumescape, post:4, topic:305198”]On lines 149 and 151 you can stop the error when no rows are in the DB from happening by adding a “@”.</p>
<p>It doesn’t post.[/quote]</p>
<p>That didn’t produce an error for me, you’re probably using a different PHP setup. I’ll add the @ to maintain portability.</p>
<p>About posting, try page.php?post=hi&amp;author=me and see what errors (if any) it gives. This just makes the post directly instead of going through JavaScript.</p>
      </div>

      <meta itemprop='headline' content='AJAX Comment Page'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/ajax-comment-page/305198 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 05 Aug 2019 09:45:59 GMT -->
</html>
