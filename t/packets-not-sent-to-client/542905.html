<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/packets-not-sent-to-client/542905 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 02:34:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Packets not sent to Client - Runescape - moparisthebest.com</title>
    <meta name="description" content="Whenever I try to log in to the Client, the message packet isn&amp;#39;t being sent for some reason. Any ideas?  

 package com.runescape.revised.logic.net.io;
import java.io.IOException;
import java.io.InputStream;
import java.&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="542905.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Packets not sent to Client&#39;" href="542905.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://i57.tinypic.com/2nqw1dv.png" />
<meta property="og:image" content="http://i57.tinypic.com/2nqw1dv.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/packets-not-sent-to-client/542905" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/packets-not-sent-to-client/542905" />
<meta property="og:title" content="Packets not sent to Client" />
<meta name="twitter:title" content="Packets not sent to Client" />
<meta property="og:description" content="Whenever I try to log in to the Client, the message packet isn’t being sent for some reason. Any ideas?  [CODE]  package com.runescape.revised.logic.net.io;  import java.io.IOException;  import java.io.InputStream;  import java.io.OutputStream;  import java.net.Socket;  import com.runescape.GameEngine;  import com.runescape.revised.logic.encryption.ISAACRandomGen;  import com.runescape.revised.logic.entity.Entity;  import com.runescape.revised.logic.entity.player.Player;  import com.runescape.re..." />
<meta name="twitter:description" content="Whenever I try to log in to the Client, the message packet isn’t being sent for some reason. Any ideas?  [CODE]  package com.runescape.revised.logic.net.io;  import java.io.IOException;  import java.io.InputStream;  import java.io.OutputStream;  import java.net.Socket;  import com.runescape.GameEngine;  import com.runescape.revised.logic.encryption.ISAACRandomGen;  import com.runescape.revised.logic.entity.Entity;  import com.runescape.revised.logic.entity.player.Player;  import com.runescape.re..." />
<meta property="article:published_time" content="2014-05-08T00:25:51+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="542905.html">Packets not sent to Client</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodrigues.html'><span itemprop='name'>Rodrigues</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-05-08T00:25:51Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:07:01Z' class='post-time'>
              August 4, 2016,  1:07pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Whenever I try to log in to the Client, the message packet isn’t being sent for some reason. Any ideas?</p>
<p>[CODE]<br>
package <a href="http://com.runescape.revised.logic.net.io/" rel="nofollow noopener">com.runescape.revised.logic.net.io</a>;</p>
<p>import java.io.IOException;<br>
import java.io.InputStream;<br>
import java.io.OutputStream;<br>
import java.net.Socket;</p>
<p>import com.runescape.GameEngine;<br>
import com.runescape.revised.logic.encryption.ISAACRandomGen;<br>
import com.runescape.revised.logic.entity.Entity;<br>
import com.runescape.revised.logic.entity.player.Player;<br>
import com.runescape.revised.logic.task.TaskSystem;</p>
<p>/**</p>
<ul>
<li>Represents a Thread for the Client</li>
<li>connecting to the Server.</li>
<li>
</li>
<li>
<span class="mention">@author</span> Josh</li>
<li>
</li>
</ul>
<p>*/<br>
public class ClientThread implements Runnable {</p>
<pre><code>private Socket socket;
private Thread clientThread;
// private LWThread&lt;Client&gt; clientThreadList = new LWThread&lt;Client&gt;(2000);
private InputStream inputStream;
private OutputStream outputStream;
private IoPacketBuffer inStream;
private IoPacketBuffer outStream;
private ISAACRandomGen inStreamDecryption;
private ISAACRandomGen outStreamDecryption;
private byte opcode;
private byte size;
private boolean isClientConnected = false;

/**
 * The constructor.
 * 
 * @param socket
 * 			The Socket we wish to connect
 * 			with.
 */
public ClientThread(final Socket socket) {
	this.setSocket(socket);
	this.setClientThread(new Thread(this));
	this.getClientThread().start();
	try {
		this.setInputStream(socket.getInputStream());
		this.setOutputStream(socket.getOutputStream());
	} catch (final IOException ioe) {
		ioe.printStackTrace();
	}
}

/*
 * (non-Javadoc)
 * @see java.lang.Runnable#run()
 */
@Override
public void run() {
	this.setOutStream(new IoPacketBuffer(new byte[100000]));
	this.getOutStream().setCurrentOffset(0);
	this.setInStream(new IoPacketBuffer(new byte[10000]));
	this.getInStream().setCurrentOffset(0);
	long serverSessionKey = ((long) (Math.random() * 99999999D) &lt;&lt; 32) + (long) (Math.random() * 99999999D);
	long clientSessionKey = 0;
	this.fillInStream(2);
	if (this.getInStream().readUnsignedByte() != 14) {
		return;
	}
	this.getInStream().readUnsignedByte();
	for (int i = 0; i &lt; 8; i++) {
		try {
			this.getOutputStream().write(0);
		} catch (final IOException ioe) {
			ioe.printStackTrace();
		}
	}
	try {
		this.getOutputStream().write(0);
	} catch (final IOException ioe) {
		ioe.printStackTrace();
	}
	this.getOutStream().writeQWord(serverSessionKey);
	this.flushOutStream();
	this.fillInStream(2);
	final int loginType = this.getInStream().readUnsignedByte();
	if ((loginType != 16) &amp;&amp; (loginType != 18)) {
		return;
	}
	final int loginPacketSize = this.getInStream().readUnsignedByte();
	int loginEncryptPacketSize = loginPacketSize - 40;
	if (loginEncryptPacketSize &lt;= 0) {
		return;
	}
	this.fillInStream(loginPacketSize);
	if (this.getInStream().readUnsignedByte() != 255) {
		return;
	}
	final short revision = (short) this.getInStream().readUnsignedWord();
	if (revision != 317) {
		System.out.println("Revision is not 317.");
		return;
	}
	/* switch (revision) {
		case 317:
			System.out.println("Revision #317 supported!");
			new Login317();
			break;
		case 474:
			System.out.println("Revision #474 supported!");
			new Login474();
			break;
		case 562:
			System.out.println("Revision #562 supported!");
			new Login562();
			break;
		default:
			System.out.println("No revision supported!");
			break;
		} */
	this.getInStream().readUnsignedByte(); // memory.
	for (int i = 0; i &lt; 9; i++) {
		Integer.toHexString(this.getInStream().readDWord());
	}
	loginEncryptPacketSize--;
	int tmp = this.getInStream().readUnsignedByte();
	if (loginEncryptPacketSize != tmp) {
		return;
	}
	tmp = this.getInStream().readUnsignedByte();
	if (tmp != 10) {
		return;
	}
	clientSessionKey = this.getInStream().readQWord();
	serverSessionKey = this.getInStream().readQWord();
	@SuppressWarnings("unused")
	final int userID = this.getInStream().readDWord();
	final String name = this.getInStream().readString();
	@SuppressWarnings("unused")
	final String password = this.getInStream().readString();
	final int[] sessionKey = new int[4];
	sessionKey[0] = (int) (clientSessionKey &gt;&gt; 32);
	sessionKey[1] = (int) clientSessionKey;
	sessionKey[2] = (int) (serverSessionKey &gt;&gt; 32);
	sessionKey[3] = (int) serverSessionKey;
	for (int i = 0; i &lt; 4; i++) {
		Integer.toHexString(sessionKey[i]);
	}
	this.setInStreamDecryption(new ISAACRandomGen(sessionKey));
	for (byte i = 0; i &lt; 4; i++) {
		sessionKey[i] += 50;
	}
	for (byte i = 0; i &lt; 4; i++) {
		Integer.toHexString(sessionKey[i]);
	}
	this.setOutStreamDecryption(new ISAACRandomGen(sessionKey));
	this.getOutStream().setPacketEncryption(this.getOutStreamDecryption());
	try {
		this.getOutputStream().write(2);
		this.getOutputStream().write(0);
		this.getOutputStream().write(0);
	} catch (final IOException ioe) {
		ioe.printStackTrace();
	}
	// this.getOutStream().createFrame(249);
	// this.getOutStream().writeByteA(1);
	// this.getOutStream().writeWordA(1);
	// this.getOutStream().createFrame(107);
	this.getOutStream().createFrame(253);
	this.getOutStream().writeString("Welcome to RS3 Newstart!");
	this.setOpcode((byte) -1);
	this.setSize((byte) 0);
	this.setClientConnected(true);
	final Entity player = new Player(name);
	new TaskSystem(player, this.getOutStream());
	final GameEngine gameEngine = new GameEngine((Player) player);
	gameEngine.getPlayerList().add((Player) player);
}

public boolean parsePackets() {
	try {
		int avail = this.getInputStream().available();
		if (avail == 0) {
			return false;
		}
		// Important note: doesn't work yet because we don't know the lengths of any possible
		// incoming packets so we can't parse them and might miss the one or other ending up
		// with screwing the encryption
		if (this.getOpcode() == -1) {
			this.setOpcode((byte) (this.getInputStream().read() &amp; 0xff));
			if (this.getInStreamDecryption() != null) {
				this.setOpcode((byte) ((this.getOpcode() - this.getInStreamDecryption().getNextKey()) &amp; 0xff));
			}
			avail--;
			this.setSize((byte) avail);
		}
		this.fillInStream(this.getSize());
		this.setOpcode((byte) -1);
	} catch (final Exception e) {
		e.printStackTrace();
		this.setClientConnected(false);
	}
	return true;
}

public void flushOutStream() {
	try {
		this.getOutputStream().write(this.getOutStream().getBuffer(), 0, this.getOutStream().currentOffset);
	} catch (final IOException ioe) {
		ioe.printStackTrace();
	}
	this.getOutStream().setCurrentOffset(0);
}

public void fillInStream(final int forceRead) {
	this.getInStream().setCurrentOffset(0);
	try {
		this.getInputStream().read(this.getInStream().getBuffer(), 0, forceRead);
	} catch (final IOException ioe) {
		ioe.printStackTrace();
	}
}

public void setSocket(final Socket socket) {
	this.socket = socket;
}

public Socket getSocket() {
	return this.socket;
}

public void setClientThread(final Thread clientThread) {
	this.clientThread = clientThread;
}

public Thread getClientThread() {
	return this.clientThread;
}

public void setInputStream(final InputStream inputStream) {
	this.inputStream = inputStream;
}

public InputStream getInputStream() {
	return this.inputStream;
}

public void setOutputStream(final OutputStream outputStream) {
	this.outputStream = outputStream;
}

public OutputStream getOutputStream() {
	return this.outputStream;
}

public void setInStream(final IoPacketBuffer inStream) {
	this.inStream = inStream;
}

public IoPacketBuffer getInStream() {
	return this.inStream;
}

public void setOutStream(final IoPacketBuffer outStream) {
	this.outStream = outStream;
}

public IoPacketBuffer getOutStream() {
	return this.outStream;
}

public void setInStreamDecryption(final ISAACRandomGen inStreamDecryption) {
	this.inStreamDecryption = inStreamDecryption;
}

public ISAACRandomGen getInStreamDecryption() {
	return this.inStreamDecryption;
}

public void setOutStreamDecryption(final ISAACRandomGen outStreamDecryption) {
	this.outStreamDecryption = outStreamDecryption;
}

public ISAACRandomGen getOutStreamDecryption() {
	return this.outStreamDecryption;
}

public void setOpcode(final byte opcode) {
	this.opcode = opcode;
}

public byte getOpcode() {
	return this.opcode;
}

public void setSize(final byte size) {
	this.size = size;
}

public byte getSize() {
	return this.size;
}

public void setClientConnected(final boolean isClientConnected) {
	this.isClientConnected = isClientConnected;
}

public boolean isClientConnected() {
	return this.isClientConnected;
}
</code></pre>
<p>}<br>
[/CODE]<br>
The message “Welcome to RS3 Newstart!” isn’t displaying. All I get is the following image:<br>
<img src="http://i57.tinypic.com/2nqw1dv.png" alt width="" height=""></p>
<p>Can anyone also tell me why the update masks server-sided have a special order they go in? Doesn’t make much sense to me at all.</p>
      </div>

      <meta itemprop='headline' content='Packets not sent to Client'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/ExtremeX-Scape.html'><span itemprop='name'>ExtremeX-Scape</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-05-08T01:37:29Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:07:01Z' class='post-time'>
              August 4, 2016,  1:07pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <ol>
<li>
<p>You must send the initial sector upon successful login in order to be able to successfully send a chat-box message.</p>
</li>
<li>
<p>Everything you do when writing information to the client must match the order that it is read in, including masks even though they do not seem order dependent.</p>
</li>
</ol>
<p>iirc the masks current state changes whenever the client checks for an update, for example we send an appearance update, the masks value is let’s say for example 50 (cba to check) as the client checks for a mask update each failed check the masks state changes and the client then expects a new mask value (if succeeded) for the next mask, wash, rinse, repeat until we get to the appearance mask, which then gets handled appropriately (assuming the client is unmodified, of course).</p>
      </div>

      <meta itemprop='headline' content='Packets not sent to Client'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodrigues.html'><span itemprop='name'>Rodrigues</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-05-08T13:00:30Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:07:05Z' class='post-time'>
              August 4, 2016,  1:07pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Never mind. I got it to work. Close please.</p>
      </div>

      <meta itemprop='headline' content='Packets not sent to Client'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/packets-not-sent-to-client/542905 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 02:34:57 GMT -->
</html>
