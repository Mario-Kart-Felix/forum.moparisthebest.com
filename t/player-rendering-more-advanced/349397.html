<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/player-rendering-more-advanced/349397 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 18:26:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Player Rendering [More Advanced] - Runescape - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m using the &amp;quot;Fly thought runescape&amp;quot; source and trying to have the player rendered but so far, have failed. This is why. 

Error: Error packet size mismatch in getplayer pos:7 psize:8

 

Error: T2 - 81,73,-1 - 8,3040,3&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="349397.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Player Rendering [More Advanced]&#39;" href="349397.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/player-rendering-more-advanced/349397" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/player-rendering-more-advanced/349397" />
<meta property="og:title" content="Player Rendering [More Advanced]" />
<meta name="twitter:title" content="Player Rendering [More Advanced]" />
<meta property="og:description" content="I’m using the “Fly thought runescape” source and trying to have the player rendered but so far, have failed. This is why.  Error: Error packet size mismatch in getplayer pos:7 psize:8 Error: T2 - 81,73,-1 - 8,3040,3192 - 0,64,0,6,-1,67,-4,-28, Error: Error packet size mismatch in getplayer pos:11 psize:10  Error: T2 - 81,73,-1 - 10,3072,3224 - -26,-127,0,6,-1,67,-4,-28,0,64,  Error: Error packet size mismatch in getplayer pos:14 psize:12  Error: T2 - 81,73,-1 - 12,3072,3224 - -26,-127,0,6,-1,67,..." />
<meta name="twitter:description" content="I’m using the “Fly thought runescape” source and trying to have the player rendered but so far, have failed. This is why.  Error: Error packet size mismatch in getplayer pos:7 psize:8 Error: T2 - 81,73,-1 - 8,3040,3192 - 0,64,0,6,-1,67,-4,-28, Error: Error packet size mismatch in getplayer pos:11 psize:10  Error: T2 - 81,73,-1 - 10,3072,3224 - -26,-127,0,6,-1,67,-4,-28,0,64,  Error: Error packet size mismatch in getplayer pos:14 psize:12  Error: T2 - 81,73,-1 - 12,3072,3224 - -26,-127,0,6,-1,67,..." />
<meta property="article:published_time" content="2010-07-16T12:50:20+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="349397.html">Player Rendering [More Advanced]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Epic_Steve.html'><span itemprop='name'>Epic_Steve</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-07-16T12:50:20Z'>
            <time itemprop='dateModified' datetime='2016-07-31T17:51:02Z' class='post-time'>
              July 31, 2016,  5:51pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m using the “Fly thought runescape” source and trying to have the player rendered but so far, have failed. This is why.</p>
<blockquote>Error: Error packet size mismatch in getplayer pos:7 psize:8
Error: T2 - 81,73,-1 - 8,3040,3192 - 0,64,0,6,-1,67,-4,-28,
<p>Error: Error packet size mismatch in getplayer pos:11 psize:10<br>
Error: T2 - 81,73,-1 - 10,3072,3224 - -26,-127,0,6,-1,67,-4,-28,0,64,</p>
<p>Error: Error packet size mismatch in getplayer pos:14 psize:12<br>
Error: T2 - 81,73,-1 - 12,3072,3224 - -26,-127,0,6,-1,67,-4,-28,0,64,0,0,</p>
</blockquote>
<p>Here is my source code for rendering the player.</p>
<pre><code class="lang-auto">            outStream.createFrame(81);
            outStream.writeWord(0);
            int ofs = outStream.currentOffset;
            outStream.initBitAccess();

            // method117(Stream stream)
            int updateType = 3;
            outStream.writeBits(1, 1); // Updating Player, 1 = TRUE; 0 = FALSE
            outStream.writeBits(2, updateType);

            if (updateType == 3) {
                outStream.writeBits(2, 0);
                outStream.writeBits(1, 1);
                outStream.writeBits(1, 1);
                outStream.writeBits(7, 0x20);
                outStream.writeBits(7, 0x20);
            } else if (updateType == 2) {
                outStream.writeBits(3, -1); // Direction
                outStream.writeBits(3, -1); // Direction
                outStream.writeBits(1, 1);
            } else if (updateType == 1) {
                outStream.writeBits(3, -1); // Direction
            }
            // method134(Stream stream)
            int k1 = 2;
            outStream.writeBits(8, 0); // Players
            outStream.writeBits(1, 1);
            outStream.writeBits(2, k1);

            if (k1 == 1) {
                outStream.writeBits(3, -1); // Direction
                outStream.writeBits(1, 1);
            } else if (k1 == 2) {
                outStream.writeBits(3, -1); // Direction
                outStream.writeBits(3, -1); // Direction
                outStream.writeBits(1, 1);
            }

            outStream.writeBits(11, id);
            outStream.writeBits(1, 1); //TODO: TEST 0
            outStream.writeBits(1, 1);
            outStream.writeBits(5, 25);
            outStream.writeBits(5, 25);
            outStream.finishBitAccess();
            
            outStream.writeWord(0x40);
//            outStream.writeWord(0x40 &gt;&gt; 8);
             outStream.writeWord(0);
            outStream.writeFrameSizeWord(outStream.currentOffset - ofs);</code></pre>
<p>These go respectively with these methods from the client.</p>
<pre><code class="lang-auto">private void method117(Stream stream)
    {
        stream.initBitAccess();
        int j = stream.readBits(1);
        if(j == 0)
            return;
        int k = stream.readBits(2);
        if(k == 0)
        {
            anIntArray894[anInt893++] = myPlayerIndex;
            return;
        }
        if(k == 1)
        {
            int l = stream.readBits(3);
            myPlayer.moveInDir(false, l);
            int k1 = stream.readBits(1);
            if(k1 == 1)
                anIntArray894[anInt893++] = myPlayerIndex;
            return;
        }
        if(k == 2)
        {
            int i1 = stream.readBits(3);
            myPlayer.moveInDir(true, i1);
            int l1 = stream.readBits(3);
            myPlayer.moveInDir(true, l1);
            int j2 = stream.readBits(1);
            if(j2 == 1)
                anIntArray894[anInt893++] = myPlayerIndex;
            return;
        }
        if(k == 3)
        {
            plane = stream.readBits(2);
            int j1 = stream.readBits(1);
            int i2 = stream.readBits(1);
            if(i2 == 1)
                anIntArray894[anInt893++] = myPlayerIndex;
            int k2 = stream.readBits(7);
            int l2 = stream.readBits(7);
            myPlayer.setPos(l2, k2, j1 == 1);
        }
    }</code></pre>
<pre><code class="lang-auto">private void method134(Stream stream)
    {
        int j = stream.readBits(8);
        if(j &lt; playerCount)
        {
            for(int k = j; k &lt; playerCount; k++)
                anIntArray840[anInt839++] = playerIndices[k];

        }
        if(j &gt; playerCount)
        {
            signlink.reporterror(myUsername + " Too many players" + j + "&gt;" + playerCount);
            throw new RuntimeException("eek");
        }
        playerCount = 0;
        for(int l = 0; l &lt; j; l++)
        {
            int i1 = playerIndices[l];
            Player player = playerArray[i1];
            int j1 = stream.readBits(1);
            if(j1 == 0)
            {
                playerIndices[playerCount++] = i1;
                player.anInt1537 = loopCycle;
            } else
            {
                int k1 = stream.readBits(2);
                if(k1 == 0)
                {
                    playerIndices[playerCount++] = i1;
                    player.anInt1537 = loopCycle;
                    anIntArray894[anInt893++] = i1;
                } else
                if(k1 == 1)
                {
                    playerIndices[playerCount++] = i1;
                    player.anInt1537 = loopCycle;
                    int l1 = stream.readBits(3);
                    player.moveInDir(false, l1);
                    int j2 = stream.readBits(1);
                    if(j2 == 1)
                        anIntArray894[anInt893++] = i1;
                } else
                if(k1 == 2)
                {
                    playerIndices[playerCount++] = i1;
                    player.anInt1537 = loopCycle;
                    int i2 = stream.readBits(3);
                    player.moveInDir(true, i2);
                    int k2 = stream.readBits(3);
                    player.moveInDir(true, k2);
                    int l2 = stream.readBits(1);
                    if(l2 == 1)
                        anIntArray894[anInt893++] = i1;
                } else
                if(k1 == 3)
                    anIntArray840[anInt839++] = i1;
            }
        }
    }</code></pre>
<pre><code class="lang-auto">private void method91(Stream stream, int i)
    {
        while(stream.bitPosition + 10 &lt; i * 8)
        {
		System.out.println("Add Player");
            int j = stream.readBits(11);
            if(j == 2047)
                break;
            if(playerArray[j] == null)
            {
                playerArray[j] = new Player();
                if(aStreamArray895s[j] != null)
                    playerArray[j].updatePlayer(aStreamArray895s[j]);
            }
            playerIndices[playerCount++] = j;
		 System.out.println("PLAYERS: " + playerCount);
            Player player = playerArray[j];
            player.anInt1537 = loopCycle;
            int k = stream.readBits(1);
            if(k == 1)
                anIntArray894[anInt893++] = j;
            int l = stream.readBits(1);
            int i1 = stream.readBits(5);
            if(i1 &gt; 15)
                i1 -= 32;
            int j1 = stream.readBits(5);
            if(j1 &gt; 15)
                j1 -= 32;
            player.setPos(myPlayer.smallX[0] + j1, myPlayer.smallY[0] + i1, l == 1);
		System.out.println("POSX: " + myPlayer.smallX[0] + j1);
        }
        stream.finishBitAccess();
    }</code></pre>
<pre><code class="lang-auto">private void method49(Stream stream)
    {
        for(int j = 0; j &lt; anInt893; j++)
        {
            int k = anIntArray894[j];
            Player player = playerArray[k];
            int l = stream.readUnsignedByte();
            if((l &amp; 0x40) != 0)
                l += stream.readUnsignedByte() &lt;&lt; 8;
            method107(l, k, stream, player);
        }

    }</code></pre>
<p>Which links us to this update method in the client.</p>
<pre><code class="lang-auto">private void method107(int i, int j, Stream stream, Player player)
    {
        if((i &amp; 0x400) != 0)
        {
            player.anInt1543 = stream.method428();
            player.anInt1545 = stream.method428();
            player.anInt1544 = stream.method428();
            player.anInt1546 = stream.method428();
            player.anInt1547 = stream.method436() + loopCycle;
            player.anInt1548 = stream.method435() + loopCycle;
            player.anInt1549 = stream.method428();
            player.method446();
        }
        if((i &amp; 0x100) != 0)
        {
            player.anInt1520 = stream.method434();
            int k = stream.readDWord();
            player.anInt1524 = k &gt;&gt; 16;
            player.anInt1523 = loopCycle + (k &amp; 0xffff);
            player.anInt1521 = 0;
            player.anInt1522 = 0;
            if(player.anInt1523 &gt; loopCycle)
                player.anInt1521 = -1;
            if(player.anInt1520 == 65535)
                player.anInt1520 = -1;
        }
        if((i &amp; 8) != 0)
        {
            int l = stream.method434();
            if(l == 65535)
                l = -1;
            int i2 = stream.method427();
            if(l == player.anim &amp;&amp; l != -1)
            {
                int i3 = Animation.anims[l].anInt365;
                if(i3 == 1)
                {
                    player.anInt1527 = 0;
                    player.anInt1528 = 0;
                    player.anInt1529 = i2;
                    player.anInt1530 = 0;
                }
                if(i3 == 2)
                    player.anInt1530 = 0;
            } else
            if(l == -1 || player.anim == -1 || Animation.anims[l].anInt359 &gt;= Animation.anims[player.anim].anInt359)
            {
                player.anim = l;
                player.anInt1527 = 0;
                player.anInt1528 = 0;
                player.anInt1529 = i2;
                player.anInt1530 = 0;
                player.anInt1542 = player.smallXYIndex;
            }
        }
        if((i &amp; 4) != 0)
        {
            player.textSpoken = stream.readString();
            if(player.textSpoken.charAt(0) == '~')
            {
                player.textSpoken = player.textSpoken.substring(1);
                pushMessage(player.textSpoken, 2, player.name);
            } else
            if(player == myPlayer)
                pushMessage(player.textSpoken, 2, player.name);
            player.anInt1513 = 0;
            player.anInt1531 = 0;
            player.textCycle = 150;
        }
        if((i &amp; 0x80) != 0)
        {
            int i1 = stream.method434();
            int j2 = stream.readUnsignedByte();
            int j3 = stream.method427();
            int k3 = stream.currentOffset;
            if(player.name != null &amp;&amp; player.visible)
            {
                long l3 = TextClass.longForName(player.name);
                boolean flag = false;
                if(j2 &lt;= 1)
                {
                    for(int i4 = 0; i4 &lt; ignoreCount; i4++)
                    {
                        if(ignoreListAsLongs[i4] != l3)
                            continue;
                        flag = true;
                        break;
                    }

                }
                if(!flag &amp;&amp; anInt1251 == 0)
                    try
                    {
                        aStream_834.currentOffset = 0;
                        stream.method442(j3, 0, aStream_834.buffer);
                        aStream_834.currentOffset = 0;
                        String s = TextInput.method525(j3, aStream_834);
                        s = Censor.doCensor(s);
                        player.textSpoken = s;
                        player.anInt1513 = i1 &gt;&gt; 8;
	                    player.privelage = j2;

                        //entityMessage(player);
	
                        player.anInt1531 = i1 &amp; 0xff;
                        player.textCycle = 150;
                        if(j2 == 2 || j2 == 3)
                            pushMessage(s, 1, "@cr2@" + player.name);
                        else
                        if(j2 == 1)
                            pushMessage(s, 1, "@cr1@" + player.name);
                        else
                            pushMessage(s, 2, player.name);
                    }
                    catch(Exception exception)
                    {
                        signlink.reporterror("cde2");
                    }
            }
            stream.currentOffset = k3 + j3;
        }
        if((i &amp; 1) != 0)
        {
            player.interactingEntity = stream.method434();
            if(player.interactingEntity == 65535)
                player.interactingEntity = -1;
        }
        if((i &amp; 0x10) != 0)
        {
            int j1 = stream.method427();
            byte abyte0[] = new byte[j1];
            Stream stream_1 = new Stream(abyte0);
            stream.readBytes(j1, 0, abyte0);
            aStreamArray895s[j] = stream_1;
            player.updatePlayer(stream_1);
        }
        if((i &amp; 2) != 0)
        {
            player.anInt1538 = stream.method436();
            player.anInt1539 = stream.method434();
        }
        if((i &amp; 0x20) != 0)
        {
            int k1 = stream.readUnsignedByte();
            int k2 = stream.method426();
            player.updateHitData(k2, k1, loopCycle);
            player.loopCycleStatus = loopCycle + 300;
            player.currentHealth = stream.method427();
            player.maxHealth = stream.readUnsignedByte();
        }
        if((i &amp; 0x200) != 0)
        {
            int l1 = stream.readUnsignedByte();
            int l2 = stream.method428();
            player.updateHitData(l2, l1, loopCycle);
            player.loopCycleStatus = loopCycle + 300;
            player.currentHealth = stream.readUnsignedByte();
            player.maxHealth = stream.method427();
        }
    }</code></pre>
<p>I’ve tryed to write the correct bytes when the client requests them, maybe there’s something obvious I’ve missed out, but I can’t seem to see why I’m getting a packet size mismatch.</p>
<p>Thanks.</p>
      </div>

      <meta itemprop='headline' content='Player Rendering [More Advanced]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/player-rendering-more-advanced/349397 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 18:26:53 GMT -->
</html>
