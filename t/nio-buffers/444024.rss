<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>NIO Buffers</title>
    <link>https://forum.moparisthebest.com/t/nio-buffers/444024</link>
    <description>I was just wondering on the correct usage of buffers with java.nio. I have a PacketFactory object that creates an object to be written to the client socket. The problem is, I can&#39;t recall if this is the best way, or if using one ByteBuffer object is correct.

[code=Java]
public class PacketBuilder {
    private final byte[] data;
    private int position;

    // ...
    public void build() {
        return ByteBuffer.wrap(data, 0, position);
    }
}
[/code]
[code=Java]
public ByteBuffer createSomePacket(final Client client) {
    builder.put(blahblahblah);
    //
    return builder.build();// returns the wrapped  ByteBuffer
}
[/code]

Or if I should create one buffer, specific to each client, and write the data directly to that.</description>
    
    <lastBuildDate>Wed, 06 Jun 2012 17:57:49 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/nio-buffers/444024.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@slavemaster veer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/slavemaster">@slavemaster</a> wrote:</p>
          <blockquote>
              <p>Buffering your output should only happen in the rare circumstance that a write operation on the socket would block. In the case that write() returns a value less than the total data you attempted to send, register interest in write-readiness (in NIO you’d use SelectionKey.interestOps(OP_WRITE)) and react until your message is fully sent. Avoid registering write-readiness interest preemptively as socket’s are nearly always write-ready and thus your event loop will spin needlessly.</p>
<p>For reading data, on the other hand, you ought to avoid copying data from buffer to buffer any more than you need to… ideally, the only memory copy should be from the socket’s underlying input buffer to a user-level buffer which you can utilize to decode incoming game events. While some may suggest you use a pool of buffers and do all decoding independently of the net code, you might have to worry about excessive overhead.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/26">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/26</link>
        <pubDate>Wed, 06 Jun 2012 17:57:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-26</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@iKilem iKilem]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ikilem">@iKilem</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="21" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/_js5/40/4297_1.png" class="avatar"> _js5:</div>
<blockquote>
<p>RT3-1 the delta time for the game engine is 20 ms, so 5 packets approximately 20 ms ~= 150 packets a tick.</p>
</blockquote>
</aside>
<p>My bad. I was wrong about outgoing packets as well, unless there’s something else I’m forgetting :o.</p>
<aside class="quote" data-post="22" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/zyle1992/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> zyle1992:</div>
<blockquote>
<p>If all it was doing was parsing packets. Because it has to parse them, process them, and produce the result, it would take significantly longer.</p>
</blockquote>
</aside>
<p>The client tries to make up for delays if that’s what you mean.</p>
<p><span class="mention">@Taharok</span>: When he said “tick”, he meant 600ms (server-side). (600/20)*5=150</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/25">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/25</link>
        <pubDate>Wed, 06 Jun 2012 11:01:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-25</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@mod_taharok Taharok]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mod_taharok">@mod_taharok</a> wrote:</p>
          <blockquote>
              <p>Dunno where js5 came up with 150 packets/tick. It should be 150-250, depending on what rate the client is running at. At a 20ms delta, that’s 50 frames per second, with a maximum of 5 packet consumptions per tick, leading to a maximum of 250 packets per second. If it’s running at 30 frames per second, that’s 150 packets per second.</p>
<p>Please be sure to separate the idea of a “frame” and a “tick.”</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/24">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/24</link>
        <pubDate>Wed, 06 Jun 2012 04:36:54 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-24</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>[quote=“zyle1992, post:22, topic:444024”][quote author=_js5 link=topic=546710.msg4008973#msg4008973 date=1338947157]<br>
RT3-1 the delta time for the game engine is 20 ms, so 5 packets approximately 20 ms ~= 150 packets a tick.</p>
<p>[/quote]</p>
<p>If all it was doing was parsing packets. Because it has to parse them, process them, and produce the result, it would take significantly longer.[/quote]</p>
<p>I’m sure with the older clients it doesn’t take that long.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/23">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/23</link>
        <pubDate>Wed, 06 Jun 2012 02:36:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-23</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@zyle1992 Zymus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zyle1992">@zyle1992</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="21" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/_js5/40/4297_1.png" class="avatar"> _js5:</div>
<blockquote>
<p>RT3-1 the delta time for the game engine is 20 ms, so 5 packets approximately 20 ms ~= 150 packets a tick.</p>
</blockquote>
</aside>
<p>If all it was doing was parsing packets. Because it has to parse them, process them, and produce the result, it would take significantly longer.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/22">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/22</link>
        <pubDate>Wed, 06 Jun 2012 02:17:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-22</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@_js5 _js5]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_js5">@_js5</a> wrote:</p>
          <blockquote>
              <p>RT3-1 the delta time for the game engine is 20 ms, so 5 packets approximately 20 ms ~= 150 packets a tick.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/21</link>
        <pubDate>Wed, 06 Jun 2012 01:45:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-21</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@imsuperman05 imsuperman05]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imsuperman05">@imsuperman05</a> wrote:</p>
          <blockquote>
              <p>My bad, I read it as a 9 on this 317 deob client when it is an 5.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/20</link>
        <pubDate>Wed, 06 Jun 2012 01:40:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-20</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@_js5 _js5]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_js5">@_js5</a> wrote:</p>
          <blockquote>
              <pre><code class="lang-auto">for(int j = 0; j &lt; 5; j++)
    if(!parsePackets(true))
        break;</code></pre>
<p>RT3-1 - 5</p>
<pre><code class="lang-auto">for (int i_0_ = 0; (i_0_ ^ 0xffffffff) &gt; -101; i_0_++) {
    if (!Class292.parsePacket((byte) -52))
        break;
}</code></pre>
<p>RT5 - 100</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/19</link>
        <pubDate>Wed, 06 Jun 2012 01:37:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-19</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@imsuperman05 imsuperman05]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imsuperman05">@imsuperman05</a> wrote:</p>
          <blockquote>
              <p>[quote=“iKilem, post:15, topic:444024”][quote author=Davidi2 link=topic=546710.msg4008051#msg4008051 date=1338863700]<br>
Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.<br>
[/quote]<br>
I’m pretty sure it’s every 200ms for the client regardless of the server’s cycle rate, but looking at the client again, up to 5 packets can be read (if available) every cycle. I can’t be bothered to confirm whether it’s 200ms, but I know that’s the case for outgoing packets and it looks like the code for reading incoming packets is in the same loop.[/quote]<br>
I believe it’s 9 packets that can be read (if available) every cycle?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/18</link>
        <pubDate>Wed, 06 Jun 2012 01:33:04 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-18</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@_s11 s1gma]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_s11">@_s11</a> wrote:</p>
          <blockquote>
              <p>[quote=“Davidi2, post:16, topic:444024”][quote author=iKilem link=topic=546710.msg4008286#msg4008286 date=1338894944]</p>
<aside class="quote">
<blockquote>
<p>Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.</p>
</blockquote>
</aside>
<p>I’m pretty sure it’s every 200ms for the client regardless of the server’s cycle rate, but looking at the client again, up to 5 packets can be read (if available) every cycle. I can’t be bothered to confirm whether it’s 200ms, but I know that’s the case for outgoing packets and it looks like the code for reading incoming packets is in the same loop.<br>
[/quote]Ah, that makes sense. I knew the client had its own loop, which is what I was basing my logic off of. Either way I think it’s not that important <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>[quote author=s1gma link=topic=546710.msg4008106#msg4008106 date=1338867719]</p>
<p>[quote author=Davidi2 link=topic=546710.msg4008051#msg4008051 date=1338863700]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
</blockquote>
</aside>
<p>Buffer it to the write output byte array directly<br>
[/quote]I think its much more organized to have a packet builder[buffer] outside of the write buffer.</p>
</blockquote>
</aside>
<p>packet building logic really should be separated for both cleanliness and safety (manually shoving it into a buffer could prove costly if you accidentally start sending malformed packets).<br>
[/quote]That’s what I said right? Cant tell if you’re arguing or agreeing xD[/quote]clarifying, since you sounded unsure with ‘I think’ <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/17</link>
        <pubDate>Tue, 05 Jun 2012 20:29:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-17</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>[quote=“iKilem, post:15, topic:444024”][quote author=Davidi2 link=topic=546710.msg4008051#msg4008051 date=1338863700]<br>
Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.<br>
[/quote]<br>
I’m pretty sure it’s every 200ms for the client regardless of the server’s cycle rate, but looking at the client again, up to 5 packets can be read (if available) every cycle. I can’t be bothered to confirm whether it’s 200ms, but I know that’s the case for outgoing packets and it looks like the code for reading incoming packets is in the same loop.[/quote]Ah, that makes sense. I knew the client had its own loop, which is what I was basing my logic off of. Either way I think it’s not that important <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>[quote=“s1gma, post:14, topic:444024”][quote author=Davidi2 link=topic=546710.msg4008051#msg4008051 date=1338863700]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
</blockquote>
</aside>
<p>Buffer it to the write output byte array directly<br>
[/quote]I think its much more organized to have a packet builder[buffer] outside of the write buffer.</p>
</blockquote>
</aside>
<p>packet building logic really should be separated for both cleanliness and safety (manually shoving it into a buffer could prove costly if you accidentally start sending malformed packets).[/quote]That’s what I said right? Cant tell if you’re arguing or agreeing xD</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/16</link>
        <pubDate>Tue, 05 Jun 2012 19:54:09 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-16</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@iKilem iKilem]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ikilem">@iKilem</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="10" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/davidi2/40/2579_1.png" class="avatar"> Davidi2:</div>
<blockquote>
<p>Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.</p>
</blockquote>
</aside>
<p>I’m pretty sure it’s every 200ms for the client regardless of the server’s cycle rate, but looking at the client again, up to 5 packets can be read (if available) every cycle. I can’t be bothered to confirm whether it’s 200ms, but I know that’s the case for outgoing packets and it looks like the code for reading incoming packets is in the same loop.</p>
<aside class="quote" data-post="13" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>No; it would NOT be wise because with latency issues the variance in the state of clients would be astounding. Everyone should be informed of what is happening relative to whoever is also listening for information.</p>
</blockquote>
</aside>
<p>Certain packets can be sent immedietely, though. For example, when entering your bank pin.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/15</link>
        <pubDate>Tue, 05 Jun 2012 11:15:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-15</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@_s11 s1gma]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_s11">@_s11</a> wrote:</p>
          <blockquote>
              <p>[quote=“Davidi2, post:10, topic:444024”][quote author=sinisoul link=topic=546710.msg4008036#msg4008036 date=1338862138]</p>
<aside class="quote">
<blockquote>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
</blockquote>
</aside>
<p>Buffer it to the write output byte array directly<br>
[/quote]I think its much more organized to have a packet builder[buffer] outside of the write buffer.[/quote]<br>
packet building logic really should be separated for both cleanliness and safety (manually shoving it into a buffer could prove costly if you accidentally start sending malformed packets).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/14</link>
        <pubDate>Tue, 05 Jun 2012 03:41:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-14</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="12" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/imsuperman05/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> imsuperman05:</div>
<blockquote>
<p>I think you should send out the packet right away, instead of queuing it and sending it in the next cycle.  That way you won’t have any sort of delay when the client wants to read a packet.  It might cause some other problems, depending on your design.</p>
</blockquote>
</aside>
<p>No; it would NOT be wise because with latency issues the variance in the state of clients would be astounding. Everyone should be informed of what is happening relative to whoever is also listening for information.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/13</link>
        <pubDate>Tue, 05 Jun 2012 03:35:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-13</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@imsuperman05 imsuperman05]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imsuperman05">@imsuperman05</a> wrote:</p>
          <blockquote>
              <p>I think you should send out the packet right away, instead of queuing it and sending it in the next cycle.  That way you won’t have any sort of delay when the client wants to read a packet.  It might cause some other problems, depending on your design.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/12</link>
        <pubDate>Tue, 05 Jun 2012 03:29:28 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-12</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>[quote=“Davidi2, post:10, topic:444024”][quote author=sinisoul link=topic=546710.msg4008036#msg4008036 date=1338862138]</p>
<aside class="quote">
<blockquote>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
</blockquote>
</aside>
<p>Buffer it to the write output byte array directly<br>
[/quote]I think its much more organized to have a packet builder[buffer] outside of the write buffer.</p>
<p>[quote author=sinisoul link=topic=546710.msg4008036#msg4008036 date=1338862138]<br>
<a class="mention" href="/u/david">@David</a></p>
<p>If you speed up the server clock to say 400 ms a cycle, then the client will respond much faster and the game play will seem quicker. Practically the server controls the pace of gameplay but only 50 packets can be parsed per logic cycle. I believe that’s the same for RT3-5? So it’d be wise to send out frames every server tick because then you have explicit control of the current server ‘state’. Which should be defined by the tick.<br>
[/quote]Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.[/quote]</p>
<p>No. The client is not on a set time cycle to operate at other than a few milliseconds for a logic and draw cycle. The server will determine the tick time.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/11</link>
        <pubDate>Tue, 05 Jun 2012 03:17:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-11</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>[quote=“sinisoul, post:9, topic:444024”][quote author=zyle1992 link=topic=546710.msg4008028#msg4008028 date=1338861607]<br>
Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?<br>
[/quote]</p>
<p>Buffer it to the write output byte array directly[/quote]I think its much more organized to have a packet builder[buffer] outside of the write buffer.</p>
<p>[quote=“sinisoul, post:9, topic:444024”]<a class="mention" href="/u/david">@David</a></p>
<p>If you speed up the server clock to say 400 ms a cycle, then the client will respond much faster and the game play will seem quicker. Practically the server controls the pace of gameplay but only 50 packets can be parsed per logic cycle. I believe that’s the same for RT3-5? So it’d be wise to send out frames every server tick because then you have explicit control of the current server ‘state’. Which should be defined by the tick.[/quote]Doesn’t the client read data on its tick anyways? In other words, if you have a discrepancy between the server tick time and the standard client time (such as a server 300ms vs the standard client 600ms), you will run into things that SEEM like lag, such as getting two logs at once when chopping a tree, because the client will only parse the packets every 600ms. Either way, the packets will queue in the client, no matter if you send them when they are created or if you queue them in the server until the tick. Unless I’m completely getting my logic wrong, which is entirely possible when you skipped a nights sleep to catch an early flight <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> Pls explain if so, I will read when I get back.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/10</link>
        <pubDate>Tue, 05 Jun 2012 02:35:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-10</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="6" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/zyle1992/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> zyle1992:</div>
<blockquote>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
</blockquote>
</aside>
<p>Buffer it to the write output byte array directly and then write it out to the client for each server tick. Also, out of curiosity what networking package are you using?</p>
<p>Personally, I use a netty implementation and have a frame encoder in which the information for the frame is encoded into a “ChannelBuffer”. But I queue frames up in a “FrameWriter” which implements a “FrameVisitor” which is just how the frames get encoded (Visitor pattern).</p>
<p><a class="mention" href="/u/david">@David</a></p>
<p>If you speed up the server clock to say 400 ms a cycle, then the client will respond much faster and the game play will seem quicker. Practically the server controls the pace of gameplay but only 50 packets can be parsed per logic cycle. I believe that’s the same for RT3-5? So it’d be wise to send out frames every server tick because then you have explicit control of the current server ‘state’. Which should be defined by the tick.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/9</link>
        <pubDate>Tue, 05 Jun 2012 02:08:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-9</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>I think your original question was about constructing packets, correct? You can really do whatever you want in terms of creating the packet data in a way the output bytebuffer can accept it, a byte array or another byte buffer will work fine. Using the byte buffer really isnt much different as it has a normal backing byte array anyways. The output bytebuffer can accept another bytebuffer or byte array in the put() method anyways. I’m sure there are advantages and disadvantages to both based on your design, but it’s 4 am and I need to catch a plane!</p>
<p>And yes, you should create SOME sort of buffer for each packet, or you <span class="bbcode-i">may</span> run into issues like packets mixing up, unless you specifically make sure to prevent that with your design. It also just gives you more flexability. You could technically then create an instance of a packet buffer that is commonly sent without any mutations and use it instead of creating the packet each time.</p>
<p>[quote=“t4, post:7, topic:444024”]i could be completely wrong, but i feel like queuing up data in a buffer and sending it every cycle is what one is supposed to do (since the server has a clock and could have multiple packets sent during each cycle).[/quote]I’m pretty sure that doesn’t matter, because the client does it anyways.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/8</link>
        <pubDate>Tue, 05 Jun 2012 02:08:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-8</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>i could be completely wrong, but i feel like queuing up data in a buffer and sending it every cycle is what one is supposed to do (since the server has a clock and could have multiple packets sent during each cycle).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/7</link>
        <pubDate>Tue, 05 Jun 2012 02:02:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-7</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@zyle1992 Zymus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zyle1992">@zyle1992</a> wrote:</p>
          <blockquote>
              <p>[quote=“sinisoul, post:5, topic:444024”][quote author=zyle1992 link=topic=546710.msg4008020#msg4008020 date=1338860818]</p>
<aside class="quote">
<blockquote>
<p>A client has a maximum input buffer and output buffer of 5000 bytes in the RuneTek 3/4 engines but now in RuneTek 5 it is 25000 bytes so having a write only buffer constructed for each client wouldn’t be a bad route to go. Also, an old unused feature in the old RuneTek 3 client is that the payload of the byte buffer created would allow for the caching of the payload so that if a new byte buffer of the same length or length type was instantiated you wouldn’t have to reconstruct the payload. RuneTek 5 I have seen it in full swing; all payloads for byte buffers are cached and given specific lengths ranging from 50-30000 bytes. Something to look into.</p>
</blockquote>
</aside>
<p>Yes, I recall seeing that in the RT3 engine. However, I am still concerned about a possible concurrency problem with that. For example, if one thread is reading data from the single buffer in the client, while another thread flips the buffer, and starts writing to it.<br>
[/quote]</p>
<p>You don’t mix read/write buffers.[/quote]</p>
<p>Ah, I misread it. I thought it was weird you said “read/write only buffer”.</p>
<p>So I think what I’ll do is have a pair of Buffers, each of 256 bytes; but my question still remains.</p>
<p>Should I send the data directly to the client’s buffer, or create a new ByteBuffer for every packet to be sent, and then send that data through the channel?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/6</link>
        <pubDate>Tue, 05 Jun 2012 02:00:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-6</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>[quote=“zyle1992, post:3, topic:444024”][quote author=sinisoul link=topic=546710.msg4008003#msg4008003 date=1338858750]<br>
A client has a maximum input buffer and output buffer of 5000 bytes in the RuneTek 3/4 engines but now in RuneTek 5 it is 25000 bytes so having a write only buffer constructed for each client wouldn’t be a bad route to go. Also, an old unused feature in the old RuneTek 3 client is that the payload of the byte buffer created would allow for the caching of the payload so that if a new byte buffer of the same length or length type was instantiated you wouldn’t have to reconstruct the payload. RuneTek 5 I have seen it in full swing; all payloads for byte buffers are cached and given specific lengths ranging from 50-30000 bytes. Something to look into.<br>
[/quote]</p>
<p>Yes, I recall seeing that in the RT3 engine. However, I am still concerned about a possible concurrency problem with that. For example, if one thread is reading data from the single buffer in the client, while another thread flips the buffer, and starts writing to it.[/quote]</p>
<p>NEVER mix read/write buffers. You shouldn’t have to synchronize writes and if so then you should just look into encapsulating frames with the required data and then encoding them later into the write buffer.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/5</link>
        <pubDate>Tue, 05 Jun 2012 01:57:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-5</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>a write only buffer constructed for each client</p>
</blockquote>
</aside>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/4</link>
        <pubDate>Tue, 05 Jun 2012 01:51:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-4</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@zyle1992 Zymus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zyle1992">@zyle1992</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="2" data-topic="444024">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>A client has a maximum input buffer and output buffer of 5000 bytes in the RuneTek 3/4 engines but now in RuneTek 5 it is 25000 bytes so having a write only buffer constructed for each client wouldn’t be a bad route to go. Also, an old unused feature in the old RuneTek 3 client is that the payload of the byte buffer created would allow for the caching of the payload so that if a new byte buffer of the same length or length type was instantiated you wouldn’t have to reconstruct the payload. RuneTek 5 I have seen it in full swing; all payloads for byte buffers are cached and given specific lengths ranging from 50-30000 bytes. Something to look into.</p>
</blockquote>
</aside>
<p>Yes, I recall seeing that in the RT3 engine. However, I am still concerned about a possible concurrency problem with that. For example, if one thread is reading data from the single buffer in the client, while another thread flips the buffer, and starts writing to it.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/3</link>
        <pubDate>Tue, 05 Jun 2012 01:46:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-3</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
      <item>
        <title>NIO Buffers</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>A client has a maximum input buffer and output buffer of 5000 bytes in the RuneTek 3/4 engines but now in RuneTek 5 it is 25000 bytes so having a write only buffer constructed for each client wouldn’t be a bad route to go. Also, an old unused feature in the old RuneTek 3 client is that the payload of the byte buffer created would allow for the caching of the payload so that if a new byte buffer of the same length or length type was instantiated you wouldn’t have to reconstruct the payload. RuneTek 5 I have seen it in full swing; all payloads for byte buffers are cached and given specific lengths ranging from 50-30000 bytes. Something to look into.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/nio-buffers/444024/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/nio-buffers/444024/2</link>
        <pubDate>Tue, 05 Jun 2012 01:12:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444024-2</guid>
        <source url="https://forum.moparisthebest.com/t/nio-buffers/444024.rss">NIO Buffers</source>
      </item>
  </channel>
</rss>
