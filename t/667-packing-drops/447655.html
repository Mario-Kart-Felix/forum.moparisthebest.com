<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/667-packing-drops/447655 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 04:39:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>667 Packing Drops - Runescape - moparisthebest.com</title>
    <meta name="description" content="I need help with NPC drops, they can&amp;#39;t be packed or unpacked. I would like to edit them, I&amp;#39;ve tried quite a bit but I&amp;#39;m thinking there is more than just changing some file names. 

If you can help me pack the drops, or e&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="447655.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;667 Packing Drops&#39;" href="447655.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/667-packing-drops/447655" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/667-packing-drops/447655" />
<meta property="og:title" content="667 Packing Drops" />
<meta name="twitter:title" content="667 Packing Drops" />
<meta property="og:description" content="I need help with NPC drops, they can’t be packed or unpacked. I would like to edit them, I’ve tried quite a bit but I’m thinking there is more than just changing some file names.  If you can help me pack the drops, or edit the drops in some other way that would be great.  NPCDrops.java  [CODE]package com.rs.utils;  import java.io.BufferedReader;  import java.io.DataOutputStream;  import java.io.File;  import java.io.FileOutputStream;  import java.io.FileReader;  import java.io.IOException;  impo..." />
<meta name="twitter:description" content="I need help with NPC drops, they can’t be packed or unpacked. I would like to edit them, I’ve tried quite a bit but I’m thinking there is more than just changing some file names.  If you can help me pack the drops, or edit the drops in some other way that would be great.  NPCDrops.java  [CODE]package com.rs.utils;  import java.io.BufferedReader;  import java.io.DataOutputStream;  import java.io.File;  import java.io.FileOutputStream;  import java.io.FileReader;  import java.io.IOException;  impo..." />
<meta property="article:published_time" content="2012-07-01T07:04:12+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="447655.html">667 Packing Drops</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/USKO.html'><span itemprop='name'>USKO</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-07-01T07:04:12Z'>
            <time itemprop='dateModified' datetime='2016-08-03T09:58:22Z' class='post-time'>
              August 3, 2016,  9:58am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I need help with NPC drops, they can’t be packed or unpacked. I would like to edit them, I’ve tried quite a bit but I’m thinking there is more than just changing some file names.</p>
<p>If you can help me pack the drops, or edit the drops in some other way that would be great.</p>
<p>NPCDrops.java</p>
<p>[CODE]package com.rs.utils;</p>
<p>import java.io.BufferedReader;<br>
import java.io.DataOutputStream;<br>
import java.io.File;<br>
import java.io.FileOutputStream;<br>
import java.io.FileReader;<br>
import java.io.IOException;<br>
import java.io.RandomAccessFile;<br>
import java.nio.ByteBuffer;<br>
import java.nio.channels.FileChannel;<br>
import java.nio.channels.FileChannel.MapMode;<br>
import java.util.HashMap;</p>
<p>import com.rs.game.item.Item;<br>
import com.rs.game.player.Player;<br>
import com.rs.game.player.content.Shop;</p>
<p>public class ShopsHandler {</p>
<pre><code>private static final HashMap&lt;Integer, Shop&gt; handledShops = new HashMap&lt;Integer, Shop&gt;();

private static final String PACKED_PATH = "data/items/packedShops.s";
private static final String UNPACKED_PATH = "data/items/unpackedShops.txt";

public static void init() {
	if (new File(PACKED_PATH).exists())
		loadPackedShops();
	else
		loadUnpackedShops();
}

private static void loadUnpackedShops() {
	Logger.log("ShopsHandler", "Packing shops...");
	try {
		BufferedReader in = new BufferedReader(
				new FileReader(UNPACKED_PATH));
		DataOutputStream out = new DataOutputStream(new FileOutputStream(
				PACKED_PATH));
		while (true) {
			String line = in.readLine();
			if (line == null)
				break;
			if (line.startsWith("//"))
				continue;
			String[] splitedLine = line.split(" - ", 3);
			if (splitedLine.length != 3)
				throw new RuntimeException("Invalid list for shop line: "
						+ line);
			String[] splitedInform = splitedLine[0].split(" ", 3);
			if (splitedInform.length != 3)
				throw new RuntimeException("Invalid list for shop line: "
						+ line);
			String[] splitedItems = splitedLine[2].split(" ");
			int key = Integer.valueOf(splitedInform[0]);
			int money = Integer.valueOf(splitedInform[1]);
			boolean generalStore = Boolean.valueOf(splitedInform[2]);
			Item[] items = new Item[splitedItems.length / 2];
			int count = 0;
			for (int i = 0; i &lt; items.length; i++)
				items[i] = new Item(Integer.valueOf(splitedItems[count++]),
						Integer.valueOf(splitedItems[count++]));
			out.writeInt(key);
			writeAlexString(out, splitedLine[1]);
			out.writeShort(money);
			out.writeBoolean(generalStore);
			out.writeByte(items.length);
			for (Item item : items) {
				out.writeShort(item.getId());
				out.writeInt(item.getAmount());
			}
			addShop(key, new Shop(splitedLine[1], money, items,
					generalStore));
		}
		in.close();
		out.close();
	} catch (Throwable e) {
		Logger.handle(e);
	}
}

private static void loadPackedShops() {
	try {
		RandomAccessFile in = new RandomAccessFile(PACKED_PATH, "r");
		FileChannel channel = in.getChannel();
		ByteBuffer buffer = channel.map(MapMode.READ_ONLY, 0,
				channel.size());
		while (buffer.hasRemaining()) {
			int key = buffer.getInt();
			String name = readAlexString(buffer);
			int money = buffer.getShort() &amp; 0xffff;
			boolean generalStore = buffer.get() == 1;
			Item[] items = new Item[buffer.get() &amp; 0xff];
			for (int i = 0; i &lt; items.length; i++)
				items[i] = new Item(buffer.getShort() &amp; 0xffff,
						buffer.getInt());
			addShop(key, new Shop(name, money, items, generalStore));
		}
		channel.close();
		in.close();
	} catch (Throwable e) {
		Logger.handle(e);
	}
}

public static String readAlexString(ByteBuffer buffer) {
	int count = buffer.get() &amp; 0xfff;
	byte[] bytes = new byte[count];
	buffer.get(bytes, 0, count);
	return new String(bytes);
}

public static void writeAlexString(DataOutputStream out, String string)
		throws IOException {
	byte[] bytes = string.getBytes();
	out.writeByte(bytes.length);
	out.write(bytes);
}

public static void restoreShops() {
	for (Shop shop : handledShops.values())
		shop.restoreItems();
}

public static boolean openShop(Player player, int key) {
	Shop shop = getShop(key);
	if (shop == null)
		return false;
	shop.addPlayer(player);
	return true;
}

public static Shop getShop(int key) {
	return handledShops.get(key);
}

public static void addShop(int key, Shop shop) {
	handledShops.put(key, shop);
}
</code></pre>
<p>}<br>
[/CODE]</p>
<p>Here’s NPCDropLoader.java not sure if there’s anything wrong with it. (There’s 2 of them, I think identical, not sure though.)</p>
<p>[CODE]</p>
<p>public NPCDropLoader() {<br>
try {<br>
dropFile = new RandomAccessFile(“data/npcs/packedDrops.s”, “r”);<br>
} catch (FileNotFoundException e) {<br>
Logger.log(“NPCDropLoader”,“No drop file!”);<br>
}<br>
}</p>
<pre><code>public void load() {
    Logger.log("NPCDropLoader","Loading drops...");
    try {
        FileChannel channel = dropFile.getChannel();
        if (channel.size() &gt; 0) {
            ByteBuffer buffer = channel.map(MapMode.READ_ONLY, 0, channel.size());
            ArrayList&lt;Drop&gt; drops = null;
            int dropSize = buffer.getShort();
            for (int i = 0; i &lt; dropSize; i++) {
                int npcId = buffer.getShort();
                short dropAmt = buffer.getShort();
                drops = new ArrayList&lt;Drop&gt;(dropAmt);
                for (int x = 0; x &lt; dropAmt; x++) {
                    drops.add(new Drop(buffer.getShort(), buffer.getDouble(), buffer.getInt()));
                }
                dropMap.put(npcId, drops);
            }
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
    Logger.log("NPCDropLoader","Loaded " + dropMap.size() + " drops");
}[/CODE]
</code></pre>
<p>And finally the error. This goes away if I put back the original drops.bin, but I can’t edit the drops in that so I don’t know what to do about that.</p>
<pre><code class="lang-auto">[NPCDropLoader] No drop file!
[NPCDropLoader] Loading drops...
Exception in thread "main" java.lang.NullPointerException
        at com.rs.game.npc.NPCDropLoader.load(NPCDropLoader.java:35)
        at com.rs.game.World.init(World.java:87)
        at com.rs.Launcher.main(Launcher.java:111)</code></pre>
<p>Any help is appreciated.</p>
      </div>

      <meta itemprop='headline' content='667 Packing Drops'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/667-packing-drops/447655 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 04:39:23 GMT -->
</html>
