<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>RuneRuby - Simple, efficient, fun!</title>
    <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341</link>
    <description>Hey guys!

I&#39;ve been wanting to expand my Ruby knowledge for some time now, with the official Moparscape server in the works that gave me an opportunity to greatly improve on that. I want to go a step further and create a simple to use server completely written in Ruby. I am by no means a Ruby guru and I&#39;m learning a lot about Ruby application design as I go. For my ideas I mostly stupid the large web frameworks to gain an idea of how developers game up with solutions to problems.

No github yet! I have some Ruby code that I can share with you, I have yet to plan everything out but I&#39;ll keep a list of gems that I am using and also an explanation of ideas. I keep a note file for things that pop inside my head.

This isn&#39;t meant to replace the Moparscape server, I need breaks at time to explore new niches of programming. I&#39;d like to master Ruby and this is one way to also help develop the plugin system we have available on the server.

I am willing to help those of you interested in how I approach making a server, ask me anything and I will answer.

Notes!

[code]
++ RuneRuby
========================================

- Context for dispatching inputted messages to the appropriate service
- Multiple Services, recieve messages and handle accordingly

- Base Network Module -&gt; Message Decoder -&gt; Message Dispatcher -&gt; Message Handler

- When a client logs in the socket is a persistent object that will continue to be referenced from that point forward.
- The client tells the server which service it wishes to use, a service has its own ways of handling the messages put forth after that point.

- All packet to the server are formatted in the following way:

= STATIC(size)
  uint_8       : packet
  uint_8[size] : payload

= VAR_BYTE
  uint_8       : packet
  uint_8       : size
  uint_8[size] : payload

= VAR_SHORT
  uint_8       : packet
  uint_16      : size
  uint_8[size] : payload

Services?

- Pathways for packets and building 

RuneRuby
 - Application
 + Server
   - Other Junk
   - EventMachine

Define message handlers


Service
- MessageDecoder
+ :id =&gt; decoder
[/code]

Random Ruby Code

Whenever data is read you push data to it, and it obviously reads frames as it can.

[code]
class FrameDecoder

                        attr_writer :sizes

                        # Initialize the frame decoder.
                        def initialize
                                @data   = []
                                @states = []
                                @frames = []
                                @id     = nil
                                @sizes  = nil
                                @size   = nil
                        end

                        # Decodes a frame from the held data and frame sizes, if a frame is successfully parsed it will be passed to
                        # the methods block if one was provided.
                        #
                        # #Return true if a frame was parsed
                        def decode

                                # Call each of the methods to create the frame, or continue creating a frame in progress
                                %i( determine_id determine_size create_frame ).each { |method| return false unless send(method) }

                                # Yield to the block if one was given
                                yield @frames.last if block_given?

                                # Clear the states array
                                @states.clear

                                true
                        end

                        #
                        # Determines the id of the current frame as defined by the start of the data array.
                        #
                        # @return true if the id was successfully determined
                        def determine_id

                                # Return true if the id determined state is set, return false else if there is not enough data to parse the id
                                if @states.include? :id_determined then return true elsif @data.length &lt; 1; then return false end

                                # Set the id from the unsigned value of the first data value in the data array
                                @id = unsigned(@data.shift(1))

                                # Push to the state array that the id has been determined
                                @states &lt;&lt; :id_determined

                                true
                        end

                        # Determines the size of the current frame as defined by the start of the data array and predetermined size typing
                        #
                        # #Return true if the size was successfully determined
                        def determine_size

                                # Return true if the size determined state is set, return false if the sizes array is not set
                                if @states.include? :size_determined then return true elsif @sizes.eql? nil; then return false end

                                raise &quot;undefined packet #{@id}&quot; if @sizes[@id].nil?

                                type, size = @sizes[@id]

                                # Determine the amount of bytes it takes to determine the size of the current frame
                                length = case type
                                                 when :static   then 0
                                                 when :var_byte then 1
                                                 when :var_short then 2
                                                 else throw &quot;undefined size type #{type}&quot;
                                         end

                                # Return false if there is not enough data to parse the current frame
                                return false if @data.length &lt; length

                                # Determine the size from the shifted unsigned values from the data array if needed
                                size = unsigned(@data.shift(length)) if length &gt; 0

                                # Set the size of the frame
                                @size = size

                                # Push to the state array that the size has been determined
                                @states &lt;&lt; :size_determined

                                true
                        end

                        # Creates and appends a frame to the local array
                        #
                        # #Return true if the frame was successfully created
                        def create_frame

                                # Return false if there is not enough data for the frame
                                return false if @data.length &lt; @size

                                # Create and push the frame to the frame queue
                                @frames &lt;&lt; [@id, @data.shift(@size)]

                                true
                        end

                        #
                        # Returns the accumulative unsigned big endian value of a byte array
                        #
                        # #Return the numeric value
                        def unsigned(data)
                                data.each_with_index.map { |n, i| (n &amp; 0xff) &lt;&lt; (data.length - i - 1) * 8 }.inject(:+)
                        end

                        # Appends data to the decoder.
                        #
                        # #Return nil
                        def append(data)
                                @data.concat data
                                nil
                        end

                        # Alias the append method
                        alias :&lt;&lt; :append

                        # Note all the private methods so that they can not be called out of the class context
                        private :determine_id, :determine_size, :create_frame, :unsigned
                end
[/code]

A very rough service example, the idea is to load services dynamically and define tasks/other features for a service along with registered listeners to the service so that you can set up the object.

[code]
module RuneRuby
        class Gateway &lt; RuneRuby::Service
                ONDEMAND_CONNECTION = 15

                config.name = &#39;gateway&#39;

                define_frame(ONDEMAND_CONNECTION, :static) do
                        name :ondemand_handshake
                        read :version, :int_32
                end

                define_handler(:ondemand_handshake) do |client, frame|
                        p frame[:version] # Should print previously fetched version
                        client.write :id =&gt; 0, :type =&gt; :raw, :payload =&gt; &quot;\x2&quot;.unpack(&quot;c*&quot;)
                end
        end
end
[/code]</description>
    
    <lastBuildDate>Fri, 01 Nov 2013 05:00:07 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="21" data-topic="534341">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/javatc/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> JavaTC:</div>
<blockquote>
<p>Isn’t Ruby a scripting language?</p>
</blockquote>
</aside>
<p>Yes?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/23">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/23</link>
        <pubDate>Fri, 01 Nov 2013 05:00:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-23</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@rooneyscape rooneyscape]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rooneyscape">@rooneyscape</a> wrote:</p>
          <blockquote>
              <p>Goodluck Sini wish you all the best.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/22">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/22</link>
        <pubDate>Fri, 01 Nov 2013 04:28:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-22</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@JavaTC JavaTC]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/javatc">@JavaTC</a> wrote:</p>
          <blockquote>
              <p>Isn’t Ruby a scripting language?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/21</link>
        <pubDate>Fri, 01 Nov 2013 04:18:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-21</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p><a href="https://github.com/Hadyn/rune-ruby" class="onebox" target="_blank" rel="nofollow noopener">https://github.com/Hadyn/rune-ruby</a></p>
<p>Things are still rough and a word in progress.</p>
<p>Files to look at:</p>
<p>config/packets.rb</p>
<ul>
<li>Holds all the data about how to decode all the packets, currently missing decoding features.</li>
</ul>
<pre><code class="lang-auto"># Define all of the server packets within this script.
RuneRuby.packets.bundle do
        map :name =&gt; 'ping', :id =&gt; 6, :size =&gt; 'static', :actual_size =&gt; 0

        # The authentication handshake is sent before the authentication packet,
        # it is used to select the login server that the client will be using to
        # login with and is used just to assure that everything is running smoothly
        # before the actual authentication data is sent.
        map :name =&gt; 'authshake', :id =&gt; 14, :size =&gt; 'static', :actual_size =&gt; 1

        map :name =&gt; 'authentication', :id =&gt; 16, :size =&gt; 'var_byte'
end</code></pre>
<p>lib/runeruby/controller.rb</p>
<p>Controller class, includes Hooks which allows for methods to be called on specific events. Controllers will all be requested to launch their on :load hooks during initialization.</p>
<p>If noted (attribute mixin unfinished) that the controller listens for packets, if the controller responds to the name of the packet as a method it will be dispatched the arguments.</p>
<pre><code class="lang-auto">class OndemandController &lt; RuneRuby::Controller
        on :load, :start

        def music_requested(conn, id)  # When a music is requested by a connection, alert this controller.

        end

        def start
              # Do launch stuff here
        end
end</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/20</link>
        <pubDate>Fri, 01 Nov 2013 01:03:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-20</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Stealmojo Stealmojo]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/stealmojo">@Stealmojo</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="18" data-topic="534341">
<div class="title">
<div class="quote-controls"></div>
 AtomicInt_:</div>
<blockquote>
<p>bump for science</p>
</blockquote>
</aside>
<p>more info plsk</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/19</link>
        <pubDate>Thu, 31 Oct 2013 19:57:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-19</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>bump for science</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/18</link>
        <pubDate>Thu, 31 Oct 2013 19:29:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-18</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>I miss seeing you around man.</p>
<p><a class="mention" href="/u/scronix">@Scronix</a>: Yes the project is especially made for fun.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/17</link>
        <pubDate>Sat, 26 Oct 2013 19:55:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-17</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Ruby_Forums_Coder Ruby]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ruby_forums_coder">@Ruby_Forums_Coder</a> wrote:</p>
          <blockquote>
              <p>You will never master me. Evil laugh. Winky face. Bad pun.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/16</link>
        <pubDate>Sat, 26 Oct 2013 14:32:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-16</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Scronix Scronix]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/scronix">@Scronix</a> wrote:</p>
          <blockquote>
              <p>[quote=“Wintercanon, post:14, topic:534341”][quote author=imsuperman05 link=topic=653137.msg4377270#msg4377270 date=1382418256]<br>
pics or gtfo<br>
[/quote]You sir, are a moron.[/quote]<br>
Retweet.</p>
<p>OP: Goodluck and have fun with this Sini.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/15</link>
        <pubDate>Tue, 22 Oct 2013 17:21:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-15</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Wintercanon Wintercanon]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wintercanon">@Wintercanon</a> wrote:</p>
          <blockquote>
              <p>[quote=“imsuperman05, post:13, topic:534341”]pics or gtfo[/quote]You sir, are a moron.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/14</link>
        <pubDate>Tue, 22 Oct 2013 07:04:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-14</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@imsuperman05 imsuperman05]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imsuperman05">@imsuperman05</a> wrote:</p>
          <blockquote>
              <p>pics or gtfo</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/13</link>
        <pubDate>Tue, 22 Oct 2013 05:04:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-13</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>[quote=“Arcik, post:9, topic:534341”][quote author=Docent link=topic=653137.msg4376600#msg4376600 date=1382229567]<br>
This server is going to be slow as Ruby is not a fast language.<br>
[/quote]<br>
Are you still going to work on the 530?[/quote]</p>
<p>I have to. So yes.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/12</link>
        <pubDate>Sun, 20 Oct 2013 22:25:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-12</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="10" data-topic="534341">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/docent/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Docent:</div>
<blockquote>
<p>I used to code with Ruby FYI. And all I’m saying is that this server can’t withstand too many players.</p>
</blockquote>
</aside>
<aside class="quote" data-post="1" data-topic="534405">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/docent/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar">
</div>
<blockquote>
<p>Can someone give me more info about what is so special about these totally blank, “I got walking to work!” servers?</p>
</blockquote>
</aside>
<p>your opinion is kind of irrelevant</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/11</link>
        <pubDate>Sun, 20 Oct 2013 19:56:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-11</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Docent Limits]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/docent">@Docent</a> wrote:</p>
          <blockquote>
              <p>[quote=“Arcik, post:9, topic:534341”][quote author=Docent link=topic=653137.msg4376600#msg4376600 date=1382229567]<br>
This server is going to be slow as Ruby is not a fast language.<br>
[/quote]<br>
You’re a retard. If you don’t know what Ruby’s limitations are then don’t post.</p>
<p>OT: Gl with this always wanted somebody to attemp a server with ruby.</p>
<p>Are you still going to work on the 530?[/quote]</p>
<p>I used to code with Ruby FYI. And all I’m saying is that this server can’t withstand too many players.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/10</link>
        <pubDate>Sun, 20 Oct 2013 14:07:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-10</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="7" data-topic="534341">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/docent/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Docent:</div>
<blockquote>
<p>This server is going to be slow as Ruby is not a fast language.</p>
</blockquote>
</aside>
<p>You’re a retard. If you don’t know what Ruby’s limitations are then don’t post.</p>
<p>OT: Gl with this always wanted somebody to attemp a server with ruby.</p>
<p>Are you still going to work on the 530?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/9</link>
        <pubDate>Sun, 20 Oct 2013 13:26:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-9</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>Not too sure about that yet.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/8</link>
        <pubDate>Sun, 20 Oct 2013 00:49:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-8</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Docent Limits]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/docent">@Docent</a> wrote:</p>
          <blockquote>
              <p>This server is going to be slow as Ruby is not a fast language.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/7</link>
        <pubDate>Sun, 20 Oct 2013 00:39:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-7</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@strucker Strucker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/strucker">@strucker</a> wrote:</p>
          <blockquote>
              <p>[quote=“Flame_, post:5, topic:534341”]Interested to see how this goes, and I like the name. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> Good luck.[/quote]he was streaming earlier today, i saw some of the code. along with others like lare…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/6</link>
        <pubDate>Sat, 19 Oct 2013 21:48:52 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-6</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Flame3 John]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/flame3">@Flame3</a> wrote:</p>
          <blockquote>
              <p>Interested to see how this goes, and I like the name. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> Good luck.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/5</link>
        <pubDate>Sat, 19 Oct 2013 21:02:40 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-5</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>looks promising. good luck and have fun with this</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/4</link>
        <pubDate>Sat, 19 Oct 2013 20:57:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-4</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@thakillah thakillah]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/thakillah">@thakillah</a> wrote:</p>
          <blockquote>
              <p>Best of luck sini!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/3</link>
        <pubDate>Sat, 19 Oct 2013 18:28:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-3</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@strucker Strucker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/strucker">@strucker</a> wrote:</p>
          <blockquote>
              <p>Good luck.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/2</link>
        <pubDate>Sat, 19 Oct 2013 17:06:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-2</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
      <item>
        <title>RuneRuby - Simple, efficient, fun!</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>Hey guys!</p>
<p>I’ve been wanting to expand my Ruby knowledge for some time now, with the official Moparscape server in the works that gave me an opportunity to greatly improve on that. I want to go a step further and create a simple to use server completely written in Ruby. I am by no means a Ruby guru and I’m learning a lot about Ruby application design as I go. For my ideas I mostly stupid the large web frameworks to gain an idea of how developers game up with solutions to problems.</p>
<p>No github yet! I have some Ruby code that I can share with you, I have yet to plan everything out but I’ll keep a list of gems that I am using and also an explanation of ideas. I keep a note file for things that pop inside my head.</p>
<p>This isn’t meant to replace the Moparscape server, I need breaks at time to explore new niches of programming. I’d like to master Ruby and this is one way to also help develop the plugin system we have available on the server.</p>
<p>I am willing to help those of you interested in how I approach making a server, ask me anything and I will answer.</p>
<p>Notes!</p>
<pre><code class="lang-auto">++ RuneRuby
========================================

- Context for dispatching inputted messages to the appropriate service
- Multiple Services, recieve messages and handle accordingly

- Base Network Module -&gt; Message Decoder -&gt; Message Dispatcher -&gt; Message Handler

- When a client logs in the socket is a persistent object that will continue to be referenced from that point forward.
- The client tells the server which service it wishes to use, a service has its own ways of handling the messages put forth after that point.

- All packet to the server are formatted in the following way:

= STATIC(size)
  uint_8       : packet
  uint_8[size] : payload

= VAR_BYTE
  uint_8       : packet
  uint_8       : size
  uint_8[size] : payload

= VAR_SHORT
  uint_8       : packet
  uint_16      : size
  uint_8[size] : payload

Services?

- Pathways for packets and building 

RuneRuby
 - Application
 + Server
   - Other Junk
   - EventMachine

Define message handlers


Service
- MessageDecoder
+ :id =&gt; decoder</code></pre>
<p>Random Ruby Code</p>
<p>Whenever data is read you push data to it, and it obviously reads frames as it can.</p>
<pre><code class="lang-auto">class FrameDecoder

                        attr_writer :sizes

                        # Initialize the frame decoder.
                        def initialize
                                @data   = []
                                @states = []
                                @frames = []
                                @id     = nil
                                @sizes  = nil
                                @size   = nil
                        end

                        # Decodes a frame from the held data and frame sizes, if a frame is successfully parsed it will be passed to
                        # the methods block if one was provided.
                        #
                        # #Return true if a frame was parsed
                        def decode

                                # Call each of the methods to create the frame, or continue creating a frame in progress
                                %i( determine_id determine_size create_frame ).each { |method| return false unless send(method) }

                                # Yield to the block if one was given
                                yield @frames.last if block_given?

                                # Clear the states array
                                @states.clear

                                true
                        end

                        #
                        # Determines the id of the current frame as defined by the start of the data array.
                        #
                        # @return true if the id was successfully determined
                        def determine_id

                                # Return true if the id determined state is set, return false else if there is not enough data to parse the id
                                if @states.include? :id_determined then return true elsif @data.length &lt; 1; then return false end

                                # Set the id from the unsigned value of the first data value in the data array
                                @id = unsigned(@data.shift(1))

                                # Push to the state array that the id has been determined
                                @states &lt;&lt; :id_determined

                                true
                        end

                        # Determines the size of the current frame as defined by the start of the data array and predetermined size typing
                        #
                        # #Return true if the size was successfully determined
                        def determine_size

                                # Return true if the size determined state is set, return false if the sizes array is not set
                                if @states.include? :size_determined then return true elsif @sizes.eql? nil; then return false end

                                raise "undefined packet #{@id}" if @sizes[@id].nil?

                                type, size = @sizes[@id]

                                # Determine the amount of bytes it takes to determine the size of the current frame
                                length = case type
                                                 when :static   then 0
                                                 when :var_byte then 1
                                                 when :var_short then 2
                                                 else throw "undefined size type #{type}"
                                         end

                                # Return false if there is not enough data to parse the current frame
                                return false if @data.length &lt; length

                                # Determine the size from the shifted unsigned values from the data array if needed
                                size = unsigned(@data.shift(length)) if length &gt; 0

                                # Set the size of the frame
                                @size = size

                                # Push to the state array that the size has been determined
                                @states &lt;&lt; :size_determined

                                true
                        end

                        # Creates and appends a frame to the local array
                        #
                        # #Return true if the frame was successfully created
                        def create_frame

                                # Return false if there is not enough data for the frame
                                return false if @data.length &lt; @size

                                # Create and push the frame to the frame queue
                                @frames &lt;&lt; [@id, @data.shift(@size)]

                                true
                        end

                        #
                        # Returns the accumulative unsigned big endian value of a byte array
                        #
                        # #Return the numeric value
                        def unsigned(data)
                                data.each_with_index.map { |n, i| (n &amp; 0xff) &lt;&lt; (data.length - i - 1) * 8 }.inject(:+)
                        end

                        # Appends data to the decoder.
                        #
                        # #Return nil
                        def append(data)
                                @data.concat data
                                nil
                        end

                        # Alias the append method
                        alias :&lt;&lt; :append

                        # Note all the private methods so that they can not be called out of the class context
                        private :determine_id, :determine_size, :create_frame, :unsigned
                end</code></pre>
<p>A very rough service example, the idea is to load services dynamically and define tasks/other features for a service along with registered listeners to the service so that you can set up the object.</p>
<pre><code class="lang-auto">module RuneRuby
        class Gateway &lt; RuneRuby::Service
                ONDEMAND_CONNECTION = 15

                config.name = 'gateway'

                define_frame(ONDEMAND_CONNECTION, :static) do
                        name :ondemand_handshake
                        read :version, :int_32
                end

                define_handler(:ondemand_handshake) do |client, frame|
                        p frame[:version] # Should print previously fetched version
                        client.write :id =&gt; 0, :type =&gt; :raw, :payload =&gt; "\x2".unpack("c*")
                end
        end
end</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341/1</link>
        <pubDate>Sat, 19 Oct 2013 16:28:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-534341-1</guid>
        <source url="https://forum.moparisthebest.com/t/runeruby-simple-efficient-fun/534341.rss">RuneRuby - Simple, efficient, fun!</source>
      </item>
  </channel>
</rss>
