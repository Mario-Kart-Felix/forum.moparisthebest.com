<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/the-decompressor-class/427903 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:42:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>The Decompressor class - Runescape - moparisthebest.com</title>
    <meta name="description" content="So I&amp;#39;m looking through the Decompressor class and in the decompress() method I found this.  

[code=java] 				int k2 = ((buffer[0] &amp;amp; 0xff) &amp;lt;&amp;lt; 8) + (buffer[1] &amp;amp; 0xff); 				int l2 = ((buffer[2] &amp;amp; 0xff) &amp;lt;&amp;lt; 8) + (buffer[3] &amp;amp; &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="427903.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;The Decompressor class&#39;" href="427903.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/the-decompressor-class/427903" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/the-decompressor-class/427903" />
<meta property="og:title" content="The Decompressor class" />
<meta name="twitter:title" content="The Decompressor class" />
<meta property="og:description" content="So I’m looking through the Decompressor class and in the decompress() method I found this.  				int k2 = ((buffer[0] &amp; 0xff) &lt;&lt; 8) + (buffer[1] &amp; 0xff); 				int l2 = ((buffer[2] &amp; 0xff) &lt;&lt; 8) + (buffer[3] &amp; 0xff); 				int i3 = ((buffer[4] &amp; 0xff) &lt;&lt; 16) + ((buffer[5] &amp; 0xff) &lt;&lt; 8) 						+ (buffer[6] &amp; 0xff); 				int j3 = buffer[7] &amp; 0xff; 				/** 				 *  				 */ 				if (k2 != id || l2 != i || j3 != anInt311) 					return null; 				if (i3 &lt; 0 || i3 &gt; dataFile.length() / 520L) 					return null; The..." />
<meta name="twitter:description" content="So I’m looking through the Decompressor class and in the decompress() method I found this.  				int k2 = ((buffer[0] &amp; 0xff) &lt;&lt; 8) + (buffer[1] &amp; 0xff); 				int l2 = ((buffer[2] &amp; 0xff) &lt;&lt; 8) + (buffer[3] &amp; 0xff); 				int i3 = ((buffer[4] &amp; 0xff) &lt;&lt; 16) + ((buffer[5] &amp; 0xff) &lt;&lt; 8) 						+ (buffer[6] &amp; 0xff); 				int j3 = buffer[7] &amp; 0xff; 				/** 				 *  				 */ 				if (k2 != id || l2 != i || j3 != anInt311) 					return null; 				if (i3 &lt; 0 || i3 &gt; dataFile.length() / 520L) 					return null; The..." />
<meta property="article:published_time" content="2012-01-03T15:07:28+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="427903.html">The Decompressor class</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Native1.html'><span itemprop='name'>Native1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T15:07:28Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:01:43Z' class='post-time'>
              August 2, 2016,  3:01pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>So I’m looking through the Decompressor class and in the decompress() method I found this.</p>
<pre><code class="lang-auto">				int k2 = ((buffer[0] &amp; 0xff) &lt;&lt; 8) + (buffer[1] &amp; 0xff);
				int l2 = ((buffer[2] &amp; 0xff) &lt;&lt; 8) + (buffer[3] &amp; 0xff);
				int i3 = ((buffer[4] &amp; 0xff) &lt;&lt; 16) + ((buffer[5] &amp; 0xff) &lt;&lt; 8)
						+ (buffer[6] &amp; 0xff);
				int j3 = buffer[7] &amp; 0xff;
				/**
				 * 
				 */
				if (k2 != id || l2 != i || j3 != anInt311)
					return null;
				if (i3 &lt; 0 || i3 &gt; dataFile.length() / 520L)
					return null;</code></pre>
<p>The code after this does only uses int i3. So the rest(k2, l2, j3 and those if clauses) seems like random not neccessary shit to me.</p>
<p>Here’s the whole method:</p>
<pre><code class="lang-auto">	public synchronized byte[] decompress(int id) {
		System.out.println("Decompressing " + id);
		try {
			/**
			 * First we seek to a point in the index file.
			 */
			seek(indexFile, id * 6);
			/**
			 * This integer only exists so we can check if the data we read
			 * isn't -1.
			 */
			int indexCheck;

			/**
			 * A loop which reads data from the index file to the buffer.
			 */
			for (int point = 0; point &lt; 6; point += indexCheck) {
				/**
				 * Reads bytes from the index file and stores them into the
				 * buffer.
				 */
				indexCheck = indexFile.read(buffer, point, 6 - point);
				/**
				 * Null check. If the integer we just read was -1 this method
				 * returns.
				 */
				if (indexCheck == -1) {
					System.out.println("Data read was -1.");
					return null;
				}
			}

			/**
			 * The data from the buffer we just filled will be put in this int.
			 */
			int size = ((buffer[0] &amp; 0xff) &lt;&lt; 16) + ((buffer[1] &amp; 0xff) &lt;&lt; 8)
					+ (buffer[2] &amp; 0xff);
			System.out.println("Buffer size: " + size);

			/**
			 * This is the point to seek in the data file.
			 */
			int pointIndex = ((buffer[3] &amp; 0xff) &lt;&lt; 16)
					+ ((buffer[4] &amp; 0xff) &lt;&lt; 8) + (buffer[5] &amp; 0xff);
			System.out.println("Point index: " + pointIndex);

			/**
			 * If the data we just read is 0 or less than 0. Or is more than the
			 * size of the data file divided by 520. It returns null.
			 */
			if (pointIndex &lt;= 0 || (long) pointIndex &gt; dataFile.length() / 520L)
				return null;

			/**
			 * Creates the array of bytes which will be returned at the end of
			 * this method.
			 */
			byte byteArray[] = new byte[size];

			/**
			 * The buffer position. This integer will be increment in the coming
			 * loop.
			 */
			int bufferPosition = 0;

			/**
			 * A loop.
			 */
			for (int i = 0; bufferPosition &lt; size; i++) { // size = 55161
				/**
				 * Returns if the point index is 0. But this will never happen.
				 */
				if (pointIndex == 0)
					return null;

				/**
				 * Seeks in the data file at the point index * 520.
				 */
				seek(dataFile, pointIndex * 520);

				/**
				 * The position we are going to start reading from in the
				 * buffer.
				 */
				int offset = 0;

				/**
				 * The amount of bytes we are going to read is the size of the
				 * buffer - the position in the buffer.
				 */
				int readableBytes = size - bufferPosition;

				/**
				 * The amount of bytes we are going to read cannot be more than
				 * 512.
				 */
				if (readableBytes &gt; 512)
					readableBytes = 512;

				/**
				 * Again a check. If this number is -1 the method will return.
				 */
				int dataCheck;
				/**
				 * No integer is defined in this loop. While k (first time = 0)
				 * is less than i2( first decompression = 512) + 8. K =+ j2 ( =
				 * 0). Inside the loop j2 will be associated with the integer
				 * which we read from the data file. Also integer data will be
				 * stored in our buffer.
				 */
				for (; offset &lt; readableBytes + 8; offset += dataCheck) {
					dataCheck = dataFile.read(buffer, offset,
							(readableBytes + 8) - offset);
					/**
					 * A check, if that data we just read is -1 the method
					 * returns.
					 */
					if (dataCheck == -1)
						return null;
				}
				int k2 = ((buffer[0] &amp; 0xff) &lt;&lt; 8) + (buffer[1] &amp; 0xff);
				int l2 = ((buffer[2] &amp; 0xff) &lt;&lt; 8) + (buffer[3] &amp; 0xff);
				int i3 = ((buffer[4] &amp; 0xff) &lt;&lt; 16) + ((buffer[5] &amp; 0xff) &lt;&lt; 8)
						+ (buffer[6] &amp; 0xff);
				int j3 = buffer[7] &amp; 0xff;
				if (k2 != id || l2 != i || j3 != anInt311)
					return null;
				if (i3 &lt; 0 || i3 &gt; dataFile.length() / 520L)
					return null;
				for (int pos = 0; pos &lt; readableBytes; pos++)
					byteArray[bufferPosition++] = buffer[pos + 8];

				pointIndex = i3;
			}

			return byteArray;
		} catch (IOException e) {
			return null;
		}
	}</code></pre>
<p>Does anyone know why it is here or where it’s used for? Because I can just commend that part out. And the decompression doesn’t fail. I know the if clauses prevent you from wrong data, but the client and cache give the right data for the methods.<br>
So…?</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/iKilem.html'><span itemprop='name'>iKilem</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T19:20:11Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:01:58Z' class='post-time'>
              August 2, 2016,  3:01pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Look at the if statements in that snippet.</p>
<pre><code class="lang-auto">if (k2 != id || l2 != i || j3 != anInt311)
        return null;
if (i3 &lt; 0 || i3 &gt; dataFile.length() / 520L)
        return null;</code></pre>
<p>It’s there to ensure the cache isn’t corrupt. Data in the cache is split into non-contiguous “sectors”, 520 bytes in length. Each contain an 8-byte header (the data you’re unsure about). k2 is the file id (i.e. the parameter of that method, “id”), l2 is the number of sectors read so far, i3 is the next offset (sector) to read the data from (if there’s more data to read) and j3 is the index id (.idx0, .idx1, .idx2…)</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Native1.html'><span itemprop='name'>Native1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T20:17:47Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:03Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Let me think. So, the buffer array ['0] - ['7] is the 8-byte header. k2 is the sector id? And l2 is data stored in that sector which says how many sectors you have read. And i3 is next sector that I can reach by using the seek method. And j3 is also data in the current sector which confirms we are still reading the right file? Please correct me if I’m wrong <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/iKilem.html'><span itemprop='name'>iKilem</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T20:37:42Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:05Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>k2 is the file id. You know when you call that method, you pass an argument specifying which file you want by id. It’s the same thing.</p>
<p>j3 is the index id. When you say “right file”, if you’re talking about the .idx file, then you are correct, but you’re not reading that file at that point. The .idx file contains the file lengths (<span class="bbcode-i">size</span> in that code) as well as the initial offsets of the files (<span class="bbcode-i">pointIndex</span> in that code). Look at how that data is used.</p>
<p>Everything else sounds about right.</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Native1.html'><span itemprop='name'>Native1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T20:47:09Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:06Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Okay, I think I get it. But I still don’t understand what you mean with file id (k2). The file id is not the number after .idx (.idx0 - .idx 4) right? Because that’s j3. Or is that id the archive id? (“title”, “config”, “interface”, “media” etc. etc.).</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/iKilem.html'><span itemprop='name'>iKilem</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T20:54:14Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:07Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yes, it’s the archive id, although it’s only .idx0 files that are archives. In general, I would just call it the file id.</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Native1.html'><span itemprop='name'>Native1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T20:58:42Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:07Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks, helped me alot.</p>
      </div>

      <meta itemprop='headline' content='The Decompressor class'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/the-decompressor-class/427903 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:42:10 GMT -->
</html>
