<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Hyperion - Loading NPC Definitions from the Cache</title>
    <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783</link>
    <description>I&#39;ve decided to rewrite this snippet, it was pretty poorly done before and hard to understand.

Replace your current NPCDefinition class with this:

[code=java]
package net.gielinor.rs2.game.model.def;

/**
 * Represents various attributes of an {@link NPC}.
 * 
 * @author Graham
 * @author Ryley Kimmel &lt;ryley.kimmel@live.com&gt;
 * 
 */
public final class NPCDefinition {

	// TODO: Documentation

	/**
	 * The maximum number of npc definitions
	 */
	private static final int MAX_DEFINITIONS = 3852;

	/**
	 * An array of npc definitions
	 */
	private static final NPCDefinition[] definitions = new NPCDefinition[MAX_DEFINITIONS];

	/**
	 * Adds a definition. TODO better way?
	 * 
	 * @param def
	 *            The definition.
	 */
	public static void addDefinition(NPCDefinition def) {
		definitions[def.getId()] = def;
	}

	/**
	 * Gets an npc definition by its id.
	 * 
	 * @param id
	 *            The id.
	 * @return The definition.
	 */
	public static NPCDefinition forId(int id) {
		if (id &lt; 0 || id &gt;= definitions.length) {
			throw new IndexOutOfBoundsException();
		}
		return definitions[id];
	}

	private final int id;

	private String name;

	private String description;

	private int size = 1;

	private int standAnim = -1, walkAnim = -1, walkBackAnim = -1, walkLeftAnim = -1, walkRightAnim = -1;

	private String[] interactions = new String[5];

	private int combatLevel = -1;

	public NPCDefinition(int id, String name, String description, int size, int standAnim, int walkAnim, int walkBackAnim, int walkLeftAnim, int walkRightAnim, String[] interactions, int combatLevel) {
		this.id = id;
		this.name = name;
		this.description = description;
		this.size = size;
		this.standAnim = standAnim;
		this.walkAnim = walkAnim;
		this.walkBackAnim = walkBackAnim;
		this.walkLeftAnim = walkLeftAnim;
		this.walkRightAnim = walkRightAnim;
		this.interactions = interactions;
		this.combatLevel = combatLevel;
	}

	public int getId() {
		return id;
	}

	public String getName() {
		return name;
	}

	public String getDescription() {
		return description;
	}

	public int getSize() {
		return size;
	}

	public int getStandAnimation() {
		return standAnim;
	}

	public int getWalkAnimation() {
		return walkAnim;
	}

	public int getWalkBackAnimation() {
		return walkBackAnim;
	}

	public int getWalkLeftAnimation() {
		return walkLeftAnim;
	}

	public int getWalkRightAnimation() {
		return walkRightAnim;
	}

	public String getInteraction(int slot) {
		if (slot &lt; 0 || slot &gt;= interactions.length) {
			throw new IndexOutOfBoundsException();
		}
		return interactions[slot];
	}

	public String[] getInteractions() {
		return interactions;
	}

	public int getCombatLevel() {
		return combatLevel;
	}

	public boolean hasStandAnimation() {
		return standAnim != -1;
	}

	public boolean hasWalkAnimation() {
		return walkAnim != -1;
	}

	public boolean hasWalkBackAnimation() {
		return walkBackAnim != -1;
	}

	public boolean hasWalkLeftAnimation() {
		return walkLeftAnim != -1;
	}

	public boolean hasWalkRightAnimation() {
		return walkRightAnim != -1;
	}

	public boolean hasInteraction(int slot) {
		if (slot &lt; 0 || slot &gt;= interactions.length) {
			throw new IndexOutOfBoundsException();
		}
		return interactions[slot] != null;
	}

	public boolean hasCombatLevel() {
		return combatLevel != -1;
	}

	public void setName(String name) {
		this.name = name;
	}

	public void setDescription(String description) {
		this.description = description;
	}

	public void setSize(int size) {
		this.size = size;
	}

	public void setStandAnimation(int standAnim) {
		this.standAnim = standAnim;
	}

	public void setWalkAnimation(int walkAnim) {
		this.walkAnim = walkAnim;
	}

	public void setWalkAnimations(int walkAnim, int walkBackAnim, int walkLeftAnim, int walkRightAnim) {
		this.walkAnim = walkAnim;
		this.walkBackAnim = walkBackAnim;
		this.walkLeftAnim = walkLeftAnim;
		this.walkRightAnim = walkRightAnim;
	}

	public void setInteraction(int slot, String interaction) {
		if (slot &lt; 0 || slot &gt;= interactions.length) {
			throw new IndexOutOfBoundsException();
		}
		interactions[slot] = interaction;
	}

	public void setCombatLevel(int combatLevel) {
		this.combatLevel = combatLevel;
	}

}[/code]

You will need the NPCManager class:

[code=java]
package net.gielinor.rs2.game.model.npc;

import java.io.File;
import java.io.IOException;
import java.util.logging.Logger;

import net.gielinor.cache.Cache;
import net.gielinor.cache.InvalidCacheException;
import net.gielinor.cache.index.impl.StandardIndex;
import net.gielinor.cache.npc.NPCDefinitionListener;
import net.gielinor.cache.npc.NPCDefinitionParser;
import net.gielinor.rs2.game.model.def.NPCDefinition;

/**
 * Manages all world npcs
 * 
 * @author Ryley Kimmel &lt;ryley.kimmel@live.com&gt;
 * Apr 15, 2013
 * NPCManager.java
 *
 * @see net.gielinor.cache.npc.NPCDefinitionListener
 * @see java.lang.Object
 */
public final class NPCManager implements NPCDefinitionListener {

	/**
	 * Logger instance.
	 */
	private static final Logger logger = Logger.getLogger(NPCManager.class.getName());

	/**
	 * The number of definitions loaded.
	 */
	private int definitionCount = 0;

	/**
	 * Loads the npcs from the cache.
	 * 
	 * @throws IOException
	 *             if an I/O error occurs.
	 * @throws InvalidCacheException
	 *             if the cache is invalid.
	 */
	public void load() throws IOException, InvalidCacheException {
		Cache cache = new Cache(new File(&quot;./data/cache/&quot;));
		try {
			logger.info(&quot;Loading definitions...&quot;);
			StandardIndex[] defIndices = cache.getIndexTable().getNPCDefinitionIndicies();
			new NPCDefinitionParser(cache, defIndices, this).parse();
			logger.info(&quot;Loaded &quot; + definitionCount + &quot; npc definitions.&quot;);
		} finally {
			cache.close();
		}
	}

	@Override
	public void npcDefinitionParsed(NPCDefinition def) {
		definitionCount++;
		NPCDefinition.addDefinition(def);
	}

}[/code]

And you will need the blueprints for the definition parser as well as the parser itself:

[code=java]
package net.gielinor.cache.npc;

import net.gielinor.rs2.game.model.def.NPCDefinition;

/**
 * Blueprints for parsing {@link NPCDefinition}&#39;s
 * 
 * @author Ryley Kimmel &lt;ryley.kimmel@live.com&gt;
 * Apr 15, 2013
 * NPCDefinitionListener.java
 * 
 * @see java.lang.Object
 */
public interface NPCDefinitionListener {

	/**
	 * Called when an npc definition is parsed.
	 * 
	 * @param def The definition that was parsed.
	 */
	void npcDefinitionParsed(NPCDefinition def);

}[/code]

[code=java]
package net.gielinor.cache.npc;

import java.io.IOException;
import java.nio.ByteBuffer;

import net.gielinor.cache.Archive;
import net.gielinor.cache.Cache;
import net.gielinor.cache.index.impl.StandardIndex;
import net.gielinor.cache.util.ByteBufferUtils;
import net.gielinor.rs2.game.model.def.NPCDefinition;

/**
 * Parses the npc definitions from the game cache
 * 
 * @author Graham Edgecombe
 * @author Ryley Kimmel &lt;ryley.kimmel@live.com&gt;
 * Apr 15, 2013
 * NPCDefinitionListener.java
 * 
 * @see java.lang.Object
 */
public final class NPCDefinitionParser {

	/**
	 * The cache.
	 */
	private Cache cache;

	/**
	 * The index.
	 */
	private StandardIndex[] indices;

	/**
	 * The listener.
	 */
	private NPCDefinitionListener listener;

	/**
	 * Creates the npc definition parser.
	 * 
	 * @param cache
	 *            The cache.
	 * @param indices
	 *            The indices in the cache.
	 * @param listener
	 *            The npc definition listener.
	 */
	public NPCDefinitionParser(Cache cache, StandardIndex[] indices, NPCDefinitionListener listener) {
		this.cache = cache;
		this.indices = indices;
		this.listener = listener;
	}

	/**
	 * Parses the npc definitions in the cache.
	 * 
	 * @throws IOException
	 *             if an I/O error occurs.
	 */
	@SuppressWarnings(&quot;unused&quot;)
	public void parse() throws IOException {
		ByteBuffer buffer = new Archive(cache.getFile(0, 2)).getFileAsByteBuffer(&quot;npc.dat&quot;);

		for (StandardIndex index : indices) {
			int id = index.getIdentifier();
			buffer.position(index.getOffset());
			
			String[] interactions = new String[5];
			String name = &quot;null&quot;;
			String description = null;
			byte size = 1;
			short standAnimation= -1, walkAnimation= -1, walkBackAnimation= -1, walkRightAnimation= -1, walkLeftAnimation= -1;
			short combatLevel = -1;
			int config;
	        outer: do {
	            config = buffer.get() &amp; 0xFF;
	            if (config == 0) {
	                break outer;
	            } else if (config == 1) {
	                int length = buffer.get() &amp; 0xFF;
	                int[] npcModels = new int[length];
	                for (int i = 0; i &lt; length; i++) {
	                    npcModels[i] = buffer.getShort();
	                }
	            } else if (config == 2) {
	                name = ByteBufferUtils.getString(buffer);
	            } else if (config == 3) {
	                description = ByteBufferUtils.getString(buffer);
	            } else if (config == 12) {
	                size = buffer.get();
	            } else if (config == 13) {
	                standAnimation = buffer.getShort();
	            } else if (config == 14) {
	                walkAnimation = buffer.getShort();
	            } else if (config == 17) {
	            	walkAnimation = buffer.getShort();
	            	walkBackAnimation = buffer.getShort();
	            	walkLeftAnimation = buffer.getShort();
	            	walkRightAnimation = buffer.getShort();
	            } else if (config &gt;= 30 &amp;&amp; config &lt; 40) {
	                String str = ByteBufferUtils.getString(buffer);
	                if (str.equals(&quot;hidden&quot;)) {
	                    str = null;
	                }
	                interactions[config - 30] = str;
	            } else if (config == 40) {
	                int length = buffer.get() &amp; 0xFF;
	                int[] originalModelColours = new int[length];
	                int[] newModelColours = new int[length];
	                for (int i = 0; i &lt; length; i++) {
	                    originalModelColours[i] = buffer.getShort();
	                    newModelColours[i] = buffer.getShort();
	                }
	            } else if (config == 60) {
	                int length = buffer.get() &amp; 0xFF;
	                int[] additionalModels = new int[length];
	                for (int i = 0; i &lt; length; i++) {
	                    additionalModels[i] = buffer.getShort();
	                }
	            } else if (config == 90) {
	                buffer.getShort();
	            } else if (config == 91) {
	                buffer.getShort();
	            } else if (config == 92) {
	                buffer.getShort();
	            } else if (config == 93) {
	                boolean drawMinimapDot = false;
	            } else if (config == 95) {
	                combatLevel = buffer.getShort();
	            } else if (config == 97) {
	                int scaleX = buffer.getShort();
	            } else if (config == 98) {
	                int scaleY = buffer.getShort();
	            } else if (config == 99) {
	                boolean unknown = true;
	            } else if (config == 100) {
	                int lightModifier = buffer.get();
	            } else if (config == 101) {
	                int shadowModifier = buffer.get() * 5;
	            } else if (config == 102) {
	                int headIcon = buffer.getShort();
	            } else if (config == 103) {
	                int degreesToRotate = buffer.getShort();
	            } else if (config == 106) {
	                int varBitId = buffer.getShort();
	                if (varBitId == 65535) {
	                    varBitId = -1;
	                }
	                int configId = buffer.getShort();
	                if (configId == 65535) {
	                    configId = -1;
	                }
	                int count = buffer.get() &amp; 0xFF;
	                int[] childIds = new int[count + 1];
	                for (int i = 0; i &lt;= count; i++) {
	                    int val = buffer.getShort();
	                    if (val == 65535) {
	                        val = -1;
	                    }
	                    childIds[i] = val;
	                }
	            } else if (config == 107) {
	                boolean clickable = false;
	            }
	        } while (true);
			listener.npcDefinitionParsed(new NPCDefinition(id, name, description, size, standAnimation, walkAnimation, walkBackAnimation, walkLeftAnimation, walkRightAnimation, interactions, combatLevel));
		}
	}

}[/code]

Next, in the IndexTable class, you need to add the following:

[code=java]
	/**
	 * An array of npc def indices
	 */
	private StandardIndex[] npcDefinitionIndices;

	/**
	 * Initializes the npc definition indices.
	 * 
	 * @param configArchive
	 *            The config archive.
	 * @throws IOException
	 *             if an I/O error occurs.
	 */
	private void initNPCDefIndices(Archive configArchive) throws IOException {
		ByteBuffer buf = configArchive.getFileAsByteBuffer(&quot;npc.idx&quot;);
		int npcCount = buf.getShort() &amp; 0xFFFF;
		npcDefinitionIndices = new StandardIndex[npcCount];
		int offset = 2;
		for (int id = 0; id &lt; npcCount; id++) {
			npcDefinitionIndices[id] = new StandardIndex(id, offset);
			offset += buf.getShort() &amp; 0xFFFF;
		}
	}

	/**
	 * Gets all of the npc definition indices.
	 * 
	 * @return The npc definition indices array.
	 */
	public StandardIndex[] getNPCDefinitionIndicies() {
		return npcDefinitionIndices;
	}

	/**
	 * Gets a single npc definition index.
	 * 
	 * @param npc
	 *            The npc id.
	 * @return The index.
	 */
	public StandardIndex getNPCDefinitionIndex(int npc) {
		return npcDefinitionIndices[npc];
	}
[/code]

Then in the same class, you need to replace your IndexTable constructor with this:

[code=java]
	public IndexTable(Cache cache) throws IOException {
		Archive configArchive = new Archive(cache.getFile(0, 2));
		initObjectDefIndices(configArchive);
		initNPCDefIndices(configArchive);

		Archive versionListArchive = new Archive(cache.getFile(0, 5));
		initMapIndices(versionListArchive);
	}[/code]

Now in World add the following:
[code=java]
	/**
	 * The game npc manager.
	 */
	private NPCManager npcManager;

	/**
	 * Gets the game npc manager
	 */
	public NPCManager getNPCManager() {
		return npcManager;
	}[/code]

And finally, add the initialization to the World constructor:

[code=java]
		backgroundLoader.submit(new Callable&lt;Object&gt;() {
			@Override
			public Object call() throws Exception {
				npcManager = new NPCManager();
				npcManager.load();
				return null;
			}
		});[/code]

Remember to change your packaging and imports.</description>
    
    <lastBuildDate>Thu, 17 Oct 2013 19:43:42 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>Wrong Arham, I would explain it but this explains it a lot better than I would:</p>
<p><a href="http://stackoverflow.com/questions/680656/what-is-the-difference-between-if-else-and-switch" class="onebox" target="_blank" rel="nofollow noopener">http://stackoverflow.com/questions/680656/what-is-the-difference-between-if-else-and-switch</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/25">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/25</link>
        <pubDate>Thu, 17 Oct 2013 19:43:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-25</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@strucker Strucker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/strucker">@strucker</a> wrote:</p>
          <blockquote>
              <p>[quote=“arham 4, post:10, topic:461783”]Only difference between switch and if-else statements is compilation time.[/quote]wich is faster? if statement?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/24">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/24</link>
        <pubDate>Thu, 17 Oct 2013 19:36:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-24</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>Well deserved bump.</p>
<p>Also,</p>
<pre><code class="lang-auto">buffer.position(index.getOffset());</code></pre>
<p>Could you give me this [tt]getOffSet()[/tt]?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/23">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/23</link>
        <pubDate>Thu, 17 Oct 2013 17:41:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-23</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@dwarfs222 dwarfs222]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dwarfs222">@dwarfs222</a> wrote:</p>
          <blockquote>
              <p>[quote=“tyb97, post:21, topic:461783”][quote author=dwarfs222 link=topic=564729.msg4285121#msg4285121 date=1366234551]<br>
Nice.</p>
<p>O.T: Team_Rocket, why are you a junior member?<br>
[/quote]<br>
*Teem_Rocket</p>
<p>(Different account)[/quote]<br>
Whoops, didn’t see.<br>
Thanks <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/22">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/22</link>
        <pubDate>Thu, 18 Apr 2013 16:39:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-22</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@tyb97 tyb97]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tyb97">@tyb97</a> wrote:</p>
          <blockquote>
              <p>[quote=“dwarfs222, post:20, topic:461783”]Nice.</p>
<p>O.T: Team_Rocket, why are you a junior member?[/quote]<br>
*Teem_Rocket</p>
<p>(Different account)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/21</link>
        <pubDate>Wed, 17 Apr 2013 21:37:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-21</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@dwarfs222 dwarfs222]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dwarfs222">@dwarfs222</a> wrote:</p>
          <blockquote>
              <p>Nice.</p>
<p>O.T: Team_Rocket, why are you a junior member?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/20</link>
        <pubDate>Wed, 17 Apr 2013 21:35:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-20</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>Didn’t see your second post.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/19</link>
        <pubDate>Tue, 16 Apr 2013 22:36:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-19</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:16, topic:461783”][quote author=arham 4 link=topic=564729.msg4283922#msg4283922 date=1366082682]<br>
Only difference between switch and if-else statements is compilation time.<br>
[/quote]</p>
<p>And aside from the fact that you can’t switch doubles, floats, booleans or longs.[/quote]</p>
<p>[quote=“arham 4, post:13, topic:461783”][quote author=Teem_Rocket link=topic=564729.msg4283939#msg4283939 date=1366083785]</p>
<aside class="quote">
<blockquote>
<p>Only difference between switch and if-else statements is compilation time.</p>
</blockquote>
</aside>
<p>Organization, neatness, and structure are the primary reasons to use alternatives.<br>
[/quote]<br>
If-else blocks are more flexible (The ability to add more than 1 cause, ability to use boolean, etc). Plus, reading them in english really makes more sense imo.[/quote]</p>
<p>As I said Ryley &lt;3</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/18</link>
        <pubDate>Tue, 16 Apr 2013 22:18:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-18</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <p>[quote=“Teem_Rocket, post:15, topic:461783”][quote author=relexlawl link=topic=564729.msg4283955#msg4283955 date=1366086968]<br>
I swear your posts/comments get stupider every time I see them.<br>
[/quote]</p>
<p>Are you saying that because they’re situational and you have a valid point if so, or are you still just butthurt?[/quote]</p>
<p>Lol why would I be butt-hurt? XD</p>
<p>It’s just annoying how you keep talking out of your ass…</p>
<p>You say there are other things in java besides if statements? Yes, pretty sure we all know that…Your comment is as valid as the enum vs array argument.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/17</link>
        <pubDate>Tue, 16 Apr 2013 20:11:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-17</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="10" data-topic="461783">
<div class="title">
<div class="quote-controls"></div>
 arham 4:</div>
<blockquote>
<p>Only difference between switch and if-else statements is compilation time.</p>
</blockquote>
</aside>
<p>And aside from the fact that you can’t switch doubles, floats, booleans or longs.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/16</link>
        <pubDate>Tue, 16 Apr 2013 19:58:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-16</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@Teem_Rocket Teem_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/teem_rocket">@Teem_Rocket</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="12" data-topic="461783">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/relexlawl/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> relexlawl:</div>
<blockquote>
<p>I swear your posts/comments get stupider every time I see them.</p>
</blockquote>
</aside>
<p>Are you saying that because they’re situational and you have a valid point if so, or are you still just butthurt?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/15</link>
        <pubDate>Tue, 16 Apr 2013 16:10:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-15</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <p><span class="bbcode-s">I though something like this was already released on r-s and</span> why isn’t everybody doing this already?<br>
^ Didn’t read thread properly.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/14</link>
        <pubDate>Tue, 16 Apr 2013 15:22:46 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-14</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>[quote=“Teem_Rocket, post:11, topic:461783”][quote author=arham 4 link=topic=564729.msg4283922#msg4283922 date=1366082682]<br>
Only difference between switch and if-else statements is compilation time.<br>
[/quote]</p>
<p>Organization, neatness, and structure are the primary reasons to use alternatives.[/quote]<br>
If-else blocks are more flexible (The ability to add more than 1 cause, ability to use boolean, etc). Plus, reading them in english really makes more sense imo.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/13</link>
        <pubDate>Tue, 16 Apr 2013 12:21:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-13</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <p>[quote=“Teem_Rocket, post:9, topic:461783”][quote author=AtomicInt_ link=topic=564729.msg4283826#msg4283826 date=1366074703]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>Bumpy bump. I’ve redone this and made it a little easier to understand.</p>
</blockquote>
</aside>
<p>It deserves it compared to most. I like it, It’s well-structured, organized, and documented. I’m not a big fan of your statements, but to each their own.</p>
</blockquote>
</aside>
<p>What do you mean my statements?<br>
[/quote]</p>
<p>I told you via Skype. If anyone reading this is wondering what I meant, there are alternatives to else-if blocks. These alternatives include: The Ternary Operator (not applicable in this situation), Switch Statements, etc.[/quote]</p>
<p>I swear your posts/comments get stupider every time I see them.</p>
<p>Don’t really think the npc information in cache is good for server-side use in all honesty (maybe the name and combat level), you should get information from dumps/bestiary and make your own file, i.e:</p>
<p>[code]package org.niobe.model.definitions;</p>
<p>import java.io.DataInputStream;<br>
import java.io.DataOutputStream;<br>
import java.io.FileInputStream;<br>
import java.io.FileOutputStream;<br>
import java.io.IOException;</p>
<p>import org.niobe.model.Animation;</p>
<p>/**</p>
<ul>
<li>This file manages the parsing of npc definitions, such as their</li>
<li>combat level, size, name, descriptions, etc.</li>
<li>
</li>
<li>
<span class="mention">@author</span> relex lawl<br>
*/</li>
</ul>
<p>public class NPCDefinition {</p>
<pre><code>/**
 * NPCDefinition array containing every npc definition instance.
 */
private static NPCDefinition[] definitions;

/**
 * The directory in which the npc definitions file is located.
 */
private static final String FILE_DIRECTORY = "./data/cache/npc_definitions.dat";

/**
 * Initializes the parsing of the npc cache file.
 */
public static void init() {
	long startup = System.currentTimeMillis();
	int amount = 0;
	System.out.println("Loading npc definitions...");
	DataInputStream input = null;
	try {
		input = new DataInputStream(new FileInputStream(FILE_DIRECTORY));
		int total = input.readShort();
		definitions = new NPCDefinition[total];
		while (true) {
				NPCDefinition definition = new NPCDefinition();
				definition.id = input.readShort();
				definition.name = input.readUTF();
				definition.description = input.readUTF();
				definition.size = input.readByte();
				definition.level = input.readShort();
				definition.members = input.readBoolean();
				definition.lifePoints = input.readShort();
				definition.attackable = input.readBoolean();
				definition.aggressive = input.readBoolean();
				definition.poisonous = input.readBoolean();
				definition.attackAnimation = new Animation(input.readShort());
				definition.rangeAnimation = new Animation(input.readShort());
				definition.deathAnimation = new Animation(input.readShort());
				definition.attackLevel = input.readByte();
				definition.rangedLevel = input.readByte();
				definition.magicLevel = input.readByte();
				definition.defenceLevel = input.readByte();
				definition.weakness = input.readUTF();
				definition.slayerKey = input.readUTF();
				definition.slayerRequirement = input.readByte();
				definition.areas = new String[input.readByte()];
				for (int i = 0; i &lt; definition.areas.length; i++) {
					definition.areas[i] = input.readUTF();
					if (definition.areas[i].length() &lt;= 0)
						definition.areas[i] = null;
				}
				definitions[definition.id] = definition;
				amount++;
		}
	} catch (IOException exception) {
		if (input != null) {
			try {
				input.close();
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
	}
	System.out.println("Loaded " + amount + " npc definitions in " + (System.currentTimeMillis() - startup) + "ms");
}

/**
 * Used to rewrite the npc definitions.
 * You will first need to edit the npc definition before writing it 
 * of course.
 * @param directory		The location to store the newly written file.
 */
public static void write(String directory) throws IOException {
	if (directory.length() &lt;= 0) {
		throw new IllegalArgumentException("Directory length must be greater than 0!");
	}
	DataOutputStream output = new DataOutputStream(new FileOutputStream(directory));
	for (NPCDefinition definition : definitions) {
		if (definition == null)
			continue;
		output.writeShort(definition.id);
		output.writeUTF(definition.name);
		output.writeUTF(definition.description);
		output.writeByte(definition.size);
		output.writeShort(definition.level);
		output.writeBoolean(definition.members);
		output.writeShort(definition.lifePoints);
		output.writeBoolean(definition.attackable);
		output.writeBoolean(definition.aggressive);
		output.writeBoolean(definition.poisonous);
		output.writeShort(definition.attackAnimation.getId());
		output.writeShort(definition.rangeAnimation.getId());
		output.writeShort(definition.deathAnimation.getId());
		output.writeByte(definition.attackLevel);
		output.writeByte(definition.rangedLevel);
		output.writeByte(definition.magicLevel);
		output.writeByte(definition.defenceLevel);
		output.writeUTF(definition.weakness.toUpperCase());
		output.writeUTF(definition.slayerKey.toUpperCase());
		output.writeByte(definition.slayerRequirement);
		output.writeByte(definition.areas.length);
		for (int i = 0; i &lt; definition.areas.length; i++) {
			output.writeUTF(definition.areas[i].toUpperCase());
		}
	}
}

/**
 * Returns NPCDefinition instance for a specified NPC Id.
 * @param id	NPC Id to fetch definition for.
 * @return		definitions[id].
 */
public static NPCDefinition forId(int id) {
	return (id &lt; 0 || id &gt; definitions.length || definitions[id] == null) ? new NPCDefinition() : definitions[id];
}

private int id;

private String name = "Null";

private String description = "Null";

private int size;

private int level;

private boolean members;

private int lifePoints;

private boolean attackable;

private boolean aggressive;

private boolean poisonous;

private Animation attackAnimation;

private Animation rangeAnimation;

private Animation deathAnimation;

private int attackLevel;

private int rangedLevel;

private int magicLevel;

private int defenceLevel;

private String weakness;

private String slayerKey = "Null";

private int slayerRequirement;

private String[] areas;

public int getId() {
	return id;
}

public String getName() {
	return name;
}

public String getDescription() {
	return description;
}

public int getSize() {
	return size;
}

public int getLevel() {
	return level;
}

public boolean isMembers() {
	return members;
}

public int getLifePoints() {
	return lifePoints;
}

public boolean isAttackable() {
	return attackable;
}

public boolean isAggressive() {
	return aggressive;
}

public boolean isPoisonous() {
	return poisonous;
}

public Animation getAttackAnimation() {
	return attackAnimation;
}

public Animation getRangeAnimation() {
	return rangeAnimation;
}

public Animation getDeathAnimation() {
	return deathAnimation;
}

public int getAttackLevel() {
	return attackLevel;
}

public NPCDefinition setAttackLevel(int attackLevel) {
	this.attackLevel = attackLevel;
	return this;
}

public int getRangedLevel() {
	return rangedLevel;
}

public NPCDefinition setRangedLevel(int rangedLevel) {
	this.rangedLevel = rangedLevel;
	return this;
}

public int getMagicLevel() {
	return magicLevel;
}

public NPCDefinition setMagicLevel(int magicLevel) {
	this.magicLevel = magicLevel;
	return this;
}

public int getDefenceLevel() {
	return defenceLevel;
}

public NPCDefinition setDefenceLevel(int defenceLevel) {
	this.defenceLevel = defenceLevel;
	return this;
}

public String getWeakness() {
	return weakness;
}

public String getSlayerKey() {
	return slayerKey;
}

public int getSlayerRequirement() {
	return slayerRequirement;
}

public String[] getAreas() {
	return areas;
}

@Override
public String toString() {
	StringBuilder builder = new StringBuilder();
	builder.append("Name=" + name + "; Description=" + description + "Level=" + level + ";\nSize=" + size + "; MembersOnly=" + members + "; isAttackable=" + attackable + "; Weakness=" + weakness + "; isPoisonous=" + poisonous + "\nAttackAnimation=" + attackAnimation.getId() + "; RangedAnimation=" + rangeAnimation.getId() + "; DeathAnimation=" + deathAnimation.getId());
	return builder.toString();
}
</code></pre>
<p>}[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/12</link>
        <pubDate>Tue, 16 Apr 2013 04:36:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-12</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@Teem_Rocket Teem_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/teem_rocket">@Teem_Rocket</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="10" data-topic="461783">
<div class="title">
<div class="quote-controls"></div>
 arham 4:</div>
<blockquote>
<p>Only difference between switch and if-else statements is compilation time.</p>
</blockquote>
</aside>
<p>Organization, neatness, and structure are the primary reasons to use alternatives.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/11</link>
        <pubDate>Tue, 16 Apr 2013 03:43:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-11</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>Only difference between switch and if-else statements is compilation time.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/10</link>
        <pubDate>Tue, 16 Apr 2013 03:24:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-10</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@Teem_Rocket Teem_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/teem_rocket">@Teem_Rocket</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:8, topic:461783”][quote author=Teem_Rocket link=topic=564729.msg4283823#msg4283823 date=1366074578]</p>
<aside class="quote">
<blockquote>
<p>Bumpy bump. I’ve redone this and made it a little easier to understand.</p>
</blockquote>
</aside>
<p>It deserves it compared to most. I like it, It’s well-structured, organized, and documented. I’m not a big fan of your statements, but to each their own.<br>
[/quote]</p>
<p>What do you mean my statements?[/quote]</p>
<p>I told you via Skype. If anyone reading this is wondering what I meant, there are alternatives to else-if blocks. These alternatives include: The Ternary Operator (not applicable in this situation), Switch Statements, etc.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/9</link>
        <pubDate>Tue, 16 Apr 2013 01:28:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-9</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>[quote=“Teem_Rocket, post:7, topic:461783”][quote author=AtomicInt_ link=topic=564729.msg4283812#msg4283812 date=1366073081]<br>
Bumpy bump. I’ve redone this and made it a little easier to understand.<br>
[/quote]</p>
<p>It deserves it compared to most. I like it, It’s well-structured, organized, and documented. I’m not a big fan of your statements, but to each their own.[/quote]</p>
<p>What do you mean my statements?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/8</link>
        <pubDate>Tue, 16 Apr 2013 01:11:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-8</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@Teem_Rocket Teem_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/teem_rocket">@Teem_Rocket</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="6" data-topic="461783">
<div class="title">
<div class="quote-controls"></div>
 AtomicInt_:</div>
<blockquote>
<p>Bumpy bump. I’ve redone this and made it a little easier to understand.</p>
</blockquote>
</aside>
<p>It deserves it compared to most. I like it, It’s well-structured, organized, and documented. I’m not a big fan of your statements, but to each their own.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/7</link>
        <pubDate>Tue, 16 Apr 2013 01:09:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-7</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>Bumpy bump. I’ve redone this and made it a little easier to understand. I didn’t put a whole lot of time into it, though. I might make it pretty later.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/6</link>
        <pubDate>Tue, 16 Apr 2013 00:44:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-6</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <p>Looks really similar to the definition loading released for Apollo tbh.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/5</link>
        <pubDate>Mon, 24 Sep 2012 01:31:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-5</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="461783">
<div class="title">
<div class="quote-controls"></div>
 the elve age:</div>
<blockquote>
<p>good can u convert to pi plz?</p>
</blockquote>
</aside>
<p>Absolutely not. <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/4</link>
        <pubDate>Mon, 24 Sep 2012 01:14:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-4</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@the_elve_age the elve age]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_elve_age">@the_elve_age</a> wrote:</p>
          <blockquote>
              <p>good can u convert to pi plz?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/3</link>
        <pubDate>Mon, 24 Sep 2012 01:08:52 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-3</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@tyb97 tyb97]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tyb97">@tyb97</a> wrote:</p>
          <blockquote>
              <p>Amazing. I’ve never even attempted this for myself. [size=1pt]no need too anymore lol[/size]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/2</link>
        <pubDate>Mon, 24 Sep 2012 00:50:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-2</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
      <item>
        <title>Hyperion - Loading NPC Definitions from the Cache</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>I’ve decided to rewrite this snippet, it was pretty poorly done before and hard to understand.</p>
<p>Replace your current NPCDefinition class with this:</p>
<p>[code=java]<br>
package net.gielinor.rs2.game.model.def;</p>
<p>/**</p>
<ul>
<li>Represents various attributes of an {<a class="mention" href="/u/link">@link</a> NPC}.</li>
<li>
</li>
<li>
<span class="mention">@author</span> Graham</li>
<li>
<span class="mention">@author</span> Ryley Kimmel <a href="mailto:ryley.kimmel@live.com">ryley.kimmel@live.com</a>
</li>
<li>
</li>
</ul>
<p>*/<br>
public final class NPCDefinition {</p>
<pre><code>// TODO: Documentation

/**
 * The maximum number of npc definitions
 */
private static final int MAX_DEFINITIONS = 3852;

/**
 * An array of npc definitions
 */
private static final NPCDefinition[] definitions = new NPCDefinition[MAX_DEFINITIONS];

/**
 * Adds a definition. TODO better way?
 * 
 * @param def
 *            The definition.
 */
public static void addDefinition(NPCDefinition def) {
	definitions[def.getId()] = def;
}

/**
 * Gets an npc definition by its id.
 * 
 * @param id
 *            The id.
 * @return The definition.
 */
public static NPCDefinition forId(int id) {
	if (id &lt; 0 || id &gt;= definitions.length) {
		throw new IndexOutOfBoundsException();
	}
	return definitions[id];
}

private final int id;

private String name;

private String description;

private int size = 1;

private int standAnim = -1, walkAnim = -1, walkBackAnim = -1, walkLeftAnim = -1, walkRightAnim = -1;

private String[] interactions = new String[5];

private int combatLevel = -1;

public NPCDefinition(int id, String name, String description, int size, int standAnim, int walkAnim, int walkBackAnim, int walkLeftAnim, int walkRightAnim, String[] interactions, int combatLevel) {
	this.id = id;
	this.name = name;
	this.description = description;
	this.size = size;
	this.standAnim = standAnim;
	this.walkAnim = walkAnim;
	this.walkBackAnim = walkBackAnim;
	this.walkLeftAnim = walkLeftAnim;
	this.walkRightAnim = walkRightAnim;
	this.interactions = interactions;
	this.combatLevel = combatLevel;
}

public int getId() {
	return id;
}

public String getName() {
	return name;
}

public String getDescription() {
	return description;
}

public int getSize() {
	return size;
}

public int getStandAnimation() {
	return standAnim;
}

public int getWalkAnimation() {
	return walkAnim;
}

public int getWalkBackAnimation() {
	return walkBackAnim;
}

public int getWalkLeftAnimation() {
	return walkLeftAnim;
}

public int getWalkRightAnimation() {
	return walkRightAnim;
}

public String getInteraction(int slot) {
	if (slot &lt; 0 || slot &gt;= interactions.length) {
		throw new IndexOutOfBoundsException();
	}
	return interactions[slot];
}

public String[] getInteractions() {
	return interactions;
}

public int getCombatLevel() {
	return combatLevel;
}

public boolean hasStandAnimation() {
	return standAnim != -1;
}

public boolean hasWalkAnimation() {
	return walkAnim != -1;
}

public boolean hasWalkBackAnimation() {
	return walkBackAnim != -1;
}

public boolean hasWalkLeftAnimation() {
	return walkLeftAnim != -1;
}

public boolean hasWalkRightAnimation() {
	return walkRightAnim != -1;
}

public boolean hasInteraction(int slot) {
	if (slot &lt; 0 || slot &gt;= interactions.length) {
		throw new IndexOutOfBoundsException();
	}
	return interactions[slot] != null;
}

public boolean hasCombatLevel() {
	return combatLevel != -1;
}

public void setName(String name) {
	this.name = name;
}

public void setDescription(String description) {
	this.description = description;
}

public void setSize(int size) {
	this.size = size;
}

public void setStandAnimation(int standAnim) {
	this.standAnim = standAnim;
}

public void setWalkAnimation(int walkAnim) {
	this.walkAnim = walkAnim;
}

public void setWalkAnimations(int walkAnim, int walkBackAnim, int walkLeftAnim, int walkRightAnim) {
	this.walkAnim = walkAnim;
	this.walkBackAnim = walkBackAnim;
	this.walkLeftAnim = walkLeftAnim;
	this.walkRightAnim = walkRightAnim;
}

public void setInteraction(int slot, String interaction) {
	if (slot &lt; 0 || slot &gt;= interactions.length) {
		throw new IndexOutOfBoundsException();
	}
	interactions[slot] = interaction;
}

public void setCombatLevel(int combatLevel) {
	this.combatLevel = combatLevel;
}
</code></pre>
<p>}[/code]</p>
<p>You will need the NPCManager class:</p>
<p>[code=java]<br>
package net.gielinor.rs2.game.model.npc;</p>
<p>import java.io.File;<br>
import java.io.IOException;<br>
import java.util.logging.Logger;</p>
<p>import net.gielinor.cache.Cache;<br>
import net.gielinor.cache.InvalidCacheException;<br>
import net.gielinor.cache.index.impl.StandardIndex;<br>
import net.gielinor.cache.npc.NPCDefinitionListener;<br>
import net.gielinor.cache.npc.NPCDefinitionParser;<br>
import net.gielinor.rs2.game.model.def.NPCDefinition;</p>
<p>/**</p>
<ul>
<li>
<p>Manages all world npcs</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@author</span> Ryley Kimmel <a href="mailto:ryley.kimmel@live.com">ryley.kimmel@live.com</a></p>
</li>
<li>
<p>Apr 15, 2013</p>
</li>
<li>
<p>NPCManager.java</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@see</span> net.gielinor.cache.npc.NPCDefinitionListener</p>
</li>
<li>
<p><span class="mention">@see</span> java.lang.Object<br>
*/<br>
public final class NPCManager implements NPCDefinitionListener {</p>
<p>/**</p>
<ul>
<li>Logger instance.<br>
*/<br>
private static final Logger logger = Logger.getLogger(NPCManager.class.getName());</li>
</ul>
<p>/**</p>
<ul>
<li>The number of definitions loaded.<br>
*/<br>
private int definitionCount = 0;</li>
</ul>
<p>/**</p>
<ul>
<li>Loads the npcs from the cache.</li>
<li>
</li>
<li>
<span class="mention">@throws</span> IOException</li>
<li>
<pre><code>        if an I/O error occurs.
</code></pre>
</li>
<li>
<span class="mention">@throws</span> InvalidCacheException</li>
<li>
<pre><code>        if the cache is invalid.
</code></pre>
</li>
</ul>
<p>*/<br>
public void load() throws IOException, InvalidCacheException {<br>
Cache cache = new Cache(new File("./data/cache/"));<br>
try {<br>
logger.info(“Loading definitions…”);<br>
StandardIndex[] defIndices = cache.getIndexTable().getNPCDefinitionIndicies();<br>
new NPCDefinitionParser(cache, defIndices, this).parse();<br>
logger.info(“Loaded " + definitionCount + " npc definitions.”);<br>
} finally {<br>
cache.close();<br>
}<br>
}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public void npcDefinitionParsed(NPCDefinition def) {<br>
definitionCount++;<br>
NPCDefinition.addDefinition(def);<br>
}</p>
</li>
</ul>
<p>}[/code]</p>
<p>And you will need the blueprints for the definition parser as well as the parser itself:</p>
<p>[code=java]<br>
package net.gielinor.cache.npc;</p>
<p>import net.gielinor.rs2.game.model.def.NPCDefinition;</p>
<p>/**</p>
<ul>
<li>
<p>Blueprints for parsing {<a class="mention" href="/u/link">@link</a> NPCDefinition}'s</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@author</span> Ryley Kimmel <a href="mailto:ryley.kimmel@live.com">ryley.kimmel@live.com</a></p>
</li>
<li>
<p>Apr 15, 2013</p>
</li>
<li>
<p>NPCDefinitionListener.java</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@see</span> java.lang.Object<br>
*/<br>
public interface NPCDefinitionListener {</p>
<p>/**</p>
<ul>
<li>Called when an npc definition is parsed.</li>
<li>
</li>
<li>
<a class="mention" href="/u/param">@param</a> def The definition that was parsed.<br>
*/<br>
void npcDefinitionParsed(NPCDefinition def);</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code=java]<br>
package net.gielinor.cache.npc;</p>
<p>import java.io.IOException;<br>
import java.nio.ByteBuffer;</p>
<p>import net.gielinor.cache.Archive;<br>
import net.gielinor.cache.Cache;<br>
import net.gielinor.cache.index.impl.StandardIndex;<br>
import net.gielinor.cache.util.ByteBufferUtils;<br>
import net.gielinor.rs2.game.model.def.NPCDefinition;</p>
<p>/**</p>
<ul>
<li>
<p>Parses the npc definitions from the game cache</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@author</span> Graham Edgecombe</p>
</li>
<li>
<p><span class="mention">@author</span> Ryley Kimmel <a href="mailto:ryley.kimmel@live.com">ryley.kimmel@live.com</a></p>
</li>
<li>
<p>Apr 15, 2013</p>
</li>
<li>
<p>NPCDefinitionListener.java</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@see</span> java.lang.Object<br>
*/<br>
public final class NPCDefinitionParser {</p>
<p>/**</p>
<ul>
<li>The cache.<br>
*/<br>
private Cache cache;</li>
</ul>
<p>/**</p>
<ul>
<li>The index.<br>
*/<br>
private StandardIndex[] indices;</li>
</ul>
<p>/**</p>
<ul>
<li>The listener.<br>
*/<br>
private NPCDefinitionListener listener;</li>
</ul>
<p>/**</p>
<ul>
<li>Creates the npc definition parser.</li>
<li>
</li>
<li>
<a class="mention" href="/u/param">@param</a> cache</li>
<li>
<pre><code>       The cache.
</code></pre>
</li>
<li>
<a class="mention" href="/u/param">@param</a> indices</li>
<li>
<pre><code>       The indices in the cache.
</code></pre>
</li>
<li>
<a class="mention" href="/u/param">@param</a> listener</li>
<li>
<pre><code>       The npc definition listener.
</code></pre>
</li>
</ul>
<p>*/<br>
public NPCDefinitionParser(Cache cache, StandardIndex[] indices, NPCDefinitionListener listener) {<br>
this.cache = cache;<br>
this.indices = indices;<br>
this.listener = listener;<br>
}</p>
<p>/**</p>
<ul>
<li>Parses the npc definitions in the cache.</li>
<li>
</li>
<li>
<span class="mention">@throws</span> IOException</li>
<li>
<pre><code>        if an I/O error occurs.
</code></pre>
</li>
</ul>
<p>*/<br>
<span class="mention">@SuppressWarnings</span>(“unused”)<br>
public void parse() throws IOException {<br>
ByteBuffer buffer = new Archive(cache.getFile(0, 2)).getFileAsByteBuffer(“npc.dat”);</p>
<pre><code> for (StandardIndex index : indices) {
 	int id = index.getIdentifier();
 	buffer.position(index.getOffset());
 	
 	String[] interactions = new String[5];
 	String name = "null";
 	String description = null;
 	byte size = 1;
 	short standAnimation= -1, walkAnimation= -1, walkBackAnimation= -1, walkRightAnimation= -1, walkLeftAnimation= -1;
 	short combatLevel = -1;
 	int config;
     outer: do {
         config = buffer.get() &amp; 0xFF;
         if (config == 0) {
             break outer;
         } else if (config == 1) {
             int length = buffer.get() &amp; 0xFF;
             int[] npcModels = new int[length];
             for (int i = 0; i &lt; length; i++) {
                 npcModels[i] = buffer.getShort();
             }
         } else if (config == 2) {
             name = ByteBufferUtils.getString(buffer);
         } else if (config == 3) {
             description = ByteBufferUtils.getString(buffer);
         } else if (config == 12) {
             size = buffer.get();
         } else if (config == 13) {
             standAnimation = buffer.getShort();
         } else if (config == 14) {
             walkAnimation = buffer.getShort();
         } else if (config == 17) {
         	walkAnimation = buffer.getShort();
         	walkBackAnimation = buffer.getShort();
         	walkLeftAnimation = buffer.getShort();
         	walkRightAnimation = buffer.getShort();
         } else if (config &gt;= 30 &amp;&amp; config &lt; 40) {
             String str = ByteBufferUtils.getString(buffer);
             if (str.equals("hidden")) {
                 str = null;
             }
             interactions[config - 30] = str;
         } else if (config == 40) {
             int length = buffer.get() &amp; 0xFF;
             int[] originalModelColours = new int[length];
             int[] newModelColours = new int[length];
             for (int i = 0; i &lt; length; i++) {
                 originalModelColours[i] = buffer.getShort();
                 newModelColours[i] = buffer.getShort();
             }
         } else if (config == 60) {
             int length = buffer.get() &amp; 0xFF;
             int[] additionalModels = new int[length];
             for (int i = 0; i &lt; length; i++) {
                 additionalModels[i] = buffer.getShort();
             }
         } else if (config == 90) {
             buffer.getShort();
         } else if (config == 91) {
             buffer.getShort();
         } else if (config == 92) {
             buffer.getShort();
         } else if (config == 93) {
             boolean drawMinimapDot = false;
         } else if (config == 95) {
             combatLevel = buffer.getShort();
         } else if (config == 97) {
             int scaleX = buffer.getShort();
         } else if (config == 98) {
             int scaleY = buffer.getShort();
         } else if (config == 99) {
             boolean unknown = true;
         } else if (config == 100) {
             int lightModifier = buffer.get();
         } else if (config == 101) {
             int shadowModifier = buffer.get() * 5;
         } else if (config == 102) {
             int headIcon = buffer.getShort();
         } else if (config == 103) {
             int degreesToRotate = buffer.getShort();
         } else if (config == 106) {
             int varBitId = buffer.getShort();
             if (varBitId == 65535) {
                 varBitId = -1;
             }
             int configId = buffer.getShort();
             if (configId == 65535) {
                 configId = -1;
             }
             int count = buffer.get() &amp; 0xFF;
             int[] childIds = new int[count + 1];
             for (int i = 0; i &lt;= count; i++) {
                 int val = buffer.getShort();
                 if (val == 65535) {
                     val = -1;
                 }
                 childIds[i] = val;
             }
         } else if (config == 107) {
             boolean clickable = false;
         }
     } while (true);
 	listener.npcDefinitionParsed(new NPCDefinition(id, name, description, size, standAnimation, walkAnimation, walkBackAnimation, walkLeftAnimation, walkRightAnimation, interactions, combatLevel));
 }
</code></pre>
<p>}</p>
</li>
</ul>
<p>}[/code]</p>
<p>Next, in the IndexTable class, you need to add the following:</p>
<pre><code class="lang-auto">	/**
	 * An array of npc def indices
	 */
	private StandardIndex[] npcDefinitionIndices;

	/**
	 * Initializes the npc definition indices.
	 * 
	 * @param configArchive
	 *            The config archive.
	 * @throws IOException
	 *             if an I/O error occurs.
	 */
	private void initNPCDefIndices(Archive configArchive) throws IOException {
		ByteBuffer buf = configArchive.getFileAsByteBuffer("npc.idx");
		int npcCount = buf.getShort() &amp; 0xFFFF;
		npcDefinitionIndices = new StandardIndex[npcCount];
		int offset = 2;
		for (int id = 0; id &lt; npcCount; id++) {
			npcDefinitionIndices[id] = new StandardIndex(id, offset);
			offset += buf.getShort() &amp; 0xFFFF;
		}
	}

	/**
	 * Gets all of the npc definition indices.
	 * 
	 * @return The npc definition indices array.
	 */
	public StandardIndex[] getNPCDefinitionIndicies() {
		return npcDefinitionIndices;
	}

	/**
	 * Gets a single npc definition index.
	 * 
	 * @param npc
	 *            The npc id.
	 * @return The index.
	 */
	public StandardIndex getNPCDefinitionIndex(int npc) {
		return npcDefinitionIndices[npc];
	}</code></pre>
<p>Then in the same class, you need to replace your IndexTable constructor with this:</p>
<p>[code=java]<br>
public IndexTable(Cache cache) throws IOException {<br>
Archive configArchive = new Archive(cache.getFile(0, 2));<br>
initObjectDefIndices(configArchive);<br>
initNPCDefIndices(configArchive);</p>
<pre><code>	Archive versionListArchive = new Archive(cache.getFile(0, 5));
	initMapIndices(versionListArchive);
}[/code]
</code></pre>
<p>Now in World add the following:</p>
<p>[code=java]<br>
/**<br>
* The game npc manager.<br>
*/<br>
private NPCManager npcManager;</p>
<pre><code>/**
 * Gets the game npc manager
 */
public NPCManager getNPCManager() {
	return npcManager;
}[/code]
</code></pre>
<p>And finally, add the initialization to the World constructor:</p>
<p><code>
		backgroundLoader.submit(new Callable&lt;Object&gt;() {
			@Override
			public Object call() throws Exception {
				npcManager = new NPCManager();
				npcManager.load();
				return null;
			}
		});</code></p>
<p>Remember to change your packaging and imports.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783/1</link>
        <pubDate>Mon, 24 Sep 2012 00:27:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-461783-1</guid>
        <source url="https://forum.moparisthebest.com/t/hyperion-loading-npc-definitions-from-the-cache/461783.rss">Hyperion - Loading NPC Definitions from the Cache</source>
      </item>
  </channel>
</rss>
