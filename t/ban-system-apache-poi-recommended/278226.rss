<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Ban System - Apache POI - Recommended</title>
    <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226</link>
    <description>NOTE: If you don&#39;t want to use the whole api, then extract only the class files needed (look at imports) and remove the imports. Then you don&#39;t have to change your compiler or runserver

Apache POI:

[url=http://poi.apache.org/overview.html]http://poi.apache.org/overview.html[/url]

[b]Purpose:[/b] Replace your old ban system with a new and better one using the apache POI api!

This features faster loading, and files only load once (on server initialization the file is saved to an ArrayList), unlike how it&#39;s currently set up (loads file EVERY login).

Requires ONE command (no ::ipban, ::tempban, ::permban, just a ::ban ID PLAYER). Even with one command, it STILL has more ban types! Look at them all:

[B]ID - BAN TYPE[/B]


[ul][*]0 = unbanned
[*]1 = perm mute
[*]2 = temp mute (3 days)
[*]3 = temp mute (7 days)
[*]4 = perm ban
[*]5 = temp ban (3 days)
[*]6 = temp ban (7 days)
[*]7 = temp ban (3 days) and perm mute
[*]8 = temp ban (7 days) and perm mute
[*]9 = temp ban (3 days) and temp mute (7 days)
[*]10 = IP ban &lt;&lt; Handled in server.java, partially in BanHandler[/ul]


[b]Difficulty:[/b] 5/10
[b]Tested On:[/b] Devolution v7
[b]Classes Modified/Added:[/b] client, server, BanHandler

[B]Step 1:[/B] [B][I]MAKE A BACKUP.[/I][/B] Delete anything to do with bans. Download the POI api at [url=http://www.alliedquotes.com/mirrors/apache/poi/release/bin/]http://www.alliedquotes.com/mirrors/apache/poi/release/bin/[/url]

Download either the [B].tar.gz[/B] or [B].zip[/B]. [B]Extract[/B] the &#39;[B]poi-3.2-FINAL-20081019.jar[/B]&#39; to your [B]server directory[/B] (You can extract the docs folder too, alternatively you can view them at [url=http://poi.apache.org/apidocs/index.html]http://poi.apache.org/apidocs/index.html[/url]) and [B]rename[/B] it to [B]poi.jar[/B].

[B]Step 2:[/B] Now you need to [B]replace[/B] your [B]compiler[/B] and [B]runserver[/B] so that your server can use the POI api.

[B]Replace[/B] them with:

[code]@echo off
title Compiler - By Filth
javac -cp poi.jar *.java
pause[/code]

and

[code]@echo off
title Running Server
java -Xmx1028m -cp &quot;poi.jar&quot;; server
pause[/code]

[B]Step 3:[/B] [B]Add[/B] this [B]file[/B] to your [B]config folder[/B]: [url=http://uppit.com/v/UWTGLWP3]http://uppit.com/v/UWTGLWP3[/url]

This is the excel file (2003) that will store your bans.

NOTE: Apache POI v3.2 is for excel (2003), the newer version (3.5) is for excel (2007). However, you can still use the 3.2 if you have excel (2007) by saving it as a .xls extension (go to &#39;save as&#39; and you should find it).

[B]Step 4:[/B] [B]Add[/B] this new [B]class file[/B]:

[b]READ THIS, LOTS OF COMMENTS! I DIDN&#39;T WRITE THEM FOR FUN.[/b]

[code]/*
 * BanHandler
 *
 * Version 1.2
 *
 * Tuesday, April 28, 2009
 *
 * You may use and/or modify this as long as credits are given to Filth Jr. Do
 * not repost this without credits given to Filth Jr, whether it be a tutorial,
 * in a server, or any other form. If you do not agree with any of these
 * conditions, you may not use this class in its current form, or in a modified form.
 *
 * tl;dr version:
 *
 * DON&#39;T LEECH.
 */

import org.apache.poi.hssf.usermodel.*; // Importing all the important things like HSSFRow, HSSFCell, etc.
import org.apache.poi.poifs.filesystem.POIFSFileSystem; // Used for loading the file.

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.lang.Exception;
import java.text.SimpleDateFormat;
import java.util.GregorianCalendar;
import java.util.Date;
import java.util.ArrayList;
import java.util.TimeZone;

public class BanHandler {

	public BanHandler(boolean load)
	{ // Our constructor. Called on server&#39;s initialization to read the excel file and write it to a list. Also called
	// in client.java
		if (load) // Because we call BanHandler in client.java we don&#39;t want it to keep loading players every time
		// it&#39;s called.
		{
			try
			{
				POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(&quot;config\\ban.xls&quot;)); // Loads the file.
				HSSFWorkbook wb = new HSSFWorkbook(fs); // Loads our workbook (basically the whole file).
				HSSFSheet sheet = wb.getSheetAt(0); // Our first sheet (ID: 0) the next sheet would be 1, then 2, and so on.
				HSSFRow row; // No value right now, this is a whole row.
				HSSFCell cell; // No value right now, this is an individual cell.

				int instances = 0;
				try
				{
					for (int x = 1; x &lt; sheet.getLastRowNum(); x++)
					{ // Loops through all the &#39;rows&#39;
						if (sheet.getRow(x).getCell(0).getStringCellValue().length() &gt; 0)
						{ // Finds which rows actually have values in them
							instances++; // Increases the number of instances when a cell with a value is found.
							// This variable &#39;instances&#39; is the actual number of rows there are.
						}
					}
				}
				catch (Exception x)
				{
					System.out.println(&quot;There are no values in the spreadsheet.&quot;);
					return; // return
				}
				finally
				{
					if (instances &lt; 1) // If there&#39;s no exception, but there are no values to be loaded
					{
						System.out.println(&quot;There are no values in the spreadsheet.&quot;);
						return; // return
					}
				}

				SimpleDateFormat sdf = new SimpleDateFormat(&quot;M/d/yyyy kk:mm:ss&quot;); // The format we will be loading the dates as.
				// Example:  2/14/1995 18:24:36

				for (int rows = 1; rows &lt; instances + 2; rows++)
				{ // Loops through all the rows.
				// Starts at 1, because the first row just holds descriptions of what is in each column. (Like Player Name, Host, that stuff)
					row = sheet.getRow(rows); // Giving our row a value. sheet.getRow(0) would get the whole first row, for example.
					if (row != null)
					{ // Incase something goes wrong for some reason of which I do not know, this checks if the row is null :|
						String data_ = null; // A string we will be writing to the &#39;data&#39; variable.
						for(int col = 0; col &lt; 5; col++)
						{ // Loops through all the columns (we already
						// know what is in each column. Column 0 is &#39;Player Name&#39;, Column 1 is &#39;Punishment&#39;, etc.) There is no method in the sheet class to get the
						// number of columns (imo this is retarded). You already know how many columns you have, though, 4 columns. (0-3)
							cell = row.getCell(col);
							if (cell != null)
							{ // Gets a specific cell from the entire row, and checks if it is null
							// If the cell is not null, then we will give our variables values.
							// Note: The variable &#39;concat&#39; adds a String to the end of a String.
								if (col == 0)
								{ // If the column is &#39;Player Name&#39;
									data_ = cell.getStringCellValue()+&quot;+&quot;; // Gets value of cell as a String.
								}
								else if (col == 1)
								{ // If the column is &#39;Punishment&#39; reading as a number writing as a String
									data_ = data_.concat(Integer.toString((int) cell.getNumericCellValue()))+&quot;-&quot;; // Gets value of cell as a number (returns as double).
								}
								else if (col == 2)
								{ // If the column is &#39;Host&#39;
									data_ = data_.concat(cell.getStringCellValue()+&quot;*&quot;); // Gets value of cell as a String.
								}
								else if (col == 3)
								{ // If the column is &#39;Date (Ban)&#39;

									data_ = data_.concat(sdf.format(cell.getDateCellValue())+&quot;!&quot;); // We are writing the date in the SimpleDateFormat
									// that was chosen earlier: &#39;M/d/yyyy kk:mm:ss&#39;
								}
								else if (col == 4)
								{ // If the column is &#39;Date (Mute)&#39;
									data_ = data_.concat(sdf.format(cell.getDateCellValue())); // &#39;format&#39; writes the date as a String.
								}
							}
						}
					data.add(data_); // Adds data_ to the ArrayList
					}
				}
				System.out.println(&quot;Succesfully loaded bans!&quot;);
			}
			catch (Exception ioe)
			{ // Exception, error with file.
				ioe.printStackTrace(); // Prints error.
			}
		}
	}

	public static ArrayList&lt;String&gt; data = new ArrayList&lt;String&gt;(); // Holds player name, their host, their punishment type,
	// and date punished.

	public TimeZone timezone = TimeZone.getTimeZone (&quot;America/New_York&quot;); // Time Zone, you want to have one timezone
	// because if the player logs on in a different timezone they could get unbanned hours earlier (For example, if they go
	// on vacation while banned :|) Just one of those small professional things you should add lol.

	public boolean muted = false; // Default: Not muted

	/*
	* Punishments:
	*
	* 0 = unbanned
	*
	* 1 = perm mute
	* 2 = temp mute (3 days)
	* 3 = temp mute (7 days)
	*
	* 4 = perm ban
	* 5 = temp ban (3 days)
	* 6 = temp ban (7 days)
	*
	* 7 = temp ban (3 days) and perm mute
	* 8 = temp ban (7 days) and perm mute
	* 9 = temp ban (3 days) and temp mute (7 days)
	*
	* 10 = IP ban &lt;&lt; Handled in server.java, partially here.
	*/
	public boolean banned(String playerName, String host)
	{
		String data_ = null;
		for (String h : data)
		{ // Loops through all the values in &#39;data&#39;
			if (playerName.equalsIgnoreCase(h.substring(0, h.indexOf(&quot;+&quot;))))
			{ // Searches for a certain player
				data_ = h; // saves the player&#39;s data
				break; // breaks loop.
			}
		}
		if (data_ == null)
		{ // If the player wasn&#39;t found
			writeSheet(playerName, host, 0); // add the player
			return false; // return false (can login)
		}
		else
		{
			GregorianCalendar cal = new GregorianCalendar(timezone); // Handles ban dates
			GregorianCalendar cal3 = new GregorianCalendar(timezone); // Handles mute dates
			try
			{
				SimpleDateFormat sdf = new SimpleDateFormat(&quot;M/d/yyyy kk:mm:ss&quot;); // The date format the dates were saved as in our ArrayList
				String date_ = data_.substring(data_.indexOf(&quot;*&quot;) + 1, data_.indexOf(&quot;!&quot;)); // Gets date part of our String
				Date date = sdf.parse(date_); // Parses string to get a date using the format above.
				cal.setTime(date); // sets time of &#39;cal&#39; (The date the ban will be lifted)

				date_ = data_.substring(data_.indexOf(&quot;!&quot;) + 1); // Same thing as above except this is the mute date
				date = sdf.parse(date_);
				cal3.setTime(date); // Sets time of &#39;cal3&#39; (The date the mute will be lifted)
			}
			catch (Exception pe)
			{ // Parse exception
				pe.printStackTrace();
			}
			GregorianCalendar cal2 = new GregorianCalendar(timezone); // Today&#39;s date.
			int punishment = Integer.parseInt(data_.substring(data_.indexOf(&quot;+&quot;) + 1, data_.indexOf(&quot;-&quot;))); // Get&#39;s player&#39;s punishment
			if (punishment == 0) // No offenses
			{
				return false;
			}
			else if (punishment == 1) // Perm muted.
			{
				muted = true;
				return false;
			}
			else if (punishment == 2 || punishment == 3) // temp mutes
			{
				if (cal3.after(cal2)) // If the day the mute will be lifted is after today&#39;s date...
				{
					muted = true; // Their mute is not lifted
				}
				else
				{
					writeSheet(playerName, host, 0); // Updates them to unmuted/no offenses
				}
				return false; // they can log in
			}
			else if (punishment == 4) // perm ban
			{
				return true; // can&#39;t log in
			}
			else if (punishment == 5 || punishment == 6) // temp bans
			{
				if (cal.after(cal2)) // if the day the ban will be lifted is after today&#39;s date...
				{
					return true; // they can&#39;t log in.
				}
				else
				{
					writeSheet(playerName, host, 0); // Updates them to unbanned/no offenses
				}
				return false; // they can log in
			}
			else if (punishment == 7 || punishment == 8) // temp ban and perm mute
			{
				if (cal.after(cal2)) // if the day the ban will be lifted is after today&#39;s date...
				{
					return true; // they can&#39;t log in
				}
				else
				{
					muted = true; // if not, they are still muted.
					writeSheet(playerName, host, 1); // Updates them to only perm mute.
				}
				return false; // they can log in.
			}
			else if (punishment == 9) // if they are temp banned and temp muted
			{
				if (cal.after(cal2)) // if the day the ban will be lifted is after today&#39;s date...
				{
					return true; // they can&#39;t log in
				}
				else
				{
					if (cal3.after(cal2)) // if the day the mute will be lifted is after today&#39;s date...
					{
						muted = true; // they&#39;re muted
						return false; // they can log in
					}
				}
				writeSheet(playerName, host, 0); // Unmuted/no offenses
				return false; // can log in
			}
			else if (punishment == 10) // ip banned
			{
				writeSheet(playerName, host, 10);
				// If they change their IP and log in with the same account, their new IP will be banned.
				return true; // can&#39;t log in
			}
			return false; // can log in
		}
	}

	public void writeSheet(String playerName, String host, int punish)
	{
		try
		{ // Read comments in constructor, pretty similar
			POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(&quot;config\\ban.xls&quot;));
			FileOutputStream out = new FileOutputStream(&quot;config\\ban.xls&quot;);
			HSSFWorkbook wb = new HSSFWorkbook(fs);
			HSSFSheet sheet = wb.getSheetAt(0);
			HSSFRow row;
			HSSFCell cell;

			int instances = 0;
			int add = 1;
			for (int x = 0; x &lt; sheet.getLastRowNum(); x++)
			{
				if (sheet.getRow(x).getCell(0).toString().length() &gt; 0)
				{
					if (sheet.getRow(x).getCell(0).getStringCellValue().equalsIgnoreCase(playerName))
					{
						instances = x;
						add = 0;
						break;
					}
					instances++;
				}
			}

			row = sheet.createRow(instances + add); // Creates the first available row.
			String dt = null;
			String dt2 = null;
			SimpleDateFormat sdf = new SimpleDateFormat(&quot;M/d/yyyy kk:mm:ss&quot;);
			GregorianCalendar cal = new GregorianCalendar(timezone);
				for(int col = 0; col &lt; 5; col++)
				{
					if (col == 0)
					{
						row.createCell(col).setCellValue(playerName);
					}
					else if (col == 1)
					{
						row.createCell(col).setCellValue(punish);
					}
					else if (col == 2)
					{
						row.createCell(col).setCellValue(host);
					}
					else if (col == 3)
					{
						int days = 3;
						if (punish == 5 || punish == 7 || punish == 9)
						{
							days = 3;
						}
						else if (punish == 6 || punish == 8)
						{
							days = 7;
						}
						cal.add(GregorianCalendar.DATE, days);
						row.createCell(col).setCellValue(sdf.parse(sdf.format(cal.getTime()).toString()));
						dt = sdf.format(cal.getTime());
					}
					else if (col == 4)
					{
						int days = 3;
						if (punish == 2)
						{
							days = 3;
						}
						else if (punish == 3 || punish == 9)
						{
							days = 7;
						}
						cal = new GregorianCalendar(timezone);
						cal.add(GregorianCalendar.DATE, days);
						row.createCell(col).setCellValue(sdf.parse(sdf.format(cal.getTime()).toString()));
						dt2 = sdf.format(cal.getTime());
					}
				}
			data.add(playerName+&quot;+&quot;+punish+&quot;-&quot;+host+&quot;*&quot;+dt+&quot;!&quot;+dt2); // updates ArrayList
			wb.write(out); // writes to workbook
			out.close(); // closes outputstream
		}
		catch (Exception ioe)
		{
			ioe.printStackTrace();
		}
	}
}[/code]

[B]Step 5:[/B] Now open up [B]client.java[/B] and [B]declare[/B]:

[code]public BanHandler ban = new BanHandler(false);[/code]

If you make this static it will mess up.

In [B]Packet 4 (chat)[/B] add [B]AT THE TOP[/B]:

[code]			if (ban.muted) {
				sendMessage(&quot;You cannot speak, you have been muted.&quot;);
				break;
			}[/code]

This just makes it so that if they are muted, other people can&#39;t see them talking.

[B]Also, if you have a yell command, you should add that too.[/B]

In your [B]run[/B] method [B]add[/B] this ([B]NOTE: PLACING IS CRUCIAL. IF YOU PUT THIS IN THE WRONG SPOT, THIS WILL NOT WORK![/B])

[code]			if (ban.banned(playerName, connectedFrom)) {
				returnCode = 4;
				disconnected = true;
				return;
			}[/code]

This makes it so that if they are banned, they can&#39;t log in.

[B]Step 6:[/B] Now open up [B]server.java[/B] and [B]declare[/B]:

[code]public BanHandler bannedD = new BanHandler(true);[/code]

This shouldn&#39;t be static either.

In your [B]checkHost[/B] method [B]add[/B]:

[code]		if (!bannedD.data.isEmpty()) {
			for (String x : bannedD.data) {
				if (host.equalsIgnoreCase(x.substring(x.indexOf(&quot;-&quot;) + 1, x.indexOf(&quot;*&quot;)))) {
					if (Integer.parseInt(x.substring(x.indexOf(&quot;+&quot;) + 1, x.indexOf(&quot;-&quot;))) == 10) {
						return false;
					}
				}
			}
		}[/code]

This checks to see if the ArrayList has the player&#39;s IP. If it does, they can&#39;t log in.

YOU ARE DONE! [B]Thoroughly test, and keep your backup.[/B]

How can I make a command for this?

Simply make a command like ::ban ID NAME

In the command put: 

[code]client plr = (client) server.playerHandler...uhh.getIDbyName(NAME);
ban.writeSheet(NAME, plr.connectedFrom, id);
[/code]

Obviously not word for word, but you get the idea.

Credits:

- Me
- [url=http://poi.apache.org]http://poi.apache.org[/url]</description>
    
    <lastBuildDate>Sat, 18 Jun 2011 04:53:55 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@doom_j doom_j]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/doom_j">@doom_j</a> wrote:</p>
          <blockquote>
              <p>Does anyone still have the worksheet laying around on their hard drive?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/17</link>
        <pubDate>Sat, 18 Jun 2011 04:53:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-17</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@JaydenD12 JaydenD12]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jaydend12">@JaydenD12</a> wrote:</p>
          <blockquote>
              <p>[quote=“Newty, post:4, topic:278226”]For your command:</p>
<pre><code class="lang-auto">if(command.startsWith("ban")) {
String otherPName = command.substring(4);
int otherPIndex = PlayerHandler.getPlayerID(otherPName);
ban.writeSheet(NAME, otherPIndex.connectedFrom, id);</code></pre>
<p>Should work.[/quote]</p>
<p>Learn conventions.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/16</link>
        <pubDate>Fri, 11 Dec 2009 08:03:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-16</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@Hard_Pk Hard Pk]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hard_pk">@Hard_Pk</a> wrote:</p>
          <blockquote>
              <p><a href="http://uppit.com/v/UWTGLWP3" rel="nofollow noopener">http://uppit.com/v/UWTGLWP3</a> is broken</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/15</link>
        <pubDate>Thu, 10 Dec 2009 21:00:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-15</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@Sneaky1 Sneaky_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sneaky1">@Sneaky1</a> wrote:</p>
          <blockquote>
              <p>Requesting a Link-Fix; please.</p>
<p>The UppiT! File doesn’t exist.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/14</link>
        <pubDate>Thu, 29 Oct 2009 14:11:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-14</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@P_I_M_P_3_D_Tut `Lewk_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/p_i_m_p_3_d_tut">@P_I_M_P_3_D_Tut</a> wrote:</p>
          <blockquote>
              <p>(Y) hot.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/13</link>
        <pubDate>Tue, 21 Jul 2009 03:49:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-13</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@dillingo dillingo]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dillingo">@dillingo</a> wrote:</p>
          <blockquote>
              <p>The uppit link is broken.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/12</link>
        <pubDate>Mon, 20 Jul 2009 22:41:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-12</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@mike623030 mike623030]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mike623030">@mike623030</a> wrote:</p>
          <blockquote>
              <p>would this work with delta?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/11</link>
        <pubDate>Mon, 20 Jul 2009 20:25:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-11</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@burnt_w_pwnt burnt w pwnt]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/burnt_w_pwnt">@burnt_w_pwnt</a> wrote:</p>
          <blockquote>
              <p>where’s all the others? like ipmute unipmute?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/10</link>
        <pubDate>Sun, 19 Jul 2009 08:37:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-10</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@Server-Unknown.Net Server-Unknown.Net]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/server-unknown.net">@Server-Unknown.Net</a> wrote:</p>
          <blockquote>
              <p>lol knew this was possible, only not this way. I was thinking of basing the time on real world time, because if the server gets cut off the ban elapsed time will not continue to count still; where it will actually be 3 game-time days for a player to be unbanned or unmuted rather then the real life time. Like Jagex’s, i know they do something like this, i know it.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/9</link>
        <pubDate>Sat, 18 Jul 2009 15:35:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-9</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@Sneaky1 Sneaky_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sneaky1">@Sneaky1</a> wrote:</p>
          <blockquote>
              <p>Looks nice, Goodluck in your other work.</p>
<p>Regards,<br>
Sneaky_</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/8</link>
        <pubDate>Fri, 17 Jul 2009 17:57:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-8</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@counter4545 counter4545]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/counter4545">@counter4545</a> wrote:</p>
          <blockquote>
              <p>Nah it’s filth. Btw Marty, I wanted to tell you to use this class file instead, when I was like srs business on msn. I fixed a tiny glitch.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/7</link>
        <pubDate>Fri, 15 May 2009 01:34:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-7</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@M_A_R_T_Y M A R T Y]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/m_a_r_t_y">@M_A_R_T_Y</a> wrote:</p>
          <blockquote>
              <p>Are you filth? If not nice leech.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/6</link>
        <pubDate>Fri, 15 May 2009 01:19:09 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-6</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@counter4545 counter4545]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/counter4545">@counter4545</a> wrote:</p>
          <blockquote>
              <p>[quote=“Newty, post:4, topic:278226”]For your command:</p>
<pre><code class="lang-auto">if(command.startsWith("ban")) {
String otherPName = command.substring(4);
int otherPIndex = PlayerHandler.getPlayerID(otherPName);
ban.writeSheet(NAME, otherPIndex.connectedFrom, id);</code></pre>
<p>Should work.[/quote]</p>
<p>Yeah you also have to have the id variable.</p>
<p>Use ’ ’ (space) to split the command string and have it like ::ban ID name</p>
<p>Thx for approving, meh, don’t feel like changing public variables to private.</p>
<p>BTW: Read top of post I edited</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/5</link>
        <pubDate>Fri, 15 May 2009 00:55:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-5</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@NewbieNewty Newty]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/newbienewty">@NewbieNewty</a> wrote:</p>
          <blockquote>
              <p>For your command:</p>
<pre><code class="lang-auto">if(command.startsWith("ban")) {
String otherPName = command.substring(4);
int otherPIndex = PlayerHandler.getPlayerID(otherPName);
ban.writeSheet(NAME, otherPIndex.connectedFrom, id);</code></pre>
<p>Should work.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/4</link>
        <pubDate>Fri, 15 May 2009 00:28:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-4</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@marcbob marcbob]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/marcbob">@marcbob</a> wrote:</p>
          <blockquote>
              <p>looks good</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/3</link>
        <pubDate>Thu, 14 May 2009 23:40:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-3</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@mod_taharok Taharok]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mod_taharok">@mod_taharok</a> wrote:</p>
          <blockquote>
              <p>To be completely honest, the idea isn’t bad, but the entire thing seems very heavy in terms of memory and processing. You also make everything public (even the methods that aren’t meant to be public), which is quite ew imo. I am only approving this because it’s half decent compared to the usual stuff we get here, and it’s something new to read.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/2</link>
        <pubDate>Thu, 14 May 2009 22:54:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-2</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
      <item>
        <title>Ban System - Apache POI - Recommended</title>
        <dc:creator><![CDATA[@counter4545 counter4545]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/counter4545">@counter4545</a> wrote:</p>
          <blockquote>
              <p>NOTE: If you don’t want to use the whole api, then extract only the class files needed (look at imports) and remove the imports. Then you don’t have to change your compiler or runserver</p>
<p>Apache POI:</p>
<p><a href="http://poi.apache.org/overview.html" data-bbcode="true" rel="nofollow noopener">http://poi.apache.org/overview.html</a></p>
<p><span class="bbcode-b">Purpose:</span> Replace your old ban system with a new and better one using the apache POI api!</p>
<p>This features faster loading, and files only load once (on server initialization the file is saved to an ArrayList), unlike how it’s currently set up (loads file EVERY login).</p>
<p>Requires ONE command (no ::ipban, ::tempban, ::permban, just a ::ban ID PLAYER). Even with one command, it STILL has more ban types! Look at them all:</p>
<p><span class="bbcode-b">ID - BAN TYPE</span></p>
<p>[ul][<em>]0 = unbanned<br>
[</em>]1 = perm mute<br>
[<em>]2 = temp mute (3 days)<br>
[</em>]3 = temp mute (7 days)<br>
[<em>]4 = perm ban<br>
[</em>]5 = temp ban (3 days)<br>
[<em>]6 = temp ban (7 days)<br>
[</em>]7 = temp ban (3 days) and perm mute<br>
[<em>]8 = temp ban (7 days) and perm mute<br>
[</em>]9 = temp ban (3 days) and temp mute (7 days)<br>
[*]10 = IP ban &lt;&lt; Handled in server.java, partially in BanHandler[/ul]</p>
<p><span class="bbcode-b">Difficulty:</span> 5/10<br>
<span class="bbcode-b">Tested On:</span> Devolution v7<br>
<span class="bbcode-b">Classes Modified/Added:</span> client, server, BanHandler</p>
<p><span class="bbcode-b">Step 1:</span> <span class="bbcode-b"><span class="bbcode-i">MAKE A BACKUP.</span></span> Delete anything to do with bans. Download the POI api at <a href="http://www.alliedquotes.com/mirrors/apache/poi/release/bin/" data-bbcode="true" rel="nofollow noopener">http://www.alliedquotes.com/mirrors/apache/poi/release/bin/</a></p>
<p>Download either the <span class="bbcode-b">.tar.gz</span> or <span class="bbcode-b">.zip</span>. <span class="bbcode-b">Extract</span> the ‘<span class="bbcode-b">poi-3.2-FINAL-20081019.jar</span>’ to your <span class="bbcode-b">server directory</span> (You can extract the docs folder too, alternatively you can view them at <a href="http://poi.apache.org/apidocs/index.html" data-bbcode="true" rel="nofollow noopener">http://poi.apache.org/apidocs/index.html</a>) and <span class="bbcode-b">rename</span> it to <span class="bbcode-b">poi.jar</span>.</p>
<p><span class="bbcode-b">Step 2:</span> Now you need to <span class="bbcode-b">replace</span> your <span class="bbcode-b">compiler</span> and <span class="bbcode-b">runserver</span> so that your server can use the POI api.</p>
<p><span class="bbcode-b">Replace</span> them with:</p>
<p><code>@echo off
title Compiler - By Filth
javac -cp poi.jar *.java
pause</code></p>
<p>and</p>
<p><code>@echo off
title Running Server
java -Xmx1028m -cp "poi.jar"; server
pause</code></p>
<p><span class="bbcode-b">Step 3:</span> <span class="bbcode-b">Add</span> this <span class="bbcode-b">file</span> to your <span class="bbcode-b">config folder</span>: <a href="http://uppit.com/v/UWTGLWP3" data-bbcode="true" rel="nofollow noopener">http://uppit.com/v/UWTGLWP3</a></p>
<p>This is the excel file (2003) that will store your bans.</p>
<p>NOTE: Apache POI v3.2 is for excel (2003), the newer version (3.5) is for excel (2007). However, you can still use the 3.2 if you have excel (2007) by saving it as a .xls extension (go to ‘save as’ and you should find it).</p>
<p><span class="bbcode-b">Step 4:</span> <span class="bbcode-b">Add</span> this new <span class="bbcode-b">class file</span>:</p>
<p><span class="bbcode-b">READ THIS, LOTS OF COMMENTS! I DIDN’T WRITE THEM FOR FUN.</span></p>
<p>[code]/*</p>
<ul>
<li>BanHandler</li>
<li>
</li>
<li>Version 1.2</li>
<li>
</li>
<li>Tuesday, April 28, 2009</li>
<li>
</li>
<li>You may use and/or modify this as long as credits are given to Filth Jr. Do</li>
<li>not repost this without credits given to Filth Jr, whether it be a tutorial,</li>
<li>in a server, or any other form. If you do not agree with any of these</li>
<li>conditions, you may not use this class in its current form, or in a modified form.</li>
<li>
</li>
<li>tl;dr version:</li>
<li>
</li>
<li>DON’T LEECH.<br>
*/</li>
</ul>
<p>import org.apache.poi.hssf.usermodel.*; // Importing all the important things like HSSFRow, HSSFCell, etc.<br>
import org.apache.poi.poifs.filesystem.POIFSFileSystem; // Used for loading the file.</p>
<p>import java.io.FileInputStream;<br>
import java.io.FileOutputStream;<br>
import java.lang.Exception;<br>
import java.text.SimpleDateFormat;<br>
import java.util.GregorianCalendar;<br>
import java.util.Date;<br>
import java.util.ArrayList;<br>
import java.util.TimeZone;</p>
<p>public class BanHandler {</p>
<pre><code>public BanHandler(boolean load)
{ // Our constructor. Called on server's initialization to read the excel file and write it to a list. Also called
// in client.java
	if (load) // Because we call BanHandler in client.java we don't want it to keep loading players every time
	// it's called.
	{
		try
		{
			POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream("config\\ban.xls")); // Loads the file.
			HSSFWorkbook wb = new HSSFWorkbook(fs); // Loads our workbook (basically the whole file).
			HSSFSheet sheet = wb.getSheetAt(0); // Our first sheet (ID: 0) the next sheet would be 1, then 2, and so on.
			HSSFRow row; // No value right now, this is a whole row.
			HSSFCell cell; // No value right now, this is an individual cell.

			int instances = 0;
			try
			{
				for (int x = 1; x &lt; sheet.getLastRowNum(); x++)
				{ // Loops through all the 'rows'
					if (sheet.getRow(x).getCell(0).getStringCellValue().length() &gt; 0)
					{ // Finds which rows actually have values in them
						instances++; // Increases the number of instances when a cell with a value is found.
						// This variable 'instances' is the actual number of rows there are.
					}
				}
			}
			catch (Exception x)
			{
				System.out.println("There are no values in the spreadsheet.");
				return; // return
			}
			finally
			{
				if (instances &lt; 1) // If there's no exception, but there are no values to be loaded
				{
					System.out.println("There are no values in the spreadsheet.");
					return; // return
				}
			}

			SimpleDateFormat sdf = new SimpleDateFormat("M/d/yyyy kk:mm:ss"); // The format we will be loading the dates as.
			// Example:  2/14/1995 18:24:36

			for (int rows = 1; rows &lt; instances + 2; rows++)
			{ // Loops through all the rows.
			// Starts at 1, because the first row just holds descriptions of what is in each column. (Like Player Name, Host, that stuff)
				row = sheet.getRow(rows); // Giving our row a value. sheet.getRow(0) would get the whole first row, for example.
				if (row != null)
				{ // Incase something goes wrong for some reason of which I do not know, this checks if the row is null :|
					String data_ = null; // A string we will be writing to the 'data' variable.
					for(int col = 0; col &lt; 5; col++)
					{ // Loops through all the columns (we already
					// know what is in each column. Column 0 is 'Player Name', Column 1 is 'Punishment', etc.) There is no method in the sheet class to get the
					// number of columns (imo this is retarded). You already know how many columns you have, though, 4 columns. (0-3)
						cell = row.getCell(col);
						if (cell != null)
						{ // Gets a specific cell from the entire row, and checks if it is null
						// If the cell is not null, then we will give our variables values.
						// Note: The variable 'concat' adds a String to the end of a String.
							if (col == 0)
							{ // If the column is 'Player Name'
								data_ = cell.getStringCellValue()+"+"; // Gets value of cell as a String.
							}
							else if (col == 1)
							{ // If the column is 'Punishment' reading as a number writing as a String
								data_ = data_.concat(Integer.toString((int) cell.getNumericCellValue()))+"-"; // Gets value of cell as a number (returns as double).
							}
							else if (col == 2)
							{ // If the column is 'Host'
								data_ = data_.concat(cell.getStringCellValue()+"*"); // Gets value of cell as a String.
							}
							else if (col == 3)
							{ // If the column is 'Date (Ban)'

								data_ = data_.concat(sdf.format(cell.getDateCellValue())+"!"); // We are writing the date in the SimpleDateFormat
								// that was chosen earlier: 'M/d/yyyy kk:mm:ss'
							}
							else if (col == 4)
							{ // If the column is 'Date (Mute)'
								data_ = data_.concat(sdf.format(cell.getDateCellValue())); // 'format' writes the date as a String.
							}
						}
					}
				data.add(data_); // Adds data_ to the ArrayList
				}
			}
			System.out.println("Succesfully loaded bans!");
		}
		catch (Exception ioe)
		{ // Exception, error with file.
			ioe.printStackTrace(); // Prints error.
		}
	}
}

public static ArrayList&lt;String&gt; data = new ArrayList&lt;String&gt;(); // Holds player name, their host, their punishment type,
// and date punished.

public TimeZone timezone = TimeZone.getTimeZone ("America/New_York"); // Time Zone, you want to have one timezone
// because if the player logs on in a different timezone they could get unbanned hours earlier (For example, if they go
// on vacation while banned :|) Just one of those small professional things you should add lol.

public boolean muted = false; // Default: Not muted

/*
* Punishments:
*
* 0 = unbanned
*
* 1 = perm mute
* 2 = temp mute (3 days)
* 3 = temp mute (7 days)
*
* 4 = perm ban
* 5 = temp ban (3 days)
* 6 = temp ban (7 days)
*
* 7 = temp ban (3 days) and perm mute
* 8 = temp ban (7 days) and perm mute
* 9 = temp ban (3 days) and temp mute (7 days)
*
* 10 = IP ban &lt;&lt; Handled in server.java, partially here.
*/
public boolean banned(String playerName, String host)
{
	String data_ = null;
	for (String h : data)
	{ // Loops through all the values in 'data'
		if (playerName.equalsIgnoreCase(h.substring(0, h.indexOf("+"))))
		{ // Searches for a certain player
			data_ = h; // saves the player's data
			break; // breaks loop.
		}
	}
	if (data_ == null)
	{ // If the player wasn't found
		writeSheet(playerName, host, 0); // add the player
		return false; // return false (can login)
	}
	else
	{
		GregorianCalendar cal = new GregorianCalendar(timezone); // Handles ban dates
		GregorianCalendar cal3 = new GregorianCalendar(timezone); // Handles mute dates
		try
		{
			SimpleDateFormat sdf = new SimpleDateFormat("M/d/yyyy kk:mm:ss"); // The date format the dates were saved as in our ArrayList
			String date_ = data_.substring(data_.indexOf("*") + 1, data_.indexOf("!")); // Gets date part of our String
			Date date = sdf.parse(date_); // Parses string to get a date using the format above.
			cal.setTime(date); // sets time of 'cal' (The date the ban will be lifted)

			date_ = data_.substring(data_.indexOf("!") + 1); // Same thing as above except this is the mute date
			date = sdf.parse(date_);
			cal3.setTime(date); // Sets time of 'cal3' (The date the mute will be lifted)
		}
		catch (Exception pe)
		{ // Parse exception
			pe.printStackTrace();
		}
		GregorianCalendar cal2 = new GregorianCalendar(timezone); // Today's date.
		int punishment = Integer.parseInt(data_.substring(data_.indexOf("+") + 1, data_.indexOf("-"))); // Get's player's punishment
		if (punishment == 0) // No offenses
		{
			return false;
		}
		else if (punishment == 1) // Perm muted.
		{
			muted = true;
			return false;
		}
		else if (punishment == 2 || punishment == 3) // temp mutes
		{
			if (cal3.after(cal2)) // If the day the mute will be lifted is after today's date...
			{
				muted = true; // Their mute is not lifted
			}
			else
			{
				writeSheet(playerName, host, 0); // Updates them to unmuted/no offenses
			}
			return false; // they can log in
		}
		else if (punishment == 4) // perm ban
		{
			return true; // can't log in
		}
		else if (punishment == 5 || punishment == 6) // temp bans
		{
			if (cal.after(cal2)) // if the day the ban will be lifted is after today's date...
			{
				return true; // they can't log in.
			}
			else
			{
				writeSheet(playerName, host, 0); // Updates them to unbanned/no offenses
			}
			return false; // they can log in
		}
		else if (punishment == 7 || punishment == 8) // temp ban and perm mute
		{
			if (cal.after(cal2)) // if the day the ban will be lifted is after today's date...
			{
				return true; // they can't log in
			}
			else
			{
				muted = true; // if not, they are still muted.
				writeSheet(playerName, host, 1); // Updates them to only perm mute.
			}
			return false; // they can log in.
		}
		else if (punishment == 9) // if they are temp banned and temp muted
		{
			if (cal.after(cal2)) // if the day the ban will be lifted is after today's date...
			{
				return true; // they can't log in
			}
			else
			{
				if (cal3.after(cal2)) // if the day the mute will be lifted is after today's date...
				{
					muted = true; // they're muted
					return false; // they can log in
				}
			}
			writeSheet(playerName, host, 0); // Unmuted/no offenses
			return false; // can log in
		}
		else if (punishment == 10) // ip banned
		{
			writeSheet(playerName, host, 10);
			// If they change their IP and log in with the same account, their new IP will be banned.
			return true; // can't log in
		}
		return false; // can log in
	}
}

public void writeSheet(String playerName, String host, int punish)
{
	try
	{ // Read comments in constructor, pretty similar
		POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream("config\\ban.xls"));
		FileOutputStream out = new FileOutputStream("config\\ban.xls");
		HSSFWorkbook wb = new HSSFWorkbook(fs);
		HSSFSheet sheet = wb.getSheetAt(0);
		HSSFRow row;
		HSSFCell cell;

		int instances = 0;
		int add = 1;
		for (int x = 0; x &lt; sheet.getLastRowNum(); x++)
		{
			if (sheet.getRow(x).getCell(0).toString().length() &gt; 0)
			{
				if (sheet.getRow(x).getCell(0).getStringCellValue().equalsIgnoreCase(playerName))
				{
					instances = x;
					add = 0;
					break;
				}
				instances++;
			}
		}

		row = sheet.createRow(instances + add); // Creates the first available row.
		String dt = null;
		String dt2 = null;
		SimpleDateFormat sdf = new SimpleDateFormat("M/d/yyyy kk:mm:ss");
		GregorianCalendar cal = new GregorianCalendar(timezone);
			for(int col = 0; col &lt; 5; col++)
			{
				if (col == 0)
				{
					row.createCell(col).setCellValue(playerName);
				}
				else if (col == 1)
				{
					row.createCell(col).setCellValue(punish);
				}
				else if (col == 2)
				{
					row.createCell(col).setCellValue(host);
				}
				else if (col == 3)
				{
					int days = 3;
					if (punish == 5 || punish == 7 || punish == 9)
					{
						days = 3;
					}
					else if (punish == 6 || punish == 8)
					{
						days = 7;
					}
					cal.add(GregorianCalendar.DATE, days);
					row.createCell(col).setCellValue(sdf.parse(sdf.format(cal.getTime()).toString()));
					dt = sdf.format(cal.getTime());
				}
				else if (col == 4)
				{
					int days = 3;
					if (punish == 2)
					{
						days = 3;
					}
					else if (punish == 3 || punish == 9)
					{
						days = 7;
					}
					cal = new GregorianCalendar(timezone);
					cal.add(GregorianCalendar.DATE, days);
					row.createCell(col).setCellValue(sdf.parse(sdf.format(cal.getTime()).toString()));
					dt2 = sdf.format(cal.getTime());
				}
			}
		data.add(playerName+"+"+punish+"-"+host+"*"+dt+"!"+dt2); // updates ArrayList
		wb.write(out); // writes to workbook
		out.close(); // closes outputstream
	}
	catch (Exception ioe)
	{
		ioe.printStackTrace();
	}
}
</code></pre>
<p>}[/code]</p>
<p><span class="bbcode-b">Step 5:</span> Now open up <span class="bbcode-b">client.java</span> and <span class="bbcode-b">declare</span>:</p>
<pre><code class="lang-auto">public BanHandler ban = new BanHandler(false);</code></pre>
<p>If you make this static it will mess up.</p>
<p>In <span class="bbcode-b">Packet 4 (chat)</span> add <span class="bbcode-b">AT THE TOP</span>:</p>
<p><code>			if (ban.muted) {
				sendMessage("You cannot speak, you have been muted.");
				break;
			}</code></p>
<p>This just makes it so that if they are muted, other people can’t see them talking.</p>
<p><span class="bbcode-b">Also, if you have a yell command, you should add that too.</span></p>
<p>In your <span class="bbcode-b">run</span> method <span class="bbcode-b">add</span> this (<span class="bbcode-b">NOTE: PLACING IS CRUCIAL. IF YOU PUT THIS IN THE WRONG SPOT, THIS WILL NOT WORK!</span>)</p>
<p><code>			if (ban.banned(playerName, connectedFrom)) {
				returnCode = 4;
				disconnected = true;
				return;
			}</code></p>
<p>This makes it so that if they are banned, they can’t log in.</p>
<p><span class="bbcode-b">Step 6:</span> Now open up <span class="bbcode-b">server.java</span> and <span class="bbcode-b">declare</span>:</p>
<pre><code class="lang-auto">public BanHandler bannedD = new BanHandler(true);</code></pre>
<p>This shouldn’t be static either.</p>
<p>In your <span class="bbcode-b">checkHost</span> method <span class="bbcode-b">add</span>:</p>
<p><code>		if (!bannedD.data.isEmpty()) {
			for (String x : bannedD.data) {
				if (host.equalsIgnoreCase(x.substring(x.indexOf("-") + 1, x.indexOf("*")))) {
					if (Integer.parseInt(x.substring(x.indexOf("+") + 1, x.indexOf("-"))) == 10) {
						return false;
					}
				}
			}
		}</code></p>
<p>This checks to see if the ArrayList has the player’s IP. If it does, they can’t log in.</p>
<p>YOU ARE DONE! <span class="bbcode-b">Thoroughly test, and keep your backup.</span></p>
<p>How can I make a command for this?</p>
<p>Simply make a command like ::ban ID NAME</p>
<p>In the command put:</p>
<p><code>client plr = (client) server.playerHandler...uhh.getIDbyName(NAME);
ban.writeSheet(NAME, plr.connectedFrom, id);
</code></p>
<p>Obviously not word for word, but you get the idea.</p>
<p>Credits:</p>
<ul>
<li>Me</li>
<li><a href="http://poi.apache.org" data-bbcode="true" rel="nofollow noopener">http://poi.apache.org</a></li>
</ul>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226/1</link>
        <pubDate>Tue, 12 May 2009 14:52:09 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-278226-1</guid>
        <source url="https://forum.moparisthebest.com/t/ban-system-apache-poi-recommended/278226.rss">Ban System - Apache POI - Recommended</source>
      </item>
  </channel>
</rss>
