<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Reflection Information</title>
    <link>https://forum.moparisthebest.com/t/reflection-information/59894</link>
    <description>[code]            p.popcode(145);
            p.p1(0);
            int startposition = p.pos;
            p.p4(reflect.anInt2094);
            for (int i = 0; i &lt; reflect.anInt2107; i++) {
                if (reflect.anIntArray2081[i] == 0) {
                    try {

                        int flag = reflect.anIntArray2106[i];
                        if (flag == 0) {
                            Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                            int value = field.getInt(null);
                            p.p1(0);
                            p.p4(value);
                        } else if (flag == 1) {
                            Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                            field.setInt(null, reflect.anIntArray2080[i]);
                            p.p1(0);
                        } else if (flag == 2) {
                            Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                            int accessflags = field.getModifiers();
                            p.p1(0);
                            p.p4(accessflags);
                        } else if (flag == 3) {
                            Method method = (Method) (reflect.aDataHandleArray2074s[i].result);
                            byte[][] is = reflect.aByteArrayArrayArray2099[i];
                            Object[] objects = new Object[is.length];
                            for (int i_8_ = 0; i_8_ &lt; is.length; i_8_++) {
                                ObjectInputStream objectinputstream = (new ObjectInputStream(new ByteArrayInputStream(is[i_8_])));
                                objects[i_8_] = objectinputstream.readObject();
                            }
                            Object object = method.invoke(null, objects);
                            if (object != null) {
                                if (object instanceof Number) {
                                    p.p1(1);
                                    p.p8(((Number) object).longValue());
                                } else if (object instanceof stringwrapper) {
                                    p.p1(2);
                                    p.pstr((stringwrapper) object);
                                } else {
                                    p.p1(4);
                                }
                            } else {
                                p.p1(0);
                            }
                        } else if (flag == 4) {
                            Method method = (Method) reflect.aDataHandleArray2074s[i].result;
                            int accessflags = method.getModifiers();
                            p.p1(0);
                            p.p4(accessflags);
                        }

                    } catch (ClassNotFoundException cnfe) {
                        p.p1(-0x0a);
                    } catch (InvalidClassException ice) {
                        p.p1(-0x0b);
                    } catch (StreamCorruptedException sce) {
                        p.p1(-0x0c);
                    } catch (OptionalDataException ode) {
                        p.p1(-0x0d);
                    } catch (IllegalAccessException iacc) {
                        p.p1(-0x0e);
                    } catch (IllegalArgumentException iarg) {
                        p.p1(-0x0f);
                    } catch (InvocationTargetException ite) {
                        p.p1(-0x10);
                    } catch (SecurityException se) {
                        p.p1(-0x11);
                    } catch (IOException ioe) {
                        p.p1(-0x12);
                    } catch (NullPointerException npe) {
                        p.p1(-0x13);
                    } catch (Exception e) {
                        p.p1(-0x14);
                    } catch (Throwable t) {
                        p.p1(-0x15);
                    }
                } else {
                    p.p1(reflect.anIntArray2081[i]);
                }
            }

            p.addcrc(startposition);
            p.psize(p.pos - startposition);[/code]

Some information on this snippet of code, p stands for &quot;protocol&quot; and yes, this is writing to a packet which IS sent to the server. 

Method calls to p use the name scheme &quot;p(name)&quot; such as &quot;popcode&quot; to mean literally &quot;put opcode&quot;.

So, now to see the protocol, it&#39;s not hard to see the protocol for the reflect engine. In this specific deob it&#39;s opcode (or operator code) is 145. It then writes a spacer byte and some int (I don&#39;t care enough to figure it out.). Now it loops for the number of reflection instances there is, and reads from the array what type it is into &quot;flag&quot; in order to do things accordingly. 
[b]Flag Types[/b]

[ul][li]0 - get a field&#39;s value[/li]
[li]1 - set a field&#39;s value[/li]
[li]2 - get a fields access flags (aka modifiers)[/li]
[li]3 - call a method and return it&#39;s &quot;value&quot;.[/li]
[li]4 - get a method&#39;s access flags (aka modifiers)[/li][/ul]


In more of a descriptive means...

[b]Flag Type 0 - field.getInt[/b]
It writes the success byte of 0, then writes the value of the referenced field onto the packet.

[b]Flag Type 1 - field.setInt[/b]
This sets the value of said field to a specified value, then it writes the success byte of 0 onto the packet.

[b]Flag Type 2 - field.getModifiers[/b]
This writes the success byte of 0 and then writes the access flags of referenced field onto the packet.

[b]Flag Type 3 - method.invoke[/b]
This uses bytes and object streams to collect the real object values etc, and reflect invokes the object and collects the return type.
if it&#39;s a Number type it writes 1 to identify and then the value;
if it&#39;s a string type it writes 2 to identify and then the string.
if it&#39;s not a number or a string it just writes 4 to tell the server that it&#39;s not a type it can return.
Otherwise it writes 0 if the return type is null such as if the method is void? it wont return crap so the object will be null so in such case it just says &quot;0&quot; or success.

[b]Flag Type 4 - method.getModifiers[/b]
This writes the success byte of 0 and then writes the access flags of referenced method onto the packet.


[b]Finally[/b]
Now exists the parts where it writes all the errors (if any) down onto the packet, you&#39;ll notice they&#39;re all negative.

And the last else  statement which simply writes what that int array&#39;s value is if it&#39;s not 0.


Lastly, it adds a crc from the current location from the start, and adds a byte at the start stating it&#39;s end position... a queer-ish way to see the packet size without writing it.



[b]Conclusion[/b]
I hope this clears up some rumors about reflection in the client... One such is Sythe&#39;s claim that they don&#39;t and all this other crap he told me. Frankly, he was wrong. Anyway, &lt;3 to ownagesbot, popcorn89, speljohan, taios... and anyone I forgot.</description>
    
    <lastBuildDate>Tue, 06 Mar 2007 02:08:26 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/reflection-information/59894.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@newbiehacker newbiehacker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/newbiehacker">@newbiehacker</a> wrote:</p>
          <blockquote>
              <p>~var is basically the variable negated and negated by one, (note that this requires a swap in certain logic, -3 &gt; -2 would change to 2 &lt; 1</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/21</link>
        <pubDate>Tue, 06 Mar 2007 02:08:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-21</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Taios Taios]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/taios">@Taios</a> wrote:</p>
          <blockquote>
              <p>Ownages was posting his bot in the CM section (I let im on because he didn’t want to post it to everyone), so now i just relay him the comments and post on his behalf.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/20</link>
        <pubDate>Mon, 05 Mar 2007 22:44:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-20</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Krichevskoy Krichevskoy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/krichevskoy">@Krichevskoy</a> wrote:</p>
          <blockquote>
              <p>[quote=“Taios, post:17, topic:59894”]Krichevskoy Zappacky has a “defubber”, its used alot in the ARGA updater, if you ask him nicely he might send you over a defubbered client <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>EDIT: Oh fuck this is ownagesbot, sorry I forgot to swap accounts![/quote]</p>
<p>This DeFubber? I haven’t actually looked at it, but I did notice it.</p>
<p>Why are you on Taios’s account anyway?</p>
<p>edit: Attachment removed. You probably don’t want it posted, now that I think about what you said. Here’s a snippet so you know what I’m talking about instead.</p>
<pre><code class="lang-auto">		for (Method m : jc.getMethods()){
			if (m.isAbstract() || !m.equals(mm)) continue;
			MethodGen mg = new MethodGen(m, jc.getClassName(), cp);
			//mg = deFubShifts(cp,mg);
			long time = System.currentTimeMillis();
			mg = deFubLogic(cp,mg);
			mg = deFubMath(cp, mg);//This should be LAST
			mg = rmRuntime(mg);
			cg.replaceMethod(m, mg.getMethod());
			cg.setConstantPool(cp);
			return cg.getJavaClass();
		}</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/19</link>
        <pubDate>Mon, 05 Mar 2007 09:16:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-19</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@frank frank_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/frank">@frank</a> wrote:</p>
          <blockquote>
              <p>why not say what is involved in this “defubbing”?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/18</link>
        <pubDate>Mon, 05 Mar 2007 05:52:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-18</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Taios Taios]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/taios">@Taios</a> wrote:</p>
          <blockquote>
              <p>Krichevskoy Zappacky has a “defubber”, its used alot in the ARGA updater, if you ask him nicely he might send you over a defubbered client <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>EDIT: Oh fuck this is ownagesbot, sorry I forgot to swap accounts!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/17</link>
        <pubDate>Mon, 05 Mar 2007 02:37:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-17</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@pplsuqbawlz pplsuqbawlz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pplsuqbawlz">@pplsuqbawlz</a> wrote:</p>
          <blockquote>
              <p>Ahh, I’ve changed the name of signlink to “datalink” because it manages datahandler classes, and links data from the loader AND the client.</p>
<p>But, suffice to say, krichevskoy’s post on the way datalink handle’s is dead on. Btw here’s datahandler:</p>
<p><code>public class datahandle {
    public int type;
    public int varnum;
    public Object varobj;
    public datahandle link;
    public volatile int status = 0;
    public volatile Object result;
}</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/16</link>
        <pubDate>Wed, 21 Feb 2007 11:35:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-16</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@byte byte]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/byte">@byte</a> wrote:</p>
          <blockquote>
              <p>Krichevskoy you might be interested in comparing the signlink thread of the client code and the loader code where those requests are being processed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/15</link>
        <pubDate>Wed, 21 Feb 2007 06:40:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-15</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Krichevskoy Krichevskoy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/krichevskoy">@Krichevskoy</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:13, topic:59894”][quote author=pplsuqbawlz link=topic=86084.msg921246#msg921246 date=1171979163]<br>
I have documented all of DataHandle. Suffice to say, it’s not entirely that interesting.</p>
<p>It just serves as a handler for various data across the client such as thread management, reflection management, visiting web-pages, opening sockets… I mapped datahandle months ago to be honest.<br>
[/quote]</p>
<p>im curious on the visiting web-pages, opening sockets bit. can you go into more detail on that.[/quote]</p>
<p>It’s used in the signlink class in my research client (it’s the one from May 16, but I doubt this has changed significantly).</p>
<pre><code class="lang-auto">try
{
	int i = classWrapper.contentType;
                    
	//contentType == 1, intValue = port number, secondary object = a socket
	if(i == 1)
		classWrapper.secondaryObject = new Socket(anInetAddress957, classWrapper.intValue);
	else
	
	//content type == 2, intValue = priority, inital object is Runnable client thread
	//secondary object is the running Thread
	if(i == 2)
	{
		Thread thread = new Thread((Runnable)classWrapper.initialObject);
		thread.setDaemon(true);
		thread.start();
		thread.setPriority(classWrapper.intValue);
		classWrapper.secondaryObject = thread;
	} else
                    
	//content type == 4, initial object is URL, secondary object is a remote DataInputStream
	if(i == 4)
	{
		classWrapper.secondaryObject = new DataInputStream(((URL)classWrapper.initialObject).openStream());
	} else
                            
	//content type == 9, initial object is an Object array {Class,String,Class[]}
	//secondary object is a Method initial[0].getDeclaredMethod(initial[1],initial[2]);
	if(i == 9)
	{
		Object aobj1[] = (Object[])classWrapper.initialObject;
		classWrapper.secondaryObject = ((Class)aobj1[0]).getDeclaredMethod((String)aobj1[1], (Class[])aobj1[2]);
	} else
                    
	//content type == 10, initial object is an Object array {Class,String}
	//secondary object is a Field initial[0].getDeclaredField(initial[1]);
	if(i == 10)
	{
		Object aobj[] = (Object[])classWrapper.initialObject;
		classWrapper.secondaryObject = ((Class)aobj[0]).getDeclaredField((String)aobj[1]);
	} else
	{
		throw new Exception();
	}
	
	classWrapper.executionState = 1;	
} catch(Exception _ex) {
	classWrapper.executionState = 2;
}</code></pre>
<p>I want a transformation set to fix those cascading “if(~n != #)/else” conditionals. Anyone have one? Or is it just JAD being bizarre?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/14</link>
        <pubDate>Wed, 21 Feb 2007 06:33:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-14</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>[quote=“pplsuqbawlz, post:11, topic:59894”]I have documented all of DataHandle. Suffice to say, it’s not entirely that interesting.</p>
<p>It just serves as a handler for various data across the client such as thread management, reflection management, visiting web-pages, opening sockets… I mapped datahandle months ago to be honest.[/quote]</p>
<p>im curious on the visiting web-pages, opening sockets bit. can you go into more detail on that.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/13</link>
        <pubDate>Wed, 21 Feb 2007 04:46:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-13</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Krichevskoy Krichevskoy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/krichevskoy">@Krichevskoy</a> wrote:</p>
          <blockquote>
              <p>[quote=“pplsuqbawlz, post:11, topic:59894”]I have documented all of DataHandle. Suffice to say, it’s not entirely that interesting.</p>
<p>It just serves as a handler for various data across the client such as thread management, reflection management, visiting web-pages, opening sockets… I mapped datahandle months ago to be honest.[/quote]</p>
<p>I know what it is generally (though iirc it’s “ObjectWrapper” here - your name is better), but I’m not certain I’ve documented all possible uses. It doesn’t really matter, just that mapping classes and significant code in general seems like it might help get everyone back on track.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/12</link>
        <pubDate>Wed, 21 Feb 2007 04:43:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-12</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@pplsuqbawlz pplsuqbawlz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pplsuqbawlz">@pplsuqbawlz</a> wrote:</p>
          <blockquote>
              <p>I have documented all of DataHandle. Suffice to say, it’s not entirely that interesting.</p>
<p>It just serves as a handler for various data across the client such as thread management, reflection management, visiting web-pages, opening sockets… I mapped datahandle months ago to be honest.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/11</link>
        <pubDate>Tue, 20 Feb 2007 13:46:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-11</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@Krichevskoy Krichevskoy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/krichevskoy">@Krichevskoy</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="7" data-topic="59894">
<div class="title">
<div class="quote-controls"></div>
 Miss Silabsoft:</div>
<blockquote>
<p>what triggers that method?</p>
</blockquote>
</aside>
<p>The method call right before the mouse logging synchronized block, if I remember correctly.</p>
<p><span class="mention">@PSB</span>: Now document all the operation modes of “DataHandle” <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"><br>
Seems to have a content type, a variable-purpose integer attached to it, and a volatile execution state?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/10</link>
        <pubDate>Tue, 20 Feb 2007 04:55:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-10</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@ownagesbot ownagesbot]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ownagesbot">@ownagesbot</a> wrote:</p>
          <blockquote>
              <p>Hehe, leet stuff there, I haven’t read much of the code but first glance looked pretty much solid info. Loved the credit &lt;3 although I didn’t do anything kekeke. Anyway, is this similar to what I found on the getModifiers etc?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/9</link>
        <pubDate>Tue, 20 Feb 2007 04:06:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-9</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@regecks1 regecks`]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/regecks1">@regecks1</a> wrote:</p>
          <blockquote>
              <p>[quote=“pplsuqbawlz, post:6, topic:59894”]Honestly, this is quite <span class="bbcode-i">less</span> of a response I would have expected from such a vivacious community.[/quote]I guess it’s quite hard to see the consequence of this type of detection.</p>
<p>Don’t change the access flags to any fields or methods, and ?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/8</link>
        <pubDate>Tue, 20 Feb 2007 03:30:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-8</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>what triggers that method?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/7</link>
        <pubDate>Mon, 19 Feb 2007 19:48:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-7</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@pplsuqbawlz pplsuqbawlz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pplsuqbawlz">@pplsuqbawlz</a> wrote:</p>
          <blockquote>
              <p>Honestly, this is quite <span class="bbcode-i">less</span> of a response I would have expected from such a vivacious community.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/6</link>
        <pubDate>Mon, 19 Feb 2007 19:38:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-6</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@popcorn89 popcorn89]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/popcorn89">@popcorn89</a> wrote:</p>
          <blockquote>
              <p>Yep.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/5</link>
        <pubDate>Mon, 19 Feb 2007 08:23:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-5</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@frank frank_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/frank">@frank</a> wrote:</p>
          <blockquote>
              <p>i have no clue how the method works, and i honestly have no idea where it is. but do you mean that it pulls the byte[] from the stringwrapper object and writes those?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/4</link>
        <pubDate>Mon, 19 Feb 2007 08:19:53 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-4</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@popcorn89 popcorn89]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/popcorn89">@popcorn89</a> wrote:</p>
          <blockquote>
              <p>It doesn’t use toString, p.pstr() converts it to bytes.</p>
<p>I’m assuming that’s what you meant?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/3</link>
        <pubDate>Mon, 19 Feb 2007 08:15:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-3</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@frank frank_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/frank">@frank</a> wrote:</p>
          <blockquote>
              <p><code>                            Object object = method.invoke(null, objects);
                            if (object != null) {
                                if (object instanceof Number) {
                                    p.p1(1);
                                    p.p8(((Number) object).longValue());
                                } else if (object instanceof stringwrapper) {
                                    p.p1(2);
                                    p.pstr((stringwrapper) object);
                                } else {
                                    p.p1(4);
                                }</code><br>
but the stringwrapper.tostring() method doesnt return anything, so wouldnt it just be sending nulls?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/2</link>
        <pubDate>Mon, 19 Feb 2007 08:06:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-2</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
      <item>
        <title>Reflection Information</title>
        <dc:creator><![CDATA[@pplsuqbawlz pplsuqbawlz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pplsuqbawlz">@pplsuqbawlz</a> wrote:</p>
          <blockquote>
              <p>[code]            p.popcode(145);<br>
p.p1(0);<br>
int startposition = p.pos;<br>
p.p4(reflect.anInt2094);<br>
for (int i = 0; i &lt; reflect.anInt2107; i++) {<br>
if (reflect.anIntArray2081[i] == 0) {<br>
try {</p>
<pre><code>                    int flag = reflect.anIntArray2106[i];
                    if (flag == 0) {
                        Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                        int value = field.getInt(null);
                        p.p1(0);
                        p.p4(value);
                    } else if (flag == 1) {
                        Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                        field.setInt(null, reflect.anIntArray2080[i]);
                        p.p1(0);
                    } else if (flag == 2) {
                        Field field = (Field) reflect.aDataHandleArray2082s[i].result;
                        int accessflags = field.getModifiers();
                        p.p1(0);
                        p.p4(accessflags);
                    } else if (flag == 3) {
                        Method method = (Method) (reflect.aDataHandleArray2074s[i].result);
                        byte[][] is = reflect.aByteArrayArrayArray2099[i];
                        Object[] objects = new Object[is.length];
                        for (int i_8_ = 0; i_8_ &lt; is.length; i_8_++) {
                            ObjectInputStream objectinputstream = (new ObjectInputStream(new ByteArrayInputStream(is[i_8_])));
                            objects[i_8_] = objectinputstream.readObject();
                        }
                        Object object = method.invoke(null, objects);
                        if (object != null) {
                            if (object instanceof Number) {
                                p.p1(1);
                                p.p8(((Number) object).longValue());
                            } else if (object instanceof stringwrapper) {
                                p.p1(2);
                                p.pstr((stringwrapper) object);
                            } else {
                                p.p1(4);
                            }
                        } else {
                            p.p1(0);
                        }
                    } else if (flag == 4) {
                        Method method = (Method) reflect.aDataHandleArray2074s[i].result;
                        int accessflags = method.getModifiers();
                        p.p1(0);
                        p.p4(accessflags);
                    }

                } catch (ClassNotFoundException cnfe) {
                    p.p1(-0x0a);
                } catch (InvalidClassException ice) {
                    p.p1(-0x0b);
                } catch (StreamCorruptedException sce) {
                    p.p1(-0x0c);
                } catch (OptionalDataException ode) {
                    p.p1(-0x0d);
                } catch (IllegalAccessException iacc) {
                    p.p1(-0x0e);
                } catch (IllegalArgumentException iarg) {
                    p.p1(-0x0f);
                } catch (InvocationTargetException ite) {
                    p.p1(-0x10);
                } catch (SecurityException se) {
                    p.p1(-0x11);
                } catch (IOException ioe) {
                    p.p1(-0x12);
                } catch (NullPointerException npe) {
                    p.p1(-0x13);
                } catch (Exception e) {
                    p.p1(-0x14);
                } catch (Throwable t) {
                    p.p1(-0x15);
                }
            } else {
                p.p1(reflect.anIntArray2081[i]);
            }
        }

        p.addcrc(startposition);
        p.psize(p.pos - startposition);[/code]
</code></pre>
<p>Some information on this snippet of code, p stands for “protocol” and yes, this is writing to a packet which IS sent to the server.</p>
<p>Method calls to p use the name scheme “p(name)” such as “popcode” to mean literally “put opcode”.</p>
<p>So, now to see the protocol, it’s not hard to see the protocol for the reflect engine. In this specific deob it’s opcode (or operator code) is 145. It then writes a spacer byte and some int (I don’t care enough to figure it out.). Now it loops for the number of reflection instances there is, and reads from the array what type it is into “flag” in order to do things accordingly.<br>
<span class="bbcode-b">Flag Types</span></p>
<p>[ul][li]0 - get a field’s value[/li]<br>
[li]1 - set a field’s value[/li]<br>
[li]2 - get a fields access flags (aka modifiers)[/li]<br>
[li]3 - call a method and return it’s “value”.[/li]<br>
[li]4 - get a method’s access flags (aka modifiers)[/li][/ul]</p>
<p>In more of a descriptive means…</p>
<p><span class="bbcode-b">Flag Type 0 - field.getInt</span><br>
It writes the success byte of 0, then writes the value of the referenced field onto the packet.</p>
<p><span class="bbcode-b">Flag Type 1 - field.setInt</span><br>
This sets the value of said field to a specified value, then it writes the success byte of 0 onto the packet.</p>
<p><span class="bbcode-b">Flag Type 2 - field.getModifiers</span><br>
This writes the success byte of 0 and then writes the access flags of referenced field onto the packet.</p>
<p><span class="bbcode-b">Flag Type 3 - method.invoke</span><br>
This uses bytes and object streams to collect the real object values etc, and reflect invokes the object and collects the return type.<br>
if it’s a Number type it writes 1 to identify and then the value;<br>
if it’s a string type it writes 2 to identify and then the string.<br>
if it’s not a number or a string it just writes 4 to tell the server that it’s not a type it can return.<br>
Otherwise it writes 0 if the return type is null such as if the method is void? it wont return crap so the object will be null so in such case it just says “0” or success.</p>
<p><span class="bbcode-b">Flag Type 4 - method.getModifiers</span><br>
This writes the success byte of 0 and then writes the access flags of referenced method onto the packet.</p>
<p><span class="bbcode-b">Finally</span><br>
Now exists the parts where it writes all the errors (if any) down onto the packet, you’ll notice they’re all negative.</p>
<p>And the last else  statement which simply writes what that int array’s value is if it’s not 0.</p>
<p>Lastly, it adds a crc from the current location from the start, and adds a byte at the start stating it’s end position… a queer-ish way to see the packet size without writing it.</p>
<p><span class="bbcode-b">Conclusion</span><br>
I hope this clears up some rumors about reflection in the client… One such is Sythe’s claim that they don’t and all this other crap he told me. Frankly, he was wrong. Anyway, &lt;3 to ownagesbot, popcorn89, speljohan, taios… and anyone I forgot.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reflection-information/59894/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reflection-information/59894/1</link>
        <pubDate>Mon, 19 Feb 2007 07:39:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-59894-1</guid>
        <source url="https://forum.moparisthebest.com/t/reflection-information/59894.rss">Reflection Information</source>
      </item>
  </channel>
</rss>
