<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/php-mysql-all-results-return-empty-if-first-select-is-empty/445521 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 02:17:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>PHP mysql all results return empty if first SELECT is empty - General Programming - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;ve been working on a small php script to track the songs played on a local radio station. It works how it should for inserting artist and songs into the database. However for the playlog its only suppose to insert a ne&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="445521.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;PHP mysql all results return empty if first SELECT is empty&#39;" href="445521.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/php-mysql-all-results-return-empty-if-first-select-is-empty/445521" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/php-mysql-all-results-return-empty-if-first-select-is-empty/445521" />
<meta property="og:title" content="PHP mysql all results return empty if first SELECT is empty" />
<meta name="twitter:title" content="PHP mysql all results return empty if first SELECT is empty" />
<meta property="og:description" content="I’ve been working on a small php script to track the songs played on a local radio station. It works how it should for inserting artist and songs into the database. However for the playlog its only suppose to insert a new song if a song recently played was not found in the last 10 played songs or if the rank is lower than the last ten played songs (accounts for if the radio station plays the song twice in the past 10 played).  If the last 10 songs are the same the scripts runs fine, however if t..." />
<meta name="twitter:description" content="I’ve been working on a small php script to track the songs played on a local radio station. It works how it should for inserting artist and songs into the database. However for the playlog its only suppose to insert a new song if a song recently played was not found in the last 10 played songs or if the rank is lower than the last ten played songs (accounts for if the radio station plays the song twice in the past 10 played).  If the last 10 songs are the same the scripts runs fine, however if t..." />
<meta property="article:published_time" content="2012-06-17T07:49:45+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="445521.html">PHP mysql all results return empty if first SELECT is empty</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T07:49:45Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:17:51Z' class='post-time'>
              August 3, 2016,  3:17am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ve been working on a small php script to track the songs played on a local radio station. It works how it should for inserting artist and songs into the database. However for the playlog its only suppose to insert a new song if a song recently played was not found in the last 10 played songs or if the rank is lower than the last ten played songs (accounts for if the radio station plays the song twice in the past 10 played).</p>
<p>If the last 10 songs are the same the scripts runs fine, however if the last ten songs differ the script inserts all 10 songs into the playlist regardless if its a new song or not.</p>
<p>I am sure its a simple error somewhere but I simply cannot find it, as my source is poorly named I would assume a full working source is necessary for someone to debug this so I have included it.</p>
<p>98rockcron.php</p>
<pre><code class="lang-auto">&lt;?php

define('PLAYLIST_URL', 'http://www.98rock.com/iplaylist/playlist.html?last10=1');
define('PLAYLIST_ROW', 'tr[class^=playlist_row2]');
define('PLAYLIST_ARTIST', 'td[class^=playlist_artist]');
define('DEFAULT_SEPERATOR', '-');


define('DATABASE_HOST', '127.0.0.1');
define('DATABASE_USERNAME', '');
define('DATABASE_PASSWORD', ''); 
define('DATABASE_NAME', '');

define('TABLE_PREFIX', '');
define('TABLE_ARTIST', 'artist');
define('TABLE_SONG', 'song');

include_once('simple_html_dom.php');

function scraping_98rock() {
    $process = curl_init(PLAYLIST_URL);
    curl_setopt($process, CURLOPT_HEADER, 0);
    curl_setopt($process, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($process, CURLOPT_CONNECTTIMEOUT, 1);
    $resp = curl_exec($process);
    curl_close($process);
    $html = str_get_html($resp);
    if ($html == null) {
        die("Could not access the playlist!");
    }
    foreach ($html-&gt;find(PLAYLIST_ROW) as $song) {

        $data = explode(DEFAULT_SEPERATOR, trim($song-&gt;find(PLAYLIST_ARTIST, 0)-&gt;plaintext));
        $item['artist'] = $data[0];
        $item['song'] = $data[1];
        $ret[] = $item;
    }

// clean up memory
    $html-&gt;clear();
    unset($html);

    return $ret;
}

$ret = scraping_98rock();
$link = mysql_connect(DATABASE_HOST, DATABASE_USERNAME, DATABASE_PASSWORD);
if (!$link) {
    die('Could not connect: ' . mysql_error());
}
mysql_select_db(DATABASE_NAME);

$rank = 0;
$ins = 0;
foreach ($ret as $v) {
    $rank++;
    $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $artist = mysql_fetch_row($result);
    if (!$artist) {
        mysql_query("INSERT into " . TABLE_PREFIX . TABLE_ARTIST . " (name) VALUES ('" . mysql_real_escape_string($v['artist']) . "')");
        echo "artist inserted: " . $v['artist'] . "\n";
    }
    if (!$artist) {
        $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $artist = mysql_fetch_row($result);
    }
    $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $song = mysql_fetch_row($result);
    if (!$song) {
       mysql_query("INSERT into song (name,artist_id) VALUES ('" . mysql_real_escape_string($v['song']) . "','" . mysql_real_escape_string($artist[0]) . "')");
        echo "song inserted: " . $v['song'] . "\n";
    }
    if (!$song) {
        $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $song = mysql_fetch_row($result);
    }

    if (!$song || !$artist) {
        echo "DANGER\n";
        continue;
    }

   /* $result = mysql_query("SELECT * FROM  WHERE song_id=$song[0]");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $last = mysql_fetch_row($result);
    if (empty($last)) {
        echo "inserted into playlog \n";
        mysql_query("INSERT into playlog (artist_id,song_id) VALUES ($artist[0],$song[0])");
     $ins++;
    }else if($last[0] &gt; ($rank+$ins){
     echo "Repeat Play \n";
     mysql_query("INSERT into playlog (artist_id,song_id) VALUES ($artist[0],$song[0])");
    mysql_query("UPDATE last SET artist_id=$artist[0], song_id=$song[0] WHERE rank=$rank");

    * }
    */
}
?&gt;
</code></pre>
<p>SimpleHTMLDOM: <a href="http://sourceforge.net/projects/simplehtmldom/" rel="nofollow noopener">http://sourceforge.net/projects/simplehtmldom/</a></p>
<p>the SQL</p>
<pre><code class="lang-auto">-- phpMyAdmin SQL Dump
-- version 3.4.9
-- http://www.phpmyadmin.net
--
-- Host: localhost
-- Generation Time: Jun 17, 2012 at 02:48 AM
-- Server version: 5.1.63
-- PHP Version: 5.2.17

SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;

--
-- Database: `silabsof_98rock`
--

-- --------------------------------------------------------

--
-- Table structure for table `artist`
--

CREATE TABLE IF NOT EXISTS `artist` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(75) NOT NULL,
  `date_added` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=131 ;

--
-- Dumping data for table `artist`
--

INSERT INTO `artist` (`id`, `name`, `date_added`) VALUES
(55, 'Collective Soul ', '2012-06-11 08:59:30'),
(56, 'Staind ', '2012-06-11 09:00:55'),
(57, 'Foo Fighters ', '2012-06-11 09:01:12'),
(58, 'Nirvana ', '2012-06-11 09:01:12'),
(59, 'Slash / Myles Kennedy And The Conspirators ', '2012-06-11 09:01:12'),
(60, 'Aerosmith ', '2012-06-11 09:06:11'),
(61, 'Marilyn Manson ', '2012-06-11 09:14:22'),
(62, 'Shinedown ', '2012-06-11 09:14:53'),
(63, 'Metallica ', '2012-06-11 09:16:33'),
(64, 'Seether ', '2012-06-11 09:16:33'),
(65, 'Incubus ', '2012-06-11 09:20:22'),
(66, 'Volbeat ', '2012-06-11 09:26:02'),
(67, 'Stone Temple Pilots ', '2012-06-11 09:30:02'),
(68, 'Five Finger Death Punch ', '2012-06-11 09:34:02'),
(69, 'Guns N'' Roses ', '2012-06-11 09:38:02'),
(70, 'Green Day ', '2012-06-11 09:54:02'),
(71, 'Pearl Jam ', '2012-06-11 09:58:02'),
(72, 'Linkin Park ', '2012-06-11 09:58:03'),
(73, 'Three Days Grace ', '2012-06-11 10:14:03'),
(74, 'Ozzy Osbourne ', '2012-06-11 10:14:03'),
(75, 'Seven Mary Three ', '2012-06-11 10:18:03'),
(76, '3 Doors Down ', '2012-06-11 10:26:02'),
(77, 'Twisted Sister ', '2012-06-11 10:30:02'),
(78, 'Sick Puppies ', '2012-06-11 10:40:31'),
(79, 'Kid Rock ', '2012-06-11 10:58:02'),
(80, 'Stone Sour ', '2012-06-11 11:02:02'),
(81, 'Led Zeppelin ', '2012-06-11 11:10:08'),
(82, 'Bush ', '2012-06-11 11:34:02'),
(83, 'Chevelle ', '2012-06-11 11:34:02'),
(84, 'Everlast ', '2012-06-11 11:37:20'),
(85, 'Ac/dc ', '2012-06-11 11:50:02'),
(86, 'Korn ', '2012-06-11 11:50:03'),
(87, 'Breaking Benjamin ', '2012-06-11 11:54:58'),
(88, 'Lit ', '2012-06-11 12:02:03'),
(89, 'Trust Company ', '2012-06-11 12:14:02'),
(90, 'Kings Of Leon ', '2012-06-11 12:14:02'),
(91, 'Black Crowes ', '2012-06-11 12:18:03'),
(92, 'Sixx: A.m. ', '2012-06-11 12:22:02'),
(93, 'Tool ', '2012-06-11 12:30:02'),
(94, 'Disturbed ', '2012-06-12 02:09:17'),
(95, 'Offspring ', '2012-06-12 02:09:18'),
(96, 'Breaking Benjamin / Valora ', '2012-06-12 02:09:18'),
(97, 'P.o.d. ', '2012-06-12 02:09:19'),
(98, 'Avenged Sevenfold ', '2012-06-12 02:09:19'),
(99, 'Becoming The Archetype ', '2012-06-17 05:07:56'),
(100, 'Napalm Death ', '2012-06-17 05:07:56'),
(101, 'Parkway Drive ', '2012-06-17 05:07:56'),
(102, 'Bleeding Through ', '2012-06-17 05:07:56'),
(103, 'A Life Once Lost ', '2012-06-17 05:07:56'),
(104, 'Motorhead ', '2012-06-17 05:07:56'),
(105, 'Slayer ', '2012-06-17 05:07:56'),
(106, 'Killswitch Engage ', '2012-06-17 05:07:56'),
(107, 'Gojira ', '2012-06-17 05:07:56'),
(108, 'Megadeth ', '2012-06-17 05:07:56'),
(109, 'Ihsahn ', '2012-06-17 05:12:48'),
(110, 'Kataklysm ', '2012-06-17 05:12:48'),
(111, 'Pantera ', '2012-06-17 05:15:42'),
(112, 'Slipknot ', '2012-06-17 05:30:42'),
(113, 'Lamb Of God ', '2012-06-17 05:32:06'),
(114, 'Dethklok ', '2012-06-17 05:35:22'),
(115, 'Cannibal Corpse ', '2012-06-17 05:39:20'),
(116, 'Dillinger  Escape Plan  ', '2012-06-17 05:49:56'),
(117, 'Prong ', '2012-06-17 05:52:34'),
(118, 'Tardy Brothers ', '2012-06-17 05:53:07'),
(119, 'August Burns Red ', '2012-06-17 05:58:49'),
(120, 'Mnemic ', '2012-06-17 06:02:10'),
(121, 'Iron Maiden ', '2012-06-17 06:06:58'),
(122, 'Godsmack ', '2012-06-17 06:16:34'),
(123, 'Nine Inch Nails ', '2012-06-17 06:26:38'),
(124, 'Pink Floyd ', '2012-06-17 06:43:54'),
(125, 'Live ', '2012-06-17 06:51:40'),
(126, 'Deuce ', '2012-06-17 06:51:40'),
(127, 'Puddle Of Mudd ', '2012-06-17 07:01:14'),
(128, 'Soundgarden ', '2012-06-17 07:06:57'),
(129, 'Rob Zombie ', '2012-06-17 07:20:55'),
(130, 'Alice In Chains ', '2012-06-17 07:45:02');

-- --------------------------------------------------------

--
-- Table structure for table `last`
--

CREATE TABLE IF NOT EXISTS `last` (
  `rank` int(11) NOT NULL,
  `artist_id` int(11) NOT NULL,
  `song_id` int(11) NOT NULL,
  PRIMARY KEY (`rank`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Dumping data for table `last`
--

INSERT INTO `last` (`rank`, `artist_id`, `song_id`) VALUES
(1, 92, 50),
(2, 55, 61),
(3, 57, 100),
(4, 129, 99),
(5, 63, 98),
(6, 128, 97),
(7, 67, 96),
(8, 127, 95),
(9, 62, 6),
(10, 125, 93);

-- --------------------------------------------------------

--
-- Table structure for table `playlog`
--

CREATE TABLE IF NOT EXISTS `playlog` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `artist_id` int(11) NOT NULL,
  `song_id` int(11) NOT NULL,
  `time_added` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `artist_id` (`artist_id`,`song_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=42 ;

-- --------------------------------------------------------

--
-- Table structure for table `song`
--

CREATE TABLE IF NOT EXISTS `song` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(75) NOT NULL,
  `artist_id` int(11) NOT NULL,
  `date_added` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=103 ;

--
-- Dumping data for table `song`
--

INSERT INTO `song` (`id`, `name`, `artist_id`, `date_added`) VALUES
(5, ' The Beautiful People', 61, '2012-06-11 09:14:52'),
(6, ' Bully', 62, '2012-06-11 09:14:53'),
(7, ' Dream On', 60, '2012-06-11 09:14:53'),
(8, ' Not Again', 56, '2012-06-11 09:14:53'),
(9, ' December', 55, '2012-06-11 09:14:53'),
(10, ' These Days', 57, '2012-06-11 09:14:53'),
(11, ' All Apologies', 58, '2012-06-11 09:14:53'),
(12, ' You''re A Lie', 59, '2012-06-11 09:16:33'),
(13, ' Fade To Black', 63, '2012-06-11 09:16:33'),
(14, ' Country Song', 64, '2012-06-11 09:16:33'),
(15, ' Pardon Me', 65, '2012-06-11 09:20:22'),
(16, ' A Warrior''s Call', 66, '2012-06-11 09:26:02'),
(17, ' Sex Type Thing', 67, '2012-06-11 09:30:02'),
(18, ' Coming Down', 68, '2012-06-11 09:34:03'),
(19, ' Paradise City', 69, '2012-06-11 09:38:03'),
(20, ' Holiday', 70, '2012-06-11 09:54:03'),
(21, ' Better Man', 71, '2012-06-11 09:58:02'),
(22, ' Burn It Down', 72, '2012-06-11 09:58:03'),
(23, ' Walk', 57, '2012-06-11 10:02:02'),
(24, ' Animal I Have Become', 73, '2012-06-11 10:14:03'),
(25, ' Mama, I''m Coming Home', 74, '2012-06-11 10:14:03'),
(26, ' Cumbersome', 75, '2012-06-11 10:18:03'),
(27, ' It''s Not My Time', 76, '2012-06-11 10:26:02'),
(28, ' We''re Not Gonna Take It', 77, '2012-06-11 10:30:02'),
(29, ' Diamond Eyes', 62, '2012-06-11 10:32:09'),
(30, ' Basket Case', 70, '2012-06-11 10:37:43'),
(31, ' You''re Going Down', 78, '2012-06-11 10:40:31'),
(32, ' Bawitdaba', 79, '2012-06-11 10:58:02'),
(33, ' Numb', 72, '2012-06-11 11:02:01'),
(34, ' Say You''ll Haunt Me', 80, '2012-06-11 11:02:02'),
(35, ' Lithium', 58, '2012-06-11 11:06:02'),
(36, ' The Ocean', 81, '2012-06-11 11:10:08'),
(37, ' Love In An Elevator', 60, '2012-06-11 11:22:02'),
(38, ' Sweet Dreams', 61, '2012-06-11 11:27:41'),
(39, ' The Sound Of Winter', 82, '2012-06-11 11:34:02'),
(40, ' Send The Pain Below', 83, '2012-06-11 11:34:03'),
(41, ' What It''s Like', 84, '2012-06-11 11:37:20'),
(42, ' Highway To Hell', 85, '2012-06-11 11:50:02'),
(43, ' Make Me Bad', 86, '2012-06-11 11:50:03'),
(44, ' So Cold', 87, '2012-06-11 11:54:58'),
(45, ' Sad But True', 63, '2012-06-11 12:02:03'),
(46, ' My Own Worst Enemy', 88, '2012-06-11 12:02:03'),
(47, ' Heart In My Hands', 89, '2012-06-11 12:14:02'),
(48, ' Use Somebody', 90, '2012-06-11 12:14:02'),
(49, ' Hard To Handle', 91, '2012-06-11 12:18:03'),
(50, ' Lies Of The Beautiful People', 92, '2012-06-11 12:22:02'),
(51, ' Outside', 56, '2012-06-11 12:27:38'),
(52, ' Sober', 93, '2012-06-11 12:30:02'),
(53, ' Inside The Fire', 94, '2012-06-12 02:09:18'),
(54, ' Glycerine', 82, '2012-06-12 02:09:18'),
(55, ' Breaking The Habit', 72, '2012-06-12 02:09:18'),
(56, ' Days Go By', 95, '2012-06-12 02:09:18'),
(57, ' Blow Me Away', 96, '2012-06-12 02:09:18'),
(58, ' Live And Let Die', 69, '2012-06-12 02:09:18'),
(59, ' Youth Of The Nation', 97, '2012-06-12 02:09:19'),
(60, ' So Far Away', 98, '2012-06-12 02:09:19'),
(61, ' Shine', 55, '2012-06-12 02:09:19'),
(62, ' Fallen', 66, '2012-06-12 02:14:03'),
(63, ' Into Oblivion', 99, '2012-06-17 05:07:56'),
(64, ' Quarantined', 100, '2012-06-17 05:07:56'),
(65, ' Sleepwalker', 101, '2012-06-17 05:07:56'),
(66, ' Love Lost In A Hail Of Gunfire', 102, '2012-06-17 05:07:56'),
(67, ' Vulture', 103, '2012-06-17 05:07:56'),
(68, ' I Know How To Die', 104, '2012-06-17 05:07:56'),
(69, ' Epidemic', 105, '2012-06-17 05:07:56'),
(70, ' Self Revolution', 106, '2012-06-17 05:07:56'),
(71, ' L''enfent Sauvage', 107, '2012-06-17 05:07:56'),
(72, ' Holy Wars', 108, '2012-06-17 05:07:56'),
(73, ' The Paranoid', 109, '2012-06-17 05:12:48'),
(74, ' Iron Will', 110, '2012-06-17 05:12:48'),
(75, ' Piss', 111, '2012-06-17 05:15:42'),
(76, ' Psycho Holiday', 111, '2012-06-17 05:18:17'),
(77, ' Wait And Bleed', 112, '2012-06-17 05:30:42'),
(78, ' Ghost Walking', 113, '2012-06-17 05:32:06'),
(79, ' Laser Canon Death Sentence', 114, '2012-06-17 05:35:22'),
(80, ' Demented Aggression', 115, '2012-06-17 05:39:20'),
(81, ' Farewell Mona Lisa', 116, '2012-06-17 05:49:56'),
(82, ' Eternal Heat', 117, '2012-06-17 05:52:34'),
(83, ' Fate''s Call', 118, '2012-06-17 05:53:07'),
(84, ' Composure', 119, '2012-06-17 05:58:49'),
(85, ' Transcend', 120, '2012-06-17 06:02:10'),
(86, ' Children Of The Damned', 121, '2012-06-17 06:06:58'),
(87, ' Daughter', 71, '2012-06-17 06:10:56'),
(88, ' Rocky Mountain Way', 122, '2012-06-17 06:16:34'),
(89, ' Janie''s Got A Gun', 60, '2012-06-17 06:20:34'),
(90, ' Head Like A Hole', 123, '2012-06-17 06:26:38'),
(91, ' Falling Away From Me', 86, '2012-06-17 06:41:10'),
(92, ' Wish You Were Here', 124, '2012-06-17 06:43:55'),
(93, ' I Alone', 125, '2012-06-17 06:51:40'),
(94, ' America', 126, '2012-06-17 06:51:40'),
(95, ' She Hates Me', 127, '2012-06-17 07:01:14'),
(96, ' Vasoline', 67, '2012-06-17 07:04:39'),
(97, ' Live To Rise', 128, '2012-06-17 07:06:57'),
(98, ' Blackened', 63, '2012-06-17 07:11:27'),
(99, ' Dragula', 129, '2012-06-17 07:20:55'),
(100, ' Bridge Burning', 57, '2012-06-17 07:23:09'),
(101, ' Still Counting', 66, '2012-06-17 07:45:02'),
(102, ' I Stay Away', 130, '2012-06-17 07:45:02');

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;</code></pre>
<p>The code that is not working is commented out on the 98rockcron source.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/deathschaos9.html'><span itemprop='name'>deathschaos9</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T10:02:15Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:17:56Z' class='post-time'>
              August 3, 2016,  3:17am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>So simply put your script will add duplicate data to the playlog table that you don’t want? Or am I understanding this incorrectly?</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T11:01:02Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:17:59Z' class='post-time'>
              August 3, 2016,  3:17am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok let me try to give a visual instead of 10 i will make it 3</p>
<p>parse 1:<br>
the last three played:</p>
<ol>
<li>green day - I suck</li>
<li>Mopman - sucks</li>
<li>redneck rampage - one dumb game</li>
</ol>
<p>parse 2:</p>
<ol>
<li>frank_ - is awesome (this should be the only one added to the play log table)</li>
<li>green day - I suck</li>
<li>redneck rampage</li>
</ol>
<p>but  all three get added because all results of the last table return empty if the first lookup is empty.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/deathschaos9.html'><span itemprop='name'>deathschaos9</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T11:45:47Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:00Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ll play with it and see if I can get the results you’re looking for.</p>
<p>EDIT: Okay these are the results that I came up with…</p>
<p><span class="bbcode-b">This is my output the first time after uploading your provided database:</span><br>
Inserted into playlog (Artist: 97, Song: 59)<br>
Inserted into playlog (Artist: 57, Song: 10)<br>
Song inserted: Get Up (103)<br>
Inserted into playlog (Artist: 86, Song: 103)<br>
Song inserted: King Nothing (104)<br>
Inserted into playlog (Artist: 63, Song: 104)<br>
Artist inserted: Red Hot Chili Peppers (131)<br>
Song inserted: Dani California (105)<br>
Inserted into playlog (Artist: 131, Song: 105)<br>
Inserted into playlog (Artist: 66, Song: 16)<br>
Song inserted: For Those About To Rock (106)<br>
Inserted into playlog (Artist: 85, Song: 106)<br>
Artist inserted: Smashing Pumpkins (132)<br>
Song inserted: Today (107)<br>
Inserted into playlog (Artist: 132, Song: 107)<br>
Inserted into playlog (Artist: 98, Song: 60)<br>
Artist inserted: Drowning Pool (133)<br>
Song inserted: Bodies (108)<br>
Inserted into playlog (Artist: 133, Song: 108)</p>
<p><span class="bbcode-b">And about 10 minutes later the output is:</span><br>
Song inserted: The Animal (109)<br>
Inserted into playlog (Artist: 94, Song: 109)<br>
Artist inserted: Oasis (134)<br>
Song inserted: Champagne Supernova (110)<br>
Inserted into playlog (Artist: 134, Song: 110)</p>
<p><span class="bbcode-b">Without my modification it would be:</span><br>
Song inserted: The Animal (109)<br>
Inserted into playlog (Artist: 94, Song: 109)<br>
Artist inserted: Oasis (134)<br>
Song inserted: Champagne Supernova (110)<br>
Inserted into playlog (Artist: 134, Song: 110)<br>
Inserted into playlog (Artist: 97, Song: 59)<br>
Inserted into playlog (Artist: 57, Song: 10)<br>
Inserted into playlog (Artist: 86, Song: 103)<br>
Inserted into playlog (Artist: 63, Song: 104)<br>
Inserted into playlog (Artist: 131, Song: 105)<br>
Inserted into playlog (Artist: 66, Song: 16)<br>
Inserted into playlog (Artist: 85, Song: 106)<br>
Inserted into playlog (Artist: 132, Song: 107)</p>
<p>Does this look correct or am I still not understanding you correctly?  <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T14:18:41Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:04Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>im confused as to the expected behavior, and until then i can’t say what’s wrong with the queries.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T20:52:07Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:37Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>From what she said I’m guessing she is wanting not to add in duplicate entries?</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T21:05:02Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:38Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>With a Java driver, it’s something the lines of <code>SELECT ARTIST,TRACK FROM TABNAME WHERE ARTIST = 'artist' and TRACK = 'track'</code>. The SQL library in Java returns an iterable result - so if iterator.hasNext() is false, then no results were grabbed.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/deathschaos9.html'><span itemprop='name'>deathschaos9</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T23:20:30Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:49Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">&lt;?php

define('PLAYLIST_URL', 'http://www.98rock.com/iplaylist/playlist.html?last10=1');
define('PLAYLIST_ROW', 'tr[class^=playlist_row2]');
define('PLAYLIST_ARTIST', 'td[class^=playlist_artist]');
define('DEFAULT_SEPERATOR', '-');


define('DATABASE_HOST', '127.0.0.1');
define('DATABASE_USERNAME', '');
define('DATABASE_PASSWORD', ''); 
define('DATABASE_NAME', '');

define('TABLE_PREFIX', '');
define('TABLE_ARTIST', 'artist');
define('TABLE_SONG', 'song');

include_once('simple_html_dom.php');

function scraping_98rock() {
    $process = curl_init(PLAYLIST_URL);
    curl_setopt($process, CURLOPT_HEADER, 0);
    curl_setopt($process, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($process, CURLOPT_CONNECTTIMEOUT, 1);
    $resp = curl_exec($process);
    curl_close($process);
    $html = str_get_html($resp);
    if ($html == null) {
        die("Could not access the playlist!");
    }
    foreach ($html-&gt;find(PLAYLIST_ROW) as $song) {

        $data = explode(DEFAULT_SEPERATOR, trim($song-&gt;find(PLAYLIST_ARTIST, 0)-&gt;plaintext));
        $item['artist'] = $data[0];
        $item['song'] = $data[1];
        $ret[] = $item;
    }

// clean up memory
    $html-&gt;clear();
    unset($html);

    return $ret;
}

$ret = scraping_98rock();
$link = mysql_connect(DATABASE_HOST, DATABASE_USERNAME, DATABASE_PASSWORD);
if (!$link) {
    die('Could not connect: ' . mysql_error());
}
mysql_select_db(DATABASE_NAME);

$rank = 0;
$ins = 0;
foreach ($ret as $v) {
    $rank++;
    $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $artist = mysql_fetch_row($result);
    if (!$artist) {
        mysql_query("INSERT into " . TABLE_PREFIX . TABLE_ARTIST . " (name) VALUES ('" . mysql_real_escape_string($v['artist']) . "')");
        echo "Artist inserted: " . $v['artist'] . " (";
    }
    if (!$artist) {
        $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $artist = mysql_fetch_row($result);
		echo "$artist[0])&lt;br /&gt;";
    }
    $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $song = mysql_fetch_row($result);
    if (!$song) {
       mysql_query("INSERT into song (name,artist_id) VALUES ('" . mysql_real_escape_string($v['song']) . "','" . mysql_real_escape_string($artist[0]) . "')");
        echo "Song inserted: " . $v['song'] . " (";
    }
    if (!$song) {
        $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $song = mysql_fetch_row($result);
		echo "$song[0])&lt;br /&gt;";
    }

    if (!$song || !$artist) {
        echo "DANGER&lt;br /&gt;";
        continue;
    }

    $result = mysql_query("SELECT * FROM last WHERE song_id=$song[0]");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $last = mysql_fetch_row($result);
    if (empty($last)) {
		$query = mysql_query("SELECT * FROM playlog WHERE song_id=$song[0] AND artist_id=$artist[0]");
		$result = mysql_fetch_row($query);
		if (empty($result)) {
			echo "Inserted into playlog (Artist: $artist[0], Song: $song[0])&lt;br /&gt;";
			mysql_query("INSERT into playlog (artist_id,song_id) VALUES ($artist[0],$song[0])");
			$ins++;
		}
    } else if($last[0] &gt; ($rank+$ins)){
		echo "Repeat Play &lt;br /&gt;";
		mysql_query("INSERT into playlog (artist_id,song_id) VALUES ($artist[0],$song[0])");
		mysql_query("UPDATE last SET artist_id=$artist[0], song_id=$song[0] WHERE rank=$rank");

    }
}
?&gt;</code></pre>
<p>Here’s your 98rockcron.php with my modifications. Whether or not its correct is up to you <img src="../../images/emoji/twitter/expressionlessae52.png?v=5" title=":expressionless:" class="emoji" alt=":expressionless:"></p>
<p>I added an additional query to prevent duplicate entries from being put into the playlog table.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Skyro.html'><span itemprop='name'>Skyro</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-17T23:37:53Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:18:52Z' class='post-time'>
              August 3, 2016,  3:18am
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Where’s Ruby when you need him, oh that’s right he has a massive hangover. :D.</p>
<p>It’s pretty cool what you’re doing, I suggest asking Ruby. He is a master at anything along the lines of website development.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-18T02:42:26Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:19:16Z' class='post-time'>
              August 3, 2016,  3:19am
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>the issue is here:</p>
<blockquote>Inserted into playlog (Artist: 134, Song: 110)
Inserted into playlog (Artist: 97, Song: 59)
Inserted into playlog (Artist: 57, Song: 10)
Inserted into playlog (Artist: 86, Song: 103)
Inserted into playlog (Artist: 63, Song: 104)
Inserted into playlog (Artist: 131, Song: 105)
Inserted into playlog (Artist: 66, Song: 16)
Inserted into playlog (Artist: 85, Song: 106)
Inserted into playlog (Artist: 132, Song: 107)</blockquote>
<p>I don’t nessesarily want to prevent duplicate entries because at times the radio station gets annoying and plays the same song repeatedly. but what it should do is check the last ten played and only add the new songs to the play log.</p>
<p>the process should like this</p>
<p>get the last10 played song.</p>
<p>Add the artist if needed<br>
Add the song if needed</p>
<p>Check if the song is in the last10 songs played from the previous check</p>
<p>if FALSE</p>
<p>Add the song to the playlog</p>
<p>if TRUE</p>
<p>check to see if the rank+numberOfInsertedSongs is &lt; the last rank for the song</p>
<p>if TRUE</p>
<p>add the song to the playlog  because the song is being repeated</p>
<p>update the last10 played songs</p>
<p>end</p>
<p>the problem is that it usually adds all the songs to the playlog because it thinks it can’t find them in the last10 songs played.</p>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-06-19T07:17:59Z'>
            <time itemprop='dateModified' datetime='2016-08-03T03:21:16Z' class='post-time'>
              August 3, 2016,  3:21am
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ve ended up going a different route which has allowed me to drop the last10 table all together and now functions the way I want</p>
<pre><code class="lang-auto">include_once('simple_html_dom.php');

function scraping_98rock() {
    $process = curl_init(PLAYLIST_URL);
    curl_setopt($process, CURLOPT_HEADER, 0);
    curl_setopt($process, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($process, CURLOPT_CONNECTTIMEOUT, 1);
    $resp = curl_exec($process);
    curl_close($process);
    $html = str_get_html($resp);
    if ($html == null) {
        die("Could not access the playlist!");
    }
    foreach ($html-&gt;find(PLAYLIST_ROW) as $song) {

        $data = explode(DEFAULT_SEPERATOR, trim($song-&gt;find(PLAYLIST_ARTIST, 0)-&gt;plaintext));
        $item['artist'] = $data[0];
        $item['song'] = $data[1];
        $ret[] = $item;
    }

// clean up memory
    $html-&gt;clear();
    unset($html);

    return $ret;
}

$ret = scraping_98rock();
$link = mysql_connect(DATABASE_HOST, DATABASE_USERNAME, DATABASE_PASSWORD);
if (!$link) {
    die('Could not connect: ' . mysql_error());
}
mysql_select_db(DATABASE_NAME);

$songs = array();
foreach ($ret as $v) {
    $rank++;
    $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $artist = mysql_fetch_row($result);
    if (!$artist) {
        mysql_query("INSERT into " . TABLE_PREFIX . TABLE_ARTIST . " (name) VALUES ('" . mysql_real_escape_string($v['artist']) . "')");
        echo "artist inserted: " . $v['artist'] . "\n";
    }
    if (!$artist) {
        $result = mysql_query("SELECT * FROM " . TABLE_PREFIX . TABLE_ARTIST . " WHERE name = '" . mysql_real_escape_string($v['artist']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $artist = mysql_fetch_row($result);
    }
    $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
    if (!$result) {
        die('Could not query:' . mysql_error());
    }
    $song = mysql_fetch_row($result);
    if (!$song) {
        mysql_query("INSERT into song (name,artist_id) VALUES ('" . mysql_real_escape_string($v['song']) . "','" . mysql_real_escape_string($artist[0]) . "')");
        echo "song inserted: " . $v['song'] . "\n";
    }
    if (!$song) {
        $result = mysql_query("SELECT * FROM song WHERE name = '" . mysql_real_escape_string($v['song']) . "'");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        $song = mysql_fetch_row($result);
    }

    if (!$song || !$artist) {
        echo "DANGER\n";
        continue;
    }
    array_push($songs, array("song" =&gt; $song[0], "artist" =&gt; $artist[0]));
}
$result = mysql_query("SELECT * FROM playlog ORDER BY id DESC LIMIT 10");
if (!$result) {
    die('Could not query:' . mysql_error());
}
while ($last = mysql_fetch_array($result)) {
    for ($i = 0; $i &lt; 10; $i++) {
        if ($songs[$i]['song'] == $last['song_id'] &amp;&amp; $songs[$i]['artist'] == $last['artist_id']) {
            unset($songs[$i]);
        }
    }
}
foreach ($songs as $s) {
    if (isset($s)) {
        $result = mysql_query("INSERT into playlog (song_id,artist_id) VALUES ('" . $s['song'] . "','" . $s['artist'] . "')");
        if (!$result) {
            die('Could not query:' . mysql_error());
        }
        echo "Inserted: ".$s['song']." into playlog";
    }
}</code></pre>
      </div>

      <meta itemprop='headline' content='PHP mysql all results return empty if first SELECT is empty'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/php-mysql-all-results-return-empty-if-first-select-is-empty/445521 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 02:17:50 GMT -->
</html>
