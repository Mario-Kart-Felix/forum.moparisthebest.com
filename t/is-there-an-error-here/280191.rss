<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>? Is there an error here?</title>
    <link>https://forum.moparisthebest.com/t/is-there-an-error-here/280191</link>
    <description>public class NPC {
	public int hitIDNPC;
	public int offTimerNPC;
    	public boolean FaceDirection;
    	public int FocusPointX;
    	public int FocusPointY;
	public int npcDefence;
	public String getWho = &quot;&quot;;
	public int face;
	public int absX, absY;
	public boolean aggressive = false;
	public int aggroRadius = 0;
	public int freezeTimer = -1;
	// Devolution&#39;s variables
    	public boolean GraphicsUpdateRequired;
	public boolean animUpdateRequired;
	public boolean dirUpdateRequired;

	public int[] effects = new int[10];
	public boolean faceToUpdateRequired;
	
	public int heightLevel;
	public boolean hit = false;

	public boolean hitUpdateRequired;
	public int HP, MaxHP, hitDiff, MaxHit, animNumber, actionTimer,
			StartKilling, enemyX, enemyY;
	public boolean IsDead, DeadApply, NeedRespawn, IsUnderAttack, IsClose,
			Respawns, IsUnderAttackNpc, IsAttackingNPC, walkingToPlayer,
			followingPlayer;
	public int[] Killing = new int[PlayerHandler.maxPlayers];
	public int makeX, makeY, moverangeX1, moverangeY1, moverangeX2,
			moverangeY2, moveX, moveY, direction, walkingType, attacknpc,
			followPlayer;
	public int npcId;
	public int npcType;
	public int PoisonClear = 0;
	public int poisonDelay = -1;
	public int PoisonDelay = 999999;

	public boolean poisonDmg = false;
	
	public int poisonTimer = -1;
	public boolean RandomWalk;
	public int reducedAttack = -1;
	// Devolution&#39;s variables
	public int respawnTime = 60, attackEmote = 0x326, deathEmote = 0x900; // in
																			// seconds
	public int spawnX, spawnY;
	public String textUpdate;
	public boolean textUpdateRequired;
	public boolean updateRequired;
	public int viewX, viewY;
	public NPC(int _npcId, int _npcType) {
		npcId = _npcId;
		npcType = _npcType;
		direction = -1;
		IsDead = false;
		DeadApply = false;
		actionTimer = 0;
		RandomWalk = true;
		StartKilling = 0;
		IsUnderAttack = false;
		IsClose = false;
		for (int i = 0; i &lt; Killing.length; i++) {
			Killing[i] = 0;
		}
	}

public boolean walk(int extra){
if(absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5091 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5092 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5093 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5095 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5096 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5098 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2415 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2416 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2417 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2418 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2419 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2420 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2421 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2422 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2415 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2416 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2417 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2418 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2419 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2420 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2421 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2422 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2463 &amp;&amp; absY + moveY + extra == 5164 || absX + moveX + extra == 2451 &amp;&amp; absY + moveY + extra == 5171 || absX + moveX + extra == 2464 &amp;&amp; absY + moveY + extra == 5171 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5106 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5107 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5108 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5109 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5110 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5111 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2393 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2394 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2395 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2396 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2397 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2398 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2399 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2400 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2401 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2402 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5106 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5107 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5108 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5109 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5110 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5111 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5112 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5113 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5114 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5115 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5116 || absX + moveX + extra == 2371 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2375 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2376 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2377 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2378 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2379 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2380 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2381 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2382 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2383 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5083 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5084 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5085 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5086 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5087 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5088 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5089 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5091 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5092 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5093 || absX + moveX + extra == 2368 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2369 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2370 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2371 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2375 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2376 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2377 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2378 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2379 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2380 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2381 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2382 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2383 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5096 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5095  || absX + moveX + extra == 3503 &amp;&amp; absY + moveY + extra == 9496 || absX + moveX + extra == 3508 &amp;&amp; absY + moveY + extra == 9502 || absX + moveX + extra == 3507 &amp;&amp; absY + moveY + extra == 9491 || absX + moveX + extra == 3502 &amp;&amp; absY + moveY + extra == 9480 || absX + moveX + extra == 3502 &amp;&amp; absY + moveY + extra == 9479 || absX + moveX + extra == 3496 &amp;&amp; absY + moveY + extra == 9476 || absX + moveX + extra == 3491 &amp;&amp; absY + moveY + extra == 9477 || absX + moveX + extra == 3470 &amp;&amp; absY + moveY + extra == 9484 || absX + moveX + extra == 3469 &amp;&amp; absY + moveY + extra == 9488 || absX + moveX + extra == 3470 &amp;&amp; absY + moveY + extra == 9490 || absX + moveX + extra == 3461 &amp;&amp; absY + moveY + extra == 9483 || absX + moveX + extra == 3464 &amp;&amp; absY + moveY + extra == 9480 || absX + moveX + extra == 3464 &amp;&amp; absY + moveY + extra == 9485 || absX + moveX + extra == 3492 &amp;&amp; absY + moveY + extra == 9491 || absX + moveX + extra == 3496 &amp;&amp; absY + moveY + extra == 9497 || absX + moveX + extra == 3471 &amp;&amp; absY + moveY + extra == 9501 || absX + moveX + extra == 3466 &amp;&amp; absY + moveY + extra == 9515 || absX + moveX + extra == 3484 &amp;&amp; absY + moveY + extra == 9526 || absX + moveX + extra == 3486 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3499 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3504 &amp;&amp; absY + moveY + extra == 9523 || absX + moveX + extra == 3507 &amp;&amp; absY + moveY + extra == 9522 || absX + moveX + extra == 3509 &amp;&amp; absY + moveY + extra == 9521 || absX + moveX + extra == 3511 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3513 &amp;&amp; absY + moveY + extra == 9522 || absX + moveX + extra == 3511 &amp;&amp; absY + moveY + extra == 9518){
return true;
} else {
return false;
}
}

    private void npcPos()
    {
        for(int i = 0; i &lt; server.npcHandler.maxNPCs; i++)
        {
            if(server.npcHandler.npcs[i] != null &amp;&amp; absX + moveX == server.npcHandler.npcs[i].absX &amp;&amp; absY + moveY == server.npcHandler.npcs[i].absY || (server.npcHandler.npcs[i] != null &amp;&amp; server.npcHandler.npcs[i].npcType != 2741 &amp;&amp; server.npcHandler.npcs[i].npcType != 2743 &amp;&amp; server.npcHandler.npcs[i].npcType != 2745 &amp;&amp; server.npcHandler.npcs[i].npcType != 1459 &amp;&amp; (walk(0)))
/*	Big NPCs		*/
|| 
(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 2741 || server.npcHandler.npcs[i].npcType == 2743 || server.npcHandler.npcs[i].npcType == 2745 || server.npcHandler.npcs[i].npcType == 1459) &amp;&amp;  (walk(3)))

/*	Big NPCs 2		*/
||
(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 2745) &amp;&amp; (walk(4))))
            {
                moveX = 0;
                moveY = 0;
            }
        }

    }

    private void playerPos()
    {
label0:
        {
            int i = 0;
            do
            {
                PlayerHandler _tmp = server.playerHandler;
                if(i &gt;= 275)
                {
                    break label0;
                }
                PlayerHandler _tmp1 = server.playerHandler;
                if(PlayerHandler.players[i] != null)
                {
                    PlayerHandler _tmp2 = server.playerHandler;
                    if(absX + moveX == PlayerHandler.players[i].absX)
                    {
                        PlayerHandler _tmp3 = server.playerHandler;
                        if(absY + moveY == PlayerHandler.players[i].absY)
                        {
                            moveX = 0;
                            moveY = 0;
                        }
                    }
                }
                i++;
            } while(true);
        }
    }

    private void largeNPCPos()
    {
        for(int i = 0; i &lt; server.npcHandler.maxNPCs; i++)
        {
            if(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 1158 || server.npcHandler.npcs[i].npcType == 1160 || server.npcHandler.npcs[i].npcType == 2743 || server.npcHandler.npcs[i].npcType == 2745) &amp;&amp; (absX + moveX == server.npcHandler.npcs[i].absX &amp;&amp; absY + moveY == server.npcHandler.npcs[i].absY || WithinDistance(absX + moveX, absY + moveY, server.npcHandler.npcs[i].absX, server.npcHandler.npcs[i].absY, 3)))
            {
                moveX = 0;
                moveY = 0;
            }
        }

    }

    public boolean WithinDistance(int i, int j, int k, int l, int i1)
    {
        for(int j1 = 0; j1 &lt;= i1; j1++)
        {
            for(int k1 = 0; k1 &lt;= i1; k1++)
            {
                if(i + j1 == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
                {
                    return true;
                }
                if(i - j1 == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
                {
                    return true;
                }
                if(i == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
                {
                    return true;
                }
            }

        }

        return false;
    }


    public void TurnNpcTo(int i, int j)
    {
        FocusPointX = 2 * i + 1;
        FocusPointY = 2 * j + 1;
        updateRequired = true;
        FaceDirection = true;
    }

    private void appendSetFocusDestination(stream stream1)
    {
        if(stream1 != null)
        {
            stream1.writeWordBigEndian(FocusPointX);
            stream1.writeWordBigEndian(FocusPointY);
        }
    }
	public void appendAnimUpdate(stream str) {
		str.writeWordBigEndian(animNumber);
		str.writeByte(1);
	}

	public void appendDirUpdate(stream str) {
		str.writeWord(direction);
	}

	public void appendFaceToUpdate(stream str) {
		str.writeWordBigEndian(viewX);
		str.writeWordBigEndian(viewY);
	}

	protected void appendHitUpdate(stream str) {
		try {
			if (hit == true) {HP -= hitDiff;hit = false;}
			if (HP &lt;= 0) {
				IsDead = true;
			}
			str.writeByteC(hitDiff); // What the npc got &#39;hit&#39; for
			if ((hitDiff &gt; 0) &amp;&amp; !poisonDmg) {
				str.writeByteS(1); // 0: red hitting - 1: blue hitting
			} else if ((hitDiff &gt; 0) &amp;&amp; poisonDmg) {
				str.writeByteS(2); // 0: red hitting - 1: blue hitting
			} else {
				str.writeByteS(0); // 0: red hitting - 1: blue hitting
			}
			str.writeByteS(misc.getCurrentHP(HP, MaxHP, 100));
			str.writeByteC(100);
			poisonDmg = false;
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public void appendNPCUpdateBlock(stream str) {
		if (!updateRequired)
			return; // nothing required
		int updateMask = 0;
		if (textUpdateRequired)
			updateMask |= 1;
		if (animUpdateRequired)
			updateMask |= 0x10;
		// if(hitUpdateRequired) updateMask |= 0x8;
		if (hitUpdateRequired)
			updateMask |= 0x40;
		if (dirUpdateRequired)
			updateMask |= 0x20;
		if (faceToUpdateRequired)
			updateMask |= 0x20;
            	if(FaceDirection)
                	updateMask |= 4;
		/*
		 * if(updateMask &gt;= 0x100) { // byte isn&#39;t sufficient updateMask |=
		 * 0x40; // indication for the client that updateMask is stored in a
		 * word str.writeByte(updateMask &amp; 0xFF); str.writeByte(updateMask &gt;&gt;
		 * 8); } else {
		 */
		str.writeByte(updateMask);
		// }

		// now writing the various update blocks itself - note that their order
		// crucial
		if (textUpdateRequired) {
			str.writeString(textUpdate);
		}
		if (animUpdateRequired)
			appendAnimUpdate(str);
		if (hitUpdateRequired)
			appendHitUpdate(str);
		if (dirUpdateRequired)
			appendDirUpdate(str);
		if (faceToUpdateRequired)
			appendFaceToUpdate(str);
            	if(FaceDirection)
                	appendSetFocusDestination(str);
		// TODO: add the various other update blocks
	}

	public void clearUpdateFlags() {
		updateRequired = false;
		textUpdateRequired = false;
		hitUpdateRequired = false;
		animUpdateRequired = false;
		dirUpdateRequired = false;
		textUpdate = null;
	        FaceDirection = false;
		moveX = 0;
		moveY = 0;
		direction = -1;
	}


	public int getKiller() {
		int Killer = 0;
		int Count = 0;
		for (int i = 1; i &lt; PlayerHandler.maxPlayers; i++) {
			if (false) {
				Killer = i;
				Count = 1;
			} else {
				if (Killing[i] &gt; Killing[Killer]) {
					Killer = i;
					Count = 1;
				} else if (Killing[i] == Killing[Killer]) {
					Count++;
				}
			}
		}
		return Killer;
	}

	public void getNextNPCMovement() {
        npcPos();
        //playerPos();
        //largeNPCPos();
		if (freezeTimer &lt;= 0) {
			direction = -1;
			direction = getNextWalkingDirection();
		}
	}

	// returns 0-7 for next walking direction or -1, if we&#39;re not moving
	public int getNextWalkingDirection() {
		int dir;
		dir = misc.direction(absX, absY, (absX + moveX), (absY + moveY));
		if (dir == -1)
			return -1;
		dir &gt;&gt;= 1;
		absX += moveX;
		absY += moveY;
		return dir;
	}


	public void updateNPCMovement(stream str) {
		if (direction == -1) {
			// don&#39;t have to update the npc position, because the npc is just
			// standing
			if (updateRequired) {
				// tell client there&#39;s an update block appended at the end
				str.writeBits(1, 1);
				str.writeBits(2, 0);
			} else {
				str.writeBits(1, 0);
			}
		} else {
			// send &quot;walking packet&quot;
			str.writeBits(1, 1);
			str.writeBits(2, 1); // updateType
			str.writeBits(3, misc.xlateDirectionToClient[direction]);
			if (updateRequired) {
				str.writeBits(1, 1); // tell client there&#39;s an update block
										// appended at the end
			} else {
				str.writeBits(1, 0);
			}
		}
	}
}</description>
    
    <lastBuildDate>Sun, 24 May 2009 17:30:37 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/is-there-an-error-here/280191.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>? Is there an error here?</title>
        <dc:creator><![CDATA[@Zezerex Zezerex]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zezerex">@Zezerex</a> wrote:</p>
          <blockquote>
              <p>public class NPC {<br>
public int hitIDNPC;<br>
public int offTimerNPC;<br>
public boolean FaceDirection;<br>
public int FocusPointX;<br>
public int FocusPointY;<br>
public int npcDefence;<br>
public String getWho = “”;<br>
public int face;<br>
public int absX, absY;<br>
public boolean aggressive = false;<br>
public int aggroRadius = 0;<br>
public int freezeTimer = -1;<br>
// Devolution’s variables<br>
public boolean GraphicsUpdateRequired;<br>
public boolean animUpdateRequired;<br>
public boolean dirUpdateRequired;</p>
<pre><code>public int[] effects = new int[10];
public boolean faceToUpdateRequired;

public int heightLevel;
public boolean hit = false;

public boolean hitUpdateRequired;
public int HP, MaxHP, hitDiff, MaxHit, animNumber, actionTimer,
		StartKilling, enemyX, enemyY;
public boolean IsDead, DeadApply, NeedRespawn, IsUnderAttack, IsClose,
		Respawns, IsUnderAttackNpc, IsAttackingNPC, walkingToPlayer,
		followingPlayer;
public int[] Killing = new int[PlayerHandler.maxPlayers];
public int makeX, makeY, moverangeX1, moverangeY1, moverangeX2,
		moverangeY2, moveX, moveY, direction, walkingType, attacknpc,
		followPlayer;
public int npcId;
public int npcType;
public int PoisonClear = 0;
public int poisonDelay = -1;
public int PoisonDelay = 999999;

public boolean poisonDmg = false;

public int poisonTimer = -1;
public boolean RandomWalk;
public int reducedAttack = -1;
// Devolution's variables
public int respawnTime = 60, attackEmote = 0x326, deathEmote = 0x900; // in
																		// seconds
public int spawnX, spawnY;
public String textUpdate;
public boolean textUpdateRequired;
public boolean updateRequired;
public int viewX, viewY;
public NPC(int _npcId, int _npcType) {
	npcId = _npcId;
	npcType = _npcType;
	direction = -1;
	IsDead = false;
	DeadApply = false;
	actionTimer = 0;
	RandomWalk = true;
	StartKilling = 0;
	IsUnderAttack = false;
	IsClose = false;
	for (int i = 0; i &lt; Killing.length; i++) {
		Killing[i] = 0;
	}
}
</code></pre>
<p>public boolean walk(int extra){<br>
if(absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5091 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5092 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5093 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5095 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5096 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5098 || absX + moveX + extra == 2414 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2415 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2416 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2417 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2418 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2419 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2420 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2421 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2422 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2415 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2416 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2417 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2418 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2419 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2420 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2421 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2422 &amp;&amp; absY + moveY + extra == 5099 || absX + moveX + extra == 2463 &amp;&amp; absY + moveY + extra == 5164 || absX + moveX + extra == 2451 &amp;&amp; absY + moveY + extra == 5171 || absX + moveX + extra == 2464 &amp;&amp; absY + moveY + extra == 5171 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5106 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5107 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5108 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5109 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5110 || absX + moveX + extra == 2403 &amp;&amp; absY + moveY + extra == 5111 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2393 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2394 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2395 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2396 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2397 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2398 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2399 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2400 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2401 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2402 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5106 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5107 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5108 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5109 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5110 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5111 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5112 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5113 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5105 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5114 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5115 || absX + moveX + extra == 2392 &amp;&amp; absY + moveY + extra == 5116 || absX + moveX + extra == 2371 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2375 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2376 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2377 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2378 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2379 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2380 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2381 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2382 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2383 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5094 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5083 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5084 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5085 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5086 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5087 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5088 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5089 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5090 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5091 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5092 || absX + moveX + extra == 2384 &amp;&amp; absY + moveY + extra == 5093 || absX + moveX + extra == 2368 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2369 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2370 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2371 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2375 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2376 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2377 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2378 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2379 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2380 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2381 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2382 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2383 &amp;&amp; absY + moveY + extra == 5082 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5096 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2373 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2372 &amp;&amp; absY + moveY + extra == 5097 || absX + moveX + extra == 2374 &amp;&amp; absY + moveY + extra == 5095  || absX + moveX + extra == 3503 &amp;&amp; absY + moveY + extra == 9496 || absX + moveX + extra == 3508 &amp;&amp; absY + moveY + extra == 9502 || absX + moveX + extra == 3507 &amp;&amp; absY + moveY + extra == 9491 || absX + moveX + extra == 3502 &amp;&amp; absY + moveY + extra == 9480 || absX + moveX + extra == 3502 &amp;&amp; absY + moveY + extra == 9479 || absX + moveX + extra == 3496 &amp;&amp; absY + moveY + extra == 9476 || absX + moveX + extra == 3491 &amp;&amp; absY + moveY + extra == 9477 || absX + moveX + extra == 3470 &amp;&amp; absY + moveY + extra == 9484 || absX + moveX + extra == 3469 &amp;&amp; absY + moveY + extra == 9488 || absX + moveX + extra == 3470 &amp;&amp; absY + moveY + extra == 9490 || absX + moveX + extra == 3461 &amp;&amp; absY + moveY + extra == 9483 || absX + moveX + extra == 3464 &amp;&amp; absY + moveY + extra == 9480 || absX + moveX + extra == 3464 &amp;&amp; absY + moveY + extra == 9485 || absX + moveX + extra == 3492 &amp;&amp; absY + moveY + extra == 9491 || absX + moveX + extra == 3496 &amp;&amp; absY + moveY + extra == 9497 || absX + moveX + extra == 3471 &amp;&amp; absY + moveY + extra == 9501 || absX + moveX + extra == 3466 &amp;&amp; absY + moveY + extra == 9515 || absX + moveX + extra == 3484 &amp;&amp; absY + moveY + extra == 9526 || absX + moveX + extra == 3486 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3499 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3504 &amp;&amp; absY + moveY + extra == 9523 || absX + moveX + extra == 3507 &amp;&amp; absY + moveY + extra == 9522 || absX + moveX + extra == 3509 &amp;&amp; absY + moveY + extra == 9521 || absX + moveX + extra == 3511 &amp;&amp; absY + moveY + extra == 9525 || absX + moveX + extra == 3513 &amp;&amp; absY + moveY + extra == 9522 || absX + moveX + extra == 3511 &amp;&amp; absY + moveY + extra == 9518){<br>
return true;<br>
} else {<br>
return false;<br>
}<br>
}</p>
<pre><code>private void npcPos()
{
    for(int i = 0; i &lt; server.npcHandler.maxNPCs; i++)
    {
        if(server.npcHandler.npcs[i] != null &amp;&amp; absX + moveX == server.npcHandler.npcs[i].absX &amp;&amp; absY + moveY == server.npcHandler.npcs[i].absY || (server.npcHandler.npcs[i] != null &amp;&amp; server.npcHandler.npcs[i].npcType != 2741 &amp;&amp; server.npcHandler.npcs[i].npcType != 2743 &amp;&amp; server.npcHandler.npcs[i].npcType != 2745 &amp;&amp; server.npcHandler.npcs[i].npcType != 1459 &amp;&amp; (walk(0)))
</code></pre>
<p>/*	Big NPCs		*/<br>
||<br>
(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 2741 || server.npcHandler.npcs[i].npcType == 2743 || server.npcHandler.npcs[i].npcType == 2745 || server.npcHandler.npcs[i].npcType == 1459) &amp;&amp;  (walk(3)))</p>
<p>/*	Big NPCs 2		*/<br>
||<br>
(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 2745) &amp;&amp; (walk(4))))<br>
{<br>
moveX = 0;<br>
moveY = 0;<br>
}<br>
}</p>
<pre><code>}

private void playerPos()
{
</code></pre>
<p>label0:<br>
{<br>
int i = 0;<br>
do<br>
{<br>
PlayerHandler _tmp = server.playerHandler;<br>
if(i &gt;= 275)<br>
{<br>
break label0;<br>
}<br>
PlayerHandler _tmp1 = server.playerHandler;<br>
if(PlayerHandler.players[i] != null)<br>
{<br>
PlayerHandler _tmp2 = server.playerHandler;<br>
if(absX + moveX == PlayerHandler.players[i].absX)<br>
{<br>
PlayerHandler _tmp3 = server.playerHandler;<br>
if(absY + moveY == PlayerHandler.players[i].absY)<br>
{<br>
moveX = 0;<br>
moveY = 0;<br>
}<br>
}<br>
}<br>
i++;<br>
} while(true);<br>
}<br>
}</p>
<pre><code>private void largeNPCPos()
{
    for(int i = 0; i &lt; server.npcHandler.maxNPCs; i++)
    {
        if(server.npcHandler.npcs[i] != null &amp;&amp; (server.npcHandler.npcs[i].npcType == 1158 || server.npcHandler.npcs[i].npcType == 1160 || server.npcHandler.npcs[i].npcType == 2743 || server.npcHandler.npcs[i].npcType == 2745) &amp;&amp; (absX + moveX == server.npcHandler.npcs[i].absX &amp;&amp; absY + moveY == server.npcHandler.npcs[i].absY || WithinDistance(absX + moveX, absY + moveY, server.npcHandler.npcs[i].absX, server.npcHandler.npcs[i].absY, 3)))
        {
            moveX = 0;
            moveY = 0;
        }
    }

}

public boolean WithinDistance(int i, int j, int k, int l, int i1)
{
    for(int j1 = 0; j1 &lt;= i1; j1++)
    {
        for(int k1 = 0; k1 &lt;= i1; k1++)
        {
            if(i + j1 == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
            {
                return true;
            }
            if(i - j1 == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
            {
                return true;
            }
            if(i == k &amp;&amp; (j + k1 == l || j - k1 == l || j == l))
            {
                return true;
            }
        }

    }

    return false;
}


public void TurnNpcTo(int i, int j)
{
    FocusPointX = 2 * i + 1;
    FocusPointY = 2 * j + 1;
    updateRequired = true;
    FaceDirection = true;
}

private void appendSetFocusDestination(stream stream1)
{
    if(stream1 != null)
    {
        stream1.writeWordBigEndian(FocusPointX);
        stream1.writeWordBigEndian(FocusPointY);
    }
}
public void appendAnimUpdate(stream str) {
	str.writeWordBigEndian(animNumber);
	str.writeByte(1);
}

public void appendDirUpdate(stream str) {
	str.writeWord(direction);
}

public void appendFaceToUpdate(stream str) {
	str.writeWordBigEndian(viewX);
	str.writeWordBigEndian(viewY);
}

protected void appendHitUpdate(stream str) {
	try {
		if (hit == true) {HP -= hitDiff;hit = false;}
		if (HP &lt;= 0) {
			IsDead = true;
		}
		str.writeByteC(hitDiff); // What the npc got 'hit' for
		if ((hitDiff &gt; 0) &amp;&amp; !poisonDmg) {
			str.writeByteS(1); // 0: red hitting - 1: blue hitting
		} else if ((hitDiff &gt; 0) &amp;&amp; poisonDmg) {
			str.writeByteS(2); // 0: red hitting - 1: blue hitting
		} else {
			str.writeByteS(0); // 0: red hitting - 1: blue hitting
		}
		str.writeByteS(misc.getCurrentHP(HP, MaxHP, 100));
		str.writeByteC(100);
		poisonDmg = false;
	} catch (Exception e) {
		e.printStackTrace();
	}
}

public void appendNPCUpdateBlock(stream str) {
	if (!updateRequired)
		return; // nothing required
	int updateMask = 0;
	if (textUpdateRequired)
		updateMask |= 1;
	if (animUpdateRequired)
		updateMask |= 0x10;
	// if(hitUpdateRequired) updateMask |= 0x8;
	if (hitUpdateRequired)
		updateMask |= 0x40;
	if (dirUpdateRequired)
		updateMask |= 0x20;
	if (faceToUpdateRequired)
		updateMask |= 0x20;
        	if(FaceDirection)
            	updateMask |= 4;
	/*
	 * if(updateMask &gt;= 0x100) { // byte isn't sufficient updateMask |=
	 * 0x40; // indication for the client that updateMask is stored in a
	 * word str.writeByte(updateMask &amp; 0xFF); str.writeByte(updateMask &gt;&gt;
	 * 8); } else {
	 */
	str.writeByte(updateMask);
	// }

	// now writing the various update blocks itself - note that their order
	// crucial
	if (textUpdateRequired) {
		str.writeString(textUpdate);
	}
	if (animUpdateRequired)
		appendAnimUpdate(str);
	if (hitUpdateRequired)
		appendHitUpdate(str);
	if (dirUpdateRequired)
		appendDirUpdate(str);
	if (faceToUpdateRequired)
		appendFaceToUpdate(str);
        	if(FaceDirection)
            	appendSetFocusDestination(str);
	// TODO: add the various other update blocks
}

public void clearUpdateFlags() {
	updateRequired = false;
	textUpdateRequired = false;
	hitUpdateRequired = false;
	animUpdateRequired = false;
	dirUpdateRequired = false;
	textUpdate = null;
        FaceDirection = false;
	moveX = 0;
	moveY = 0;
	direction = -1;
}


public int getKiller() {
	int Killer = 0;
	int Count = 0;
	for (int i = 1; i &lt; PlayerHandler.maxPlayers; i++) {
		if (false) {
			Killer = i;
			Count = 1;
		} else {
			if (Killing[i] &gt; Killing[Killer]) {
				Killer = i;
				Count = 1;
			} else if (Killing[i] == Killing[Killer]) {
				Count++;
			}
		}
	}
	return Killer;
}

public void getNextNPCMovement() {
    npcPos();
    //playerPos();
    //largeNPCPos();
	if (freezeTimer &lt;= 0) {
		direction = -1;
		direction = getNextWalkingDirection();
	}
}

// returns 0-7 for next walking direction or -1, if we're not moving
public int getNextWalkingDirection() {
	int dir;
	dir = misc.direction(absX, absY, (absX + moveX), (absY + moveY));
	if (dir == -1)
		return -1;
	dir &gt;&gt;= 1;
	absX += moveX;
	absY += moveY;
	return dir;
}


public void updateNPCMovement(stream str) {
	if (direction == -1) {
		// don't have to update the npc position, because the npc is just
		// standing
		if (updateRequired) {
			// tell client there's an update block appended at the end
			str.writeBits(1, 1);
			str.writeBits(2, 0);
		} else {
			str.writeBits(1, 0);
		}
	} else {
		// send "walking packet"
		str.writeBits(1, 1);
		str.writeBits(2, 1); // updateType
		str.writeBits(3, misc.xlateDirectionToClient[direction]);
		if (updateRequired) {
			str.writeBits(1, 1); // tell client there's an update block
									// appended at the end
		} else {
			str.writeBits(1, 0);
		}
	}
}
</code></pre>
<p>}</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/is-there-an-error-here/280191/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/is-there-an-error-here/280191/1</link>
        <pubDate>Sun, 24 May 2009 17:30:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-280191-1</guid>
        <source url="https://forum.moparisthebest.com/t/is-there-an-error-here/280191.rss">? Is there an error here?</source>
      </item>
  </channel>
</rss>
