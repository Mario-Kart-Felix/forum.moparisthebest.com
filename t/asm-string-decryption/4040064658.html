<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/asm-string-decryption/404006?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:11:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>ASM String Decryption - Runescape - moparisthebest.com</title>
    <meta name="description" content="I started screwing around with RS hacking again, and I noticed that Jagex added string encryption.  So, here&amp;#39;s my way of decrypting it in ASM.  http://paste.strictfp.com/7429 

To use it, just loop through ClassNodes cal&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="4040064658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;ASM String Decryption&#39;" href="404006.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/asm-string-decryption/404006?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/asm-string-decryption/404006?page=2" />
<meta property="og:title" content="ASM String Decryption" />
<meta name="twitter:title" content="ASM String Decryption" />
<meta property="og:description" content="package com.speedbot.updater.tools;  import java.util.Iterator;  import org.apache.bcel.classfile.Constant; import org.apache.bcel.classfile.ConstantClass; import org.apache.bcel.classfile.ConstantUtf8; import org.apache.bcel.classfile.Method; import org.apache.bcel.generic.ANEWARRAY; import org.apache.bcel.generic.ClassGen; import org.apache.bcel.generic.ConstantPoolGen; import org.apache.bcel.generic.ConstantPushInstruction; import org.apache.bcel.generic.GETSTATIC; import org.apache.bcel.gen..." />
<meta name="twitter:description" content="package com.speedbot.updater.tools;  import java.util.Iterator;  import org.apache.bcel.classfile.Constant; import org.apache.bcel.classfile.ConstantClass; import org.apache.bcel.classfile.ConstantUtf8; import org.apache.bcel.classfile.Method; import org.apache.bcel.generic.ANEWARRAY; import org.apache.bcel.generic.ClassGen; import org.apache.bcel.generic.ConstantPoolGen; import org.apache.bcel.generic.ConstantPushInstruction; import org.apache.bcel.generic.GETSTATIC; import org.apache.bcel.gen..." />
<meta property="article:published_time" content="2011-10-24T17:35:21+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="404006.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="404006.html">ASM String Decryption</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/SpeedIsMeh.html'><span itemprop='name'>SpeedIsMeh</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-10-24T17:35:21Z'>
            <time itemprop='dateModified' datetime='2016-08-01T20:36:40Z' class='post-time'>
              August 1, 2016,  8:36pm
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">
package com.speedbot.updater.tools;

import java.util.Iterator;

import org.apache.bcel.classfile.Constant;
import org.apache.bcel.classfile.ConstantClass;
import org.apache.bcel.classfile.ConstantUtf8;
import org.apache.bcel.classfile.Method;
import org.apache.bcel.generic.ANEWARRAY;
import org.apache.bcel.generic.ClassGen;
import org.apache.bcel.generic.ConstantPoolGen;
import org.apache.bcel.generic.ConstantPushInstruction;
import org.apache.bcel.generic.GETSTATIC;
import org.apache.bcel.generic.Instruction;
import org.apache.bcel.generic.InstructionHandle;
import org.apache.bcel.generic.InstructionList;
import org.apache.bcel.generic.InstructionTargeter;
import org.apache.bcel.generic.LDC;
import org.apache.bcel.generic.MethodGen;
import org.apache.bcel.generic.PUTSTATIC;
import org.apache.bcel.generic.TABLESWITCH;
import org.apache.bcel.generic.TargetLostException;
import org.apache.bcel.generic.Type;
import org.apache.bcel.util.InstructionFinder;

import com.speedbot.updater.gen.RSClass;
import com.sun.org.apache.bcel.internal.Constants;

/**
 * Decrypts strings in the runescape client
 * 
 * @author Speed
 * 
 */
public class StringDecryptor implements DeobfuscatorTransform {
    private final RSClass cg;
    private static final String ARRAY_PATTERN = "constantpushinstruction anewarray (dup constantpushinstruction ldc invokestatic invokestatic aastore)+ putstatic";

    public StringDecryptor(final RSClass cg) {
	this.cg = cg;
    }

    public void run() {
	int arrayCount = countArrays(cg);
	ConstantPoolGen cpg = cg.getConstantPool();

	int[] keys = null;
	int key = -1;
	for (Method m : cg.getMethods()) {
	    if (m.isPrivate() &amp;&amp; m.isStatic()
		    &amp;&amp; m.getReturnType().equals(Type.STRING)
		    &amp;&amp; m.getArgumentTypes()[0].getSignature().equals("[C")) {
		keys = getKeys(m);
		cg.removeMethod(m);
	    } else if (m.isPrivate() &amp;&amp; m.isStatic()
		    &amp;&amp; m.getReturnType().getSignature().equals("[C")
		    &amp;&amp; m.getArgumentTypes()[0].equals(Type.STRING)) {
		key = getKey(m);
		cg.removeMethod(m);
	    }
	}
	if (keys != null &amp;&amp; key != -1) {
	    for (Method m : cg.getMethods()) {
		if (m.getName().equals("&lt;clinit&gt;") &amp;&amp; !m.isAbstract()
			&amp;&amp; !m.isNative()) {
		    MethodGen mg = new MethodGen(m, cg.getClassName(),
			    cg.getConstantPool());
		    InstructionList insList = mg.getInstructionList();
		    InstructionFinder finder = new InstructionFinder(insList);
		    Iterator&lt;InstructionHandle[]&gt; it = finder
			    .search(ARRAY_PATTERN);
		    while (it.hasNext()) {
			InstructionHandle[] handles = it.next();
			int size = ((ConstantPushInstruction) handles[0]
				.getInstruction()).getValue().intValue();
			String[] strings = new String[size];

			for (int i = 2; i &lt; handles.length - 1; i++) {
			    InstructionHandle handle = handles[i];
			    if (handle.getInstruction() instanceof LDC) {
				int index = ((ConstantPushInstruction) handles[i - 1]
					.getInstruction()).getValue()
					.intValue();
				String encrypted = ((LDC) handle
					.getInstruction()).getValue(cpg)
					.toString();
				String decrypted = decrypt(
					decrypt(encrypted, key), keys);
				strings[index] = decrypted;
			    }

			}
			InstructionHandle last = handles[handles.length - 1];
			InstructionHandle next = last.getNext();
			PUTSTATIC putstatic = (PUTSTATIC) last.getInstruction();
			for (InstructionHandle handle : handles) {
			    if (handle.hasTargeters()) {
				for (InstructionTargeter target : handle
					.getTargeters()) {
				    target.updateTarget(handle, next);
				}
			    }
			    try {
				insList.delete(handle);
			    } catch (TargetLostException e) {
				e.printStackTrace();
			    }
			}
			String class_name = putstatic.getClassName(cpg);
			String field_name = putstatic.getFieldName(cpg);
			inline(strings, field_name, class_name);
		    }
		    finder = new InstructionFinder(insList);

		    it = finder.search("ldc invokestatic invokestatic");
		    while (it.hasNext()) {
			InstructionHandle[] handles = it.next();
			LDC ldc = (LDC) handles[0].getInstruction();
			String enc = ldc.getValue(cpg).toString();
			String dec = decrypt(decrypt(enc, key), keys);
			int cp_index = cpg.addString(dec);
			LDC replacement = new LDC(cp_index);
			InstructionHandle hand = null;
			if (handles[2].getNext().getInstruction() instanceof PUTSTATIC
				&amp;&amp; arrayCount == 0) {
			    // inline single strings
			    String fieldName = ((PUTSTATIC) handles[2]
				    .getNext().getInstruction())
				    .getFieldName(cpg);
			    try {
				insList.delete(handles[2].getNext());
			    } catch (TargetLostException e1) {
				e1.printStackTrace();
			    }
			    for (Method method : cg.getMethods()) {
				if (method.isNative() || method.isAbstract())
				    continue;
				MethodGen methodg = new MethodGen(method,
					cg.getClassName(), cpg);
				InstructionList list = methodg
					.getInstructionList();
				InstructionSearcher search = new InstructionSearcher(
					method, cg);
				GETSTATIC get;
				while ((get = search.next(GETSTATIC.class)) != null) {
				    if (get.getClassName(cpg).equals(
					    cg.getClassName())
					    &amp;&amp; get.getFieldName(cpg).equals(
						    fieldName)) {
					if (list.contains(get)) {
					    hand = list
						    .insert(get, replacement);
					    InstructionHandle handle = search.handles[search.index];
					    if (handle.hasTargeters()) {
						for (InstructionTargeter target : handle
							.getTargeters()) {
						    target.updateTarget(handle,
							    hand);
						}
					    }
					    try {
						list.delete(get);
					    } catch (TargetLostException e) {
						e.printStackTrace();
					    }
					}
				    }
				}
				methodg.setMaxLocals();
				methodg.setMaxStack();
				cg.replaceMethod(method, methodg.getMethod());
			    }
			} else {
			    hand = insList.insert(handles[0], replacement);
			}
			Deobfuscator.fixed++;
			for (InstructionHandle handle : handles) {
			    if (handle.hasTargeters()) {
				for (InstructionTargeter target : handle
					.getTargeters()) {
				    target.updateTarget(handle, hand);
				}
			    }
			    try {
				insList.delete(handle);
			    } catch (TargetLostException e) {
				e.printStackTrace();
			    }
			}

		    }
		    mg.setInstructionList(insList);
		    mg.setMaxLocals();
		    mg.setMaxStack();
		    cg.replaceMethod(m, mg.getMethod());
		}
	    }

	}
    }

    private void inline(String[] strings, String field_name, String class_name) {
	ConstantPoolGen cpg = cg.getConstantPool();
	for (Method m : cg.getMethods()) {
	    if (m.isNative() || m.isAbstract())
		continue;
	    MethodGen methodgen = new MethodGen(m, cg.getClassName(), cpg);
	    InstructionList list = methodgen.getInstructionList();
	    InstructionFinder find = new InstructionFinder(list);
	    Iterator&lt;InstructionHandle[]&gt; iterator = find
		    .search("getstatic constantpushinstruction aaload");
	    while (iterator.hasNext()) {
		InstructionHandle[] h = iterator.next();
		GETSTATIC get = (GETSTATIC) h[0].getInstruction();
		if (get.getClassName(cpg).equals(class_name)
			&amp;&amp; get.getFieldName(cpg).equals(field_name)) {
		    int index = ((ConstantPushInstruction) h[1]
			    .getInstruction()).getValue().intValue();
		    String s = strings[index];
		    if (s == null)
			continue;

		    int cp_index = cpg.lookupString(s);
		    if (cp_index &lt; 0) {
			cp_index = cpg.addString(s);
		    }
		    Deobfuscator.fixed++;
		    LDC ldc = new LDC(cp_index);
		    InstructionHandle temp = list.insert(h[0], ldc);
		    for (int i = 0; i &lt; h.length; i++) {
			if (h[i].hasTargeters()) {
			    for (InstructionTargeter target : h[i]
				    .getTargeters()) {
				target.updateTarget(h[i], temp);
			    }
			}
			try {
			    list.delete(h[i]);
			} catch (TargetLostException e) {
			    e.printStackTrace();
			}
		    }

		}
	    }
	    methodgen.setMaxLocals();
	    methodgen.setMaxStack();
	    methodgen.setInstructionList(list);
	    cg.replaceMethod(m, methodgen.getMethod());
	}
	cg.setConstantPool(cpg);
    }

    private int countArrays(RSClass cg) {
	int count = 0;
	for (Method m : cg.getMethods()) {
	    if (m.getName().equals("&lt;clinit&gt;")) {
		InstructionSearcher searcher = new InstructionSearcher(m, cg);
		ANEWARRAY newArrayIns;
		while ((newArrayIns = searcher.next(ANEWARRAY.class)) != null) {
		    if (cg.getConstantPool()
			    .getConstant(newArrayIns.getIndex()).getTag() == Constants.CONSTANT_Class) {
			ConstantClass clz = (ConstantClass) cg
				.getConstantPool().getConstant(
					newArrayIns.getIndex());
			Constant c = cg.getConstantPool().getConstant(
				clz.getNameIndex());
			if (c instanceof ConstantUtf8) {
			    if (((ConstantUtf8) c).getBytes().equals(
				    "java/lang/String")) {
				count++;
			    }
			}
		    }
		}
	    }
	}
	return count;
    }

    private static int[] getKeys(final Method m) {
	String pattern = "tableswitch ConstantPushInstruction goto ConstantPushInstruction goto ConstantPushInstruction goto ConstantPushInstruction goto ConstantPushInstruction ixor";
	InstructionFinder find = new InstructionFinder(new InstructionList(m
		.getCode().getCode()));
	int[] keys = new int[5];
	Iterator&lt;InstructionHandle[]&gt; it = find.search(pattern);
	int i = 0;
	while (it.hasNext()) {
	    InstructionHandle[] handles = it.next();
	    TABLESWITCH tblswitch = (TABLESWITCH) handles[0].getInstruction();
	    for (InstructionHandle handle : tblswitch.getTargets()) {
		Instruction ins = handle.getInstruction();
		if (ins instanceof ConstantPushInstruction) {
		    keys[i++] = ((ConstantPushInstruction) ins).getValue()
			    .intValue();
		}
	    }
	    Instruction o = tblswitch.getTarget().getInstruction();
	    if (o instanceof ConstantPushInstruction) {
		keys[i++] = ((ConstantPushInstruction) o).getValue().intValue();
	    }

	}
	return keys;
    }

    private static char[] decrypt(final String string, final int key) {
	char[] cs = string.toCharArray();
	if (cs.length &lt; 2 &amp;&amp; cs.length &gt; 0)
	    cs[0] ^= (char) key;
	return cs;
    }

    private static String decrypt(char[] input, final int[] keys) {
	int index = 0;
	for (;;) {
	    if (input.length &lt;= index)
		break;
	    char c = input[index];
	    char xor = (char) keys[index % 5];
	    input[index] = (char) (c ^ xor);
	    index++;
	}
	String string = new String(input);
	return string.intern();
    }

    private static final int getKey(Method m) {
	String pattern = "caload ConstantPushInstruction ixor i2c";
	InstructionFinder finder = new InstructionFinder(new InstructionList(m
		.getCode().getCode()));
	Iterator&lt;InstructionHandle[]&gt; it = finder.search(pattern);
	while (it.hasNext()) {
	    InstructionHandle handle = it.next()[1];
	    Instruction i = handle.getInstruction();
	    if (i instanceof ConstantPushInstruction) {
		return ((ConstantPushInstruction) i).getValue().intValue();
	    }
	}
	return -1;
    }

    static class InstructionSearcher {
	InstructionList list;
	Method m;
	ClassGen cg;
	InstructionFinder finder;
	int index;
	InstructionHandle[] handles;

	InstructionSearcher(Method m, ClassGen cg) {
	    this.cg = cg;
	    this.m = m;
	    this.list = new InstructionList(m.getCode().getCode());
	    this.finder = new InstructionFinder(list);
	    handles = list.getInstructionHandles();
	}

	public &lt;T&gt; T next(Class&lt;T&gt; type) {
	    for (int i = index + 1; i &lt; handles.length; i++) {
		index++;
		if (handles[i].getInstruction() == null)
		    continue;
		if (type.isAssignableFrom(handles[i].getInstruction()
			.getClass())) {
		    return type.cast(handles[i].getInstruction());
		}
	    }
	    return null;
	}

	public InstructionHandle next() {
	    if (index + 1 &gt;= handles.length) {
		return null;
	    }
	    return handles[++index];
	}
    }
}</code></pre>
<p>This is my BCEL version, it’s pretty old since I haven’t touched the client for many months now but it should still work.</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-14T21:44:08Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:18:00Z' class='post-time'>
              August 2, 2016,  3:18pm
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Has changed.</p>
<pre><code class="lang-auto">z(z(a(tmp112_107)));</code></pre>
<pre><code class="lang-auto">  static String a(String paramString)
  {
    String str = "super_ method 7203";
    char[] arrayOfChar;
    for (int j = (arrayOfChar = new char[paramString.length()]).length - 1; j &gt;= 0; j--)
    {
      String tmp20_19 = str;
      int k = tmp20_19.charAt(j % tmp20_19.length()) &amp; 0x3F;
      int tmp37_36 = j;
      arrayOfChar[tmp37_36] = (char)(paramString.charAt(tmp37_36) ^ k);
    }
    return new String(arrayOfChar);
  }</code></pre>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/SpeedIsMeh.html'><span itemprop='name'>SpeedIsMeh</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-14T22:39:52Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:18:03Z' class='post-time'>
              August 2, 2016,  3:18pm
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sinisoul, post:22, topic:404006”]Has changed.</p>
<pre><code class="lang-auto">z(z(a(tmp112_107)));</code></pre>
<p><code>
  static String a(String paramString)
  {
    String str = "super_ method 7203";
    char[] arrayOfChar;
    for (int j = (arrayOfChar = new char[paramString.length()]).length - 1; j &gt;= 0; j--)
    {
      String tmp20_19 = str;
      int k = tmp20_19.charAt(j % tmp20_19.length()) &amp; 0x3F;
      int tmp37_36 = j;
      arrayOfChar[tmp37_36] = (char)(paramString.charAt(tmp37_36) ^ k);
    }
    return new String(arrayOfChar);
  }
</code>[/quote]<br>
old news but ill write one quickly now and post</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-14T23:41:05Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:18:07Z' class='post-time'>
              August 2, 2016,  3:18pm
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a href="http://pastie.org/3186587" class="onebox" target="_blank" rel="nofollow noopener">http://pastie.org/3186587</a></p>
<p>There’s my shitty hard coded one, if anyone just needed a reference.</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_Discardedx21.html'><span itemprop='name'>_Discardedx21</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T02:50:16Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:18:16Z' class='post-time'>
              August 2, 2016,  3:18pm
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/SpeedIsMeh.html'><span itemprop='name'>SpeedIsMeh</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T16:40:48Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:18:50Z' class='post-time'>
              August 2, 2016,  3:18pm
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="<code>Discardedx2</code>, post:25, topic:404006"][code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.[/quote]</p>
<p>I’m sure this new encryption is just the same as the old one with the addition of:</p>
<pre><code class="lang-auto">	private static String decrypt_a(String string, String key) {
		char[] cs = new char[string.length()];
		for (int i = cs.length - 1; i &gt;= 0; i--) {
			int xor = key.charAt(i % key.length()) &amp; 0x3f;
			cs[i] = (char) (string.charAt(i) ^ xor);
		}
		return new String(cs);

	}</code></pre>
<p>so it’s not much different from the other one at all <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T19:13:17Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:19:01Z' class='post-time'>
              August 2, 2016,  3:19pm
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“SpeedIsMeh, post:26, topic:404006”][quote author=<code>Discardedx2</code> link=topic=501062.msg3887786#msg3887786 date=1326595816]</p>
<p>[code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.<br>
[/quote]</p>
<p>I’m sure this new encryption is just the same as the old one with the addition of:</p>
<pre><code class="lang-auto">	private static String decrypt_a(String string, String key) {
		char[] cs = new char[string.length()];
		for (int i = cs.length - 1; i &gt;= 0; i--) {
			int xor = key.charAt(i % key.length()) &amp; 0x3f;
			cs[i] = (char) (string.charAt(i) ^ xor);
		}
		return new String(cs);

	}</code></pre>
<p>so it’s not much different from the other one at all :P[/quote]</p>
<p>There is not much of a difference at all, no. By the way Dx2 we already have examples of code that already work so why are you posting new ones…?</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_Discardedx21.html'><span itemprop='name'>_Discardedx21</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T19:25:42Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:19:02Z' class='post-time'>
              August 2, 2016,  3:19pm
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sinisoul, post:27, topic:404006”][quote author=SpeedIsMeh link=topic=501062.msg3888232#msg3888232 date=1326645648]</p>
<aside class="quote">
<blockquote>
<p>[code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.</p>
</blockquote>
</aside>
<p>I’m sure this new encryption is just the same as the old one with the addition of:</p>
<pre><code class="lang-auto">	private static String decrypt_a(String string, String key) {
		char[] cs = new char[string.length()];
		for (int i = cs.length - 1; i &gt;= 0; i--) {
			int xor = key.charAt(i % key.length()) &amp; 0x3f;
			cs[i] = (char) (string.charAt(i) ^ xor);
		}
		return new String(cs);

	}</code></pre>
<p>so it’s not much different from the other one at all <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"><br>
[/quote]</p>
<p>There is not much of a difference at all, no. By the way Dx2 we already have examples of code that already work so why are you posting new ones…?[/quote]</p>
<p>because your code sucked</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/SpeedIsMeh.html'><span itemprop='name'>SpeedIsMeh</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T19:31:07Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:19:02Z' class='post-time'>
              August 2, 2016,  3:19pm
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a href="http://pastie.org/private/kiothawpjyhi5o0o9tb3a" class="onebox" target="_blank" rel="nofollow noopener">http://pastie.org/private/kiothawpjyhi5o0o9tb3a</a></p>
<p>Standalone version of my decrypter, just remove the superclassing and change the super(cg) to this.cg = cg; and add a cg field, then it should work standalone.</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T19:39:05Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:19:02Z' class='post-time'>
              August 2, 2016,  3:19pm
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="<code>Discardedx2</code>, post:28, topic:404006"][quote author=sinisoul link=topic=501062.msg3888407#msg3888407 date=1326654797]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>[code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.</p>
</blockquote>
</aside>
<p>I’m sure this new encryption is just the same as the old one with the addition of:</p>
<pre><code class="lang-auto">	private static String decrypt_a(String string, String key) {
		char[] cs = new char[string.length()];
		for (int i = cs.length - 1; i &gt;= 0; i--) {
			int xor = key.charAt(i % key.length()) &amp; 0x3f;
			cs[i] = (char) (string.charAt(i) ^ xor);
		}
		return new String(cs);

	}</code></pre>
<p>so it’s not much different from the other one at all <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
</blockquote>
</aside>
<p>There is not much of a difference at all, no. By the way Dx2 we already have examples of code that already work so why are you posting new ones…?<br>
[/quote]</p>
<p>because your code sucked[/quote]</p>
<blockquote>http://pastie.org/3186587
<p>There’s my shitty hard coded one, if anyone just needed a reference.</p>
</blockquote>
<p>no shit</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/SpeedIsMeh.html'><span itemprop='name'>SpeedIsMeh</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-15T19:43:41Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:19:02Z' class='post-time'>
              August 2, 2016,  3:19pm
            </time>
        <span itemprop='position'>#31</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sinisoul, post:30, topic:404006”][quote author=<code>Discardedx2</code> link=topic=501062.msg3888417#msg3888417 date=1326655542]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>[code]package com.hijackrs.deober.opt.impl;</p>
<p>import java.util.Iterator;<br>
import java.util.List;<br>
import java.util.logging.Logger;</p>
<p>import org.objectweb.asm.Opcodes;<br>
import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.LdcInsnNode;<br>
import org.objectweb.asm.tree.MethodInsnNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>import com.hijackrs.deober.arch.impl.ClassArchive;<br>
import com.hijackrs.deober.opt.Optimizer;<br>
import com.hijackrs.deober.util.InsnMatcher;<br>
import com.hijackrs.deober.util.InsnNodeUtils;<br>
import com.hijackrs.deober.util.InstructionSearcher;<br>
import com.hijackrs.deober.util.StringUtils;</p>
<p>/**</p>
<ul>
<li>
<p>This fixes the “super_” string obfuscation technique</p>
</li>
<li>
<p>added by Jacmob. Heres a little interesting fact</p>
</li>
<li>
<p>for those of you that actually read my documentation!</p>
</li>
<li>
<p>super_ is a reference to the user “super_”, an active member</p>
</li>
<li>
<p>of many programming communities!</p>
</li>
<li>
</li>
<li>
<p>This applies three steps, in order for the standard string decryption to work.</p>
</li>
<li>
<p>First, the program decrypts part of the string with the “super_” key</p>
</li>
<li>
<p>next it removes the INVOKESTATIC instruction that references</p>
</li>
<li>
<p>the decryptSuper method, and finally the decryptSuper method itself</p>
</li>
<li>
<p>is removed from the class.</p>
</li>
<li>
<p><span class="mention">@author</span> `Discardedx2<br>
*/<br>
public class SuperStringOptimizer implements Optimizer {</p>
<p>/**</p>
<ul>
<li>The amount of inlined local variables.<br>
<em>/<br>
private int inlinedVars;<br>
/</em>*</li>
<li>The amount of inlined strings.<br>
<em>/<br>
private int inlinedStrings;<br>
/</em>*</li>
<li>The logger.<br>
<em>/<br>
private final Logger logger = Logger.getLogger(this.getClass().getName());<br>
/</em>*</li>
<li>The pattern used to find a stored encrypted string.<br>
<em>/<br>
private static final String SUPER_INVOKE_PATTERN = “AbstractInsnNode INVOKESTATIC INVOKESTATIC INVOKESTATIC AASTORE”;<br>
/</em>*</li>
<li>The local variable pattern.<br>
*/<br>
private static final int[] LOCAL_VAR_PATTERN = new int[] { Opcodes.LDC, Opcodes.SWAP, Opcodes.DUP_X1, Opcodes.POP, Opcodes.POP };</li>
</ul>
<p>@SuppressWarnings(“unchecked”)<br>
@Override<br>
public void optimize(ClassArchive archive) throws Exception {<br>
logger.info(“Removing ‘super’ string encryption…’”);<br>
outer: for (ClassNode cn : archive) {<br>
MethodNode clinit = null;<br>
LdcInsnNode superLdc = null;<br>
for (MethodNode mn : (List) cn.methods) {<br>
if (superLdc == null) {<br>
if (mn.desc.equals("(Ljava/lang/String;)Ljava/lang/String;")) {<br>
for (Iterator itr = InsnNodeUtils.collect(mn, Opcodes.LDC); itr.hasNext()<img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"> {<br>
LdcInsnNode ldc = (LdcInsnNode) itr.next();<br>
superLdc = ldc;<br>
break;<br>
}<br>
}<br>
}<br>
if (mn.name.equals("")) { // check for the static block, if there is none there is no point<br>
// in attempting to decrypt this class…<br>
clinit = mn;<br>
}<br>
}</p>
<pre><code> 	if (clinit == null || superLdc == null) {
 		continue;
 	}

 	MethodNode[] decMethods = StringUtils.getDecryptionMethods(cn);

 	for (MethodNode dec : decMethods) {
 		if (dec == null) {// We are missing a decryption method.... thats very odd.
 			continue outer;
 		}
 	}

 	InstructionSearcher searcher = new InstructionSearcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = searcher.match(LOCAL_VAR_PATTERN); itr.hasNext();) { // This is probably only needed for RuneScape clients...
 		AbstractInsnNode[] match = itr.next();

 		for (int i = 0; i &lt; match.length; i++) {
 			clinit.instructions.remove(match[i]);
 		}
 		
 		inlinedVars++;
 	}

 	int[] keys = StringUtils.findKeys(decMethods);


 	InsnMatcher matcher = new InsnMatcher(clinit.instructions);
 	for (Iterator&lt;AbstractInsnNode[]&gt; itr = matcher.match(SUPER_INVOKE_PATTERN); itr.hasNext();) {
 		AbstractInsnNode[] match = itr.next();
 		
 		MethodInsnNode superDec = (MethodInsnNode) match[1];
 		
 		AbstractInsnNode insn = match[0];
 		
 		LdcInsnNode ldc;
 		if (insn.getOpcode() == Opcodes.LDC) {
 			ldc = (LdcInsnNode) insn;
 		} else {
 			ldc = (LdcInsnNode) insn.getPrevious();
 		}
 		
 		cn.methods.remove(InsnNodeUtils.resolveMethodInsn(cn, superDec));
 		
 		clinit.instructions.set(ldc, new LdcInsnNode(decryptSuper(StringUtils.decryptStandard(keys, (String) ldc.cst), (String) superLdc.cst)));
 		clinit.instructions.remove(superDec);
 		
 		inlinedStrings++;
 	}
 }
</code></pre>
<p>}</p>
<p>@Override<br>
public void onCompletion() {<br>
logger.info(“Inlined “+inlinedStrings+” strings and “+inlinedVars+” local variables.”);<br>
}</p>
<p>/**</p>
<ul>
<li>Used to decipher the “super_ method” keys.</li>
<li>@param encrypted The encrypted string.</li>
<li>@param key The standard decrypted key.</li>
<li>@return<br>
*/<br>
private String decryptSuper(String encrypted, String key) {<br>
char[] ch = new char[encrypted.length() - 1];<br>
for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] = (char)(encrypted.charAt(pos) ^ (key.charAt(pos % key.length()) &amp; 0x3F));<br>
}<br>
return new String(ch);<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>[code]package com.hijackrs.deober.util;</p>
<p>import java.util.Iterator;<br>
import java.util.List;</p>
<p>import org.objectweb.asm.tree.AbstractInsnNode;<br>
import org.objectweb.asm.tree.ClassNode;<br>
import org.objectweb.asm.tree.MethodNode;</p>
<p>/**</p>
<ul>
<li>
<p>A class filled with utilities used in the StringOptimizer classes.</p>
</li>
<li>
<p>@author `Discardedx2</p>
</li>
<li>
<p>@author Graham Edgecombe<br>
*/<br>
public class StringUtils {</p>
<p>/**</p>
<ul>
<li>The first decryption pattern used to find the first key.<br>
<em>/<br>
public static final String STR_TO_CHARS_PATTERN = “CALOAD (BIPUSH | SIPUSH | ICONST) IXOR I2C CASTORE”;<br>
/</em>*</li>
<li>The second decryption pattern used to find the second keys.<br>
<em>/<br>
public static final String CHARS_TO_STR_PATTERN = "CALOAD ILOAD ICONST IREM (TABLESWITCH | LOOKUPSWITCH) ((BIPUSH | SIPUSH | ICONST) GOTO?)</em> IXOR I2C CASTORE";</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Decrypts a string.</p>
</li>
<li>
<p>@param keys The keys.</p>
</li>
<li>
<p>@param str The encrypted string.</p>
</li>
<li>
<p>@return The decrypted string.<br>
*/<br>
public static String decryptStandard(int[] keys, String str) {<br>
char[] ch = str.toCharArray();<br>
if (ch.length &lt; 2)<br>
ch[0] ^= keys[0];</p>
<p>for (int pos = 0; pos &lt; ch.length; pos++) {<br>
ch[pos] ^= keys[pos % 5 + 1];<br>
}</p>
<p>return new String(ch).intern();<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Finds the key set.</p>
</li>
<li>
<p>@param m1 The string to characters method.</p>
</li>
<li>
<p>@param m2 The characters to string method.</p>
</li>
<li>
<p>@return The keys, or {@code null} if they could not be found.<br>
*/<br>
public static int[] findKeys(MethodNode[] decMethods) {<br>
int[] keys = new int[6];</p>
<p>InsnMatcher matcher = new InsnMatcher(decMethods[0].instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; it = matcher.match(STR_TO_CHARS_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>AbstractInsnNode[] match = it.next();<br>
keys[0] = (int) InsnNodeUtils.getNumericPushValue(match[1]);</p>
<p>matcher = new InsnMatcher(decMethods[1].instructions);<br>
it = matcher.match(CHARS_TO_STR_PATTERN);<br>
if (!it.hasNext())<br>
return null;</p>
<p>match = it.next();<br>
for (int i = 0; i &lt; 5; i++) {<br>
keys[i + 1] = (int) InsnNodeUtils.getNumericPushValue(match[5 + i * 2]);<br>
}</p>
<p>return keys;<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Gets the decryption methods.</p>
</li>
<li>
<p>@return The decryption methods.<br>
*/<br>
@SuppressWarnings(“unchecked”)<br>
public static MethodNode[] getDecryptionMethods(ClassNode cn) {<br>
MethodNode[] min = new MethodNode[2];</p>
<p>for (MethodNode mn : (List) cn.methods) {<br>
InsnMatcher matcher = new InsnMatcher(mn.instructions);<br>
Iterator&lt;AbstractInsnNode[]&gt; strings = matcher.match(STR_TO_CHARS_PATTERN);<br>
Iterator&lt;AbstractInsnNode[]&gt; chars = matcher.match(CHARS_TO_STR_PATTERN);</p>
<pre><code> if (strings.hasNext()) {
 	min[0] = mn;
 } else if (chars.hasNext()) {
 	min[1] = mn;
 }
</code></pre>
<p>}<br>
return min;<br>
}</p>
</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>That fixes the string encryption enough so that the old string decryption will still work. You guys can probably work out what some of the missing methods do by looking at other string decryption classes, I don’t have full permission to post the InsnNodeUtils class.</p>
</blockquote>
</aside>
<p>I’m sure this new encryption is just the same as the old one with the addition of:</p>
<pre><code class="lang-auto">	private static String decrypt_a(String string, String key) {
		char[] cs = new char[string.length()];
		for (int i = cs.length - 1; i &gt;= 0; i--) {
			int xor = key.charAt(i % key.length()) &amp; 0x3f;
			cs[i] = (char) (string.charAt(i) ^ xor);
		}
		return new String(cs);

	}</code></pre>
<p>so it’s not much different from the other one at all <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
</blockquote>
</aside>
<p>There is not much of a difference at all, no. By the way Dx2 we already have examples of code that already work so why are you posting new ones…?</p>
</blockquote>
</aside>
<p>because your code sucked<br>
[/quote]</p>
<aside class="quote">
<blockquote>
<p><a href="http://pastie.org/3186587" rel="nofollow noopener">http://pastie.org/3186587</a></p>
<p>There’s my shitty hard coded one, if anyone just needed a reference.</p>
</blockquote>
</aside>
<p>no shit[/quote]<br>
then why the fuck question him when he posts a better one?</p>
      </div>

      <meta itemprop='headline' content='ASM String Decryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="404006.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/asm-string-decryption/404006?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:11:48 GMT -->
</html>
