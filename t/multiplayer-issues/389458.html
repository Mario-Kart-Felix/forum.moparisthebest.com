<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/multiplayer-issues/389458 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 04:26:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Multiplayer Issues - Runescape - moparisthebest.com</title>
    <meta name="description" content="Okay, it&amp;#39;s been two days. Google has just returned topics on creating a server from searching numerous quotes, and I don&amp;#39;t think anybody else has had the problem I&amp;#39;m about to describe, hence searches returning nothing. 
&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="389458.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Multiplayer Issues&#39;" href="389458.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/multiplayer-issues/389458" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/multiplayer-issues/389458" />
<meta property="og:title" content="Multiplayer Issues" />
<meta name="twitter:title" content="Multiplayer Issues" />
<meta property="og:description" content="Okay, it’s been two days. Google has just returned topics on creating a server from searching numerous quotes, and I don’t think anybody else has had the problem I’m about to describe, hence searches returning nothing.  The Problem:  I’m connected to my server right (base is Project No-Doze - originally Shards), I load up another client and try to connect two players, and the server will kick player 1 and connect player 2. I’ll then try to re-log and it will kick player 2 and connect player 1.  I..." />
<meta name="twitter:description" content="Okay, it’s been two days. Google has just returned topics on creating a server from searching numerous quotes, and I don’t think anybody else has had the problem I’m about to describe, hence searches returning nothing.  The Problem:  I’m connected to my server right (base is Project No-Doze - originally Shards), I load up another client and try to connect two players, and the server will kick player 1 and connect player 2. I’ll then try to re-log and it will kick player 2 and connect player 1.  I..." />
<meta property="article:published_time" content="2011-04-04T12:53:24+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="389458.html">Multiplayer Issues</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-04T12:53:24Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:41:49Z' class='post-time'>
              August 1, 2016,  8:41am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Okay, it’s been two days. Google has just returned topics on creating a server from searching numerous quotes, and I don’t think anybody else has had the problem I’m about to describe, hence searches returning nothing.</p>
<p><span class="bbcode-b">The Problem:</span></p>
<p>I’m connected to my server right (base is Project No-Doze - originally Shards), I load up another client and try to connect two players, and the server will kick player 1 and connect player 2. I’ll then try to re-log and it will kick player 2 and connect player 1.</p>
<p>I also tried this with an outside IP and the effects are the same. Only one player can play on my server at any one given time. Well that’s no use it is?</p>
<p>I’ll post my ConnectionListener, because I think it’s to do with that. No errors return it just don’t let multi people connect.</p>
<p>Can you see anything wrong?</p>
<pre><code class="lang-auto">package com.rs2.net;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.nio.channels.spi.SelectorProvider;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import com.rs2.Constants;
import com.rs2.GameEngine;
import com.rs2.eventmanager.EventManager;
import com.rs2.model.player.Client;
import com.rs2.util.Misc;
import com.rs2.world.PlayerManager;

/**
 * Handles all client IO through the selector.
 * 
 * @author Graham
 */
public class ConnectionListener implements Runnable {

	private ServerSocketChannel serverChannel;
	private Selector selector;
	private Map&lt;SocketChannel, Login&gt; ioClientMap;
	private Map&lt;Login, SocketChannel&gt; revIoClientMap;
	private Map&lt;SocketChannel, Client&gt; clientMap;
	private Map&lt;Client, SocketChannel&gt; revClientMap;
	private ByteBuffer buffer;
	public static final int BUFFER_SIZE = 4096;
	public static final int BACKLOG = 100;
	private boolean toggleShutdown = false;
	private volatile boolean isShutdown = false;

	public ConnectionListener() throws IOException {
		buffer = ByteBuffer.allocate(BUFFER_SIZE);
		ioClientMap = new HashMap&lt;SocketChannel, Login&gt;();
		clientMap = new HashMap&lt;SocketChannel, Client&gt;();
		revIoClientMap = new HashMap&lt;Login, SocketChannel&gt;();
		revClientMap = new HashMap&lt;Client, SocketChannel&gt;();
		selector = SelectorProvider.provider().openSelector();
		serverChannel = ServerSocketChannel.open();
		serverChannel.configureBlocking(false);
		InetSocketAddress iAddress = new InetSocketAddress("56k-hype.no-ip.biz",
				GameEngine.getServerPort());
		serverChannel.socket().bind(iAddress, BACKLOG);
		serverChannel.register(selector, SelectionKey.OP_ACCEPT);
		System.out.println("listening for connections on port "
				+ GameEngine.getServerPort() + ".");
	}

	@Override
	public void run() {
		while (true) {
			try {
				selector.select();
				if (toggleShutdown) {
					isShutdown = true;
					break;
				}
				Iterator&lt;SelectionKey&gt; selectedIterator = selector
						.selectedKeys().iterator();
				while (selectedIterator.hasNext()) {
					SelectionKey selectionKey = selectedIterator.next();
					selectedIterator.remove();
					synchronized (this) {
						if (selectionKey.isValid()) {
							if (selectionKey.isAcceptable()) {
								accept(selectionKey);
							} else if (selectionKey.isReadable()) {
								read(selectionKey);
							}
						}
					}
				}
			} catch (Exception e) {
				System.exit(0);
			}
		}
		System.out.println("Selector thread shut down.");
		if (EventManager.getSingleton().isShutdown()) {
			System.exit(0);
		}
	}

	private void read(SelectionKey selectionKey) throws IOException {

		SocketChannel sc = (SocketChannel) selectionKey.channel();
		buffer.clear();
		int readStatus;

		String address = null;

		Login ioc = ioClientMap.get(sc);
		if (ioc != null) {
			address = ioc.connectedFrom;
		}

		Client c = clientMap.get(sc);
		if (c != null) {
			address = c.connectedFrom;
		}

		try {
			try {
				readStatus = sc.read(buffer);
			} catch (IOException e) {
				destroySocket(sc, address, true);
				return;
			}
			if (readStatus == -1) {
				destroySocket(sc, address, true);
				return;
			}
		} catch (Exception e) {
		}

		ioc = ioClientMap.get(sc);
		if (ioc != null) {
			ioc.read(buffer);
			return;
		}

		c = clientMap.get(sc);
		if (c != null) {
			synchronized (GameEngine.getGameLogicLock()) {
				c.read(buffer);
			}
		}
	}

	private void accept(SelectionKey selectionKey) throws IOException,
			Exception {
		ServerSocketChannel ssc = (ServerSocketChannel) selectionKey.channel();
		SocketChannel sc = ssc.accept();
		String address = sc.socket().getInetAddress().getHostAddress();
		synchronized (HostList.class) {
			if (!HostList.has(address, Constants.MAX_CONNECTIONS_PER_IP)) {
				Misc.print_debug("Accepted connection from " + address + ".");
				Login ioc = PlayerManager.getSingleton().newPlayerClient(
						sc.socket(), address);
				if (ioc == null) {
					destroySocket(sc, address, false);
				} else {
					HostList.add(address);
					ioClientMap.put(sc, ioc);
					revIoClientMap.put(ioc, sc);
					sc.socket().setTcpNoDelay(true);
					sc.configureBlocking(false);
					sc.register(selector, SelectionKey.OP_READ);
				}
			} else {
				Misc.print_debug("Rejected connection from " + address + ".");
				destroySocket(sc, address, false);
			}
		}
	}

	public void destroySocket(SocketChannel sc, String connectedFrom,
			boolean removeFromHostList) throws IOException, Exception {
		if (removeFromHostList) {
			synchronized (HostList.class) {
				HostList.remove(connectedFrom);
			}
		}
		if (ioClientMap.containsKey(sc)) {
			Login ioc = ioClientMap.get(sc);
			PlayerManager.getSingleton().removeIOClient(ioc);
			ioClientMap.remove(sc);
			revIoClientMap.remove(ioc);
		}
		if (clientMap.containsKey(sc)) {
			Client c = clientMap.get(sc);
			c.setLoggedOut(true);
			clientMap.remove(sc);
			revClientMap.remove(c);
		}
		sc.close();
		Misc.print_debug("Closed connection from " + connectedFrom + ".");
	}

	public void switchIoClientToClient(Login ioc, Client c) {
		synchronized (this) {
			SocketChannel sc = revIoClientMap.get(ioc);
			revIoClientMap.remove(ioc);
			ioClientMap.remove(sc);
			clientMap.put(sc, c);
			revClientMap.put(c, sc);
			/* System.out.println("Registered " + c.getUsername() + " [idx="
					+ c.getUserID() + ", online="
					+ PlayerManager.getSingleton().getPlayerCount() + "]"); */
		}
	}

	public SocketChannel socketFor(Login ioc) {
		return revIoClientMap.get(ioc);
	}

	public SocketChannel socketFor(Client c) {
		return revClientMap.get(c);
	}

	public void writeReq(SocketChannel sc, ByteBuffer buf) throws IOException {
		sc.write(buf);
	}

	public void shutdown() {
		toggleShutdown = true;
		selector.wakeup();
	}

	public boolean isShutdown() {
		return this.isShutdown;
	}
}</code></pre>
<p>To me it looks normal.</p>
<p>I also have</p>
<pre><code class="lang-auto">public static final int MAX_PLAYERS = 50;
public static final int MAX_CONNECTIONS_PER_IP = 5;</code></pre>
<p>Before anyone asks. It’s nothing to with that directly. If I could post anymore examples of code, just ask.</p>
<p>More examples:</p>
<p>This is my whole process() method:</p>
<pre><code class="lang-auto">public void process() {
		timeOutCounter++;

		if (isKicked || isLoggedOut()) {
			disconnected = true;
		}

		if (timeOutCounter &gt; Constants.INGAME_TIMEOUT * 2) {
			actionSender.sendLogout();
		}

		if (logoutDelay &gt; 0) {
			logoutDelay--;
		}

	}</code></pre>
<p>I don’t want to start altering things unless I know what I am doing and I don’t what I am doing. I’m guessing this only disconnects you if you are ::kicked or click on the logout button…</p>
<p>Thanks for reading.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Loveandpower.html'><span itemprop='name'>Loveandpower</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-04T12:58:31Z'>
            <time itemprop='dateModified' datetime='2016-08-01T08:41:49Z' class='post-time'>
              August 1, 2016,  8:41am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Does it give any errors when it kicks the person?</p>
<p>Also, does it “kick” or “null” the person so that way other connection can happen?</p>
<p>I never really heard of this either before…</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T11:21:36Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:11Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Bump to first page. I’m still wading through my files looking for possible culprits. I’ll continue doing so until I or someone else sees something that could possibly be causing the problem. It’s been 3 days now lol.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T21:03:09Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:38Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks Tom. Could this be a possibility though: my computer don’t have enough memory to hold two or more players? I’m not sure how I can tell, but if it’s creating a thread/instance for each player? Or allocating certain a certain amount of memory for each player? It could be overloading my computer?</p>
<p>With XAMPP, iTunes, No-IP, the client, the server and Eclipse running I am constantly running between 80-100% CPU. Even without iTunes…</p>
<p>Might have to run some tests when I can.</p>
<p>I’m going to research Shards and see what problems people have had.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/durial12.html'><span itemprop='name'>durial12</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T21:11:00Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:39Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>If that was the case surely you would get an error when it happens. Did you try this from a different IP? (Not sure if that would make any difference)</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T22:57:13Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:48Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>No I get no errors, that’s the thing. It acts as if I click the logout button once pending a new connection. Tom, thank you so much - that will eliminate alot of potential causes for me. If you need help I r pro MySQL now kay?</p>
<p>Best I could do: <a href="http://www.youtube.com/watch?v=0iq0x_xSsEQ" rel="nofollow noopener">http://www.youtube.com/watch?v=0iq0x_xSsEQ</a></p>
<p>Here’s what happens (OMFG why are .gifs not working anymore? Does this play for anyone?):</p>
<p><a href="http://img268.imageshack.us/i/test0002.gif/" data-bbcode="true" rel="nofollow noopener"><img src="http://img268.imageshack.us/img268/6730/test0002.gif" alt width="" height=""></a></p>
<p>No errors in either Run or Client.bat.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Epic_Steve.html'><span itemprop='name'>Epic_Steve</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:05:54Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:49Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You should add some debug printlns to see where the player is getting disconnected from.</p>
<p>System.err.println(“PLAYER DISCONNECTED!!!”);</p>
<p>Add this is places where you think the player could be getting disconnected.<br>
EG: In these methods;</p>
<pre><code class="lang-auto">                if (isKicked || isLoggedOut()) {
                        disconnected = true;
                }

                if (timeOutCounter &gt; Constants.INGAME_TIMEOUT * 2) {
                        actionSender.sendLogout();
                }</code></pre>
<p>Also in the destroySocket(…) method (I know it already has one, but just to be sure it’s actually doing anything.) You should also add it in the try … catch’s as I see you have one catch(Exception e) that doesn’t print anything and the other closes the socke, see if you’re getting an exception.</p>
<p>Also, make sure to might them slightly different so you can tell where it’s actually getting called from, like, just put a number at the end.</p>
<p>System.err.println(“PLAYER DISCONNECTED 1”);</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:09:38Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:49Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>^ Thanks for that Steve, a way to possibly get to the bottom of this. <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> I’ll test and see what I get.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Scape-JAVA.html'><span itemprop='name'>Scape-JAVA</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:20:08Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:50Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You could also throw in a catch exception.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Epic_Steve.html'><span itemprop='name'>Epic_Steve</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:21:52Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:50Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="9" data-topic="389458">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/scape-java/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Scape-JAVA:</div>
<blockquote>
<p>You could also throw in a catch exception.</p>
</blockquote>
</aside>
<p>This also works. I prefer to find where the problem is first then print out the exception.</p>
<p>I’m assuming you mean the printStackTrace() method.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:24:21Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:51Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>If Im just running out of memory to hold anymore players shouldn’t I get that error that returns “[KERNEL] Machine Too Slow!” on the old servers.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Scape-JAVA.html'><span itemprop='name'>Scape-JAVA</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-05T23:28:10Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:00:51Z' class='post-time'>
              August 1, 2016, 11:00am
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="11" data-topic="389458">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/mendorphins/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Mendorphins:</div>
<blockquote>
<p>If Im just running out of memory to hold anymore players shouldn’t I get that error that returns “[KERNEL] Machine Too Slow!” on the old servers.</p>
</blockquote>
</aside>
<p>Yes, if you’re running out of memory you should receive that error.</p>
<p>So you have two option, add System.err.println(“Error!”); or you can add a catch exception where you think this error could be occuring.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-06T19:03:26Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:01:42Z' class='post-time'>
              August 1, 2016, 11:01am
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The only thing I’m getting at the moment after adding the printStackTrace() is</p>
<pre><code class="lang-auto">java.lang.NullPointerException
at com.rs2.net.ConnectionListener.destroySocket(ConnectionListener.java:187)
at com.rs2.model.player.Client.destruct(Client.java:91)
at com.rs2.world.PlayerManager.removePlayer(PlayerManager.java:476)
at com.rs2.world.PlayerManager.process(PlayerManager.java:225)
at com.rs2.Process.run(Process.java:91)
at java.lang.Thread.run(Unknown Source)</code></pre>
<p>but this is only when I log one account in, not two, so possibly irrelevant to the topic. When one player disconnects and the other connects (forcefully), no messages yet appear that I have added.</p>
<p>So still browsing…</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Scape-JAVA.html'><span itemprop='name'>Scape-JAVA</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-06T23:51:53Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:02:02Z' class='post-time'>
              August 1, 2016, 11:02am
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Mendorphins, post:13, topic:389458”]The only thing I’m getting at the moment after adding the printStackTrace() is</p>
<pre><code class="lang-auto">java.lang.NullPointerException
at com.rs2.net.ConnectionListener.destroySocket(ConnectionListener.java:187)
at com.rs2.model.player.Client.destruct(Client.java:91)
at com.rs2.world.PlayerManager.removePlayer(PlayerManager.java:476)
at com.rs2.world.PlayerManager.process(PlayerManager.java:225)
at com.rs2.Process.run(Process.java:91)
at java.lang.Thread.run(Unknown Source)</code></pre>
<p>but this is only when I log one account in, not two, so possibly irrelevant to the topic. When one player disconnects and the other connects (forcefully), no messages yet appear that I have added.</p>
<p>So still browsing…[/quote]<br>
It very well could be you’re trying to throw null as if it we’re a throwable value.</p>
<p>Edit: It could be from various things.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-12T16:38:26Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:09:08Z' class='post-time'>
              August 1, 2016, 11:09am
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have exhausted all my knowledge into this so now just bumping in hope anyone has some vauge idea of what it could be.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Bill1.html'><span itemprop='name'>Bill1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-12T19:36:49Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:09:17Z' class='post-time'>
              August 1, 2016, 11:09am
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>No idea if this is it, but a suggestion.</p>
<pre><code class="lang-auto">                synchronized (HostList.class) {
                        if (!HostList.has(address, Constants.MAX_CONNECTIONS_PER_IP)) {
                                Misc.print_debug("Accepted connection from " + address + ".");
                                Login ioc = PlayerManager.getSingleton().newPlayerClient(
                                                sc.socket(), address);
                                if (ioc == null) {
                                        destroySocket(sc, address, false);
                                } else {
                                        HostList.add(address);
                                        ioClientMap.put(sc, ioc);
                                        revIoClientMap.put(ioc, sc);
                                        sc.socket().setTcpNoDelay(true);
                                        sc.configureBlocking(false);
                                        sc.register(selector, SelectionKey.OP_READ);
                                }[/code]


[CODE]                                Login ioc = PlayerManager.getSingleton().newPlayerClient(
                                                sc.socket(), address);[/CODE]

Idk, but mabe if when a new player connects, it sends[code]ioc[/code] to null kicking out the other player.

Try this

[code]        public void destroySocket(SocketChannel sc, String connectedFrom,
                        boolean removeFromHostList) throws IOException, Exception {
                if (removeFromHostList) {
                        synchronized (HostList.class) {
                                HostList.remove(connectedFrom);
                        }
                }
                sc.close();
                Misc.print_debug("Closed connection from " + connectedFrom + ".");
        }</code></pre>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Mendorphins.html'><span itemprop='name'>Mendorphins</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-12T20:03:12Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:09:18Z' class='post-time'>
              August 1, 2016, 11:09am
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You know what, that’s the exact same line of code I kept looking at but I didn’t really know what to do with it. Does ioc stand for input output connection? Logical thinking there… I’ll have a look mate, thanks for suggesting.</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Bill1.html'><span itemprop='name'>Bill1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-04-12T20:30:29Z'>
            <time itemprop='dateModified' datetime='2016-08-01T11:09:20Z' class='post-time'>
              August 1, 2016, 11:09am
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="17" data-topic="389458">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/mendorphins/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Mendorphins:</div>
<blockquote>
<p>You know what, that’s the exact same line of code I kept looking at but I didn’t really know what to do with it. Does ioc stand for input output connection? Logical thinking there… I’ll have a look mate, thanks for suggesting.</p>
</blockquote>
</aside>
<p>Try my version of destruct and if that doesn’t work, just fill the whole server with System.out.println(“Number *”)</p>
<p>And then you’ll get a good idea</p>
<p>No problem <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> Thanks for stretching my brain a bit <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>Bill</p>
      </div>

      <meta itemprop='headline' content='Multiplayer Issues'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/multiplayer-issues/389458 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 04:26:16 GMT -->
</html>
