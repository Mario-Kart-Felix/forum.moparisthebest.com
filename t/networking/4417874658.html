<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/networking/441787?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 08:57:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Networking - Runescape - moparisthebest.com</title>
    <meta name="description" content="Hello, I would like to get a brief explanation on how the networking in an RSPS works. I would like to have the following questions answered, 

 
What parts of Java do I need to learn to complete this task?
What is requi&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="4417874658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Networking&#39;" href="441787.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/networking/441787?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/networking/441787?page=2" />
<meta property="og:title" content="Networking" />
<meta name="twitter:title" content="Networking" />
<meta property="og:description" content="grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it." />
<meta name="twitter:description" content="grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it." />
<meta property="article:published_time" content="2012-05-10T19:26:47+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="441787.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="441787.html">Networking</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T19:26:47Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:32Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="18" data-topic="441787">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/imsuperman05/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> imsuperman05:</div>
<blockquote>
<p>but with standard/blocking IO, how would you read the incoming packets?</p>
</blockquote>
</aside>
<p>grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it.</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_s11.html'><span itemprop='name'>_s11</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T20:38:22Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:41Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Davidi2, post:20, topic:441787”]if it’s based on needs, certainly there must be rules that should dictate which one you use based on your needs?</p>
<p>it’s like saying you need food, but there are no rules as to what constitutes edible food vs non-edible food because some people eat paper or whatever…</p>
<p>point being, what would you constitute as criteria to base your decision on, for each type?[/quote]of course there are ‘rules’, patterns require certain criteria to be met before they should be applied ie. the factory pattern should be used to encapsulate object creation complexities/eyesores. these predicates for application can be wildly varied though, since concurrency+networking can be defined in many different yet powerful ways and it can be a very personal thing so laying concrete rules here will probably reflect far too much on my own opinions and preferences. i personally always opt for the natural, expressive and scalable options, which is why i like the idea of actors for an rs emulator because the game world is expressed so well with the paradigm and they have the added bonus of good libraries and languages built upon top. meanwhile, i would probably be less keen on using actors for something like a RESTful data-retrieval API because it’s such a simple request-response concept that i would personally probably opt for a reactor, purely because there’s nothing more to maintain other than waiting for a read event (which will be a request), parsing the request and reacting with data retrieved from a database. there’s no shared state in this sort of thing anyway, so any advantage that actors provide in avoiding state sharing is voided through the lack of need.</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T20:44:48Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:42Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“t4, post:21, topic:441787”][quote author=imsuperman05 link=topic=544470.msg3991641#msg3991641 date=1336672663]<br>
but with standard/blocking IO, how would you read the incoming packets?<br>
[/quote]<br>
grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it.[/quote]</p>
<p>Or since the maximum amount of bytes coming from a 317 client will never exceed 5k bytes, buffer it all and then handle it appropriately in accordance with the protocols the server supports .You can’t expect the packet structure in different protocols to be compliant with one another.</p>
<pre><code class="lang-auto">
    /**
     * The size of the input buffer for all clients.
     */
    public static final int INPUTBUFFER_SIZE = 5000;

    /**
     * The clients input byte buffer.
     */
    byte[] inputbuffer;

    /**
     * The write offset in the input byte buffer.
     */
    int inputWriteOffset;

    /**
     * The read offset in the input byte buffer.
     */
    int inputReadOffset;</code></pre>
<p>…</p>
<pre><code class="lang-auto">int available = client.inputstream.available();
int availInput = client.inputReadOffset &gt; client.inputWriteOffset ?
                      client.inputReadOffset - client.inputWriteOffset :
                     (Client.INPUTBUFFER_SIZE - client.inputWriteOffset) + client.inputReadOffset;
if(available &gt; availInput)
  throw new IOException("Expected inputbuffer overflow");
client.inputstream.read(buffer, 0, available);
if(available + client.inputWriteOffset &gt; Client.INPUTBUFFER_SIZE) {                              
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
  System.arraycopy(buffer, Client.INPUTBUFFER_SIZE - client.inputWriteOffset, client.inputbuffer, 0, available - Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
} else {
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, available);
}
client.inputWriteOffset = (client.inputWriteOffset + available) % Client.INPUTBUFFER_SIZE;</code></pre>
<p><span class="mention">@s1gma</span></p>
<p>After talking to Ed, I came to the conclusion if I was to ever use the actor model in a project then I would try and use it sparingly. You could expect if you rewrite pieces of the state machine with the linear based actor processing then you would see major performance boosts.</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="3" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_s11.html'><span itemprop='name'>_s11</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T22:05:02Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:45Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sinisoul, post:23, topic:441787”][quote author=t4 link=topic=544470.msg3991696#msg3991696 date=1336678007]</p>
<aside class="quote">
<blockquote>
<p>but with standard/blocking IO, how would you read the incoming packets?</p>
</blockquote>
</aside>
<p>grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it.<br>
[/quote]</p>
<p>Or since the maximum amount of bytes coming from a 317 client will never exceed 5k bytes, buffer it all and then handle it appropriately in accordance with the protocols the server supports .You can’t expect the packet structure in different protocols to be compliant with one another.</p>
<pre><code class="lang-auto">
    /**
     * The size of the input buffer for all clients.
     */
    public static final int INPUTBUFFER_SIZE = 5000;

    /**
     * The clients input byte buffer.
     */
    byte[] inputbuffer;

    /**
     * The write offset in the input byte buffer.
     */
    int inputWriteOffset;

    /**
     * The read offset in the input byte buffer.
     */
    int inputReadOffset;</code></pre>
<p>…</p>
<pre><code class="lang-auto">int available = client.inputstream.available();
int availInput = client.inputReadOffset &gt; client.inputWriteOffset ?
                      client.inputReadOffset - client.inputWriteOffset :
                     (Client.INPUTBUFFER_SIZE - client.inputWriteOffset) + client.inputReadOffset;
if(available &gt; availInput)
  throw new IOException("Expected inputbuffer overflow");
client.inputstream.read(buffer, 0, available);
if(available + client.inputWriteOffset &gt; Client.INPUTBUFFER_SIZE) {                              
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
  System.arraycopy(buffer, Client.INPUTBUFFER_SIZE - client.inputWriteOffset, client.inputbuffer, 0, available - Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
} else {
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, available);
}
client.inputWriteOffset = (client.inputWriteOffset + available) % Client.INPUTBUFFER_SIZE;</code></pre>
<p><span class="mention">@s1gma</span></p>
<p>After talking to Ed, I came to the conclusion if I was to ever use the actor model in a project then I would try and use it sparingly. You could expect if you rewrite pieces of the state machine with the linear based actor processing then you would see major performance boosts.[/quote]wtf when would state transformations ever cause performance bottlenecks, there’d be a tiny improvement with linear processing due to the instantaneous nature of continuing upon read whereas the reactor will have to cycle but that is such a negligible thing to benchmark that you’d be retarded to even care (note: if Selector is implemented well with NT’s IOCP or the epoll API with Linux you really won’t see a difference although i’m unsure what it does).</p>
<p>also i think you don’t understand the first single thing about actors if you intend to use them ‘sparingly’ considering they’re effectively an extension to the object-oriented way where objects are thrown into their own process and communicate through asynchronous message passing (message passing is how OOP should be done btw look at Smalltalk), you should go by the rule of thumb that objects are to be replaced for the most part in your server with actors (the point of actors is to encapsulate state fully so shared state is something to avoid). akka exposes a software-transactional memory API in case you need to mutate shared state since atomic state mutations are much nicer behaviour for actors to work with than lock-based concurrency control.</p>
<p>ps i have a funny feeling you rly don’t know wtf you’re on about, if so stfu</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T22:37:54Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:48Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“sinisoul, post:23, topic:441787”][quote author=t4 link=topic=544470.msg3991696#msg3991696 date=1336678007]</p>
<aside class="quote">
<blockquote>
<p>but with standard/blocking IO, how would you read the incoming packets?</p>
</blockquote>
</aside>
<p>grab the incoming stream and place read packets into an array. that’s the way to do it and that’s how winterlove does it.<br>
[/quote]</p>
<p>Or since the maximum amount of bytes coming from a 317 client will never exceed 5k bytes, buffer it all and then handle it appropriately in accordance with the protocols the server supports .You can’t expect the packet structure in different protocols to be compliant with one another.</p>
<pre><code class="lang-auto">
    /**
     * The size of the input buffer for all clients.
     */
    public static final int INPUTBUFFER_SIZE = 5000;

    /**
     * The clients input byte buffer.
     */
    byte[] inputbuffer;

    /**
     * The write offset in the input byte buffer.
     */
    int inputWriteOffset;

    /**
     * The read offset in the input byte buffer.
     */
    int inputReadOffset;</code></pre>
<p>…</p>
<pre><code class="lang-auto">int available = client.inputstream.available();
int availInput = client.inputReadOffset &gt; client.inputWriteOffset ?
                      client.inputReadOffset - client.inputWriteOffset :
                     (Client.INPUTBUFFER_SIZE - client.inputWriteOffset) + client.inputReadOffset;
if(available &gt; availInput)
  throw new IOException("Expected inputbuffer overflow");
client.inputstream.read(buffer, 0, available);
if(available + client.inputWriteOffset &gt; Client.INPUTBUFFER_SIZE) {                              
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
  System.arraycopy(buffer, Client.INPUTBUFFER_SIZE - client.inputWriteOffset, client.inputbuffer, 0, available - Client.INPUTBUFFER_SIZE - client.inputWriteOffset);
} else {
  System.arraycopy(buffer, 0, client.inputbuffer, client.inputWriteOffset, available);
}
client.inputWriteOffset = (client.inputWriteOffset + available) % Client.INPUTBUFFER_SIZE;</code></pre>
<p><span class="mention">@s1gma</span></p>
<p>After talking to Ed, I came to the conclusion if I was to ever use the actor model in a project then I would try and use it sparingly. You could expect if you rewrite pieces of the state machine with the linear based actor processing then you would see major performance boosts.[/quote]<br>
wtf do you think grabbing the data stream and putting it in an array DOES?</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imsuperman05.html'><span itemprop='name'>imsuperman05</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T22:42:07Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:48Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>But I meant reading the data sent from the client on the server…</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T22:54:45Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:48Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="26" data-topic="441787">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/imsuperman05/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> imsuperman05:</div>
<blockquote>
<p>But I meant reading the data sent from the client on the server…</p>
</blockquote>
</aside>
<p><a href="http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()</a><br>
???</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imsuperman05.html'><span itemprop='name'>imsuperman05</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T23:03:54Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:49Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“t4, post:27, topic:441787”][quote author=imsuperman05 link=topic=544470.msg3991826#msg3991826 date=1336689727]<br>
But I meant reading the data sent from the client on the server…<br>
[/quote]<br>
<a href="http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()</a><br>
???[/quote]<br>
Yeah, I use that as part of my buffer, but how would I read any packets that are coming?  I already tried read() in the world tick, but it just gives other data…</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/T41.html'><span itemprop='name'>T41</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-10T23:26:36Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:37:50Z' class='post-time'>
              August 3, 2016,  2:37am
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“imsuperman05, post:28, topic:441787”][quote author=t4 link=topic=544470.msg3991833#msg3991833 date=1336690485]</p>
<aside class="quote">
<blockquote>
<p>But I meant reading the data sent from the client on the server…</p>
</blockquote>
</aside>
<p><a href="http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#getInputStream()</a><br>
???<br>
[/quote]<br>
Yeah, I use that as part of my buffer, but how would I read any packets that are coming?  I already tried read() in the world tick, but it just gives other data…[/quote]<br>
the data in the buffer will contain opcode followed by data corresponding the the opcode… (or data in certain transactions like login)</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/slavemaster.html'><span itemprop='name'>slavemaster</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-12T22:08:15Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:39:40Z' class='post-time'>
              August 3, 2016,  2:39am
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote quote-modified" data-post="16" data-topic="441787">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>There’s nothing wrong with using IO properly. Both have obvious trade offs. It’s not very efficient to use NIO unless you’re expecting a large amount of connections in a short period of time because of the overhead from the reactor pattern.</p>
</blockquote>
</aside>
<p>There are absolutely no advantages to using <a href="http://java.io/" rel="nofollow noopener">java.io</a> over java.nio, blocking or non-blocking. It possesses the ability do both much better than the pre-1.4 solutions can.<br>
Presuming you’re arguing between blocking and non-blocking I/O, take a look at the <a href="http://www.kegel.com/c10k.html" data-bbcode="true" rel="nofollow noopener">C10k problem</a>.<br>
The trade-off you’re arguing about is almost entirely between 1:1 and N:1 client-thread mapping.</p>
<p>Using a 1:1 mapping (known traditionally as a <span class="bbcode-i">threaded</span> approach), you have simple &amp; linear code flow with blocking I/O and take advantage of the vast benefits that multicore and multiprocessors provide in terms of parallel processing. Unfortunately, you lack scalability – once you hit a peak number of threads, performance rapidly degrades because you’ve already hit CPU saturation and concurrency. Expensive preemptive context switches between heavyweight client threads (as well as other threads OS-wide) end up dominating CPU time. The large sizes of thread stack sizes ends up swallowing more and more memory until you incur harsh penalties of virtual memory swapping.</p>
<p>On the flip-side, a N:1 (i.e. <span class="bbcode-i">evented</span> approach) scales very well and takes on an increasing load via non-blocking I/O without such a rapid degradation of performance. Using only one thread, it will never grow to dominate CPU time by expensive context switches in the way thread-per-client servers do, and thus they don’t consume memory via sheer number of thread stacks either. The N:1 approach falls short however in terms of taking advantage of parallelism – due to their single-threaded nature, they underutilize the processing power virtually universal in modern servers and thus never reach CPU saturation. In addition, non-blocking and asynchronous I/O call for a departure from simple linear code flow; instead, complicated solutions of state machine loops and tangled callbacks become the norm.</p>
<p>Of these two, the N:1 single-thread event-driven approach is much better. Non-blocking scalability becomes a major factor with likely far fewer clients than you let on, so I don’t understand the perpetuation of this myth that 1:1 works for most approaches until a “large” number of clients. Don’t believe me? To quote blakeman8192…</p>
<blockquote>It is widely known and accepted that as soon as your software uses more threads than CPU cores available, you will see degradation.
<p>I own a licensed software company and am doing very well because of it. Don’t tell me what the “real world” is, because I work in it buddy. Updating the positions and activities 2,000 players for 2,000 players twice a second is quite a large task in the first place, and when your CPU is busy juggling the context switches of 2,000 simply for I/O threads it’s not going to get much done very fast. The goal of networking is to do as little work as possible - to be as lightweight as possible, not to be as fast as possible. You want to dedicate all CPU power and memory to the application logic instead of just networking.</p>
<p>You probably don’t know this because you haven’t been here for very long, but Graham took the original winterlove server (which operates on thread-per-client) and made it use MINA. To give you some context, the vanilla winterlove server cannot handle more than a couple hundred players before reaching maximum load on the average machine today. I benchmarked the server after Graham’s change, and it handled 2,000 players just fine without being at maximum load. Now you’re telling me that threads don’t have much overhead, and 10,000 threads is reasonable?</p>
<p>Yes, the original Java I/O has better slightly better bandwidth throughput than NIO. Throughput, however, does not matter in the slightest. Scalability is key, and I/O scales much, much worse than NIO. Traditional I/O with thread-per-client design is not by any means a practical solution to efficient MMO servers.</p>
<p>Why don’t you research the C10K problem, and how it was solved:<br>
C10k problem - Wikipedia, the free encyclopedia</p>
<p>Don’t you see the trend that literally all of the solutions to this problem make use of asynchronous I/O?</p>
<p>Go do some research, and testing for yourself. Learn something instead of reading articles that idiots have written. Come back when you’re done and make constructive contributions instead of challenging time-tested and well-known software solutions.</p>
</blockquote>
<p>A superior tripartist solution I explored is an N:M hybrid between the above two, which remains event-driven but also utilizes a thread-pool with a level of parallelism equal to the available logical processors ± 1. This reaches full CPU utilization without performance degradation and retains high scalability. To remedy the issue of complex event-driven code, a solution via continuable fibers brings the simplicity of blocking code while still ultimately event-driven. Lightweight context switches become cheap as preemption is abandoned in favor of cooperative multitasking. I’ve posted about it here and on rune-server quite a bit, so look for my threads. This is better than the evented solution and consequentially <span class="bbcode-i">much</span> better than the threaded one.</p>
<blockquote>Stop helping the rising fad that if you add netty to a server you gain 1600 players because your networking is so 1337. Its complete bullshit.</blockquote>
<p>While it’s not merely that simple, plugging in a scalable non-blocking I/O solution can easily allow your server to be capable of servicing many times more clients as blakeman8192 demonstrated. True, it’s not the only key to the puzzle as the rest of your server must be made scalable as well; it must be acknowledged, though, that poor networking design is the first and foremost limiting barrier to being able to reach that many players in the first place. :rolleyes:</p>
<p>[quote=“sinisoul, post:23, topic:441787”]<span class="mention">@s1gma</span></p>
<p>After talking to Ed, I came to the conclusion if I was to ever use the actor model in a project then I would try and use it sparingly. You could expect if you rewrite pieces of the state machine with the linear based actor processing then you would see major performance boosts.[/quote]</p>
<p>I’m afraid you might not understand how actors work… they’re much more like event-driven state machines than they are linear simple code, seeing as they operate on message-passing between discrete individual actors in order to protect state. Like _s mentioned, actors are generally a natural outgrowth of objects in an OO-oriented setting, if you consider method calls as message passing as it is in namely Smalltalk and Objective-C. The actor model isn’t what you think it is and cannot be easily meshed with event-driven state machines.</p>
<aside class="quote" data-post="24" data-topic="441787">
<div class="title">
<div class="quote-controls"></div>
 _s:</div>
<blockquote>
<p>akka exposes a software-transactional memory API in case you need to mutate shared state since atomic state mutations are much nicer behaviour for actors to work with than lock-based concurrency control.</p>
</blockquote>
</aside>
<p>Perhaps I misunderstood, but STM and atomic state mutation is not compatible with the actor model as one espouses safe concurrent access to shared, global state without traditional pessimistic variable-grained locking, whereas the other is based around a system being composed of individual entities only communicating via limited message passing and maintaining private protected state. These two approaches are diametric in their stance on state.</p>
<p>While not purely either approach, I think what you’re discussing is the transactor model (<a href="http://www.cs.rpi.edu/research/pdf/04-15.pdf" rel="nofollow noopener">http://www.cs.rpi.edu/research/pdf/04-15.pdf</a>), which attempts to merge the two into a coherent blend. AFAIK, Akka enables one to take this route, though it is distinguished from plain actor and STM approaches.</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_s11.html'><span itemprop='name'>_s11</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-12T23:31:44Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:39:43Z' class='post-time'>
              August 3, 2016,  2:39am
            </time>
        <span itemprop='position'>#31</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“veer, post:30, topic:441787”][quote author=_s link=topic=544470.msg3991800#msg3991800 date=1336687502]akka exposes a software-transactional memory API in case you need to mutate shared state since atomic state mutations are much nicer behaviour for actors to work with than lock-based concurrency control.<br>
[/quote]</p>
<p>Perhaps I misunderstood, but STM and atomic state mutation is not compatible with the actor model as one espouses safe concurrent access to shared, global state without traditional pessimistic variable-grained locking, whereas the other is based around a system being composed of individual entities only communicating via limited message passing and maintaining private protected state. These two approaches are diametric in their stance on state.</p>
<p>While not purely either approach, I think what you’re discussing is the transactor model (<a href="http://www.cs.rpi.edu/research/pdf/04-15.pdf" rel="nofollow noopener">http://www.cs.rpi.edu/research/pdf/04-15.pdf</a>), which attempts to merge the two into a coherent blend. AFAIK, Akka enables one to take this route, though it is distinguished from plain actor and STM approaches.[/quote]i’m going off Akka says at the moment, and it does describe a usage of STM as “When you want to share a datastructure across actors.” (<a href="http://doc.akka.io/docs/akka/2.0.1/java/stm.html" rel="nofollow noopener">http://doc.akka.io/docs/akka/2.0.1/java/stm.html</a>) which is mixing up the two approaches, i haven’t looked into much more than the documentation though so i won’t say any more.</p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/slavemaster.html'><span itemprop='name'>slavemaster</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-05-13T21:00:22Z'>
            <time itemprop='dateModified' datetime='2016-08-03T02:40:22Z' class='post-time'>
              August 3, 2016,  2:40am
            </time>
        <span itemprop='position'>#32</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="_s, post:31, topic:441787"][quote author=veer link=topic=544470.msg3993040#msg3993040 date=1336860495]</p>
<p>[quote author=_s link=topic=544470.msg3991800#msg3991800 date=1336687502]akka exposes a software-transactional memory API in case you need to mutate shared state since atomic state mutations are much nicer behaviour for actors to work with than lock-based concurrency control.<br>
[/quote]</p>
<p>Perhaps I misunderstood, but STM and atomic state mutation is not compatible with the actor model as one espouses safe concurrent access to shared, global state without traditional pessimistic variable-grained locking, whereas the other is based around a system being composed of individual entities only communicating via limited message passing and maintaining private protected state. These two approaches are diametric in their stance on state.</p>
<p>While not purely either approach, I think what you’re discussing is the transactor model (<a href="http://www.cs.rpi.edu/research/pdf/04-15.pdf" rel="nofollow noopener">http://www.cs.rpi.edu/research/pdf/04-15.pdf</a>), which attempts to merge the two into a coherent blend. AFAIK, Akka enables one to take this route, though it is distinguished from plain actor and STM approaches.<br>
[/quote]i’m going off Akka says at the moment, and it does describe a usage of STM as “When you want to share a datastructure across actors.” (<a href="http://doc.akka.io/docs/akka/2.0.1/java/stm.html" rel="nofollow noopener">http://doc.akka.io/docs/akka/2.0.1/java/stm.html</a>) which is mixing up the two approaches, i haven’t looked into much more than the documentation though so i won’t say any more.[/quote]</p>
<p>Shared global state is at odds with a pure actor model, hence at the bottom you see a link to work on those transactors I mentioned earlier (along with an implementation of agents):<br>
<a href="http://doc.akka.io/docs/akka/2.0.1/java/transactors.html#transactors-java" class="onebox" target="_blank" rel="nofollow noopener">http://doc.akka.io/docs/akka/2.0.1/java/transactors.html#transactors-java</a></p>
      </div>

      <meta itemprop='headline' content='Networking'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="441787.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/networking/441787?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 08:57:39 GMT -->
</html>
