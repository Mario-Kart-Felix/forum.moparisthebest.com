<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>IP Routing?</title>
    <link>https://forum.moparisthebest.com/t/ip-routing/344396</link>
    <description>Hey I have somewhat of a problem i&#39;ve created a stupid loopback which i have no way of getting out without 2 computers.

I&#39;m trying to route traffic from one game to my program which will eventually send it back where it has to go to begin with.

I tried adding it to routing tables with
route add gameIP InterfaceIP.

It does work but what happens is when traffic is shot to localhost my program tries to connect to official game server IP which is the same IP so it also gets shot to localhost making a stupid loop i cannot get out off.

Is there anything I can do? I know you might say why not just memory edit the IP of the game to localhost, say I can&#39;t really do that what other options do I have? instead of using 2 computers to act as a relay.

what I&#39;m looking for is a program my little theory should work, API capturing tool, that captures both connect&#39;s (winsock 1.1/2.0) then modifies their fields (IP/Port? fields in the structure of sockaddr). Anything like that exists? and if it does can you link me.

Or any other options I got?</description>
    
    <lastBuildDate>Tue, 13 Jul 2010 00:59:34 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/ip-routing/344396.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@abraham2119 abraham2119]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/abraham2119">@abraham2119</a> wrote:</p>
          <blockquote>
              <p>linux is awesome, check out cherokee etc etc</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/14</link>
        <pubDate>Tue, 13 Jul 2010 00:59:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-14</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Cheese_Police c|p]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/cheese_police">@Cheese_Police</a> wrote:</p>
          <blockquote>
              <p>[quote=“pure2ownage, post:11, topic:344396”][quote author=c|p link=topic=440778.msg3239107#msg3239107 date=1276741406]<br>
thank you for <span class="bbcode-b">polluting</span> a topic with your <span class="bbcode-b">dreamy pro</span>-linux solutions when the <span class="bbcode-b">environment</span> and end product is entirely <span class="bbcode-b">windows</span> specific.[/quote]Linux is shit; we do not care.[/quote]</p>
<p>please go back to moparscape</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/13</link>
        <pubDate>Mon, 12 Jul 2010 22:01:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-13</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Ollie Ollie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ollie">@Ollie</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="11" data-topic="344396">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/pure2ownage/40/5_513041d5f7104045db30895d3b90af16.png" class="avatar"> pure2ownage:</div>
<blockquote>
<p>Linux is shit; we do not care.</p>
</blockquote>
</aside>
<p>wat?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/12</link>
        <pubDate>Mon, 12 Jul 2010 21:59:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-12</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@pure2ownage Pure_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pure2ownage">@pure2ownage</a> wrote:</p>
          <blockquote>
              <p>[quote=“c|p, post:10, topic:344396”]thank you for <span class="bbcode-b">polluting</span> a topic with your <span class="bbcode-b">dreamy pro</span>-linux solutions when the <span class="bbcode-b">environment</span> and end product is entirely <span class="bbcode-b">windows</span> specific.[/quote]Linux is shit; we do not care.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/11</link>
        <pubDate>Mon, 12 Jul 2010 18:52:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-11</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Cheese_Police c|p]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/cheese_police">@Cheese_Police</a> wrote:</p>
          <blockquote>
              <p>thank you for polluting a topic with your dreamy pro-linux solutions when the environment and end product is entirely windows specific.</p>
<p>maybe i’m just weird or something, but having to install dd-wrt on a router and setting up some iptables rules to run a hack for a game seems like a huge waste of time and a load of frustration for an end user.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/10</link>
        <pubDate>Thu, 17 Jun 2010 02:23:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-10</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@moparisthebest Moparisthebest]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moparisthebest">@moparisthebest</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="6" data-topic="344396">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/mopman/40/33_1.png" class="avatar"> Mopman:</div>
<blockquote>
<p>cuz iptables doesnt run very well on windows</p>
</blockquote>
</aside>
<p>Nothing runs very well on windows does it? <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>Anyway, many routers run linux, you can get a cheap one and put dd-wrt on it and do the same thing, route traffic back through a proxy on your windows computer if you want.  Uck.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/9</link>
        <pubDate>Thu, 17 Jun 2010 02:01:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-9</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Cheese_Police c|p]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/cheese_police">@Cheese_Police</a> wrote:</p>
          <blockquote>
              <p><a href="http://forum.gamedeception.net/" data-bbcode="true" rel="nofollow noopener">GameDeception</a> has a <span class="bbcode-b">lot</span> of good information about this kind of thing, <a href="http://forum.gamedeception.net/forums/183-Highly-Advanced" data-bbcode="true" rel="nofollow noopener">this</a> category specifically if you’re interested in the more nitty-gritty areas.<br>
<a href="http://www.drdobbs.com/windows/" data-bbcode="true" rel="nofollow noopener">Dr Dobbs</a> is a good place to read too.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/8</link>
        <pubDate>Wed, 16 Jun 2010 22:59:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-8</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@repacsenur repacsenur]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/repacsenur">@repacsenur</a> wrote:</p>
          <blockquote>
              <p>Either way that dll injection is excellent works no problem.</p>
<p>Great for script kiddies like myself  ;D</p>
<p>After you use KeInsertQueueApc function to inject it into ring0 seems to throw off any detection it’s not even driver learn something new everday</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/7</link>
        <pubDate>Wed, 16 Jun 2010 22:22:54 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-7</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <p>cuz iptables doesnt run very well on windows</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/6</link>
        <pubDate>Wed, 16 Jun 2010 20:30:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-6</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@moparisthebest Moparisthebest]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moparisthebest">@moparisthebest</a> wrote:</p>
          <blockquote>
              <p>Why not use something like iptables to do this for you?  For example I do the same thing on my network, I have all traffic destined for port 80 (HTTP) transparently redirected to a Squid caching proxy server, which another iptables rule allows to directly access the internet.  That way no setup at all is needed for any device on the network, it all “just works”.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/5</link>
        <pubDate>Wed, 16 Jun 2010 20:19:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-5</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@repacsenur repacsenur]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/repacsenur">@repacsenur</a> wrote:</p>
          <blockquote>
              <p>2moons</p>
<p>Yup your way worked but I couldn’t use detours because it does use a game guard</p>
<p>instead I used</p>
<pre><code class="lang-auto">void *DetourFunc(BYTE *src, const BYTE *dst, const int len)
{
	BYTE *jmp = (BYTE*)malloc(len+5);
	DWORD dwback;
	
	VirtualProtect(src, len, PAGE_READWRITE, &amp;dwback);
	memcpy(jmp, src, len); jmp += len;
	
	jmp[0] = 0xE9;
	*(DWORD*)(jmp+1) = (DWORD)(src+len - jmp) - 5;
	
	src[0] = 0xE9;
	*(DWORD*)(src+1) = (DWORD)(dst - src) - 5;
	
	VirtualProtect(src, len, dwback, &amp;dwback);
	
	return (jmp-len);
}</code></pre>
<pre><code class="lang-auto">int WINAPI __stdcall MyConnect(int socket, const struct sockaddr *address, int address_len) 
{ 
   struct sockaddr_in * to; 
   to = (struct sockaddr_in*)address; 
   if( htons(to-&gt;sin_port) == 12345 ) { 
      struct sockaddr_in sa; 
      sa.sin_family = AF_INET; 
      sa.sin_addr.s_addr = inet_addr( "127.0.0.1" ); 
      sa.sin_port = htons( 12345 ); 
      return ConnectOrig( socket, (struct sockaddr*)&amp;sa, sizeof(struct sockaddr) ); 
   } 
   return ConnectOrig( socket, address, address_len ); 
} </code></pre>
<p>As for injector I’ve used public ones all of course detected but doesn’t matter I have to inject it before game guard fully loads up and it works like a charm  <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>thanks alot bro</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/4</link>
        <pubDate>Wed, 16 Jun 2010 18:34:53 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-4</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Cheese_Police c|p]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/cheese_police">@Cheese_Police</a> wrote:</p>
          <blockquote>
              <p>The easiest way to do this (imo) with the information you’ve given and not having any assumptions about any sort of anti-cheat the game employs (like Mopman said), is to detour network API functions (like you touched on).</p>
<p>I’ve attached a copy of Microsoft’s detour library (version 1.5, there is a newer release but it is pointless to use that one) that you can do this quite easily with.</p>
<p>The idea here is to create a DLL that, when loaded, will find and detour whatever API functions you need to accomplish your goal, eg:</p>
<pre><code class="lang-auto">/* pointer to our detour's trampoline and the connect function */
PBYTE connect_trampoline, connect_fn; 
/* the function we detoured connect() with */
int d_connect(SOCKET, struct sockaddr*, int);/

BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
  if (fdwReason == DLL_PROCESS_ATTACH)
  {
    /* get the address of ws2_32!connect */
    connect_fn = (PBYTE) GetProcAddress(GetModuleHandle("ws2_32.dll"), "connect");
    /* detour ws2_32!connect to d_connect, hold on to the trampoline address */
    connect_trampoline = DetourFunction(connect_fn, (PBYTE) d_connect);

    return TRUE;
  } else if (fdwReason == DLL_PROCESS_DETACH)
  {
    /* not entirely necessary, but good practice.  remove our detour */
    RemoveDetour(connect_trampoline, connect_fn);

    return TRUE;
  }

  return FALSE;
}

/* technically the name parameter is const, but obviously we don't have to worry about that
    since the goal here is to change it anyway. could potentially cause a problem with some
    programs but i really don't see that happening at all unless the program is _trying_ to
    have a problem... */
int d_connect(SOCKET sock, struct sockaddr* name, socklen_t namelen)
{
  struct sockaddr_in* addr;
  addr = (struct sockaddr_in*) name;

  /* is this connection of any interest?
     obviously 123.123.123.123 should be address the game connects to,
     and ideally the call to inet_addr() shouldn't be called on every connect */
  if (addr-&gt;sin_addr.s_addr == inet_addr("123.123.123.123"))
  {
    /* make it connect to localhost, or wherever */
    addr-&gt;sin_addr.s_addr = inet_addr("127.0.0.1");
    /* can change the port, or anything else if you want */
    addr-&gt;sin_port = htons(12345);
  }

  /* the trampoline will jump back into the original function, past our detour so it doesn't just keep invoking itself */
  return ((int (*)(SOCKET, struct sockaddr*, int)) connect_trampoline)(sock, name, namelen);
}</code></pre>
<p>I did not test this code, so be weary, but it should be mostly correct.</p>
<p>Read up about DLL injection, in this case you should go for the simple CreateRemoteThread approach:</p>
<p>[code=c]HANDLE proc_handle;<br>
LPVOID arg_alloc, loadlib_addr;</p>
<p>/* get a handle to the process with the ability to use CreateRemoteThread, get the pid however you need to <em>/<br>
proc_handle = OpenProcess(CREATE_THREAD_ACCESS, FALSE, pid);<br>
/</em> find the address of LoadLibraryA (LoadLibraryW is for multibyte/unicode strings) */<br>
loadlib_addr = GetProcAddress(GetModuleHandle(“kernel32.dll”), “LoadLibraryA”);</p>
<p>/* allocate some memory in the process for the path of our dll… <em>/<br>
arg_alloc = VirtualAllocEx(proc_handle, NULL, strlen(dll_name), MEM_RESERVE | MEM_COMMIT, PAGE_READWRITE);<br>
/</em> … and write the path to that block */<br>
WriteProcessMemory(proc_handle, arg_alloc, dll_name, strlen(dll_name), NULL);</p>
<p>/* invoke LoadLibraryA(dll_name) in a thread in the process */<br>
CreateRemoteThread(proc, NULL, NULL, (LPTHREAD_START_ROUTINE) loadlib_addr, arg_alloc, NULL, NULL);</p>
<p>// free the memory you allocated in the process and cleanup everything else[/code]</p>
<p>Again, not tested (obviously not complete either, you need to do some work), and you will probably need to adjust privilege tokens for your injector process (lookup SeDebugPrivilege).<br>
Basically, you need to allocate enough memory in the process you are injecting into to hold the name (or path) of the DLL you are injecting, then write the name into the memory you allocated.<br>
Using CreateRemoteThread, you start a thread using LoadLibraryA (LoadLibraryW is for multibyte/unicode strings, if you need it) with the thread parameter being the name of your DLL (which you allocated in the process).<br>
From there, LoadLibrary takes care of the rest, and ultimately DllMain in the DLL you injected is invoked (inside of the process you injected into).</p>
<p>The <a href="http://msdn.microsoft.com/en-us/library/aa383749.aspx" data-bbcode="true" rel="nofollow noopener">Windows API Reference (MSDN)</a> is a useful resource, you should look at the README that accompanies the detour library too.</p>
<p>I’m curious, what game are you working with?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/3</link>
        <pubDate>Wed, 16 Jun 2010 16:01:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-3</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <p>you could easily write something like that, there are various ways depending on the game you’re targetting and what antihax methods it employs</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/2</link>
        <pubDate>Wed, 16 Jun 2010 10:06:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-2</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
      <item>
        <title>IP Routing?</title>
        <dc:creator><![CDATA[@repacsenur repacsenur]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/repacsenur">@repacsenur</a> wrote:</p>
          <blockquote>
              <p>Hey I have somewhat of a problem i’ve created a stupid loopback which i have no way of getting out without 2 computers.</p>
<p>I’m trying to route traffic from one game to my program which will eventually send it back where it has to go to begin with.</p>
<p>I tried adding it to routing tables with<br>
route add gameIP InterfaceIP.</p>
<p>It does work but what happens is when traffic is shot to localhost my program tries to connect to official game server IP which is the same IP so it also gets shot to localhost making a stupid loop i cannot get out off.</p>
<p>Is there anything I can do? I know you might say why not just memory edit the IP of the game to localhost, say I can’t really do that what other options do I have? instead of using 2 computers to act as a relay.</p>
<p>what I’m looking for is a program my little theory should work, API capturing tool, that captures both connect’s (winsock 1.1/2.0) then modifies their fields (IP/Port? fields in the structure of sockaddr). Anything like that exists? and if it does can you link me.</p>
<p>Or any other options I got?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/ip-routing/344396/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/ip-routing/344396/1</link>
        <pubDate>Wed, 16 Jun 2010 02:35:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-344396-1</guid>
        <source url="https://forum.moparisthebest.com/t/ip-routing/344396.rss">IP Routing?</source>
      </item>
  </channel>
</rss>
