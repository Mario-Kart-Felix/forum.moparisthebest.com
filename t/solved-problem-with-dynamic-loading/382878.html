<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/solved-problem-with-dynamic-loading/382878 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 20:25:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>[SOLVED] Problem with dynamic loading - General Programming - moparisthebest.com</title>
    <meta name="description" content="EDIT: Problem solved. As I suspected, I wasn&amp;#39;t building the main executable right. Nothing wrong with my code at all. I built the shared object code as position independent, but didn&amp;#39;t build the main executable with the &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="382878.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;[SOLVED] Problem with dynamic loading&#39;" href="382878.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/solved-problem-with-dynamic-loading/382878" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/solved-problem-with-dynamic-loading/382878" />
<meta property="og:title" content="[SOLVED] Problem with dynamic loading" />
<meta name="twitter:title" content="[SOLVED] Problem with dynamic loading" />
<meta property="og:description" content="EDIT: Problem solved.  As I suspected, I wasn’t building the main executable right. Nothing wrong with my code at all.  I built the shared object code as position independent, but didn’t build the main executable with the --export-dynamic flag. Doing so solved the problem.  For anyone else who has the problem, build your main executable with -Wl,–export-dynamic and be sure to build modules as position independent code with -fPIC.  The original question is below.  [hr]  I’ve been working on an ap..." />
<meta name="twitter:description" content="EDIT: Problem solved.  As I suspected, I wasn’t building the main executable right. Nothing wrong with my code at all.  I built the shared object code as position independent, but didn’t build the main executable with the --export-dynamic flag. Doing so solved the problem.  For anyone else who has the problem, build your main executable with -Wl,–export-dynamic and be sure to build modules as position independent code with -fPIC.  The original question is below.  [hr]  I’ve been working on an ap..." />
<meta property="article:published_time" content="2011-02-18T01:13:15+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="382878.html">[SOLVED] Problem with dynamic loading</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-02-18T01:13:15Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:38:30Z' class='post-time'>
              August 1, 2016,  7:38am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>EDIT: Problem solved.<br>
As I suspected, I wasn’t building the main executable right. Nothing wrong with my code at all.<br>
I built the shared object code as position independent, but didn’t build the main executable with the --export-dynamic flag. Doing so solved the problem.</p>
<p>For anyone else who has the problem, build your main executable with -Wl,–export-dynamic and be sure to build modules as position independent code with -fPIC.</p>
<p>The original question is below.</p>
<p>[hr]</p>
<p>I’ve been working on an application in C. It utilises dynamic loading of shared objects as plugins.</p>
<p>Anyway, at runtime it is producing this error:</p>
<blockquote>src/protocols/508.so: undefined symbol: discard_handler</blockquote>
<p>The discard_handler function can be found in the packet_decoder files. Basically I need to know why my dynamically loaded code can’t access functions that are part of the main application at runtime.</p>
<p>Thanks for the help, all of the code is below.</p>
<p>module_loader.h</p>
<pre><code class="lang-auto">#ifndef INCLUDED_MODULE_LOADER_H
#define INCLUDED_MODULE_LOADER_H

#include &lt;dirent.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int load_modules(char *module_dir);
int unload_modules();
int load_module(char *module_dir, char *module_name);
int unload_module(char *module_name);

#endif /* INCLUDED_MODULE_LOADER_H */</code></pre>
<p>module_loader.c</p>
<pre><code class="lang-auto">#include "module_loader.h"

/*
 * Loads all of the modules in the provided directory.
 * Returns 1 on success or zero on failure.
 */
int
load_modules(char *module_dir)
{
  DIR *dir;
  struct dirent *ent;
  void *handle;
  int (*fn)();
  char *error;
  int len;
  int load_result;
  char *mod_loc;

  dir = opendir(module_dir);
  if (dir == NULL) {
    printf("load_modules() failed to open directory\n");
    exit(EXIT_FAILURE);
  }

  /*
   * If the filename contains .so then we attempt
   * to load it as a plugin.
   */
  while ((ent = readdir(dir)) != NULL) {
    char *c = strstr(ent-&gt;d_name, ".so");
    if (c != NULL) {
      len = strlen(module_dir) + strlen(ent-&gt;d_name) + 1;
      mod_loc = (char *) malloc(len);
      strcat(mod_loc, module_dir);
      strcat(mod_loc, ent-&gt;d_name);

      handle = dlopen(mod_loc, RTLD_NOW);
      free(mod_loc);
      if (!handle) {
        printf("Failed open: %s. Could not load module %s\n", 
                dlerror(), ent-&gt;d_name);
        return 0;
      }

      fn = dlsym(handle, "module_init");
      if ((error = dlerror()) != NULL) {
        printf("Failed symbol search: %s. Could not load module %s\n", 
                error, ent-&gt;d_name);
        return 0;
      }

      load_result = (*fn)();
      if (!load_result) {
        printf("Failed to load module %s\n", ent-&gt;d_name);
        return 0;
      }

      printf("Loaded module: %s\n", ent-&gt;d_name);
      dlclose(handle); /* Cleanup, temporary only */
    }
  }
  closedir(dir);
  return 1;
}

int 
unload_modules()
{
  return 1;
}

int 
load_module(char *module_dir, char *module_name)
{
  void *handle;
  int (*fn)();
  int load_result;
  char *error;
  char full_module_name[100];

  memset(full_module_name, '\0', 100);
  strcat(full_module_name, module_dir);
  strcat(full_module_name, module_name);
  strcat(full_module_name, ".so");

  handle = dlopen(full_module_name, RTLD_NOW);
  if (!handle) {
    printf("1. %s\n", dlerror());
    return 0;
  }

  fn = dlsym(handle, "module_init");
  if ((error = dlerror()) != NULL) {
    printf("2. %s\n", error);
    return 0;
  }

  load_result = (*fn)();
  if (!load_result) {
    printf("Failed to load module %s\n", module_name);
    return 0;
  }

  dlclose(handle); /* Cleanup, temporary only */
  return 1;
}

int 
unload_module(char *module_name)
{
  return 1;
}</code></pre>
<p>packet_decoder.h</p>
<pre><code class="lang-auto">#ifndef INCLUDED_PACKETDECODER_H
#define INCLUDED_PACKETDECODER_H

#include &lt;event2/bufferevent.h&gt;
#include &lt;event2/buffer.h&gt;

#define PACKET_DECODER_TAB_SIZE 256

struct packet_decoder {
  char *name;
  int (*handler_func)(struct bufferevent *bev, int opcode, int packet_size, void *arg);
};

struct packet_decoder *packet_decoder_table;
int *packet_sizes;

extern char read_byte(struct bufferevent *bev);
extern short read_short(struct bufferevent *bev);
extern int read_int(struct bufferevent *bev);
extern long long read_long(struct bufferevent *bev);

extern void set_packet_decoder_table(struct packet_decoder *table);
extern void set_packet_sizes_table(int *packet_sizes);

extern int discard_handler(struct bufferevent *bev, int opcode, int packet_size, void *arg);


#endif /* INCLUDED_PACKETDECODER_H */</code></pre>
<p>packet_decoder.c</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#include "packet_decoder.h"

char
read_byte(struct bufferevent *bev)
{
  struct evbuffer *input;
  unsigned char *mem;
  char value;

  input = bufferevent_get_input(bev);
  mem = evbuffer_pullup(input, 1);
  value = *mem;
  evbuffer_drain(input, 1);
  return value;
}

short
read_short(struct bufferevent *bev)
{
  struct evbuffer *input;
  unsigned char *mem;
  int value;

  input = bufferevent_get_input(bev);
  mem = evbuffer_pullup(input, 2);
  value = mem[0] &lt;&lt; 8;
  value |= mem[1];
  evbuffer_drain(input, 2);
  return value;
}

int
read_int(struct bufferevent *bev)
{
  struct evbuffer *input;
  unsigned char *mem;
  int value;

  input = bufferevent_get_input(bev);
  mem = evbuffer_pullup(input, 4);
  value = mem[0] &lt;&lt; 24;
  value |= mem[1] &lt;&lt; 16;
  value |= mem[2] &lt;&lt; 8;
  value |= mem[3];
  evbuffer_drain(input, 4);
  return value;
}

long long
read_long(struct bufferevent *bev)
{
  long long value;

  value = read_int(bev);
  value &lt;&lt;= 32;
  value |= read_int(bev);
  return value;
}

void
set_packet_decoder_table(struct packet_decoder *table)
{
  if (table == NULL) {
    fprintf(stderr, "NULL packet decoder table specified\n");
    exit(EXIT_FAILURE);
  }

  packet_decoder_table = table;
}

int
discard_handler(struct bufferevent *bev, int opcode, int packet_size, void *arg)
{
  return 1;
}</code></pre>
<p>And finally, a shared object:</p>
<pre><code class="lang-auto">#include &lt;stdio.h&gt;

#include "packet_decoder.h"

int packet_sizes_508[] = {
  -3, -3, 8, 8, -3, -3, -3, 2, -3, -3,       /* 0 - 9 */
  -3, -3, -3, -3, -3, -3, -3, -3, -3, -3,    /* 10 - 19 */
  -3, 6, 4, -3, 8, -3, -3, -3, -3, -3,       /* 20 - 29 */
  8, -3, -3, -3, -3, -3, -3, 2, 2, -3,       /* 30 - 39 */
  16, -3, -3, 4, -3, -3, -3, 0, -3, -1,      /* 40 - 49 */
  -3, -3, 2, -3, -3, -3, -3, -3, -3, 6,      /* 50 - 59 */
  0, 8, -3, 6, -3, -3, -3, -3, -3, -3,       /* 60 - 69 */
  8, -3, -3, -3, -3, -3, -3, -3, -3, -3,     /* 70 - 79 */
  -3, -3, -3, -3, 2, -3, -3, -3, 2, -3,      /* 80 - 89 */
  -3, -3, -3, -3, -3, -3, -3, -3, -3, 4,     /* 90 - 99 */
  -3, -3, -3, -3, -3, -3, -3, -1, 0, -3,     /* 100 - 109 */
  -3, -3, -3, 4, -3, 0, -3, -1, -3, -1,      /* 110 - 119 */
  -3, -3, -3, 2, -3, -3, -3, -3, -3, -3,     /* 120 - 129 */
  -3, -3, 8, -3, -3, -3, -3, -3, -1, -3,     /* 130 - 139 */
  -3, -3, -3, -3, -3, -3, -3, -3, -3, -3,    /* 140 - 149 */
  -3, -3, -3, -3, -3, -3, -3, -3, 6, -3,     /* 150 - 159 */
  2, -3, -3, -3, -3, 4, -3, 9, -3, 6,        /* 160 - 169 */
  -3, -3, -3, 6, -3, -3, -3, -3, -1, 12,     /* 170 - 179 */
  -3, -3, -3, -3, -3, -3, 8, -3, -3, -3,     /* 180 - 189 */
  -3, -3, -3, -3, -3, -3, -3, -3, -3, 2,     /* 190 - 199 */
  -3, 6, -3, 8, -3, -3, -3, -3, -3, -3,      /* 200 - 209 */
  -3, 8, 6, -3, 6, -3, -3, -3, -3, -3,       /* 210 - 219 */
  8, -3, -1, -3, 14, -3, -3, 2, 6, -3,       /* 220 - 229 */
  -3, -3, 6, 6, -3, -3, -3, -3, -3, -3,      /* 230 - 239 */
  -3, -3, -3, -3, -3, -3, -3, 4, 1, -3,      /* 240 - 249 */
  4, -3, -3, 2, -3, -3                       /* 250 - 255 */
};

struct packet_decoder packet_decoder_508[] = {
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
  {"0", discard_handler},
};

int
module_init()
{
  set_packet_sizes_table(packet_sizes_508);
  printf("508 module has been initialised!\n");
  return 1;
}</code></pre>
      </div>

      <meta itemprop='headline' content='[SOLVED] Problem with dynamic loading'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/abraham2119.html'><span itemprop='name'>abraham2119</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-02-18T04:05:38Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:38:43Z' class='post-time'>
              August 1, 2016,  7:38am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>rofl it doesn’t work that way mate, you have to dynamically get the address of the function you want to invoke</p>
      </div>

      <meta itemprop='headline' content='[SOLVED] Problem with dynamic loading'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-02-18T07:16:06Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:39:02Z' class='post-time'>
              August 1, 2016,  7:39am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>How come Anope modules, as just one of many examples, work though?<br>
I load my modules in precisely the same fashion that they do (however their code supports cross-platform dynamic loading whereas mine does not).</p>
<p>Here’s one of the shorter anope modules, which clearly shows calls to functions declared in the modules.h header file:</p>
<pre><code class="lang-auto">/* BotServ core fantasy functions
 *
 * (C) 2003-2010 Anope Team
 * Contact us at team@anope.org
 *
 * Please read COPYING and README for further details.
 *
 * Based on the original code of Epona by Lara.
 * Based on the original code of Services by Andy Church. 
 * 
 *
 */
/*************************************************************************/

#include "module.h"

int do_fantasy(int argc, char **argv);

/**
 * Create the hook, and tell anope about it.
 * @param argc Argument count
 * @param argv Argument list
 * @return MOD_CONT to allow the module, MOD_STOP to stop it
 **/
int AnopeInit(int argc, char **argv)
{
    EvtHook *hook;

    moduleAddAuthor("Anope");
    moduleAddVersion
        (VERSION_STRING);
    moduleSetType(CORE);

    hook = createEventHook(EVENT_BOT_FANTASY, do_fantasy);
    moduleAddEventHook(hook);

    return MOD_CONT;
}

/**
 * Unload the module
 **/
void AnopeFini(void)
{

}

/**
 * Handle unban fantasy command.
 * @param argc Argument count
 * @param argv Argument list
 * @return MOD_CONT or MOD_STOP
 **/
int do_fantasy(int argc, char **argv)
{
    User *u;
    ChannelInfo *ci;
    char *target = NULL;

    if (argc &lt; 3)
        return MOD_CONT;

    if (stricmp(argv[0], "unban") == 0) {
        u = finduser(argv[1]);
        ci = cs_findchan(argv[2]);
        if (!u || !ci || !check_access(u, ci, CA_UNBAN))
            return MOD_CONT;

        if (argc &gt;= 4)
            target = myStrGetToken(argv[3], ' ', 0);
        if (!target)
            common_unban(ci, u-&gt;nick);
        else
            common_unban(ci, target);

        /* free target if needed (#852) */
        Anope_Free(target);
    }

    return MOD_CONT;
}</code></pre>
<p>EDIT: Okay, I’ve solved the problem now. As I suspected, I wasn’t building the main executable right.<br>
So yeah, I built the shared object code as position independent, but didn’t build the main executable with the --export-dynamic flag – doing so solved the problem.</p>
<p>For anyone else who has the problem, build your main executable with -Wl,–export-dynamic and be sure to build modules with -fPIC.</p>
      </div>

      <meta itemprop='headline' content='[SOLVED] Problem with dynamic loading'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Evil1.html'><span itemprop='name'>Evil1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-02-19T08:57:35Z'>
            <time itemprop='dateModified' datetime='2016-08-01T07:40:31Z' class='post-time'>
              August 1, 2016,  7:40am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“abraham2119, post:2, topic:382878”]rofl it doesn’t work that way mate, you have to dynamically get the address of the function you want to invoke[/quote]I’m pretty sure that’s what dlsym is for.</p>
<p>[quote=“man-pages”]   dlsym()<br>
The  function  dlsym()  takes  a  “handle”  of a dynamic library returned by dlopen() and the null-terminated symbol name, returning the address where that symbol is<br>
loaded into memory.  If the symbol is not found, in the specified library or any of the libraries that were automatically loaded by dlopen() when  that  library  was<br>
loaded,  dlsym()  returns  NULL.   (The  search performed by dlsym() is breadth first through the dependency tree of these libraries.)  Since the value of the symbol<br>
could actually be NULL (so that a NULL return from dlsym() need not indicate an error), the correct way to test for an error is to call dlerror() to  clear  any  old<br>
error conditions, then call dlsym(), and then call dlerror() again, saving its return value into a variable, and check whether this saved value is not NULL.</p>
<pre><code>   There  are  two special pseudo-handles, RTLD_DEFAULT and RTLD_NEXT.  The former will find the first occurrence of the desired symbol using the default library search
   order.  The latter will find the next occurrence of a function in the search order after the current library.  This allows one to provide a wrapper around a function
   in another shared library.[/quote]</code></pre>
      </div>

      <meta itemprop='headline' content='[SOLVED] Problem with dynamic loading'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/solved-problem-with-dynamic-loading/382878 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 20:25:46 GMT -->
</html>
