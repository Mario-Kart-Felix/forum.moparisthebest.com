<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Snippet] Almost fully refactored login protocol</title>
    <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843</link>
    <description>There are two variables that I don&#39;t understand, if you know what they do then please tell me. Also, if you have any better names for anything, please let me know. I&#39;m also interested if anyone can explain why two output streams are used.

[code=Java]	private void login(String username, String password, boolean recoveringConnection)
	{
		signlink.errorname = username;
		try
		{
			if (!recoveringConnection)
			{
				loginMessage1 = &quot;&quot;;
				loginMessage2 = &quot;Connecting to server...&quot;;
				drawLoginScreen(true);
			}
			buffer = new RSSocket(this, openSocket(43594 + portOffset));
			long nameLong = TextClass.nameToLong(username);
			int nameHash = (int) (nameLong &gt;&gt; 16 &amp; 31L);
			outStream1.offset = 0;
			outStream1.put(14);
			outStream1.put(nameHash);
			buffer.queueBytes(2, outStream1.payload);
			for (int junk = 0; junk &lt; 8; junk++)
				buffer.read();

			int loginResponse = buffer.read();
			int originalLoginResponse = loginResponse;
			if (loginResponse == 0)
			{
				buffer.read(inStream.payload, 8);
				inStream.offset = 0;
				serverSessionKey = inStream.getLong();
				int seed[] = new int[4];
				seed[0] = (int) (Math.random() * 99999999D);
				seed[1] = (int) (Math.random() * 99999999D);
				seed[2] = (int) (serverSessionKey &gt;&gt; 32);
				seed[3] = (int) serverSessionKey;
				outStream1.offset = 0;
				outStream1.put(10);
				outStream1.putInt(seed[0]);
				outStream1.putInt(seed[1]);
				outStream1.putInt(seed[2]);
				outStream1.putInt(seed[3]);
				outStream1.putInt(signlink.uid);
				outStream1.putString(username);
				outStream1.putString(password);
				outStream1.doKeys();
				outStream2.offset = 0;
				if (recoveringConnection)
				{
					outStream2.put(18);
				}
				else
				{
					outStream2.put(16);
				}
				outStream2.put(outStream1.offset + 40);
				outStream2.put(255);
				outStream2.putShort(317);
				if(lowMemory)
				{
					outStream2.put(1);
				}
				else
				{
					outStream2.put(0);
				}
				
				for (int crcValue = 0; crcValue &lt; 9; crcValue++)
				{
					outStream2.putInt(crcValues[crcValue]);
				}

				outStream2.putBytes(outStream1.payload, outStream1.offset, 0);
				outStream1.isaacCipher = new ISAACCipher(seed);
				for (int index = 0; index &lt; 4; index++)
					seed[index] += 50;

				isaacCipher = new ISAACCipher(seed);
				buffer.queueBytes(outStream2.offset, outStream2.payload);
				loginResponse = buffer.read();
			}
			if (loginResponse == 1)
			{
				try
				{
					Thread.sleep(2000L);
				}
				catch (Exception _ex)
				{
				}
				login(username, password, recoveringConnection);
				return;
			}
			if (loginResponse == 2)
			{
				playerRights = buffer.read();
				flagged = buffer.read() == 1;
				lastClickTime = 0L;
				sameClickCounter = 0;
				mouseDetection.coord = 0;
				super.awtFocus = true;
				wasFocused = true;
				loggedIn = true;
				outStream1.offset = 0;
				inStream.offset = 0;
				packetOpcode = -1;
				firstLastOpcode = -1;
				secondLastOpcode = -1;
				thirdLastOpcode = -1;
				packetSize = 0;
				timeoutCounter = 0;
				systemUpdateTime = 0;
				anInt1011 = 0;
				hintIconType = 0;
				menuActionRow = 0;
				menuOpen = false;
				super.idleTime = 0;
				for (int message = 0; message &lt; 100; message++)
					chatMessages[message] = null;

				itemSelected = 0;
				spellSelected = 0;
				loadingStage = 0;
				trackCount = 0;
				cameraOffsetX = (int) (Math.random() * 100D) - 50;
				cameraOffsetY = (int) (Math.random() * 110D) - 55;
				viewRotationOffset = (int) (Math.random() * 80D) - 40;
				minimapRotation = (int) (Math.random() * 120D) - 60;
				minimapZoom = (int) (Math.random() * 30D) - 20;
				cameraX = (int) (Math.random() * 20D) - 10 &amp; 0x7ff;
				miniMapLock = 0;
				lastSceneId = -1;
				destinationX = 0;
				destinationY = 0;
				sessionPlayerCount = 0;
				sessionNpcCount = 0;
				for (int player = 0; player &lt; maxPlayers; player++)
				{
					sessionPlayers[player] = null;
					sessionPlayerUpdateStreams[player] = null;
				}

				for (int npc = 0; npc &lt; 16384; npc++)
					sessionNpcs[npc] = null;

				sessionPlayer = sessionPlayers[sessionPlayerIndex] = new Player();
				projectileQueue.clear();
				stillGraphicQueue.clear();
				for (int scene = 0; scene &lt; 4; scene++)
				{
					for (int x = 0; x &lt; 104; x++)
					{
						for (int y = 0; y &lt; 104; y++)
						{
							groundArray[scene][x][y] = null;
						}
					}
				}

				gameObjectSpawnQueue = new NodeList();
				friendListStatus = 0;
				friendListCount = 0;
				chatboxDialogId = -1;
				backDialogID = -1;
				openInterfaceID = -1;
				invOverlayInterfaceID = -1;
				currentStatusInterface = -1;
				isDialogueInterface = false;
				tabID = 3;
				inputType = 0;
				menuOpen = false;
				messagePromptRaised = false;
				clickToContinueString = null;
				multiCombat = 0;
				flashingSideBarID = -1;
				characterChangeGender = true;
				characterChangeGender();
				for (int color = 0; color &lt; 5; color++)
					characterEditColours[color] = 0;

				for (int action = 0; action &lt; 5; action++)
				{
					atPlayerActions[action] = null;
					atPlayerArray[action] = false;
				}

				anticheat6 = 0;
				anticheat3 = 0;
				anticheat15 = 0;
				anticheat9 = 0;
				anticheat13 = 0;
				anticheat7 = 0;
				anticheat5 = 0;
				anticheat8 = 0;
				//int anInt941 = 0;
				//int anInt1260 = 0;
				resetImageProducers2();
				return;
			}
			if (loginResponse == 3)
			{
				loginMessage1 = &quot;&quot;;
				loginMessage2 = &quot;Invalid username or password.&quot;;
				return;
			}
			if (loginResponse == 4)
			{
				loginMessage1 = &quot;Your account has been disabled.&quot;;
				loginMessage2 = &quot;Please check your message-center for details.&quot;;
				return;
			}
			if (loginResponse == 5)
			{
				loginMessage1 = &quot;Your account is already logged in.&quot;;
				loginMessage2 = &quot;Try again in 60 secs...&quot;;
				return;
			}
			if (loginResponse == 6)
			{
				loginMessage1 = &quot;RuneScape has been updated!&quot;;
				loginMessage2 = &quot;Please reload this page.&quot;;
				return;
			}
			if (loginResponse == 7)
			{
				loginMessage1 = &quot;This world is full.&quot;;
				loginMessage2 = &quot;Please use a different world.&quot;;
				return;
			}
			if (loginResponse == 8)
			{
				loginMessage1 = &quot;Unable to connect.&quot;;
				loginMessage2 = &quot;Login server offline.&quot;;
				return;
			}
			if (loginResponse == 9)
			{
				loginMessage1 = &quot;Login limit exceeded.&quot;;
				loginMessage2 = &quot;Too many connections from your address.&quot;;
				return;
			}
			if (loginResponse == 10)
			{
				loginMessage1 = &quot;Unable to connect.&quot;;
				loginMessage2 = &quot;Bad session id.&quot;;
				return;
			}
			if (loginResponse == 11)
			{
				loginMessage2 = &quot;Login server rejected session.&quot;;
				loginMessage2 = &quot;Please try again.&quot;;
				return;
			}
			if (loginResponse == 12)
			{
				loginMessage1 = &quot;You need a members account to login to this world.&quot;;
				loginMessage2 = &quot;Please subscribe, or use a different world.&quot;;
				return;
			}
			if (loginResponse == 13)
			{
				loginMessage1 = &quot;Could not complete login.&quot;;
				loginMessage2 = &quot;Please try using a different world.&quot;;
				return;
			}
			if (loginResponse == 14)
			{
				loginMessage1 = &quot;The server is being updated.&quot;;
				loginMessage2 = &quot;Please wait 1 minute and try again.&quot;;
				return;
			}
			if (loginResponse == 15)
			{
				loggedIn = true;
				outStream1.offset = 0;
				inStream.offset = 0;
				packetOpcode = -1;
				firstLastOpcode = -1;
				secondLastOpcode = -1;
				thirdLastOpcode = -1;
				packetSize = 0;
				timeoutCounter = 0;
				systemUpdateTime = 0;
				menuActionRow = 0;
				menuOpen = false;
				aLong824 = System.currentTimeMillis();
				return; 
			}
			if (loginResponse == 16)
			{
				loginMessage1 = &quot;Login attempts exceeded.&quot;;
				loginMessage2 = &quot;Please wait 1 minute and try again.&quot;;
				return;
			}
			if (loginResponse == 17)
			{
				loginMessage1 = &quot;You are standing in a members-only area.&quot;;
				loginMessage2 = &quot;To play on this world move to a free area first&quot;;
				return;
			}
			if (loginResponse == 20)
			{
				loginMessage1 = &quot;Invalid loginserver requested&quot;;
				loginMessage2 = &quot;Please try using a different world.&quot;;
				return;
			}
			if (loginResponse == 21)
			{
				for (int k1 = buffer.read(); k1 &gt;= 0; k1--)
				{
					loginMessage1 = &quot;You have only just left another world&quot;;
					loginMessage2 = &quot;Your profile will be transferred in: &quot;
							+ k1 + &quot; seconds&quot;;
					drawLoginScreen(true);
					try
					{
						Thread.sleep(1000L);
					}
					catch (Exception _ex)
					{
					}
				}

				login(username, password, recoveringConnection);
				return;
			}
			if (loginResponse == -1)
			{
				if (originalLoginResponse == 0)
				{
					if (loginFailures &lt; 2)
					{
						try
						{
							Thread.sleep(2000L);
						}
						catch (Exception _ex)
						{
						}
						loginFailures++;
						login(username, password, recoveringConnection);
						return;
					}
					else
					{
						loginMessage1 = &quot;No response from loginserver&quot;;
						loginMessage2 = &quot;Please wait 1 minute and try again.&quot;;
						return;
					}
				}
				else
				{
					loginMessage1 = &quot;No response from server&quot;;
					loginMessage2 = &quot;Please try using a different world.&quot;;
					return;
				}
			}
			else
			{
				System.out.println(&quot;response:&quot; + loginResponse);
				loginMessage1 = &quot;Unexpected server response&quot;;
				loginMessage2 = &quot;Please try using a different world.&quot;;
				return;
			}
		}
		catch (IOException _ex)
		{
			loginMessage1 = &quot;&quot;;
		}
		loginMessage2 = &quot;Error connecting to server.&quot;;
	}[/code]</description>
    
    <lastBuildDate>Mon, 06 Jan 2014 13:33:33 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="14" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
 t4:</div>
<blockquote>
<p>Well I don’t know, some of the naming leads me to believe you just copied whatever you saw in a server source.</p>
</blockquote>
</aside>
<p>I didn’t use a server at all as my reference for this, I only used the login protocol documentation on <a href="http://rswiki.moparisthebest.com/" data-bbcode="true" rel="nofollow noopener">RSWiki</a>. Some of the names were bound to be wrong, I will take a look at yours later and adjust mine accordingly - thank you! <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/15</link>
        <pubDate>Mon, 06 Jan 2014 13:33:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-15</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>Well I don’t know, some of the naming leads me to believe you just copied whatever you saw in a server source. Take a look at my post in this section. I’ll be posting more like it in the future <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/14</link>
        <pubDate>Mon, 06 Jan 2014 12:49:40 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-14</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="11" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
 t4:</div>
<blockquote>
<p>This is pretty rubbish naming, could use a lot more comments too.</p>
</blockquote>
</aside>
<p>What naming would you improve? Yeah, I would have added comments but as sini said everyone knows what it does.</p>
<aside class="quote" data-post="12" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>Thing is we know all this. I’d like to see something that I haven’t seen in the past four years discovered.</p>
</blockquote>
</aside>
<p>It’s coming!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/13</link>
        <pubDate>Mon, 06 Jan 2014 12:07:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-13</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@sinisoul sini]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sinisoul">@sinisoul</a> wrote:</p>
          <blockquote>
              <p>Thing is we know all this. I’d like to see something that I haven’t seen in the past four years discovered.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/12</link>
        <pubDate>Mon, 06 Jan 2014 10:01:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-12</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>This is pretty rubbish naming, could use a lot more comments too.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/11</link>
        <pubDate>Mon, 06 Jan 2014 09:24:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-11</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="9" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/artem543/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> artem543:</div>
<blockquote>
<p>Nothing impressive <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
</blockquote>
</aside>
<p>I’ve yet to see any publicly released client that has a fully refactored login protocol, so this was released for those who with to understand it better but are unable to refactor it themselves.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/10</link>
        <pubDate>Mon, 06 Jan 2014 07:30:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-10</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@artem543 artem543]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/artem543">@artem543</a> wrote:</p>
          <blockquote>
              <p>Nothing impressive <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/9</link>
        <pubDate>Mon, 06 Jan 2014 02:35:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-9</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:7, topic:537843”][quote author=Ambokile link=topic=656668.msg4394493#msg4394493 date=1388702800]</p>
<aside class="quote">
<blockquote>
<p>I have a pretty well refactored 317 client laying around mind telling me which variables you are unsure about? Also those “anti cheat” values can be further refactored</p>
</blockquote>
</aside>
<p>anInt1011 and aLong824 in the code above. I’ll be looking into the anticheat variables later on, I used another refactored client as reference for that, but I’ll be looking into those some more.</p>
<aside class="quote">
<blockquote>
<p>holy shit thanks for this</p>
</blockquote>
</aside>
<p>No problem. Any other parts of the client you’d like to see most? I’ve done most of the sound classes.<br>
[/quote]</p>
<p>aLong824 -This is a current time placeholder When the client is loading terrain from the cache or ondemand it would set the current time and try to load the file, if the client takes longer than 36 seconds to load the nessesary files the client would throw a signlink error. The reason you find it in the “relogin” packet is because this value would normally already be previously set during normal gameplay and if you logout and don’t reset the time on login you would instantly throw the signlink error.</p>
<p>anInt1011 - This one is just leftover obfuscation it holds no value to the gamengine. You will notice that it can be set a value of 250 or 205 but it holds no purpose.[/quote]<br>
Thank you! I knew that aLong824 was used to time something, but I wasn’t sure what. What action do you suggest I take to anInt1011? I’ve been wary of just removing obfuscation leftovers because it will make it harder for people to compare their clients to mine.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/8</link>
        <pubDate>Fri, 03 Jan 2014 04:28:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-8</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>[quote=“Ambokile, post:5, topic:537843”][quote author=Miss Silabsoft link=topic=656668.msg4393951#msg4393951 date=1388519934]<br>
I have a pretty well refactored 317 client laying around mind telling me which variables you are unsure about? Also those “anti cheat” values can be further refactored<br>
[/quote]</p>
<p>anInt1011 and aLong824 in the code above. I’ll be looking into the anticheat variables later on, I used another refactored client as reference for that, but I’ll be looking into those some more.</p>
<aside class="quote">
<blockquote>
<p>holy shit thanks for this</p>
</blockquote>
</aside>
<p>No problem. Any other parts of the client you’d like to see most? I’ve done most of the sound classes.[/quote]</p>
<p>aLong824 -This is a current time placeholder When the client is loading terrain from the cache or ondemand it would set the current time and try to load the file, if the client takes longer than 36 seconds to load the nessesary files the client would throw a signlink error. The reason you find it in the “relogin” packet is because this value would normally already be previously set during normal gameplay and if you logout and don’t reset the time on login you would instantly throw the signlink error.</p>
<p>anInt1011 - This one is just leftover obfuscation it holds no value to the gamengine. You will notice that it can be set a value of 250 or 205 but it holds no purpose.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/7</link>
        <pubDate>Fri, 03 Jan 2014 03:21:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-7</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="5" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/ambokile/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Ambokile:</div>
<blockquote>
<p>No problem. Any other parts of the client you’d like to see most? I’ve done most of the sound classes.</p>
</blockquote>
</aside>
<p>server -&gt; client packets</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/6</link>
        <pubDate>Fri, 03 Jan 2014 02:45:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-6</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
 Miss Silabsoft:</div>
<blockquote>
<p>I have a pretty well refactored 317 client laying around mind telling me which variables you are unsure about? Also those “anti cheat” values can be further refactored</p>
</blockquote>
</aside>
<p>anInt1011 and aLong824 in the code above. I’ll be looking into the anticheat variables later on, I used another refactored client as reference for that, but I’ll be looking into those some more.</p>
<aside class="quote" data-post="4" data-topic="537843">
<div class="title">
<div class="quote-controls"></div>
 Clawz fury:</div>
<blockquote>
<p>holy shit thanks for this</p>
</blockquote>
</aside>
<p>No problem. Any other parts of the client you’d like to see most? I’ve done most of the sound classes.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/5</link>
        <pubDate>Thu, 02 Jan 2014 22:46:40 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-5</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>holy shit thanks for this</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/4</link>
        <pubDate>Wed, 01 Jan 2014 01:01:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-4</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>I have a pretty well refactored 317 client laying around mind telling me which variables you are unsure about? Also those “anti cheat” values can be further refactored</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/3</link>
        <pubDate>Tue, 31 Dec 2013 19:58:54 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-3</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Docent Limits]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/docent">@Docent</a> wrote:</p>
          <blockquote>
              <p>Great Job!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/2</link>
        <pubDate>Tue, 31 Dec 2013 19:08:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-2</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
      <item>
        <title>[Snippet] Almost fully refactored login protocol</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <p>There are two variables that I don’t understand, if you know what they do then please tell me. Also, if you have any better names for anything, please let me know. I’m also interested if anyone can explain why two output streams are used.</p>
<p>[code=Java]	private void login(String username, String password, boolean recoveringConnection)<br>
{<br>
signlink.errorname = username;<br>
try<br>
{<br>
if (!recoveringConnection)<br>
{<br>
loginMessage1 = “”;<br>
loginMessage2 = “Connecting to server…”;<br>
drawLoginScreen(true);<br>
}<br>
buffer = new RSSocket(this, openSocket(43594 + portOffset));<br>
long nameLong = TextClass.nameToLong(username);<br>
int nameHash = (int) (nameLong &gt;&gt; 16 &amp; 31L);<br>
outStream1.offset = 0;<br>
outStream1.put(14);<br>
outStream1.put(nameHash);<br>
buffer.queueBytes(2, outStream1.payload);<br>
for (int junk = 0; junk &lt; 8; junk++)<br>
buffer.read();</p>
<pre><code>		int loginResponse = buffer.read();
		int originalLoginResponse = loginResponse;
		if (loginResponse == 0)
		{
			buffer.read(inStream.payload, 8);
			inStream.offset = 0;
			serverSessionKey = inStream.getLong();
			int seed[] = new int[4];
			seed[0] = (int) (Math.random() * 99999999D);
			seed[1] = (int) (Math.random() * 99999999D);
			seed[2] = (int) (serverSessionKey &gt;&gt; 32);
			seed[3] = (int) serverSessionKey;
			outStream1.offset = 0;
			outStream1.put(10);
			outStream1.putInt(seed[0]);
			outStream1.putInt(seed[1]);
			outStream1.putInt(seed[2]);
			outStream1.putInt(seed[3]);
			outStream1.putInt(signlink.uid);
			outStream1.putString(username);
			outStream1.putString(password);
			outStream1.doKeys();
			outStream2.offset = 0;
			if (recoveringConnection)
			{
				outStream2.put(18);
			}
			else
			{
				outStream2.put(16);
			}
			outStream2.put(outStream1.offset + 40);
			outStream2.put(255);
			outStream2.putShort(317);
			if(lowMemory)
			{
				outStream2.put(1);
			}
			else
			{
				outStream2.put(0);
			}
			
			for (int crcValue = 0; crcValue &lt; 9; crcValue++)
			{
				outStream2.putInt(crcValues[crcValue]);
			}

			outStream2.putBytes(outStream1.payload, outStream1.offset, 0);
			outStream1.isaacCipher = new ISAACCipher(seed);
			for (int index = 0; index &lt; 4; index++)
				seed[index] += 50;

			isaacCipher = new ISAACCipher(seed);
			buffer.queueBytes(outStream2.offset, outStream2.payload);
			loginResponse = buffer.read();
		}
		if (loginResponse == 1)
		{
			try
			{
				Thread.sleep(2000L);
			}
			catch (Exception _ex)
			{
			}
			login(username, password, recoveringConnection);
			return;
		}
		if (loginResponse == 2)
		{
			playerRights = buffer.read();
			flagged = buffer.read() == 1;
			lastClickTime = 0L;
			sameClickCounter = 0;
			mouseDetection.coord = 0;
			super.awtFocus = true;
			wasFocused = true;
			loggedIn = true;
			outStream1.offset = 0;
			inStream.offset = 0;
			packetOpcode = -1;
			firstLastOpcode = -1;
			secondLastOpcode = -1;
			thirdLastOpcode = -1;
			packetSize = 0;
			timeoutCounter = 0;
			systemUpdateTime = 0;
			anInt1011 = 0;
			hintIconType = 0;
			menuActionRow = 0;
			menuOpen = false;
			super.idleTime = 0;
			for (int message = 0; message &lt; 100; message++)
				chatMessages[message] = null;

			itemSelected = 0;
			spellSelected = 0;
			loadingStage = 0;
			trackCount = 0;
			cameraOffsetX = (int) (Math.random() * 100D) - 50;
			cameraOffsetY = (int) (Math.random() * 110D) - 55;
			viewRotationOffset = (int) (Math.random() * 80D) - 40;
			minimapRotation = (int) (Math.random() * 120D) - 60;
			minimapZoom = (int) (Math.random() * 30D) - 20;
			cameraX = (int) (Math.random() * 20D) - 10 &amp; 0x7ff;
			miniMapLock = 0;
			lastSceneId = -1;
			destinationX = 0;
			destinationY = 0;
			sessionPlayerCount = 0;
			sessionNpcCount = 0;
			for (int player = 0; player &lt; maxPlayers; player++)
			{
				sessionPlayers[player] = null;
				sessionPlayerUpdateStreams[player] = null;
			}

			for (int npc = 0; npc &lt; 16384; npc++)
				sessionNpcs[npc] = null;

			sessionPlayer = sessionPlayers[sessionPlayerIndex] = new Player();
			projectileQueue.clear();
			stillGraphicQueue.clear();
			for (int scene = 0; scene &lt; 4; scene++)
			{
				for (int x = 0; x &lt; 104; x++)
				{
					for (int y = 0; y &lt; 104; y++)
					{
						groundArray[scene][x][y] = null;
					}
				}
			}

			gameObjectSpawnQueue = new NodeList();
			friendListStatus = 0;
			friendListCount = 0;
			chatboxDialogId = -1;
			backDialogID = -1;
			openInterfaceID = -1;
			invOverlayInterfaceID = -1;
			currentStatusInterface = -1;
			isDialogueInterface = false;
			tabID = 3;
			inputType = 0;
			menuOpen = false;
			messagePromptRaised = false;
			clickToContinueString = null;
			multiCombat = 0;
			flashingSideBarID = -1;
			characterChangeGender = true;
			characterChangeGender();
			for (int color = 0; color &lt; 5; color++)
				characterEditColours[color] = 0;

			for (int action = 0; action &lt; 5; action++)
			{
				atPlayerActions[action] = null;
				atPlayerArray[action] = false;
			}

			anticheat6 = 0;
			anticheat3 = 0;
			anticheat15 = 0;
			anticheat9 = 0;
			anticheat13 = 0;
			anticheat7 = 0;
			anticheat5 = 0;
			anticheat8 = 0;
			//int anInt941 = 0;
			//int anInt1260 = 0;
			resetImageProducers2();
			return;
		}
		if (loginResponse == 3)
		{
			loginMessage1 = "";
			loginMessage2 = "Invalid username or password.";
			return;
		}
		if (loginResponse == 4)
		{
			loginMessage1 = "Your account has been disabled.";
			loginMessage2 = "Please check your message-center for details.";
			return;
		}
		if (loginResponse == 5)
		{
			loginMessage1 = "Your account is already logged in.";
			loginMessage2 = "Try again in 60 secs...";
			return;
		}
		if (loginResponse == 6)
		{
			loginMessage1 = "RuneScape has been updated!";
			loginMessage2 = "Please reload this page.";
			return;
		}
		if (loginResponse == 7)
		{
			loginMessage1 = "This world is full.";
			loginMessage2 = "Please use a different world.";
			return;
		}
		if (loginResponse == 8)
		{
			loginMessage1 = "Unable to connect.";
			loginMessage2 = "Login server offline.";
			return;
		}
		if (loginResponse == 9)
		{
			loginMessage1 = "Login limit exceeded.";
			loginMessage2 = "Too many connections from your address.";
			return;
		}
		if (loginResponse == 10)
		{
			loginMessage1 = "Unable to connect.";
			loginMessage2 = "Bad session id.";
			return;
		}
		if (loginResponse == 11)
		{
			loginMessage2 = "Login server rejected session.";
			loginMessage2 = "Please try again.";
			return;
		}
		if (loginResponse == 12)
		{
			loginMessage1 = "You need a members account to login to this world.";
			loginMessage2 = "Please subscribe, or use a different world.";
			return;
		}
		if (loginResponse == 13)
		{
			loginMessage1 = "Could not complete login.";
			loginMessage2 = "Please try using a different world.";
			return;
		}
		if (loginResponse == 14)
		{
			loginMessage1 = "The server is being updated.";
			loginMessage2 = "Please wait 1 minute and try again.";
			return;
		}
		if (loginResponse == 15)
		{
			loggedIn = true;
			outStream1.offset = 0;
			inStream.offset = 0;
			packetOpcode = -1;
			firstLastOpcode = -1;
			secondLastOpcode = -1;
			thirdLastOpcode = -1;
			packetSize = 0;
			timeoutCounter = 0;
			systemUpdateTime = 0;
			menuActionRow = 0;
			menuOpen = false;
			aLong824 = System.currentTimeMillis();
			return; 
		}
		if (loginResponse == 16)
		{
			loginMessage1 = "Login attempts exceeded.";
			loginMessage2 = "Please wait 1 minute and try again.";
			return;
		}
		if (loginResponse == 17)
		{
			loginMessage1 = "You are standing in a members-only area.";
			loginMessage2 = "To play on this world move to a free area first";
			return;
		}
		if (loginResponse == 20)
		{
			loginMessage1 = "Invalid loginserver requested";
			loginMessage2 = "Please try using a different world.";
			return;
		}
		if (loginResponse == 21)
		{
			for (int k1 = buffer.read(); k1 &gt;= 0; k1--)
			{
				loginMessage1 = "You have only just left another world";
				loginMessage2 = "Your profile will be transferred in: "
						+ k1 + " seconds";
				drawLoginScreen(true);
				try
				{
					Thread.sleep(1000L);
				}
				catch (Exception _ex)
				{
				}
			}

			login(username, password, recoveringConnection);
			return;
		}
		if (loginResponse == -1)
		{
			if (originalLoginResponse == 0)
			{
				if (loginFailures &lt; 2)
				{
					try
					{
						Thread.sleep(2000L);
					}
					catch (Exception _ex)
					{
					}
					loginFailures++;
					login(username, password, recoveringConnection);
					return;
				}
				else
				{
					loginMessage1 = "No response from loginserver";
					loginMessage2 = "Please wait 1 minute and try again.";
					return;
				}
			}
			else
			{
				loginMessage1 = "No response from server";
				loginMessage2 = "Please try using a different world.";
				return;
			}
		}
		else
		{
			System.out.println("response:" + loginResponse);
			loginMessage1 = "Unexpected server response";
			loginMessage2 = "Please try using a different world.";
			return;
		}
	}
	catch (IOException _ex)
	{
		loginMessage1 = "";
	}
	loginMessage2 = "Error connecting to server.";
}[/code]</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843/1</link>
        <pubDate>Mon, 30 Dec 2013 22:08:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-537843-1</guid>
        <source url="https://forum.moparisthebest.com/t/snippet-almost-fully-refactored-login-protocol/537843.rss">[Snippet] Almost fully refactored login protocol</source>
      </item>
  </channel>
</rss>
