<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
    <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355</link>
    <description>Thanks to Kurt Cobain for the original [URL=http://&quot;runescape-development/rs2-client/tutorials/323214-jili-x-i-auto-updater-v1-0-a.html&quot;]post[/URL]


NOTE:
Please I beg you allow system files to be seen from control panel &gt; folder options. In the list with check boxes.
DELETE Thumbs.db FROM EVERY folder in your cache, if you dont see it in a folder dont keep looking, it&#39;s not there move on...

Much simpler works amazing!
Stupid GUI is removed and integrated into to the loading bar


Updating
[IMG]http://runehilation.com/images/cacheupdating.png[/img]
Downloading Cache
[IMG]http://runehilation.com/images/cachedownloading.png[/img]
Extracting Cache
[IMG]http://runehilation.com/images/extractingcache.png[/img]

Example of cacheVersion.txt
[code]
1.0
[/code]

Create a file called &quot;UpdateCache.java&quot; inside your source add this
[code]
import java.net.URL;
import java.net.URLConnection;
import java.util.zip.*;
import sign.signlink;
import java.io.*;
import javax.swing.JOptionPane;

public class UpdateCache implements Runnable {

	public static final String ZIP_URL = &quot;http://YOUR_SITE.com/cache.zip&quot;;
	public static final String VERSION_URL = &quot;http://YOUR_SITE.com/cacheVersion.txt&quot;;
	public static final String VERSION_FILE = sign.signlink.findcachedir()+&quot;cacheVersion.dat&quot;;
	private client client;
	client frame;
    public UpdateCache(client client) {
                this.client = client;
    }
		
    private void drawLoadingText(int amount, String text) {
                client.drawLoadingText(amount, text);
    }
	
	public double getCurrentVersion(){
		try {
			BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(VERSION_FILE)));
			return Double.parseDouble(br.readLine());
		} catch (Exception e) {
			return 0.1;
		}
	}
	
	public double getNewestVersion(){
		try {
			URL tmp = new URL(VERSION_URL);
			BufferedReader br = new BufferedReader(new InputStreamReader(tmp.openStream()));
			return Double.parseDouble(br.readLine());
		} catch (Exception e) {
			handleException(e);
			return -1;
		}
	}
	
	private void handleException(Exception e){
		StringBuilder strBuff = new StringBuilder();
		strBuff.append(&quot;Please Screenshot this message, and send it to an admin!\r\n\r\n&quot;);
        StringBuilder append = strBuff.append(e.getClass().getName()).append(&quot; \&quot;&quot;).append(e.getMessage()).append(&quot;\&quot;\r\n&quot;);
		for(StackTraceElement s : e.getStackTrace())
			strBuff.append(s.toString()).append(&quot;\r\n&quot;);
		alert(&quot;Exception [&quot; + e.getClass().getSimpleName() + &quot;]&quot;,strBuff.toString(),true);
	}
	
	private void alert(String msg){
		alert(&quot;Message&quot;,msg,false);
	}
	
	private void alert(String title,String msg,boolean error){
		JOptionPane.showMessageDialog(null,
			   msg,
			   title,
			    (error ? JOptionPane.ERROR_MESSAGE : JOptionPane.PLAIN_MESSAGE));
	}
	
	@Override
	public void run() {
	drawLoadingText(0, &quot;Checking Versions&quot;);
		try{
		double newest = getNewestVersion();
		if(newest &gt; this.getCurrentVersion()){
			int n = JOptionPane.showConfirmDialog(
				    null,
				    &quot;There is an update to version &quot; + newest + &quot;\n&quot; +
					&quot;Would you like to update?&quot;,
				    &quot;Current version: &quot;+ getCurrentVersion(),
				    JOptionPane.YES_NO_OPTION);
			if(n == 0){
				updateClient();
				drawLoadingText(0, &quot;Cache has been updated, please restart the client!&quot;);
				alert(&quot;Cache has been updated, please restart the client!&quot;);
				OutputStream out = new FileOutputStream(VERSION_FILE);
				out.write(String.valueOf(newest).getBytes());;
				System.exit(0);
			}else{
				alert(&quot; Your client may not load correct &quot; +
				getCurrentVersion());
				//System.exit(0);
			}
		}
		}catch(Exception e){
			handleException(e);
		}
	}
	
	private void updateClient() {
		File clientZip = downloadClient();
		if(clientZip != null){
		unZip(clientZip);
		}
	}
	
	private void unZip(File clientZip) {
		try {
			unZipFile(clientZip,new File(sign.signlink.findcachedir()));
			clientZip.delete();
		} catch (IOException e) {
			handleException(e);
		}
	}
	
	private void unZipFile(File zipFile,File outFile) throws IOException{
		ZipInputStream zin = new ZipInputStream(new BufferedInputStream(new FileInputStream(zipFile)));
		ZipEntry e;
		long max = 0;
		long curr = 0;
		while((e = zin.getNextEntry()) != null)
			max += e.getSize();
		zin.close();
		ZipInputStream in = new ZipInputStream(new BufferedInputStream(new FileInputStream(zipFile)));
		while((e = in.getNextEntry()) != null){
			if(e.isDirectory())
				new File(outFile,e.getName()).mkdirs();
			else{
				FileOutputStream out = new FileOutputStream(new File(outFile,e.getName()));
				byte[] b = new byte[1024];
				int len;
				while((len = in.read(b,0,b.length)) &gt; -1){
					curr += len;
						out.write(b, 0, len);
						setUnzipPercent((int)((curr * 100) / max));
				}
				out.flush();
				out.close();
			}
		}
	}

	public int percent = 0;
	
	public void setDownloadPercent(int amount){
	        percent = amount;
			drawLoadingText(amount, &quot;Downloading Cache&quot; + &quot; - &quot; + amount + &quot;%&quot;);
	}
	
	public int percent2 = 0;
	
	public void setUnzipPercent(int amount2){
	        percent2 = amount2;
			drawLoadingText(amount2, &quot;Extracting Cache&quot; + &quot; - &quot; + amount2 + &quot;%&quot;);
	}

	private File downloadClient(){
		File ret = new File(signlink.findcachedir()+&quot;cache.zip&quot;);
		try{
		OutputStream out = new FileOutputStream(ret);
		URLConnection conn = new URL(ZIP_URL).openConnection();
		InputStream in = conn.getInputStream();
		long max = conn.getContentLength();
		long curr = 0;
		byte[] b = new byte[1024];
		int len;
		while((len = in.read(b, 0, b.length)) &gt; -1){
			out.write(b,0,len);
			curr += len;
			setDownloadPercent((int)((curr * 100) / max));
		}
		out.flush();
		out.close();
		in.close();
		return ret;
		}catch(Exception e){
			handleException(e);
				ret.delete();
			return null;
		}
	}
}
[/code]
Remove all other traces of cache updating you used in the past

Open client.java and search
[code]
void startUp()
[/code]

Under the first { add 
[code]
new UpdateCache(this).run();
[/code]

On your webhost make sure you have the cacheVersion.txt uploaded with the correct cache version.

Any questions ask. Post errors etc



Okay so i&#39;ve had so many issues with people saying this doesent work
Go into your file folder settings in control panel and change the way your folders display to &#39;Details&#39; for all folders DONT CLOSE
While inside folder options go to the check boxes and allow hidden files and system files to be shown
After that go through your cache, every folder and delete the file called &#39;Thumbs.db&#39; that will most likely make this not work</description>
    
    <lastBuildDate>Tue, 12 Jun 2012 23:56:57 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@badger41 badger41]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/badger41">@badger41</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="5" data-topic="444355">
<div class="title">
<div class="quote-controls"></div>
 mod cody:</div>
<blockquote>
<p>First off its CRC32 not ‘update server’ second. You need to null out a couple lines and this updates itself. People who don’t know java and post ignorant shit, stfu.</p>
</blockquote>
</aside>
<p>rofl looks like you should stfu then</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/6</link>
        <pubDate>Tue, 12 Jun 2012 23:56:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-6</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@mod_cody mod cody]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mod_cody">@mod_cody</a> wrote:</p>
          <blockquote>
              <p>First off its CRC32 not ‘update server’ second. You need to null out a couple lines and this updates itself. People who don’t know java and post ignorant shit, stfu.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/5</link>
        <pubDate>Tue, 12 Jun 2012 18:00:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-5</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@badger41 badger41]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/badger41">@badger41</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="3" data-topic="444355">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/tranomo/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> tranomo:</div>
<blockquote>
<p>it’l be perfect when it autoupdates without asking. As RuneScape’s client does. That’s the only thing i see wrong with this (just judging by the pictures) kudos to whoever is programing it!</p>
</blockquote>
</aside>
<p>whatd be perfect is people learn how to use update servers so the whole cache doesnt need to be downloaded</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/4</link>
        <pubDate>Tue, 12 Jun 2012 04:58:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-4</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@tranomo tranomo]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tranomo">@tranomo</a> wrote:</p>
          <blockquote>
              <p>it’l be perfect when it autoupdates without asking. As RuneScape’s client does. That’s the only thing i see wrong with this (just judging by the pictures) kudos to whoever is programing it!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/3</link>
        <pubDate>Tue, 12 Jun 2012 00:45:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-3</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@rukin1 rukin1]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rukin1">@rukin1</a> wrote:</p>
          <blockquote>
              <p><img src="http://www.thesmallnews.org/screenies/Vkpu98H.png" alt width="" height=""><br>
works <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/2</link>
        <pubDate>Mon, 11 Jun 2012 09:29:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-2</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
      <item>
        <title>[RENAMED]Perfect UpdateCache[Noob Friendly]</title>
        <dc:creator><![CDATA[@mod_cody mod cody]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mod_cody">@mod_cody</a> wrote:</p>
          <blockquote>
              <p>Thanks to Kurt Cobain for the original <a data-bbcode="true">post</a></p>
<p>NOTE:<br>
Please I beg you allow system files to be seen from control panel &gt; folder options. In the list with check boxes.<br>
DELETE Thumbs.db FROM EVERY folder in your cache, if you dont see it in a folder dont keep looking, it’s not there move on…</p>
<p>Much simpler works amazing!<br>
Stupid GUI is removed and integrated into to the loading bar</p>
<p>Updating<br>
<img src="http://runehilation.com/images/cacheupdating.png" alt width="" height=""><br>
Downloading Cache<br>
<img src="http://runehilation.com/images/cachedownloading.png" alt width="" height=""><br>
Extracting Cache<br>
<img src="http://runehilation.com/images/extractingcache.png" alt width="" height=""></p>
<p>Example of cacheVersion.txt</p>
<pre><code class="lang-auto">1.0</code></pre>
<p>Create a file called “UpdateCache.java” inside your source add this</p>
<pre><code class="lang-auto">import java.net.URL;
import java.net.URLConnection;
import java.util.zip.*;
import sign.signlink;
import java.io.*;
import javax.swing.JOptionPane;

public class UpdateCache implements Runnable {

	public static final String ZIP_URL = "http://YOUR_SITE.com/cache.zip";
	public static final String VERSION_URL = "http://YOUR_SITE.com/cacheVersion.txt";
	public static final String VERSION_FILE = sign.signlink.findcachedir()+"cacheVersion.dat";
	private client client;
	client frame;
    public UpdateCache(client client) {
                this.client = client;
    }
		
    private void drawLoadingText(int amount, String text) {
                client.drawLoadingText(amount, text);
    }
	
	public double getCurrentVersion(){
		try {
			BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(VERSION_FILE)));
			return Double.parseDouble(br.readLine());
		} catch (Exception e) {
			return 0.1;
		}
	}
	
	public double getNewestVersion(){
		try {
			URL tmp = new URL(VERSION_URL);
			BufferedReader br = new BufferedReader(new InputStreamReader(tmp.openStream()));
			return Double.parseDouble(br.readLine());
		} catch (Exception e) {
			handleException(e);
			return -1;
		}
	}
	
	private void handleException(Exception e){
		StringBuilder strBuff = new StringBuilder();
		strBuff.append("Please Screenshot this message, and send it to an admin!\r\n\r\n");
        StringBuilder append = strBuff.append(e.getClass().getName()).append(" \"").append(e.getMessage()).append("\"\r\n");
		for(StackTraceElement s : e.getStackTrace())
			strBuff.append(s.toString()).append("\r\n");
		alert("Exception [" + e.getClass().getSimpleName() + "]",strBuff.toString(),true);
	}
	
	private void alert(String msg){
		alert("Message",msg,false);
	}
	
	private void alert(String title,String msg,boolean error){
		JOptionPane.showMessageDialog(null,
			   msg,
			   title,
			    (error ? JOptionPane.ERROR_MESSAGE : JOptionPane.PLAIN_MESSAGE));
	}
	
	@Override
	public void run() {
	drawLoadingText(0, "Checking Versions");
		try{
		double newest = getNewestVersion();
		if(newest &gt; this.getCurrentVersion()){
			int n = JOptionPane.showConfirmDialog(
				    null,
				    "There is an update to version " + newest + "\n" +
					"Would you like to update?",
				    "Current version: "+ getCurrentVersion(),
				    JOptionPane.YES_NO_OPTION);
			if(n == 0){
				updateClient();
				drawLoadingText(0, "Cache has been updated, please restart the client!");
				alert("Cache has been updated, please restart the client!");
				OutputStream out = new FileOutputStream(VERSION_FILE);
				out.write(String.valueOf(newest).getBytes());;
				System.exit(0);
			}else{
				alert(" Your client may not load correct " +
				getCurrentVersion());
				//System.exit(0);
			}
		}
		}catch(Exception e){
			handleException(e);
		}
	}
	
	private void updateClient() {
		File clientZip = downloadClient();
		if(clientZip != null){
		unZip(clientZip);
		}
	}
	
	private void unZip(File clientZip) {
		try {
			unZipFile(clientZip,new File(sign.signlink.findcachedir()));
			clientZip.delete();
		} catch (IOException e) {
			handleException(e);
		}
	}
	
	private void unZipFile(File zipFile,File outFile) throws IOException{
		ZipInputStream zin = new ZipInputStream(new BufferedInputStream(new FileInputStream(zipFile)));
		ZipEntry e;
		long max = 0;
		long curr = 0;
		while((e = zin.getNextEntry()) != null)
			max += e.getSize();
		zin.close();
		ZipInputStream in = new ZipInputStream(new BufferedInputStream(new FileInputStream(zipFile)));
		while((e = in.getNextEntry()) != null){
			if(e.isDirectory())
				new File(outFile,e.getName()).mkdirs();
			else{
				FileOutputStream out = new FileOutputStream(new File(outFile,e.getName()));
				byte[] b = new byte[1024];
				int len;
				while((len = in.read(b,0,b.length)) &gt; -1){
					curr += len;
						out.write(b, 0, len);
						setUnzipPercent((int)((curr * 100) / max));
				}
				out.flush();
				out.close();
			}
		}
	}

	public int percent = 0;
	
	public void setDownloadPercent(int amount){
	        percent = amount;
			drawLoadingText(amount, "Downloading Cache" + " - " + amount + "%");
	}
	
	public int percent2 = 0;
	
	public void setUnzipPercent(int amount2){
	        percent2 = amount2;
			drawLoadingText(amount2, "Extracting Cache" + " - " + amount2 + "%");
	}

	private File downloadClient(){
		File ret = new File(signlink.findcachedir()+"cache.zip");
		try{
		OutputStream out = new FileOutputStream(ret);
		URLConnection conn = new URL(ZIP_URL).openConnection();
		InputStream in = conn.getInputStream();
		long max = conn.getContentLength();
		long curr = 0;
		byte[] b = new byte[1024];
		int len;
		while((len = in.read(b, 0, b.length)) &gt; -1){
			out.write(b,0,len);
			curr += len;
			setDownloadPercent((int)((curr * 100) / max));
		}
		out.flush();
		out.close();
		in.close();
		return ret;
		}catch(Exception e){
			handleException(e);
				ret.delete();
			return null;
		}
	}
}</code></pre>
<p>Remove all other traces of cache updating you used in the past</p>
<p>Open client.java and search</p>
<pre><code class="lang-auto">void startUp()</code></pre>
<p>Under the first { add</p>
<pre><code class="lang-auto">new UpdateCache(this).run();</code></pre>
<p>On your webhost make sure you have the cacheVersion.txt uploaded with the correct cache version.</p>
<p>Any questions ask. Post errors etc</p>
<p>Okay so i’ve had so many issues with people saying this doesent work<br>
Go into your file folder settings in control panel and change the way your folders display to ‘Details’ for all folders DONT CLOSE<br>
While inside folder options go to the check boxes and allow hidden files and system files to be shown<br>
After that go through your cache, every folder and delete the file called ‘Thumbs.db’ that will most likely make this not work</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355/1</link>
        <pubDate>Fri, 08 Jun 2012 02:55:25 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-444355-1</guid>
        <source url="https://forum.moparisthebest.com/t/renamed-perfect-updatecache-noob-friendly/444355.rss">[RENAMED]Perfect UpdateCache[Noob Friendly]</source>
      </item>
  </channel>
</rss>
