<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Simple and effective Upload Script</title>
    <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935</link>
    <description>[code]&lt;?php
function generateCode($characters){
	$possible = &#39;23456789bcdfghjkmnpqrstvwxyz&#39;;
	$code = &#39;&#39;;
	$i = 0;
	while($i &lt;= $characters){
		$code .= substr($possible, mt_rand(0, strlen($possible) - 1),1);
		$i++;
	}
	return $code;
}

if(isset($_POST[&#39;MAX_FILE_SIZE&#39;])){
	$file = explode(&#39;.&#39;,$_FILES[&#39;file&#39;][&#39;name&#39;]);
	if(count($file) &lt;= 2){
		$code = generateCode(5);
		$fileName = $file[0].&#39;-&#39;.$code.&#39;.&#39;.$file[1];
		$target = &#39;images/&#39;.$fileName;
		switch($_FILES[&#39;file&#39;][&#39;type&#39;]){
			case &#39;image/gif&#39;:
			case &#39;image/jpg&#39;:
			case &#39;image/jpeg&#39;:
			case &#39;image/png&#39;:
				if(@move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;],$target)){
					echo &#39;The file &#39;.$file[0].&#39;.&#39;.$file[1].&#39; has been uploaded.&lt;br&gt;&#39;;
					echo &#39;You can find it at &lt;a href=&quot;http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].&#39;/&#39;.$target.&#39;&quot;&gt;this link&lt;/a&gt; (http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].&#39;/&#39;.$target.&#39;).&#39;;
					header(&#39;Location: http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&#39;?nfn=&#39;.base64_encode(urlencode($target)).&#39;&amp;ofn=&#39;.base64_encode(urlencode($file[0].&#39;.&#39;.$file[1])));
				} else {
					header(&#39;Location: http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&#39;?e=3&#39;);
				}
			break;
			default:
				header(&#39;Location: http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&#39;?e=2&#39;);
			break;
		}
	} else {
		header(&#39;Location: http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].$_SERVER[&#39;SCRIPT_NAME&#39;].&#39;?e=1&#39;);
	}
} else {
	if(isset($_GET[&#39;e&#39;])){
		switch($_GET[&#39;e&#39;]){
			case 1:
			case 2:
				echo &#39;&lt;div&gt;That filetype isn\&#39;t allowed!&lt;/div&gt;&#39;;
			break;
			case 3:
				echo &#39;&lt;div&gt;There was an error uploading the file, please try again.&lt;/div&gt;&#39;;
			break;
			default:
			break;
		}
	} elseif(isset($_GET[&#39;nfn&#39;]) &amp;&amp; isset($_GET[&#39;ofn&#39;])){
		$nfn = urldecode(base64_decode($_GET[&#39;nfn&#39;])); // New filename
		$ofn = urldecode(base64_decode($_GET[&#39;ofn&#39;])); // Original filename
		echo &#39;&lt;div&gt;The file &#39;.$ofn.&#39; has been uploaded.&lt;br&gt;&#39;;
		echo &#39;You can find it at &lt;a href=&quot;http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].&#39;/&#39;.$nfn.&#39;&quot;&gt;this link&lt;/a&gt; (http://&#39;.$_SERVER[&#39;HTTP_HOST&#39;].&#39;/&#39;.$nfn.&#39;).&lt;/div&gt;&#39;;
	}
	echo &#39;Accepted types: png, jpg, jpeg, gif&#39;;
	echo &#39;&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;upload.php&quot; method=&quot;post&quot;&gt;&#39;;
	echo &#39;&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;100000&quot;&gt;&#39;;
	echo &#39;&lt;input name=&quot;file&quot; type=&quot;file&quot;&gt;&lt;br&gt;&#39;;
	echo &#39;&lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;&#39;;
	echo &#39;&lt;/form&gt;&#39;;
}
?&gt;[/code]

This is a simple and effective upload script I&#39;ve writen in PHP. Currently, it&#39;s used to upload strictly jpg/jpeg/png/gif images.

What the script does (unedited):

[ul][li]Checks to make sure there&#39;s no more than one extension to the file (i.e. image.jpg.gif cannot be uploaded).[/li]
[li]Does a switch statement on the mime-types to make sure they&#39;re valid.[/li]
[li]When uploaded, is placed into a directory and adds a randomized five-character alphanumerical value to keep images from being overwritten.[/li]
[li]When the image is submitted, the user is directly moved to a new page. This prevents the user from refreshing the page and continuously re-upload the image with the same $_POST data. This is a particularly the biggest mistake in a large majority of upload scripts I&#39;ve encountered.[/li][/ul]


The only thing I can see as a small flaw in this script is the information displayed that the image name submitted was uploaded to the directory with the five character key at the end. This isn&#39;t any sort of flaw to the way the image uploads or the security of it though.

Enjoy.</description>
    
    <lastBuildDate>Fri, 23 May 2008 16:24:51 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“MastrChief, post:24, topic:206935”]I used mine =\</p>
<p>Its probably more simple than yours, but if you want to see the source, I can post it.</p>
<p>I like your little errors bit, I would have never thought of it.[/quote]</p>
<p>Yeah, errors are a good thing to keep track of. You <span class="bbcode-b">NEVER</span> want to leave a user on a page which has $_POST data sent, because the user can just constantly refresh and upload the same file continuously.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/25">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/25</link>
        <pubDate>Fri, 23 May 2008 16:24:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-25</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@MastrChief MastrChief]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mastrchief">@MastrChief</a> wrote:</p>
          <blockquote>
              <p>I used mine =\</p>
<p>Its probably more simple than yours, but if you want to see the source, I can post it.</p>
<p>I like your little errors bit, I would have never thought of it.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/24">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/24</link>
        <pubDate>Fri, 23 May 2008 11:13:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-24</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“MastrChief, post:22, topic:206935”][quote author=Zachera link=topic=272812.msg2238365#msg2238365 date=1211526104]<br>
That’d also grab the example Uriko provided:<br>
“my.homepictures.jpg”<br>
[/quote]</p>
<p>Actually, it wouldn’t. Since it searches for the <span class="bbcode-i">last</span> dot within the string and then removes everything else, it would return “jpg”.</p>
<p>Edit: Here lies an example image I used with the dots:</p>
<p><a href="http://www.chatshack.us/Frame/upload/fail.at.failing1331.jpg" class="onebox" target="_blank" rel="nofollow noopener">http://www.chatshack.us/Frame/upload/fail.at.failing1331.jpg</a></p>
<p>Original name: fail.at.failing.jpg[/quote]</p>
<p>Ah, my bad. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>Is that my upload script by the way? (modified obviously)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/23">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/23</link>
        <pubDate>Fri, 23 May 2008 09:45:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-23</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@MastrChief MastrChief]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mastrchief">@MastrChief</a> wrote:</p>
          <blockquote>
              <p>[quote=“Zachera, post:21, topic:206935”]That’d also grab the example Uriko provided:<br>
“my.homepictures.jpg”[/quote]</p>
<p>Actually, it wouldn’t. Since it searches for the <span class="bbcode-i">last</span> dot within the string and then removes everything else, it would return “jpg”.</p>
<p>Edit: Here lies an example image I used with the dots:</p>
<p><a href="http://www.chatshack.us/Frame/upload/fail.at.failing1331.jpg" class="onebox" target="_blank" rel="nofollow noopener">http://www.chatshack.us/Frame/upload/fail.at.failing1331.jpg</a></p>
<p>Original name: fail.at.failing.jpg</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/22">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/22</link>
        <pubDate>Fri, 23 May 2008 07:59:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-22</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“MastrChief, post:20, topic:206935”]You <span class="bbcode-i">could</span> do something like this</p>
<p><code>
$Extension = substr(strrchr($File, "."), 1);</code></p>
<p>Which gets the characters after the last dot, then just check them against an array of allowed filetypes.[/quote]</p>
<p>That’d also grab the example Uriko provided:<br>
“my.homepictures.jpg”</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/21</link>
        <pubDate>Fri, 23 May 2008 07:01:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-21</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@MastrChief MastrChief]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mastrchief">@MastrChief</a> wrote:</p>
          <blockquote>
              <p>You <span class="bbcode-i">could</span> do something like this</p>
<p><code>
$Extension = substr(strrchr($File, "."), 1);</code></p>
<p>Which gets the characters after the last dot, then just check them against an array of allowed filetypes.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/20</link>
        <pubDate>Fri, 23 May 2008 05:44:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-20</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group quote-modified" data-post="1" data-topic="207218">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/magma828/40/6905_1.png" class="avatar"><a href="https://forum.moparisthebest.com/t/207218/1">On another topic</a>
</div>
<blockquote>
<p>Couldn’t someone do a mass request on any other file that happened to be on the server?</p>
</blockquote>
</aside>
<p>Yep.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/19</link>
        <pubDate>Thu, 22 May 2008 04:19:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-19</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group quote-modified" data-post="16" data-topic="206935">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/x19/40/5_6bca9977b612b7aeef77ba1ec1cd67b3.png" class="avatar"> x19:</div>
<blockquote>
<p>Nice work Zach, hope you dont mind if I use… I will leave appropriate credits.</p>
</blockquote>
</aside>
<p>Not at all! I love to contribute. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<aside class="quote no-group quote-modified" data-post="17" data-topic="206935">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/pwnd/40/5_6bca9977b612b7aeef77ba1ec1cd67b3.png" class="avatar"> Pwnd:</div>
<blockquote>
<p>[quote]This would be great for denying direct downloads of files/images… Smiley</p>
</blockquote>
</aside>
<p>Yes ^.^[/quote]<br>
And direct downloads can cause some server lag since someone could do a mass request on one file. <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=6" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/18</link>
        <pubDate>Thu, 22 May 2008 00:10:52 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-18</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <blockquote>This would be great for denying direct downloads of files/images.... Smiley</blockquote>
Yes ^.^
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/17</link>
        <pubDate>Wed, 21 May 2008 22:23:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-17</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@x19 x19]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/x19">@x19</a> wrote:</p>
          <blockquote>
              <p>Nice work Zach, hope you dont mind if I use… I will leave appropriate credits.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/16</link>
        <pubDate>Wed, 21 May 2008 19:49:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-16</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“Uriko, post:14, topic:206935”][quote author=Zachera link=topic=272812.msg2235551#msg2235551 date=1211396811]</p>
<p>[quote author=Uriko link=topic=272812.msg2235488#msg2235488 date=1211391767]</p>
<aside class="quote no-group">
<blockquote>
<aside class="quote no-group">
<blockquote>
<p>It’s kind of silly to block filenames with dots in them…</p>
</blockquote>
</aside>
<p>Well, from my experiences, I’ve never seen an image with two file extensions (i.e. image.two.extensions …).</p>
<p>This script isn’t strictly for images though, I can understand what you’re trying to point out. If you wanted to accept compressed files (tar.gz, zip, rar), then you would have to raise the 2 to 3 on the line that says “if(count($file) &lt;= 2)” so that it would accept the file array to have three indexes (“somefile”,“tar”,“gz”).<br>
[/quote]Just because there’s a dot in it, it doesn’t mean it has two extensions, it could’ve just been how the person named their image, eg. “my.birthday.jpg”</p>
</blockquote>
</aside>
<p>Hm, you make a point. But then again, we wouldn’t want to make some huge check for if the array from explosion has a bad extension; that’d make it look messy. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"><br>
[/quote]Or how about use a different approach?[/quote]</p>
<p>Well, you could also substr() the extension out, but that might not look too good.</p>
<p>I wrote this script without any ideas on optimization or making it the best as it could be. This script could obviously be done better, I just haven’t really dealt with it in that matter. This script works, it’s secure, but there are some bugs/flaws that prevent it from being the greatest.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/15</link>
        <pubDate>Wed, 21 May 2008 19:36:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-15</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@Uriko Uriko]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/uriko">@Uriko</a> wrote:</p>
          <blockquote>
              <p>[quote=“Zachera, post:13, topic:206935”][quote author=Uriko link=topic=272812.msg2235488#msg2235488 date=1211391767]</p>
<aside class="quote no-group">
<blockquote>
<aside class="quote no-group">
<blockquote>
<p>It’s kind of silly to block filenames with dots in them…</p>
</blockquote>
</aside>
<p>Well, from my experiences, I’ve never seen an image with two file extensions (i.e. image.two.extensions …).</p>
<p>This script isn’t strictly for images though, I can understand what you’re trying to point out. If you wanted to accept compressed files (tar.gz, zip, rar), then you would have to raise the 2 to 3 on the line that says “if(count($file) &lt;= 2)” so that it would accept the file array to have three indexes (“somefile”,“tar”,“gz”).<br>
[/quote]Just because there’s a dot in it, it doesn’t mean it has two extensions, it could’ve just been how the person named their image, eg. “my.birthday.jpg”</p>
</blockquote>
</aside>
<p>Hm, you make a point. But then again, we wouldn’t want to make some huge check for if the array from explosion has a bad extension; that’d make it look messy. :p[/quote]Or how about use a different approach?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/14</link>
        <pubDate>Wed, 21 May 2008 19:22:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-14</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[quote=“Uriko, post:12, topic:206935”][quote author=Zachera link=topic=272812.msg2234031#msg2234031 date=1211318840]</p>
<aside class="quote no-group">
<blockquote>
<p>It’s kind of silly to block filenames with dots in them…</p>
</blockquote>
</aside>
<p>Well, from my experiences, I’ve never seen an image with two file extensions (i.e. image.two.extensions …).</p>
<p>This script isn’t strictly for images though, I can understand what you’re trying to point out. If you wanted to accept compressed files (tar.gz, zip, rar), then you would have to raise the 2 to 3 on the line that says “if(count($file) &lt;= 2)” so that it would accept the file array to have three indexes (“somefile”,“tar”,“gz”).<br>
[/quote]Just because there’s a dot in it, it doesn’t mean it has two extensions, it could’ve just been how the person named their image, eg. “my.birthday.jpg”[/quote]</p>
<p>Hm, you make a point. But then again, we wouldn’t want to make some huge check for if the array from explosion has a bad extension; that’d make it look messy. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/13</link>
        <pubDate>Wed, 21 May 2008 19:06:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-13</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@Uriko Uriko]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/uriko">@Uriko</a> wrote:</p>
          <blockquote>
              <p>[quote=“Zachera, post:7, topic:206935”][quote author=k00dr link=topic=272812.msg2234014#msg2234014 date=1211317666]<br>
It’s kind of silly to block filenames with dots in them…<br>
[/quote]<br>
Well, from my experiences, I’ve never seen an image with two file extensions (i.e. image.two.extensions …).</p>
<p>This script isn’t strictly for images though, I can understand what you’re trying to point out. If you wanted to accept compressed files (tar.gz, zip, rar), then you would have to raise the 2 to 3 on the line that says “if(count($file) &lt;= 2)” so that it would accept the file array to have three indexes (“somefile”,“tar”,“gz”).[/quote]Just because there’s a dot in it, it doesn’t mean it has two extensions, it could’ve just been how the person named their image, eg. “my.birthday.jpg”</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/12</link>
        <pubDate>Wed, 21 May 2008 17:42:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-12</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@vortex vortex]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/vortex">@vortex</a> wrote:</p>
          <blockquote>
              <p>Maybe make it to rename UTF-8 characters to _ for example</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/11</link>
        <pubDate>Wed, 21 May 2008 16:10:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-11</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group quote-modified" data-post="1" data-topic="207001">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/magma828/40/6905_1.png" class="avatar"><a href="https://forum.moparisthebest.com/t/207001/1">On another topic</a>
</div>
<blockquote>
<p>Why don’t you just use “time(‘Y-m-d’)” and two random letters at the end for the filename? Then even if two people upload a file at the exact same second, there will still be the random letters.</p>
</blockquote>
</aside>
<p>Good input. Although, this would be more useful for, like I said above, a production use (1,000+ uploads a day).</p>
<aside class="quote no-group" data-post="8" data-topic="206935">
<div class="title">
<div class="quote-controls"></div>
 marc is hood:</div>
<blockquote>
<p>It would be good to add like .jar or .php or more like that for everything but also it would be fine to just put pictures so it wont be as hard for people to use photobucket or imageshack.</p>
</blockquote>
</aside>
<p>Easy: add more mime-types, but be VERY CAREFUL. Some can harm your webserver, obviously.</p>
<p>[quote=“magma828, post:1, topic:207024”][quote author=marc is hood link=topic=272812.msg2234461#msg2234461 date=1211335895]<br>
It would be good to add like .jar or .php or more like that for everything but also it would be fine to just put pictures so it wont be as hard for people to use photobucket or imageshack.<br>
[/quote]<br>
Allowing people to upload php files would be suicide[/quote]<br>
I found a neat trick with the webserver though, don’t think php can harm your webserver just yet! <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> I’ve only figured out how to do this in Apache, and I’m looking into it for lightTPD. You could easily disable php parsing in the uploads script, and for that matter, disable every possible parsing avaiable, and set all the mime-types to application/octet-stream, forcing the user to download the file.</p>
<p>[quote=“Pwnd, post:9, topic:206935”]I store file data in a database (Not the actual file.  Just the name, id, etc) and I rename the file before saying to:<br>
[file_id]|[extension].<br>
That way, as far as I know, I don’t have any problems and you can upload any file you wish.  Then when they want to download the file, it sends them the file they had uploaded without changing the file name on the server.[/quote]<br>
This would be great for denying direct downloads of files/images… <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/10</link>
        <pubDate>Wed, 21 May 2008 06:16:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-10</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <p>I store file data in a database (Not the actual file.  Just the name, id, etc) and I rename the file before saying to:<br>
[file_id]|[extension].<br>
That way, as far as I know, I don’t have any problems and you can upload any file you wish.  Then when they want to download the file, it sends them the file they had uploaded without changing the file name on the server.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/9</link>
        <pubDate>Wed, 21 May 2008 03:19:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-9</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@marc_is_hood marc is hood]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/marc_is_hood">@marc_is_hood</a> wrote:</p>
          <blockquote>
              <p>It would be good to add like .jar or .php or more like that for everything but also it would be fine to just put pictures so it wont be as hard for people to use photobucket or imageshack.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/8</link>
        <pubDate>Wed, 21 May 2008 02:11:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-8</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group quote-modified" data-post="6" data-topic="206935">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/k00dr/40/5_6bca9977b612b7aeef77ba1ec1cd67b3.png" class="avatar"> k00dr:</div>
<blockquote>
<p>It’s kind of silly to block filenames with dots in them…</p>
</blockquote>
</aside>
<p>Well, from my experiences, I’ve never seen an image with two file extensions (i.e. image.two.extensions …).</p>
<p>This script isn’t strictly for images though, I can understand what you’re trying to point out. If you wanted to accept compressed files (tar.gz, zip, rar), then you would have to raise the 2 to 3 on the line that says “if(count($file) &lt;= 2)” so that it would accept the file array to have three indexes (“somefile”,“tar”,“gz”).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/7</link>
        <pubDate>Tue, 20 May 2008 21:27:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-7</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@k00dr k00dr]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/k00dr">@k00dr</a> wrote:</p>
          <blockquote>
              <p>It’s kind of silly to block filenames with dots in them…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/6</link>
        <pubDate>Tue, 20 May 2008 21:07:46 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-6</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>It would deny it because when the filename is “exploded” by the dots (exploit.php.jpg -&gt; array (“exploit”,“php”,“jpg”)), the file would notice that the array size was greater than two, thus causing it to return “That filetype isn’t allowed!” (error 1).</p>
<p>Also, in case you wonder if it would accept an extension-less file, it won’t. The mime-type has to be image/jpg, image/jpeg, image/png, or image.gif. <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=6" title=":wink:" class="emoji" alt=":wink:"></p>
<p>EDIT: If the if(count($file) &lt;= 2) line were to be removed, depending on the mime-type, it could get denied as well. If you start with a jpg image and change the extension to .php, it might accept it, but I highly doubt this.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/5</link>
        <pubDate>Tue, 20 May 2008 19:01:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-5</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@Uriko Uriko]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/uriko">@Uriko</a> wrote:</p>
          <blockquote>
              <p>Just a question, say I upload a file called “exploit.php.jpg”, how would your script react?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/4</link>
        <pubDate>Tue, 20 May 2008 18:54:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-4</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>Yeah, that is another flaw, but it’s a very rare occurance for mt_rand() to say the same randomized value twice. If anyone were to take this onto a serious basis (1,000+ uploads a day), then they would run into this occurance maybe once in a week/month.</p>
<p>A simple fix to this would be to add more characters at the end, or do an even more randomized value, maybe including every letter in the alphabet. As you can see, I’ve excluded vowels therefore preventing it from possibly generating a value as a word (i.e. image-a55e5.jpg, image-usk22.jpg, etc.).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/3</link>
        <pubDate>Tue, 20 May 2008 16:14:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-3</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@sonny_bill_9 ``jason]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sonny_bill_9">@sonny_bill_9</a> wrote:</p>
          <blockquote>
              <p>Great work, i can see another flaw though, If the randomized letters/numbers are already used then it will over write the file.<br>
Small chance though <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/2</link>
        <pubDate>Tue, 20 May 2008 15:55:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-2</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
      <item>
        <title>Simple and effective Upload Script</title>
        <dc:creator><![CDATA[@z z]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/z">@z</a> wrote:</p>
          <blockquote>
              <p>[code]&lt;?php<br>
function generateCode($characters){<br>
$possible = ‘23456789bcdfghjkmnpqrstvwxyz’;<br>
$code = ‘’;<br>
$i = 0;<br>
while($i &lt;= $characters){<br>
$code .= substr($possible, mt_rand(0, strlen($possible) - 1),1);<br>
$i++;<br>
}<br>
return $code;<br>
}</p>
<p>if(isset($_POST[‘MAX_FILE_SIZE’])){<br>
$file = explode(’.’,$_FILES[‘file’][‘name’]);<br>
if(count($file) &lt;= 2){<br>
$code = generateCode(5);<br>
$fileName = $file[0].’-’.$code.’.’.$file[1];<br>
$target = ‘images/’.$fileName;<br>
switch($_FILES[‘file’][‘type’]){<br>
case ‘image/gif’:<br>
case ‘image/jpg’:<br>
case ‘image/jpeg’:<br>
case ‘image/png’:<br>
if(<span class="mention">@move_uploaded_file</span>($_FILES[‘file’][‘tmp_name’],$target)){<br>
echo ‘The file ‘.$file[0].’.’.$file[1].’ has been uploaded.<br>’;<br>
echo ‘You can find it at <a>this link</a> (http://’.$_SERVER[‘HTTP_HOST’].’/’.$target.’).’;<br>
header(‘Location: http://’.$_SERVER[‘HTTP_HOST’].$_SERVER[‘SCRIPT_NAME’].’?nfn=’.base64_encode(urlencode($target)).’&amp;ofn=’.base64_encode(urlencode($file[0].’.’.$file[1])));<br>
} else {<br>
header(‘Location: http://’.$_SERVER[‘HTTP_HOST’].$_SERVER[‘SCRIPT_NAME’].’?e=3’);<br>
}<br>
break;<br>
default:<br>
header(‘Location: http://’.$_SERVER[‘HTTP_HOST’].$_SERVER[‘SCRIPT_NAME’].’?e=2’);<br>
break;<br>
}<br>
} else {<br>
header(‘Location: http://’.$_SERVER[‘HTTP_HOST’].$_SERVER[‘SCRIPT_NAME’].’?e=1’);<br>
}<br>
} else {<br>
if(isset($_GET[‘e’])){<br>
switch($_GET[‘e’]){<br>
case 1:<br>
case 2:<br>
echo ‘</p><div>That filetype isn’t allowed!</div>’;<br>
break;<br>
case 3:<br>
echo ‘<div>There was an error uploading the file, please try again.</div>’;<br>
break;<br>
default:<br>
break;<br>
}<br>
} elseif(isset($_GET[‘nfn’]) &amp;&amp; isset($_GET[‘ofn’])){<br>
$nfn = urldecode(base64_decode($_GET[‘nfn’])); // New filename<br>
$ofn = urldecode(base64_decode($_GET[‘ofn’])); // Original filename<br>
echo ‘<div>The file ‘.$ofn.’ has been uploaded.<br>’;<br>
echo ‘You can find it at <a>this link</a> (http://’.$_SERVER[‘HTTP_HOST’].’/’.$nfn.’).</div>’;<br>
}<br>
echo ‘Accepted types: png, jpg, jpeg, gif’;<br>
echo ‘’;<br>
echo ‘’;<br>
echo ‘<br>’;<br>
echo ‘’;<br>
echo ‘’;<br>
}<br>
?&gt;[/code]
<p>This is a simple and effective upload script I’ve writen in PHP. Currently, it’s used to upload strictly jpg/jpeg/png/gif images.</p>
<p>What the script does (unedited):</p>
<p>[ul][li]Checks to make sure there’s no more than one extension to the file (i.e. image.jpg.gif cannot be uploaded).[/li]<br>
[li]Does a switch statement on the mime-types to make sure they’re valid.[/li]<br>
[li]When uploaded, is placed into a directory and adds a randomized five-character alphanumerical value to keep images from being overwritten.[/li]<br>
[li]When the image is submitted, the user is directly moved to a new page. This prevents the user from refreshing the page and continuously re-upload the image with the same $_POST data. This is a particularly the biggest mistake in a large majority of upload scripts I’ve encountered.[/li][/ul]</p>
<p>The only thing I can see as a small flaw in this script is the information displayed that the image name submitted was uploaded to the directory with the five character key at the end. This isn’t any sort of flaw to the way the image uploads or the security of it though.</p>
<p>Enjoy.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935/1</link>
        <pubDate>Tue, 20 May 2008 15:13:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-206935-1</guid>
        <source url="https://forum.moparisthebest.com/t/simple-and-effective-upload-script/206935.rss">Simple and effective Upload Script</source>
      </item>
  </channel>
</rss>
