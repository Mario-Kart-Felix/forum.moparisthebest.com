<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/c-and-lua-console-game-creator/401932 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 15:24:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>C and lua console game creator - General Programming - moparisthebest.com</title>
    <meta name="description" content="hi i was bored and decided to do some experimental things with lua and C.  so the reason i posted this was maybe because somebody wants to review my code or use it?  i don&amp;#39;t know, but  it&amp;#39;s very simple, and very cool (ta&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="401932.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;C and lua console game creator&#39;" href="401932.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/c-and-lua-console-game-creator/401932" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/c-and-lua-console-game-creator/401932" />
<meta property="og:title" content="C and lua console game creator" />
<meta name="twitter:title" content="C and lua console game creator" />
<meta property="og:description" content="hi i was bored and decided to do some experimental things with lua and C.  so the reason i posted this was maybe because somebody wants to review my code or use it?  i don’t know, but  it’s very simple, and very cool (talking about lua not the program itself)  so basically you just write a script (game) while C handles all of the “low-level” stuff for you but you can choose what you want to do with the supplied functions i’ve made public to the script.  then you edit the config file and define w..." />
<meta name="twitter:description" content="hi i was bored and decided to do some experimental things with lua and C.  so the reason i posted this was maybe because somebody wants to review my code or use it?  i don’t know, but  it’s very simple, and very cool (talking about lua not the program itself)  so basically you just write a script (game) while C handles all of the “low-level” stuff for you but you can choose what you want to do with the supplied functions i’ve made public to the script.  then you edit the config file and define w..." />
<meta property="article:published_time" content="2011-07-02T06:32:07+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="401932.html">C and lua console game creator</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Tu1.html'><span itemprop='name'>Tu1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-02T06:32:07Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:49:38Z' class='post-time'>
              August 1, 2016, 12:49pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>hi i was bored and decided to do some experimental things with lua and C.  so the reason i posted this was maybe because somebody wants to review my code or use it?  i don’t know, but  it’s very simple, and very cool (talking about lua not the program itself)</p>
<p>so basically you just write a script (game) while C handles all of the “low-level” stuff for you but you can choose what you want to do with the supplied functions i’ve made public to the script.  then you edit the config file and define what script you are going to use and that’s it.</p>
<p>i wrote some scripts and put them in there just for you to see<br>
i don’t really know what your limitations are…lua has a nice library</p>
<p>here is all of the source code:</p>
<p>compressed:<br>
<a href="http://uppit.com/l29pqslccv26/lua.tar.gz" class="onebox" target="_blank" rel="nofollow noopener">http://uppit.com/l29pqslccv26/lua.tar.gz</a></p>
<p>main.c</p>
<pre><code class="lang-auto">#include "Global.h"

/*
 * The main function
 */
int main(int argc, char *argv[])
{
  // Store for player input
  char input[64];
  
  // Initialize
  if(Init())
  {
    // Retrieve the lua function on game initialization
    lua_getglobal(L, "OnGameStart");
    
    // Check if the retrieved function is a function
    if(lua_isfunction(L, lua_gettop(L))) // The function on the top of the stack
    {
      lua_call(L, 0, 0); // Call the function - 0 arguments, 0 returns
    }
    else
    {
      printf("Error: Function does not exist or is not a function\n");
    }
  }

  // The game loop
  while(Running)
  {
    printf("In: ");
    
    // Record player input
    fgets(input, 64, stdin);
    String_StripChar(input);
    
    lua_getglobal(L, "OnPlayerInput");
    
    if(lua_isfunction(L, lua_gettop(L)))
    {
      lua_pushstring(L, input);
      lua_call(L, 1, 0);
    }
    else
    {
      printf("Error: Function does not exist or is not a function\n");
      Running = 0;
    }
  }
  
  lua_getglobal(L, "OnGameEnd");
  
  if(lua_isfunction(L, lua_gettop(L)))
  {
    lua_call(L, 0, 0);
  }
  else
  {
    printf("Error: Function does not exist or is not a function\n");
  }
  
  return Clean();
}</code></pre>
<p>global.h</p>
<pre><code class="lang-auto">#ifndef GLOBAL_H
#define GLOBAL_H

#define CONFIG_FILE_NAME "Config.txt"

#ifdef _cplusplus
extern "C" {
#endif

#include "Utils.h"

// Lua
#include "lua5.1/lua.h"
#include "lua5.1/lualib.h"
#include "lua5.1/lauxlib.h"

extern lua_State *L;
extern int Running;
extern char *PlayerName;

extern int Init();
extern int Clean();
extern int SetGameRunning(lua_State*);
extern int IsGameRunning(lua_State*);
extern int SetPlayerName(lua_State*);
extern int GetPlayerName(lua_State*);

#ifdef _cplusplus
}
#endif

#endif</code></pre>
<p>global.c</p>
<pre><code class="lang-auto">#include "Global.h"

/*
 * The lua interpereter.
 */
lua_State *L = NULL;

/*
 * The game running flag
 */
int Running;

/*
 * The player's name
 */
char *PlayerName = NULL;

/*
 * Initialize
 */
int Init()
{
  // Running is true
  Running = 1;
  
  // The config file
  FILE *cfg = fopen(CONFIG_FILE_NAME, "r");
  char script[64];
  
  if(!cfg)
  {
    return 0;
  }
  
  fscanf(cfg, "CONFIG_FILE:%s", script);
  fclose(cfg);
  
  // Open the lua api
  L = lua_open();
  
  luaL_openlibs(L); // Open the lua library
  luaL_dofile(L, script); // Execute the script
  
  // Register these functions
  lua_register(L, "SetGameRunning", SetGameRunning);
  lua_register(L, "IsGameRunning", IsGameRunning);
  lua_register(L, "SetPlayerName", SetPlayerName);
  lua_register(L, "GetPlayerName", GetPlayerName);
  
  return 1;
}

/*
 * Clean up
 */
int Clean()
{
  // Close the lua interpereter
  lua_close(L);
  return 0;
}

/*
 * Sets the running flag to the passed in argument (int)
 */
int SetGameRunning(lua_State *L)
{
  int args = lua_gettop(L); // The amount of arguments
  
  if(args &gt; 0) // If there were arguments passed in the function
  {
    if(lua_isnumber(L, -args)) // If the passed in argument is a number
    {
      Running = (int) lua_tonumber(L, -args); // Optimize the variable
    }
    else
    {
      printf("Error: Argument must be a number\n");
    }
  }
  else
  {
    printf("Error: No arguments were passed in function\n");
  }
  
  return 0; // Nothing was given to the lua interpereter
}

/*
 * Returns the running flag
 */
int IsGameRunning(lua_State *L)
{
  lua_pushnumber(L, Running); // Push the number to the top of the stack
  
  return 1;
}

/*
 * Sets the player's name
 */
int SetPlayerName(lua_State *L)
{
  int args = lua_gettop(L);
  
  if(args &gt; 0)
  {
    if(lua_isstring(L, -args))
    {
      PlayerName = (char*) lua_tostring(L, -args);
    }
    else
    {
      printf("Error: Argument must be a number\n");
    }
  }
  else
  {
    printf("Error: No arguments were passed in function\n");
  }
  
  return 0;
}

/*
 * Returns the player's name
 */
int GetPlayerName(lua_State *L)
{
  lua_pushstring(L, PlayerName);
  
  return 1;
}</code></pre>
<p>utils.h</p>
<pre><code class="lang-auto">#ifndef UTILS_H
#define UTILS_H

#ifdef _cplusplus
extern "C" {
#endif

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

extern int String_StartsWith(char*, char*);
extern int String_StartsWith_IgnoreCase(char*, char*);
extern int String_StripChar(char*);

#ifdef _cplusplus
}
#endif

#endif</code></pre>
<p>utils.c</p>
<pre><code class="lang-auto">#include "Utils.h"

int String_StartsWith(char *s1, char *s2)
{
  if(strncmp(s1, s2, strlen(s2)) == 0)
  {
    return 1;
  }
  
  return 0;
}

int String_StartsWith_IgnoreCase(char *s1, char *s2)
{
  if(strncasecmp(s1, s2, strlen(s2)) == 0)
  {
    return 1;
  }
  
  return 0;
}

/*
 * I never got this to work yet but it strips the null terminator
 * from a string - useful for string you don't want the null terminator
 * in after using fgets or gets
 */
int String_StripChar(char *s)
{
  int i;
  
  for(i = 0; i &lt; (int) strlen(s); i++)
  {
    if(s[i] == '\n')
    {
      s[i] = '\0';
      break;
    }
  }
  
  return 1;
}</code></pre>
      </div>

      <meta itemprop='headline' content='C and lua console game creator'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Stupit.html'><span itemprop='name'>Stupit</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-02T09:24:23Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:49:44Z' class='post-time'>
              August 1, 2016, 12:49pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Interesting that you used lua to program something. It’s also interesting that you use lua with C.</p>
      </div>

      <meta itemprop='headline' content='C and lua console game creator'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/_s11.html'><span itemprop='name'>_s11</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-02T14:21:54Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:50:07Z' class='post-time'>
              August 1, 2016, 12:50pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>lol global variables</p>
      </div>

      <meta itemprop='headline' content='C and lua console game creator'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Tu1.html'><span itemprop='name'>Tu1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-03T04:42:57Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:51:24Z' class='post-time'>
              August 1, 2016, 12:51pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="_s, post:3, topic:401932"]lol global variables[/quote]i didn’t think encapsulation was necessary for something like this</p>
      </div>

      <meta itemprop='headline' content='C and lua console game creator'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/c-and-lua-console-game-creator/401932 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 15:24:51 GMT -->
</html>
