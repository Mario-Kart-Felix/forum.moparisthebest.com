<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[C++ / Java] QPixmap to jbyteArray</title>
    <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056</link>
    <description>Since I&#39;m new to this whole C++ thing, could anyone give an idea on how this is done. I&#39;m using the Qt library (by nokia?), so I can capture the screen, independant of the operating system. Any help is appreciated (mind the bad programming).

[b]Header:[/b]
[code]/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class Engine */

#ifndef _Included_Engine
#define _Included_Engine
#ifdef __cplusplus
extern &quot;C&quot; {
#endif
/*
 * Class:     Engine
 * Method:    captureScreen
 * Signature: (IIII)Ljava/lang/Object;
 */
JNIEXPORT jbyteArray JNICALL Java_Engine_captureScreen
  (JNIEnv *, jobject, jint, jint, jint, jint);

#ifdef __cplusplus
}
#endif
#endif[/code]

[b]Source:[/b]
[code]/* 
 * File:   Engine.cpp
 * Author: andrew
 * 
 * Created on 21 March 2012, 4:59 PM
 */

#include &quot;Engine.h&quot;
#include &lt;QPixmap&gt;
#include &lt;QApplication&gt;
#include &lt;QDesktopWidget&gt;
#include &lt;QByteArray&gt;
#include &lt;QBuffer&gt;

JNIEXPORT jbyteArray JNICALL Java_Engine_captureScreen
  (JNIEnv *env, jobject, jint x, jint y , jint w, jint h) {
    WId windowId = QApplication::desktop()-&gt;winId();
    QPixmap pixmap = QPixmap::grabWindow(windowId, x, y, w, h);
    QByteArray* array;
    QBuffer buffer(array);
    buffer.open(QBuffer::WriteOnly);
    pixmap.save(&amp;buffer, &quot;PNG&quot;, 100);
    
    // mind the bad programming
    // return byteArray;
}

[/code]</description>
    
    <lastBuildDate>Thu, 22 Mar 2012 18:16:19 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@_s11 s1gma]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_s11">@_s11</a> wrote:</p>
          <blockquote>
              <p>[quote=“Taharok, post:8, topic:437056”]Really depends how fast he needs to capture the screen. I recall the robot peer taking upwards of 200ms to take a full screen capture, with an windows x86 oracle java 6 implementation.[/quote]jeez</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/9</link>
        <pubDate>Thu, 22 Mar 2012 18:16:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-9</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@mod_taharok Taharok]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mod_taharok">@mod_taharok</a> wrote:</p>
          <blockquote>
              <p>Really depends how fast he needs to capture the screen. I recall the robot peer taking upwards of 200ms to take a full screen capture, with a windows x86 oracle java 6 implementation.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/8</link>
        <pubDate>Thu, 22 Mar 2012 17:54:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-8</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@_s11 s1gma]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/_s11">@_s11</a> wrote:</p>
          <blockquote>
              <p>is the Robot class really slow enough to warrant using the JNI and adding a dependency as big as Qt? perhaps the problem could be solved by firing off a thread purely for capturing the screen and saving it. try that if you haven’t already.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/7</link>
        <pubDate>Wed, 21 Mar 2012 17:28:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-7</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <p>[quote=“dain bramage, post:5, topic:437056”][quote author=imthenull link=topic=539772.msg3951441#msg3951441 date=1332317047]<br>
one question though, why are you using JNI to capture the screen, when it can be done using the Robot class?<br>
[/quote]<br>
Because the Robot class is as slow as a 1 legged dog on on tranquilizers.[/quote]<br>
touche… i can agree with that.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/6</link>
        <pubDate>Wed, 21 Mar 2012 08:32:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-6</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@dain_bramage dain bramage]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dain_bramage">@dain_bramage</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="4" data-topic="437056">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/imthenull/40/1273_1.png" class="avatar"> imthenull:</div>
<blockquote>
<p>one question though, why are you using JNI to capture the screen, when it can be done using the Robot class?</p>
</blockquote>
</aside>
<p>Because the Robot class is as slow as a 1 legged dog on on tranquilizers.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/5</link>
        <pubDate>Wed, 21 Mar 2012 08:20:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-5</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <p>one question though, why are you using JNI to capture the screen, when it can be done using the Robot class?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/4</link>
        <pubDate>Wed, 21 Mar 2012 08:04:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-4</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@dain_bramage dain bramage]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dain_bramage">@dain_bramage</a> wrote:</p>
          <blockquote>
              <p>Aha, with a few modifications it’s now working.<br>
Cheers mate.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/3</link>
        <pubDate>Wed, 21 Mar 2012 07:54:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-3</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <p>it looks like you are already capturing the desktop as a byte array - what exactly are you needing help with?</p>
<p>Edit: if it’s actually returning the byte array that you needed help with, then i have this for you</p>
<p>[code=cpp]/**</p>
<ul>
<li>
<p>Gets the current pixel array that has been rendered in C++<br>
*/<br>
JNIEXPORT jintArray JNICALL Java_org_rscdaemon_client_gfx_ImageCalculationCalls_getPixelArray<br>
(JNIEnv * env, jobject jobj)<br>
{<br>
int size = calc.getWidth() * calc.getHeight();<br>
jintArray result;<br>
result = env-&gt;NewIntArray(size);</p>
<pre><code>if (result == NULL)
{
     return NULL;
}

jint* fill = (jint*) calc.pixels;
env-&gt;SetIntArrayRegion(result, 0, size, fill);

return result;
</code></pre>
</li>
</ul>
<p>}[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/2</link>
        <pubDate>Wed, 21 Mar 2012 07:02:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-2</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
      <item>
        <title>[C++ / Java] QPixmap to jbyteArray</title>
        <dc:creator><![CDATA[@dain_bramage dain bramage]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/dain_bramage">@dain_bramage</a> wrote:</p>
          <blockquote>
              <p>Since I’m new to this whole C++ thing, could anyone give an idea on how this is done. I’m using the Qt library (by nokia?), so I can capture the screen, independant of the operating system. Any help is appreciated (mind the bad programming).</p>
<p><span class="bbcode-b">Header:</span></p>
<p>[code]/* DO NOT EDIT THIS FILE - it is machine generated <em>/<br>
<span class="hashtag">#include</span> &lt;jni.h&gt;<br>
/</em> Header for class Engine */</p>
<p><span class="hashtag">#ifndef</span> _Included_Engine<br>
<span class="hashtag">#define</span> _Included_Engine<br>
<span class="hashtag">#ifdef</span> __cplusplus<br>
extern “C” {<br>
<span class="hashtag">#endif</span><br>
/*</p>
<ul>
<li>Class:     Engine</li>
<li>Method:    captureScreen</li>
<li>Signature: (IIII)Ljava/lang/Object;<br>
*/<br>
JNIEXPORT jbyteArray JNICALL Java_Engine_captureScreen<br>
(JNIEnv *, jobject, jint, jint, jint, jint);</li>
</ul>
<p><span class="hashtag">#ifdef</span> __cplusplus<br>
}<br>
<span class="hashtag">#endif</span><br>
<span class="hashtag">#endif</span>[/code]</p>
<p><span class="bbcode-b">Source:</span></p>
<p>[code]/*</p>
<ul>
<li>File:   Engine.cpp</li>
<li>Author: andrew</li>
<li>
</li>
<li>Created on 21 March 2012, 4:59 PM<br>
*/</li>
</ul>
<p><span class="hashtag">#include</span> “Engine.h”<br>
<span class="hashtag">#include</span> <br>
<span class="hashtag">#include</span> <br>
<span class="hashtag">#include</span> <br>
<span class="hashtag">#include</span> <br>
<span class="hashtag">#include</span> </p>
<p>JNIEXPORT jbyteArray JNICALL Java_Engine_captureScreen<br>
(JNIEnv <em>env, jobject, jint x, jint y , jint w, jint h) {<br>
WId windowId = QApplication::desktop()-&gt;winId();<br>
QPixmap pixmap = QPixmap::grabWindow(windowId, x, y, w, h);<br>
QByteArray</em> array;<br>
QBuffer buffer(array);<br>
buffer.open(QBuffer::WriteOnly);<br>
pixmap.save(&amp;buffer, “PNG”, 100);</p>
<pre><code>// mind the bad programming
// return byteArray;
</code></pre>
<p>}</p>
<p>[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056/1</link>
        <pubDate>Wed, 21 Mar 2012 07:00:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-437056-1</guid>
        <source url="https://forum.moparisthebest.com/t/c-java-qpixmap-to-jbytearray/437056.rss">[C++ / Java] QPixmap to jbyteArray</source>
      </item>
  </channel>
</rss>
