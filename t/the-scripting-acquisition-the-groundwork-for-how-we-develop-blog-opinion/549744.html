<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/the-scripting-acquisition-the-groundwork-for-how-we-develop-blog-opinion/549744 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION] - Runescape - moparisthebest.com</title>
    <meta name="description" content="The official server has gone through a lot of iterations of how content is scripted. Originally, I had coupled the source with a Ruby plugin system. When I took my leave, David moved from this system to using static inst&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="549744.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]&#39;" href="549744.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/the-scripting-acquisition-the-groundwork-for-how-we-develop-blog-opinion/549744" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/the-scripting-acquisition-the-groundwork-for-how-we-develop-blog-opinion/549744" />
<meta property="og:title" content="The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]" />
<meta name="twitter:title" content="The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]" />
<meta property="og:description" content="The official server has gone through a lot of iterations of how content is scripted. Originally, I had coupled the source with a Ruby plugin system. When I took my leave, David moved from this system to using static instances written in Java. After I started my return I moved from Ruby to Lua for reasons of performance, and improved functionality. Now there is an discussion about using Groovy and or Lua.  To give a little background on content, we should look back to how various sources have don..." />
<meta name="twitter:description" content="The official server has gone through a lot of iterations of how content is scripted. Originally, I had coupled the source with a Ruby plugin system. When I took my leave, David moved from this system to using static instances written in Java. After I started my return I moved from Ruby to Lua for reasons of performance, and improved functionality. Now there is an discussion about using Groovy and or Lua.  To give a little background on content, we should look back to how various sources have don..." />
<meta property="article:published_time" content="2015-02-06T23:27:22+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="549744.html">The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-06T23:27:22Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:20:13Z' class='post-time'>
              August 4, 2016,  2:20pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The official server has gone through a lot of iterations of how content is scripted. Originally, I had coupled the source with a Ruby plugin system. When I took my leave, David moved from this system to using static instances written in Java. After I started my return I moved from Ruby to Lua for reasons of performance, and improved functionality. Now there is an discussion about using Groovy and or Lua.</p>
<p>To give a little background on content, we should look back to how various sources have done it in the past. I will discuss where those systems have failed, why, and what the optimal system is.</p>
<p><span class="bbcode-u">Traditional</span></p>
<p>The traditional system of doing content is presented in PI, Hyperion, and other popular sources. This system often created single instances of contexts that were handed a player variable or were done statically. These systems were simple but lacked proper hierarchy, the ability to provide timings, and proper flow. This traditional method also exemplified a very toxic code smell: <a href="http://unixjunkie.blogspot.com/2006/07/singleton-smell_25.html" data-bbcode="true" rel="nofollow noopener">link</a>. Even if you used a ‘content context’:</p>
<pre><code class="lang-auto">class Firemaking {
   Firemaking(You you) {
      this.you = you;
   }

   ... :|
}</code></pre>
<p>This could be boiled down to the singleton form:</p>
<pre><code class="lang-auto">class Firemaking {
  static void doSomething(You you, ...) {
  }

}</code></pre>
<p>This form is present in our current source, <a href="https://github.com/davidi2/mopar/blob/master/src/net/scapeemulator/game/content/alkharid/TollGate.java" data-bbcode="true" rel="nofollow noopener">example</a>. As you can see because there is static context, you are forced to use other static context:</p>
<pre><code class="lang-auto">    ObjectDispatcher.getInstance().bind(new ObjectHandler(Option.ONE) {
            @Override
            public void handle(Player player, GroundObject object, String optionName, HandlerContext context) {
                if (object != GateObjects.closedLeft &amp;&amp; object != GateObjects.closedRight) {
                    return;
                }
                player.startAction(new WalkToGate(player, object, false));
            }
        });</code></pre>
<p><span class="bbcode-u">Action based</span></p>
<p>The first step forward was presented by Graham, with his task based content system that was also authored by Blakeman. I think everyone may be familiar with the static singleton TaskExecutor or a derived form of that. This gave people the ability to break content into smaller, timed pieces where a task was a concrete context of a stage of content. It was more organized than the original traditional form but was not centralized. This paradigm causes a lot of headache when you have to create content broken up by many delays and for each delay you have to create a new task or embed timings into the task like a flag for when the task was initialized.</p>
<p>For example, from the Apollo source:</p>
<pre><code class="lang-auto">class RunecraftingAction &lt; DistancedAction
  attr_reader :player, :rune

  def initialize(player, rune, object_position)
    super(1, true, player, object_position, 3)
    @player = player
    @rune = rune
    @position = object_position
    @executions = 0
  end

  def executeAction
    runecrafting_level = @player.skill_set.get_skill(Skill::RUNECRAFT).current_level

    if (runecrafting_level &lt; @rune.level)
      @player.send_message("You need a runecrafting level of #{@rune.level} to craft this rune.")
      stop
    elsif !@player.inventory.contains(RUNE_ESSENCE_ID)
      @player.send_message('You need rune essence to craft runes.') 
      stop
    elsif @executions == 0 # Sini note: Here &lt;-
      @player.turn_to(@position)
      @player.play_animation(RUNECRAFTING_ANIMATION)
      @player.play_graphic(RUNECRAFTING_GRAPHIC)
      @executions += 1
    elsif @executions == 1 # Sini note: Here &lt;-
      removed = @player.inventory.remove(RUNE_ESSENCE_ID, @player.inventory.get_amount(RUNE_ESSENCE_ID))
      added = removed * @rune.multiplier(runecrafting_level)
      @player.inventory.add(@rune.id, added)

      @player.send_message("Your craft the rune essence into #{added &gt; 1 ? 'some ' + @rune.name + 's' : 'an ' + @rune.name}.", true)
      @player.skill_set.add_experience(Skill::RUNECRAFT, removed * @rune.experience)
      stop
    end
  end

  def equals(other)
    return (get_class == other.get_class &amp;&amp; @player == other.player &amp;&amp; @rune == other.rune)
  end

end</code></pre>
<p><span class="bbcode-u">Yielding based</span></p>
<p>As RSPS has evolved, we have started to realize that integrating the ability to embed delays and interrupts into scripts is a wise idea so that we can centralize our logic in a simple and efficient manner. The first topic that raised a solution for this was a project presented by Mgi125 <a href="http://www.rune-server.org/runescape-development/rs-503-client-server/projects/530186-dusk-runetek-5-a.html" data-bbcode="true" rel="nofollow noopener">link</a>. Here is an example from the topic:</p>
<pre><code class="lang-auto">playAnimation(1000);
wait(2); // wait 1200ms
playAnimation(3222);
wait(4); // wait 2400ms
teleport(1222,1222,0); // teleport somewher</code></pre>
<p>This solution, however the most efficient and satisfactory for content creation doesn’t work well with many modern languages without some intricate trickery. That reason being that in order to delay logic flow you have to yield to another context and allow for that context to marshal execution. Cue my solution, using Lua coroutines to allow for yielding.</p>
<pre><code class="lang-auto">-- prayer.lua
-- written by sini

local prayer = {}

-- Animation for burying
local burying = 827

-- Burying bones!
prayer.bury = function()

	-- Fetch the amount of experience gained from burying
	local exp = get('burying.exp')

	-- Start the animation and wait a few ticks 
	msg('You dig a hole in the ground')
	animate(burying)
	delay(2)

	-- Remove the bone from the inventory and give the experience
	msg('You bury the bones.')
	inv_remove(inv, last_slot)
	addxp(skills.prayer, exp)
end

return prayer</code></pre>
<p>As you can see this piece of content is efficient by being condensed, and it even would be without the use of metadata and helper functions. Although this solution is satisfactory to creating yielding based content, it also jeopardizes internal server stability by creating a thread for <span class="bbcode-i">each</span> action through the JLua coroutine library.</p>
<pre><code class="lang-auto">	LuaThread previous_thread = LuaThread.running_thread;
	try {
		LuaThread.running_thread = new_thread;
		this.args = args;
		if (this.status == STATUS_INITIAL) {
			this.status = STATUS_RUNNING; 
			new Thread(this, "Coroutine-"+(++coroutine_count)).start(); // &lt;- Here
		} else {
			this.notify();
		}
		previous_thread.state.status = STATUS_NORMAL;
		this.status = STATUS_RUNNING;
		this.wait();
		return (this.error != null? 
			LuaValue.varargsOf(LuaValue.FALSE, LuaValue.valueOf(this.error)):
			LuaValue.varargsOf(LuaValue.TRUE, this.result));
	} catch (InterruptedException ie) {
		throw new OrphanedThread();
	} finally {
		running_thread = previous_thread;
		running_thread.state.status =STATUS_RUNNING;
		this.args = LuaValue.NONE;
		this.result = LuaValue.NONE;
		this.error = null;
	}
}</code></pre>
<p><span class="bbcode-u">Yielding based : Custom Languages</span></p>
<p>Velocity, a Rune-Server programmer posted a link to an archived Andrew Gower blog which presented the original instructions for the early Runescript rendition which can be found <a href="https://web.archive.org/web/20090129160605/http://gowerarchive.googlepages.com/documents" data-bbcode="true" rel="nofollow noopener">here</a>. This was enough evidence to convince me that yes, it was imperative to create a yielding based content system. As you can see, the command ‘Delay’ gave Runescape developers the ability to wait a specified amount of ticks.</p>
<p>That same programmer also created a compiler for a similar Runescript grammar from photos given by Jagex developers that employed the delay command which can be found <a href="http://www.rune-server.org/runescape-development/rs-503-client-server/projects/565720-adderscript-unifying-content-creation.html" data-bbcode="true" rel="nofollow noopener">here</a>.</p>
<p>This method of content creation is on the far end of the spectrum for difficulty and programmer capability. Writing, maintaining, and compiling a custom language grammar is beyond the capabilities of many programmers here. So, it has been rarely attempted however it’s not impossible.</p>
<p><span class="bbcode-u">The bottom line</span></p>
<p>I will never in my future years working as a RSPS programmer stray from a yielding based content development. No matter how comfortable people are with using the traditional, or action based model it isn’t a sustainable way of developing content efficiently and in a timely manner. It isn’t something I’m willing to negotiate.</p>
<p>I don’t condemn how content has been done up to this point. I condemn if we stray from an efficient model. If we are going to emulate Runescape in a efficient manner we have to stop thinking of ourselves as RSPS programmers and become game developers. The two, although seemingly synonymous, are not.</p>
      </div>

      <meta itemprop='headline' content='The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Sessy_Pk3r.html'><span itemprop='name'>Sessy_Pk3r</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-07T02:08:23Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:20:14Z' class='post-time'>
              August 4, 2016,  2:20pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Good read.</p>
<aside class="quote" data-post="1" data-topic="549744">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/sinisoul/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sinisoul:</div>
<blockquote>
<p>If we are going to emulate Runescape in a efficient manner we have to stop thinking of ourselves as RSPS programmers and become game developers.</p>
</blockquote>
</aside>
<p>By far the most compelling and intuitive statement on this entire website.</p>
      </div>

      <meta itemprop='headline' content='The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-07T02:46:39Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:20:15Z' class='post-time'>
              August 4, 2016,  2:20pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Since this is being discussed in both the RSC and RS2 community, if Objects (Protosstribes) script system becomes popular, then you guys should highly consider it. Also, a thing I dislike and i’ll put it out there (I haven’t read your thread but am assuming) is the fact that I hate servers who use multiple languages for plugins. Stick to one plugin system and make it the norm.</p>
      </div>

      <meta itemprop='headline' content='The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/sinisoul.html'><span itemprop='name'>sinisoul</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-07T02:49:18Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:20:15Z' class='post-time'>
              August 4, 2016,  2:20pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="3" data-topic="549744">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/rodgerwilco/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Rodgerwilco:</div>
<blockquote>
<p>Since this is being discussed in both the RSC and RS2 community, if Objects (Protosstribes) script system becomes popular, then you guys should highly consider it. Also, a thing I dislike and i’ll put it out there (I haven’t read your thread but am assuming) is the fact that I hate servers who use multiple languages for plugins. Stick to one plugin system and make it the norm.</p>
</blockquote>
</aside>
<p>I like how he created a way to build graphs for content however I dont agree with that use and application.</p>
      </div>

      <meta itemprop='headline' content='The Scripting Acquisition, The groundwork for how we develop : Blog [OPINION]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/the-scripting-acquisition-the-groundwork-for-how-we-develop-blog-opinion/549744 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:15 GMT -->
</html>
