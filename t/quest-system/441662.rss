<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Quest System</title>
    <link>https://forum.moparisthebest.com/t/quest-system/441662</link>
    <description>Difficulty: Quite difficult (Back up beforehand to prevent tears)
Base: Originally written for Runesource but should work for any with minor modifications

Description: (Probably something I should have had here from the start) This adds a Quest system to your server including the quest journal. It makes new Quests easy to add (you make a class for each quest, add one line to QuestHandler.java and add 1 to the relevant array in Constants and that&#39;s it, no editing of other files required.)

Alright, the first class we are going to add is the Quest class. So make a file called Quest.java and copy paste this in it.

[code=java]package com.rs2.model.players.quest.quests;

import com.rs2.model.players.Player;
import com.rs2.model.players.quest.QuestJournal;

/**
 * 
 * This file is the super class for all the quests in
 * the game, every quest is an instance of this class.
 * Primarily used for holding the abstract methods containing
 * quest points, quest start, quest finish, the reward etc.
 * 
 * @author Poobum McGee
 *
 * 297 - The rewards interface
 * 8134 - The quest journal
 *
 */
public abstract class Quest {

	protected Player p;
	
	public Quest(Player p) {
		this.p = p;
	}
	
	/**
	 * Method which starts the quest, sets the quest stage,
	 * does whatever else needs to be done to start off the quest.
	 */
	public abstract void startQuest();
	
	/**
	 * Finishes the quest(set stage to 100) add the rewards etc
	 */
	public abstract void finishQuest();

	/**
	 * Contains the number of quest points the quest
	 * gives upon completion.
	 */
	protected int questPoints;
	
	/**
	 * The stage the player is up to in a quest. Ranges from 0 - 100
	 * (0 being unstarted, 100 being finished)
	 */
	protected int questStage;
	
	/**
	 * Handles the first clicking of npcs related to the quest
	 */
	public abstract boolean handleNpcFirstClick(int clickId);
	
	/**
	 * Handles the first clicking of objects related to the quest
	 */
	public abstract boolean firstClickObject();
	
	/**
	 * Handles the dialogue option selecting related to quests
	 */
	public abstract boolean optionSelect(int optionId, int option);
	
	/**
	 * The title of the quest, this appears in the quest
	 * tab of the players client.
	 */
	protected String questTitle;
	
	/**
	 * String array containing the lines in the journal and the quest
	 * stage at which they should be revealed
	 * Note: Always leave the first one empty. As this would be for
	 * when the quest stage is equal to zero and this is handled
	 * by the requirements text. (It is done this way because you don&#39;t
	 * want the requirements text to appear once the player has started
	 * the quest)
	 */
	protected String[][] journalLines;
	
	/**
	 * String array containing the lines in the journal showing
	 * the requirements for the quest
	 */
	protected String[] requirementsText;
	
	/**
	 * The button id pressed to bring up the journal
	 */
	protected int journalButtonId;
	
	/**
	 * The quest journal for this quest
	 */
	protected QuestJournal journal;

	/**
	 * Void which sets the journal information. This must be
	 * declared if the quest has a journal.
	 * @param journalButtonId - The journal button id
	 * @param requirements - The requirements text lines
	 * @param journal - the journal lines
	 */
	public void setJournalInfo(int journalButtonId, String[] requirements, String[][] journal) {
		this.journalButtonId = journalButtonId;
		this.requirementsText = requirements;
		this.journalLines = journal;
		this.journal = new QuestJournal(p, this, this.questTitle, this.journalLines, this.requirementsText);
	}
	
	public int getQuestPoints() {
		return questPoints;
	}

	public void setQuestPoints(int questPoints) {
		this.questPoints = questPoints;
	}
	
	public int getQuestStage() {
		return questStage;
	}

	public void setQuestStage(int questStage) {
		this.questStage = questStage;
	}

	public String getQuestTitle() {
		return questTitle;
	}

	public void setQuestTitle(String questTitle) {
		this.questTitle = questTitle;
	}
	
	public int getJournalButtonId() {
		return journalButtonId;
	}
	
	public QuestJournal getJournal() {
		return journal;
	}
	
}
[/code]

Now, [b]read[/b] all the comments in this class. They are put there to help you understand how it works. (That is where the teaching part of this tutorial lies)

I have written a very simple (no work done) example Quest called Get Me Some Fish (the file is called GetMeSomeFish.java for simplicity) This is supposed to be used as an example of how you would lay out a quest. (The quest journal bit will give you errors currently as we haven&#39;t added that yet)

[code=java]package com.rs2.model.players.quest.quests;

import com.rs2.model.players.Player;

public class GetMeSomeFish extends Quest {

	public GetMeSomeFish(Player p) {
		super(p);
		super.setQuestPoints(1);
		super.setQuestStage(0);
		super.setQuestTitle(&quot;Get Me Some Fish&quot;);
		super.setJournalInfo(28164, requirementsText, journalLines);
	}

	@Override
	public void startQuest() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void finishQuest() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public boolean handleNpcFirstClick(int clickId) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean firstClickObject() {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean optionSelect(int optionId, int option) {
		// TODO Auto-generated method stub
		return false;
	}
	
	String[] requirementsText = {
			&quot;Nothing is required to start this quest.&quot;,
			&quot;&quot;,
			&quot;To start this quest I should talk to the pirates.&quot;,
			&quot;The pirates are located at the bar in Camelot.&quot;
	};

	String[][] journalLines = {
			{},//Quest stage = 0;
			{//Quest stage = 1;
			},
	};

}
[/code]

Alright, simple so far?

Now we have to add the QuestHandler class. This essentially holds all the quests in a similar fashion to how the PacketHandler class holds all the packets. On my server I have arranged the quests into main quests and side quests, you may wish to change this to free quests and members quests or just lump them all together. Up to you.

[code=java]package com.rs2.model.players.quest;

import com.rs2.Constants;
import com.rs2.model.players.Player;
import com.rs2.model.players.quest.quests.GetMeSomeFish;
import com.rs2.model.players.quest.quests.Quest;

/**
 * This quest handles all the quests in the game, hopefully
 * this will contain many quests by the time I am done :)
 * 
 * @author Poobum McGee
 *
 */
public class QuestHandler {

	/**
	 * The player
	 */
	private Player p;
	
	/**
	 * Contains the number of quest points player p has
	 */
	private int currentQuestPoints() {
		int j = 0;
		for (int i = 0; i &lt; mainQuests.length; i++) {
			if(mainQuests[i].getQuestStage() == 100) {
				j += mainQuests[i].getQuestPoints();
			}
		}
		for (int i = 0; i &lt; sideQuests.length; i++) {
			if(sideQuests[i].getQuestStage() == 100) {
				j += sideQuests[i].getQuestPoints();
			}
		}
		return j;
	}
	
	/**
	 * Contains all the main quests
	 */
	private Quest mainQuests[] = new Quest[Constants.MAIN_QUEST_AMOUNT];
	
	/**
	 * Contains all the side quests
	 */
	private Quest sideQuests[] = new Quest[Constants.SIDE_QUEST_AMOUNT];
	
	/**
	 * Loads all the main quests up into an array
	 */
	public void loadMainQuests() {
		mainQuests[0] = new GetMeSomeFish(p);
	}
	
	/**
	 * Loads all the side quests up into an array
	 */
	public void loadSideQuests() {

	}
	
	public QuestHandler(Player p) {
		this.p = p;
		loadMainQuests();
		loadSideQuests();
	}
	
	public int getCurrentQuestPoints() {
		return currentQuestPoints();
	}
	
	public Quest getMainQuest()[] {
		return mainQuests;
	}
	
	public Quest getSideQuest()[] {
		return sideQuests;
	}
}
[/code]

Again, if you want more understanding, read the comments.

The final class we will add is the QuestJournal class. This class is the first attempt I have ever seen at a decent questJournal handling system. I just wrote it this afternoon but so far it works great :)

Here ya go:

[code=java]package com.rs2.model.players.quest;

import com.rs2.model.players.Player;
import com.rs2.model.players.quest.quests.Quest;
import com.rs2.net.ActionSender;

/**
 * 
 * A class which handles the journal for each quest
 * To use this class all you have to do is construct it
 * using the constructor.
 * 
 * 
 * @author Poobum McGee
 *
 */
public class QuestJournal {

	private Player p;
	private Quest referencer;

	/**
	 * Constructs the quest journal class
	 * @param g 
	 * 			The player the quest journal is for.
	 * @param q 
	 * 			The quest which this is relevant to.
	 * @param title 
	 * 			The title of the text.
	 * @param reveal 
	 * 			The quest stage for which each line should be revealed.
	 * @param journal
	 * 			 The lines.
	 * @param requirements 
	 * 			 The lines which are shown before the quest is started
	 */
	public QuestJournal(Player g, Quest q, String title, String[][] journal, String[] requirements) {
		p = g;
		referencer = q;
		JOURNAL = journal;
		TITLE_TEXT = title;
		REQUIREMENTS = requirements;
	}

	/**
	 * Shows the journal
	 */
	public void showJournal() {
		if (JOURNAL == null || REQUIREMENTS == null) {
			System.out.println(&quot;ERROR: Quest Journal arrays empty&quot;);
			return;
		}
		int journalLength = 0;
		for (int i = 0; i &lt; JOURNAL.length; i++) {
			journalLength += JOURNAL[i].length;
		}
		if (journalLength &gt; MAIN_LINES.length) {
			System.out.println(&quot;ERROR: Quest Journal arrays too long&quot;);
			return;
		}
		if (REQUIREMENTS.length &gt; MAIN_LINES.length) {
			System.out.println(&quot;ERROR: Quest Requirements arrays too long&quot;);
			return;
		}
		int questStage = referencer.getQuestStage();
		ActionSender a = p.getActionSender();
		a.sendString(TITLE_TEXT, TITLE);
		int currentLineNumber = 0;
		for (int x = 0; x &lt; MAIN_LINES.length; x++) {
			a.sendString(&quot;&quot;, MAIN_LINES[x]);
		}
		if (questStage == 0) {
			for (int x = 0; x &lt; MAIN_LINES.length; x++) {
				if (x &gt;= REQUIREMENTS.length) {
					break;
				} else {
					a.sendString(REQUIREMENTS[x], MAIN_LINES[x]);
				}
			}
		} else {
			for (int i = 0; i &lt; JOURNAL.length; i++) {
				if (i &lt; questStage) {
					for (int x = 0; x &lt; JOURNAL[i].length; x++) {
						a.sendString(&quot;@str@&quot;+JOURNAL[i][x]+&quot;@str@&quot;, MAIN_LINES[currentLineNumber]);
						currentLineNumber++;
					}
				} else if (i == questStage) {
					for (int x = 0; x &lt; JOURNAL[i].length; x++) {
						a.sendString(JOURNAL[i][x], MAIN_LINES[currentLineNumber]);
						currentLineNumber++;
					}
				} else if (i &gt; questStage) {
					for (int x = currentLineNumber; x &lt; MAIN_LINES.length; x++) {
						a.sendString(&quot;&quot;, MAIN_LINES[currentLineNumber]);
						currentLineNumber++;
					}
				}
			}
		}
		a.sendInterface(8134);
	}

	/**
	 * This is the id of the title text field
	 */
	private final int TITLE = 8144;

	/**
	 * This array contains the id of all the text lines
	 * in the journal (in order)
	 */
	private final int[] MAIN_LINES = {
			8145, 8147, 8148, 8149, 8150, 8151, 8152, 8153, 8154,
			8155, 8156, 8157, 8158, 8159, 8160, 8161, 8162, 8163,
			8164, 8165, 8166, 8167, 8168, 8169, 8170, 8171, 8172,
			8173, 8174, 8175, 8176, 8177, 8178, 8179, 8180, 8181,
			8182, 8183, 8184, 8185, 8186, 8187, 8188, 8189, 8190,
			8191, 8192, 8193, 8194, 8195, 12174, 12175, 12176, 12177,
			12178, 12179, 12180, 12181, 12182, 12183, 12184, 12185,
			12186, 12187, 12188, 12189, 12190, 12191, 12192, 12193,
			12194, 12195, 12196, 12197, 12198, 12199, 12200, 12201,
			12202, 12203, 12204, 12205, 12206, 12207, 12208, 12209,
			12210, 12211, 12212, 12213, 12214, 12215, 12216, 12217,
			12218, 12219, 12220, 12221, 12222, 12223
	};

	/**
	 * Essentially contains the title of the journal
	 * This must be set manually each time when the quest
	 * interface is constructed.
	 */
	private String TITLE_TEXT;

	/**
	 * This contains the text for each line and when each line should be revealed.
	 * It is formatted like this.
	 * [QuestStage 1] [QuestStage 2]
	 * [Lines in here][Lines in here]
	 * This must be set manually each time when the quest interface
	 * is constructed.
	 */
	private String[][] JOURNAL;

	/**
	 * This contains the requirement text for the quest.
	 * This must be set manually each time when the quest interface
	 * is constructed.
	 */
	private String[] REQUIREMENTS;

}[/code]

Again, the comments are your pathway to understanding.

FINALLY! We want the quests to update in the quest tab so, add this void:

[code=java]public void updateQuestList() {
		player.getActionSender().sendString(&quot;Quest Points: &quot;+player.getQuestHandler().getCurrentQuestPoints(), 640);
		player.getActionSender().sendString(&quot;Main Questline&quot;, 663);
		for (int i = 0; i &lt; QUEST_INTERFACE_MAIN_TEXT.length; i++) {
			if (i &gt;= Constants.MAIN_QUEST_AMOUNT) {
				player.getActionSender().sendString(&quot;&quot;, QUEST_INTERFACE_MAIN_TEXT[i]);
			} else {
				player.getActionSender().sendString(player.getQuestHandler().getMainQuest()[i].getQuestTitle(), QUEST_INTERFACE_MAIN_TEXT[i]);
				if (player.getQuestHandler().getMainQuest()[i].getQuestStage() == 0)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x6000);
				else if (player.getQuestHandler().getMainQuest()[i].getQuestStage() &lt; 100)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x33FF66);
				else if (player.getQuestHandler().getMainQuest()[i].getQuestStage() &gt;= 100)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x3366);
			}
		}
		//TODO: Side quest loading
	}
	[/code]

This void isn&#39;t actually finished yet, currently it only writes the main quests (or free quests) but it is fairly simple to add the member&#39;s quests.

You will also need to add this in the same place:

[code=java]/**
	 * Contains the interface ids for the text areas of the main quest
	 */
	private final int[] QUEST_INTERFACE_MAIN_TEXT = {
		7332, 7333, 7334, 7336, 7383, 7339, 7338, 7340, 7346,
		7341, 7342, 7337, 7343, 7335, 7344, 7345, 7347, 7348,
		
	};[/code]

Finally, you will need to call that method &quot;updateQuestList()&quot; at some point during the player login. It is very possible I have missed something, please let me know if you get errors and I will try to help you.

OH!! I nearly forgot something, you will need this method. This is a very special method which I hold dear to heart. This method is the correct way to change the colour of text on interfaces. Yes, @red@ and all that shit is actually not how you are supposed to do it.

In ActionSender or wherever you feel like keeping your outgoing packets place this:

[code=java]/**
	 * 
	 * Changes the colour of a line of text in an interface
	 * 
	 * @param id - The interface id of the text field
	 * @param colourId - The colour
	 * Examples:
	 * Red - 0x6000
	 * Yellow - 0x33FF66
	 * Green - 0x3366
	 */
	public ActionSender sendInterfaceTextColour(int id, int colourId) {
		StreamBuffer.OutBuffer out = StreamBuffer.newOutBuffer(8);
		out.writeHeader(player.getEncryptor(), 122);
		out.writeShort(id, StreamBuffer.ValueType.A, StreamBuffer.ByteOrder.LITTLE);
		out.writeShort(colourId, StreamBuffer.ValueType.A, StreamBuffer.ByteOrder.LITTLE);
		player.send(out.getBuffer());
		
		return this;
	}[/code]

Oh, in your constants file you will need to declare the number of main and side quests (hint, it is 1 for Main Quests and 0 for side quests, add one each time you add a quest)

Note: I have spent quite some time writing this up for my server (Project Stinky-Arse) and I thought it was so pretty, that I should share it with the world. Enjoy. :)

OH! One final thing:
To make things like handleNpcFirstClick, firstClickObject and optionSelect work you must find the relevant fields (i.e. your npc first click packet) and add this piece of code (or one similar)

[code=java]
for (Quest i : player.getQuestHandler().getMainQuest()) {
	if(i.firstClickObject() == true)
		return;
}
for (Quest i : player.getQuestHandler().getSideQuest()) {
	if(i.firstClickObject() == true)
		return;
}
[/code]

And you also need to do the obvious like declaring:

[code=java]private QuestHandler questHandler = new QuestHandler(this);
public QuestHandler getQuestHandler() {
         return questHandler;
}[/code]

Inside your player class.

Final final note: Just to assure, this is in no way complete, there are still plenty of additions that could be made (i.e. rewards aren&#39;t handled yet) but it is a damn good start I feel. So I encourage any motivated quest writers to use this if they can. (That&#39;s meant to be a challenge)</description>
    
    <lastBuildDate>Mon, 23 Sep 2013 03:56:18 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/quest-system/441662.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@Aotearoa Aotearoa]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/aotearoa">@Aotearoa</a> wrote:</p>
          <blockquote>
              <p>BUUUUUUUUUUMP Confused the fuck out of me at first then i had realised had to modify few things to suit my server <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> thank you. been writing quests ever since i added this into my server FinalEscape <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> .</p>
<p>BUUUMP BECAUSEEE I CAN <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:">  !</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/12</link>
        <pubDate>Mon, 23 Sep 2013 03:56:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-12</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>Bump cuz this is awesome and by an awesome person.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/11</link>
        <pubDate>Mon, 23 Sep 2013 01:45:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-11</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@BorigTheDwarf BorigTheDwarf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/borigthedwarf">@BorigTheDwarf</a> wrote:</p>
          <blockquote>
              <p>[quote=“Primadude, post:9, topic:441662”][quote author=BorigTheDwarf link=topic=544354.msg3991439#msg3991439 date=1336621436]<br>
Yeah, but when would you be calling it?<br>
[/quote]</p>
<p>You’d probably call it in one of your NPC dialogues, since that’s usually when a quest progresses on RuneScape.[/quote]</p>
<p>I see. Surely my way, which is a lot more self contained, is better in that case? Because apart from that they are extremely similar…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/10</link>
        <pubDate>Thu, 10 May 2012 18:52:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-10</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="6" data-topic="441662">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/borigthedwarf/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> BorigTheDwarf:</div>
<blockquote>
<p>Yeah, but when would you be calling it?</p>
</blockquote>
</aside>
<p>You’d probably call it in one of your NPC dialogues, since that’s usually when a quest progresses on RuneScape.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/9</link>
        <pubDate>Thu, 10 May 2012 11:07:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-9</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@BorigTheDwarf BorigTheDwarf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/borigthedwarf">@BorigTheDwarf</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="7" data-topic="441662">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/loveandpower/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Loveandpower:</div>
<blockquote>
<p>why do i  smell  super  involved in  this somehow? 0.o not sure just looks like  something he would do 0.o</p>
</blockquote>
</aside>
<p>Uhh… 100% written from scratch by me… But thank you. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/8</link>
        <pubDate>Thu, 10 May 2012 05:38:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-8</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@Loveandpower Loveandpower]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/loveandpower">@Loveandpower</a> wrote:</p>
          <blockquote>
              <p>why do i  smell  super  involved in  this somehow? 0.o not sure just looks like  something he would do 0.o</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/7</link>
        <pubDate>Thu, 10 May 2012 05:26:25 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-7</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@BorigTheDwarf BorigTheDwarf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/borigthedwarf">@BorigTheDwarf</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="5" data-topic="441662">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/imsuperman05/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> imsuperman05:</div>
<blockquote>
<p>looks like a little kid wrote it</p>
</blockquote>
</aside>
<p>For someone who has learnt everything they know about programming from RSPS I feel I am doing pretty well.</p>
<p>[quote=“Primadude, post:4, topic:441662”][quote author=BorigTheDwarf link=topic=544354.msg3990964#msg3990964 date=1336589516]<br>
With the abstract void progress. How do you call that? Is it similar to how I am calling the various packet voids?<br>
[/quote]</p>
<p>You’d just create the same method in a new quest class and override the super method that’s in the Quest class.</p>
<p>[code=java]/**</p>
<ul>
<li>
<p>Class for a new quest.<br>
*/<br>
public class NewQuest extends Quest</p>
<pre><code> @Override
 public void progress(Player player) {
         progressQuest(player);
         // Progression content for this quest.
 }
</code></pre>
</li>
</ul>
<p>}[/code]</p>
<p>As for the different quest endings you can always create a custom quest-finishing method within your new quest class and then simply call the questCompletion(Player player) within it.[/quote]</p>
<p>Yeah, but when would you be calling it?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/6</link>
        <pubDate>Thu, 10 May 2012 03:43:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-6</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@imsuperman05 imsuperman05]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imsuperman05">@imsuperman05</a> wrote:</p>
          <blockquote>
              <p>looks like a little kid wrote it</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/5</link>
        <pubDate>Wed, 09 May 2012 23:17:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-5</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="3" data-topic="441662">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/borigthedwarf/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> BorigTheDwarf:</div>
<blockquote>
<p>With the abstract void progress. How do you call that? Is it similar to how I am calling the various packet voids?</p>
</blockquote>
</aside>
<p>You’d just create the same method in a new quest class and override the super method that’s in the Quest class.</p>
<p>[code=java]/**</p>
<ul>
<li>
<p>Class for a new quest.<br>
*/<br>
public class NewQuest extends Quest</p>
<pre><code> @Override
 public void progress(Player player) {
         progressQuest(player);
         // Progression content for this quest.
 }
</code></pre>
</li>
</ul>
<p>}[/code]</p>
<p>As for the different quest endings you can always create a custom quest-finishing method within your new quest class and then simply call the questCompletion(Player player) within it.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/4</link>
        <pubDate>Wed, 09 May 2012 23:14:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-4</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@BorigTheDwarf BorigTheDwarf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/borigthedwarf">@BorigTheDwarf</a> wrote:</p>
          <blockquote>
              <p>I might take a look into how you’ve handled rewards.</p>
<p>With the abstract void progress. How do you call that? Is it similar to how I am calling the various packet voids?</p>
<p>One of the main reasons I like mine is that it has support for multiple quest endings (any quest stage above 100 is finished) and I don’t see how I would ever need more than 100 stages in the quest.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/3</link>
        <pubDate>Wed, 09 May 2012 18:51:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-3</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>Could be a lot better. This is a base to my quest system I wrote a while ago, you can take a look and see if there’s anything you might want to use:</p>
<p>Quest abstract class</p>
<p>[code=java]package org.iClarity.rs2.content.quests;</p>
<p>import org.iClarity.rs2.model.player.Player;<br>
import org.iClarity.rs2.util.items.Item;<br>
import org.iClarity.rs2.util.items.ItemHandler;</p>
<p>/**</p>
<ul>
<li>
<p>Represents a quest.</p>
</li>
<li>
<p><span class="mention">@author</span> PrimaDude.<br>
*/<br>
public abstract class Quest {</p>
<p>private int progression;<br>
private int maximumProgression;<br>
private String questName;<br>
private boolean questFinished;<br>
private QuestReward questReward;</p>
<p>/**</p>
<ul>
<li>Gets the progression.</li>
<li>
<a class="mention" href="/u/return">@return</a> The progression.<br>
*/<br>
public int getProgression() {<br>
return progression;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the quest name.</li>
<li>
<a class="mention" href="/u/return">@return</a> The quest name.<br>
*/<br>
public String getQuestName() {<br>
return questName;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>If the quest is finished.</li>
<li>
<a class="mention" href="/u/return">@return</a> True or false.<br>
*/<br>
public boolean isQuestFinished() {<br>
return questFinished;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Quest progression for things such as item</li>
<li>addition/depletion or other player-oriented change.</li>
<li>
<a class="mention" href="/u/param">@param</a> player The player.<br>
*/<br>
protected abstract void progress(Player player);</li>
</ul>
<p>/**</p>
<ul>
<li>Progresses this quest for the player.</li>
<li>
<a class="mention" href="/u/param">@param</a> player The player.<br>
*/<br>
public void progressQuest(Player player) {<br>
if (progression == maximumProgression) {<br>
return;<br>
}<br>
progression += 1;<br>
if (progression == 1) {<br>
// Update quest text colour from red to yellow.<br>
} if (progression == maximumProgression) {<br>
// Update quest text colour from yellow to green.<br>
questCompletion(player);<br>
}<br>
progress(player);<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Completes the quest for the player.</li>
<li>
<a class="mention" href="/u/param">@param</a> player The player.<br>
*/<br>
public void questCompletion(Player player) {<br>
// TODO: Quest completion interface.<br>
for (Item item : questReward.getItemRewards()) {<br>
if (item == null) {<br>
return;<br>
} else if (!player.getInventory().get().insert(item)) {<br>
ItemHandler.createGroundItem(item, player);<br>
return;<br>
}<br>
}	<br>
player.getActionSender().sendInventory();<br>
for (int skill = 0; skill &lt; questReward.getExperience().size(); skill++) {<br>
if (questReward.getExperience().get(skill) != null) {<br>
player.getSkills().addSkillXP(player, skill, questReward.getExperience().get(skill));<br>
}<br>
}<br>
questFinished = true;<br>
}</li>
</ul>
</li>
</ul>
<p>}[/code]</p>
<p>QuestReward class</p>
<p>[code=java]package org.iClarity.rs2.content.quests;</p>
<p>import java.util.Map;</p>
<p>import org.iClarity.rs2.util.items.Item;</p>
<p>/**</p>
<ul>
<li>
<p>Represents the quest reward given to the</p>
</li>
<li>
<p>player upon completion of the quest.</p>
</li>
<li>
<p><span class="mention">@author</span> PrimaDude.<br>
*/<br>
public class QuestReward {</p>
<p>/**</p>
<ul>
<li>The item rewards given.<br>
*/<br>
private Item[] itemRewards;</li>
</ul>
<p>/**</p>
<ul>
<li>The experience rewards given.</li>
<li>
<ul>
<li>The key for a value is the skill type.</li>
</ul>
</li>
<li>
<ul>
<li>The value of that key is the amount of experience to be given in that skill.<br>
*/<br>
private Map&lt;Integer, Integer&gt; experience;</li>
</ul>
</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the item rewards.</li>
<li>
<a class="mention" href="/u/return">@return</a> The item rewards.<br>
*/<br>
public Item[] getItemRewards() {<br>
return itemRewards;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the experience rewards.</li>
<li>
<a class="mention" href="/u/return">@return</a> The experience.<br>
*/<br>
public Map&lt;Integer, Integer&gt; getExperience() {<br>
return experience;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Constructs a new QuestReward.</li>
<li>
<a class="mention" href="/u/param">@param</a> itemRewards The item rewards given.</li>
<li>
<a class="mention" href="/u/param">@param</a> experience The experience given.<br>
*/<br>
private QuestReward(Item[] itemRewards, Map&lt;Integer, Integer&gt; experience) {<br>
this.itemRewards = itemRewards;<br>
this.experience = experience;<br>
}</li>
</ul>
</li>
</ul>
<p>}<code></code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/2</link>
        <pubDate>Wed, 09 May 2012 15:45:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-2</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
      <item>
        <title>Quest System</title>
        <dc:creator><![CDATA[@BorigTheDwarf BorigTheDwarf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/borigthedwarf">@BorigTheDwarf</a> wrote:</p>
          <blockquote>
              <p>Difficulty: Quite difficult (Back up beforehand to prevent tears)<br>
Base: Originally written for Runesource but should work for any with minor modifications</p>
<p>Description: (Probably something I should have had here from the start) This adds a Quest system to your server including the quest journal. It makes new Quests easy to add (you make a class for each quest, add one line to QuestHandler.java and add 1 to the relevant array in Constants and that’s it, no editing of other files required.)</p>
<p>Alright, the first class we are going to add is the Quest class. So make a file called Quest.java and copy paste this in it.</p>
<p>[code=java]package com.rs2.model.players.quest.quests;</p>
<p>import com.rs2.model.players.Player;<br>
import com.rs2.model.players.quest.QuestJournal;</p>
<p>/**<br>
*</p>
<ul>
<li>This file is the super class for all the quests in</li>
<li>the game, every quest is an instance of this class.</li>
<li>Primarily used for holding the abstract methods containing</li>
<li>quest points, quest start, quest finish, the reward etc.</li>
<li>
</li>
<li>
<span class="mention">@author</span> Poobum McGee</li>
<li>
</li>
<li>297 - The rewards interface</li>
<li>8134 - The quest journal</li>
<li>
</li>
</ul>
<p>*/<br>
public abstract class Quest {</p>
<pre><code>protected Player p;

public Quest(Player p) {
	this.p = p;
}

/**
 * Method which starts the quest, sets the quest stage,
 * does whatever else needs to be done to start off the quest.
 */
public abstract void startQuest();

/**
 * Finishes the quest(set stage to 100) add the rewards etc
 */
public abstract void finishQuest();

/**
 * Contains the number of quest points the quest
 * gives upon completion.
 */
protected int questPoints;

/**
 * The stage the player is up to in a quest. Ranges from 0 - 100
 * (0 being unstarted, 100 being finished)
 */
protected int questStage;

/**
 * Handles the first clicking of npcs related to the quest
 */
public abstract boolean handleNpcFirstClick(int clickId);

/**
 * Handles the first clicking of objects related to the quest
 */
public abstract boolean firstClickObject();

/**
 * Handles the dialogue option selecting related to quests
 */
public abstract boolean optionSelect(int optionId, int option);

/**
 * The title of the quest, this appears in the quest
 * tab of the players client.
 */
protected String questTitle;

/**
 * String array containing the lines in the journal and the quest
 * stage at which they should be revealed
 * Note: Always leave the first one empty. As this would be for
 * when the quest stage is equal to zero and this is handled
 * by the requirements text. (It is done this way because you don't
 * want the requirements text to appear once the player has started
 * the quest)
 */
protected String[][] journalLines;

/**
 * String array containing the lines in the journal showing
 * the requirements for the quest
 */
protected String[] requirementsText;

/**
 * The button id pressed to bring up the journal
 */
protected int journalButtonId;

/**
 * The quest journal for this quest
 */
protected QuestJournal journal;

/**
 * Void which sets the journal information. This must be
 * declared if the quest has a journal.
 * @param journalButtonId - The journal button id
 * @param requirements - The requirements text lines
 * @param journal - the journal lines
 */
public void setJournalInfo(int journalButtonId, String[] requirements, String[][] journal) {
	this.journalButtonId = journalButtonId;
	this.requirementsText = requirements;
	this.journalLines = journal;
	this.journal = new QuestJournal(p, this, this.questTitle, this.journalLines, this.requirementsText);
}

public int getQuestPoints() {
	return questPoints;
}

public void setQuestPoints(int questPoints) {
	this.questPoints = questPoints;
}

public int getQuestStage() {
	return questStage;
}

public void setQuestStage(int questStage) {
	this.questStage = questStage;
}

public String getQuestTitle() {
	return questTitle;
}

public void setQuestTitle(String questTitle) {
	this.questTitle = questTitle;
}

public int getJournalButtonId() {
	return journalButtonId;
}

public QuestJournal getJournal() {
	return journal;
}
</code></pre>
<p>}<br>
[/code]</p>
<p>Now, <span class="bbcode-b">read</span> all the comments in this class. They are put there to help you understand how it works. (That is where the teaching part of this tutorial lies)</p>
<p>I have written a very simple (no work done) example Quest called Get Me Some Fish (the file is called GetMeSomeFish.java for simplicity) This is supposed to be used as an example of how you would lay out a quest. (The quest journal bit will give you errors currently as we haven’t added that yet)</p>
<p>[code=java]package com.rs2.model.players.quest.quests;</p>
<p>import com.rs2.model.players.Player;</p>
<p>public class GetMeSomeFish extends Quest {</p>
<pre><code>public GetMeSomeFish(Player p) {
	super(p);
	super.setQuestPoints(1);
	super.setQuestStage(0);
	super.setQuestTitle("Get Me Some Fish");
	super.setJournalInfo(28164, requirementsText, journalLines);
}

@Override
public void startQuest() {
	// TODO Auto-generated method stub
	
}

@Override
public void finishQuest() {
	// TODO Auto-generated method stub
	
}

@Override
public boolean handleNpcFirstClick(int clickId) {
	// TODO Auto-generated method stub
	return false;
}

@Override
public boolean firstClickObject() {
	// TODO Auto-generated method stub
	return false;
}

@Override
public boolean optionSelect(int optionId, int option) {
	// TODO Auto-generated method stub
	return false;
}

String[] requirementsText = {
		"Nothing is required to start this quest.",
		"",
		"To start this quest I should talk to the pirates.",
		"The pirates are located at the bar in Camelot."
};

String[][] journalLines = {
		{},//Quest stage = 0;
		{//Quest stage = 1;
		},
};
</code></pre>
<p>}<br>
[/code]</p>
<p>Alright, simple so far?</p>
<p>Now we have to add the QuestHandler class. This essentially holds all the quests in a similar fashion to how the PacketHandler class holds all the packets. On my server I have arranged the quests into main quests and side quests, you may wish to change this to free quests and members quests or just lump them all together. Up to you.</p>
<p>[code=java]package com.rs2.model.players.quest;</p>
<p>import com.rs2.Constants;<br>
import com.rs2.model.players.Player;<br>
import com.rs2.model.players.quest.quests.GetMeSomeFish;<br>
import com.rs2.model.players.quest.quests.Quest;</p>
<p>/**</p>
<ul>
<li>This quest handles all the quests in the game, hopefully</li>
<li>this will contain many quests by the time I am done <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:">
</li>
<li>
</li>
<li>
<span class="mention">@author</span> Poobum McGee</li>
<li>
</li>
</ul>
<p>*/<br>
public class QuestHandler {</p>
<pre><code>/**
 * The player
 */
private Player p;

/**
 * Contains the number of quest points player p has
 */
private int currentQuestPoints() {
	int j = 0;
	for (int i = 0; i &lt; mainQuests.length; i++) {
		if(mainQuests[i].getQuestStage() == 100) {
			j += mainQuests[i].getQuestPoints();
		}
	}
	for (int i = 0; i &lt; sideQuests.length; i++) {
		if(sideQuests[i].getQuestStage() == 100) {
			j += sideQuests[i].getQuestPoints();
		}
	}
	return j;
}

/**
 * Contains all the main quests
 */
private Quest mainQuests[] = new Quest[Constants.MAIN_QUEST_AMOUNT];

/**
 * Contains all the side quests
 */
private Quest sideQuests[] = new Quest[Constants.SIDE_QUEST_AMOUNT];

/**
 * Loads all the main quests up into an array
 */
public void loadMainQuests() {
	mainQuests[0] = new GetMeSomeFish(p);
}

/**
 * Loads all the side quests up into an array
 */
public void loadSideQuests() {

}

public QuestHandler(Player p) {
	this.p = p;
	loadMainQuests();
	loadSideQuests();
}

public int getCurrentQuestPoints() {
	return currentQuestPoints();
}

public Quest getMainQuest()[] {
	return mainQuests;
}

public Quest getSideQuest()[] {
	return sideQuests;
}
</code></pre>
<p>}<br>
[/code]</p>
<p>Again, if you want more understanding, read the comments.</p>
<p>The final class we will add is the QuestJournal class. This class is the first attempt I have ever seen at a decent questJournal handling system. I just wrote it this afternoon but so far it works great <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Here ya go:</p>
<p>[code=java]package com.rs2.model.players.quest;</p>
<p>import com.rs2.model.players.Player;<br>
import com.rs2.model.players.quest.quests.Quest;<br>
import com.rs2.net.ActionSender;</p>
<p>/**<br>
*</p>
<ul>
<li>A class which handles the journal for each quest</li>
<li>To use this class all you have to do is construct it</li>
<li>using the constructor.</li>
<li>
</li>
<li>
</li>
<li>
<span class="mention">@author</span> Poobum McGee</li>
<li>
</li>
</ul>
<p>*/<br>
public class QuestJournal {</p>
<pre><code>private Player p;
private Quest referencer;

/**
 * Constructs the quest journal class
 * @param g 
 * 			The player the quest journal is for.
 * @param q 
 * 			The quest which this is relevant to.
 * @param title 
 * 			The title of the text.
 * @param reveal 
 * 			The quest stage for which each line should be revealed.
 * @param journal
 * 			 The lines.
 * @param requirements 
 * 			 The lines which are shown before the quest is started
 */
public QuestJournal(Player g, Quest q, String title, String[][] journal, String[] requirements) {
	p = g;
	referencer = q;
	JOURNAL = journal;
	TITLE_TEXT = title;
	REQUIREMENTS = requirements;
}

/**
 * Shows the journal
 */
public void showJournal() {
	if (JOURNAL == null || REQUIREMENTS == null) {
		System.out.println("ERROR: Quest Journal arrays empty");
		return;
	}
	int journalLength = 0;
	for (int i = 0; i &lt; JOURNAL.length; i++) {
		journalLength += JOURNAL[i].length;
	}
	if (journalLength &gt; MAIN_LINES.length) {
		System.out.println("ERROR: Quest Journal arrays too long");
		return;
	}
	if (REQUIREMENTS.length &gt; MAIN_LINES.length) {
		System.out.println("ERROR: Quest Requirements arrays too long");
		return;
	}
	int questStage = referencer.getQuestStage();
	ActionSender a = p.getActionSender();
	a.sendString(TITLE_TEXT, TITLE);
	int currentLineNumber = 0;
	for (int x = 0; x &lt; MAIN_LINES.length; x++) {
		a.sendString("", MAIN_LINES[x]);
	}
	if (questStage == 0) {
		for (int x = 0; x &lt; MAIN_LINES.length; x++) {
			if (x &gt;= REQUIREMENTS.length) {
				break;
			} else {
				a.sendString(REQUIREMENTS[x], MAIN_LINES[x]);
			}
		}
	} else {
		for (int i = 0; i &lt; JOURNAL.length; i++) {
			if (i &lt; questStage) {
				for (int x = 0; x &lt; JOURNAL[i].length; x++) {
					a.sendString("@str@"+JOURNAL[i][x]+"@str@", MAIN_LINES[currentLineNumber]);
					currentLineNumber++;
				}
			} else if (i == questStage) {
				for (int x = 0; x &lt; JOURNAL[i].length; x++) {
					a.sendString(JOURNAL[i][x], MAIN_LINES[currentLineNumber]);
					currentLineNumber++;
				}
			} else if (i &gt; questStage) {
				for (int x = currentLineNumber; x &lt; MAIN_LINES.length; x++) {
					a.sendString("", MAIN_LINES[currentLineNumber]);
					currentLineNumber++;
				}
			}
		}
	}
	a.sendInterface(8134);
}

/**
 * This is the id of the title text field
 */
private final int TITLE = 8144;

/**
 * This array contains the id of all the text lines
 * in the journal (in order)
 */
private final int[] MAIN_LINES = {
		8145, 8147, 8148, 8149, 8150, 8151, 8152, 8153, 8154,
		8155, 8156, 8157, 8158, 8159, 8160, 8161, 8162, 8163,
		8164, 8165, 8166, 8167, 8168, 8169, 8170, 8171, 8172,
		8173, 8174, 8175, 8176, 8177, 8178, 8179, 8180, 8181,
		8182, 8183, 8184, 8185, 8186, 8187, 8188, 8189, 8190,
		8191, 8192, 8193, 8194, 8195, 12174, 12175, 12176, 12177,
		12178, 12179, 12180, 12181, 12182, 12183, 12184, 12185,
		12186, 12187, 12188, 12189, 12190, 12191, 12192, 12193,
		12194, 12195, 12196, 12197, 12198, 12199, 12200, 12201,
		12202, 12203, 12204, 12205, 12206, 12207, 12208, 12209,
		12210, 12211, 12212, 12213, 12214, 12215, 12216, 12217,
		12218, 12219, 12220, 12221, 12222, 12223
};

/**
 * Essentially contains the title of the journal
 * This must be set manually each time when the quest
 * interface is constructed.
 */
private String TITLE_TEXT;

/**
 * This contains the text for each line and when each line should be revealed.
 * It is formatted like this.
 * [QuestStage 1] [QuestStage 2]
 * [Lines in here][Lines in here]
 * This must be set manually each time when the quest interface
 * is constructed.
 */
private String[][] JOURNAL;

/**
 * This contains the requirement text for the quest.
 * This must be set manually each time when the quest interface
 * is constructed.
 */
private String[] REQUIREMENTS;
</code></pre>
<p>}[/code]</p>
<p>Again, the comments are your pathway to understanding.</p>
<p>FINALLY! We want the quests to update in the quest tab so, add this void:</p>
<p><code>public void updateQuestList() {
		player.getActionSender().sendString("Quest Points: "+player.getQuestHandler().getCurrentQuestPoints(), 640);
		player.getActionSender().sendString("Main Questline", 663);
		for (int i = 0; i &lt; QUEST_INTERFACE_MAIN_TEXT.length; i++) {
			if (i &gt;= Constants.MAIN_QUEST_AMOUNT) {
				player.getActionSender().sendString("", QUEST_INTERFACE_MAIN_TEXT[i]);
			} else {
				player.getActionSender().sendString(player.getQuestHandler().getMainQuest()[i].getQuestTitle(), QUEST_INTERFACE_MAIN_TEXT[i]);
				if (player.getQuestHandler().getMainQuest()[i].getQuestStage() == 0)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x6000);
				else if (player.getQuestHandler().getMainQuest()[i].getQuestStage() &lt; 100)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x33FF66);
				else if (player.getQuestHandler().getMainQuest()[i].getQuestStage() &gt;= 100)
					player.getActionSender().sendInterfaceTextColour(QUEST_INTERFACE_MAIN_TEXT[i], 0x3366);
			}
		}
		//TODO: Side quest loading
	}
	</code></p>
<p>This void isn’t actually finished yet, currently it only writes the main quests (or free quests) but it is fairly simple to add the member’s quests.</p>
<p>You will also need to add this in the same place:</p>
<p>[code=java]/**<br>
* Contains the interface ids for the text areas of the main quest<br>
*/<br>
private final int[] QUEST_INTERFACE_MAIN_TEXT = {<br>
7332, 7333, 7334, 7336, 7383, 7339, 7338, 7340, 7346,<br>
7341, 7342, 7337, 7343, 7335, 7344, 7345, 7347, 7348,</p>
<pre><code>};[/code]
</code></pre>
<p>Finally, you will need to call that method “updateQuestList()” at some point during the player login. It is very possible I have missed something, please let me know if you get errors and I will try to help you.</p>
<p>OH!! I nearly forgot something, you will need this method. This is a very special method which I hold dear to heart. This method is the correct way to change the colour of text on interfaces. Yes, <a class="mention" href="/u/red">@red</a>@ and all that shit is actually not how you are supposed to do it.</p>
<p>In ActionSender or wherever you feel like keeping your outgoing packets place this:</p>
<p>[code=java]/**<br>
*<br>
* Changes the colour of a line of text in an interface<br>
*<br>
* <a class="mention" href="/u/param">@param</a> id - The interface id of the text field<br>
* <a class="mention" href="/u/param">@param</a> colourId - The colour<br>
* Examples:<br>
* Red - 0x6000<br>
* Yellow - 0x33FF66<br>
* Green - 0x3366<br>
*/<br>
public ActionSender sendInterfaceTextColour(int id, int colourId) {<br>
StreamBuffer.OutBuffer out = StreamBuffer.newOutBuffer(8);<br>
out.writeHeader(player.getEncryptor(), 122);<br>
out.writeShort(id, StreamBuffer.ValueType.A, StreamBuffer.ByteOrder.LITTLE);<br>
out.writeShort(colourId, StreamBuffer.ValueType.A, StreamBuffer.ByteOrder.LITTLE);<br>
player.send(out.getBuffer());</p>
<pre><code>	return this;
}[/code]
</code></pre>
<p>Oh, in your constants file you will need to declare the number of main and side quests (hint, it is 1 for Main Quests and 0 for side quests, add one each time you add a quest)</p>
<p>Note: I have spent quite some time writing this up for my server (Project Stinky-Arse) and I thought it was so pretty, that I should share it with the world. Enjoy. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>OH! One final thing:<br>
To make things like handleNpcFirstClick, firstClickObject and optionSelect work you must find the relevant fields (i.e. your npc first click packet) and add this piece of code (or one similar)</p>
<pre><code class="lang-auto">for (Quest i : player.getQuestHandler().getMainQuest()) {
	if(i.firstClickObject() == true)
		return;
}
for (Quest i : player.getQuestHandler().getSideQuest()) {
	if(i.firstClickObject() == true)
		return;
}</code></pre>
<p>And you also need to do the obvious like declaring:</p>
<p><code>private QuestHandler questHandler = new QuestHandler(this);
public QuestHandler getQuestHandler() {
         return questHandler;
}</code></p>
<p>Inside your player class.</p>
<p>Final final note: Just to assure, this is in no way complete, there are still plenty of additions that could be made (i.e. rewards aren’t handled yet) but it is a damn good start I feel. So I encourage any motivated quest writers to use this if they can. (That’s meant to be a challenge)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/quest-system/441662/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/quest-system/441662/1</link>
        <pubDate>Tue, 08 May 2012 07:18:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-441662-1</guid>
        <source url="https://forum.moparisthebest.com/t/quest-system/441662.rss">Quest System</source>
      </item>
  </channel>
</rss>
