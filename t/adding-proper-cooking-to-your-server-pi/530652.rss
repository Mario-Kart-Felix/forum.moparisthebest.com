<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Adding proper Cooking to your server [PI]</title>
    <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652</link>
    <description>wow haven&#39;t made one of these in awhile eh? :P


[u][b]Table Of Contents[/b][/u]

[iurl=#clickme]I. Introduction (What does this include?)[/iurl]
[iurl=#clickme2]II. Declaring variables[/iurl]
[iurl=#clickme3]III. Adding the [i]Cooking[/i] class[/iurl]
[iurl=#clickme4]IV. Making our objects work[/iurl]
[iurl=#clickme5]V. Making our cooking stop for unexpected actions[/iurl]


[u][b][anchor=clickme]I. Introduction (What does this include?)[/anchor][/b][/u]

This tutorial will start getting a bit complicated around part [iurl=#clickme5][i]V[/i][/iurl] for people who don&#39;t know what they are doing. I had to dumb some stuff down for this to work on the average PI because most people using PI don&#39;t have any sort of skilling system.

What this includes


[ul][li]A wide variety of fish[/li]
[li]You will never burn fish past the correct level[/li]
[li]Accurate burning formulas (credits to some dude from rune-server)[/li]
[li]Easily modifiable xp rate[/li]
[li]Stove and fire cooking, with a higher burn rate on the fire[/li]
[li]Correct levels for cooking and all that other good ish I missed :D[/li][/ul]


Sadly, this does not contain pastries :( I may consider doing an add-on tutorial for pastries though.




[u][b][anchor=clickme2]II. Declaring variables[/anchor][/b][/u]

Declare these in your Player (or Client) class. The importance of each is explained in the documentation.

[code=java]// instance of Cooking so we can access fields in the class
public Cooking cooking = new Cooking();

// flag that determines if we are cooking or not
public boolean isCooking;

// flag that determines if we are using a stove or not
public boolean usingStove;

// the fish you are going to cook
public Cook toCook;[/code]




[u][b][anchor=clickme3]III. Adding the [i]Cooking[/i] class[/anchor][/b][/u]

This class is going to control the whole cooking process, and the exp rates. So if you&#39;re looking to modify the exp rates this is the place to look. Everything is explained inside, its really noob friendly. Add this wherever you see fit.

[code=java]package server.rs2.players.skills.impl;

import java.security.SecureRandom;

import server.Server;
import server.rs2.players.Player;
import server.task.Task;

/**
 * Handles Cooking
 * 
 * @author lare96
 */
public class Cooking {

    /**
     * Burn factor
     */
    public SecureRandom cookingRandom = new SecureRandom();

    /**
     * Possible stuff to cook
     */
    public enum Cook {
        SHRIMP(317, 1, 315, 34, 323),

        SARDINE(327, 5, 325, 38, 369),

        HERRING(345, 10, 347, 37, 357),

        ANCHOVY(321, 15, 319, 34, 323),

        MACKEREL(353, 16, 355, 45, 357),

        TROUT(335, 20, 333, 50, 343),

        COD(341, 23, 339, 39, 343),

        PIKE(349, 25, 351, 52, 343),

        SLIMY_EEL(3379, 28, 3381, 56, 3383),

        SALMON(331, 30, 329, 58, 343),

        TUNA(359, 35, 361, 63, 367),

        CAVE_EEL(5001, 38, 5003, 72, 5002),

        LOBSTER(377, 40, 379, 74, 381),

        BASS(363, 46, 365, 80, 367),

        SWORDFISH(371, 50, 373, 86, 375),

        LAVA_EEL(2148, 53, 2149, 89, 3383),

        SHARK(383, 76, 385, 94, 387);

        /**
         * Id of raw fish
         */
        private int id;

        /**
         * Level to cook
         */
        private int level;

        /**
         * Id of cooked fish
         */
        private int newId;

        /**
         * Level it stops burning at
         */
        private int burnLevel;

        /**
         * The burned fish
         */
        private int burntFish;

        /**
         * Creates data
         */
        Cook(int id, int level, int newId, int burnLevel, int burntFish) {
            this.setId(id);
            this.setLevel(level);
            this.setNewId(newId);
            this.setBurnLevel(burnLevel);
            this.setBurntFish(burntFish);
        }

        /**
         * @return the id
         */
        public int getId() {
            return id;
        }

        /**
         * @param id
         *            the id to set
         */
        public void setId(int id) {
            this.id = id;
        }

        /**
         * @return the level
         */
        public int getLevel() {
            return level;
        }

        /**
         * @param level
         *            the level to set
         */
        public void setLevel(int level) {
            this.level = level;
        }

        /**
         * @return the newId
         */
        public int getNewId() {
            return newId;
        }

        /**
         * @param newId
         *            the newId to set
         */
        public void setNewId(int newId) {
            this.newId = newId;
        }

        /**
         * @return the burnLevel
         */
        public int getBurnLevel() {
            return burnLevel;
        }

        /**
         * @param burnLevel
         *            the burnLevel to set
         */
        public void setBurnLevel(int burnLevel) {
            this.burnLevel = burnLevel;
        }

        /**
         * @return the burntFish
         */
        public int getBurntFish() {
            return burntFish;
        }

        /**
         * @param burntFish
         *            the burntFish to set
         */
        public void setBurntFish(int burntFish) {
            this.burntFish = burntFish;
        }
    }

    /**
     * Cooking interface
     */
    public void viewCookInterface(Player p, int item) {
        p.getPA().sendFrame164(1743);
        p.getPA().sendFrame246(13716, 190, item);
        p.getPA().sendFrame126(&quot;\\n\\n\\n\\n\\n&quot; + p.getItems().getItemName(item) + &quot;&quot;, 13717);
    }

    /**
     * Cook the food
     */
    public void cook(final Player p, final Cook cook, final int amount) {

        // if we are already cooking, do not proceed to cook again
        if (p.isCooking) {
            reset(p);
            return;
        }

        // if we don&#39;t have the item in our inventory anymore, do not proceed
        if (!p.getItems().playerHasItem(cook.getId(), 1)) {
            p.getPA().removeAllWindows();
            return;
        }

        // if our level isn&#39;t high enough, do not proceed
        if (p.playerLevel[7] &lt; cook.getLevel()) {
            p.getPA().removeAllWindows();
            return;
        }

        // we are now cooking... yum :]
        p.isCooking = true;

        p.getPA().removeAllWindows();

        p.startAnimation(!p.usingStove ? 897 : 896);

        p.getItems().deleteItem(cook.getId(), p.getItems().getItemSlot(cook.getId()), 1);

        // burn formula comes into play here :]
        if (!burn(p, cook)) {

            // if we succeed we get the cooked fished
            p.getPA().addSkillXP(exp() * (cook.ordinal() + 1), 7);
            p.getItems().addItem(cook.getNewId(), 1);
        } else {

            // and if we fail we get the burnt fish :[
            p.getItems().addItem(cook.getBurntFish(), 1);
        }

        Server.getTaskScheduler().schedule(new Task(4, false) {
            int i = 1;

            @Override
            public void execute() {

                // if we dc during cooking the task is stopped
                if (p.disconnected) {
                    reset(p);
                    stop();
                    return;
                }

                // i = the amount of fish we have cooked, we need it for the
                // &quot;cook 5&quot;, &quot;cook 10&quot; and &quot;cook all&quot; options
                if (i == amount) {
                    reset(p);
                    stop();
                    return;
                }

                // ran out of fish!
                if (!p.getItems().playerHasItem(cook.getId(), 1)) {
                    p.sendMessage(&quot;You&#39;ve ran out of &quot; + p.getItems().getItemName(cook.getId()) + &quot;.&quot;);
                    reset(p);
                    stop();
                    return;
                }

                // if we have stopped cooking do not proceed
                if (!p.isCooking) {
                    reset(p);
                    stop();
                    return;
                }

                p.getPA().removeAllWindows();
                p.startAnimation(!p.usingStove ? 897 : 896);
                p.getItems().deleteItem(cook.getId(), p.getItems().getItemSlot(cook.getId()), 1);

                // if we are a high enoguh level
                if (p.playerLevel[7] &gt;= cook.getLevel()) {

                    // burn formula comes into play here :]
                    if (!burn(p, cook)) {

                        // if we succeed we get the cooked fished
                        p.getPA().addSkillXP(exp() * (cook.ordinal() + 1), 7);
                        p.getItems().addItem(cook.getNewId(), 1);
                    } else {

                        // and if we fail we get the burnt fish :[
                        p.getItems().addItem(cook.getBurntFish(), 1);
                    }

                }

                i++;
            }
        });
    }

    /**
     * If you burn or not
     */
    public boolean burn(Player p, Cook cook) {
        // Change the 55.0 to whatever you want, the lower it goes the less
        // chance of burning.
        double burn_chance = (55.0 - (p.usingStove ? 4.0 : 0.0));
        double cook_level = (double) p.playerLevel[7];
        double lev_needed = (double) cook.getLevel();
        double burn_stop = (double) cook.getBurnLevel();
        double multi_a = (burn_stop - lev_needed);
        double burn_dec = (burn_chance / multi_a);
        double multi_b = (cook_level - lev_needed);
        burn_chance -= (multi_b * burn_dec);

        double randNum = cookingRandom.nextDouble() * 100.0;

        if (p.playerLevel[7] &gt;= cook.getBurnLevel()) {
            p.sendMessage(&quot;You successfully cook the &quot; + p.getItems().getItemName(cook.getId()) + &quot;.&quot;);
            return false;
        }

        if (burn_chance &lt;= randNum) {
            p.sendMessage(&quot;You successfully cook the &quot; + p.getItems().getItemName(cook.getId()) + &quot;.&quot;);
            return false;
        } else {
            p.sendMessage(&quot;Oops! You accidently burn the &quot; + p.getItems().getItemName(cook.getId()) + &quot;.&quot;);
            return true;
        }
    }

    /**
     * Reset cooking
     */
    public void reset(Player p) {
        p.isCooking = false;
        p.getPA().removeAllWindows();
    }

    /**
     * Base exp
     */
    public int exp() {
        return 30;
    }
}
[/code]




[u][b][anchor=clickme4]IV. Making our objects work[/anchor][/b][/u]

Now that we have our cooking class we need to make it so we can cook on a stove or fire. Open up your ItemOnObject class and inside add this

[code=java]            case 2732:
                for (Cook fish : Cook.values()) {
                    if (fish.getId() == itemId) {
                        c.usingStove = false;
                        c.toCook = fish;
                        c.cooking.viewCookInterface(c, itemId);
                    }
                }
                break;
            case 2728:
                for (Cook fish : Cook.values()) {
                    if (fish.getId() == itemId) {
                        c.usingStove = true;
                        c.toCook = fish;
                        c.cooking.viewCookInterface(c, itemId);
                    }
                }
                break;[/code]


Now, we also need to make sure the &quot;cook 1&quot;, &quot;cook 5&quot;, and &quot;cook all&quot; buttons work on the interface. So add these to your ClickingButtons class

[code=java]            case 53152:
                c.cooking.cook(c, c.toCook, 1);
                break;
            case 53151:
                c.cooking.cook(c, c.toCook, 5);
                break;
            case 53149:
                int i = c.getItems().getItemAmount(c.toCook.getId());

                c.cooking.cook(c, c.toCook, i);
                break;[/code]




[u][b][anchor=clickme5]V. Making our cooking stop for unexpected actions[/anchor][/b][/u]

*sigh* now here is where things get difficult, and here is when you need to take initiative and do things without someone directly spoonfeeding you.

See, the problem is that if the player walks or drops an item or equips something while cooking, you would want the cooking to stop right?

Well this would be 10x easier if you had a skilling system (Which I&#39;m assuming you don&#39;t have) so we&#39;re going to have to do this the hard way.

I&#39;m going to give you an example and then you are going to continue on to the other classes.

Open up your Walking class. You should see something like this

[code=java]public class Walking implements PacketType {

    @Override
    public void processPacket(final Player c, int packetType, int packetSize) {
        c.faceUpdate(0);
        c.npcIndex = 0;
        c.followId = 0;

...[/code]

Under [i]public void processPacket(final Player c, int packetType, int packetSize) {[/i], add this

[code=java]        if (c.isCooking) {
            c.cooking.reset(c);
        }[/code]

This is basically saying &quot;If we are trying to walk and the player is cooking, we will stop cooking, then walk!&quot;

Now here&#39;s the tricky part: I&#39;m going to need you to do this for the [i]ClickItem[/i], [i]DropItem[/i], [i]FollowPlayer[/i], [i]PickupItem[/i], [i]Trade[/i], [i]Walking[/i], [i]WearItem[/i], &amp; [i]RemoveItem[/i] classes

If you accomplished that without screwing up congrats, you don&#39;t suck. :D

Any errors or questions or criticism post below. I have a few other skills to be released (Fishing, Woodcutting, Prayer, Mining, Slayer) so if I see people are actually interested in using this I&#39;ll make some more tutorials for skills!</description>
    
    <lastBuildDate>Sat, 26 Oct 2013 15:17:31 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Int_Bauk Int Bauk]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/int_bauk">@Int_Bauk</a> wrote:</p>
          <blockquote>
              <p>initializing variables is good programming practise. do it. also, for the cases i’d use object definitions and just call it by name.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/13</link>
        <pubDate>Sat, 26 Oct 2013 15:17:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-13</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>ironically i was about to do fletching, will use your base if I get stuck somewhere or need data.</p>
<p>ill give you credits if I do.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/12</link>
        <pubDate>Sun, 20 Oct 2013 19:53:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-12</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@strucker Strucker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/strucker">@strucker</a> wrote:</p>
          <blockquote>
              <p>my work is uglocious so u can be sure i didn’t based on it hehe <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/11</link>
        <pubDate>Sat, 19 Oct 2013 23:37:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-11</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>[quote=“Pwnd, post:9, topic:530652”][quote author=Davidi2 link=topic=649413.msg4364963#msg4364963 date=1379461602]<br>
Did you happen to use my fletching base or one of the cooking bases I wrote as a guide when making this? I can’t help but notice quite a few similarities<br>
[/quote]Would you be mad about that?[/quote]Not mad, I released my skill base already… more curious as to whether it was based off of it or just created with similar design, because a lot of the skills I’ve seen released recently have been similar to this and it would be nice to know my work actually did something</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/10</link>
        <pubDate>Sat, 19 Oct 2013 22:40:40 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-10</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <p>[quote=“Davidi2, post:4, topic:530652”]Did you happen to use my fletching base or one of the cooking bases I wrote as a guide when making this? I can’t help but notice quite a few similarities[/quote]Would you be mad about that?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/9</link>
        <pubDate>Sat, 19 Oct 2013 19:25:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-9</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@strucker Strucker]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/strucker">@strucker</a> wrote:</p>
          <blockquote>
              <p>nice</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/8</link>
        <pubDate>Fri, 18 Oct 2013 21:13:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-8</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>[quote=“luna-scape, post:6, topic:530652”]Thanks man, this is helping me a lot to understand how to add skills.<br>
Very good explained![/quote]<br>
thank you stan <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/7</link>
        <pubDate>Wed, 25 Sep 2013 14:20:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-7</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@luna-scape luna-scape]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/luna-scape">@luna-scape</a> wrote:</p>
          <blockquote>
              <p>Thanks man, this is helping me a lot to understand how to add skills.<br>
Very good explained!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/6</link>
        <pubDate>Tue, 24 Sep 2013 15:33:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-6</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="4" data-topic="530652">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/davidi2/40/2579_1.png" class="avatar"> Davidi2:</div>
<blockquote>
<p>Did you happen to use my fletching base or one of the cooking bases I wrote as a guide when making this? I can’t help but notice quite a few similarities</p>
</blockquote>
</aside>
<p>no, I did find the formula for the burning and some data on r-s though and that’s about it</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/5</link>
        <pubDate>Wed, 18 Sep 2013 02:46:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-5</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>Did you happen to use my fletching base or one of the cooking bases I wrote as a guide when making this? I can’t help but notice quite a few similarities</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/4</link>
        <pubDate>Tue, 17 Sep 2013 23:46:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-4</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="530652">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/mrnessie/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> mrnessie:</div>
<blockquote>
<p>looks fairly clean code, nicely explained, gj</p>
</blockquote>
</aside>
<p>thanks man</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/3</link>
        <pubDate>Tue, 17 Sep 2013 11:30:33 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-3</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@mrnessie mrnessie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mrnessie">@mrnessie</a> wrote:</p>
          <blockquote>
              <p>looks fairly clean code, nicely explained, gj</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/2</link>
        <pubDate>Mon, 16 Sep 2013 09:05:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-2</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
      <item>
        <title>Adding proper Cooking to your server [PI]</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>wow haven’t made one of these in awhile eh? <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p><span class="bbcode-u"><span class="bbcode-b">Table Of Contents</span></span></p>
<p>[iurl=#clickme]I. Introduction (What does this include?)[/iurl]<br>
[iurl=#clickme2]II. Declaring variables[/iurl]<br>
[iurl=#clickme3]III. Adding the <span class="bbcode-i">Cooking</span> class[/iurl]<br>
[iurl=#clickme4]IV. Making our objects work[/iurl]<br>
[iurl=#clickme5]V. Making our cooking stop for unexpected actions[/iurl]</p>
<p><span class="bbcode-u"><span class="bbcode-b">[anchor=clickme]I. Introduction (What does this include?)[/anchor]</span></span></p>
<p>This tutorial will start getting a bit complicated around part [iurl=#clickme5]<span class="bbcode-i">V</span>[/iurl] for people who don’t know what they are doing. I had to dumb some stuff down for this to work on the average PI because most people using PI don’t have any sort of skilling system.</p>
<p>What this includes</p>
<p>[ul][li]A wide variety of fish[/li]<br>
[li]You will never burn fish past the correct level[/li]<br>
[li]Accurate burning formulas (credits to some dude from rune-server)[/li]<br>
[li]Easily modifiable xp rate[/li]<br>
[li]Stove and fire cooking, with a higher burn rate on the fire[/li]<br>
[li]Correct levels for cooking and all that other good ish I missed :D[/li][/ul]</p>
<p>Sadly, this does not contain pastries <img src="https://forum.moparisthebest.com/images/emoji/twitter/frowning.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"> I may consider doing an add-on tutorial for pastries though.</p>
<p><span class="bbcode-u"><span class="bbcode-b">[anchor=clickme2]II. Declaring variables[/anchor]</span></span></p>
<p>Declare these in your Player (or Client) class. The importance of each is explained in the documentation.</p>
<p>[code=java]// instance of Cooking so we can access fields in the class<br>
public Cooking cooking = new Cooking();</p>
<p>// flag that determines if we are cooking or not<br>
public boolean isCooking;</p>
<p>// flag that determines if we are using a stove or not<br>
public boolean usingStove;</p>
<p>// the fish you are going to cook<br>
public Cook toCook;[/code]</p>
<p><span class="bbcode-u"><span class="bbcode-b">[anchor=clickme3]III. Adding the <span class="bbcode-i">Cooking</span> class[/anchor]</span></span></p>
<p>This class is going to control the whole cooking process, and the exp rates. So if you’re looking to modify the exp rates this is the place to look. Everything is explained inside, its really noob friendly. Add this wherever you see fit.</p>
<p>[code=java]package server.rs2.players.skills.impl;</p>
<p>import java.security.SecureRandom;</p>
<p>import server.Server;<br>
import server.rs2.players.Player;<br>
import server.task.Task;</p>
<p>/**</p>
<ul>
<li>
<p>Handles Cooking</p>
</li>
<li>
</li>
<li>
<p><span class="mention">@author</span> lare96<br>
*/<br>
public class Cooking {</p>
<p>/**</p>
<ul>
<li>Burn factor<br>
*/<br>
public SecureRandom cookingRandom = new SecureRandom();</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Possible stuff to cook<br>
*/<br>
public enum Cook {<br>
SHRIMP(317, 1, 315, 34, 323),</p>
<p>SARDINE(327, 5, 325, 38, 369),</p>
<p>HERRING(345, 10, 347, 37, 357),</p>
<p>ANCHOVY(321, 15, 319, 34, 323),</p>
<p>MACKEREL(353, 16, 355, 45, 357),</p>
<p>TROUT(335, 20, 333, 50, 343),</p>
<p>COD(341, 23, 339, 39, 343),</p>
<p>PIKE(349, 25, 351, 52, 343),</p>
<p>SLIMY_EEL(3379, 28, 3381, 56, 3383),</p>
<p>SALMON(331, 30, 329, 58, 343),</p>
<p>TUNA(359, 35, 361, 63, 367),</p>
<p>CAVE_EEL(5001, 38, 5003, 72, 5002),</p>
<p>LOBSTER(377, 40, 379, 74, 381),</p>
<p>BASS(363, 46, 365, 80, 367),</p>
<p>SWORDFISH(371, 50, 373, 86, 375),</p>
<p>LAVA_EEL(2148, 53, 2149, 89, 3383),</p>
<p>SHARK(383, 76, 385, 94, 387);</p>
<p>/**</p>
<ul>
<li>Id of raw fish<br>
*/<br>
private int id;</li>
</ul>
<p>/**</p>
<ul>
<li>Level to cook<br>
*/<br>
private int level;</li>
</ul>
<p>/**</p>
<ul>
<li>Id of cooked fish<br>
*/<br>
private int newId;</li>
</ul>
<p>/**</p>
<ul>
<li>Level it stops burning at<br>
*/<br>
private int burnLevel;</li>
</ul>
<p>/**</p>
<ul>
<li>The burned fish<br>
*/<br>
private int burntFish;</li>
</ul>
<p>/**</p>
<ul>
<li>Creates data<br>
*/<br>
Cook(int id, int level, int newId, int burnLevel, int burntFish) {<br>
this.setId(id);<br>
this.setLevel(level);<br>
this.setNewId(newId);<br>
this.setBurnLevel(burnLevel);<br>
this.setBurntFish(burntFish);<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/return">@return</a> the id<br>
*/<br>
public int getId() {<br>
return id;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/param">@param</a> id</li>
<li>
<pre><code>       the id to set
</code></pre>
</li>
</ul>
<p>*/<br>
public void setId(int id) {<br>
this.id = id;<br>
}</p>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/return">@return</a> the level<br>
*/<br>
public int getLevel() {<br>
return level;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/param">@param</a> level</li>
<li>
<pre><code>       the level to set
</code></pre>
</li>
</ul>
<p>*/<br>
public void setLevel(int level) {<br>
this.level = level;<br>
}</p>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/return">@return</a> the newId<br>
*/<br>
public int getNewId() {<br>
return newId;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/param">@param</a> newId</li>
<li>
<pre><code>       the newId to set
</code></pre>
</li>
</ul>
<p>*/<br>
public void setNewId(int newId) {<br>
this.newId = newId;<br>
}</p>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/return">@return</a> the burnLevel<br>
*/<br>
public int getBurnLevel() {<br>
return burnLevel;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/param">@param</a> burnLevel</li>
<li>
<pre><code>       the burnLevel to set
</code></pre>
</li>
</ul>
<p>*/<br>
public void setBurnLevel(int burnLevel) {<br>
this.burnLevel = burnLevel;<br>
}</p>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/return">@return</a> the burntFish<br>
*/<br>
public int getBurntFish() {<br>
return burntFish;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<a class="mention" href="/u/param">@param</a> burntFish</li>
<li>
<pre><code>       the burntFish to set
</code></pre>
</li>
</ul>
<p>*/<br>
public void setBurntFish(int burntFish) {<br>
this.burntFish = burntFish;<br>
}<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>Cooking interface<br>
*/<br>
public void viewCookInterface(Player p, int item) {<br>
p.getPA().sendFrame164(1743);<br>
p.getPA().sendFrame246(13716, 190, item);<br>
p.getPA().sendFrame126("\n\n\n\n\n" + p.getItems().getItemName(item) + “”, 13717);<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>Cook the food<br>
*/<br>
public void cook(final Player p, final Cook cook, final int amount) {</p>
<p>// if we are already cooking, do not proceed to cook again<br>
if (p.isCooking) {<br>
reset§;<br>
return;<br>
}</p>
<p>// if we don’t have the item in our inventory anymore, do not proceed<br>
if (!p.getItems().playerHasItem(cook.getId(), 1)) {<br>
p.getPA().removeAllWindows();<br>
return;<br>
}</p>
<p>// if our level isn’t high enough, do not proceed<br>
if (p.playerLevel[7] &lt; cook.getLevel()) {<br>
p.getPA().removeAllWindows();<br>
return;<br>
}</p>
<p>// we are now cooking… yum :]<br>
p.isCooking = true;</p>
<p>p.getPA().removeAllWindows();</p>
<p>p.startAnimation(!p.usingStove ? 897 : 896);</p>
<p>p.getItems().deleteItem(cook.getId(), p.getItems().getItemSlot(cook.getId()), 1);</p>
<p>// burn formula comes into play here :]<br>
if (!burn(p, cook)) {</p>
<pre><code> // if we succeed we get the cooked fished
 p.getPA().addSkillXP(exp() * (cook.ordinal() + 1), 7);
 p.getItems().addItem(cook.getNewId(), 1);
</code></pre>
<p>} else {</p>
<pre><code> // and if we fail we get the burnt fish :[
 p.getItems().addItem(cook.getBurntFish(), 1);
</code></pre>
<p>}</p>
<p>Server.getTaskScheduler().schedule(new Task(4, false) {<br>
int i = 1;</p>
<pre><code> @Override
 public void execute() {

     // if we dc during cooking the task is stopped
     if (p.disconnected) {
         reset(p);
         stop();
         return;
     }

     // i = the amount of fish we have cooked, we need it for the
     // "cook 5", "cook 10" and "cook all" options
     if (i == amount) {
         reset(p);
         stop();
         return;
     }

     // ran out of fish!
     if (!p.getItems().playerHasItem(cook.getId(), 1)) {
         p.sendMessage("You've ran out of " + p.getItems().getItemName(cook.getId()) + ".");
         reset(p);
         stop();
         return;
     }

     // if we have stopped cooking do not proceed
     if (!p.isCooking) {
         reset(p);
         stop();
         return;
     }

     p.getPA().removeAllWindows();
     p.startAnimation(!p.usingStove ? 897 : 896);
     p.getItems().deleteItem(cook.getId(), p.getItems().getItemSlot(cook.getId()), 1);

     // if we are a high enoguh level
     if (p.playerLevel[7] &gt;= cook.getLevel()) {

         // burn formula comes into play here :]
         if (!burn(p, cook)) {

             // if we succeed we get the cooked fished
             p.getPA().addSkillXP(exp() * (cook.ordinal() + 1), 7);
             p.getItems().addItem(cook.getNewId(), 1);
         } else {

             // and if we fail we get the burnt fish :[
             p.getItems().addItem(cook.getBurntFish(), 1);
         }

     }

     i++;
 }
</code></pre>
<p>});<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>
<p>If you burn or not<br>
*/<br>
public boolean burn(Player p, Cook cook) {<br>
// Change the 55.0 to whatever you want, the lower it goes the less<br>
// chance of burning.<br>
double burn_chance = (55.0 - (p.usingStove ? 4.0 : 0.0));<br>
double cook_level = (double) p.playerLevel[7];<br>
double lev_needed = (double) cook.getLevel();<br>
double burn_stop = (double) cook.getBurnLevel();<br>
double multi_a = (burn_stop - lev_needed);<br>
double burn_dec = (burn_chance / multi_a);<br>
double multi_b = (cook_level - lev_needed);<br>
burn_chance -= (multi_b * burn_dec);</p>
<p>double randNum = cookingRandom.nextDouble() * 100.0;</p>
<p>if (p.playerLevel[7] &gt;= cook.getBurnLevel()) {<br>
p.sendMessage("You successfully cook the " + p.getItems().getItemName(cook.getId()) + “.”);<br>
return false;<br>
}</p>
<p>if (burn_chance &lt;= randNum) {<br>
p.sendMessage("You successfully cook the " + p.getItems().getItemName(cook.getId()) + “.”);<br>
return false;<br>
} else {<br>
p.sendMessage("Oops! You accidently burn the " + p.getItems().getItemName(cook.getId()) + “.”);<br>
return true;<br>
}<br>
}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>Reset cooking<br>
*/<br>
public void reset(Player p) {<br>
p.isCooking = false;<br>
p.getPA().removeAllWindows();<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>Base exp<br>
*/<br>
public int exp() {<br>
return 30;<br>
}<br>
}<br>
[/code]</li>
</ul>
</li>
</ul>
<p><span class="bbcode-u"><span class="bbcode-b">[anchor=clickme4]IV. Making our objects work[/anchor]</span></span></p>
<p>Now that we have our cooking class we need to make it so we can cook on a stove or fire. Open up your ItemOnObject class and inside add this</p>
<p><code>            case 2732:
                for (Cook fish : Cook.values()) {
                    if (fish.getId() == itemId) {
                        c.usingStove = false;
                        c.toCook = fish;
                        c.cooking.viewCookInterface(c, itemId);
                    }
                }
                break;
            case 2728:
                for (Cook fish : Cook.values()) {
                    if (fish.getId() == itemId) {
                        c.usingStove = true;
                        c.toCook = fish;
                        c.cooking.viewCookInterface(c, itemId);
                    }
                }
                break;</code></p>
<p>Now, we also need to make sure the “cook 1”, “cook 5”, and “cook all” buttons work on the interface. So add these to your ClickingButtons class</p>
<p>[code=java]            case 53152:<br>
c.cooking.cook(c, c.toCook, 1);<br>
break;<br>
case 53151:<br>
c.cooking.cook(c, c.toCook, 5);<br>
break;<br>
case 53149:<br>
int i = c.getItems().getItemAmount(c.toCook.getId());</p>
<pre><code>            c.cooking.cook(c, c.toCook, i);
            break;[/code]
</code></pre>
<p><span class="bbcode-u"><span class="bbcode-b">[anchor=clickme5]V. Making our cooking stop for unexpected actions[/anchor]</span></span></p>
<p><em>sigh</em> now here is where things get difficult, and here is when you need to take initiative and do things without someone directly spoonfeeding you.</p>
<p>See, the problem is that if the player walks or drops an item or equips something while cooking, you would want the cooking to stop right?</p>
<p>Well this would be 10x easier if you had a skilling system (Which I’m assuming you don’t have) so we’re going to have to do this the hard way.</p>
<p>I’m going to give you an example and then you are going to continue on to the other classes.</p>
<p>Open up your Walking class. You should see something like this</p>
<p>[code=java]public class Walking implements PacketType {</p>
<pre><code>@Override
public void processPacket(final Player c, int packetType, int packetSize) {
    c.faceUpdate(0);
    c.npcIndex = 0;
    c.followId = 0;
</code></pre>
<p>…[/code]</p>
<p>Under <span class="bbcode-i">public void processPacket(final Player c, int packetType, int packetSize) {</span>, add this</p>
<p><code>        if (c.isCooking) {
            c.cooking.reset(c);
        }</code></p>
<p>This is basically saying “If we are trying to walk and the player is cooking, we will stop cooking, then walk!”</p>
<p>Now here’s the tricky part: I’m going to need you to do this for the <span class="bbcode-i">ClickItem</span>, <span class="bbcode-i">DropItem</span>, <span class="bbcode-i">FollowPlayer</span>, <span class="bbcode-i">PickupItem</span>, <span class="bbcode-i">Trade</span>, <span class="bbcode-i">Walking</span>, <span class="bbcode-i">WearItem</span>, &amp; <span class="bbcode-i">RemoveItem</span> classes</p>
<p>If you accomplished that without screwing up congrats, you don’t suck. <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>Any errors or questions or criticism post below. I have a few other skills to be released (Fishing, Woodcutting, Prayer, Mining, Slayer) so if I see people are actually interested in using this I’ll make some more tutorials for skills!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652/1</link>
        <pubDate>Mon, 16 Sep 2013 08:12:54 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-530652-1</guid>
        <source url="https://forum.moparisthebest.com/t/adding-proper-cooking-to-your-server-pi/530652.rss">Adding proper Cooking to your server [PI]</source>
      </item>
  </channel>
</rss>
