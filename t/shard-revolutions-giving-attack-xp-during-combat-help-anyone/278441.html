<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/shard-revolutions-giving-attack-xp-during-combat-help-anyone/278441 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 15:10:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Shard Revolutions - Giving attack xp during combat - help anyone? - Runescape - moparisthebest.com</title>
    <meta name="description" content="Well I&amp;#39;ve decided to work on this server, and came across the fact the NPC&amp;#39;s during combat do not give xp. So I&amp;#39;ve been working on this problem for a few hours now I&amp;#39;ve check the constants class I&amp;#39;ve looked through the c&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="278441.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Shard Revolutions - Giving attack xp during combat - help anyone?&#39;" href="278441.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/shard-revolutions-giving-attack-xp-during-combat-help-anyone/278441" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/shard-revolutions-giving-attack-xp-during-combat-help-anyone/278441" />
<meta property="og:title" content="Shard Revolutions - Giving attack xp during combat - help anyone?" />
<meta name="twitter:title" content="Shard Revolutions - Giving attack xp during combat - help anyone?" />
<meta property="og:description" content="Well I’ve decided to work on this server, and came across the fact the NPC’s during combat do not give xp. So I’ve been working on this problem for a few hours now I’ve check the constants class I’ve looked through the combatmanager class and found the code for it and it looks fine to me.  [code]  public void resetAttack() {  isFighting = false;  if (targetNPC != null) {  targetNPC.getAttackers().remove(client);  if (targetNPC.getAttacker() == client) {  if (targetNPC.getAttackers().entrySet().i..." />
<meta name="twitter:description" content="Well I’ve decided to work on this server, and came across the fact the NPC’s during combat do not give xp. So I’ve been working on this problem for a few hours now I’ve check the constants class I’ve looked through the combatmanager class and found the code for it and it looks fine to me.  [code]  public void resetAttack() {  isFighting = false;  if (targetNPC != null) {  targetNPC.getAttackers().remove(client);  if (targetNPC.getAttacker() == client) {  if (targetNPC.getAttackers().entrySet().i..." />
<meta property="article:published_time" content="2009-05-15T03:50:26+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="278441.html">Shard Revolutions - Giving attack xp during combat - help anyone?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Scully.html'><span itemprop='name'>Scully</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-05-15T03:50:26Z'>
            <time itemprop='dateModified' datetime='2016-07-31T07:38:02Z' class='post-time'>
              July 31, 2016,  7:38am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Well I’ve decided to work on this server, and came across the fact the NPC’s during combat do not give xp. So I’ve been working on this problem for a few hours now I’ve check the constants class I’ve looked through the combatmanager class and found the code for it and it looks fine to me.</p>
<p>[code]</p>
<p>public void resetAttack() {<br>
isFighting = false;<br>
if (targetNPC != null) {<br>
targetNPC.getAttackers().remove(client);<br>
if (targetNPC.getAttacker() == client) {<br>
if (targetNPC.getAttackers().entrySet().iterator().hasNext()) {<br>
targetNPC.setAttacker(targetNPC.getAttackers().entrySet()<br>
.iterator().next().getKey());<br>
} else {<br>
targetNPC.setWalking(targetNPC.isWasWalking());<br>
targetNPC.setAttacker(null);<br>
}<br>
}<br>
targetNPC = null; // lose our ref<br>
}<br>
if(targetPlayer != null) {<br>
targetPlayer.getCombatManager().attackers.remove(client);<br>
if(targetPlayer.getCombatManager().attacker == client) {<br>
targetPlayer.getCombatManager().attacker = null;<br>
if(targetPlayer.getCombatManager().attackers.entrySet().iterator().hasNext()) {<br>
targetPlayer.getCombatManager().attacker = targetPlayer.getCombatManager().attackers.entrySet().iterator().next().getKey();<br>
} else {<br>
targetPlayer.getCombatManager().resetAttack();<br>
}<br>
}<br>
targetPlayer = null;<br>
}<br>
}</p>
<pre><code>public void attackPlayer(int attackplayer) {
	/**
	 * RUN CHECKS
	 */
	if (!isFighting) {
		if (client.checkBusy()) {
			return;
		}
	} else {
		if (targetNPC != null) {
			resetAttack();
		} else if (targetPlayer != null) {
			if(targetPlayer.playerId != attackplayer) {
				resetAttack();
			} else {
				return;
			}
		}
	}
	
	/**
	 * GET PLAYER OBJECT
	 */
	targetPlayer = (Client) Server.getPlayerManager().getPlayers()[attackplayer];
	if(targetPlayer == null) return;
	
	if(wildernessLevel == -1 || targetPlayer.getCombatManager().wildernessLevel == -1) {
		client.getActionAssistant().sendMessage("You cannot attack other players unless you are in the wilderness.");
		return;
	}
	int lvldiff = Math.abs(client.getCombatLevel() - targetPlayer.getCombatLevel());
	if(lvldiff &gt;= wildernessLevel) {
		client.getActionAssistant().sendMessage("Your level difference is too great. Move deeper into the wilderness.");
		return;
	}
	
	/**
	 * INITIALISE ATTACK
	 */
	isFighting = true;
	
	/**
	 * WE GET FIRST HIT.
	 */
	isMyTurn = true;
	
	final Client myTarget = targetPlayer;
	
	if(targetPlayer.getCombatManager().attacker == null) {
		targetPlayer.getCombatManager().attacker = client;
	}
	
	/**
	 * NOW GET THE EVENT GOING ALREADY
	 */
	EventManager.getSingleton().addEvent(null, new Event() {
		
		@Override
		public void execute(EventContainer container) {
			if (!client.isActive || client.disconnected || !isFighting
					|| targetPlayer != myTarget || targetNPC != null || targetPlayer == null) {
				container.stop();
				return;
			}
			pvpTick(container);
			//if(!counterAttack &amp;&amp; targetPlayer != null) {
				//targetPlayer.getCombatManager().attackPlayer(client.playerId);
				//counterAttack = true;
			//}
			container
					.setTick((int) (getWeaponDelay()));
		}

		@Override
		public void stop() {
			resetAttack();
		}

	}, getWeaponDelay());
}
</code></pre>
<p>/**<br>
* Pvp tick.<br>
* <a class="mention" href="../../u/param.html">@param</a> c<br>
*/<br>
public void pvpTick(EventContainer c) {<br>
if(wildernessLevel == -1 || targetPlayer.getCombatManager().wildernessLevel == -1) {<br>
client.getActionAssistant().sendMessage(“You cannot attack other players unless you are in the wilderness.”);<br>
resetAttack();<br>
return;<br>
}<br>
int lvldiff = Math.abs(client.getCombatLevel() - targetPlayer.getCombatLevel());<br>
if(lvldiff &gt;= wildernessLevel) {<br>
client.getActionAssistant().sendMessage(“Your level difference is too great. Move deeper into the wilderness.”);<br>
resetAttack();<br>
return;<br>
}<br>
if(!client.withinInteractionDistance(targetPlayer) || client.isDead() || client.didTeleport || targetPlayer.isDead()) {<br>
resetAttack();<br>
return;<br>
}<br>
if(isMyTurn) {<br>
client.getActionAssistant().startAnimation(<br>
AnimationManager.getAttackAnimation(client));<br>
int hit = (int) Math.ceil(Math.random() * (double) getMaxHit());<br>
targetPlayer.getActionAssistant().hit(hit, 1);<br>
Integer hits = targetPlayer.getCombatManager().attackers.get(client);<br>
if(hits == null) {<br>
targetPlayer.getCombatManager().attackers.put(client, hit);<br>
} else {<br>
targetPlayer.getCombatManager().attackers.put(client, (hits+hit));<br>
}<br>
client.getActionAssistant().turnTo(targetPlayer.getAbsX(), targetPlayer.getAbsY());<br>
if(targetPlayer.getCombatManager().attacker == client) {<br>
targetPlayer.getActionAssistant().turnTo(client.getAbsX(), client.getAbsY());<br>
targetPlayer.getActionAssistant().startAnimation(AnimationManager.getDefendAnimation(targetPlayer));<br>
}<br>
if (fightType != 3) {<br>
double combatExp = (double) (25 * hit), hitpointsExp = (double) (50 * hit);<br>
client.getActionAssistant().addSkillXP(combatExp, fightSkillID);<br>
client.getActionAssistant().addSkillXP(hitpointsExp,<br>
SkillConstants.HITPOINTS);<br>
} else {<br>
double combatExp = (double) (25 * hit), hitpointsExp = (double) (50 * hit);<br>
client.getActionAssistant().addSkillXP(combatExp,<br>
SkillConstants.ATTACK);<br>
client.getActionAssistant().addSkillXP(combatExp,<br>
SkillConstants.DEFENCE);<br>
client.getActionAssistant().addSkillXP(combatExp,<br>
SkillConstants.STRENGTH);			<br>
client.getActionAssistant().addSkillXP(hitpointsExp,<br>
SkillConstants.HITPOINTS);<br>
}<br>
}</p>
<pre><code>	NPC npc = targetNPC;
	if(!client.withinInteractionDistance(npc)) {
		resetAttack();
		return;
	}
	if (client.isDead()) {
		resetAttack();
		return;
	}
	if (client.didTeleport || npc.isDead()
			|| !client.withinInteractionDistance(npc)) {
		resetAttack();
		return;
	}
	client.getActionAssistant().turnTo(npc.getAbsX(), npc.getAbsY());
	if (npc.getAttacker() == client) {
		npc.faceTo(client.playerId);
	}
	if (isMyTurn) {
		client.getActionAssistant().startAnimation(
				AnimationManager.getAttackAnimation(client));
		int hit = (int) Math.ceil(Math.random() * (double) getMaxHit());
		if (fightType != 3) {
			double combatExp = (double) (25 * hit), hitpointsExp = (double) (50 * hit);
			client.getActionAssistant().addSkillXP(combatExp, fightSkillID);
			client.getActionAssistant().addSkillXP(hitpointsExp,
					SkillConstants.HITPOINTS);
		} else {
			double combatExp = (double) (25 * hit), hitpointsExp = (double) (50 * hit);
			client.getActionAssistant().addSkillXP(combatExp,
					SkillConstants.ATTACK));
			client.getActionAssistant().addSkillXP(combatExp,
					SkillConstants.DEFENCE);
			client.getActionAssistant().addSkillXP(combatExp,
					SkillConstants.STRENGTH);
			client.getActionAssistant().addSkillXP(hitpointsExp,
					SkillConstants.HITPOINTS);
		}
		npc.hit(client, hit, 1);
		if (npc.getAttacker() == client) {
			npc.setAnimNumber(AnimationManager.getDefendAnimation(npc));
			npc.setAnimUpdateRequired(true);
			npc.setUpdateRequired(true);
		}

	} else {
		if (npc.getAttacker() == client) {
			npc.setAnimNumber(AnimationManager.getAttackAnimation(npc));
			npc.setAnimUpdateRequired(true);
			npc.setUpdateRequired(true);
			int hit = (int) Math.ceil(Math.random()
					* (double) npc.getDefinition().getMaximumHit());
			npc.faceTo(client.playerId);
			client.getActionAssistant().hit(hit, 1);
			client.getActionAssistant().startAnimation(
					AnimationManager.getDefendAnimation(client));
		}
	}
	// thanks hcojustin for pointing this out
	if (doubleHit) {
		doubleHit = false;
		isMyTurn = !isMyTurn;
	} else {
		if (Math.random() &gt; SWAP_FACTOR) {
			isMyTurn = !isMyTurn;
		} else {
			doubleHit = true;
		}
	}
}

public void attackNPC(int id) {
	/**
	 * RUN CHECKS
	 */
	if (!isFighting) {
		if (client.checkBusy()) {
			return;
		}
	} else {
		if (targetNPC != null) {
			if (targetNPC.isDead()) {
				resetAttack();
				return;
			}
			if (targetNPC.getNpcId() == id) {
				return;
			} else {
				resetAttack();
			}
		}
	}[/code]
</code></pre>
<p>So if anyone can help me here please do. It’s not really urgent or anything so yeah…</p>
      </div>

      <meta itemprop='headline' content='Shard Revolutions - Giving attack xp during combat - help anyone?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/shard-revolutions-giving-attack-xp-during-combat-help-anyone/278441 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Aug 2019 15:10:49 GMT -->
</html>
