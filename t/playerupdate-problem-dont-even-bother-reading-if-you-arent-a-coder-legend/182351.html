<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/playerupdate-problem-dont-even-bother-reading-if-you-arent-a-coder-legend/182351 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Aug 2019 18:17:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend - Runescape - moparisthebest.com</title>
    <meta name="description" content="All right, here it goes. My server (Somescape PK) is a PK server, and where you respawn is right near the main pking area, which is why this is such a huge problem for my server. Here is what I know about it. 

When some&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="182351.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend&#39;" href="182351.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/playerupdate-problem-dont-even-bother-reading-if-you-arent-a-coder-legend/182351" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/playerupdate-problem-dont-even-bother-reading-if-you-arent-a-coder-legend/182351" />
<meta property="og:title" content="Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend" />
<meta name="twitter:title" content="Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend" />
<meta property="og:description" content="All right, here it goes. My server (Somescape PK) is a PK server, and where you respawn is right near the main pking area, which is why this is such a huge problem for my server. Here is what I know about it.  When someone teleports, if they change map regions, the server tells all of the clients in the map region to add that player to their list of visible clients. However, if they don’t change map regions, the server doesn’t tell the clients in the target map region to update their information..." />
<meta name="twitter:description" content="All right, here it goes. My server (Somescape PK) is a PK server, and where you respawn is right near the main pking area, which is why this is such a huge problem for my server. Here is what I know about it.  When someone teleports, if they change map regions, the server tells all of the clients in the map region to add that player to their list of visible clients. However, if they don’t change map regions, the server doesn’t tell the clients in the target map region to update their information..." />
<meta property="article:published_time" content="2008-02-18T04:17:16+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="182351.html">Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/yppman.html'><span itemprop='name'>yppman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2008-02-18T04:17:16Z'>
            <time itemprop='dateModified' datetime='2016-07-30T19:50:47Z' class='post-time'>
              July 30, 2016,  7:50pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>All right, here it goes. My server (Somescape PK) is a PK server, and where you respawn is right near the main pking area, which is why this is such a huge problem for my server. Here is what I know about it.</p>
<p>When someone teleports, if they change map regions, the server tells all of the clients in the map region to add that player to their list of visible clients. However, if they don’t change map regions, the server doesn’t tell the clients in the target map region to update their information on that player. This is NOT the correct way of handling this, because then if the teleported client’s absolute x and y coordinates change when it teleports, the other clients don’t register it, causing the player to appear on the wrong spot on the screen. Then, when the incorrectly-cached player walks, since the walking packets are relative to their current position, they walk through places that they aren’t really walking through, like walls, causing mass confusion. Also, since a player appears in the wrong position to other players, that player can pk people while the people they are attacking don’t see them next to them, but 10 squares away, making it seem as if they are attacked by nothing. I have traced this entire problem down to a method in playerhandler.java, but just can’t figure out how to fix it. I do however, think I know what part of the method is causing the problem. Here is the method. I have made a comment next to the part that I think is causing the problem.</p>
<p>[code]	public void updatePlayer(Player plr, stream str) {<br>
updateBlock.currentOffset = 0;</p>
<pre><code>	if (updateRunning &amp;&amp; !updateAnnounced) {
		str.createFrame(114);
		str.writeWordBigEndian(updateSeconds*50/30);
	}

	// update thisPlayer
	plr.updateThisPlayerMovement(str);		// handles walking/running and teleporting
	// do NOT send chat text back to thisPlayer!
	boolean saveChatTextUpdate = plr.chatTextUpdateRequired;
	plr.chatTextUpdateRequired = false;
	plr.appendPlayerUpdateBlock(updateBlock);
	plr.chatTextUpdateRequired = saveChatTextUpdate;

	str.writeBits(8, plr.playerListSize);
	int size = plr.playerListSize;

	// update/remove players that are already in the playerList
	plr.playerListSize = 0;		// we're going to rebuild the list right away
	for(int i = 0; i &lt; size; i++) {
		// this update packet does not support teleporting of other players directly
		// instead we're going to remove this player here and readd it right away below
		if(plr.didTeleport == false &amp;&amp; plr.withinDistance(plr.playerList[i]) == true) {
			plr.playerList[i].updatePlayerMovement(str);
			plr.playerList[i].appendPlayerUpdateBlock(updateBlock);
			plr.playerList[plr.playerListSize++] = plr.playerList[i];
		} else {
			int id = plr.playerList[i].playerId;
			plr.playerInListBitmap[id&gt;&gt;3] &amp;= ~(1 &lt;&lt; (id&amp;7));		// clear the flag
			str.writeBits(1, 1);
			str.writeBits(2, 3);		// tells client to remove this char from list
		}
	}

	// iterate through all players to check whether there's new players to add
	for(int i = 0; i &lt; maxPlayers; i++) {
		if(players[i] == null || players[i].isActive == false || players[i] == plr) {
			//not existing, not active or you are that player
		} else {
			int id = players[i].playerId;
			if(plr.didTeleport == false &amp;&amp; (plr.playerInListBitmap[id&gt;&gt;3]&amp;(1 &lt;&lt; (id&amp;7))) != 0) {
					//I think the problem is here, this part should be handled!
			} else if(plr.withinDistance(players[i]) == false) {
				// out of sight
			} else {
				plr.addNewPlayer(players[i], str, updateBlock);
			}
		}
	}

	if(updateBlock.currentOffset &gt; 0) {
		str.writeBits(11, 2047);	// magic EOF - needed only when player updateblock follows
		str.finishBitAccess();

		// append update block
		str.writeBytes(updateBlock.buffer, updateBlock.currentOffset, 0);
	} else {
		str.finishBitAccess();
	}
	str.endFrameVarSizeWord();
}[/code]</code></pre>
      </div>

      <meta itemprop='headline' content='Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vanack.html'><span itemprop='name'>Vanack</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2008-02-18T04:25:38Z'>
            <time itemprop='dateModified' datetime='2016-07-30T19:50:49Z' class='post-time'>
              July 30, 2016,  7:50pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>TBH, I have never in my life run into such a problem. I ussually re-direct some code files, and get over it. I can’t help.</p>
      </div>

      <meta itemprop='headline' content='Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/yppman.html'><span itemprop='name'>yppman</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2008-02-18T04:28:24Z'>
            <time itemprop='dateModified' datetime='2019-02-24T03:14:54Z' class='post-time'>
              February 24, 2019,  3:14am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote no-group quote-modified" data-post="2" data-topic="182351">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/vanack/40/5_6bca9977b612b7aeef77ba1ec1cd67b3.png" class="avatar"> Vanack:</div>
<blockquote>
<p>TBH, I have never in my life run into such a problem. I ussually re-direct some code files, and get over it. I can’t help.</p>
</blockquote>
</aside>
<p>As I said, this is EXTREMELY complex. It may just be that only Xerocheez himself could fix this.[br][br][size=1]Posted on: February 17, 2008, 06:47:35 PM[/size][hr]Oh, COME ON! SOMEBODY has to have a fix for this!</p>
      </div>

      <meta itemprop='headline' content='Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/projectpkerz.html'><span itemprop='name'>projectpkerz</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2008-03-06T09:47:52Z'>
            <time itemprop='dateModified' datetime='2016-07-30T20:22:16Z' class='post-time'>
              July 30, 2016,  8:22pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>xerocheez can fix this like u said “extremly complex”</p>
      </div>

      <meta itemprop='headline' content='Playerupdate problem, don&#39;t even bother reading if you aren&#39;t a coder legend'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/playerupdate-problem-dont-even-bother-reading-if-you-arent-a-coder-legend/182351 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Aug 2019 18:17:27 GMT -->
</html>
