<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Chat text unpacking</title>
    <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493</link>
    <description>While working on my server I wanted to be able to convert the chat bytes we receive to a string
so I can log the chat.
I took the unpacking method from another server but it didn&#39;t work,
after many tests and searching I noticed that many servers have the text unpacking commented out
for the simple reason that it doesn&#39;t convert right.

I converted the method from the client and put it in the server and got it working right.

[code=java]
    /**
    * Converts bytes to text by the RS2 codec.
    * 
    * @param packedData The bytes to convert.
    * 
    * @param size The size of the buffer.
    * 
    * @return The converted bytes as string.
    */
    public static String getBytesAsString(byte packedData[], int size) {
    	char[] characters = new char[100];
    	
    	int position = 0;
    	
    	for (int i = 0; i &lt; size; i++) {
    		characters[position++] = XLATE_TABLE[packedData[i]];
    	}
    	for (int i = 0; i &lt; position; i++) {
    		char c = characters[i];
			
    		if (c &gt;= &#39;a&#39; &amp;&amp; c &lt;= &#39;z&#39;) {
			characters[i] += &#39;\uFFE0&#39;;
    		}
    	}
	return new String(characters, 0, position).toLowerCase();
    }

    private static char XLATE_TABLE[] = {
		&#39; &#39;, &#39;e&#39;, &#39;t&#39;, &#39;a&#39;, &#39;o&#39;, &#39;i&#39;, &#39;h&#39;, &#39;n&#39;, &#39;s&#39;, &#39;r&#39;, 
		&#39;d&#39;, &#39;l&#39;, &#39;u&#39;, &#39;m&#39;, &#39;w&#39;, &#39;c&#39;, &#39;y&#39;, &#39;f&#39;, &#39;g&#39;, &#39;p&#39;, 
		&#39;b&#39;, &#39;v&#39;, &#39;k&#39;, &#39;x&#39;, &#39;j&#39;, &#39;q&#39;, &#39;z&#39;, &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, 
		&#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39; &#39;, &#39;!&#39;, &#39;?&#39;, 
		&#39;.&#39;, &#39;,&#39;, &#39;:&#39;, &#39;;&#39;, &#39;(&#39;, &#39;)&#39;, &#39;-&#39;, &#39;&amp;&#39;, &#39;*&#39;, &#39;\\&#39;, 
		&#39;\&#39;&#39;, &#39;@&#39;, &#39;#&#39;, &#39;+&#39;, &#39;=&#39;, &#39;\243&#39;, &#39;$&#39;, &#39;%&#39;, &#39;&quot;&#39;, &#39;[&#39;, 
		&#39;]&#39;, &#39;&gt;&#39;, &#39;&lt;&#39;, &#39;^&#39;, &#39;/&#39;, &#39;_&#39;
	};
[/code]

[b]Example usage:[/b]
[code=java]
	int effects = packet.getSubtrahendByte();
	int color = packet.getSubtrahendByte();
	int chatLength = (packet.getLength() - 2);
	byte[] text = packet.getAdditionalBytesReversed(chatLength);

	if (effects &lt; 0 || color &lt; 0 || chatLength &lt; 0 || text == null) {
		return;
	}
	player.addStateUpdate(new ChatState(text, color, effects));

	PlayerDataAccess.log(player, PlayerLogTypes.CHAT, StringUtil.getBytesAsString(text, chatLength)); //USAGE OF TEXT UNPACK
	Logger.debug(&quot;[Chat][&quot; + player.getUsername() + &quot;] - size: &quot; + chatLength + &quot;, text: &quot; + StringUtil.getBytesAsString(text, chatLength)); //USAGE OF TEXT UNPACK
[/code]
Here at the bottom of the code you can see I use the text unpacking to convert the chat bytes to a string and
use it for logging purposes.


[b]Note:[/b] If you are going to use this, check your &quot;xlatetable&quot; as it might be different than the one used here.
In order for this to work you need the one I provided with the code above.</description>
    
    <lastBuildDate>Sun, 01 Feb 2015 04:17:13 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>[quote=“stCky, post:14, topic:549493”]I tried to congratulate you for solving then sharing your problem, but it seems you are shut out not only to technical criticism but also compliments (y)</p>
<p>retard of the year 2015 goes to you good sir, is there an option so all of one users posts don’t show up? L0L[/quote]<br>
LOL i love you</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/17</link>
        <pubDate>Sun, 01 Feb 2015 04:17:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-17</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@eyeownyew Eyeownyew]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/eyeownyew">@eyeownyew</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="15" data-topic="549493">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sk8rdude461/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sk8rdude461:</div>
<blockquote>
<p>Go into your profile and add him to your ignore list.</p>
</blockquote>
</aside>
<p>thanks I didn’t know this was a function but now I don’t need to see stCky’s annoying ass posts anymore</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/16</link>
        <pubDate>Sat, 31 Jan 2015 23:28:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-16</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“stCky, post:14, topic:549493”]I tried to congratulate you for solving then sharing your problem, but it seems you are shut out not only to technical criticism but also compliments (y)</p>
<p>retard of the year 2015 goes to you good sir, is there an option so all of one users posts don’t show up? L0L[/quote]<br>
Go into your profile and add him to your ignore list.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/15</link>
        <pubDate>Sat, 31 Jan 2015 22:57:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-15</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@stCky stCky]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/stcky">@stCky</a> wrote:</p>
          <blockquote>
              <p>I tried to congratulate you for solving then sharing your problem, but it seems you are shut out not only to technical criticism but also compliments (y)</p>
<p>retard of the year 2015 goes to you good sir, is there an option so all of one users posts don’t show up? L0L</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/14</link>
        <pubDate>Sat, 31 Jan 2015 22:53:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-14</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“stCky, post:12, topic:549493”][quote author=RandQm link=topic=668395.msg4470641#msg4470641 date=1422739536]</p>
<aside class="quote">
<blockquote>
<p>Glad you got there in the end (y)</p>
<p>Not gonna bash on about git anymore, that was more an attitude thing anyway.</p>
</blockquote>
</aside>
<p>Got where?<br>
[/quote]</p>
<p>Not sure if srs</p>
<aside class="quote">
<blockquote>
<p>…the server<span class="bbcode-i"> and got it working right.</span>[/quote]</p>
</blockquote>
</aside>
<p>No clue what you’re talking 'bout</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/13</link>
        <pubDate>Sat, 31 Jan 2015 22:34:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-13</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@stCky stCky]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/stcky">@stCky</a> wrote:</p>
          <blockquote>
              <p>[quote=“RandQm, post:11, topic:549493”][quote author=stCky link=topic=668395.msg4470640#msg4470640 date=1422739160]<br>
Glad you got there in the end (y)</p>
<p>Not gonna bash on about git anymore, that was more an attitude thing anyway.<br>
[/quote]<br>
Got where?[/quote]</p>
<p>Not sure if srs</p>
<blockquote>...the server[i] and got it working right.[/i]</blockquote>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/12</link>
        <pubDate>Sat, 31 Jan 2015 21:50:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-12</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“stCky, post:10, topic:549493”]Glad you got there in the end (y)</p>
<p>Not gonna bash on about git anymore, that was more an attitude thing anyway.[/quote]<br>
Got where?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/11</link>
        <pubDate>Sat, 31 Jan 2015 21:25:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-11</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@stCky stCky]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/stcky">@stCky</a> wrote:</p>
          <blockquote>
              <p>Glad you got there in the end (y)</p>
<p>Not gonna bash on about git anymore, that was more an attitude thing anyway.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/10</link>
        <pubDate>Sat, 31 Jan 2015 21:19:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-10</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="8" data-topic="549493">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/randqm/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> RandQm:</div>
<blockquote>
<p>No no, the text unpacking you posted didnt work, that’s why i went to the client to look for something working</p>
</blockquote>
</aside>
<p>I didn’t see you post that… That’s strange it didn’t work, as it works fine in mine (Must be something with the bits or my xlatetable maybe)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/9</link>
        <pubDate>Fri, 30 Jan 2015 22:59:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-9</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“sk8rdude461, post:7, topic:549493”][quote author=RandQm link=topic=668395.msg4470317#msg4470317 date=1422618343]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>I took the unpacking method from another server but it didn’t work,<br>
after many tests and searching I noticed that many servers have the text unpacking commented out<br>
for the simple reason that it doesn’t convert right.[/quote]<br>
Yes, but you also made the thread after that one saying your text unpacking was wrong.<br>
When I gave you a working one in the first thread…</p>
</blockquote>
</aside>
<p>mind to link me because the thread I made after the one you linked was about my bytes reading being wrong</p>
</blockquote>
</aside>
<p><a href="https://www.moparisthebest.com/smf/index.php/topic,668319.msg4470143.html#msg4470143" class="onebox" target="_blank" rel="nofollow noopener">https://www.moparisthebest.com/smf/index.php/topic,668319.msg4470143.html#msg4470143</a></p>
<aside class="quote">
<blockquote>
<p>I <span class="bbcode-b">took the text unpacking from the client</span>, it also works for my private messages so I assume this is good now.<br>
The array (reading the packet) still looks good as well, seems like I’m almost there.</p>
</blockquote>
</aside>
<p>And then in that same post you ended up solving your issue.[/quote]<br>
No no, the text unpacking you posted didnt work, that’s why i went to the client to look for something working</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/8</link>
        <pubDate>Fri, 30 Jan 2015 22:33:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-8</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“RandQm, post:6, topic:549493”][quote author=sk8rdude461 link=topic=668395.msg4470315#msg4470315 date=1422616202]</p>
<aside class="quote">
<blockquote>
<p>I took the unpacking method from another server but it didn’t work,<br>
after many tests and searching I noticed that many servers have the text unpacking commented out<br>
for the simple reason that it doesn’t convert right.[/quote]<br>
Yes, but you also made the thread after that one saying your text unpacking was wrong.<br>
When I gave you a working one in the first thread…</p>
</blockquote>
</aside>
<p>mind to link me because the thread I made after the one you linked was about my bytes reading being wrong[/quote]<br>
<a href="https://www.moparisthebest.com/smf/index.php/topic,668319.msg4470143.html#msg4470143" class="onebox" target="_blank" rel="nofollow noopener">https://www.moparisthebest.com/smf/index.php/topic,668319.msg4470143.html#msg4470143</a></p>
<p>[quote=“RandQm, post:39, topic:549416”]I <span class="bbcode-b">took the text unpacking from the client</span>, it also works for my private messages so I assume this is good now.<br>
The array (reading the packet) still looks good as well, seems like I’m almost there.[/quote]<br>
And then in that same post you ended up solving your issue.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/7</link>
        <pubDate>Fri, 30 Jan 2015 21:02:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-7</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“sk8rdude461, post:5, topic:549493”][quote author=RandQm link=topic=668395.msg4470313#msg4470313 date=1422614899]<br>
I took the unpacking method from another server but it didn’t work,<br>
after many tests and searching I noticed that many servers have the text unpacking commented out<br>
for the simple reason that it doesn’t convert right.[/quote]<br>
Yes, but you also made the thread after that one saying your text unpacking was wrong.<br>
When I gave you a working one in the first thread…[/quote]<br>
mind to link me because the thread I made after the one you linked was about my bytes reading being wrong</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/6</link>
        <pubDate>Fri, 30 Jan 2015 11:45:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-6</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“RandQm, post:4, topic:549493”]I took the unpacking method from another server but it didn’t work,<br>
after many tests and searching I noticed that many servers have the text unpacking commented out<br>
for the simple reason that it doesn’t convert right.[/quote]<br>
Yes, but you also made the thread after that one saying your text unpacking was wrong.<br>
When I gave you a working one in the first thread…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/5</link>
        <pubDate>Fri, 30 Jan 2015 11:10:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-5</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“sk8rdude461, post:3, topic:549493”]That’s funny… Because when I was helping you on one of your threads, you said that you don’t need the textUnpack method I gave you. But here you are giving out the same thing (not the same code)?</p>
<p>Confused…<br>
<a href="https://www.moparisthebest.com/smf/index.php/topic,668300.msg4469532.html#msg4469532" class="onebox" target="_blank" rel="nofollow noopener">https://www.moparisthebest.com/smf/index.php/topic,668300.msg4469532.html#msg4469532</a></p>
<p>[quote author=sk8rdude461 link=topic=668300.msg4469532#msg4469532 date=1422216314]<br>
Edit:</p>
<p>The textUnpack method is totally different than either, I don’t know if it’s of any use… but it’s here</p>
<p>[code=java]	public static String textUnpack(byte packedData[], int size) {<br>
int idx = 0, highNibble = -1;<br>
for (int i = 0; i &lt; size * 2; i++) {<br>
int val = packedData[i / 2] &gt;&gt; (4 - 4 * (i % 2)) &amp; 0xf;<br>
if (highNibble == -1) {<br>
if (val &lt; 13)<br>
decodeBuf[idx++] = xlateTable[val];<br>
else<br>
highNibble = val;<br>
} else {<br>
decodeBuf[idx++] = xlateTable[((highNibble &lt;&lt; 4) + val) - 195];<br>
highNibble = -1;<br>
}<br>
}</p>
<pre><code>	return new String(decodeBuf, 0, idx);
}[/code]
</code></pre>
<p>[/quote][/quote]</p>
<p>What? The issue in that thread wasn’t about text unpacking but about reading the bytes that represent the text.<br>
Also as I said:</p>
<blockquote>I took the unpacking method from another server but it didn't work,
after many tests and searching I noticed that many servers have the text unpacking commented out
for the simple reason that it doesn't convert right.</blockquote>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/4</link>
        <pubDate>Fri, 30 Jan 2015 10:48:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-4</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>That’s funny… Because when I was helping you on one of your threads, you said that you don’t need the textUnpack method I gave you. But here you are giving out the same thing (not the same code)?</p>
<p>Confused…<br>
<a href="https://www.moparisthebest.com/smf/index.php/topic,668300.msg4469532.html#msg4469532" class="onebox" target="_blank" rel="nofollow noopener">https://www.moparisthebest.com/smf/index.php/topic,668300.msg4469532.html#msg4469532</a></p>
<p>[quote=“sk8rdude461, post:2, topic:549396”]Edit:</p>
<p>The textUnpack method is totally different than either, I don’t know if it’s of any use… but it’s here</p>
<p>[code=java]	public static String textUnpack(byte packedData[], int size) {<br>
int idx = 0, highNibble = -1;<br>
for (int i = 0; i &lt; size * 2; i++) {<br>
int val = packedData[i / 2] &gt;&gt; (4 - 4 * (i % 2)) &amp; 0xf;<br>
if (highNibble == -1) {<br>
if (val &lt; 13)<br>
decodeBuf[idx++] = xlateTable[val];<br>
else<br>
highNibble = val;<br>
} else {<br>
decodeBuf[idx++] = xlateTable[((highNibble &lt;&lt; 4) + val) - 195];<br>
highNibble = -1;<br>
}<br>
}</p>
<pre><code>	return new String(decodeBuf, 0, idx);
}[/code][/quote]</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/3</link>
        <pubDate>Fri, 30 Jan 2015 03:33:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-3</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@Deathwish317 Deathwish317]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/deathwish317">@Deathwish317</a> wrote:</p>
          <blockquote>
              <p>thx bin lookin for something amongst these lines</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/2</link>
        <pubDate>Fri, 30 Jan 2015 02:55:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-2</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
      <item>
        <title>Chat text unpacking</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>While working on my server I wanted to be able to convert the chat bytes we receive to a string<br>
so I can log the chat.<br>
I took the unpacking method from another server but it didn’t work,<br>
after many tests and searching I noticed that many servers have the text unpacking commented out<br>
for the simple reason that it doesn’t convert right.</p>
<p>I converted the method from the client and put it in the server and got it working right.</p>
<pre><code class="lang-auto">    /**
    * Converts bytes to text by the RS2 codec.
    * 
    * @param packedData The bytes to convert.
    * 
    * @param size The size of the buffer.
    * 
    * @return The converted bytes as string.
    */
    public static String getBytesAsString(byte packedData[], int size) {
    	char[] characters = new char[100];
    	
    	int position = 0;
    	
    	for (int i = 0; i &lt; size; i++) {
    		characters[position++] = XLATE_TABLE[packedData[i]];
    	}
    	for (int i = 0; i &lt; position; i++) {
    		char c = characters[i];
			
    		if (c &gt;= 'a' &amp;&amp; c &lt;= 'z') {
			characters[i] += '\uFFE0';
    		}
    	}
	return new String(characters, 0, position).toLowerCase();
    }

    private static char XLATE_TABLE[] = {
		' ', 'e', 't', 'a', 'o', 'i', 'h', 'n', 's', 'r', 
		'd', 'l', 'u', 'm', 'w', 'c', 'y', 'f', 'g', 'p', 
		'b', 'v', 'k', 'x', 'j', 'q', 'z', '0', '1', '2', 
		'3', '4', '5', '6', '7', '8', '9', ' ', '!', '?', 
		'.', ',', ':', ';', '(', ')', '-', '&amp;', '*', '\\', 
		'\'', '@', '#', '+', '=', '\243', '$', '%', '"', '[', 
		']', '&gt;', '&lt;', '^', '/', '_'
	};</code></pre>
<p><span class="bbcode-b">Example usage:</span></p>
<pre><code class="lang-auto">	int effects = packet.getSubtrahendByte();
	int color = packet.getSubtrahendByte();
	int chatLength = (packet.getLength() - 2);
	byte[] text = packet.getAdditionalBytesReversed(chatLength);

	if (effects &lt; 0 || color &lt; 0 || chatLength &lt; 0 || text == null) {
		return;
	}
	player.addStateUpdate(new ChatState(text, color, effects));

	PlayerDataAccess.log(player, PlayerLogTypes.CHAT, StringUtil.getBytesAsString(text, chatLength)); //USAGE OF TEXT UNPACK
	Logger.debug("[Chat][" + player.getUsername() + "] - size: " + chatLength + ", text: " + StringUtil.getBytesAsString(text, chatLength)); //USAGE OF TEXT UNPACK</code></pre>
<p>Here at the bottom of the code you can see I use the text unpacking to convert the chat bytes to a string and<br>
use it for logging purposes.</p>
<p><span class="bbcode-b">Note:</span> If you are going to use this, check your “xlatetable” as it might be different than the one used here.<br>
In order for this to work you need the one I provided with the code above.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/chat-text-unpacking/549493/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/chat-text-unpacking/549493/1</link>
        <pubDate>Thu, 29 Jan 2015 12:52:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-549493-1</guid>
        <source url="https://forum.moparisthebest.com/t/chat-text-unpacking/549493.rss">Chat text unpacking</source>
      </item>
  </channel>
</rss>
