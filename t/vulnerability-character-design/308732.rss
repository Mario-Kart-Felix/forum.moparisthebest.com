<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Vulnerability] Character Design</title>
    <link>https://forum.moparisthebest.com/t/vulnerability-character-design/308732</link>
    <description>I was looking at some Standard 317 servers today(winterlove based servers) and this particular vulnerability stuck out at me.


Code from server Download (Ultimate Server v2) client.java:
[code]
      case 101: // Character Design Screen

            int gender = inStream.readSignedByte();

            int head = inStream.readSignedByte();

            int jaw = inStream.readSignedByte();

            int torso = inStream.readSignedByte();

            int arms = inStream.readSignedByte();

            int hands = inStream.readSignedByte();

            int legs = inStream.readSignedByte();

            int feet = inStream.readSignedByte();

            int hairC = inStream.readSignedByte();

            int torsoC = inStream.readSignedByte();

            int legsC = inStream.readSignedByte();

            int feetC = inStream.readSignedByte();

            int skinC = inStream.readSignedByte();



            playerLook[0] = gender;

            pHead = head;

            pBeard = jaw;

            pTorso = torso;

            pArms = arms;

            pHands = hands;

            pLegs = legs;

            pFeet = feet;

            playerLook[1] = hairC;

            playerLook[2] = torsoC;

            playerLook[3] = legsC;

            playerLook[4] = feetC;

            playerLook[5] = skinC;

            apset = true;

            appearanceUpdateRequired = true;

            break;
[/code]


[b]The problem:[/b]
No checking of any kind to see if the client should be sending this packet or not


[b]The Exploit: [/b]
I inserted a client side command into a client
[code]
			if(s.equals(&quot;appearance&quot;))
			{
 				stream.createFrame(101); //have not added
            			stream.writeWordBigEndian(generator.nextInt(2));
            			for(int i1 = 0; i1 &lt; 7; i1++)
                			stream.writeWordBigEndian(generator.nextInt(15));

            			for(int l1 = 0; l1 &lt; 5; l1++)
               				stream.writeWordBigEndian(generator.nextInt(15));
			}
[/code]
[code]
	private Random generator = new Random();
[/code]

I logged into a few of the popular servers and found out right away i could change my appearance as fast and as many times as I wanted...



[b]Solution to the problem:[/b]
Servers should check if the Character design interface is up for the client...

[code]
package org.hyperion.rs2.packet;

import org.hyperion.rs2.model.Player;
import org.hyperion.rs2.net.Packet;

/**
 *
 * @author silabsoft
 */
public class CharacterDesign implements PacketHandler {

    private final int CHARACTER_DESIGN_INTERFACE = 3559;

    public void handle(Player player, Packet packet) {
        if (player.getInterfaceState().isInterfaceOpen(CHARACTER_DESIGN_INTERFACE)) {
            byte[] look = new byte[12];
            packet.get(look);
            player.getAppearance().setLook(look);
            player.getInterfaceState().interfaceClosed();
        }
    }
}

[/code]</description>
    
    <lastBuildDate>Sun, 18 Oct 2009 03:54:23 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/vulnerability-character-design/308732.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Vulnerability] Character Design</title>
        <dc:creator><![CDATA[@m.dog311 m.dog311]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/m.dog311">@m.dog311</a> wrote:</p>
          <blockquote>
              <p>It’s quite sad how much stupidity and laziness goes into these servers.  Even the simplest things aren’t done right.  Nice find on this one.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vulnerability-character-design/308732/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vulnerability-character-design/308732/3</link>
        <pubDate>Sun, 18 Oct 2009 03:54:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-308732-3</guid>
        <source url="https://forum.moparisthebest.com/t/vulnerability-character-design/308732.rss">[Vulnerability] Character Design</source>
      </item>
      <item>
        <title>[Vulnerability] Character Design</title>
        <dc:creator><![CDATA[@fozzy fozzy]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fozzy">@fozzy</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="1" data-topic="308735">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/scape-java/40/5_513041d5f7104045db30895d3b90af16.png" class="avatar">
</div>
<blockquote>
<p>good find =]</p>
</blockquote>
</aside>
<p>I’m curious if you know what this actually does or if your here to get your post up.</p>
<p>Ontopic: Wow, I would of never thought an exploit could of been done via the char design.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vulnerability-character-design/308732/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vulnerability-character-design/308732/2</link>
        <pubDate>Sat, 17 Oct 2009 07:36:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-308732-2</guid>
        <source url="https://forum.moparisthebest.com/t/vulnerability-character-design/308732.rss">[Vulnerability] Character Design</source>
      </item>
      <item>
        <title>[Vulnerability] Character Design</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>I was looking at some Standard 317 servers today(winterlove based servers) and this particular vulnerability stuck out at me.</p>
<p>Code from server Download (Ultimate Server v2) client.java:</p>
<pre><code class="lang-auto">      case 101: // Character Design Screen

            int gender = inStream.readSignedByte();

            int head = inStream.readSignedByte();

            int jaw = inStream.readSignedByte();

            int torso = inStream.readSignedByte();

            int arms = inStream.readSignedByte();

            int hands = inStream.readSignedByte();

            int legs = inStream.readSignedByte();

            int feet = inStream.readSignedByte();

            int hairC = inStream.readSignedByte();

            int torsoC = inStream.readSignedByte();

            int legsC = inStream.readSignedByte();

            int feetC = inStream.readSignedByte();

            int skinC = inStream.readSignedByte();



            playerLook[0] = gender;

            pHead = head;

            pBeard = jaw;

            pTorso = torso;

            pArms = arms;

            pHands = hands;

            pLegs = legs;

            pFeet = feet;

            playerLook[1] = hairC;

            playerLook[2] = torsoC;

            playerLook[3] = legsC;

            playerLook[4] = feetC;

            playerLook[5] = skinC;

            apset = true;

            appearanceUpdateRequired = true;

            break;</code></pre>
<p><span class="bbcode-b">The problem:</span><br>
No checking of any kind to see if the client should be sending this packet or not</p>
<p><span class="bbcode-b">The Exploit: </span><br>
I inserted a client side command into a client</p>
<pre><code class="lang-auto">			if(s.equals("appearance"))
			{
 				stream.createFrame(101); //have not added
            			stream.writeWordBigEndian(generator.nextInt(2));
            			for(int i1 = 0; i1 &lt; 7; i1++)
                			stream.writeWordBigEndian(generator.nextInt(15));

            			for(int l1 = 0; l1 &lt; 5; l1++)
               				stream.writeWordBigEndian(generator.nextInt(15));
			}</code></pre>
<pre><code class="lang-auto">	private Random generator = new Random();</code></pre>
<p>I logged into a few of the popular servers and found out right away i could change my appearance as fast and as many times as I wanted…</p>
<p><span class="bbcode-b">Solution to the problem:</span><br>
Servers should check if the Character design interface is up for the client…</p>
<pre><code class="lang-auto">package org.hyperion.rs2.packet;

import org.hyperion.rs2.model.Player;
import org.hyperion.rs2.net.Packet;

/**
 *
 * @author silabsoft
 */
public class CharacterDesign implements PacketHandler {

    private final int CHARACTER_DESIGN_INTERFACE = 3559;

    public void handle(Player player, Packet packet) {
        if (player.getInterfaceState().isInterfaceOpen(CHARACTER_DESIGN_INTERFACE)) {
            byte[] look = new byte[12];
            packet.get(look);
            player.getAppearance().setLook(look);
            player.getInterfaceState().interfaceClosed();
        }
    }
}
</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/vulnerability-character-design/308732/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/vulnerability-character-design/308732/1</link>
        <pubDate>Thu, 15 Oct 2009 16:27:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-308732-1</guid>
        <source url="https://forum.moparisthebest.com/t/vulnerability-character-design/308732.rss">[Vulnerability] Character Design</source>
      </item>
  </channel>
</rss>
