<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/the-memory-leak/425651 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:32:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>The Memory leak - Runescape - moparisthebest.com</title>
    <meta name="description" content="Nothing new, but should be fixed in moparrsc, unless u want it to eat up ur RAM. I&amp;#39;m going to fix it myself soon though. After other bugs are fixed. 

This picture is after 20 mins AFKing. with 1 player online. [image]">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="425651.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;The Memory leak&#39;" href="425651.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="http://img545.imageshack.us/img545/3997/leaks.png" />
<meta property="og:image" content="http://img545.imageshack.us/img545/3997/leaks.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/the-memory-leak/425651" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/the-memory-leak/425651" />
<meta property="og:title" content="The Memory leak" />
<meta name="twitter:title" content="The Memory leak" />
<meta property="og:description" content="Nothing new, but should be fixed in moparrsc, unless u want it to eat up ur RAM.  I’m going to fix it myself soon though. After other bugs are fixed.  This picture is after 20 mins AFKing. with 1 player online." />
<meta name="twitter:description" content="Nothing new, but should be fixed in moparrsc, unless u want it to eat up ur RAM.  I’m going to fix it myself soon though. After other bugs are fixed.  This picture is after 20 mins AFKing. with 1 player online." />
<meta property="article:published_time" content="2011-12-17T17:14:26+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="next" href="4256514658.html?page=2">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="425651.html">The Memory leak</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-17T17:14:26Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:33:02Z' class='post-time'>
              August 2, 2016,  2:33pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Nothing new, but should be fixed in moparrsc, unless u want it to eat up ur RAM.<br>
I’m going to fix it myself soon though. After other bugs are fixed.</p>
<p>This picture is after 20 mins AFKing. with 1 player online.<br>
<img src="http://img545.imageshack.us/img545/3997/leaks.png" alt width="" height=""></p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-17T17:23:24Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:33:03Z' class='post-time'>
              August 2, 2016,  2:33pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>6000000</p>
<p>I am under the impression there is a shit fix for this…?</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-17T17:41:49Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:33:04Z' class='post-time'>
              August 2, 2016,  2:33pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Rodgerwilco, post:2, topic:425651”]<br>
6000000</p>
<p>I am under the impression there is a shit fix for this…?[/quote]<br>
Yes, indeed a shit fix. They did it so it clears the tiles every 100 mins, instead of even trying to fix it completely.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Peter.html'><span itemprop='name'>Peter</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-30T12:28:32Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:54:13Z' class='post-time'>
              August 2, 2016,  2:54pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="-Nothing, post:3, topic:425651"][quote author=Rodgerwilco link=topic=528304.msg3852479#msg3852479 date=1324142604]</p>

<p>6000000</p>
<p>I am under the impression there is a shit fix for this…?<br>
[/quote]<br>
Yes, indeed a shit fix. They did it so it clears the tiles every 100 mins, instead of even trying to fix it completely.[/quote]</p>
<p>Blame xEnt.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-31T17:43:34Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:00Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <pre><code class="lang-auto">package org.moparscape.msc.gs.model;



public class TileValue {

	public int diagWallVal = 0;

	public byte horizontalWallVal = 0;

	public byte mapValue = 0;

	public byte objectValue = 0;

	public byte overlay = 0;

	public byte verticalWallVal = 0;

	public byte elevation = 0;

}</code></pre>
<p>One of the reasons that class probably uses so much memory is the number of variables it contains. They’re only bytes as far as the java language is concerned, but AFAIK they each take up the space of a 32 bit integer in the JVM.<br>
If the maximum value of diagWallVal will fit in a short then one solution would be to declare a single long field, and then use bitmasking to obtain the values.<br>
Make sure the mask variables are static and final, and not instance fields.</p>
<p>As for ActiveTile instances, make use of a collection that supports weak references or simply don’t create/cache tiles in the first place unless they have some kind of entity on them or being added immediately after creation.<br>
Failing this, try using lazy initialisation for the three LinkedList objects that each ActiveTile contains. The overhead when adding an entity is minimal, but the memory footprint will be substantially smaller despite the current implementation’s approach to caching.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vrunk.html'><span itemprop='name'>Vrunk</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-31T18:29:49Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:03Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Also, keep in mind that each Object has some additional memory overhead associated with the object header / array header. This is the realm of 8-16 bytes per Object (depending on the JVM implementation, and a few other things). There is also some padding added to primitive fields within Objects. For example:</p>
<pre><code class="lang-auto">class TileValue {
  byte example;
}</code></pre>
<p>new TileValue(); // 16-24 bytes in size, depending on the class header size. (1 + 7 == 8) bytes for the ‘example’ primitive</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-31T20:22:09Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:12Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I think it’s possible you guys are over-exaggerating the problem.  Since it appears that running the garbage collector fixes the issue temporarily, the problem isn’t the amount of memory being used (RAM is very cheap), but rather that what is used is not disposed of properly.</p>
<p>Note that all my knowledge on this subject comes from reading this thread.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/CodeForFame.html'><span itemprop='name'>CodeForFame</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-31T21:06:40Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:15Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Lothy, post:5, topic:425651”][code]<br>
package org.moparscape.msc.gs.model;</p>
<p>public class TileValue {</p>
<pre><code>public int diagWallVal = 0;

public byte horizontalWallVal = 0;

public byte mapValue = 0;

public byte objectValue = 0;

public byte overlay = 0;

public byte verticalWallVal = 0;

public byte elevation = 0;
</code></pre>
<p>}<br>
[/code]<br>
One of the reasons that class probably uses so much memory is the number of variables it contains. They’re only bytes as far as the java language is concerned, but AFAIK they each take up the space of a 32 bit integer in the JVM.<br>
If the maximum value of diagWallVal will fit in a short then one solution would be to declare a single long field, and then use bitmasking to obtain the values.<br>
Make sure the mask variables are static and final, and not instance fields.</p>
<p>As for ActiveTile instances, make use of a collection that supports weak references or simply don’t create/cache tiles in the first place unless they have some kind of entity on them or being added immediately after creation.<br>
Failing this, try using lazy initialisation for the three LinkedList objects that each ActiveTile contains. The overhead when adding an entity is minimal, but the memory footprint will be substantially smaller despite the current implementation’s approach to caching.[/quote]I’m fairly certain that’s not true.  I know booleans behave that way, and I believe bytes will only behave that way when applying binary operations to it. Edit: The amount of bytes per object is 24, so you must be wrong.</p>
<p>Using a single long adds quite a bit of complexity, and wouldn’t really make an observable impact.</p>
<p>ActiveTiles should be loaded in regions to prevent lag due to IO operations for every time a player moves.  Regions should persist themselves intelligently, to reduce the memory footprint yet still act as a form of cache.</p>
<p>Also, I’m fairly certain it’s already been decided (in a previous thread) that soft references need to be used here, with the current implementation.</p>
<p>In summation, the solution is to intelligently and dynamically reduce the number of objects in memory; not reduce the amount of memory per object as that is smaller factor.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vrunk.html'><span itemprop='name'>Vrunk</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-12-31T21:28:29Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:16Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="8" data-topic="425651">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/codeforfame/40/3743_1.png" class="avatar"> CodeForFame:</div>
<blockquote>
<p>In summation, the solution is to intelligently and dynamically reduce the number of objects in memory; not reduce the amount of memory per object as that is smaller factor.</p>
</blockquote>
</aside>
<p>That is the solution that will have the most impact. If you are unhappy with the results of that, and still want to grind down the memory usage, give one of these a try:</p>
<ul>
<li>
<p>Some form of data compression (you have to spend the CPU to compress/decompress). A simple example of this: how many TileValues are equal to each other (all of their fields have the same value?) There is no need to create a separate TileValue Object for each one. Create an instance of each unique TileValue, and store the objects in a lookup table.</p>
</li>
<li>
<p>java.util.BitSet (you might be able to store everything in memory at once with this, depending on how you implement it)</p>
</li>
</ul>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Zilent.html'><span itemprop='name'>Zilent</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T01:14:53Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:40Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>It’s been a while since I’ve popped in here…but why aren’t you caching the tiles by using the java.lang.ref package?  Wouldn’t it be better to let the GC decide (by itself) when to clean up dead tiles?  That’s how I have it set up in my base.  No matter how you handle it, the heap will still become fragmented over time and will require a non-concurrent GC cleanup that will pause your server (yes, even if you’re using the concurrent collector).</p>
<p>On another note, TileValues should not be leaking, as they are instantiated when a World instance is created, and never again unless you’re doing something very, very wrong.</p>
<ul>
<li>Also, an event driven approach decreases the tiles involved in an update by a magnitude of 15 - 30 times, as I counted.</li>
</ul>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/CodeForFame.html'><span itemprop='name'>CodeForFame</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T01:20:45Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:42Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Vrunk, post:9, topic:425651”][quote author=CodeForFame link=topic=528304.msg3871368#msg3871368 date=1325365600]<br>
In summation, the solution is to intelligently and dynamically reduce the number of objects in memory; not reduce the amount of memory per object as that is smaller factor.<br>
[/quote]</p>
<p>That is the solution that will have the most impact. If you are unhappy with the results of that, and still want to grind down the memory usage, give one of these a try:</p>
<ul>
<li>
<p>Some form of data compression (you have to spend the CPU to compress/decompress). A simple example of this: how many TileValues are equal to each other (all of their fields have the same value?) There is no need to create a separate TileValue Object for each one. Create an instance of each unique TileValue, and store the objects in a lookup table.</p>
</li>
<li>
<p>java.util.BitSet (you might be able to store everything in memory at once with this, depending on how you implement it)[/quote]BitSets take as much as a long (maybe a bit more seeing longs are primitives, but IDK much about the differences in memory usage between them).</p>
</li>
</ul>
<p>To come up with a compression scheme we’d need to analyze the values themselves, and I really don’t see there being a need for that at all…  As it stands it’s 83.5mB, which is trivial these days, and the development time would be better spent on the rest of the program.<br>
[hr][quote=“Zilent, post:10, topic:425651”]It’s been a while since I’ve popped in here…but why aren’t you caching the tiles by using the java.lang.ref package?  Wouldn’t it be better to let the GC decide (by itself) when to clean up dead tiles?  That’s how I have it set up in my base.  No matter how you handle it, the heap will still become fragmented over time and will require a non-concurrent GC cleanup that will pause your server (yes, even if you’re using the concurrent collector).</p>
<p>On another note, TileValues should not be leaking, as they are instantiated when a World instance is created, and never again unless you’re doing something very, very wrong.</p>
<ul>
<li>Also, an event driven approach decreases the tiles involved in an update by a magnitude of 15 - 30 times, as I counted.[/quote]They’re not leaking.  In addition, we’ve already covered using that package probably a year or so ago, and in this topic; we’ve also narrowed it down to which reference type.</li>
</ul>
<p>Here is some more discussion on the topic, and profiling:<br>
<aside class="onebox githubissue">
  <header class="source">
      <a href="https://github.com/MoparClassic/MoparClassic/issues/28" target="_blank" rel="nofollow noopener">github.com/MoparClassic/MoparClassic</a>
  </header>
  <article class="onebox-body">
    <a href="https://github.com/CodeForFame" rel="nofollow noopener">
<img src="https://avatars1.githubusercontent.com/u/785526?v=2&amp;s=96" class="thumbnail onebox-avatar" width="96" height="96">
</a>

<h4><a href="https://github.com/MoparClassic/MoparClassic/issues/28" target="_blank" rel="nofollow noopener">Issue: Memory Leak</a></h4>

<div class="date" style="margin-top:10px;">
	<div class="user" style="margin-top:10px;">
	opened by <a href="https://github.com/CodeForFame" target="_blank" rel="nofollow noopener">CodeForFame</a>
	on <a href="https://github.com/MoparClassic/MoparClassic/issues/28" target="_blank" rel="nofollow noopener">2011-12-17</a>
	</div>
	<div class="user">
	closed by <a href="https://github.com/CodeForFame" target="_blank" rel="nofollow noopener">CodeForFame</a>
	on <a href="https://github.com/MoparClassic/MoparClassic/issues/28" target="_blank" rel="nofollow noopener">2011-12-19</a>
	</div>
</div>

<pre class="content" style="white-space: pre-wrap;">"Nothing new, but should be fixed in moparrsc, unless u want it to eat up ur RAM.
I'm going to fix it...</pre>

<div class="labels">
</div>

  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vrunk.html'><span itemprop='name'>Vrunk</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T02:13:53Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:47Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>@ java.util.BitSet : emphasis on ‘depending on how you implement it’</p>
<p>It would be silly to use a single BitSet per TileValue (the size of each object would still be 16-24 bytes), but you could potentially store all of the data as a single BitSet, and only incur the class header overhead once.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/CodeForFame.html'><span itemprop='name'>CodeForFame</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T03:22:02Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:57:53Z' class='post-time'>
              August 2, 2016,  2:57pm
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Vrunk, post:12, topic:425651”]@ java.util.BitSet : emphasis on ‘depending on how you implement it’</p>
<p>It would be silly to use a single BitSet per TileValue (the size of each object would still be 16-24 bytes), but you could potentially store all of the data as a single BitSet, and only incur the class header overhead once.[/quote]The BitSet implementation uses a long, so unless you’re writing your own implementation you have that overhead, plus the header as a minimum.</p>
<p>BitSet + int = 12 bytes minimum.<br>
6 bytes + int = 10 bytes minimum.</p>
<p>Using a single BitSet adds quite a bit of complexity as well.</p>
<p>Also, is there a hit to memory for primitives similar to object headers?</p>
<p>Anyway, we’re arguing over very, very minimal memory.  It’s also extreme micro and premature to be optimizing this.  We first need to see what it’s like after implementing intelligent regions.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vrunk.html'><span itemprop='name'>Vrunk</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T14:13:36Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:18Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“CodeForFame, post:13, topic:425651”]1) The BitSet implementation uses a long, so unless you’re writing your own implementation you have that overhead, plus the header as a minimum.</p>
<ol start="2">
<li>
<p>Using a single BitSet adds quite a bit of complexity as well.</p>
</li>
<li>
<p>Also, is there a hit to memory for primitives similar to object headers?</p>
</li>
<li>
<p>Anyway, we’re arguing over very, very minimal memory.  It’s also extreme micro and premature to be optimizing this.  We first need to see what it’s like after implementing intelligent regions.[/quote]</p>
</li>
</ol>
<p><span class="mention">@1</span> : It actually uses an array of longs:</p>
<pre><code class="lang-auto">    /**
     * The internal field corresponding to the serialField "bits".
     */
    private long[] words;</code></pre>
<p><span class="mention">@2</span> : Yes, it does. But once you spend the time figuring out how to access your data, you’re done with it.</p>
<p><span class="mention">@3</span> : Yes, and this is the point where both you and Lothy are confused.</p>
<p>Example:<br>
A single byte variable inside of a class definition takes up 1 byte of memory upon instantiation, and then there is additional padding (7 bytes) added to that field to round to the nearest 8-byte boundary. Assuming the class header’s size is 8 bytes, this object will have a size of 16 bytes. If there are 9 byte variables within a class definition, the 9th one is padded to the nearest 8 byte boundary, resulting in an object size of 24 bytes.</p>
<p><span class="mention">@4</span> : Yes, which is why I suggested trying this only if you are unhappy with the results of proper memory management (as opposed to reducing the size required to simply store everything in memory).</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T16:53:43Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:22Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>When you use something like a BitSet, whether you use the existing Java class or roll your own functionality, it boils down to a standard computer science time/space trade-off.  These are the choices:</p>
<ol>
<li>Use more storage space (in this case RAM) and less CPU cycles.</li>
<li>Use less storage space, but you have to do at least one mathematical calculation for each value you retrieve or set, so more CPU cycles.</li>
</ol>
<p>With the current computers of today, you should be picking option 1 every time when talking about RAM.</p>
<p>As others have said, the issue lies in the how the caching system is currently implemented, and using an idea similar to BitSet will ever-so-slightly lower the RAM usage, but the ‘memory leak’ will still be there, and you will hurt performance by using CPU cycles that would be better put to use other places.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Vrunk.html'><span itemprop='name'>Vrunk</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T17:08:50Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:23Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="15" data-topic="425651">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/moparisthebest/40/30_1.png" class="avatar"> Moparisthebest:</div>
<blockquote>
<p>With the current computers of today, you should be picking option 1 every time when talking about RAM.</p>
</blockquote>
</aside>
<p>Sorry, but I’m going to have to pick on that statement. “Always” is a strong word - you should be picking a data structure that offers a suitable trade-off between the two. The suitable trade-off is defined by both the problem you are solving and the hardware you have available.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T17:36:27Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:24Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That is probably true, perhaps ‘always when dealing with this particular problem’, where it is always going to be hosted on a server where the bottleneck is going to be CPU speed and/or IO, but never RAM.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T19:12:57Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:30Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Why not just make a region system to fix the ActiveTile issue.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/CodeForFame.html'><span itemprop='name'>CodeForFame</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-01T21:08:44Z'>
            <time itemprop='dateModified' datetime='2016-08-02T14:58:39Z' class='post-time'>
              August 2, 2016,  2:58pm
            </time>
        <span itemprop='position'>#19</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="-Nothing, post:18, topic:425651"]Why not just make a region system to fix the ActiveTile issue.[/quote]Because that’s a small portion of what the region system should be solving…</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-06T04:08:55Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:06:33Z' class='post-time'>
              August 2, 2016,  3:06pm
            </time>
        <span itemprop='position'>#20</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“CodeForFame, post:19, topic:425651”][quote author=-Nothing link=topic=528304.msg3872397#msg3872397 date=1325445177]<br>
Why not just make a region system to fix the ActiveTile issue.<br>
[/quote]Because that’s a small portion of what the region system should be solving…[/quote]<br>
I know, why not make it if it’s good thing to do? I would have done it if I wasn’t so lazy.</p>
      </div>

      <meta itemprop='headline' content='The Memory leak'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><b><a rel="next" itemprop="url" href="4256514658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/the-memory-leak/425651 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 15:32:46 GMT -->
</html>
