<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Mouse hook in jaclib.dll</title>
    <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381</link>
    <description>So, there&#39;s a function in jaclib.dll that is named as if it is some sort of wrapper around ping. Currently it&#39;s exported as __stdcall Java_jaclib_ping_IcmpService_run.

But, it does some things that are very much not as it&#39;s named.

Firstly, it does some JNI stuff to get a handle to a function named &#39;notify&#39; in the client with signature (I)V. Then it installs a message hook to all windows capturing low level mouse events and sits in a loop plucking messages:
[code]
v5 = SetWindowsHookExA(14, fn, hmod, 0);
/* some stuff /*
while ( GetMessageA(&amp;Msg, 0, 0, 0) )
{
  TranslateMessage(&amp;Msg);
  DispatchMessageA(&amp;Msg);
}
UnhookWindowsHookEx(hhk);
[/code]

The messages go to a callback that basically just calls the notify function mentioned earlier with the only interesting parameter being a pointer into the MSLLHOOKSTRUCT Windows gives you with that message.

I know I&#39;m not the first to discover this (well, I found it ages ago actually, so I might have been, but I know others know about it now since if you google the method there is a pastebin result) but what I don&#39;t know is what its for.

MSLLHOOKSTRUCT contains some innocuous data like the point info, but more importantly it contains the LLMHF_INJECTED flag, which if set = this event was artificially created using SendInput or similar rather than through hardware. This makes this function a potential Simba/RiD trap, no?

If it is, though, why haven&#39;t they been using it? Does anyone with more intimate knowledge of the client know what the notify method does?

It&#39;s perhaps possible that they use this just for input on their Window I guess, but why hook all windows (they have the handle at this point) and why name it as if its something its not?</description>
    
    <lastBuildDate>Fri, 01 Mar 2013 17:39:02 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:6, topic:479381”]this is <a href="http://moparisthebest.com" rel="nofollow noopener">moparisthebest.com</a> being productive is not allowed[/quote]Stop spamming you stupid cunt</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/9</link>
        <pubDate>Fri, 01 Mar 2013 17:39:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-9</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@slavemaster veer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/slavemaster">@slavemaster</a> wrote:</p>
          <blockquote>
              <p>GG Mopman I showed you this several months back. Benland100 wouldn’t be so quick to shoot this down if he knew it sent mouse data (position, time) collected from both the native hook and an AWT listener to the server for comparison… a cheat which doesn’t use the real mouse would easily be detected.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/8</link>
        <pubDate>Sat, 23 Feb 2013 05:35:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-8</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@n3ss3s n3ss3s]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/n3ss3s">@n3ss3s</a> wrote:</p>
          <blockquote>
              <p>Can you find fn?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/7</link>
        <pubDate>Sat, 02 Feb 2013 07:50:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-7</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>this is <a href="http://moparisthebest.com" rel="nofollow noopener">moparisthebest.com</a> being productive is not allowed</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/6</link>
        <pubDate>Sun, 27 Jan 2013 19:22:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-6</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Echo3 Echo_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/echo3">@Echo3</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="4" data-topic="479381">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/method/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Method:</div>
<blockquote>
<p>Is the three-argument notify method used natively at all? I remember tracing the code for that and saw the client sending the data off to the server.</p>
</blockquote>
</aside>
<p>It must, notify(I)V is called natively but the code for it in the client doesn’t do anything.</p>
<p>[code=java]   protected void notify(int var1) {<br>
try {<br>
Iterator var2 = this.m.iterator();</p>
<pre><code>     while(var2.hasNext()) {
        sn var3 = (sn)var2.next();
        var3.i(var1 == 0, 417041762);
     }

  } catch (RuntimeException var4) {
     throw abn.m(var4, "afh.notify(" + ')');
  }
</code></pre>
<p>}</p>
<pre><code>// sn is an interface, the only class that implements it defines i(ZI)V as this:
</code></pre>
<p>public void i(boolean var1, int var2) {<br>
try {<br>
;<br>
} catch (RuntimeException var3) {<br>
throw abn.m(var3, “ri.i(” + ‘)’);<br>
}<br>
}[/code]</p>
<p>Although I guess they could do something like:</p>
<p>[code=java]sn element = new sn() {<br>
<a class="mention" href="/u/override">@Override</a><br>
public void i(boolean var1, int var2) {<br>
// implementation<br>
}<br>
};</p>
<p>//add element to list[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/5</link>
        <pubDate>Sat, 26 Jan 2013 00:37:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-5</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Metho_D Method]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/metho_d">@Metho_D</a> wrote:</p>
          <blockquote>
              <p>Is the three-argument notify method used natively at all? I remember tracing the code for that and saw the client sending the data off to the server.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/4</link>
        <pubDate>Fri, 25 Jan 2013 18:30:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-4</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <p>I didn’t rename anything actually - a couple of things IDA renamed, most of it is unnamed. And yes, I did consider that - because I said it, in my post. But yes, he is free to speculate and assume that they don’t make use of the obvious detection avenue there, as I am free to speculate that they do.</p>
<p>As for ‘if its even real at all’ - open up a disassembler, stick it on jaclib.dll, search the import table for SetWindowsHookEx and display usages.</p>
<p>EDIT Ah he was referring to the one on pastebin (probably super_s) which was more heavily renamed, I see. He’s still dumb, though.</p>
<p>I hate you in the face Echo_ - I just read that thread and now my head hurts <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
<p>(But srsly, thanks for referencing it anyway)</p>
<p>EDIT2 So Benland thinks its for full screen, Super thinks its for blocking awt events with no matching os event - both kinda valid theories, and luckily both testable. I’ll have a play after work today and post results.</p>
<p>Also, can someone point me in the direction of people still playing with this goddamn client :[</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/3</link>
        <pubDate>Fri, 25 Jan 2013 08:07:28 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-3</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Echo3 Echo_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/echo3">@Echo3</a> wrote:</p>
          <blockquote>
              <p>BenLand100’s opinion:</p>
<blockquote>Someone posts some scary looking source code with a few renamed variables to 'mouse_hook' and everyone shits themselves.
DID ANYONE CONSIDER THAT THIS IS RELATED TO FULLSCREEN RS WHICH REQUIRES SPECIAL HANDLING OF MOUSE EVENTS if it's even real at all? lol
It's all complete fodder imho, nothing to see here, move along.</blockquote>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/2</link>
        <pubDate>Fri, 25 Jan 2013 05:33:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-2</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
      <item>
        <title>Mouse hook in jaclib.dll</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <p>So, there’s a function in jaclib.dll that is named as if it is some sort of wrapper around ping. Currently it’s exported as __stdcall Java_jaclib_ping_IcmpService_run.</p>
<p>But, it does some things that are very much not as it’s named.</p>
<p>Firstly, it does some JNI stuff to get a handle to a function named ‘notify’ in the client with signature (I)V. Then it installs a message hook to all windows capturing low level mouse events and sits in a loop plucking messages:</p>
<pre><code class="lang-auto">v5 = SetWindowsHookExA(14, fn, hmod, 0);
/* some stuff /*
while ( GetMessageA(&amp;Msg, 0, 0, 0) )
{
  TranslateMessage(&amp;Msg);
  DispatchMessageA(&amp;Msg);
}
UnhookWindowsHookEx(hhk);</code></pre>
<p>The messages go to a callback that basically just calls the notify function mentioned earlier with the only interesting parameter being a pointer into the MSLLHOOKSTRUCT Windows gives you with that message.</p>
<p>I know I’m not the first to discover this (well, I found it ages ago actually, so I might have been, but I know others know about it now since if you google the method there is a pastebin result) but what I don’t know is what its for.</p>
<p>MSLLHOOKSTRUCT contains some innocuous data like the point info, but more importantly it contains the LLMHF_INJECTED flag, which if set = this event was artificially created using SendInput or similar rather than through hardware. This makes this function a potential Simba/RiD trap, no?</p>
<p>If it is, though, why haven’t they been using it? Does anyone with more intimate knowledge of the client know what the notify method does?</p>
<p>It’s perhaps possible that they use this just for input on their Window I guess, but why hook all windows (they have the handle at this point) and why name it as if its something its not?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381/1</link>
        <pubDate>Fri, 25 Jan 2013 00:02:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-479381-1</guid>
        <source url="https://forum.moparisthebest.com/t/mouse-hook-in-jaclib-dll/479381.rss">Mouse hook in jaclib.dll</source>
      </item>
  </channel>
</rss>
