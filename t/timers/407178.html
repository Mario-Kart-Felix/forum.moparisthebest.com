<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/timers/407178 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 22:59:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Timers - Runescape - moparisthebest.com</title>
    <meta name="description" content="Okay, I&amp;#39;m helping this kid make Castle Wars and the current Castle Wars he has is a skull fuck, trust me. What I don&amp;#39;t get is where he is getting these numbers for his timers.  CastleWars.java: [code=Java] package server&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="407178.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Timers&#39;" href="407178.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/timers/407178" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/timers/407178" />
<meta property="og:title" content="Timers" />
<meta name="twitter:title" content="Timers" />
<meta property="og:description" content="Okay, I’m helping this kid make Castle Wars and the current Castle Wars he has is a skull fuck, trust me. What I don’t get is where he is getting these numbers for his timers.  CastleWars.java:  [code=Java]  package server.model.minigames;  import java.util.ArrayList;  import server.Server;  import server.model.players.Client;  import server.util.Misc;  public class CastleWars {  private CastleWarObjects cwo = new CastleWarObjects();  public CastleWars() { 	/** 	* Constructor 	*/ }  public Array..." />
<meta name="twitter:description" content="Okay, I’m helping this kid make Castle Wars and the current Castle Wars he has is a skull fuck, trust me. What I don’t get is where he is getting these numbers for his timers.  CastleWars.java:  [code=Java]  package server.model.minigames;  import java.util.ArrayList;  import server.Server;  import server.model.players.Client;  import server.util.Misc;  public class CastleWars {  private CastleWarObjects cwo = new CastleWarObjects();  public CastleWars() { 	/** 	* Constructor 	*/ }  public Array..." />
<meta property="article:published_time" content="2011-07-30T02:17:17+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="407178.html">Timers</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/the_wanderer.html'><span itemprop='name'>the_wanderer</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-07-30T02:17:17Z'>
            <time itemprop='dateModified' datetime='2016-08-01T13:37:53Z' class='post-time'>
              August 1, 2016,  1:37pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Okay, I’m helping this kid make Castle Wars and the current Castle Wars he has is a skull fuck, trust me. What I don’t get is where he is getting these numbers for his timers.<br>
<span class="bbcode-b">CastleWars.java:</span></p>
<p>[code=Java]<br>
package server.model.minigames;</p>
<p>import java.util.ArrayList;</p>
<p>import server.Server;<br>
import server.model.players.Client;<br>
import server.util.Misc;</p>
<p>public class CastleWars {</p>
<pre><code>private CastleWarObjects cwo = new CastleWarObjects();

public CastleWars() {
	/**
	* Constructor
	*/
}

public ArrayList&lt;Integer&gt; saradomin = new ArrayList&lt;Integer&gt; (); //team 1
public ArrayList&lt;Integer&gt; zamorak = new ArrayList&lt;Integer&gt; (); //team 2
public ArrayList&lt;Integer&gt; saradominWait = new ArrayList&lt;Integer&gt; (); //team 1
public ArrayList&lt;Integer&gt; zamorakWait = new ArrayList&lt;Integer&gt; (); //team 2
public int saradominScore = 0;
public int zamorakScore = 0;
public boolean saraFlagSafe = true;
public boolean zammyFlagSafe = true;
private final int GAME_TIMER = 200; //1500 * 600 = 900000ms = 15 minutes
private final int GAME_START_TIMER = 20;	
public int timeRemaining = -1;
public int gameStartTimer = GAME_START_TIMER;


public void joinWait(Client c, int team) {
	if (c.playerEquipment[c.playerHat] &gt; 0 || c.playerEquipment[c.playerCape] &gt; 0) {
		c.sendMessage("You may not wear capes or helmets inside of castle wars.");
		return;
	}
	if (team == 1) {
		if (saradominWait.size() &gt; zamorakWait.size()) {
			c.sendMessage("This team is currently full.");
			return;
		} else {
			saradominWait.add(c.playerId);
			c.castleWarsTeam = 1;
                            toWaitingRoom(c, c.castleWarsTeam);
                            c.sendMessage("You have been added to the Saradomin team.");
		}
	} else if (team == 2) {
		if (zamorakWait.size() &gt; saradominWait.size()) {
			c.sendMessage("This team is currently full.");
			return;
		} else {
			zamorakWait.add(c.playerId);
			c.castleWarsTeam = 2;
                            toWaitingRoom(c, c.castleWarsTeam);
                            c.sendMessage("You have been added to the Zamorak team.");
		}
	}
}

public void toWaitingRoom(Client c, int team) {
	if (team == 1) {
		c.getPA().movePlayer(2377 + Misc.random(10), 9485 + Misc.random(5),0);
	} else if (team == 2) {
		c.getPA().movePlayer(2417 + Misc.random(10), 9485 + Misc.random(7),0);
	}
	c.inCwWait = true;
}

public void leaveWaitingRoom(Client c) {
	c.inCwWait = false;
	c.getPA().movePlayer(2439 + Misc.random(4), 3085 + Misc.random(5), 0);
	if (c.castleWarsTeam == 1) {
		saradominWait.remove(saradomin.indexOf(c.playerId));
		c.castleWarsTeam = -1;
	} else if (c.castleWarsTeam == 2) {
		zamorakWait.remove(zamorak.indexOf(c.playerId));
		c.castleWarsTeam = -1;
	}			
}


int properTimer = 0;
public void process() {
	if (properTimer &gt; 0) {
		properTimer--;
		return;
	} else {
		properTimer = 4;
	}
		
	if (gameStartTimer &gt; 0) {
		gameStartTimer--;
		updatePlayers();
	} else if (gameStartTimer == 0) {
		startGame();
	}
	if (timeRemaining &gt; 0) {
		timeRemaining--;
		updateInGamePlayers();
	} else if (timeRemaining == 0) {
		endGame();
	}
	/** 
	* The process of the castle wars game - called every 3 seconds
	*/
}

public void updatePlayers() {
	//saradomin players
	for (int player : saradominWait) {
		if (Server.playerHandler.players[player] != null) {
			Client c = (Client) Server.playerHandler.players[player];
			c.getPA().walkableInterface(6673);
			c.getPA().sendFrame126("Next Game Begins In : " + gameStartTimer * 3 + " seconds.", 6570);
			c.getPA().sendFrame126("", 6572);
			c.getPA().sendFrame126("", 6664);
		//update interface here
		} else {
			saradominWait.remove(saradominWait.indexOf(player));
		}
	}
	for (int player : zamorakWait) {
		if (Server.playerHandler.players[player] != null) {
			Client c = (Client) Server.playerHandler.players[player];
			c.getPA().walkableInterface(6673);
			c.getPA().sendFrame126("Next Game Begins In : " + gameStartTimer * 3 + " seconds.", 6570);
			c.getPA().sendFrame126("", 6572);
			c.getPA().sendFrame126("", 6664);
		//update interface here
		} else {
			zamorakWait.remove(zamorakWait.indexOf(player));
		}
	}
}

public void updateInGamePlayers() {
	if (saradomin.size() &gt; 0) {
		for (int player : saradomin) {
			if (Server.playerHandler.players[player] != null) {
				Client c = (Client) Server.playerHandler.players[player];
				c.getPA().walkableInterface(11146);
				c.getPA().sendFrame126(saradominScore + " = Saradomin", 11148);
				c.getPA().sendFrame126("Zamorak = " + zamorakScore, 11147);
				c.getPA().sendFrame126(gameStartTimer * 3 + " secs", 11155);
				c.getPA().sendFrame126("", 11158);
				c.getPA().sendFrame126("", 11160);
				c.getPA().sendFrame126("", 11162);
				c.getPA().sendFrame126("", 11164);
				c.getPA().sendFrame126("", 11168);
				if (saraFlagSafe) {
					c.getPA().sendFrame126("@gre@Safe", 11166);
				} else {
					c.getPA().sendFrame126("@red@Taken", 11166);
				}
				if (zammyFlagSafe) {
					c.getPA().sendFrame126("@gre@Safe", 11167);
				} else {
					c.getPA().sendFrame126("@red@Taken", 11167);
				}
			//update interface here
			} else {
				saradomin.remove(saradomin.indexOf(player));
			}
		
		}
	}
	if (zamorak.size() &gt; 0) {
		for (int player : zamorak) {
			if (Server.playerHandler.players[player] != null) {
				Client c = (Client) Server.playerHandler.players[player];
				c.getPA().walkableInterface(11146);
				c.getPA().sendFrame126(saradominScore + " = Saradomin", 11148);
				c.getPA().sendFrame126("Zamorak = " + zamorakScore, 11147);
				c.getPA().sendFrame126(gameStartTimer * 3 + " secs", 11155);
				c.getPA().sendFrame126("", 11158);
				c.getPA().sendFrame126("", 11160);
				c.getPA().sendFrame126("", 11162);
				c.getPA().sendFrame126("", 11164);
				c.getPA().sendFrame126("", 11168);
				if (saraFlagSafe) {
					c.getPA().sendFrame126("@gre@Safe", 11166);
				} else {
					c.getPA().sendFrame126("@red@Taken", 11166);
				}
				if (zammyFlagSafe) {
					c.getPA().sendFrame126("@gre@Safe", 11167);
				} else {
					c.getPA().sendFrame126("@red@Taken", 11167);
				}
			//update interface here
			} else {
				zamorak.remove(zamorak.indexOf(player));
			}
		
		}
	}	

}
public void startGame() {
	gameStartTimer = -1;
	System.out.println("Starting Castle Wars game.");
	timeRemaining = GAME_TIMER;
	for (int player : saradominWait) {
		if (Server.playerHandler.players[player] != null) {
			//put player @ coords
			Client c = (Client)Server.playerHandler.players[player];
			c.getPA().walkableInterface(-1);
			c.getPA().movePlayer(2426 + Misc.random(3), 3076 - Misc.random(3), 1);
			saradomin.add(player);
			c.inCwWait = false;
			c.inCwGame = true;
		}		
	}
	saradominWait.clear();
	
	for (int player : zamorakWait) {
		if (Server.playerHandler.players[player] != null) {
			//put player @ coords
			Client c = (Client)Server.playerHandler.players[player];
			c.getPA().walkableInterface(-1);
			c.getPA().movePlayer(2373 + Misc.random(3), 3131 - Misc.random(3), 1);
			zamorak.add(player);
			c.inCwWait = false;
			c.inCwGame = true;
		}		
	}
	saradominWait.clear();
}

public void endGame() {
	timeRemaining = -1;
	System.out.println("Ending Castle Wars game.");
	gameStartTimer = GAME_START_TIMER;
}

public void handleObjects(Client c, int objectId, int objectX, int objectY){
	cwo.handleObject(c, objectId, objectX, objectY);
}
</code></pre>
<p>}[/code]</p>
<p>Process being called in Server.java<br>
<span class="bbcode-b">Server.java:</span></p>
<pre><code class="lang-auto">package server;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.text.DecimalFormat;

import org.apache.mina.common.IoAcceptor;
import org.apache.mina.transport.socket.nio.SocketAcceptor;
import org.apache.mina.transport.socket.nio.SocketAcceptorConfig;

import server.event.EventManager;
import server.model.npcs.NPCHandler;
import server.model.npcs.NPCDrops;
import server.model.players.PlayerHandler;
import server.model.players.Player;
import server.model.players.Client;
import server.model.players.PlayerSave;
import server.model.minigames.*;
import server.net.ConnectionHandler;
import server.net.ConnectionThrottleFilter;
import server.util.ShutDownHook;
import server.util.SimpleTimer;
import server.util.log.Logger;
import server.event.Event; 
import server.event.EventContainer;
import server.world.ItemHandler;
import server.world.ObjectHandler;
import server.world.ObjectManager;
import server.world.ShopHandler;
import server.world.map.VirtualWorld;
import server.world.ClanChatHandler;
import server.world.WorldMap;
import server.world.WalkingHandler;

/**
 * Server.java
 *
 * @author Sanity
 * @author Graham
 * @author Blake
 * @author Ryan Lmctruck30
 *
 */

public class Server {
	
	
	public static boolean sleeping;
	public static int cycleRate;
	public static boolean UpdateServer = false;
	public static long lastMassSave = System.currentTimeMillis();
	private static IoAcceptor acceptor;
	private static ConnectionHandler connectionHandler;
	private static ConnectionThrottleFilter throttleFilter;
	private static SimpleTimer engineTimer, debugTimer;
	private static long cycleTime, cycles, totalCycleTime, sleepTime;
	private static DecimalFormat debugPercentFormat;
	public static boolean shutdownServer = false;		
	public static boolean shutdownClientHandler;			
	public static int serverlistenerPort; 
	public static ItemHandler itemHandler = new ItemHandler();
	public static PlayerHandler playerHandler = new PlayerHandler();
	public static NPCHandler npcHandler = new NPCHandler();
	public static ShopHandler shopHandler = new ShopHandler();
	public static ObjectHandler objectHandler = new ObjectHandler();
	public static ObjectManager objectManager = new ObjectManager();
	public static CastleWars castleWars = new CastleWars();
	public static FightPits fightPits = new FightPits();
	public static PestControl pestControl = new PestControl();
	public static NPCDrops npcDrops = new NPCDrops();
	public static ClanChatHandler clanChat = new ClanChatHandler();
	public static FightCaves fightCaves = new FightCaves();
	public static RFD rfd = new RFD();
	//public static WorldMap worldMap = new WorldMap();
	public static long[] TIMES = new long[5];
	//private static final WorkerThread engine = new WorkerThread();
	
	static {
		if(!Config.SERVER_DEBUG) {
			serverlistenerPort = 43594;
		} else {
			serverlistenerPort = 43595;
		}
		cycleRate = 575;
		shutdownServer = false;
		engineTimer = new SimpleTimer();
		debugTimer = new SimpleTimer();
		sleepTime = 0;
		debugPercentFormat = new DecimalFormat("0.0#%");
	}
	//height,absX,absY,toAbsX,toAbsY,type
    /*public static final boolean checkPos(int height,int absX,int absY,int toAbsX,int toAbsY,int type)
    {
        return I.I(height,absX,absY,toAbsX,toAbsY,type);
    }*/
	public static void main(java.lang.String args[]) throws NullPointerException, IOException {

		/**
		 * Starting Up Server
		 */
		 
		System.setOut(new Logger(System.out));
		System.setErr(new Logger(System.err));
		System.out.println("Launching BrokenX v2...");
		
		/**
		 * World Map Loader
		 */
		//if(!Config.SERVER_DEBUG)
			//VirtualWorld.init();
		//WorldMap.loadWorldMap();	

		/**
		 * Script Loader
		 */
		//ScriptManager.loadScripts();
		
		/**
		 * Accepting Connections
		 */
		acceptor = new SocketAcceptor();
		connectionHandler = new ConnectionHandler();
		
		SocketAcceptorConfig sac = new SocketAcceptorConfig();
		sac.getSessionConfig().setTcpNoDelay(false);
		sac.setReuseAddress(true);
		sac.setBacklog(100);
		
		throttleFilter = new ConnectionThrottleFilter(Config.CONNECTION_DELAY);
		sac.getFilterChain().addFirst("throttleFilter", throttleFilter);
		acceptor.bind(new InetSocketAddress(serverlistenerPort), connectionHandler, sac);

		/**
		 * Initialize Handlers
		 */
		//VoteForCash.createConnection();
		EventManager.initialize();
		Connection.initialize();
		//PlayerSaving.initialize();
		//MysqlManager.createConnection();
		
		/**
		 * Clipped Following (NPC)
		 */
		try {
		 WalkingHandler.getSingleton().initialize();
		} catch(Exception ex) {
		ex.printStackTrace();
		}
		/**
		 * Server Successfully Loaded 
		 */
		System.out.println("Server listening on port:" + serverlistenerPort);
		/**
		 * Main Server Tick
		 */
		try {
			while (!Server.shutdownServer) {
				if (sleepTime &gt; 0)
					Thread.sleep(sleepTime);
				engineTimer.reset();
				itemHandler.process();
				playerHandler.process();	
	                        npcHandler.process();
				shopHandler.process();
				objectManager.process();
				fightPits.process();
				pestControl.process();
                                castleWars.process();
				cycleTime = engineTimer.elapsed();
				if(cycleTime &lt; 575)
					sleepTime = cycleRate - cycleTime;
				else
					sleepTime = 0;
				totalCycleTime += cycleTime;
				cycles++;
				debug();
				if(Config.SERVER_DEBUG) //i see.... i used wrong symbol lol LOL !
					//System.out.println(cycleTime+"--"+sleepTime);
				if (System.currentTimeMillis() - lastMassSave &gt; 25000) {
					for(Player p : PlayerHandler.players) {
						if(p == null)
							continue;						
						PlayerSave.saveGame((Client)p);
						System.out.println("Saved game for " + p.playerName + ".");
						lastMassSave = System.currentTimeMillis();
					}
				
				}
			}
		} catch (Exception ex) {
			ex.printStackTrace();
			System.out.println("A fatal exception has been thrown!");
			for(Player p : PlayerHandler.players) {
				if(p == null)
					continue;						
				PlayerSave.saveGame((Client)p);
				System.out.println("Saved game for " + p.playerName + ".");
			}
		}
		acceptor = null;
		connectionHandler = null;
		sac = null;
		System.exit(0);
	}
	
	public static void processAllPackets() {
		for (int j = 0; j &lt; playerHandler.players.length; j++) {
			if (playerHandler.players[j] != null) {
				while(playerHandler.players[j].processQueuedPackets());			
			}	
		}
	}
	
	public static boolean playerExecuted = false;
	private static void debug() {
		if (debugTimer.elapsed() &gt; 360*1000 || playerExecuted) {
			long averageCycleTime = totalCycleTime / cycles;
			System.out.println("Average Cycle Time: " + averageCycleTime + "ms");
			double engineLoad = ((double) averageCycleTime / (double) cycleRate);
			System.out.println("Players online: " + PlayerHandler.playerCount+ ", engine load: "+ debugPercentFormat.format(engineLoad));
			totalCycleTime = 0;
			cycles = 0;
			System.gc();
			System.runFinalization();
			debugTimer.reset();
			playerExecuted = false;
		}
	}
	
	public static long getSleepTimer() {
		return sleepTime;
	}
	
}</code></pre>
<p>I have a much better way of doing this, but I have no idea how he got 200 = 15 minutes. It doesn’t work either, as when I join the game the time is -3 because the idiot that wrote this forgot that he didn’t define public int timeRemaining as anything else besides -1. :fp: was really a mess trying to understand what he was trying to do.</p>
<p>As a review of what I want to know, how do those numbers interact with each other? Like is 200 in milliseconds? How is it defined as milliseconds? And no, none of those are defined anywhere else.</p>
      </div>

      <meta itemprop='headline' content='Timers'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/timers/407178 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Aug 2019 22:59:56 GMT -->
</html>
