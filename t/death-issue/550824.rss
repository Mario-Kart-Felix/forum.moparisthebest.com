<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Death Issue</title>
    <link>https://forum.moparisthebest.com/t/death-issue/550824</link>
    <description>For some odd reason, whenever players die, it resets some of the combat levels to 0/0.. I have no clue why that is, but i need to fix asap. Someone please help me out a little? Also, whenever i kill people, my defence drops to 125/0 as well as my hp.




 [IMG]http://i60.tinypic.com/11tsh1i.jpg[/img]</description>
    
    <lastBuildDate>Wed, 01 Apr 2015 03:12:30 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/death-issue/550824.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Death Issue</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>That code is atrocious… There’s at least ~60 lines of code that could be removed, and you’d have the same end result.</p>
<p>So many times the player is being saved in the same method, and being reset, and a bunch of other crap that doesn’t need to exist…</p>
<p>Like these 2 if statements… there should only be 1.</p>
<p><code>			if (PlayerHandler.players[c.killerId].connectedFrom == PlayerHandler.players[c.playerKilled].connectedFrom) {
				c.faceUpdate(0);
				c.npcIndex = 0;
				c.playerIndex = 0;
				c.stopMovement();
				if (c.duelStatus &lt;= 4) {
					c.getTradeAndDuel().stakedItems.clear();
					c.sendMessage("Oh dear you are dead!");
				} else if (c.duelStatus != 6) {
					c.getTradeAndDuel().stakedItems.clear();
					c.sendMessage("You have lost the duel!!!");
				}
				resetDamageDone();
				c.lastVeng = 0;
				c.vengOn = false;
				resetFollowers();
				c.attackTimer = 10;
				removeAllWindows();
				// sendFrame126("PkP: "+c.pkPoints+" K: "+c.kills+" D: "+c.deaths+"", 663); demise sendframe
				c.tradeResetNeeded = true;
				return;
			}
			if (PlayerHandler.players[c.killerId].connectedFrom.equals(PlayerHandler.players[c.playerKilled].connectedFrom)) {
				o.sendMessage("Multiple IP detected, PK point reward removed.");
				c.faceUpdate(0);
				c.npcIndex = 0;
				c.playerIndex = 0;
				c.stopMovement();
				if (c.duelStatus &lt;= 4) {
					c.sendMessage("Oh dear you are dead!");
				} else if (c.duelStatus != 6) {
					c.sendMessage("You have lost the duel!");
				}
				resetDamageDone();
				c.lastVeng = 0;
				c.vengOn = false;
				resetFollowers();
				c.attackTimer = 10;
				removeAllWindows();
				//sendFrame126("PkP: "+c.pkPoints+" K: "+c.kills+" D: "+c.deaths+"", 663); demise sendframe
				c.tradeResetNeeded = true;
				return;
			}</code></p>
<p>You need to rewrite both those methods and handle it better. It’s no wonder you’re having issues.</p>
<p>I’m also not seeing anything in that code to ‘reset’ the players levels.</p>
<p>What’s in the “resetDamageDone()” method?</p>
<p>Have you looked in the source for any code that could be resetting the levels? Ex:</p>
<p><code>	for (int i = 0; i &lt; 5; i++) {
		c.playerXP[i] = 0;
		c.playerLevel[i] = getLevelForXP(c.playerXP[i]);
		c.getPA().refreshSkill(i);
	}</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/death-issue/550824/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/death-issue/550824/4</link>
        <pubDate>Wed, 01 Apr 2015 03:12:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-550824-4</guid>
        <source url="https://forum.moparisthebest.com/t/death-issue/550824.rss">Death Issue</source>
      </item>
      <item>
        <title>Death Issue</title>
        <dc:creator><![CDATA[@beale beale]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/beale">@beale</a> wrote:</p>
          <blockquote>
              <p>[code] public void applyDead() {<br>
c.getTradeAndDuel().stakedItems.clear();<br>
if (c.playerName.equalsIgnoreCase(“paul”)){<br>
c.isDead = true;<br>
c.forcedChat(“I REALLY SUCK AND I WILL NEVER GET 99 PK’ING!”);<br>
}<br>
c.respawnTimer = 15;<br>
c.isDead = false;<br>
Client o = (Client) PlayerHandler.players[c.killerId];<br>
Client c2 = (Client)PlayerHandler.players[c.killerId];<br>
if(c.duelStatus != 6) {<br>
c.killerId = findKiller();<br>
if(o != null) {<br>
c.playerKilled = c.playerId;<br>
if(o.duelStatus == 5) {<br>
o.duelStatus++;<br>
}<br>
if (PlayerHandler.players[c.killerId].connectedFrom == PlayerHandler.players[c.playerKilled].connectedFrom) {<br>
c.faceUpdate(0);<br>
c.npcIndex = 0;<br>
c.playerIndex = 0;<br>
c.stopMovement();<br>
if(c.duelStatus &lt;= 4) {<br>
c.getTradeAndDuel().stakedItems.clear();<br>
c.sendMessage(“Oh dear you are dead!”);<br>
} else if(c.duelStatus != 6) {<br>
c.getTradeAndDuel().stakedItems.clear();<br>
c.sendMessage(“You have lost the duel!!!”);<br>
}<br>
resetDamageDone();<br>
c.lastVeng = 0;<br>
c.vengOn = false;<br>
resetFollowers();<br>
c.attackTimer = 10;<br>
removeAllWindows();<br>
// sendFrame126(“PkP: “+c.pkPoints+” K: “+c.kills+” D: “+c.deaths+””, 663); demise sendframe<br>
c.tradeResetNeeded = true;<br>
return;<br>
}<br>
if (PlayerHandler.players[c.killerId].connectedFrom.equals(PlayerHandler.players[c.playerKilled].connectedFrom)) {<br>
o.sendMessage(“Multiple IP detected, PK point reward removed.”);<br>
c.faceUpdate(0);<br>
c.npcIndex = 0;<br>
c.playerIndex = 0;<br>
c.stopMovement();<br>
if(c.duelStatus &lt;= 4) {<br>
c.sendMessage(“Oh dear you are dead!”);<br>
} else if(c.duelStatus != 6) {<br>
c.sendMessage(“You have lost the duel!”);<br>
}<br>
resetDamageDone();<br>
c.lastVeng = 0;<br>
c.vengOn = false;<br>
resetFollowers();<br>
c.attackTimer = 10;<br>
removeAllWindows();<br>
//sendFrame126(“PkP: “+c.pkPoints+” K: “+c.kills+” D: “+c.deaths+””, 663); demise sendframe<br>
c.tradeResetNeeded = true;<br>
return;<br>
}<br>
if (PlayerHandler.players[c.playerId].connectedFrom != o.lastKilled &amp;&amp; c.duelStatus == 0) {<br>
o.pkPoints = (o.pkPoints + 10);<br>
o.sendMessage(“You recieved 10 Points.”);<br>
o.sendMessage("You have defeated " +Misc.optimizeText(c.playerName)+ “!”);<br>
o.lastKilled = PlayerHandler.players[c.playerId].connectedFrom;<br>
o.getPA().addSkillXP(50000, 23);<br>
c.getPA().addSkillXP(-10000, 23);<br>
if (o.earningPotential &gt;= 85) {<br>
o.earningPotential -= 40 + Misc.random(50);<br>
int random = (int)(Math.random() * (xEP.length - 1));<br>
Server.itemHandler.createGroundItem(o, xEP[random][0], c.absX, c.absY,<br>
xEP[random][1], o.playerId);<br>
o.sendMessage(“You recieved an EP drop.”);<br>
o.sendMessage(“Your EP decreased to: “+c.earningPotential+”.”);<br>
}<br>
} else {<br>
c.getPA().addSkillXP(-4000, 23);<br>
o.sendMessage(“You do not recieve Points because you have killed " +c.playerName+ " twice in a row.”);<br>
if (o.earningPotential &gt;= 85) {<br>
o.earningPotential -= 40 + Misc.random(50);<br>
int random = (int)(Math.random() * (xEP.length - 1));<br>
Server.itemHandler.createGroundItem(o, xEP[random][0], c.absX, c.absY,<br>
xEP[random][1], c.playerId);<br>
o.sendMessage(“Your EP decreased to: “+c.earningPotential+”.”);<br>
}<br>
}<br>
}<br>
}<br>
c.faceUpdate(0);<br>
c.npcIndex = 0;<br>
c.playerIndex = 0;<br>
c.stopMovement();<br>
if (c.duelStatus &lt;= 4) {<br>
c.sendMessage(“Oh dear you are dead!”);<br>
c.getPA().addSkillXP(-4000, 23);<br>
} else if(c.duelStatus != 6 || !c.inArena()) {<br>
c.sendMessage(“You have lost the duel!”);<br>
/<em>o.getPA().movePlayer(<br>
Config.DUELING_RESPAWN_X<br>
+ (Misc.random(Config.RANDOM_DUELING_RESPAWN)),<br>
Config.DUELING_RESPAWN_Y<br>
+ (Misc.random(Config.RANDOM_DUELING_RESPAWN)), 0);</em>/<br>
}<br>
resetDamageDone();<br>
c.DC++;<br>
c.KC++;	<br>
c.specAmount = 10;<br>
c.getItems().addSpecialBar(c.playerEquipment[c.playerWeapon]);<br>
c.lastVeng = 0;<br>
c.vengOn = false;<br>
resetFollowers();<br>
c.attackTimer = 10;<br>
if (PlayerHandler.players[c.killerId].connectedFrom.equals(PlayerHandler.players[c.playerKilled].connectedFrom)) {<br>
o.sendMessage(“You Don’t Recieve PK Points for killing yourself!”);<br>
c.faceUpdate(0);<br>
c.npcIndex = 0;<br>
c.playerIndex = 0;<br>
c.stopMovement();<br>
if(c.duelStatus &lt;= 4) {<br>
c.sendMessage(“Oh dear you are dead!”);</p>
<pre><code>	} else if(c.duelStatus != 6) {
		c.sendMessage("You have lost the duel!");
	}
	resetDamageDone();
	c.lastVeng = 0;
	c.vengOn = false;
	resetFollowers();
	c.attackTimer = 10;
	removeAllWindows();
	c.tradeResetNeeded = true;
	return;
	}
}
[/code]
</code></pre>
<p>[code] public void giveLife() {<br>
c.isDead = false;<br>
c.faceUpdate(-1);<br>
c.freezeTimer = 0;</p>
<pre><code>	if(c.playerRights == 6) {
	for (int i = 0; i &lt; 20; i++) {
		c.playerLevel[i] = getLevelForXP(c.playerXP[i]);
		c.getPA().refreshSkill(i);
	}
	c.getCombat().resetPrayers();

	c.teleportToX = 3300;
	c.teleportToY = 3300;
</code></pre>
<p>PlayerSave.saveGame©;<br>
c.getPA().resetTzhaar();<br>
requestUpdates();<br>
return;</p>
<pre><code>	}

	if(c.duelStatus &lt;= 4 &amp;&amp; !c.getPA().inPitsWait()) { // if we are not in a duel we must be in wildy so remove items
		if (!c.inPits &amp;&amp; !c.inFightCaves() &amp;&amp; !c.inPcGame() &amp;&amp; !c.inFunPk() &amp;&amp; c.playerRights != 3 &amp;&amp; c.playerRights != 6) {
				c.getItems().resetKeepItems();
			if((c.playerRights == 2 &amp;&amp; Config.ADMIN_DROP_ITEMS) || c.playerRights != 2) {
				if(!c.isSkulled &amp;&amp; !c.isInArd()) {	// what items to keep
					c.getItems().keepItem(0, true);
					c.getItems().keepItem(1, true);	
					c.getItems().keepItem(2, true);
				}	
				if(c.prayerActive[10] || c.curseActive[0] &amp;&amp; System.currentTimeMillis() - c.lastProtItem &gt; 700) {
					c.getItems().keepItem(3, true);
				}
				c.getItems().dropAllItems(); // drop all items
				c.getItems().deleteAllItems(); // delete all items
			
				if(!c.isSkulled &amp;&amp; !c.isInArd()) { // add the kept items once we finish deleting and dropping them	
					for (int i1 = 0; i1 &lt; 3; i1++) {
						if(c.itemKeptId[i1] &gt; 0) {
							c.getItems().addItem(c.itemKeptId[i1], 1);
						}
					}
				}	
				if(c.prayerActive[10] || c.isInArd()) { // if we have protect items 
					if(c.itemKeptId[3] &gt; 0) {
						c.getItems().addItem(c.itemKeptId[3], 1);
					}
				}
			}
			c.getItems().resetKeepItems();
		} else if (c.inPits) {
			Server.fightPits.removePlayerFromPits(c.playerId);
			c.pitsStatus = 1;
		}
	}
	c.getCombat().resetPrayers();
	for (int i = 0; i &lt; 25; i++) {
		c.playerLevel[i] = getLevelForXP(c.playerXP[i]);
		c.getPA().refreshSkill(i);
	}
	if (c.playerEquipment[c.playerRing] == 2570) {
		if (c.playerLevel[3] &gt; 0 &amp;&amp; c.playerLevel[3] &lt;= c.getLevelForXP(c.playerXP[3]) / 10 &amp;&amp; c.underAttackBy &gt; 0) {
			int wildlvl = (((c.absY - 3520) / 8) + 1);
			if (wildlvl &lt; 20) {
				c.getItems().deleteEquipment(2570, c.playerRing);
		c.getPA().startTeleport(2831, 2973, 0, "modern");
		}
	}
}
	if (c.pitsStatus == 1) {
		movePlayer(2399, 5173, 0);
	} else if(c.duelStatus &lt;= 4) { // if we are not in a duel repawn to wildy
		movePlayer(Config.RESPAWN_X, Config.RESPAWN_Y, 0);
		c.isSkulled = false;
		c.skullTimer = 0;
		c.attackedPlayers.clear();
	} else if (c.inFightCaves()) {
		c.getPA().resetTzhaar();
	} else { // we are in a duel, respawn outside of arena
		Client o = (Client) PlayerHandler.players[c.duelingWith];
		if(o != null) {
			o.getPA().createPlayerHints(10, -1);
			if(o.duelStatus == 6) {
				o.getTradeAndDuel().duelVictory();
			}
		}
		movePlayer(Config.DUELING_RESPAWN_X+(Misc.random(Config.RANDOM_DUELING_RESPAWN)), Config.DUELING_RESPAWN_Y+(Misc.random(Config.RANDOM_DUELING_RESPAWN)), 0);
		if(c.duelStatus != 6) { // if we have won but have died, don't reset the duel status.
			c.getTradeAndDuel().resetDuel();
		}
	}
	//PlayerSaving.getSingleton().requestSave(c.playerId);
	PlayerSave.saveGame(c);
	c.getCombat().resetPlayerAttack();
	resetAnimation();
	c.startAnimation(-1);
	frame1();
	resetTb();
	c.isSkulled = false;
	c.attackedPlayers.clear();
	c.headIconPk = -1;
	c.skullTimer = -1;
	c.damageTaken = new int[Config.MAX_PLAYERS];
	c.getPA().requestUpdates();
	removeAllWindows();
	c.tradeResetNeeded = true;	


}
</code></pre>
<p>[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/death-issue/550824/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/death-issue/550824/3</link>
        <pubDate>Wed, 01 Apr 2015 02:43:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-550824-3</guid>
        <source url="https://forum.moparisthebest.com/t/death-issue/550824.rss">Death Issue</source>
      </item>
      <item>
        <title>Death Issue</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>Post your giveLife and applyDead methods.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/death-issue/550824/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/death-issue/550824/2</link>
        <pubDate>Tue, 31 Mar 2015 05:43:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-550824-2</guid>
        <source url="https://forum.moparisthebest.com/t/death-issue/550824.rss">Death Issue</source>
      </item>
      <item>
        <title>Death Issue</title>
        <dc:creator><![CDATA[@beale beale]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/beale">@beale</a> wrote:</p>
          <blockquote>
              <p>For some odd reason, whenever players die, it resets some of the combat levels to 0/0… I have no clue why that is, but i need to fix asap. Someone please help me out a little? Also, whenever i kill people, my defence drops to 125/0 as well as my hp.</p>
<p><img src="http://i60.tinypic.com/11tsh1i.jpg" alt width="" height=""></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/death-issue/550824/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/death-issue/550824/1</link>
        <pubDate>Mon, 30 Mar 2015 21:53:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-550824-1</guid>
        <source url="https://forum.moparisthebest.com/t/death-issue/550824.rss">Death Issue</source>
      </item>
  </channel>
</rss>
