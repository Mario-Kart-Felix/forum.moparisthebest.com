<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Looking for design suggestions</title>
    <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272</link>
    <description>This question is about a real project. You can say I&#39;m looking for a free consultation :)

Overall it&#39;s a php site or rather a collection of various php site modules and administration panels. One of the modules has to do following:
On POST request initialize several HTTP requests to external servers, like this: http://www.server1.com/somepath1/somescript1.php, http://www.server2.com/somepath2/somescript2.php, ..., http://www.servern.com/somepathn/somescriptn.php (about 10 simultaneous requests). It has to receive data returned by these sites and using special formula compute a single value to be stored in DB.

There are 2 problems:
1) php doesn&#39;t really support multithreading and even when it does, it cannot be counted on
2) this solution has to be reliable, like, if one of the sites is down, the script has to try until it becomes available.


One of the ways I could think of doing this is making the requester as Java servlet; there is a problem with this however - I lack Java experience. Thus there are 2 ways you can help me:
1) Give prototype Java servlet code that does what I want (interface for initializing new request, retry until data is obtained from all sites, save all values to mssql database)
2) Give different, maybe out of box yet keeping it simple stupid ideas of solving this.

Thanks!</description>
    
    <lastBuildDate>Tue, 14 Aug 2007 20:41:38 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@moparisthebest Moparisthebest]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moparisthebest">@moparisthebest</a> wrote:</p>
          <blockquote>
              <p>What whitecastle wrote should work just fine.  However I think that the java program will continue to run as long as there are running threads, and when the last thread ends itself will shut down automatically (therefore doing away with all of the finished() stuff, allowing the program to finish faster), this is something I have to test out though.</p>
<p>edit, proof of concept:</p>
<pre><code class="lang-auto">public class Main {

    public static void main(String[] args) {
        System.out.println("starting main()");
        new Thread() {
            public void run() {
                System.out.println("starting run()");
                try {
                    Thread.sleep(10000);
                } catch (InterruptedException ie) {}
                System.out.println("ending run()");
            }
        }.start();
        System.out.println("ending main()");
    }
}</code></pre>
<pre><code class="lang-auto">mopar@mopar-laptop:~/projects/azerothhelp$ java Main
starting main()
ending main()
starting run()
ending run()
mopar@mopar-laptop:~/projects/azerothhelp$</code></pre>
<p>edit2: Actually I just realized you need to do something with the results before the program finishes, so ignore me. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=6" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/11</link>
        <pubDate>Tue, 14 Aug 2007 20:41:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-11</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@White_Castle White Castle]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/white_castle">@White_Castle</a> wrote:</p>
          <blockquote>
              <p>Whoops! Just running over it I can see one error I made:</p>
<p>Change <code>new Thread(requester.run()).start();</code> to <code>new Thread(requester).start();</code></p>
<p>I musta been typing too fast :(.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/10</link>
        <pubDate>Tue, 14 Aug 2007 20:36:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-10</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@Azeroth Azeroth]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/azeroth">@Azeroth</a> wrote:</p>
          <blockquote>
              <p>Excellent, if this works, it’s exactly what I need. I’ll try this and let you know.<br>
Thanks a lot!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/9</link>
        <pubDate>Tue, 14 Aug 2007 20:09:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-9</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@White_Castle White Castle]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/white_castle">@White_Castle</a> wrote:</p>
          <blockquote>
              <p>Something along these lines would work:</p>
<p><code>public interface Requester extends Runnable {
  public boolean finished();
}</code></p>
<p>So then you create classes implementing this interface:</p>
<p>[code]public class HTTPRequester implements Requester {<br>
private boolean finished;</p>
<p>public void run() {<br>
//do stuff here<br>
finished = true;<br>
}</p>
<p>public boolean finished() {<br>
return finished;<br>
}<br>
}[/code]</p>
<p>Then pulling it together…</p>
<p><code>public class Main {
  public static void main(String[] args) {
    Requester[] requesters = new Requester[] {new HTTPRequester()/*, ...*/};
    for(Requester requester : requesters)
      new Thread(requester.run()).start();
    while(true) {
      try {
        Thread.sleep(cfgSleepyTime);
      } catch(InterruptedException e) { }
      boolean finished = true;
      for(Requester requester : requester)
        if(!requester.finished())
          finished = false;
      if(finished)
        break;
    }
  }
}</code></p>
<p>P.S. I typed this into the reply box, so tell me if there are problems…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/8</link>
        <pubDate>Tue, 14 Aug 2007 20:02:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-8</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@Azeroth Azeroth]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/azeroth">@Azeroth</a> wrote:</p>
          <blockquote>
              <p>Hehe, no, that’s just a PHP-like pseudocode.<br>
PHP would have $ in front of variable names and instead of “for(var in arr)” you have “foreach($arr as $var)”.</p>
<p>But that’s irrelevant, actually <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=6" title=":wink:" class="emoji" alt=":wink:"> What matters is, in Java - 1) can you put objects of different classes (inherited from the same parent class) in a single array? 2) can you create a loop that iterades through mentioned array calling some method of each object so that each method call creates a new thread?</p>
<p>Thanks.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/7</link>
        <pubDate>Tue, 14 Aug 2007 18:43:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-7</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@xxlegitxx xxlegitxx]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xxlegitxx">@xxlegitxx</a> wrote:</p>
          <blockquote>
              <p>So that’s in PHP?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/6</link>
        <pubDate>Tue, 14 Aug 2007 18:31:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-6</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@Azeroth Azeroth]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/azeroth">@Azeroth</a> wrote:</p>
          <blockquote>
              <p>Thank you for the insights!</p>
<p>I agree, Java app should serve this purpose just as well. Since you asked for it, by offering help with some sample code, here’s what I have in mind:</p>
<p>There are number of classes that all might be inherited from the same base and they all have a method doRequest(), however this method differs a lot in each class (some do http request, some do xml-rpc request, some simply call mssql stored procedure). What I want is following:</p>
<pre><code class="lang-auto">cfgRequesterClasses = new Array(CRRequester, WallRequester, BPRRequester); 

for(class in cfgRequesterClasses)
{
  startInNewThread(class-&gt;doRequest());
}

do
{
  sleep(cfgSleepyTime);
} while(not allRequestsFinished())</code></pre>
<p>Can these ramblings be converted to Java code? I know I could probably do it with help of google, but I’m afraid that would take awfully lot of time and the quality of code I would come up with would be poor, knowing I lack Java experience. Thanks.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/5</link>
        <pubDate>Tue, 14 Aug 2007 17:14:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-5</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@moparisthebest Moparisthebest]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moparisthebest">@moparisthebest</a> wrote:</p>
          <blockquote>
              <p>Interesting problem, I have no experience with java servlets (although I have heard nothing but good things!).  What I would do in your situation is, through the magic of PHP’s <a href="http://us3.php.net/function.exec" data-bbcode="true" rel="nofollow noopener">exec</a> method, make a system call to an actual java program, and the java program simply has to visit the URLs and use System.out.println(); to print the results to stdout, the call to exec will return whatever that is.</p>
<p>I have used this before when I wanted to send welcome emails from this forum through an smtp host that used SSL authentication.  I couldn’t find an SSL library for php but I did find one for java, so I wrote up a mail program in java and called it from the php script, from memory it looked something like this:</p>
<pre><code class="lang-auto">...
echo exec("java -cp /root/mail.jar Main $srcAddress $destAddress $subject $body");</code></pre>
<p>Of course the 4 variables ‘$srcAddress $destAddress $subject $body’ were already initialized via POST requests.  You do not have to send any arguments in, but you can.  When I wrote the java program I had it either print “Success!” or “Error” to stdout ( System.out.println(“msg”); ) and since I echoed the result of exec() that is what would display on the php page.</p>
<p>You could even have java program put the result in the mssql database for you if you so desired, however that is another thing I have never messed with and therefore would personally just use the result of the java program in my php script to enter it into the database.</p>
<p>I hope that solution is feasible for your project, if you have any more questions or need example code I would be happy to help. Goodluck <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/4</link>
        <pubDate>Tue, 14 Aug 2007 07:21:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-4</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@Azeroth Azeroth]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/azeroth">@Azeroth</a> wrote:</p>
          <blockquote>
              <p>The requests have to be simultaneous because the answer has to be obtained as fast as possible.</p>
<p>Unfortunately the script won’t be called from browser but other script/software instead, so AJAX won’t help.</p>
<p>Thanks for the idea, though!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/3</link>
        <pubDate>Tue, 14 Aug 2007 00:55:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-3</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@xxlegitxx xxlegitxx]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xxlegitxx">@xxlegitxx</a> wrote:</p>
          <blockquote>
              <p>Why must it be simultaneous requests?  Anyway, you could employ JS/AJAX.</p>
<p>Javascript calls the 10 pages by using SetTimeout to call a custom function (callPage(url)).  The functions multithread, repeatedly making requests until it gets an answer.  Then the function(s) returns to the main function, with the answer.  JS stores these answers until all of them are collected.  Then it sends the info to a php file via get.</p>
<pre><code class="lang-auto">function callAjax(varname, g_timezone) {
	scriptitem = document.createElement('script');
	scriptitem.type = 'text/javascript';
	scriptitem.src = 'includes/ajax.php5?varname=' + varname + '&amp;timezone=' + g_timezone;
	scriptitem.id = 'ajax';
	document.body.appendChild(scriptitem);
	setTimeout('document.body.removeChild(document.getElementById("ajax"))', 500);
}</code></pre>
<p>This is a sample code from a timer I was working on.  As you can see, ajax.php5 takes the GET variables, processes it, and outputs JS (it can just alert(‘success’) or alert(‘failure’).</p>
<p>I hope that’s plausible.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/2</link>
        <pubDate>Tue, 14 Aug 2007 00:42:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-2</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
      <item>
        <title>Looking for design suggestions</title>
        <dc:creator><![CDATA[@Azeroth Azeroth]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/azeroth">@Azeroth</a> wrote:</p>
          <blockquote>
              <p>This question is about a real project. You can say I’m looking for a free consultation <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Overall it’s a php site or rather a collection of various php site modules and administration panels. One of the modules has to do following:<br>
On POST request initialize several HTTP requests to external servers, like this: <a href="http://www.server1.com/somepath1/somescript1.php" rel="nofollow noopener">http://www.server1.com/somepath1/somescript1.php</a>, <a href="http://www.server2.com/somepath2/somescript2.php" rel="nofollow noopener">http://www.server2.com/somepath2/somescript2.php</a>, …, <a href="http://www.servern.com/somepathn/somescriptn.php" rel="nofollow noopener">http://www.servern.com/somepathn/somescriptn.php</a> (about 10 simultaneous requests). It has to receive data returned by these sites and using special formula compute a single value to be stored in DB.</p>
<p>There are 2 problems:</p>
<ol>
<li>php doesn’t really support multithreading and even when it does, it cannot be counted on</li>
<li>this solution has to be reliable, like, if one of the sites is down, the script has to try until it becomes available.</li>
</ol>
<p>One of the ways I could think of doing this is making the requester as Java servlet; there is a problem with this however - I lack Java experience. Thus there are 2 ways you can help me:</p>
<ol>
<li>Give prototype Java servlet code that does what I want (interface for initializing new request, retry until data is obtained from all sites, save all values to mssql database)</li>
<li>Give different, maybe out of box yet keeping it simple stupid ideas of solving this.</li>
</ol>
<p>Thanks!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272/1</link>
        <pubDate>Tue, 14 Aug 2007 00:26:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-133272-1</guid>
        <source url="https://forum.moparisthebest.com/t/looking-for-design-suggestions/133272.rss">Looking for design suggestions</source>
      </item>
  </channel>
</rss>
