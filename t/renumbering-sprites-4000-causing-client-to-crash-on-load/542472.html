<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/renumbering-sprites-4000-causing-client-to-crash-on-load/542472 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 03:02:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Renumbering sprites &gt;= 4000 causing client to crash on load - Runescape - moparisthebest.com</title>
    <meta name="description" content="I have found that having sprites numbered 4000 or greater causes the client to crash on load with error pointing to  

 public boolean loadSprite(int id, String packageName) {

After renaming sprites to fall just below 4&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="542472.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Renumbering sprites &gt;= 4000 causing client to crash on load&#39;" href="542472.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/renumbering-sprites-4000-causing-client-to-crash-on-load/542472" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/renumbering-sprites-4000-causing-client-to-crash-on-load/542472" />
<meta property="og:title" content="Renumbering sprites &gt;= 4000 causing client to crash on load" />
<meta name="twitter:title" content="Renumbering sprites &gt;= 4000 causing client to crash on load" />
<meta property="og:description" content="I have found that having sprites numbered 4000 or greater causes the client to crash on load with error pointing to   After renaming sprites to fall just below 4000 at 3937 max, the client loads correctly.  I’d like to expand the 4000 sprite limit as well as expand the 255 animation limit. I’ve seen that the solution for the animation limit is to replace byte with short though I have not yet encountered the problem but will shortly. What needs to be changed to support more sprites?" />
<meta name="twitter:description" content="I have found that having sprites numbered 4000 or greater causes the client to crash on load with error pointing to   After renaming sprites to fall just below 4000 at 3937 max, the client loads correctly.  I’d like to expand the 4000 sprite limit as well as expand the 255 animation limit. I’ve seen that the solution for the animation limit is to replace byte with short though I have not yet encountered the problem but will shortly. What needs to be changed to support more sprites?" />
<meta property="article:published_time" content="2014-04-23T11:37:25+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="542472.html">Renumbering sprites &gt;= 4000 causing client to crash on load</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T11:37:25Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:13Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have found that having sprites numbered 4000 or greater causes the client to crash on load with error pointing to</p>
<pre><code class="lang-auto"></code></pre>
<p>After renaming sprites to fall just below 4000 at 3937 max, the client loads correctly.</p>
<p>I’d like to expand the 4000 sprite limit as well as expand the 255 animation limit. I’ve seen that the solution for the animation limit is to replace byte with short though I have not yet encountered the problem but will shortly. What needs to be changed to support more sprites?</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T15:03:06Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:14Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>What is the exception?</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T16:33:12Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:15Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Array out of bounds and points to sprite 4000. It then continues down to mention sprite 4010, etc.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T17:30:21Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:15Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>mudclient-&gt;startGame</p>
<p><code>	gameGraphics = new GameImageMiddleMan(getWindowWidth(),
				getWindowHeight() + 12, 4000, this);
</code><br>
The argument 4000 is how big the sprites array can be.</p>
<p>Here is how to find these things in future:</p>
<pre><code class="lang-auto">	public boolean loadSprite(int id, String packageName) {
		try {
			ZipEntry e = spriteArchive.getEntry(String.valueOf(id));
			if (e == null) {
				System.err.println("Missing sprite: " + id);
				return false;
			}
			ByteBuffer data = DataConversions
					.streamToBuffer(new BufferedInputStream(spriteArchive
							.getInputStream(e)));
			sprites[id] = Sprite.unpack(data);
			return true;
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		}
	}</code></pre>
<p>You can see here where it loads the sprites into, it’s the sprites array. So let’s see where it sets the capacity.</p>
<pre><code class="lang-auto">	public GameImage(int width, int height, int k, Component component) {
		f1Toggle = false;
		drawStringShadows = false;
		imageHeight = height;
		imageWidth = width;
		imageWidthUnused = menuDefaultWidth = width;
		imageHeightUnused = menuDefaultHeight = height;
		imagePixelArray = new int[width * height];
		for (int i1 = 0; i1 &lt; imagePixelArray.length; i1++) {
			imagePixelArray[i1] = 0;
		}
		sprites = new Sprite[k];</code></pre>
<p>Here in the constructor it sets the capacity to argument k, so let’s see where this constructor is called from.</p>
<pre><code class="lang-auto">public GameImageMiddleMan(int width, int height, int k, Component component) {
		super(width, height, k, component);
	}</code></pre>
<p>Okay…well…lets keep looking.</p>
<pre><code class="lang-auto">		gameGraphics = new GameImageMiddleMan(getWindowWidth(),
				getWindowHeight() + 12, 4000, this);</code></pre>
<p>We found it and we see it’s set to 4000.</p>
<p>IDE such as eclipse comes useful in situations like these, you can simply right click a variable and select ‘Open Call Hierarchy’ and it shows every location it is used on.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T20:30:34Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:16Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you so much for the explanation.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T20:51:14Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:16Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Wow Nothing learned a thing or two  <img src="../../images/emoji/twitter/coolae52.png?v=5" title=":cool:" class="emoji" alt=":cool:"></p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-23T21:45:23Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:17Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="6" data-topic="542472">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/rodgerwilco/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Rodgerwilco:</div>
<blockquote>
<p>Wow Nothing learned a thing or two  <img src="../../images/emoji/twitter/coolae52.png?v=5" title=":cool:" class="emoji" alt=":cool:"></p>
</blockquote>
</aside>
<p>I know bunch of stuff. I just don’t have the need to show off.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-24T18:03:23Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:23Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>For expanding beyond the 255 animation limit, I see that this is what needs to be changed:</p>
<p><code>} else if (mobUpdateType == 5) { // Apperance update
                  if (mob != null) {
                     mob.mobIntUnknown = DataOperations
                     .getUnsigned2Bytes(data, mobUpdateOffset);
                     mobUpdateOffset += 2;
                     mob.nameLong = DataOperations.getUnsigned8Bytes(
                           data, mobUpdateOffset);
                     mobUpdateOffset += 8;
                     mob.name = DataOperations
                     .longToString(mob.nameLong);
                     int i31 = DataOperations
                     .getUnsignedByte(data[mobUpdateOffset]);
                     mobUpdateOffset++;
                     for (int i35 = 0; i35 &lt; i31; i35++) {
                        mob.animationCount[i35] = DataOperations
                        .getUnsignedByte(data[mobUpdateOffset]);
                        mobUpdateOffset++;
                     }</code></p>
<p>This points to DataOperations with:</p>
<p>[code]public static int getUnsignedByte(byte byte0) {<br>
return byte0 &amp; 0xff;<br>
}</p>
<p>public static int getUnsigned2Bytes(byte abyte0[], int i) {<br>
return ((abyte0[i] &amp; 0xff) &lt;&lt; 8) + (abyte0[i + 1] &amp; 0xff);<br>
}</p>
<p>public static int getUnsigned4Bytes(byte abyte0[], int i) {<br>
return ((abyte0[i] &amp; 0xff) &lt;&lt; 24) + ((abyte0[i + 1] &amp; 0xff) &lt;&lt; 16)<br>
+ ((abyte0[i + 2] &amp; 0xff) &lt;&lt; 8) + (abyte0[i + 3] &amp; 0xff);<br>
}</p>
<p>public static long getUnsigned8Bytes(byte abyte0[], int i) {<br>
return (((long) getUnsigned4Bytes(abyte0, i) &amp; 0xffffffffL) &lt;&lt; 32)<br>
+ ((long) getUnsigned4Bytes(abyte0, i + 4) &amp; 0xffffffffL);<br>
}[/code]</p>
<p>How to change the type from byte to int or short but I am not sure what to change the four byte types to though.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-24T19:07:02Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:23Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You only need to change it so it reads a short instead of a byte.</p>
<pre><code class="lang-auto">DataOperations.getUnsigned2Bytes(data[mobUpdateOffset]);
mobUpdateOffset += 2;</code></pre>
<p>And then you will need to change it server side so it sends short as well.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-24T19:19:10Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:23Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Also had to change src/org/WolfZ/gs/builders/PlayerUpdatePacketBuilder.java</p>
<pre><code class="lang-auto">             updates.addLong(p.getUsernameHash());
             updates.addByte((byte) p.getWornItems().length);
             for (int i : p.getWornItems()) {
-               updates.addByte((byte) i); //remove this part
+               updates.addShort(i); // enables more than 255 animations as a short
             }
             updates.addByte(appearance.getHairColour());
             updates.addByte(appearance.getTopColour());</code></pre>
<p>All is now working! <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-24T22:41:47Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:02:58Z' class='post-time'>
              August 4, 2016,  1:02pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote="-Nothing, post:7, topic:542472"][quote author=Rodgerwilco link=topic=661350.msg4420807#msg4420807 date=1398286274]<br>
Wow Nothing learned a thing or two  <img src="../../images/emoji/twitter/coolae52.png?v=5" title=":cool:" class="emoji" alt=":cool:"><br>
[/quote]<br>
I know bunch of stuff. I just don’t have the need to show off.[/quote]</p>
<p>I know but compared to before tho… it looks like you’re shaping some skillz.</p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/cleako.html'><span itemprop='name'>cleako</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-29T14:54:13Z'>
            <time itemprop='dateModified' datetime='2016-08-04T13:04:11Z' class='post-time'>
              August 4, 2016,  1:04pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>These are the changes that I have made to renumber sprites, support more than 4000 sprites, and support more than 255 animations. Thanks to Crooks and -Nothing for the help.</p>
<p>This is the freeware tool that I used to mass rename sprite files: <a href="http://www.advancedrenamer.com/" data-bbcode="true" rel="nofollow noopener">http://www.advancedrenamer.com</a></p>
<p><span class="bbcode-b">client.mudclient:</span></p>
<p>Line 150:</p>
<p><code>
   public static final int SPRITE_MEDIA_START = 2800;
   public static final int SPRITE_UTIL_START = 2850;
   public static final int SPRITE_ITEM_START = 2900;
   public static final int SPRITE_LOGO_START = 3800;
   public static int SPRITE_PROJECTILE_START = 3810;
   public static final int SPRITE_TEXTURE_START = 3870;</code></p>
<p>Line 3798:</p>
<p><code>
   gameGraphics = new GameImageMiddleMan(windowWidth, windowHeight + 12, 9000, this); //9000 is the specified maximum number of sprites allowed (was 4000)</code></p>
<p>Line 3913:</p>
<p><code>
   loadSprite(animationNumber, "entity", 15);
   if (EntityHandler.getAnimationDef(animationIndex).hasA()) {
      loadSprite(animationNumber + 15, "entity", 3); //15 spacing for hasA animations
   }
      if (EntityHandler.getAnimationDef(animationIndex).hasF()) {
      loadSprite(animationNumber + 18, "entity", 9); //18 spacing for hasF animations
   }
   EntityHandler.getAnimationDef(animationIndex).number = animationNumber;
   animationNumber += 27; //default spacing between sprites (10 seperate, 17 animations per sequence = 27)</code></p>
<p>Line 6863:</p>
<p><code>
   for (int i35 = 0; i35 &lt; i31; i35++) {
      mob.animationCount[i35] = DataOperations.getUnsigned2Bytes(data, mobUpdateOffset); // changed to support more than 255 animations as a short
      mobUpdateOffset +=2; //changed to be a short
   }</code></p>
<p><span class="bbcode-b">client.GameImage:</span> (fixes admin/mod/dev crown sprite in chat and matches method used in mudclient for sprite references)</p>
<p>Line 1796:</p>
<p><code>
else if (string.charAt(offset) == '#'
                        &amp;&amp; offset + 4 &lt; string.length()
                        &amp;&amp; string.charAt(offset + 4) == '#'
                        &amp;&amp; string.substring(offset + 1, offset + 4)
                                .equalsIgnoreCase("adm")) {
                    spriteClip4(x - 12, y - 16, 30, 20, (SPRITE_ITEM_START + 189), -256, 0, 0, false); // phat sprite
                    x += 14;
                    offset += 4;
                } else if (string.charAt(offset) == '#'
                        &amp;&amp; offset + 4 &lt; string.length()
                        &amp;&amp; string.charAt(offset + 4) == '#'
                        &amp;&amp; string.substring(offset + 1, offset + 4)
                                .equalsIgnoreCase("mod")) {
                    spriteClip4(x - 12, y - 16, 30, 20, (SPRITE_ITEM_START + 189), -2302756, 0, 0, // phat sprite
                            false);
                    x += 14;
                    offset += 4;
                } else if (string.charAt(offset) == '#'
                        &amp;&amp; offset + 4 &lt; string.length()
                        &amp;&amp; string.charAt(offset + 4) == '#'
                        &amp;&amp; string.substring(offset + 1, offset + 4)
                                .equalsIgnoreCase("pmd")) {
                    spriteClip4(x - 12, y - 16, 30, 20, (SPRITE_ITEM_START + 189), -13382656, 0, 0, // phat sprite
                            false);</code></p>
<p><span class="bbcode-b">gs.builders.PlayerUpdatePacketBuilder:</span></p>
<p>Line 82:</p>
<p><code>
   for (int i : p.getWornItems()) {
      updates.addShort(i); // enables more than 255 animations as a short
   }</code></p>
      </div>

      <meta itemprop='headline' content='Renumbering sprites &gt;= 4000 causing client to crash on load'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/renumbering-sprites-4000-causing-client-to-crash-on-load/542472 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 03:02:45 GMT -->
</html>
