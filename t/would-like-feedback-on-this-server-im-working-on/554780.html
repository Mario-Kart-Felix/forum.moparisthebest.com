<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/would-like-feedback-on-this-server-im-working-on/554780 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Would like feedback on this server I&#39;m working on - Runescape - moparisthebest.com</title>
    <meta name="description" content="There&amp;#39;s nothing big on it yet, I&amp;#39;ve gotten to the point where you can login and that&amp;#39;s about it. Would like some feedback/criticism on what I have right now before continuing. 

If you connect a client to the server it c&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="554780.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Would like feedback on this server I&#39;m working on&#39;" href="554780.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/would-like-feedback-on-this-server-im-working-on/554780" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/would-like-feedback-on-this-server-im-working-on/554780" />
<meta property="og:title" content="Would like feedback on this server I&#39;m working on" />
<meta name="twitter:title" content="Would like feedback on this server I&#39;m working on" />
<meta property="og:description" content="There’s nothing big on it yet, I’ve gotten to the point where you can login and that’s about it. Would like some feedback/criticism on what I have right now before continuing.  If you connect a client to the server it can login but after a couple second it disconnects; would anyone explain me why this is? (does it have to do with the client waiting for the player updating packet?)  Should I use ScheduledExecutorService for the CycleEngine instead of Timer? Since we’re feeding the tick into any t..." />
<meta name="twitter:description" content="There’s nothing big on it yet, I’ve gotten to the point where you can login and that’s about it. Would like some feedback/criticism on what I have right now before continuing.  If you connect a client to the server it can login but after a couple second it disconnects; would anyone explain me why this is? (does it have to do with the client waiting for the player updating packet?)  Should I use ScheduledExecutorService for the CycleEngine instead of Timer? Since we’re feeding the tick into any t..." />
<meta property="article:published_time" content="2016-02-18T22:59:32+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="554780.html">Would like feedback on this server I&#39;m working on</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-18T22:59:32Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:50:59Z' class='post-time'>
              August 4, 2016,  5:50pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>There’s nothing big on it yet, I’ve gotten to the point where you can login and that’s about it. Would like some feedback/criticism on what I have right now before continuing.</p>
<p>If you connect a client to the server it can login but after a couple second it disconnects; would anyone explain me why this is? (does it have to do with the client waiting for the player updating packet?)</p>
<p>Should I use ScheduledExecutorService for the CycleEngine instead of Timer? Since we’re feeding the tick into any tick-related events this doesn’t seem necessary.</p>
<p>Do I need to use a seperate thread if I wish to save players? Should I save cloned instances of players and if so, should I have to worry about instances of objects still being referenced in the clone?</p>
<p>Any code or design related comments are much appreciated as well.</p>
<p>edit: posted in wrong section… this probably belongs in server help</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T03:11:39Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:50:59Z' class='post-time'>
              August 4, 2016,  5:50pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>should really consider using version control so we can view the contents online… but ill DL anyway and post back with some constructive criticismz</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T03:42:10Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:00Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I tried setting up github but it wouldnt let me push updates to the site or w/e</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Death_Style.html'><span itemprop='name'>Death_Style</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T05:16:40Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:00Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>create the repo, follow the instructions, then git push origin master. github is great I hope you figure it out it will make your life much easier. or bitbucket too</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T13:08:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:00Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>mmk, here are some things I noticed</p>
<ol>
<li>
<p>field (excluding constants) and method names should be written in camelCase not underscore_case (referring to Server class)</p>
</li>
<li>
<p>for your CycleEngine class, read <a href="http://stackoverflow.com/a/409993/5291794" data-bbcode="true" rel="nofollow noopener">this</a> on why you should use ScheduledExecutorService over Timer/TimerTask. <a href="https://github.com/google/guava/wiki/ServiceExplained" data-bbcode="true" rel="nofollow noopener">Guava’s service model</a> works nicely too (and uses ExecutorService internally) and you can find an example of that in action <a href="https://github.com/lare96/luna/blob/master/src/main/java/io/luna/game/GameService.java" data-bbcode="true" rel="nofollow noopener">here</a></p>
</li>
<li>
<p>singleton is an anti-pattern aka don’t use it</p>
</li>
<li>
<p>[code=java]private static HashMap&lt;String, SaveToken&gt; tokenset;</p>
<p>static {<br>
HashMap&lt;String, SaveToken&gt; tokens = new HashMap&lt;String, SaveToken&gt;();<br>
tokens.put(“username”, new SaveToken() {<br>
public void set(Player p, String s) {<br>
p.setName(s);<br>
}<br>
public String get(Player p) {<br>
return p.getName();<br>
}<br>
});<br>
tokens.put(“password”, new SaveToken() {<br>
public void set(Player p, String s) {<br>
p.setPassword(s);<br>
}<br>
public String get(Player p) {<br>
return p.getPass();<br>
}<br>
});<br>
tokenset = tokens;<br>
}[/code]</p>
</li>
</ol>
<p>“tokenset = tokens” ? why not just properly declare tokenset and add the elements to it?</p>
<ol start="5">
<li>
<p>[code=java]	private String[] toWrite;<br>
private File file;</p>
<p>public PlayerSaver(Player player) {<br>
file = new File(SAVE_DIR+player.getName()+".txt");<br>
ArrayList list = new ArrayList();<br>
String[] keys = new String[SaveToken.getTokens().size()];<br>
SaveToken.getTokens().keySet().toArray(keys);<br>
for (String s : keys) {<br>
list.add(s+":"+SaveToken.getTokens().get(s).get(player));<br>
}<br>
toWrite = new String[list.size()];<br>
list.toArray(toWrite);<br>
}[/code]</p>
</li>
</ol>
<p>what’s with converting stuff to an array? could just be as simple as</p>
<p>[code=java]	private final List toWrite = new ArrayList&lt;&gt;();<br>
private final File file;</p>
<pre><code>public PlayerSaver(Player player) {
	file = new File(SAVE_DIR + player.getName() + ".txt");
            
            Set&lt;Entry&lt;String, TokenSet&gt;&gt; entries = SaveToken.getTokens().entrySet();
	for(Entry&lt;String, TokenSet&gt; entry : entries) {
                toWrite.add(entry.getKey() + ":"+entry.getValue().get(player))
            }
}[/code]
</code></pre>
<ol start="6">
<li>
<p>to answer one of your questions, yes all I/O should be done asynchronously. that includes player saving. use <span class="bbcode-b">one</span> cached thread pool for all of that</p>
</li>
<li>
<p>unless you really know what you’re doing when it comes to networking you just should consider using <a href="http://netty.io/" data-bbcode="true" rel="nofollow noopener">Netty</a>. writing networking code without a nice abstraction layer that it provides will take you 3x as long. even worse, it will most likely perform much worse (nothing you or I write with “raw NIO” could come close to being better than Netty)</p>
</li>
</ol>
<p>plus it comes with a ton of useful features like its own ByteBuf (much better than java.nio.ByteBuffer), buffer pooling, etc. and does all of the ‘dirty’ and complicated work for you so all you have to do is plug in the code</p>
<ol start="8">
<li>if you don’t care for <span class="hashtag">#7</span>, at least take heed to this: you’re using blocking IO aka “thread per client” which means you’ll have to dedicate an IO thread to every single online player. if you aren’t going to use Netty, please at least use non-blocking IO</li>
</ol>
<p>all in all though do some research, learn more, and don’t give up… writing a server is a great learning experience. good luck man</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T13:28:19Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:00Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>All the array and ‘tokenset’ thingies were there because I used arraylists and hashmaps to load everything and then convert to lists/sets to use them (or at least that was my plan). Didn’t get around to change it back when I realized it wasn’t really necessary but I guess it takes up unnecessary cycles.</p>
<p>I saw the use of the singleton thingy in several other projects so I thought it was ok. Guess I’ll allow instancing of the CycleEngine.</p>
<p>I want to use as few (preferable none at all) external libraries as possible because I just want to get how everything works. Bit-level operations is still something I have to spend a couple minutes thinking about and still not be entirely sure of what I’m doing. (the same idea of not wanting to use an IDE to auto-fill things for you if you want to memorize everything for yourself first)</p>
<p>The only thing I don’t get is the thread per client thing. Which part of the server are you talking about in specific?<br>
There’s only 3 threads running in total:<br>
The first and second are inside the ConnectionAcceptor to accept and process incoming connections and the third one is the 600ms ticker in the CycleEngine class</p>
<p>edit: I just read up on blocking io.</p>
<p>I assume you’re talking about connectionAcceptor thread in the ConnectionAcceptor class, but I still don’t see the problem. The <em>only</em> thing that thread does is wait for connections and add them to the list (if possible) from which the second thread takes over so it doesn’t matter if the thread blocks because of ServerSocket.accept().</p>
<p>Unless a new thread is created by any of the java libraries that I’m using without me being aware of it, I don’t see a problem with this design but I’m all ears if you wish to explain <img src="../../images/emoji/twitter/stuck_out_tongueae52.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>edit 2: how about the saving question? let’s say a player died. on the exact moment where he revives we make the server save the player. But from the time save() is called and to the time it really executes (assuming we’re using a new thread to save, which might have some traffic) some values might have already changed on the player. So upon calling save() should I save a clone of the player? I read somewhere that when you clone a player any object references inside the player class will still reference the “original” player. how do I prevent this?</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T20:46:55Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:01Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Cres, post:6, topic:554780”]The only thing I don’t get is the thread per client thing. Which part of the server are you talking about in specific?<br>
There’s only 3 threads running in total:<br>
The first and second are inside the ConnectionAcceptor to accept and process incoming connections and the third one is the 600ms ticker in the CycleEngine class</p>
<p>edit: I just read up on blocking io.</p>
<p>I assume you’re talking about connectionAcceptor thread in the ConnectionAcceptor class, but I still don’t see the problem. The <em>only</em> thing that thread does is wait for connections and add them to the list (if possible) from which the second thread takes over so it doesn’t matter if the thread blocks because of ServerSocket.accept()[/quote]<br>
you don’t see it now because you haven’t even gotten to the point where you’re decoding packets. when you read data from the client using a client’s InputStream, it will block. so what does this mean? in order to have multiple players online at one time you’ll need to dedicate a thread for every single player (one thread that handles reading, for every single player)</p>
<aside class="quote" data-post="6" data-topic="554780">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/cres/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Cres:</div>
<blockquote>
<p>edit 2: how about the saving question? let’s say a player died. on the exact moment where he revives we make the server save the player. But from the time save() is called and to the time it really executes (assuming we’re using a new thread to save, which might have some traffic) some values might have already changed on the player. So upon calling save() should I save a clone of the player? I read somewhere that when you clone a player any object references inside the player class will still reference the “original” player. how do I prevent this?</p>
</blockquote>
</aside>
<p>um that’s not really necessary but if you’re really concerned about that just build the “token set” on the game thread then do the actual I/O with the token set asynchronously</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-19T21:28:40Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:01Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>oooh, didn’t know that reading from an InputStream also blocked the thread. could I work around that by using a ScheduledExecutorService and a Callable returning a byte array from the InputStream?</p>
<p>if not, I might read up on Netty but don’t really want to</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-20T03:46:17Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:02Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="8" data-topic="554780">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/cres/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Cres:</div>
<blockquote>
<p>oooh, didn’t know that reading from an InputStream also blocked the thread. could I work around that by using a ScheduledExecutorService and a Callable returning a byte array from the InputStream?</p>
</blockquote>
</aside>
<p>you would still be using tons of threads, just use non-blocking IO. you can use non-blocking IO without using Netty ya know</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-20T04:19:15Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:02Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>what packages should I be looking at then?</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-20T17:51:34Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:04Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="10" data-topic="554780">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/cres/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Cres:</div>
<blockquote>
<p>what packages should I be looking at then?</p>
</blockquote>
</aside>
<p>read up a little on the reactor pattern (and why blocking IO doesn’t scale well). it’s super simple, a typical impl looks like</p>
<p>[code=java]selector.selectNow();<br>
Iterator $it = selector.selectedKeys().iterator();</p>
<p>while($it.hasNext()) {<br>
SelectionKey client = $it.next(); // “SelectionKey” refers to the Client we are handling events for</p>
<pre><code>if(!client.isValid()) {
    $it.remove(); // disconnected client, can't handle events for it
    continue;
}

try {
    if(client.isAcceptable()) {
        // Client is able to login. Perform any host filtering/throttling here, and prepare it for reading data
    } else if(client.isReadable()) {
        // Read data from the client here
    } else if(client.isWritable()) {
       // Write data to the client here
    }
} finally {
    $it.remove(); // Always remove the client when we're done handling events for it!
}
</code></pre>
<p>}<br>
[/code]</p>
<p>see? it’s all asynchronous… none of these methods block, they all return instantly. you don’t need a thread just to accept connections, it’s all done here meaning you can do this all on one thread if you really wanted to. it’s completely up to you</p>
<p>it’s a lot more flexible, you have full control over how you want to handle events:</p>
<ul>
<li>you can run the reactor on its own dedicated thread, queue packets over to the game thread (best solution)</li>
<li>you can do what blakeman8192 did with Runesource and run the reactor on the main game thread (every 600ms, less resource usage at the cost of longer login times)</li>
<li>you can even combine the above two with a “dual reactor” design and have login events handled on a dedicated thread but handle packets right on the game thread, kinda like the best of both worlds (pretty complicated, easy to fudge up)</li>
</ul>
<p><a href="https://github.com/flimsy/asteria-2.0/blob/master/src/server/core/net/" data-bbcode="true" rel="nofollow noopener">here’s an implementation</a> of it I did a few years ago that uses the first solution, it’s really bad but it’ll give you an idea of how it works</p>
<p>Java 1.7 even shipped asynchronous NIO classes with callbacks, but that’s probably too complicated for now. stick to the above and you should be okay</p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-02-20T21:58:27Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:51:04Z' class='post-time'>
              August 4, 2016,  5:51pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Many thanks <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
      </div>

      <meta itemprop='headline' content='Would like feedback on this server I&#39;m working on'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/would-like-feedback-on-this-server-im-working-on/554780 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:40 GMT -->
</html>
