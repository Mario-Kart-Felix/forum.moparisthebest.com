<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Dementhium 639] Getting pk points to save</title>
    <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187</link>
    <description>I have made a pk point system but it doesn&#39;t save when I gain pk points from killing someone, using a command, or killing an npc.

How do I make it save when I&#39;ve gained pk points?
I am thinking in playerloader.java but I wouldn&#39;t know how to add it there

[youtube]http://youtu.be/6FXSc1ITalI[/youtube]

I swear... no one helps me
Maybe everyone who looks at this thread is a noob</description>
    
    <lastBuildDate>Wed, 21 Dec 2011 20:34:37 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Team_Rocket Team_Rocket]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/team_rocket">@Team_Rocket</a> wrote:</p>
          <blockquote>
              <p>You need to make it save to the Character Files. Just look for where other player information is prepared to be saved and add it in there. You’ll possibly need to add it in more than one place like this. Then all you need to do is declare the Int.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/15</link>
        <pubDate>Wed, 21 Dec 2011 20:34:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-15</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>i don’t have the same thing as you because I wrote it from scratch and I don’t have a source <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>if (command[0].equalsIgnoreCase(“onepoint”)) {<br>
pkpoints++;<br>
}</p>
<p>should +1 to your current points.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/14</link>
        <pubDate>Wed, 21 Dec 2011 20:26:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-14</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>OOO you almost has the same thing as me<br>
I downloaded netbeans<br>
Why do I need an IDE?</p>
<p>My command giving me errors?</p>
<p><code>if (command[0].equals("givepoints")) {
		player.getPkPoints() = (player.getPkPoints() + 2);
		}</code></p>
<p><code>Compiling RS2Server...
src\org\dementhium\content\Commands.java:110: error: unexpected type
                player.getPkPoints() = (player.getPkPoints() + 2);
                                  ^
  required: variable
  found:    value
1 error
Complete
Press any key to continue . . .</code></p>
<p>I need this to test out my saving<br>
I swear I have it right</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/13</link>
        <pubDate>Wed, 21 Dec 2011 19:35:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-13</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>Lolol, good job pointing out my flaw <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"> good ol getters and setters. T</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/12</link>
        <pubDate>Wed, 21 Dec 2011 19:24:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-12</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@lemme_winks lemme_winks_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/lemme_winks">@lemme_winks</a> wrote:</p>
          <blockquote>
              <p>^</p>
<p><span class="bbcode-s">why do you have an accessor and a modifier if the variable is public</span></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/11</link>
        <pubDate>Wed, 21 Dec 2011 19:22:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-11</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>private int pkpoints = 0;</p>
<p><code>public int getPkPoints() {
   return pkpoints;
}</code></p>
<p><code>public void setPkPoints(int pkpoints) {
this.pkpoints = pkpoints;
}</code></p>
<p>buffer.writeInt(player.getPkPoints());</p>
<p>Its defiantly the</p>
<pre><code class="lang-auto"></code></pre>
<p>methods.<br>
Not sure how to write it as I don’t often mess around with rs2 but… basically keep attempting.</p>
<p>If you were using an IDE it would help <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/10</link>
        <pubDate>Wed, 21 Dec 2011 19:16:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-10</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>I think this is all of it</p>
<p>[code=java]public void load(ByteBuffer buffer) {<br>
BufferUtils.readRS2String(buffer);<br>
if(buffer.remaining() &gt; 0) {</p>
<pre><code>		setLocation(Location.locate(buffer.getShort(), buffer.getShort(), buffer.get()));
		skills.setHitPoints(buffer.getShort());
		settings.setSpellBook(buffer.getShort());
		prayer.setAncientBook(buffer.get() == 1);
		for (int i = 0; i &lt; Skills.SKILL_COUNT; i++) {
			skills.setLevelAndXP(i, buffer.get(), buffer.getInt());
		}
		for (int i = 0; i &lt; Inventory.SIZE; i++) {
			int id = buffer.getShort();
			if (id == -1) {
				continue;
			}
			inventory.getContainer().set(i, new Item(id, buffer.getInt()));
		}
		for (int i = 0; i &lt; Equipment.SIZE; i++) {
			int id = buffer.getShort();
			if (id == -1) {
				continue;
			}
			equipment.getContainer().set(i, new Item(id, buffer.getInt()));
		}
		for (int i = 0; i &lt; Bank.SIZE; i++) {
			int id = buffer.getShort();
			if (id == -1) {
				continue;
			}
			bank.getContainer().set(i, new Item(id, buffer.getInt()));
		}
		for (int i = 0; i &lt; Bank.TAB_SIZE; i ++) {
			bank.getTab()[i] = buffer.getShort();
		}
		settings.setPrivateTextColor(buffer.get());
		int friendLoop = buffer.get() &amp; 0xFF;
		for(int i = 0; i &lt; friendLoop; i++) {
			friendManager.getFriends().add(BufferUtils.readRS2String(buffer));
		}
		settings.setLastXAmount(buffer.getInt());
		getPoisonManager().continuePoison(buffer.getShort());
		settings.setGodEntranceRope(buffer.get() == 1);
		settings.setCombatStyle(buffer.get());
		settings.setCombatType(buffer.get());
		settings.setLastSelection(buffer.get());
		skills.setPrayerPoints(buffer.get() &amp; 0xff, false);
		for(int i = 0; i &lt; 30; i++) {
			boolean activated = buffer.get() == 1;
			if(i &lt; 20 &amp;&amp; prayer.getPrayerBook() == 1) {
				prayer.getQuickPrayers()[1][i] = activated;
			} else if(prayer.getPrayerBook() == 0) {
				prayer.getQuickPrayers()[0][i] = activated;
			}
		}
		settings.setAutoRetaliate(buffer.get() == 1);
		if (buffer.get() == 1) {
			setAttribute("clanToJoin", BufferUtils.readRS2String(buffer));
		}
		skills.setExperienceCounter(buffer.getInt());
		for (int i = 0; i &lt; 4; i++) {
			settings.getStrongholdChest()[i] = buffer.get() == 1;
		}
		starter = buffer.get() == 1;
		settings.setSpecialAmount(buffer.getShort());
		buffer.get();
		buffer.get();
		//getCombatState().setTeleblock(buffer.getLong());
		buffer.getLong();
		int length = buffer.get();
		for(int i = 0; i &lt; length; i++){
			String text = BufferUtils.readRS2String(buffer);
			int color = buffer.get();
			notes.addNote(text, color);
		}
		if(buffer.remaining() &gt; 0) {
			if(buffer.get() == 1) {
				slayer.setSlayerTask(new SlayerTask(Master.values()[buffer.get()], buffer.get(), buffer.getInt()));
			}
		}
		if (buffer.remaining() &gt; 0) {
			buffer.get();
		}
		if (buffer.remaining() &gt; 0) {
			 buffer.get();
		}
		if(buffer.remaining() &gt; 0){
			buffer.get();
		}
		if(buffer.remaining() &gt; 0) {
			buffer.get();
		}
		if(buffer.remaining() &gt; 0) {
			lastConnectIp = BufferUtils.readRS2String(buffer);
		}
		if (buffer.remaining() &gt; 0) {
			settings.setGraveStone(buffer.get());
		}
	}
	//OKAY so we add all the way to the bottom
	//if you the value is a boolean use a byte but if the value is going to be greater then 128 use a short and if its greater then 32768 use an int

	//what do you need saved player.getSettings().hasGodwarsRope();

}

public void save(ChannelBuffer buffer) { // we use a dynamic buffer
	BufferUtils.writeRS2String(buffer, getPassword());
	buffer.writeShort((short) getLocation().getX());
	buffer.writeShort((short) getLocation().getY());
	buffer.writeByte((byte) getLocation().getZ());
	buffer.writeShort((short) skills.getHitPoints());
	buffer.writeShort((short) settings.getSpellBook());
	buffer.writeByte((byte) (prayer.isAncientCurses() ? 1 : 0));
	for (int i = 0; i &lt; Skills.SKILL_COUNT; i++) {
		buffer.writeByte((byte) skills.getLevel(i));
		buffer.writeInt((int) skills.getXp(i));
	}
	for (int i = 0; i &lt; Inventory.SIZE; i++) {
		Item item = inventory.get(i);
		if (item == null) {
			buffer.writeShort((short) -1);
		} else {
			buffer.writeShort((short) item.getId());
			buffer.writeInt(item.getAmount());
		}
	}
	for (int i = 0; i &lt; Equipment.SIZE; i++) {
		Item item = equipment.get(i);
		if (item == null) {
			buffer.writeShort((short) -1);
		} else {
			buffer.writeShort((short) item.getId());
			buffer.writeInt(item.getAmount());
		}
	}
	for (int i = 0; i &lt; Bank.SIZE; i++) {
		Item item = bank.getContainer().get(i);
		if (item == null) {
			buffer.writeShort((short) -1);
		} else {
			buffer.writeShort((short) item.getId());
			buffer.writeInt(item.getAmount());
		}
	}
	for (int i = 0; i &lt; Bank.TAB_SIZE; i++) {
		buffer.writeShort((short) bank.getTab()[i]);
	}
	buffer.writeByte((byte) settings.getPrivateTextColor());
	buffer.writeByte((byte) friendManager.getFriends().size());
	for(String string : friendManager.getFriends()) {
		BufferUtils.writeRS2String(buffer, string);
	}
	buffer.writeInt(settings.getLastXAmount());
	if(getPoisonManager().isPoisoned()) {
		buffer.writeShort(getPoisonManager().getCurrentPoisonAmount());
	} else {
		buffer.writeShort(0);
	}
	buffer.writeByte(settings.hasGodEntranceRope() ? 1 : 0); // DONE!
	buffer.writeByte(settings.getCombatStyle());
	buffer.writeByte(settings.getCombatType());
	buffer.writeByte(settings.getLastSelection());
	buffer.writeByte((byte) Math.ceil(skills.getPrayerPoints()));
	for(int i = 0; i &lt; 30; i++) {
		if(i &gt;= 20 &amp;&amp; prayer.getPrayerBook() == 1) {
			buffer.writeByte(0);
		} else {
			buffer.writeByte(prayer.getQuickPrayers()[prayer.getPrayerBook()][i] ? 1 : 0);
		}
	}
	buffer.writeByte(settings.isAutoRetaliate() ? 1 : 0);
	buffer.writeByte(settings.getCurrentClan() != null ? 1 : 0);
	if (settings.getCurrentClan() != null) {
		BufferUtils.writeRS2String(buffer, settings.getCurrentClan().getOwner());
	}
	buffer.writeInt(skills.getExperienceCounter());
	for (int i = 0; i &lt; 4; i++) {
		buffer.writeByte(settings.getStrongholdChest()[i] ? 1 : 0);
	}
	buffer.writeByte(starter ? 1 : 0);
	buffer.writeShort(settings.getSpecialAmount());
	buffer.writeInt((int) pkPoints);
	buffer.writeByte(0);
	buffer.writeByte(0);
	//buffer.writeLong(getCombatState().getTeleblockTime());
	buffer.writeLong(0); //this was trade delay
	buffer.writeByte(getNotes().getList().size());
	for(Note n : getNotes().getList()) {
		BufferUtils.writeRS2String(buffer, n.getText());
		buffer.writeByte(n.getColor());
	}
	buffer.writeByte(slayer.getSlayerTask() != null ? 1 : 0);
	if(slayer.getSlayerTask() != null) {
		buffer.writeByte(slayer.getSlayerTask().getMaster().ordinal());
		buffer.writeByte(slayer.getSlayerTask().getTaskId());
		buffer.writeInt(slayer.getSlayerTask().getTaskAmount());
	}
	buffer.writeByte(0);
	buffer.writeByte(0);
	buffer.writeByte(0);
	BufferUtils.writeRS2String(buffer, lastConnectIp);
	buffer.writeByte(settings.getGraveStone());
}[/code]
</code></pre>
<p>Btw I tried changing it and I did the buffer but it still doesn’t save</p>
<pre><code class="lang-auto"></code></pre>
<p>[code=java]	public int pkPoints = 0;</p>
<pre><code>public int getpkPoints() {
	return (int) pkPoints;
}[/code]
</code></pre>
<p>If this was PI I wouldn’t have to go through this…<br>
But I hate PI</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/9</link>
        <pubDate>Wed, 21 Dec 2011 18:47:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-9</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>Post the entire save method so I can take a better look.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/8</link>
        <pubDate>Wed, 21 Dec 2011 18:37:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-8</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>aww crap I don’t have errors but when I try to log in it says character file error</p>
<p>I did what you said and I get random things when I log in<br>
something nulled in my inventory or the banks won’t open or the mage book has eggs in the middle of it<br>
tons of things randomly happen when I relog<br>
I have this</p>
<pre><code class="lang-auto"></code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/7</link>
        <pubDate>Wed, 21 Dec 2011 17:57:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-7</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>Like I said you need to incorporate pk points into your <span class="bbcode-b">saving</span> and <span class="bbcode-b">loading</span> method. You said it was an Int…<br>
so like .writeInt((int) maybe? Idk <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> look at how other things are done.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/6</link>
        <pubDate>Wed, 21 Dec 2011 17:54:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-6</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>should I add something like</p>
<pre><code class="lang-auto"></code></pre>
<p>no errors</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/5</link>
        <pubDate>Wed, 21 Dec 2011 17:50:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-5</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>player class, save method…<br>
player.save</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/4</link>
        <pubDate>Wed, 21 Dec 2011 17:46:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-4</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>This is made simply by making a public int<br>
Thats why it’s not saving</p>
<p>[code=java]package <a href="http://org.dementhium.io" rel="nofollow noopener">org.dementhium.io</a>;</p>
<p>import java.io.BufferedWriter;<br>
import java.io.File;<br>
import java.io.FileWriter;<br>
import java.io.IOException;<br>
import java.nio.ByteBuffer;</p>
<p>import org.dementhium.content.misc.PunishHandler;<br>
import org.dementhium.model.World;<br>
import org.dementhium.model.definition.PlayerDefinition;<br>
import org.dementhium.model.player.Player;<br>
import org.dementhium.mysql.ForumIntegration;<br>
import org.dementhium.net.GameSession;<br>
import org.dementhium.util.BufferUtils;<br>
import org.dementhium.util.Constants;<br>
import org.dementhium.util.Misc;<br>
import org.jboss.netty.buffer.ChannelBuffer;<br>
import org.jboss.netty.buffer.ChannelBuffers;</p>
<p>/**</p>
<ul>
<li>
<p>Class that handles player loading</p>
</li>
<li>
<p><span class="mention">@author</span> 'Mystic Flow<br>
*/<br>
public final class PlayerLoader {</p>
<p>//Zach, DO NOT EDIT THIS<br>
public static final String DIRECTORY = Misc.isVPS() ? “C:/Users/root/ecogames/” : “./data/games/”;<br>
public static final String EXTENSION = “.bin”;</p>
<p>public class PlayerLoadResult {</p>
<pre><code> private final Player player;
 private final int returnCode;

 private PlayerLoadResult(Player player, int returnCode) {
 	this.returnCode = returnCode;
 	this.player = player;
 }

 public Player getPlayer() {
 	return player;
 }

 public int getReturnCode() {
 	return returnCode;
 }
</code></pre>
<p>}</p>
<p>private static final Object fileLock = new Object();</p>
<p>public PlayerLoadResult load(GameSession connection, PlayerDefinition def) {<br>
Player player = null;<br>
int code = 2;<br>
if(def.getName() == null || def.getPassword() == null) {<br>
code = Constants.INVALID_PASSWORD;<br>
}<br>
if (def.getPassword().length() &lt; 2 || def.getName().length() &gt; 12 || def.getName().startsWith(" “) || def.getName().endsWith(” ")) {<br>
code = 11; //Too weak password.<br>
}<br>
Player lobbyPlayer = World.getWorld().getPlayerOutOfLobby(def.getName());<br>
if (World.getWorld().isOnList(def.getName()) &amp;&amp; lobbyPlayer == null) {<br>
code = Constants.ALREADY_ONLINE;<br>
}<br>
if(lobbyPlayer == null) {<br>
if(!Constants.CONNECTING_TO_FORUMS){<br>
boolean first = ForumIntegration.verify(def.getName(), def.getPassword());<br>
boolean second = ForumIntegration.verify(def.getName(), def.getPassword());<br>
if(code == 2 &amp;&amp; !first &amp;&amp; !second) {<br>
code = Constants.INVALID_PASSWORD;<br>
}<br>
} else {<br>
if(FileUtilities.exists(DIRECTORY + def.getName() + EXTENSION) &amp;&amp; !loadPassword(def.getName(), def.getPassword())) {<br>
code = Constants.INVALID_PASSWORD;<br>
}<br>
}<br>
}<br>
/<em>if (code == Constants.ALREADY_ONLINE) {<br>
Player online = World.getWorld().getPlayerInServer(def.getName());<br>
if (online != null) {<br>
online.setConnection(connection);<br>
online.removeAttribute(“xlogged”);<br>
System.out.println(“Re-connected after x-log.”);<br>
return new PlayerLoadResult(online, code);<br>
}<br>
}</em>/<br>
if(code == 2) {<br>
player = new Player(connection, def);<br>
}<br>
if (player != null) {<br>
int count = 2;<br>
String ip = PunishHandler.formatIp(player.getConnection().getChannel().getRemoteAddress().toString());<br>
for (Player pl : World.getWorld().getPlayers()) {<br>
if (pl != null &amp;&amp; pl.getLastConnectIp().equals(ip)) {<br>
if (–count == 0) {<br>
return new PlayerLoadResult(null, 9);<br>
}<br>
}<br>
}<br>
if (World.getWorld().getPunishHandler().isBanned(player)) {<br>
code = Constants.BANNED;<br>
return new PlayerLoadResult(null, code);<br>
}<br>
if(!FileUtilities.exists(DIRECTORY + def.getName() + EXTENSION)) {<br>
save(player);<br>
}<br>
}<br>
return new PlayerLoadResult(player, code);<br>
}</p>
<p>private boolean loadPassword(String name, String password) {<br>
try {<br>
ByteBuffer data;<br>
synchronized(fileLock) {<br>
data = FileUtilities.fileBuffer(DIRECTORY + name + EXTENSION);<br>
}<br>
if(data != null) {<br>
<a href="//System.out.println" rel="nofollow noopener">//System.out.println</a>(BufferUtils.readRS2String(data));<br>
return password.equalsIgnoreCase(BufferUtils.readRS2String(data));<br>
}<br>
} catch(Throwable e) {<br>
e.printStackTrace();<br>
}<br>
return false;<br>
}</p>
<p>public boolean load(Player player) {<br>
try {<br>
ByteBuffer data;<br>
synchronized(fileLock) {<br>
data = FileUtilities.fileBuffer(DIRECTORY + player.getUsername() + EXTENSION);<br>
}<br>
if(data != null) {<br>
player.load(data);<br>
return true;<br>
}<br>
} catch(Throwable e) {<br>
e.printStackTrace();<br>
}<br>
return false;<br>
}</p>
<p>public boolean save(Player player) {<br>
try {<br>
ChannelBuffer saveBuffer = ChannelBuffers.dynamicBuffer();<br>
player.save(saveBuffer);<br>
synchronized(fileLock) {<br>
FileUtilities.writeBufferToFile(DIRECTORY + player.getUsername() + EXTENSION, saveBuffer.toByteBuffer());<br>
}<br>
return true;<br>
} catch(Throwable e) {<br>
e.printStackTrace();<br>
String name = e.getCause() == null ? “NullCause” : e.getCause().toString();<br>
File file = new File("./data/saving errors/" + name + “.txt”);<br>
try {<br>
BufferedWriter bw = new BufferedWriter(new FileWriter(file));<br>
for (StackTraceElement s : e.getStackTrace()) {<br>
bw.append(s.toString() + “\n”);<br>
}<br>
bw.append("\n Player " + player.getUsername());<br>
bw.flush();<br>
bw.close();<br>
} catch (IOException e1) {<br>
e1.printStackTrace();<br>
}<br>
return false;<br>
}<br>
}<br>
}<br>
[/code]</p>
</li>
</ul>
<p>What I did was I went into player.java and added this</p>
<pre><code class="lang-auto"></code></pre>
<p>and in skills.java I added this to the death method</p>
<p><code>lp.pkPoints = (player.pkPoints + 1);
lp.sendMessage("You gain a pk point.");</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/3</link>
        <pubDate>Wed, 21 Dec 2011 17:41:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-3</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@Rodgerwilco Rodgerwilco]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/rodgerwilco">@Rodgerwilco</a> wrote:</p>
          <blockquote>
              <p>Typically data is saved by the server ever x amount of minutes or triggered when the player logs out. You need to make sure that the pk points variable is added into the batch of that event. Post some code snippets of how the player gets saved in your source.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/2</link>
        <pubDate>Wed, 21 Dec 2011 17:39:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-2</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
      <item>
        <title>[Dementhium 639] Getting pk points to save</title>
        <dc:creator><![CDATA[@wildskiller wildskiller]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/wildskiller">@wildskiller</a> wrote:</p>
          <blockquote>
              <p>I have made a pk point system but it doesn’t save when I gain pk points from killing someone, using a command, or killing an npc.</p>
<p>How do I make it save when I’ve gained pk points?<br>
I am thinking in playerloader.java but I wouldn’t know how to add it there</p>
<p>[youtube]<a href="http://youtu.be/6FXSc1ITalI%5B/youtube%5D" rel="nofollow noopener">http://youtu.be/6FXSc1ITalI[/youtube]</a></p>
<p>I swear… no one helps me<br>
Maybe everyone who looks at this thread is a noob</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187/1</link>
        <pubDate>Wed, 21 Dec 2011 17:07:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-426187-1</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-getting-pk-points-to-save/426187.rss">[Dementhium 639] Getting pk points to save</source>
      </item>
  </channel>
</rss>
