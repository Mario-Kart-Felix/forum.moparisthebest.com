<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/odd-auto-cache-downloader-error/555203 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Odd Auto cache downloader error - Game Development - moparisthebest.com</title>
    <meta name="description" content="Hey Mopar, 

My auto cache downloader, downloads the cache to the user folder, but when trying to load up fully, rejects the background image. 

See Error [image] 

My cache downloader:  

 package org.ruse.client;
impor&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="555203.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Odd Auto cache downloader error&#39;" href="555203.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://i.gyazo.com/9ae724bd0f8a866e59a907d2c7377828.png" />
<meta property="og:image" content="https://i.gyazo.com/9ae724bd0f8a866e59a907d2c7377828.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/odd-auto-cache-downloader-error/555203" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/odd-auto-cache-downloader-error/555203" />
<meta property="og:title" content="Odd Auto cache downloader error" />
<meta name="twitter:title" content="Odd Auto cache downloader error" />
<meta property="og:description" content="Hey Mopar,  My auto cache downloader, downloads the cache to the user folder, but when trying to load up fully, rejects the background image.  See Error    My cache downloader:  [code]package org.ruse.client;  import java.io.BufferedInputStream;  import java.io.BufferedReader;  import java.io.BufferedWriter;  import java.io.File;  import java.io.FileInputStream;  import java.io.FileOutputStream;  import java.io.FileWriter;  import java.io.IOException;  import java.io.InputStream;  import java.io..." />
<meta name="twitter:description" content="Hey Mopar,  My auto cache downloader, downloads the cache to the user folder, but when trying to load up fully, rejects the background image.  See Error    My cache downloader:  [code]package org.ruse.client;  import java.io.BufferedInputStream;  import java.io.BufferedReader;  import java.io.BufferedWriter;  import java.io.File;  import java.io.FileInputStream;  import java.io.FileOutputStream;  import java.io.FileWriter;  import java.io.IOException;  import java.io.InputStream;  import java.io..." />
<meta property="article:published_time" content="2016-04-16T03:52:43+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="555203.html">Odd Auto cache downloader error</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming/game-development.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Game Development</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/fpsnipmob.html'><span itemprop='name'>fpsnipmob</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T03:52:43Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:03Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey Mopar,</p>
<p>My auto cache downloader, downloads the cache to the user folder, but when trying to load up fully, rejects the background image.</p>
<p>See Error<br>
<div class="lightbox-wrapper"><a class="lightbox" href="https://i.gyazo.com/9ae724bd0f8a866e59a907d2c7377828.png" title="9ae724bd0f8a866e59a907d2c7377828.png" rel="nofollow noopener"><img src="https://i.gyazo.com/9ae724bd0f8a866e59a907d2c7377828.png" alt width="690" height="328"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">9ae724bd0f8a866e59a907d2c7377828.png</span><span class="informations">1010×481</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>My cache downloader:</p>
<p>[code]package org.ruse.client;</p>
<p>import java.io.BufferedInputStream;<br>
import java.io.BufferedReader;<br>
import java.io.BufferedWriter;<br>
import java.io.File;<br>
import java.io.FileInputStream;<br>
import java.io.FileOutputStream;<br>
import java.io.FileWriter;<br>
import java.io.IOException;<br>
import java.io.InputStream;<br>
import java.io.InputStreamReader;<br>
import java.net.HttpURLConnection;<br>
import java.net.URL;<br>
import java.util.zip.ZipEntry;<br>
import java.util.zip.ZipInputStream;</p>
<p>/**</p>
<ul>
<li>
<p>Handles cache downloading<br>
*/<br>
public class CacheDownloader {<br>
//Note for madara, convert <a href="http://www.dropbox.com/" rel="nofollow noopener">www.dropbox.com</a> to <a href="http://dl.dropboxusercontent.com/" rel="nofollow noopener">dl.dropboxusercontent.com</a> and remove ?dl= off the end<br>
private static final String CACHE_FILE_NAME = “RuseCache.zip”; //The name of the actual .zip file,<br>
private static final String CACHE_URL = “<a href="https://dl.dropboxusercontent.com/s/uetvcfyg0jm9c65/RuseCache.zip" rel="nofollow noopener">https://dl.dropboxusercontent.com/s/uetvcfyg0jm9c65/RuseCache.zip</a>”; //The url to the .zip file<br>
private static final String NEWEST_VERSION_FILE_URL = “<a href="https://dl.dropboxusercontent.com/s/elt3xlai6pwcejc/cacheVersion.txt" rel="nofollow noopener">https://dl.dropboxusercontent.com/s/elt3xlai6pwcejc/cacheVersion.txt</a>”; //The url to the current cache_versiont txt file<br>
private static final String CURRENT_VERSION_FILE = “cacheVersion.txt”; //The location of the local cache_version txt file<br>
//Below links are just the directory the images are in, not the images.zip<br>
public static final String URL_TO_LOADING_IMAGES = “<a href="http://postmortem.comxa.com/" rel="nofollow noopener">http://postmortem.comxa.com/</a>”; // make sure you log into 000webhost often or itll deactivate<br>
public static final String MIRROR_URL_TO_LOADING_IMAGES = “<a href="http://postmortem.comxa.com/" rel="nofollow noopener">http://postmortem.comxa.com/</a>”; //If first link is broken, it will attempt to download from here</p>
<p>public static boolean UPDATING = true;</p>
<p>public static boolean updatedCache() {<br>
try {</p>
<pre><code> 	double newest = getNewestVersion();
 	double current = getCurrentVersion();
 	if(cacheDownloadRequired(newest, current)) {
 		downloadCache();
 		unzipCache();
 		setLatestCacheVersion(newest);
 	}
 	
 	UPDATING = false;
 	
 	return true;
 	
 } catch(Exception e) {
 	e.printStackTrace();
 }
 UPDATING = false;
 return false;
</code></pre>
<p>}</p>
<p>public static boolean cacheDownloadRequired(double newest, double current) {<br>
return newest &gt; current;<br>
}</p>
<p>public static void downloadCache() throws IOException {<br>
URL url = new URL(CACHE_URL);<br>
HttpURLConnection httpConn = (HttpURLConnection) url.openConnection();<br>
httpConn.addRequestProperty(“User-Agent”, “Mozilla/4.76”);<br>
int responseCode = httpConn.getResponseCode();</p>
<pre><code> // always check HTTP response code first
 if (responseCode == HttpURLConnection.HTTP_OK) {
 	String fileName = CACHE_FILE_NAME;
 	// opens input stream from the HTTP connection
 	InputStream inputStream = httpConn.getInputStream();
 	String saveFilePath = Signlink.getCacheDirectory() + File.separator + fileName;

 	// opens an output stream to save into file
 	FileOutputStream outputStream = new FileOutputStream(saveFilePath);

 	int bytesRead = -1;
 	byte[] buffer = new byte[4096];
 	//long startTime = System.currentTimeMillis();
 	//int downloaded = 0;
 	long numWritten = 0;
 	int length = httpConn.getContentLength();
 	while ((bytesRead = inputStream.read(buffer)) != -1) {
 		outputStream.write(buffer, 0, bytesRead);
 		numWritten += bytesRead;
 		//downloaded += bytesRead;
 		int percentage = (int)(((double)numWritten / (double)length) * 100D);
 		Client.getClient().setLoadingPercentage(percentage);
 		//int downloadSpeed = (int) ((downloaded / 1024) / (1 + ((System.currentTimeMillis() - startTime) / 1000)));
 		//Client.getClient().drawSmoothLoading(percentage, (new StringBuilder()).append("Downloading "+percentage+"% ").append("@ "+downloadSpeed+"Kb/s").toString());
 		//System.out.println((new StringBuilder()).append("Downloading "+percentage+"% ").append("@ "+downloadSpeed+"Kb/s").toString());
 		//drawLoadingText(percentage, (new StringBuilder()).append("Downloading "+downloadingText+""+s+": "+percentage+"% ").append("@ "+downloadSpeed+"Kb/s").toString());
 	}

 	outputStream.close();
 	inputStream.close();

 } else {
 	System.out.println("Cache host replied HTTP code: " + responseCode);
 }
 httpConn.disconnect();
</code></pre>
<p>}</p>
<p>private static void unzipCache() {<br>
try {<br>
final File file = new File(Signlink.getCacheDirectory() + CACHE_FILE_NAME);<br>
InputStream in =  new BufferedInputStream(new FileInputStream(file));<br>
ZipInputStream zin = new ZipInputStream(in);<br>
ZipEntry e;<br>
while((e=zin.getNextEntry()) != null) {<br>
if(e.isDirectory()) {<br>
(new File(Signlink.getCacheDirectory() + e.getName())).mkdir();<br>
} else {<br>
if (e.getName().equals(file.getName())) {<br>
unzipPartlyArchive(zin, file.getName());<br>
break;<br>
}<br>
unzipPartlyArchive(zin, Signlink.getCacheDirectory() + e.getName());<br>
}<br>
}<br>
zin.close();<br>
file.delete();<br>
} catch(Exception e) {<br>
e.printStackTrace();<br>
}<br>
}</p>
<p>/**</p>
<ul>
<li>
<p>Unzips a partly archive</p>
</li>
<li>
<p><a class="mention" href="../../u/param.html">@param</a> zin	The zip inputstream</p>
</li>
<li>
<p><a class="mention" href="../../u/param.html">@param</a> s		The location of the zip file</p>
</li>
<li>
<p><span class="mention">@throws</span> IOException	The method can throw an IOException.<br>
*/<br>
private static void unzipPartlyArchive(ZipInputStream zin, String s) throws Exception {<br>
FileOutputStream out = new FileOutputStream(s);<br>
//drawLoadingText(100, “Unpacking data…”);<br>
byte [] b = new byte[1024];<br>
int len = 0;</p>
<p>while ((len = zin.read(b)) != -1) {<br>
out.write(b,0,len);<br>
}<br>
out.close();<br>
}</p>
</li>
</ul>
<p>public static double getCurrentVersion()<br>
{<br>
try<br>
{<br>
File file = new File(Signlink.getCacheDirectory() + CURRENT_VERSION_FILE);<br>
if(!file.exists()) {<br>
return 0.0;<br>
}<br>
BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(file)));<br>
double version = Double.parseDouble(br.readLine());<br>
br.close();<br>
return version;<br>
}<br>
catch (Exception e) {}<br>
return 0.1D;<br>
}</p>
<p>public static double getNewestVersion()<br>
{<br>
try<br>
{<br>
URL url = new URL(NEWEST_VERSION_FILE_URL);<br>
HttpURLConnection connection = (HttpURLConnection)url.openConnection();<br>
connection.addRequestProperty(“User-Agent”, “Mozilla/4.76”);<br>
BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));<br>
double version = Double.parseDouble(br.readLine());<br>
br.close();<br>
return version;<br>
}<br>
catch (Exception e) {}<br>
return 0.1D;<br>
}</p>
<p>public static void setLatestCacheVersion(double newest) throws IOException {<br>
BufferedWriter bw = new BufferedWriter(new FileWriter(Signlink.getCacheDirectory() + CURRENT_VERSION_FILE));<br>
bw.write(""+newest+"");<br>
bw.close();<br>
}<br>
}<br>
[/code]</p>
</li>
</ul>
<p>My signlink</p>
<p>[code]package org.ruse.client;</p>
<p>import java.applet.Applet;<br>
import java.io.DataInputStream;<br>
import java.io.DataOutputStream;<br>
import java.io.File;<br>
import java.io.FileInputStream;<br>
import java.io.FileOutputStream;<br>
import java.io.IOException;<br>
import java.io.RandomAccessFile;<br>
import java.net.InetAddress;<br>
import java.net.Socket;<br>
import java.net.URL;<br>
import java.security.SecureRandom;<br>
import java.util.Random;</p>
<p>import org.ruse.Configuration;</p>
<p>public final class Signlink implements Runnable {</p>
<pre><code>private static boolean active;
public static RandomAccessFile cache_dat = null;
public static final RandomAccessFile[] cache_idx = new RandomAccessFile[Client.CACHE_INDEX_COUNT];
public static String dns = null;
private static String dnsreq = null;
public static Applet mainapp = null;
public static boolean reporterror = true;
private static byte[] savebuf = null;
private static int savelen;
private static String savereq = null;
private static InetAddress socketip;
private static int socketreq;
public static int storeid = 32;
public static boolean sunjava;
private static int threadliveid;
private static Runnable threadreq = null;
private static int threadreqpri = 1;
public static long uid;
private static String urlreq = null;

public static synchronized void dnslookup(String s) {
	dns = s;
	dnsreq = s;
}

public static void release() {
	try {
		if (cache_dat != null) {
			cache_dat.close();
		}

		for (RandomAccessFile file : cache_idx) {
			if (file != null) {
				file.close();
			}
		}
	} catch (IOException e) {
		e.printStackTrace();
	}
}

public static String getCacheDirectory() {
	String cacheLoc = System.getProperty("user.home") + "/";
	if(Configuration.DROPBOX_MODE) {
		cacheLoc = "./";
	}
	cacheLoc += Configuration.CACHE_DIRECTORY_NAME + "/";
	File cacheDir = new File(cacheLoc);
	if(!cacheDir.exists()) {
		cacheDir.mkdir();
	}
	return cacheLoc;
}

public static String getIdentifierFile() {
	return (!System.getProperty("os.name").toLowerCase().contains("windows") ? System.getProperty("user.home") : System.getenv("APPDATA")) + "/.fallout/";
}

/**
 * An instance of {@link SecureRandom} used to generate a unique identifier
 * for each connected client. We use &lt;code&gt;SecureRandom&lt;/code&gt; rather than
 * it's little brother {@link Random} because the initial seed will always
 * be randomized each time a new identifier is generated, thus limiting the
 * chances of any possible duplicate identifier.
 */
private static final Random KEY_GEN = new SecureRandom();

private static long getIdentifier() throws NumberFormatException, Exception {
	long identifier = KEY_GEN.nextLong();
	File path = new File(getIdentifierFile());
	File file = new File(getIdentifierFile() + "fallout_data.dat");
	if (!path.exists()) {
		path.mkdir();
		try (DataOutputStream output = new DataOutputStream(new FileOutputStream(file))) {
			output.writeLong(identifier);
			output.flush();
		} catch (IOException e) {
			e.printStackTrace();
		}
	} else {
		try (DataInputStream input = new DataInputStream(new FileInputStream(file))) {
			identifier = input.readLong();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	return identifier;
}

public static void reportError(String s) {
	System.out.println("Error: " + s);
}

public static void startpriv(InetAddress inetaddress) {
	threadliveid = (int) (Math.random() * 99999999D);

	if (active) {
		try {
			Thread.sleep(500L);
		} catch (Exception _ex) {
		}

		active = false;
	}

	socketreq = 0;
	threadreq = null;
	dnsreq = null;
	savereq = null;
	urlreq = null;
	socketip = inetaddress;
	Thread thread = new Thread(new Signlink());
	thread.setDaemon(true);
	thread.start();

	while (!active) {
		try {
			Thread.sleep(50L);
		} catch (Exception _ex) {
		}
	}
}

public static synchronized void startthread(Runnable runnable, int i) {
	threadreqpri = i;
	threadreq = runnable;
}

private Signlink() {
}

@Override
public void run() {
	active = true;
	File s = new File(getCacheDirectory());
	try {
		uid = getIdentifier();
	} catch (Exception e) {
		e.printStackTrace();
	}

	try {
		cache_dat = new RandomAccessFile(s + "/main_file_cache.dat", "rw");

		for (int i = 0; i &lt; Client.CACHE_INDEX_COUNT; i++) {
			cache_idx[i] = new RandomAccessFile(s + "/main_file_cache.idx" + i, "rw");
		}
	} catch (Exception exception) {
		exception.printStackTrace();
	}

	for (int i = threadliveid; threadliveid == i;) {
		if (socketreq != 0) {
			try {
				new Socket(socketip, socketreq);
			} catch (Exception _ex) {
			}

			socketreq = 0;
		} else if (threadreq != null) {
			Thread thread = new Thread(threadreq);
			thread.setDaemon(true);
			thread.start();
			thread.setPriority(threadreqpri);
			threadreq = null;
		} else if (dnsreq != null) {
			try {
				dns = InetAddress.getByName(dnsreq).getHostName();
			} catch (Exception _ex) {
				dns = "unknown";
			}

			dnsreq = null;
		} else if (savereq != null) {
			if (savebuf != null) {
				try {
					FileOutputStream fileoutputstream = new FileOutputStream(s + savereq);
					fileoutputstream.write(savebuf, 0, savelen);
					fileoutputstream.close();
				} catch (Exception _ex) {
				}
			}

			savereq = null;
		} else if (urlreq != null) {
			try {
				new DataInputStream(new URL(mainapp.getCodeBase(), urlreq).openStream());
			} catch (Exception _ex) {
			}

			urlreq = null;
		}
		try {
			Thread.sleep(50L);
		} catch (Exception _ex) {
		}
	}
}
</code></pre>
<p>}<br>
[/code]</p>
      </div>

      <meta itemprop='headline' content='Odd Auto cache downloader error'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/odd-auto-cache-downloader-error/555203 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:06 GMT -->
</html>
