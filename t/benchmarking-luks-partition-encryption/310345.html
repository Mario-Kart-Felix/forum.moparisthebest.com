<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/benchmarking-luks-partition-encryption/310345 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Benchmarking LUKS Partition Encryption - Technology - moparisthebest.com</title>
    <meta name="description" content="This has started to interest me, and when I get some spare time and a free hard drive I am going to encrypt /home on my laptop.  However, I wanted to see what kind of performance hit I might encounter with different hard&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="310345.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Benchmarking LUKS Partition Encryption&#39;" href="310345.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/benchmarking-luks-partition-encryption/310345" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/benchmarking-luks-partition-encryption/310345" />
<meta property="og:title" content="Benchmarking LUKS Partition Encryption" />
<meta name="twitter:title" content="Benchmarking LUKS Partition Encryption" />
<meta property="og:description" content="This has started to interest me, and when I get some spare time and a free hard drive I am going to encrypt /home on my laptop.  However, I wanted to see what kind of performance hit I might encounter with different hardware, so I threw together this little script to benchmark actual performance differences on any particular system.  I commented it fully, so if you want the full rundown read through the script.  But basically it will create 2 identical 1gb files (you can adjust the size), initia..." />
<meta name="twitter:description" content="This has started to interest me, and when I get some spare time and a free hard drive I am going to encrypt /home on my laptop.  However, I wanted to see what kind of performance hit I might encounter with different hardware, so I threw together this little script to benchmark actual performance differences on any particular system.  I commented it fully, so if you want the full rundown read through the script.  But basically it will create 2 identical 1gb files (you can adjust the size), initia..." />
<meta property="article:published_time" content="2009-10-24T04:38:53+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="310345.html">Benchmarking LUKS Partition Encryption</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/technology.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Technology</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2009-10-24T04:38:53Z'>
            <time itemprop='dateModified' datetime='2016-07-31T12:02:10Z' class='post-time'>
              July 31, 2016, 12:02pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This has started to interest me, and when I get some spare time and a free hard drive I am going to encrypt /home on my laptop.  However, I wanted to see what kind of performance hit I might encounter with different hardware, so I threw together this little script to benchmark actual performance differences on any particular system.</p>
<p>I commented it fully, so if you want the full rundown read through the script.  But basically it will create 2 identical 1gb files (you can adjust the size), initialize LUKS encryption on one, format both as ext4 (you can change that too), mount them in directories, then use bonnie++ to perform performance tests on them, then puts the results in an easy to read results.html.</p>
<p>So if you have a little extra space to play with (obviously you can delete everything afterwards) please post your results and your setup so we can compare.</p>
<p>Here is the script:</p>
<pre><code class="lang-auto">#!/bin/sh

# Author: moparisthebest
# required packages: cryptsetup bonnie++

# references:
# cryptsetup: http://feraga.com/node/51
# bonnie++: http://www.linux.com/archive/feature/139742

# the file size of the loop mounted files
# keep in mind there will be 2 of these sized files
FILE_SIZE_MB=2048

# file system type to use, choose any you like
# program executed as mkfs.$FS_TYPE
FS_TYPE=ext4

# file for dd to get the data from with which to originally
# fill the files, /dev/random is best but slowest,
# /dev/urandom is a good compromise, /dev/zero is fastest
# but won't be as secure, but if we are just benchmarking
# security doesn't matter anyway.
DATA_FILE=/dev/zero

# the rest of these I will calculate myself
# but you can change them if you want...

# max size of files bonnie++ makes
BON_SIZE=$(($FILE_SIZE_MB / 2))
# max ram bonnie++ uses, must be half of $BON_SIZE, per bonnie++
BON_RAM=$(($BON_SIZE / 2))

setup_luks () {
# just run this script once!

# in debian (probably ubuntu too) we need this package:
# sudo apt-get install cryptsetup

# create a 1gb file, filled with random data
echo "creating a $FILE_SIZE_MB MB file, filled with data"
echo "from $DATA_FILE, may take quite a long while..."
dd if=$DATA_FILE of=clearfile bs=1M count=$FILE_SIZE_MB
# copy it to encryptfile
echo "now copying that file to another file, may take a bit"
cp clearfile encryptfile

# mount the files as loop devices
sudo losetup /dev/loop0 encryptfile
sudo losetup /dev/loop1 clearfile

# only do the crypt stuff on encryptfile (obviously)
sudo cryptsetup luksFormat /dev/loop0
sudo cryptsetup luksOpen /dev/loop0 encryptfs

# we format both devices the same, you can use any filesystem
# you desire, I choose ext4 because... I like it?
sudo mkfs.$FS_TYPE /dev/mapper/encryptfs
sudo mkfs.$FS_TYPE /dev/loop1

# close the mapper device
sudo cryptsetup luksClose /dev/mapper/encryptfs

# unmount the loop devices
sudo losetup -d /dev/loop0
sudo losetup -d /dev/loop1
}

mount_luks () {
# mount the files as loop devices
sudo losetup /dev/loop0 encryptfile
sudo losetup /dev/loop1 clearfile

# only do the crypt stuff on encryptfile (obviously)
sudo cryptsetup luksOpen /dev/loop0 encryptfs

# make sure the folders exist first
mkdir -p encryptfs
mkdir -p clearfs

# mount both devices
sudo mount /dev/mapper/encryptfs ./encryptfs/
sudo mount /dev/loop1 ./clearfs/

# change permissions to 777, default for me was root read/write only
sudo chmod -R 777 ./encryptfs
sudo chmod -R 777 ./clearfs
}

umount_luks () {
# unmount both devices
sudo umount ./encryptfs/
sudo umount ./clearfs/

# close the mapper device
sudo cryptsetup luksClose /dev/mapper/encryptfs

# unmount the loop devices
sudo losetup -d /dev/loop0
sudo losetup -d /dev/loop1
}

benchmark_luks () {
# in debian (probably ubuntu too) we need this package:
# sudo apt-get install bonnie++

# benchmark the two filesystems, we also want to save a log
/usr/sbin/bonnie++ -s $BON_SIZE -r $BON_RAM -d ./encryptfs | tee bonnie_encryptfs_log
/usr/sbin/bonnie++ -s $BON_SIZE -r $BON_RAM -d ./clearfs | tee bonnie_clearfs_log

# output html files, only the last line is a csv list
cat bonnie_encryptfs_log | tail -n1 | bon_csv2html &gt; bonnie_encryptfs.html
cat bonnie_clearfs_log | tail -n1 | bon_csv2html &gt; bonnie_clearfs.html

# attempt to create one nice result.html page
cat bonnie_encryptfs.html | grep -A9 "DOCTYPE" &gt; result.html
echo "&lt;h3&gt;Script Info:&lt;/h3&gt;" &gt;&gt; result.html
echo "FILE_SIZE_MB=$FILE_SIZE_MB &lt;br&gt;" &gt;&gt; result.html
echo "FS_TYPE=$FS_TYPE &lt;br&gt;" &gt;&gt; result.html
echo "DATA_FILE=$DATA_FILE &lt;br&gt;" &gt;&gt; result.html
echo "BON_SIZE=$BON_SIZE &lt;br&gt;" &gt;&gt; result.html
echo "BON_RAM=$BON_RAM &lt;br&gt;" &gt;&gt; result.html
echo "&lt;h3&gt;System Info:&lt;/h3&gt;" &gt;&gt; result.html
uname -a &gt;&gt; result.html
echo "&lt;br&gt;&lt;br&gt;Memory: &lt;br&gt;" &gt;&gt; result.html
cat /proc/meminfo | grep MemTotal &gt;&gt; result.html
echo "&lt;br&gt;" &gt;&gt; result.html
cat /proc/meminfo | grep SwapTotal &gt;&gt; result.html
echo "&lt;br&gt;&lt;br&gt;CPU: &lt;br&gt;" &gt;&gt; result.html
cat /proc/cpuinfo | grep MHz &gt;&gt; result.html
echo "&lt;br&gt;" &gt;&gt; result.html
cat /proc/cpuinfo | grep name &gt;&gt; result.html
echo "&lt;br&gt;" &gt;&gt; result.html
echo "&lt;h3&gt;Benchmarks:&lt;/h3&gt;" &gt;&gt; result.html
echo "encryptfs: &lt;br&gt;" &gt;&gt; result.html
cat bonnie_encryptfs.html | grep -A11 "&lt;TABLE" &gt;&gt; result.html
echo "&lt;br&gt;clearfs: &lt;br&gt;" &gt;&gt; result.html
cat bonnie_clearfs.html | grep -A11 "&lt;TABLE" &gt;&gt; result.html
echo "&lt;/BODY&gt;" &gt;&gt; result.html
echo "&lt;/HTML&gt;" &gt;&gt; result.html

echo "results have been calculated and placed in result.html"
}

case "$1" in
    setup)
        setup_luks
        ;;
    mount)
        mount_luks
        ;;
    unmount|umount)
        umount_luks
        ;;
    benchmark)
        benchmark_luks
        ;;
    all)
        setup_luks
        mount_luks
        benchmark_luks
        umount_luks
        ;;
    *)
        echo "Usage: $SCRIPTNAME {setup|mount|unmount|umount|benchmark|all}" &gt;&amp;2
        exit 1
        ;;
esac

exit 0</code></pre>
<p>Here is my benchmark:<br>
<a href="http://www.moparisthebest.com/result.html" class="onebox" target="_blank">http://www.moparisthebest.com/result.html</a></p>
<p>System specs:<br>
OS: debian lenny<br>
RAM: 1GB<br>
cpu: really slow sempron<br>
hd: 5400rpm laptop ATA hd</p>
<p>So, post them up. <img src="../../images/emoji/twitter/slight_smileae52.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"><br>
And if you have any recommendations for my script, please share.</p>
<p>edit: I’ve updated the script to put some system info in the result.html page, if anyone knows a standard way to get hard drive info I would appreciate it.<br>
edit2: I’ve updated the script with some variables at the top to make it easier to customize.  Variables are output in result.html as well.</p>
      </div>

      <meta itemprop='headline' content='Benchmarking LUKS Partition Encryption'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/benchmarking-luks-partition-encryption/310345 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:43 GMT -->
</html>
