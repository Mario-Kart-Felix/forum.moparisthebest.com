<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/c-how-i-do-pixel-perfect-collisions-2d/411318 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 05:52:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>C# - How I do Pixel-Perfect Collisions (2D) - Game Development - moparisthebest.com</title>
    <meta name="description" content="One thing I promised Frell was a tutorial on how I do my collisions. They&amp;#39;re not perfect, but they do provide decent framerates. 

Because there&amp;#39;s a large amount of code and it&amp;#39;s sort of complicated, I won&amp;#39;t explain it a&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="411318.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;C# - How I do Pixel-Perfect Collisions (2D)&#39;" href="411318.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/c-how-i-do-pixel-perfect-collisions-2d/411318" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/c-how-i-do-pixel-perfect-collisions-2d/411318" />
<meta property="og:title" content="C# - How I do Pixel-Perfect Collisions (2D)" />
<meta name="twitter:title" content="C# - How I do Pixel-Perfect Collisions (2D)" />
<meta property="og:description" content="One thing I promised Frell was a tutorial on how I do my collisions. They’re not perfect, but they do provide decent framerates.  Because there’s a large amount of code and it’s sort of complicated, I won’t explain it all completely. Instead, I’ll post the code and give an outline on what it does. The code I’ll be providing is from my 2D game engine.  [i]Class: CollisionMask[i] - This class holds all the important information regarding collisions and is capable of actually checking whether or no..." />
<meta name="twitter:description" content="One thing I promised Frell was a tutorial on how I do my collisions. They’re not perfect, but they do provide decent framerates.  Because there’s a large amount of code and it’s sort of complicated, I won’t explain it all completely. Instead, I’ll post the code and give an outline on what it does. The code I’ll be providing is from my 2D game engine.  [i]Class: CollisionMask[i] - This class holds all the important information regarding collisions and is capable of actually checking whether or no..." />
<meta property="article:published_time" content="2011-08-21T03:50:01+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="411318.html">C# - How I do Pixel-Perfect Collisions (2D)</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming/game-development.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Game Development</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Lin.html'><span itemprop='name'>Lin</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-08-21T03:50:01Z'>
            <time itemprop='dateModified' datetime='2016-08-01T14:17:30Z' class='post-time'>
              August 1, 2016,  2:17pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>One thing I promised Frell was a tutorial on how I do my collisions. They’re not perfect, but they do provide decent framerates.</p>
<p>Because there’s a large amount of code and it’s sort of complicated, I won’t explain it all completely. Instead, I’ll post the code and give an outline on what it does. The code I’ll be providing is from my 2D game engine.</p>
<p>[i]Class: CollisionMask[i] - This class holds all the important information regarding collisions and is capable of actually checking whether or not a mask actually collides with another one. Here’s the code for it:</p>
<p>[code]using System;<br>
using System.ComponentModel;<br>
using System.Collections.Generic;<br>
using Microsoft.Xna.Framework;<br>
using Microsoft.Xna.Framework.Audio;<br>
using Microsoft.Xna.Framework.Content;<br>
using Microsoft.Xna.Framework.GamerServices;<br>
using Microsoft.Xna.Framework.Graphics;<br>
using Microsoft.Xna.Framework.Input;<br>
using Microsoft.Xna.Framework.Media;<br>
using <a href="http://microsoft.xna.framework.net/" rel="nofollow noopener">Microsoft.Xna.Framework.Net</a>;<br>
using Microsoft.Xna.Framework.Storage;<br>
using Microsoft.Xna.Framework.Graphics.PackedVector;</p>
<p>using Level_Engine_Online.Graphics;</p>
<p>namespace Level_Engine_Online.Objects<br>
{<br>
public class CollisionMask<br>
{<br>
public bool[, ,] MaskValues { get; set; }</p>
<pre><code>	public CollisionMask(Vector2 size, Image i)
	{
		MaskValues = new bool[1, (int)size.X, (int)size.Y];
		//Read the pixels to scan the transparent ones
		Byte4[] storage = new Byte4[(int)size.X * (int)size.Y];

		if (i != null)
		{
			i.BaseTexture.GetData&lt;Byte4&gt;(storage);
			for (int y = 0; y &lt; (int)size.Y; y++)
			{
				for (int x = 0; x &lt; (int)size.X; x++)
				{
					if (storage[x + (y * (int)size.X)].PackedValue != 0)
						MaskValues[0, x, y] = true;
				}
			}
		}
	}

	public CollisionMask(Image i, Vector2 frameSize, int hFrames, int vFrames)
	{
		int frameCount = hFrames * vFrames;
		MaskValues = new bool[frameCount, (int)frameSize.X, (int)frameSize.Y];
		//Read the pixels to scan the transparent ones
		Byte4[] storage = new Byte4[(int)i.Width * (int)i.Height];

		if (i != null)
		{
			i.BaseTexture.GetData&lt;Byte4&gt;(storage);
			int f = 0;
			for (int yFrame = 0; yFrame &lt; vFrames; yFrame++)
			{
				for (int xFrame = 0; xFrame &lt; hFrames; xFrame++)
				{
					f = xFrame + (yFrame * hFrames);
					for (int y = 0; y &lt; frameSize.Y; y++)
					{
						for (int x = 0; x &lt; frameSize.X; x++)
						{
							if (storage[(xFrame * (int)frameSize.X) + x + (yFrame * i.Width * (int)frameSize.Y) + (y * i.Width)].PackedValue != 0)
								MaskValues[f, x, y] = true;
						}
					}
				}
			}
		}
	}

	public bool CollidesWithMask(CollisionMask other, int thisFrame, int otherFrame, Vector2 thisSize, Vector2 otherSize, Rectangle boundryThis, Rectangle boundryOther)
	{
		int checkX = 0;
		int checkY = 0;

		for (int yy = 0; yy &lt; (int)thisSize.Y; yy++)
		{
			checkX = 0;
			if (boundryThis.Y + yy &gt;= boundryOther.Y + boundryOther.Height)
				break;
			for (int xx = 0; xx &lt; (int)thisSize.X; xx++)
			{
				if (boundryThis.X + xx &gt;= boundryOther.X + boundryOther.Width) //If left + X goes out of the bounds of the other object...
					break;
				if (MaskValues[thisFrame, xx, yy] == false)
					continue;
				if (boundryThis.Y + yy &gt;= boundryOther.Y &amp;&amp; boundryThis.X + xx &gt;= boundryOther.X)
				{
					if (boundryThis.Y + yy &gt; boundryOther.Y)
					{
						checkY = boundryThis.Y - boundryOther.Y + yy;
					}
					if (boundryThis.X + xx &gt; boundryOther.X)
					{
						checkX = boundryThis.X - boundryOther.X + xx;
					}
					if (other.MaskValues[otherFrame, checkX, checkY] == true)
						return true;
					checkX++;
				}
			}
			if (checkX &gt; 0)
			{
				checkY++;
			}
		}

		return false;
	}
}
</code></pre>
<p>}<br>
[/code]</p>
<p>Past all the imports, a 3-dimensional array is declared, with the first dimension as the frame index, second X, third Y. If any of the values is true, the pixel is solid. Next, the constructor calculates what’s solid and what’s not by checking each pixel, and if it’s not transparent, it qualifies. The second constructor does the same but for animations with the entire sheet provided. By scanning the image and caching the results, collision checking can be made faster.</p>
<p>The method checking if two masks collide is where things get a little tricky. By providing boundaries, only the parts intersecting will be compared. This also saves time. Inside the method the collision masks are looped through skipping the parts that don’t intersect and the corresponding dimension indexes are calculated. From there it’s just a simple compare and the job is done.</p>
<p>Outside of this class, only call the CollidesWithMask method if the boundaries intersect at all, or else you’re wasting processing time.</p>
<p>So there ya go. All of the code is pretty much straightforward, so I feel I don’t have to elaborate on it too much. Don’t feel hesitated to convert this code to whatever you’re writing your game in and use it.</p>
<p>~Lin</p>
      </div>

      <meta itemprop='headline' content='C# - How I do Pixel-Perfect Collisions (2D)'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Morx.html'><span itemprop='name'>Morx</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-08-21T04:13:43Z'>
            <time itemprop='dateModified' datetime='2016-08-01T14:17:32Z' class='post-time'>
              August 1, 2016,  2:17pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Pretty intresting, Thanks for posting this.</p>
      </div>

      <meta itemprop='headline' content='C# - How I do Pixel-Perfect Collisions (2D)'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/xryz.html'><span itemprop='name'>xryz</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-08-22T19:55:29Z'>
            <time itemprop='dateModified' datetime='2016-08-01T14:19:48Z' class='post-time'>
              August 1, 2016,  2:19pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>nice. thx. ill look more in to this when i have the time.</p>
      </div>

      <meta itemprop='headline' content='C# - How I do Pixel-Perfect Collisions (2D)'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/c-how-i-do-pixel-perfect-collisions-2d/411318 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 05:52:05 GMT -->
</html>
