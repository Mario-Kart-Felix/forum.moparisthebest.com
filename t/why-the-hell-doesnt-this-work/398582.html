<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/why-the-hell-doesnt-this-work/398582 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 16:13:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Why the hell doesn&#39;t this work?!? - General Programming - moparisthebest.com</title>
    <meta name="description" content="Please help me, the code should be self-explanatory with the println&amp;#39;s, you can run it as-is: 

output:  

 fileName: java_client.win32.exe
crc should be: 1752045540
extracting file and calculating CRC:
crc32: 1311801406&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="398582.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Why the hell doesn&#39;t this work?!?&#39;" href="398582.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/why-the-hell-doesnt-this-work/398582" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/why-the-hell-doesnt-this-work/398582" />
<meta property="og:title" content="Why the hell doesn&#39;t this work?!?" />
<meta name="twitter:title" content="Why the hell doesn&#39;t this work?!?" />
<meta property="og:description" content="Please help me, the code should be self-explanatory with the println’s, you can run it as-is:  output:  fileName: java_client.win32.exe crc should be: 1752045540 extracting file and calculating CRC: crc32: 1311801406 calculating CRC of the file we just extracted (should be the exact same!): crc32: 1752045540 [code=java5]import java.io.*;  import java.net.URL;  import java.util.zip.CRC32;  import java.util.zip.Checksum;  import java.util.zip.GZIPInputStream;  import java.util.zip.ZipInputStream;  ..." />
<meta name="twitter:description" content="Please help me, the code should be self-explanatory with the println’s, you can run it as-is:  output:  fileName: java_client.win32.exe crc should be: 1752045540 extracting file and calculating CRC: crc32: 1311801406 calculating CRC of the file we just extracted (should be the exact same!): crc32: 1752045540 [code=java5]import java.io.*;  import java.net.URL;  import java.util.zip.CRC32;  import java.util.zip.Checksum;  import java.util.zip.GZIPInputStream;  import java.util.zip.ZipInputStream;  ..." />
<meta property="article:published_time" content="2011-06-10T06:26:21+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="398582.html">Why the hell doesn&#39;t this work?!?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-10T06:26:21Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:19:56Z' class='post-time'>
              August 1, 2016, 12:19pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Please help me, the code should be self-explanatory with the println’s, you can run it as-is:</p>
<p>output:</p>
<pre><code class="lang-auto">fileName: java_client.win32.exe
crc should be: 1752045540
extracting file and calculating CRC:
crc32: 1311801406
calculating CRC of the file we just extracted (should be the exact same!):
crc32: 1752045540</code></pre>
<p>[code=java5]import <a href="http://java.io/">java.io</a>.*;<br>
import java.net.URL;<br>
import java.util.zip.CRC32;<br>
import java.util.zip.Checksum;<br>
import java.util.zip.GZIPInputStream;<br>
import java.util.zip.ZipInputStream;</p>
<p>public class HelpMe {</p>
<pre><code>public static void main(String[] args) throws Exception {
    String savePath = "./";
    String fileName = "java_client.win32.exe";
    File gzipFile = new File(savePath + "java_client.win32.exe.gz");
    if (!gzipFile.exists()){
        System.out.println("downloading gzip file...");
        writeStream(new URL("http://www.moparisthebest.com/libs/java_client.win32.exe.gz").openConnection().getInputStream(),
                new FileOutputStream(gzipFile));
    }

    InputStream is = new FileInputStream(gzipFile);
    System.out.println("fileName: " + fileName);
    System.out.println("crc should be: 1752045540");
    CRC32 cr = new CRC32();
    System.out.println("extracting file and calculating CRC:");
    writeStream(new ChecksumInputStream(new GZIPInputStream(is), cr), new FileOutputStream(savePath + fileName));
    System.out.println("crc32: " + cr.getValue());
    cr.reset();
    //cr = new CRC32();  // same as above, but I tried
    System.out.println("calculating CRC of the file we just extracted (should be the exact same!):");
    writeStream(new ChecksumInputStream(new FileInputStream(savePath + fileName), cr), new FileOutputStream(savePath + fileName + ".bob"));
    System.out.println("crc32: " + cr.getValue());
}

public static final int bufferSize = 512;

public static void writeStream(InputStream in, OutputStream out) throws IOException {
    byte[] buffer = new byte[bufferSize];
    int len;
    while ((len = in.read(buffer)) &gt;= 0) {
        out.write(buffer, 0, len);
        //if(in instanceof ZipInputStream) try{ Thread.sleep(1); }catch(InterruptedException e){ e.printStackTrace(); }

    }
    // if its a ZipInputStream we don't want to close it
    if (!(in instanceof ZipInputStream))
        in.close();
    out.close();
}

public static class ChecksumInputStream extends FilterInputStream {

    private Checksum cs;

    public ChecksumInputStream(InputStream in, Checksum cs) {
        super(in);
        this.cs = cs;
    }

    public long getValue() {
        return cs.getValue();
    }

    @Override
    public int read() throws IOException {
        int byteValue = super.read();
        if (byteValue != -1) cs.update(byteValue);
        return byteValue;
    }

    @Override
    public int read(byte[] b) throws IOException {
        int bytesRead = super.read(b);
        if (bytesRead != -1) cs.update(b, 0, b.length);
        return bytesRead;
    }

    @Override
    public int read(byte[] b, int off, int len) throws IOException {
        int bytesRead = super.read(b, off, len);
        if (bytesRead != -1) cs.update(b, off, len);
        return bytesRead;
    }

}
</code></pre>
<p>}<br>
[/code]</p>
<p>How could the 2 CRCs possibly be different, if the file output by it is correct and checked fine afterwards?  :eek: <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"> :eek: <img src="../../images/emoji/twitter/confusedae52.png?v=5" title=":confused:" class="emoji" alt=":confused:"> <img src="../../images/emoji/twitter/expressionlessae52.png?v=5" title=":expressionless:" class="emoji" alt=":expressionless:"></p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/zuppers.html'><span itemprop='name'>zuppers</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-10T08:35:59Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:19:59Z' class='post-time'>
              August 1, 2016, 12:19pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Mmm im getting different crc values for those.</p>
<p>1872767847 ./java_client.win32.exe.gz<br>
1631666928 ./java_client.win32.exe</p>
<p>I used CheckedInputStream,FileInputStream,CRC32 to get those values and checked them using a file analyzer.</p>
<p>As to why its not working I think its because</p>
<pre><code class="lang-auto"></code></pre>
<p>its checking the input streams crc value??</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/eczema3.html'><span itemprop='name'>eczema3</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-10T12:21:26Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:20:05Z' class='post-time'>
              August 1, 2016, 12:20pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Both files are exactly the same as well…</p>
<h1>MD5 checksums generated by MD5summer (<a href="http://www.md5summer.org/" rel="nofollow noopener">http://www.md5summer.org</a>)</h1>
<h1>Generated 10/06/2011 13:20:40</h1>
<p>9c916d08d36b0c5e01522c9c9ae4bac3 *java_client.win32.exe (2).gz<br>
9c916d08d36b0c5e01522c9c9ae4bac3 *java_client.win32.exe.gz</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-10T14:12:43Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:20:09Z' class='post-time'>
              August 1, 2016, 12:20pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>The CRC value is for the ungzipped file, that is why it is wrapped in a gzipinputstream, so it can extract it and calculate the CRC at the same time.  The reason they should both be the same is because as the first command CRCs each byte, it is written to a file, then the second command reads that same file back in, but somehow there is a different CRC…</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-11T12:54:20Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:21:21Z' class='post-time'>
              August 1, 2016, 12:21pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>are all of your streams flushed</p>
<p>edit: the checksums are fine out of your program, its some issue in your code<br>
.exe.bob: 6F95FB43<br>
.exe: 6F95FB43</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-11T13:58:43Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:21:23Z' class='post-time'>
              August 1, 2016, 12:21pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I know the checksums are fine, that is what the last writeStream statement proves, the streams are all closed in the writeStream method (which means they are flushed), so do you have any ideas what could be wrong?  Everything looks 100% correct to me.</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Pwnd.html'><span itemprop='name'>Pwnd</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-11T16:48:40Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:21:33Z' class='post-time'>
              August 1, 2016, 12:21pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>flush anyways !LOL!</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/iKilem.html'><span itemprop='name'>iKilem</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-11T19:25:02Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:21:42Z' class='post-time'>
              August 1, 2016, 12:21pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Two mistakes, and one actually affects both results.</p>
<p>For one, cs.update(b, 0, b.length) should be cs.update(b, 0, bytesRead). <span class="bbcode-i">bytesRead</span> doesn’t necessarily equal b.length.</p>
<p>The other mistake, which affects both results, is that super.read(byte[]) calls read(byte[] b, int, int), so you are updating the checksum twice.</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-11T20:37:56Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:21:48Z' class='post-time'>
              August 1, 2016, 12:21pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“iKilem, post:8, topic:398582”]Two mistakes, and one actually affects both results.</p>
<p>For one, cs.update(b, 0, b.length) should be cs.update(b, 0, bytesRead). <span class="bbcode-i">bytesRead</span> doesn’t necessarily equal b.length.</p>
<p>The other mistake, which affects both results, is that super.read(byte[]) calls read(byte[] b, int, int), so you are updating the checksum twice.[/quote]<br>
^ i thought about the second one but wasn’t sure</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2011-06-12T17:50:49Z'>
            <time itemprop='dateModified' datetime='2016-08-01T12:22:57Z' class='post-time'>
              August 1, 2016, 12:22pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“iKilem, post:8, topic:398582”]Two mistakes, and one actually affects both results.</p>
<p>For one, cs.update(b, 0, b.length) should be cs.update(b, 0, bytesRead). <span class="bbcode-i">bytesRead</span> doesn’t necessarily equal b.length.</p>
<p>The other mistake, which affects both results, is that super.read(byte[]) calls read(byte[] b, int, int), so you are updating the checksum twice.[/quote]</p>
<p>Thanks so much, that fixed it right up:</p>
<pre><code class="lang-auto">import java.io.*;
import java.net.URL;
import java.util.zip.CRC32;
import java.util.zip.Checksum;
import java.util.zip.GZIPInputStream;
import java.util.zip.ZipInputStream;

public class HelpMe {

    public static void main(String[] args) throws Exception {
        String savePath = "./";
        String fileName = "java_client.win32.exe";
        File gzipFile = new File(savePath + "java_client.win32.exe.gz");
        if (!gzipFile.exists()){
            System.out.println("downloading gzip file...");
            writeStream(new URL("http://www.moparisthebest.com/libs/java_client.win32.exe.gz").openConnection().getInputStream(),
                    new FileOutputStream(gzipFile));
        }

        InputStream is = new FileInputStream(gzipFile);
        System.out.println("fileName: " + fileName);
        System.out.println("crc should be: 415399000");
        CRC32 cr = new CRC32();
        System.out.println("extracting file and calculating CRC:");
        writeStream(new ChecksumInputStream(new GZIPInputStream(is), cr), new FileOutputStream(savePath + fileName));
        System.out.println("crc32: " + cr.getValue());
        cr.reset();
        //cr = new CRC32();  // same as above, but I tried
        System.out.println("calculating CRC of the file we just extracted (should be the exact same!):");
        writeStream(new ChecksumInputStream(new FileInputStream(savePath + fileName), cr), new FileOutputStream(savePath + fileName + ".bob"));
        System.out.println("crc32: " + cr.getValue());
    }

    public static final int bufferSize = 512;

    public static void writeStream(InputStream in, OutputStream out) throws IOException {
        byte[] buffer = new byte[bufferSize];
        int len;
        while ((len = in.read(buffer)) &gt;= 0) {
            out.write(buffer, 0, len);
            //if(in instanceof ZipInputStream) try{ Thread.sleep(1); }catch(InterruptedException e){ e.printStackTrace(); }

        }
        // if its a ZipInputStream we don't want to close it
        if (!(in instanceof ZipInputStream))
            in.close();
        out.close();
    }

    public static class ChecksumInputStream extends FilterInputStream {

        private Checksum cs;

        public ChecksumInputStream(InputStream in, Checksum cs) {
            super(in);
            this.cs = cs;
        }

        public long getValue() {
            return cs.getValue();
        }

        @Override
        public int read() throws IOException {
            int byteValue = super.read();
            if (byteValue != -1) cs.update(byteValue);
            return byteValue;
        }

        @Override
        public int read(byte[] b, int off, int len) throws IOException {
            int bytesRead = super.read(b, off, len);
            if (bytesRead != -1) cs.update(b, off, bytesRead);
            return bytesRead;
        }

    }
}</code></pre>
<p><code>downloading gzip file...
fileName: java_client.win32.exe
crc should be: 415399000
extracting file and calculating CRC:
crc32: 415399000
calculating CRC of the file we just extracted (should be the exact same!):
crc32: 415399000</code></p>
<p>I guess I never ran into this problem before, because I always just used this class to calculate the CRCs and to check them, and I suppose that reading them straight out of the file vs reading them through a GzipInputStream caused bytesRead and len to be different values, resulting in different CRCs.  Thanks again!</p>
      </div>

      <meta itemprop='headline' content='Why the hell doesn&#39;t this work?!?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/why-the-hell-doesnt-this-work/398582 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 16:13:23 GMT -->
</html>
