<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/securitymanagers-and-network-control/427897 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 06:56:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>SecurityManagers and Network control? - General Programming - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;ve already seen both threads by MITB. One about the hack me challenge on his security manager, and the one about him wanting to have full control over file and network requests. 

I&amp;#39;m looking for a way to do the same t&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="427897.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;SecurityManagers and Network control?&#39;" href="427897.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/securitymanagers-and-network-control/427897" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/securitymanagers-and-network-control/427897" />
<meta property="og:title" content="SecurityManagers and Network control?" />
<meta name="twitter:title" content="SecurityManagers and Network control?" />
<meta property="og:description" content="I’ve already seen both threads by MITB. One about the hack me challenge on his security manager, and the one about him wanting to have full control over file and network requests.  I’m looking for a way to do the same thing he was, although I’m having a hard time grasping how the security manager works…  I already have the directory set up that I can use for R,W,D, and then for any other file in the system it blocks access, however I want to have the security manager ask the user if they’d like ..." />
<meta name="twitter:description" content="I’ve already seen both threads by MITB. One about the hack me challenge on his security manager, and the one about him wanting to have full control over file and network requests.  I’m looking for a way to do the same thing he was, although I’m having a hard time grasping how the security manager works…  I already have the directory set up that I can use for R,W,D, and then for any other file in the system it blocks access, however I want to have the security manager ask the user if they’d like ..." />
<meta property="article:published_time" content="2012-01-03T13:07:42+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="427897.html">SecurityManagers and Network control?</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/HcoJustin.html'><span itemprop='name'>HcoJustin</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T13:07:42Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:01:34Z' class='post-time'>
              August 2, 2016,  3:01pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ve already seen both threads by MITB. One about the <a href="http://www.moparisthebest.com/smf/index.php?topic=427763.0" data-bbcode="true" rel="nofollow noopener">hack me challenge</a> on his security manager, and the one about him wanting to have <a href="http://www.moparisthebest.com/smf/index.php?topic=514882.0" data-bbcode="true" rel="nofollow noopener">full control over file and network requests</a>.</p>
<p>I’m looking for a way to do the same thing he was, although I’m having a hard time grasping how the security manager works…</p>
<p>I already have the directory set up that I can use for R,W,D, and then for any other file in the system it blocks access, however I want to have the security manager ask the user if they’d like to allow the program access. Either One time only, or for the remainder of the process’s life.</p>
<p>I’m sure it would just be a matter of changing checkPermission? A nudge in the right direction would surely be helpful!</p>
<p>On a side note, the security manager may have been too strict, it was denying read only access for the system fonts, any ideas? The permission’s were the same as MITB’s I think…</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-03T16:19:54Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:01:45Z' class='post-time'>
              August 2, 2016,  3:01pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/HcoJustin.html'><span itemprop='name'>HcoJustin</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-04T01:43:21Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:31Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Moparisthebest, post:2, topic:427897”]That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.[/quote]</p>
<p>That would explain why the option pane wouldn’t work… Is there a way to just run the applets in a sandbox and let the rest of the application run free? I suppose I could do it in a client-server fashion and let the clients run in their own process, which actually solves a memory issue I’ve been running into…</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="2" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-04T01:49:02Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:32Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="3" data-topic="427897">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../letter_avatar/hcojustin/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> HcoJustin:</div>
<blockquote>
<p>Is there a way to just run the applets in a sandbox and let the rest of the application run free?</p>
</blockquote>
</aside>
<p>I wish that there was, the closest I have came was the SecurityManager I wrote which lets me control permissions based on which classloader was used to load the code.  If you come up with a better solution, please do let me know.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/mod_taharok.html'><span itemprop='name'>mod_taharok</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-04T02:43:23Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:36Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“HcoJustin, post:3, topic:427897”][quote author=Moparisthebest link=topic=530587.msg3874844#msg3874844 date=1325607594]<br>
That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.<br>
[/quote]</p>
<p>That would explain why the option pane wouldn’t work… Is there a way to just run the applets in a sandbox and let the rest of the application run free? I suppose I could do it in a client-server fashion and let the clients run in their own process, which actually solves a memory issue I’ve been running into…[/quote]</p>
<p>Well if you dynamically define all the applet and related classes, you can do so in a custom ClassLoader like Moparisthebest said. Otherwise, there’s another more complicated solution.</p>
<p>I think I did this in my Oriole server framework I wrote a few years ago. There’s a class in the proprietary sun reflection package for building stack traces. It allows you to get the actual Class object in reverse order of the current execution stack. You could use this to figure out whether any of the applet’s classes are part of that call sequence, and then apply the security manager limitations to the current execution instance.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-04T04:03:56Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:02:42Z' class='post-time'>
              August 2, 2016,  3:02pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Taharok, post:5, topic:427897”][quote author=HcoJustin link=topic=530587.msg3875526#msg3875526 date=1325641401]</p>
<aside class="quote">
<blockquote>
<p>That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.</p>
</blockquote>
</aside>
<p>That would explain why the option pane wouldn’t work… Is there a way to just run the applets in a sandbox and let the rest of the application run free? I suppose I could do it in a client-server fashion and let the clients run in their own process, which actually solves a memory issue I’ve been running into…<br>
[/quote]</p>
<p>Well if you dynamically define all the applet and related classes, you can do so in a custom ClassLoader like Moparisthebest said. Otherwise, there’s another more complicated solution.</p>
<p>I think I did this in my Oriole server framework I wrote a few years ago. There’s a class in the proprietary sun reflection package for building stack traces. It allows you to get the actual Class object in reverse order of the current execution stack. You could use this to figure out whether any of the applet’s classes are part of that call sequence, and then apply the security manager limitations to the current execution instance.[/quote]</p>
<p>You don’t have to use proprietary sun classes to get a class stack, I do it in my SecurityManager by only using official APIs.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/mod_taharok.html'><span itemprop='name'>mod_taharok</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-09T05:24:59Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:10:58Z' class='post-time'>
              August 2, 2016,  3:10pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Moparisthebest, post:6, topic:427897”][quote author=Taharok link=topic=530587.msg3875597#msg3875597 date=1325645003]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.</p>
</blockquote>
</aside>
<p>That would explain why the option pane wouldn’t work… Is there a way to just run the applets in a sandbox and let the rest of the application run free? I suppose I could do it in a client-server fashion and let the clients run in their own process, which actually solves a memory issue I’ve been running into…</p>
</blockquote>
</aside>
<p>Well if you dynamically define all the applet and related classes, you can do so in a custom ClassLoader like Moparisthebest said. Otherwise, there’s another more complicated solution.</p>
<p>I think I did this in my Oriole server framework I wrote a few years ago. There’s a class in the proprietary sun reflection package for building stack traces. It allows you to get the actual Class object in reverse order of the current execution stack. You could use this to figure out whether any of the applet’s classes are part of that call sequence, and then apply the security manager limitations to the current execution instance.<br>
[/quote]</p>
<p>You don’t have to use proprietary sun classes to get a class stack, I do it in my SecurityManager by only using official APIs.[/quote]</p>
<p>I’m curious how you did that. Did you just parse the stack trace elements provided by java.lang.Throwable?</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T00:45:49Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:11:54Z' class='post-time'>
              August 2, 2016,  3:11pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Taharok, post:7, topic:427897”][quote author=Moparisthebest link=topic=530587.msg3875689#msg3875689 date=1325649836]</p>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<aside class="quote">
<blockquote>
<p>That SecurityManager was probably the hardest thing I’ve ever written.  Well not exactly hard, but tedious would certainly be correct.  The permissions the same code asks for on different Operating Systems are different, they are different with each release of the JVM, and as you said, the font issue was very hard to overcome.</p>
<p>I also wanted to put in code to over-ride the set permissions, but even JOptionDialog requires a whole other set of permissions, and the circular requests cause a stack overflow, crashing the program.</p>
<p>You can go ahead and use my SecurityManager if you wish, it’s licensed under the GPL.  You will see how I handled the fonts and such, it should be pretty safe.</p>
</blockquote>
</aside>
<p>That would explain why the option pane wouldn’t work… Is there a way to just run the applets in a sandbox and let the rest of the application run free? I suppose I could do it in a client-server fashion and let the clients run in their own process, which actually solves a memory issue I’ve been running into…</p>
</blockquote>
</aside>
<p>Well if you dynamically define all the applet and related classes, you can do so in a custom ClassLoader like Moparisthebest said. Otherwise, there’s another more complicated solution.</p>
<p>I think I did this in my Oriole server framework I wrote a few years ago. There’s a class in the proprietary sun reflection package for building stack traces. It allows you to get the actual Class object in reverse order of the current execution stack. You could use this to figure out whether any of the applet’s classes are part of that call sequence, and then apply the security manager limitations to the current execution instance.</p>
</blockquote>
</aside>
<p>You don’t have to use proprietary sun classes to get a class stack, I do it in my SecurityManager by only using official APIs.<br>
[/quote]</p>
<p>I’m curious how you did that. Did you just parse the stack trace elements provided by java.lang.Throwable?[/quote]</p>
<p>Right here, it’s a method of SecurityManager:<br>
<a href="http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/SecurityManager.html#getClassContext%28%29" class="onebox" target="_blank">http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/SecurityManager.html#getClassContext()</a></p>
<p>Here is my entire class, if you wish to use it:</p>
<pre><code class="lang-auto">/*
 * Copyright (C) 2010  moparisthebest
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * Official forums are http://www.moparisthebest.com/smf/
 * Email me at admin@moparisthebest.com , I read it but don't usually respond.
 */

package org.moparscape.security;

import org.moparscape.Debug;

import java.security.Permission;
import java.security.Permissions;
import java.util.Map;

/**
 * Very flexible SecurityManager that restricts permissions based on class loader. Fixes some painful problems with
 * default JVM classes.
 */
public class SecurityManager extends java.lang.SecurityManager {

    // IdentityHashMap is faster than HashMap and better in this case as the ClassLoader is the SAME OBJECT
    // and therefore will compare better and faster with == rather than the .equals() HashMap uses
    private Map&lt;ClassLoader, Permissions&gt; permissionMap = new java.util.IdentityHashMap&lt;ClassLoader, Permissions&gt;();

    // single socket permission that is allowed
    private java.net.SocketPermission allowedSocket = new java.net.SocketPermission("localhost", "connect,accept,resolve");

    // some permissions we need for special cases
    private Permission p1 = new java.lang.RuntimePermission("accessClassInPackage.sun.util.resources");
    private Permission reflectPerm = new java.lang.reflect.ReflectPermission("suppressAccessChecks");
    private Permission classLoaderPerm = new java.lang.RuntimePermission("createClassLoader");

    public void addPermissions(ClassLoader cl, Permissions perms) {
        // if they can't set the SecurityManager, they shouldn't be able to modify this one, so check...
        System.getSecurityManager().checkPermission(new java.lang.RuntimePermission("setSecurityManager"));
        //if the key already exists, just return, we only support setting the permissions once
        if (permissionMap.containsKey(cl))
            return;

        perms.setReadOnly();  // no need for this anymore
        permissionMap.put(cl, perms);
    }

    public void allowSocketTo(String host) {
        // if they can't set the SecurityManager, they shouldn't be able to modify this one, so check...
        System.getSecurityManager().checkPermission(new java.lang.RuntimePermission("setSecurityManager"));
        allowedSocket = new java.net.SocketPermission(host, "connect,accept,resolve");
    }

    /**
     * Throws a &lt;code&gt;SecurityException&lt;/code&gt; if the requested
     * access, specified by the given permission, is not permitted based
     * on the security policy currently in effect.
     * &lt;p/&gt;
     * This method calls &lt;code&gt;AccessController.checkPermission&lt;/code&gt;
     * with the given permission.
     *
     * @param perm the requested permission.
     * @throws SecurityException    if access is not permitted based on
     *                              the current security policy.
     * @throws NullPointerException if the permission argument is
     *                              &lt;code&gt;null&lt;/code&gt;.
     * @since 1.2
     */
    @Override
    public void checkPermission(Permission perm) {
        if (perm == null)
            throw new NullPointerException("Permission cannot be null.");

        // this isn't ready to go live yet, so just return and allow it all
        //if (true) return;

        // we are now going to go through the ClassLoaders of all Classes on the stack
        // if any of them are in perms, then check the permissions, sticking to the most
        // restrictive of the permissions of any class in the stack (if any are false, deny the request)

        // get all classes on stack
        Class c[] = getClassContext();

        // if this is true, the request came from SecurityManager or this class, so allow it.
        // this stops Circularity errors, and is only used when ran as an applet, why the hell?...
        if (c[2].getName().equals("org.moparscape.security.SecurityManager"))
            return;

        //System.out.println("requesting perm: " + perm);

        for (int i = 1; i &lt; c.length; i++) {
            ClassLoader cl = c[i].getClassLoader();

            // getClassLoader() can return null, if it is the bootstrap class
            // loader, since our Map implementation handles nulls, go ahead
            // and ignore whether or not it is null (my tests show speed is the same)
            //if (cl == null)     continue;

            Permissions clPerms = permissionMap.get(cl);
            // if the classloader isn't in our map, we don't have any say on it so continue
            if (clPerms == null)
                continue;

            // if the permissions allows this, continue and avoid all the following time-consuming checks
            // TODO: I've since discovered .implies() is rather slow, so find out what is slower, this or the following...
            if (clPerms.implies(perm))
                continue;

            // 2 exceptions here for java.util.GregorianCalendar, java.util.Calendar, java.text.SimpleDateFormat:
            // java.lang.RuntimePermission accessClassInPackage.sun.util.resources
            // java.lang.reflect.ReflectPermission suppressAccessChecks
            String lastCName = c[i - 1].getName();
            if (((lastCName.startsWith("java.util.") &amp;&amp; lastCName.endsWith("Calendar"))
                    || lastCName.equals("java.text.SimpleDateFormat"))
                    &amp;&amp; (perm.equals(p1) || perm.equals(reflectPerm)))
                return;
            // some more exceptions for when java classes use reflection. why?...
            // also an exception for jsound, we can't just allow loadlibrary.jsound* because there could be malicious
            // code in a custom library named jsoundhacks and it would be allowed to load, so we only allow
            // loadlibrary.jsound* if the next class on the stack is javax.sound.sampled.AudioSystem
            // known examples are jsoundds and jsoundalsa
            if (lastCName.equals("javax.sound.sampled.AudioSystem") &amp;&amp; (perm.equals(reflectPerm) || perm.getName().startsWith("loadLibrary.jsound")))
                return;
            // or sun.java2d.SunGraphics2D for Mac OSX Leopard...
            if (lastCName.equals("java.awt.Component") || lastCName.equals("sun.font.FontDesignMetrics") || lastCName.equals("sun.java2d.SunGraphics2D")) {
                // component uses reflection, and sometimes creates a classloader, yay...
                if (perm.equals(reflectPerm) || perm.equals(classLoaderPerm))
                    return;
                // it also loads about a million fonts, with no platform independent way to handle this, so we are going to kludge it
                // we are going to allow reading (only) of all .ttf files
                if (perm instanceof java.io.FilePermission &amp;&amp; perm.getActions().equals("read")) {
                    String lowName = perm.getName().toLowerCase();
                    // most end with .ttf
                    if (lowName.endsWith(".ttf"))
                        return;
                    // some end with .ttc
                    if (lowName.endsWith(".ttc"))
                        return;
                    // others are named something stupid, like 'ttf-arabeyes', or even 'kochi'
                    // something they all have in common (at least on linux) is they all contain 'font' in the path
                    if (lowName.contains("font"))
                        return;
                }
            }

            // one last check, which I found is very slow
            // if this is the allowed socket, allow it
            if (allowedSocket.implies(perm))
                return;

            // if we get all the way down here, the permission was denied and wasn't an exception, so throw an exception
            System.err.println("denying: " + perm.toString());

            if (Debug.debug()) {
                // class stack for debugging
                for (int x = 1; x &lt; c.length; x++) System.out.println(x + ": " + c[x].getName());

                Thread.dumpStack();
            }

            // otherwise allow is false, throw a SecurityException
            throw new SecurityException("Permission denied: " + perm.toString());
            //return;
        }

    }

    @Override
    public void checkPermission(Permission perm, Object context) {
        // ignore context
        this.checkPermission(perm);
    }

    public static Permissions getClientPermissions(String allowedDir) {
        //printSystemPropertiesExit();
        // java.library.path=/opt/jdk1.6.0_18/jre/lib/i386/server:/opt/jdk1.6.0_18/jre/lib/i386:/opt/jdk1.6.0_18/jre/../lib/i386:.::/usr/java/packages/lib/i386:/lib:/usr/lib
        // to allow recursively everything under allowedDir
        allowedDir += "-";
        Debug.debug("allowedDir: " + allowedDir);
        Permissions permissions = new Permissions();
        //permissions.add(new java.security.AllPermission());

        // only needed when not in a jar
        // will deny this later
        permissions.add(new java.io.FilePermission("./-", "read"));
        permissions.add(new java.net.SocketPermission("graveman.info", "connect,accept,resolve"));
        //questionable
        permissions.add(new RuntimePermission("accessDeclaredMembers"));
        permissions.add(new RuntimePermission("setFactory"));
        permissions.add(new RuntimePermission("loadLibrary.awt"));
        permissions.add(new java.security.SecurityPermission("putProviderProperty.SUN"));
        // very questionable
        permissions.add(new RuntimePermission("modifyThreadGroup"));
        permissions.add(new java.net.NetPermission("getProxySelector"));
        //needed
        String javaHome = System.getProperty("java.home") + "/-";
        permissions.add(new java.io.FilePermission(javaHome, "read"));
        permissions.add(new java.io.FilePermission(allowedDir, "read,write,delete"));
        permissions.add(new java.io.FilePermission(allowedDir.substring(0, allowedDir.length() - 2), "read,write,delete"));
        permissions.add(new java.net.SocketPermission("localhost:1024-", "accept,connect,listen"));
        permissions.add(new java.util.PropertyPermission("socksProxyHost", "read"));
        permissions.add(new java.util.PropertyPermission("line.separator", "read"));
        permissions.add(new java.util.PropertyPermission("java.protocol.handler.pkgs", "read"));
        // java.util.Calendar screwing with things again, write isn't too harmful, it only
        // lasts for the run of that individual JVM
        permissions.add(new java.util.PropertyPermission("user.timezone", "read,write"));
        permissions.add(new java.util.PropertyPermission("user.country", "read"));
        permissions.add(new java.util.PropertyPermission("sun.timezone.ids.oldmapping", "read"));
        permissions.add(new java.util.PropertyPermission("sun.net.inetaddr.ttl", "read"));
        permissions.add(new java.util.PropertyPermission("java.net.useSystemProxies", "read"));
        permissions.add(new java.security.SecurityPermission("getProperty.networkaddress.*"));
        // following needed for networking and file read/write
        // this is OK because we restrict FilePermissions and SocketPermission
        permissions.add(new RuntimePermission("readFileDescriptor"));
        permissions.add(new RuntimePermission("writeFileDescriptor"));

        // asked for with java5 runtime
        permissions.add(new java.util.PropertyPermission("sun.java2d.remote", "read"));

        // the above is sufficient for 317, following is needed for 508
        permissions.add(new java.util.PropertyPermission("user.home", "read"));
        permissions.add(new java.util.PropertyPermission("line.separator", "read"));
        permissions.add(new java.util.PropertyPermission("java.vendor", "read"));
        permissions.add(new java.util.PropertyPermission("java.version", "read"));
        permissions.add(new java.util.PropertyPermission("java.home", "read"));
        permissions.add(new java.util.PropertyPermission("java.class.path", "read"));
        permissions.add(new java.util.PropertyPermission("os.*", "read"));
        permissions.add(new java.util.PropertyPermission("sun.awt.*", "read"));
        permissions.add(new java.util.PropertyPermission("javax.*", "read"));
        permissions.add(new java.awt.AWTPermission("accessEventQueue"));
        permissions.add(new java.net.NetPermission("getCookieHandler"));
        permissions.add(new java.net.NetPermission("getResponseCache"));
        permissions.add(new RuntimePermission("loadLibrary.jsound"));

        // following for OSX leopard
        permissions.add(new java.util.PropertyPermission("socksNonProxyHosts", "read"));
        permissions.add(new java.util.PropertyPermission("sun.java2d.*", "read"));
        permissions.add(new RuntimePermission("accessClassInPackage.sun.text.resources"));
        // apparantly the following isn't in System.getProperty("java.home")? whatever, osx blows...
        permissions.add(new java.io.FilePermission("/System/Library/Frameworks/JavaVM.framework/-", "read"));

        return permissions;
    }

    public static Permissions getServerPermissions(String allowedDir) {
        // basically the same, why not?
        Permissions permissions = getClientPermissions(allowedDir);

        // for 508
        permissions.add(new java.util.PropertyPermission("python.home", "read,write"));
        permissions.add(new java.util.PropertyPermission("java.vm.vendor", "read"));
        permissions.add(new java.util.PropertyPermission("python.home", "read"));

        //System.out.println(permissions.toString());
        return permissions;
    }
}
</code></pre>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/mod_taharok.html'><span itemprop='name'>mod_taharok</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-01-10T05:16:37Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:12:15Z' class='post-time'>
              August 2, 2016,  3:12pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That’s interesting, I never saw that before.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-02-04T22:30:06Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:45:30Z' class='post-time'>
              August 2, 2016,  3:45pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have fixed the issues I had with allowing manual override of my SecurityManager, if you want to allow it it will simply ask the user whether they want to allow a specific permission or not, the entire class is attached for those interested.</p>
<p>I also fixed even more problems with java’s standard library wanting to use reflection, create classloaders and securitymanagers and all sorts of things.  Annoying…</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2012-02-05T00:34:27Z'>
            <time itemprop='dateModified' datetime='2016-08-02T15:45:38Z' class='post-time'>
              August 2, 2016,  3:45pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>OSX blows indeed.</p>
      </div>

      <meta itemprop='headline' content='SecurityManagers and Network control?'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/securitymanagers-and-network-control/427897 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 06:56:28 GMT -->
</html>
