<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>BCEL basic help</title>
    <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248</link>
    <description>So here is my problem.

I wanted to write a &#39;very simple obfuscator&#39; which only rename methods name ( and as I grow older with BCEL, I&#39;ll make it more advanced ).

So. the class uses the BCEL library to do the following.

Load the class using ClassGen.
Copy the method using MethodGen, remove the method from the main class. and add a new renamed method using the MethodGen.

now, I am having a problem. let&#39;s say I have the following code?

[CODE]
public void x() {
y();
}
public void y() {
//internal of y() method.
}
[/CODE]

so it renames x and y correctly to a new string.

but, when JAD reads the code. it print out the following.

[CODE]
public void newRenamedX() {
y();
}

public void newRenamedY() {
//internal of y() method.
}
[/CODE]

How would I go rename all the y() references? which is placed within a Method?</description>
    
    <lastBuildDate>Tue, 27 Jul 2010 06:57:24 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@Jython super_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jython">@Jython</a> wrote:</p>
          <blockquote>
              <p>[quote=“abraham2119, post:13, topic:351248”][quote author=super_ link=topic=447606.msg3285407#msg3285407 date=1280172138]<br>
don’t even touch the MethodGens just modify all relevant constant pool entries<br>
[/quote]hurr way on repeating what was said[/quote]</p>
<p>hurr durr sif i would read what idiotic suggestions you post</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/14</link>
        <pubDate>Tue, 27 Jul 2010 06:57:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-14</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@abraham2119 abraham2119]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/abraham2119">@abraham2119</a> wrote:</p>
          <blockquote>
              <p>[quote=“super_, post:12, topic:351248”]don’t even touch the MethodGens just modify all relevant constant pool entries[/quote]hurr way on repeating what was said</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/13</link>
        <pubDate>Mon, 26 Jul 2010 19:31:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-13</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@Jython super_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jython">@Jython</a> wrote:</p>
          <blockquote>
              <p>don’t even touch the MethodGens just modify all relevant constant pool entries</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/12</link>
        <pubDate>Mon, 26 Jul 2010 19:22:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-12</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@Evil1 Evil_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/evil1">@Evil1</a> wrote:</p>
          <blockquote>
              <p>It seems like this is so much easier in <a href="http://asm.ow2.org/" data-bbcode="true">ObjectWeb ASM</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/11</link>
        <pubDate>Mon, 26 Jul 2010 18:23:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-11</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@angel_in_war angel in war]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/angel_in_war">@angel_in_war</a> wrote:</p>
          <blockquote>
              <p>[quote=“the bank, post:9, topic:351248”]Don’t think like that.  Stay positive, think of it all as a learning experience.  Keep doing things like this and eventually you will have a wealthy understanding of the library and even the way bytecode manipulation works.</p>
<p><span class="mention">@abraham</span><br>
A valid point, I didn’t think of that <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
<p><a class="mention" href="/u/angel">@angel</a> in war<br>
You should learn to use the JavaDocs better buddy.  Try taking a look at the ConstantPoolGen class, and then a look at ConstantUtf8.  Or, you could even skip that last one.  BCEL isn’t the best documented library in the world…</p>
<p>Basically, what abraham is suggesting is you add a new Utf8 to the constantpool, “ConstantPoolGen.addUtf8(String);” that contains the name of your method (ps: don’t worry about errors or anything from having more than one utf8 constant being declared as the same.  bcel automatically searches the constant pool to see if a duplicate exists before it creates the new one).</p>
<p>Once you have that, find the MethodRef for your method and then find it’s NameAndType index (ConstantMethodRef.getNameAndTypeIndex()) and change the NameIndex of that to your new Utf8 (ConsantNameAndType.setNameIndex(int)).</p>
<p>Clear enough?</p>
<p>EDIT:<br>
<a href="http://jakarta.apache.org/bcel/apidocs/index.html%5B/quote%5D" class="onebox" target="_blank" rel="nofollow noopener">http://jakarta.apache.org/bcel/apidocs/index.html[/quote]</a></p>
<p>I think so, thanks buddy. I’ll take a further look at it later, for now I got to go. big appreciation to everybody.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/10</link>
        <pubDate>Mon, 26 Jul 2010 17:37:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-10</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>Don’t think like that.  Stay positive, think of it all as a learning experience.  Keep doing things like this and eventually you will have a wealthy understanding of the library and even the way bytecode manipulation works.</p>
<p><span class="mention">@abraham</span><br>
A valid point, I didn’t think of that <img src="https://forum.moparisthebest.com/images/emoji/twitter/confused.png?v=5" title=":confused:" class="emoji" alt=":confused:"></p>
<p><a class="mention" href="/u/angel">@angel</a> in war<br>
You should learn to use the JavaDocs better buddy.  Try taking a look at the ConstantPoolGen class, and then a look at ConstantUtf8.  Or, you could even skip that last one.  BCEL isn’t the best documented library in the world…</p>
<p>Basically, what abraham is suggesting is you add a new Utf8 to the constantpool, “ConstantPoolGen.addUtf8(String);” that contains the name of your method (ps: don’t worry about errors or anything from having more than one utf8 constant being declared as the same.  bcel automatically searches the constant pool to see if a duplicate exists before it creates the new one).</p>
<p>Once you have that, find the MethodRef for your method and then find it’s NameAndType index (ConstantMethodRef.getNameAndTypeIndex()) and change the NameIndex of that to your new Utf8 (ConsantNameAndType.setNameIndex(int)).</p>
<p>Clear enough?</p>
<p>EDIT:<br>
<a href="http://jakarta.apache.org/bcel/apidocs/index.html" class="onebox" target="_blank" rel="nofollow noopener">http://jakarta.apache.org/bcel/apidocs/index.html</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/9</link>
        <pubDate>Mon, 26 Jul 2010 17:09:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-9</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@angel_in_war angel in war]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/angel_in_war">@angel_in_war</a> wrote:</p>
          <blockquote>
              <p>[quote=“abraham2119, post:7, topic:351248”][quote author=Unhandled link=topic=447606.msg3285098#msg3285098 date=1280158205]<br>
does BCEL rly make you remove and readd methods? surely you should be able to do this entirely in the constantpool…<br>
[/quote]you are able to do it entirely in the constant pool using bcel, i did it with my rs updater</p>
<p>[quote author=the bank link=topic=447606.msg3285112#msg3285112 date=1280159242]<br>
Fuck it, I’ll spoon feed.  The way I would do it is finding the MethodRef and then finding the NameAndType constant associated with that MethodRef (in my case it was at index 22) then from there find the Utf8 constant associated with the NameAndType and edit the Utf8 to your new method name.<br>
[/quote]no, don’t do it that way because if there are any string constants, for example, that point to that same utf8 constants, they too will be renamed</p>
<p>a viable alternative is to add a new utf8 to the constant pool and replace the name index of the name_and_type constant pointed to by the method_ref constant with the index of the newly added constant[/quote]</p>
<p>So, I am doomed. I don’t know how to do that. and it seems like people with big reputation disagree on how to do it. could someone be a little bit more obvious on how to do it? and maybe post a code sample?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/8</link>
        <pubDate>Mon, 26 Jul 2010 16:59:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-8</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@abraham2119 abraham2119]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/abraham2119">@abraham2119</a> wrote:</p>
          <blockquote>
              <p>[quote=“Unhandled, post:4, topic:351248”]does BCEL rly make you remove and readd methods? surely you should be able to do this entirely in the constantpool…[/quote]you are able to do it entirely in the constant pool using bcel, i did it with my rs updater</p>
<p>[quote=“the bank, post:6, topic:351248”]Fuck it, I’ll spoon feed.  The way I would do it is finding the MethodRef and then finding the NameAndType constant associated with that MethodRef (in my case it was at index 22) then from there find the Utf8 constant associated with the NameAndType and edit the Utf8 to your new method name.[/quote]no, don’t do it that way because if there are any string constants, for example, that point to that same utf8 constants, they too will be renamed</p>
<p>a viable alternative is to add a new utf8 to the constant pool and replace the name index of the name_and_type constant pointed to by the method_ref constant with the index of the newly added constant</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/7</link>
        <pubDate>Mon, 26 Jul 2010 16:23:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-7</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>Wrong.</p>
<p>Lets go through a little example.  Let’s say this is our class (NOTE: I’m doing this all as I type):</p>
<p>[code]public class bcelPOC {</p>
<pre><code>private void printStuff() {
	System.out.println("Stuff");
}

public void callPrintStuff() {
	printStuff();
}
</code></pre>
<p>}[/code]</p>
<p>Next, lets open it up in a bytecode editor/viewer of sorts.  I am writing my own atm so I will open it in that, but feel free to use JBE.</p>
<p>Here is our instruction list for the “callPrintStuff()” method:</p>
<p><code>aload_0
invokespecial #5  &lt;bcelPOC.printStuff ()V&gt;
return </code></p>
<p>So lets take a look at the <span class="hashtag">#5</span> index in the constant pool and we find this:</p>
<pre><code class="lang-auto">Methodref - bcelPOC.printStuff ()V - class_index = 6, name_and_type_index = 22</code></pre>
<p>NOTE: My view is in a table so I separated each piece with a “-”.</p>
<p>Now I don’t want to completely spoon feed or else you won’t learn much, however you may want to make use of the ConstantPoolGen.setConstant(args) method.</p>
<p>PS: There are a couple ways to go about doing this…I recommend you search for a certain Utf8 constant and go from there.</p>
<p><a class="mention" href="/u/unhandled">@unhandled</a><br>
There is a “replaceMethod” function.  And it would only make sense for you to be able to go through the constant pool, but I haven’t tried it.</p>
<p>EDIT:<br>
Fuck it, I’ll spoon feed.  The way I would do it is finding the MethodRef and then finding the NameAndType constant associated with that MethodRef (in my case it was at index 22) then from there find the Utf8 constant associated with the NameAndType and edit the Utf8 to your new method name.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/6</link>
        <pubDate>Mon, 26 Jul 2010 15:47:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-6</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@angel_in_war angel in war]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/angel_in_war">@angel_in_war</a> wrote:</p>
          <blockquote>
              <p>I am very noobish with BCEL, I just started to learn it and from libraries only. if you have an alternative please post it as that’s the reason why I posted this here.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/5</link>
        <pubDate>Mon, 26 Jul 2010 15:33:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-5</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@Unhandled Unhandled]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/unhandled">@Unhandled</a> wrote:</p>
          <blockquote>
              <p>does BCEL rly make you remove and readd methods? surely you should be able to do this entirely in the constantpool…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/4</link>
        <pubDate>Mon, 26 Jul 2010 15:30:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-4</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@angel_in_war angel in war]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/angel_in_war">@angel_in_war</a> wrote:</p>
          <blockquote>
              <p>so…  if it’s like<br>
ConstantPoolGen pgen = cg.getConstantPoolGen();<br>
i’ll do…<br>
MethodGen mg = new MethodGen(method, cg.getClassName(), pgen);<br>
pgen.addMethodref(mg);</p>
<p>??</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/3</link>
        <pubDate>Mon, 26 Jul 2010 15:25:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-3</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@DarKcookie DarKcookie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/darkcookie">@DarKcookie</a> wrote:</p>
          <blockquote>
              <p>Update the relevant method reference(s) in the constant pool of (all) the class(es).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/2</link>
        <pubDate>Mon, 26 Jul 2010 15:12:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-2</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
      <item>
        <title>BCEL basic help</title>
        <dc:creator><![CDATA[@angel_in_war angel in war]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/angel_in_war">@angel_in_war</a> wrote:</p>
          <blockquote>
              <p>So here is my problem.</p>
<p>I wanted to write a ‘very simple obfuscator’ which only rename methods name ( and as I grow older with BCEL, I’ll make it more advanced ).</p>
<p>So. the class uses the BCEL library to do the following.</p>
<p>Load the class using ClassGen.<br>
Copy the method using MethodGen, remove the method from the main class. and add a new renamed method using the MethodGen.</p>
<p>now, I am having a problem. let’s say I have the following code?</p>
<pre><code class="lang-auto">public void x() {
y();
}
public void y() {
//internal of y() method.
}</code></pre>
<p>so it renames x and y correctly to a new string.</p>
<p>but, when JAD reads the code. it print out the following.</p>
<pre><code class="lang-auto">public void newRenamedX() {
y();
}

public void newRenamedY() {
//internal of y() method.
}</code></pre>
<p>How would I go rename all the y() references? which is placed within a Method?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/bcel-basic-help/351248/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/bcel-basic-help/351248/1</link>
        <pubDate>Mon, 26 Jul 2010 15:03:17 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-351248-1</guid>
        <source url="https://forum.moparisthebest.com/t/bcel-basic-help/351248.rss">BCEL basic help</source>
      </item>
  </channel>
</rss>
