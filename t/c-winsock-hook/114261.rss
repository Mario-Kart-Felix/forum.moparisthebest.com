<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[C++] Winsock Hook</title>
    <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261</link>
    <description>I don&#39;t know if by posting this, it will actually help somebody.

Anyways you need detours for this:
http://research.microsoft.com/sn/detours/

If you hook something like Firefox, beware of the 40 message boxes you will receive. With hooking Winsock you are able to change the packet before the program has the ability to analyze it.

You should probably make it write to a file or something else more efficient than using MessageBox.

[code]
#include &quot;stdafx.h&quot;
#include &lt;detours.h&gt;
#include &lt;Winsock2.h&gt;


#pragma comment(lib, &quot;wsock32&quot;)


DETOUR_TRAMPOLINE(int WINAPI Real_recv(SOCKET a0, char* a1, int a2, int a3), recv);
int WINAPI custom_recv(SOCKET sock, char FAR* buf, int len, int flags);

BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved)
{
        if ( reason == DLL_PROCESS_ATTACH )
        {
			DetourFunctionWithTrampoline((PBYTE)Real_recv,(PBYTE)custom_recv);;
        }
        else if ( reason == DLL_PROCESS_DETACH )
        {
			DetourRemove((PBYTE)Real_recv,(PBYTE)custom_recv);
        }    
        return true;
}

int WINAPI custom_recv(SOCKET sock, char FAR* buf, int len, int flags)
{

	MessageBox(NULL, buf, NULL, NULL);
	//buf = &quot;4&quot;; //Change data before the program can read it
	return Real_recv(sock, buf, len, flags);
}
[/code]

Injector to use after you compile this DLL:
WinJect: http://rapidshare.com/files/38425070/Winject.zip</description>
    
    <lastBuildDate>Tue, 24 Jul 2007 23:21:59 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@I_Am_Olan14 I Am Olan14]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/i_am_olan14">@I_Am_Olan14</a> wrote:</p>
          <blockquote>
              <p>Ooo very nice.<br>
Packet Editor ftw.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/11</link>
        <pubDate>Tue, 24 Jul 2007 23:21:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-11</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@Javacisnotrecognized _^_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/javacisnotrecognized">@Javacisnotrecognized</a> wrote:</p>
          <blockquote>
              <p>To clarify what I was trying to say before: Calling into a different module inside DllMain is very very bad.<br>
It fucks up the initialization order.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/10</link>
        <pubDate>Tue, 24 Jul 2007 21:20:46 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-10</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@nade nade]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nade">@nade</a> wrote:</p>
          <blockquote>
              <p>If anybody is interested here is the full source code to this: <a href="http://servbit.org/priv/viewtopic.php?id=1" rel="nofollow noopener">http://servbit.org/priv/viewtopic.php?id=1</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/9</link>
        <pubDate>Tue, 24 Jul 2007 18:26:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-9</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@pplsuqbawlz pplsuqbawlz]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pplsuqbawlz">@pplsuqbawlz</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="7" data-topic="114261">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/zammyking111/40/5_6259e4fa9dfe0dec282fb0955bb1974c.png" class="avatar"> zammyking111:</div>
<blockquote>
<p>So can i use this to packet edit maplestory??</p>
</blockquote>
</aside>
<p>You? No. Me, yes. See you need to at least understand C++ or C, I think detours support C?</p>
<p>It lets you hook anything really in Windows… even Java… Say anything that uses java.nio.SocketChannel (WinSock2) or java.io.Socket (WinSock)…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/8</link>
        <pubDate>Tue, 17 Jul 2007 10:46:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-8</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@zammyking111 zammyking111]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/zammyking111">@zammyking111</a> wrote:</p>
          <blockquote>
              <p>So can i use this to packet edit maplestory??</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/7</link>
        <pubDate>Tue, 17 Jul 2007 08:36:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-7</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@Javacisnotrecognized _^_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/javacisnotrecognized">@Javacisnotrecognized</a> wrote:</p>
          <blockquote>
              <p>[quote=“nade, post:5, topic:114261”][quote author=Javacisnotrecognized link=topic=163405.msg1535131#msg1535131 date=1182591670]<br>
Unless the entire detour code is in detour.h and not just the prototype, you really shouldn’t be calling it in your DllMain.<br>
[/quote]</p>
<p>What did you just say? The detour functions are in detour.h - and I am calling them from my DllMain.[/quote]</p>
<p>Unless the code is in your module, it is in a different module and you must not call it from DllMain.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/6</link>
        <pubDate>Sun, 24 Jun 2007 10:56:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-6</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@nade nade]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nade">@nade</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="4" data-topic="114261">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/javacisnotrecognized/40/5_6259e4fa9dfe0dec282fb0955bb1974c.png" class="avatar"> Javacisnotrecognized:</div>
<blockquote>
<p>Unless the entire detour code is in detour.h and not just the prototype, you really shouldn’t be calling it in your DllMain.</p>
</blockquote>
</aside>
<p>What did you just say? The detour functions are in detour.h - and I am calling them from my DllMain.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/5</link>
        <pubDate>Sat, 23 Jun 2007 22:08:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-5</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@Javacisnotrecognized _^_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/javacisnotrecognized">@Javacisnotrecognized</a> wrote:</p>
          <blockquote>
              <p>Unless the entire detour code is in detour.h and not just the prototype, you really shouldn’t be calling it in your DllMain.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/4</link>
        <pubDate>Sat, 23 Jun 2007 09:41:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-4</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@nade nade]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nade">@nade</a> wrote:</p>
          <blockquote>
              <p>Everybody there is too cool for me.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/3</link>
        <pubDate>Sat, 23 Jun 2007 07:43:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-3</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@nade nade]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nade">@nade</a> wrote:</p>
          <blockquote>
              <p>Lot’s of people flame detours.  They prefer IAT/EAT patching instead. Maybe it’s because I am a noob. <img src="https://forum.moparisthebest.com/images/emoji/twitter/frowning.png?v=6" title=":frowning:" class="emoji" alt=":frowning:"><br>
Btw: If you want to learn advanced hooking goto: <a href="http://gamedeception.net" rel="nofollow noopener">gamedeception.net</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/2</link>
        <pubDate>Thu, 21 Jun 2007 22:45:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-2</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
      <item>
        <title>[C++] Winsock Hook</title>
        <dc:creator><![CDATA[@nade nade]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nade">@nade</a> wrote:</p>
          <blockquote>
              <p>I don’t know if by posting this, it will actually help somebody.</p>
<p>Anyways you need detours for this:<br>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <a href="https://www.microsoft.com/en-us/research/project/detours/?from=http%3A%2F%2Fresearch.microsoft.com%2Fsn%2Fdetours%2F" target="_blank" rel="nofollow noopener">Microsoft Research</a>
  </header>
  <article class="onebox-body">
    <div class="aspect-image" style="--aspect-ratio:690/360;"><img src="https://www.microsoft.com/en-us/research/uploads/prod/2018/11/Automated_Hero_Image_MSR_Social_11_2018_1200x627.png" class="thumbnail"></div>

<h3><a href="https://www.microsoft.com/en-us/research/project/detours/?from=http%3A%2F%2Fresearch.microsoft.com%2Fsn%2Fdetours%2F" target="_blank" rel="nofollow noopener">Detours - Microsoft Research</a></h3>

<p>Detours is a software package for re-routing Win32 APIs underneath applications. For almost twenty years, has been licensed by hundreds of ISVs and used by nearly every product team at Microsoft. What’s New? Detours 4.0.1 is now open source under the...</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
<p>If you hook something like Firefox, beware of the 40 message boxes you will receive. With hooking Winsock you are able to change the packet before the program has the ability to analyze it.</p>
<p>You should probably make it write to a file or something else more efficient than using MessageBox.</p>
<pre><code class="lang-auto">#include "stdafx.h"
#include &lt;detours.h&gt;
#include &lt;Winsock2.h&gt;


#pragma comment(lib, "wsock32")


DETOUR_TRAMPOLINE(int WINAPI Real_recv(SOCKET a0, char* a1, int a2, int a3), recv);
int WINAPI custom_recv(SOCKET sock, char FAR* buf, int len, int flags);

BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved)
{
        if ( reason == DLL_PROCESS_ATTACH )
        {
			DetourFunctionWithTrampoline((PBYTE)Real_recv,(PBYTE)custom_recv);;
        }
        else if ( reason == DLL_PROCESS_DETACH )
        {
			DetourRemove((PBYTE)Real_recv,(PBYTE)custom_recv);
        }    
        return true;
}

int WINAPI custom_recv(SOCKET sock, char FAR* buf, int len, int flags)
{

	MessageBox(NULL, buf, NULL, NULL);
	//buf = "4"; //Change data before the program can read it
	return Real_recv(sock, buf, len, flags);
}</code></pre>
<p>Injector to use after you compile this DLL:<br>
WinJect: <a href="http://rapidshare.com/files/38425070/Winject.zip" rel="nofollow noopener">http://rapidshare.com/files/38425070/Winject.zip</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/c-winsock-hook/114261/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/c-winsock-hook/114261/1</link>
        <pubDate>Thu, 21 Jun 2007 05:02:19 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-114261-1</guid>
        <source url="https://forum.moparisthebest.com/t/c-winsock-hook/114261.rss">[C++] Winsock Hook</source>
      </item>
  </channel>
</rss>
