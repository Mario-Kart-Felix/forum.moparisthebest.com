<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Reading and Writing NPC Combat data to and from an XML file</title>
    <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870</link>
    <description>This tutorial will teach you how to store NPC combat data in an XML file using XStream. The combat data that this file will store is:

[ul][li]The NPC&#39;s type (The ID of the NPC e.g. a Man&#39;s ID is 1).[/li]
[li]The ID of the NPC&#39;s maximum hit.[/li]
[li]The ID of the NPC&#39;s attacking animation.[/li]
[li]The ID of the NPC&#39;s blocking animation.[/li]
[li]The ID of the NPC&#39;s death animation.[/li][/ul]


It is fairly easy to enable this file to store, read and write more data; this will be explained towards the end of the tutorial. 
You will need to save as &quot;NPCCombatData.xml&quot;, into a &quot;data&quot; folder in your server files.

[code]&lt;list&gt;
        &lt;npcCombatData&gt;
                &lt;npcID&gt;1&lt;/npcID&gt;
                &lt;maxHit&gt;1&lt;/maxHit&gt;
                &lt;attackAnimation&gt;422&lt;/attackAnimation&gt;
                &lt;blockAnimation&gt;424&lt;/blockAnimation&gt;
                &lt;deathAnimation&gt;836&lt;/deathAnimation&gt;
        &lt;/npcCombatData&gt;
&lt;/list&gt;[/code]

The &lt;list&gt; tag is used because we will be adding instances of the class that this data is contained in, to a List.
The other tags/elements are self explanatory.
To create a new element list we simple add another:
[code]        &lt;npcCombatData&gt;
                // Elements here.
        &lt;/npcCombatData&gt;[/code]

[u][b]Step 1: Downloading and adding the XStream jar library to your server.[/b][/u]

You will need to download [url=http://repository.codehaus.org/com/thoughtworks/xstream/xstream/1.3.1/xstream-1.3.1.jar]this[/url] file (The external jar library for XStream) and add it to your server files.
If you are using an IDE, you can simply use the &quot;Add External JARs&quot; option to add this into your project files.
However, if you are not (Most people don&#39;t use IDEs) then you will need to place it into a new folder named &quot;deps&quot;, in your server&#39;s default package.

If you aren&#39;t using an IDE then you will need to replace this line in your server&#39;s &quot;run&quot; batch file:
[code]java -Xmx1024m -cp .; server[/code]

With this:
[code]java -Xmx1024m -cp .;deps/xstream-1.3.1.jar server[/code]

[u][b]Step 2: Creating the classes required for loading, writing and storing the NPCs&#39; combat data.[/b][/u]

If you do not wish to read this step, where I explain both the classes, then skip straight to step 3. However I recommend you do read this step if you wish to actually know what these classes do, instead of just copy and pasting them into your server without any acknowledgment of what they do.

We will be using two classes in this tutorial - You will need to modify the packaging to work with your server&#39;s structure.

1) The NPCCombatData class - This will be used to store data from the XML file. It will also load data from the file and add it into instances of the class, which will then be added to a List.
2) The XStreamUtil class - This will be used to alias the NPCCombatData class for use with the XML file.

The NPCCombatData class:
[code=java]package net.iClarity.model.npc;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import net.iClarity.util.XStreamUtil;

/**
 * Loads and contains NPC combat data.
 * @author Primadude.
 */
public class NPCCombatData {

	private static Map&lt;Integer, NPCCombatData&gt; combatData;
	
	@SuppressWarnings(&quot;unchecked&quot;)
        public static void loadCombatData() throws FileNotFoundException {
        	List&lt;NPCCombatData&gt; list = (List&lt;NPCCombatData&gt;) XStreamUtil.getXStream().fromXML(new FileInputStream(&quot;data/NPCCombatData.xml&quot;));
		combatData = new HashMap&lt;Integer, NPCCombatData&gt;();
		for (NPCCombatData data : list) {
			combatData.put(data.getNpcID(), data);
		}
        }
	
	private int npcID;
	private int maxHit;
	private int attackAnimation;
	private int blockAnimation;
	private int deathAnimation;

	public int getNpcID() {
		return npcID;
	}
	
        public int getMaxHit() {
                return maxHit;
        }

        public int getAttackAnimation() {
                return attackAnimation;
        }

        public int getBlockAnimation() {
                return blockAnimation;
        }

        public int getDeathAnimation() {
                return deathAnimation;
        }
        
        public static NPCCombatData get(int id) {
        	return combatData.get(id);
        }
        
        public NPCCombatData(int npcID, int maxHit, int attackAnimation, int blockAnimation, int deathAnimation) {
        	this.npcID = npcID;
        	this.maxHit = maxHit;
        	this.attackAnimation = attackAnimation;
        	this.blockAnimation = blockAnimation;
        	this.deathAnimation = deathAnimation;
        }
}[/code]

Let me explain this class.

The first thing we see is the packaging and the imports. Simple enough; you should be familiar with these and know what they are for.

After the class Declaration, we see our first object - The &quot;combatData&quot; Map.
[code]private static Map&lt;Integer, NPCCombatData&gt; combatData;[/code]

This is used to store the ID of the NPC and an instance of it&#39;s combat data class.

Next we see the first method:
[code]        @SuppressWarnings(&quot;unchecked&quot;)
        public static void loadCombatData() throws FileNotFoundException {
        	List&lt;NPCCombatData&gt; list = (List&lt;NPCCombatData&gt;) XStreamUtil.getXStream().fromXML(new FileInputStream(&quot;data/NPCCombatData.xml&quot;));
		combatData = new HashMap&lt;Integer, NPCCombatData&gt;();
		for (NPCCombatData data : list) {
			combatData.put(data.getNpcID(), data);
		}
        }[/code]

This method loads the combat data into different instances of this class, using a List and a Map. The ID of the NPC and an instance of it&#39;s class is put into the Map. The instance of the class will contain all of the data loaded from the XML file; the maxHit, animations etc.

Next we see our variables and get() methods:
[code]        private int npcID;
        private int maxHit;
        private int attackAnimation;
        private int blockAnimation;
        private int deathAnimation;

        public int getNpcID() {
                return npcID;
        }
        
        public int getMaxHit() {
                return maxHit;
        }

        public int getAttackAnimation() {
                return attackAnimation;
        }

        public int getBlockAnimation() {
                return blockAnimation;
        }

        public int getDeathAnimation() {
                return deathAnimation;
        }[/code]

The variables will be equal to whatever they are in the XML file (for the NPC ID that is loaded). The get() methods are there for getting the variables&#39; values from outside of this class, since the variables have the private modifier (This follows conventions).

Next, there is the get(int id) method:
[code]        public static NPCCombatData get(int id) {
                return combatData.get(id);
        }[/code]

This method returns an instance of the NPCCombatData class for the ID of an NPC. When the data is loaded with the &quot;loadCombatData()&quot; method the instances and NPC ID are put into the map; the instance is then gotten back as and returned in this method (If the combatData map contains the ID that the method is requesting).

The final method is a Constructor to create a new instance of the class that sets all of the variables within it:
[code]        public NPCCombatData(int npcID, int maxHit, int attackAnimation, int blockAnimation, int deathAnimation) {
        	this.npcID = npcID;
        	this.maxHit = maxHit;
        	this.attackAnimation = attackAnimation;
        	this.blockAnimation = blockAnimation;
        	this.deathAnimation = deathAnimation;
        }[/code]

This will be used later on in the tutorial.


The XStreamUtil class:
[code=java]package net.iClarity.util;

import net.iClarity.model.npc.NPCCombatDefinitions;

import com.thoughtworks.xstream.XStream;
import com.thoughtworks.xstream.io.xml.DomDriver;

/**
 * Aliases the classes to the XML files that they are loading.
 * @author Primadude.
 */
public class XStreamUtil {
	
	private static XStream xstream = null;
	
	public static XStream getXStream() {
		return xstream;
	}
	
	public static void initializeXStream() {
		if (getXStream() == null) {
			xstream = new XStream(new DomDriver());
			xstream.alias(&quot;npcCombatData&quot;, NPCCombatDefinitions.class);
		}
	}

}[/code]

This class is simple. It contains an XStream instance (Which is equal to &#39;null&#39; currently&#39;), a get() method to return the XStream instance and a method to alias the classes that use XML files.
[code]xstream = new XStream(new DomDriver());[/code]

&#39;DomDriver&#39; is the standard XML parser for XStream.


[u][b]Step 3: Aliasing the NPCCombatData class and loading the data from the XML file.[/b][/u]

We now need to alias the NPCCombatData class to the XML file that it&#39;s loading data from, and actually load the data.

You can do this by, in your &#39;main&#39; method in the class that the server runs on start-up (most likely &#39;Server.java&#39;), calling these:
[code]try {
        XStreamUtil.initializeXStream();
        NPCCombatDefinitions.loadCombatDefinitions();
} catch (Exception exception) {
        System.out.println(&quot;Exception caught whilst loading XML data:&quot;);
        exception.printStackTrace();
}[/code]

If necessary, you will need to import these classes. I do not know your server structure so you will have to do this yourself.

You can now get data from your NPCCombatData class. You can do this by using these methods:
[code]NPCCombatData.get(npcID).getNpcID();
NPCCombatData.get(npcID).getMaxHit();
NPCCombatData.get(npcID).getAttackAnimation();
NPCCombatData.get(npcID).getBlockAnimation();
NPCCombatData.get(npcID).getDeathAnimation();[/code]

Obviously, replace &quot;npcID&quot; with the ID of the NPC that you want to get the data for (You must have entered the data into the NPCCombatData XML file to get this data).

[u][b]Step 4: Adding more data to the XML file[/b][/u]

You can either do this step manually, by creating another element list containing the elements:
[code]        &lt;npcCombatData&gt;
                &lt;npcID&gt;0&lt;/npcID&gt;
                &lt;maxHit&gt;0&lt;/maxHit&gt;
                &lt;attackAnimation&gt;0&lt;/attackAnimation&gt;
                &lt;blockAnimation&gt;0&lt;/blockAnimation&gt;
                &lt;deathAnimation&gt;0&lt;/deathAnimation&gt;
        &lt;/npcCombatData&gt;[/code]

You can do this via your server by using the constructor in the NPCCombatData class and converting it to XML form.
[code]NPCCombatData npcCombatData = new NPCCombatData(npcID, maxHit, attackAnim, blockAnim, deathAnim);
XStreamUtil.getXStream().toXML(npcCombatData);[/code]

Then writing this to the xml file.


To Summarize:

[ul][li]If you want to create another XML file for loading, simply create a file similar to NPCCombatData. The variables in the class and the tag names in the XML file MUST match otherwise an exception will be thown. You must also alias the class to the XML file by adding &quot;xstream.alias(&quot;tagname&quot;, ClassName.class);&quot; in the initializeXStream() method in the XStream util class.[/li]
[li]You can use the NPCCombatData.get(npcID).getMaxHit() etc. methods to get the data that has been loaded from the XML file.[/li]
[li]You can add data to your xml file using step 4, and possibly create a command or separate program for ease.[/li][/ul]


Thanks for using/reading this tutorial; if you have any problems at all, either post a reply here or PM me for help ;).</description>
    
    <lastBuildDate>Sun, 19 Sep 2010 23:38:00 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@the_elve_age the elve age]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_elve_age">@the_elve_age</a> wrote:</p>
          <blockquote>
              <p>Very nice, I might be using this for my Rs377d.</p>
<p>I know its a bump/gravedig, but this is a very helpful/legit topic.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/11</link>
        <pubDate>Sun, 19 Sep 2010 23:38:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-11</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@justinxg27 justinxg27]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/justinxg27">@justinxg27</a> wrote:</p>
          <blockquote>
              <p>Wow man, very nice <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/10</link>
        <pubDate>Thu, 29 Jul 2010 03:57:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-10</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="7" data-topic="349870">
<div class="title">
<div class="quote-controls"></div>
 The Soul:</div>
<blockquote>
<p>Hopefully this will help people actually learn to parse more things from files rather than using arrays and whatnot to store everything. Good job. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</blockquote>
</aside>
<p>Arrays are faster than Maps (Only by a very slight benchmark, though), however Maps are much more easier to use and can be used with a wider variety of things, hence why I used it here ;).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/9</link>
        <pubDate>Thu, 29 Jul 2010 01:18:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-9</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@pure2ownage Pure_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pure2ownage">@pure2ownage</a> wrote:</p>
          <blockquote>
              <p>Nice, will help us get better servers in the forseeable future <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/8</link>
        <pubDate>Mon, 19 Jul 2010 15:46:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-8</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@the_soul The Soul]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_soul">@the_soul</a> wrote:</p>
          <blockquote>
              <p>Hopefully this will help people actually learn to parse more things from files rather than using arrays and whatnot to store everything. Good job. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/7</link>
        <pubDate>Mon, 19 Jul 2010 14:45:46 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-7</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>[quote=“recker450, post:5, topic:349870”]how bout jad?<br>
he use range,mage,and melee[/quote]</p>
<p>Just simply add two other elements into the xml file for his ranged and magic attack animations (Make sure you create the variables to go with it in the NPCCombatData class).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/6</link>
        <pubDate>Mon, 19 Jul 2010 14:23:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-6</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@recker450 recker450]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/recker450">@recker450</a> wrote:</p>
          <blockquote>
              <p>how bout jad?<br>
he use range,mage,and melee</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/5</link>
        <pubDate>Mon, 19 Jul 2010 14:15:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-5</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@The_Reaper_X The Reaper X]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_reaper_x">@The_Reaper_X</a> wrote:</p>
          <blockquote>
              <p>Impressive. I see you’re moving forward, as always Prima <img src="https://forum.moparisthebest.com/images/emoji/twitter/wink.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/4</link>
        <pubDate>Sun, 18 Jul 2010 21:14:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-4</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@PvPTurf PvPTurf]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pvpturf">@PvPTurf</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="2" data-topic="349870">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/haxafer/40/5_513041d5f7104045db30895d3b90af16.png" class="avatar"> Haxafer:</div>
<blockquote>
<p>pretty epic tbh <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</blockquote>
</aside>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/3</link>
        <pubDate>Sun, 18 Jul 2010 21:09:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-3</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@Haxafer Haxafer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/haxafer">@Haxafer</a> wrote:</p>
          <blockquote>
              <p>pretty epic tbh <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/2</link>
        <pubDate>Sun, 18 Jul 2010 20:28:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-2</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
      <item>
        <title>Reading and Writing NPC Combat data to and from an XML file</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>This tutorial will teach you how to store NPC combat data in an XML file using XStream. The combat data that this file will store is:</p>
<p>[ul][li]The NPC’s type (The ID of the NPC e.g. a Man’s ID is 1).[/li]<br>
[li]The ID of the NPC’s maximum hit.[/li]<br>
[li]The ID of the NPC’s attacking animation.[/li]<br>
[li]The ID of the NPC’s blocking animation.[/li]<br>
[li]The ID of the NPC’s death animation.[/li][/ul]</p>
<p>It is fairly easy to enable this file to store, read and write more data; this will be explained towards the end of the tutorial.<br>
You will need to save as “NPCCombatData.xml”, into a “data” folder in your server files.</p>
<p><code>&lt;list&gt;
        &lt;npcCombatData&gt;
                &lt;npcID&gt;1&lt;/npcID&gt;
                &lt;maxHit&gt;1&lt;/maxHit&gt;
                &lt;attackAnimation&gt;422&lt;/attackAnimation&gt;
                &lt;blockAnimation&gt;424&lt;/blockAnimation&gt;
                &lt;deathAnimation&gt;836&lt;/deathAnimation&gt;
        &lt;/npcCombatData&gt;
&lt;/list&gt;</code></p>
<p>The  tag is used because we will be adding instances of the class that this data is contained in, to a List.<br>
The other tags/elements are self explanatory.<br>
To create a new element list we simple add another:</p>
<p><code>        &lt;npcCombatData&gt;
                // Elements here.
        &lt;/npcCombatData&gt;</code></p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 1: Downloading and adding the XStream jar library to your server.</span></span></p>
<p>You will need to download <a href="http://repository.codehaus.org/com/thoughtworks/xstream/xstream/1.3.1/xstream-1.3.1.jar" data-bbcode="true" rel="nofollow noopener">this</a> file (The external jar library for XStream) and add it to your server files.<br>
If you are using an IDE, you can simply use the “Add External JARs” option to add this into your project files.<br>
However, if you are not (Most people don’t use IDEs) then you will need to place it into a new folder named “deps”, in your server’s default package.</p>
<p>If you aren’t using an IDE then you will need to replace this line in your server’s “run” batch file:</p>
<pre><code class="lang-auto">java -Xmx1024m -cp .; server</code></pre>
<p>With this:</p>
<pre><code class="lang-auto">java -Xmx1024m -cp .;deps/xstream-1.3.1.jar server</code></pre>
<p><span class="bbcode-u"><span class="bbcode-b">Step 2: Creating the classes required for loading, writing and storing the NPCs’ combat data.</span></span></p>
<p>If you do not wish to read this step, where I explain both the classes, then skip straight to step 3. However I recommend you do read this step if you wish to actually know what these classes do, instead of just copy and pasting them into your server without any acknowledgment of what they do.</p>
<p>We will be using two classes in this tutorial - You will need to modify the packaging to work with your server’s structure.</p>
<ol>
<li>The NPCCombatData class - This will be used to store data from the XML file. It will also load data from the file and add it into instances of the class, which will then be added to a List.</li>
<li>The XStreamUtil class - This will be used to alias the NPCCombatData class for use with the XML file.</li>
</ol>
<p>The NPCCombatData class:</p>
<p>[code=java]package net.iClarity.model.npc;</p>
<p>import java.io.FileInputStream;<br>
import java.io.FileNotFoundException;<br>
import java.util.HashMap;<br>
import java.util.List;<br>
import java.util.Map;</p>
<p>import net.iClarity.util.XStreamUtil;</p>
<p>/**</p>
<ul>
<li>
<p>Loads and contains NPC combat data.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public class NPCCombatData {</p>
<p>private static Map&lt;Integer, NPCCombatData&gt; combatData;</p>
<p><span class="mention">@SuppressWarnings</span>(“unchecked”)<br>
public static void loadCombatData() throws FileNotFoundException {<br>
List list = (List) XStreamUtil.getXStream().fromXML(new FileInputStream(“data/NPCCombatData.xml”));<br>
combatData = new HashMap&lt;Integer, NPCCombatData&gt;();<br>
for (NPCCombatData data : list) {<br>
combatData.put(data.getNpcID(), data);<br>
}<br>
}</p>
<p>private int npcID;<br>
private int maxHit;<br>
private int attackAnimation;<br>
private int blockAnimation;<br>
private int deathAnimation;</p>
<p>public int getNpcID() {<br>
return npcID;<br>
}</p>
<pre><code> public int getMaxHit() {
         return maxHit;
 }

 public int getAttackAnimation() {
         return attackAnimation;
 }

 public int getBlockAnimation() {
         return blockAnimation;
 }

 public int getDeathAnimation() {
         return deathAnimation;
 }
 
 public static NPCCombatData get(int id) {
 	return combatData.get(id);
 }
 
 public NPCCombatData(int npcID, int maxHit, int attackAnimation, int blockAnimation, int deathAnimation) {
 	this.npcID = npcID;
 	this.maxHit = maxHit;
 	this.attackAnimation = attackAnimation;
 	this.blockAnimation = blockAnimation;
 	this.deathAnimation = deathAnimation;
 }
</code></pre>
</li>
</ul>
<p>}[/code]</p>
<p>Let me explain this class.</p>
<p>The first thing we see is the packaging and the imports. Simple enough; you should be familiar with these and know what they are for.</p>
<p>After the class Declaration, we see our first object - The “combatData” Map.</p>
<pre><code class="lang-auto">private static Map&lt;Integer, NPCCombatData&gt; combatData;</code></pre>
<p>This is used to store the ID of the NPC and an instance of it’s combat data class.</p>
<p>Next we see the first method:</p>
<p><code>        @SuppressWarnings("unchecked")
        public static void loadCombatData() throws FileNotFoundException {
        	List&lt;NPCCombatData&gt; list = (List&lt;NPCCombatData&gt;) XStreamUtil.getXStream().fromXML(new FileInputStream("data/NPCCombatData.xml"));
		combatData = new HashMap&lt;Integer, NPCCombatData&gt;();
		for (NPCCombatData data : list) {
			combatData.put(data.getNpcID(), data);
		}
        }</code></p>
<p>This method loads the combat data into different instances of this class, using a List and a Map. The ID of the NPC and an instance of it’s class is put into the Map. The instance of the class will contain all of the data loaded from the XML file; the maxHit, animations etc.</p>
<p>Next we see our variables and get() methods:</p>
<p>[code]        private int npcID;<br>
private int maxHit;<br>
private int attackAnimation;<br>
private int blockAnimation;<br>
private int deathAnimation;</p>
<pre><code>    public int getNpcID() {
            return npcID;
    }
    
    public int getMaxHit() {
            return maxHit;
    }

    public int getAttackAnimation() {
            return attackAnimation;
    }

    public int getBlockAnimation() {
            return blockAnimation;
    }

    public int getDeathAnimation() {
            return deathAnimation;
    }[/code]
</code></pre>
<p>The variables will be equal to whatever they are in the XML file (for the NPC ID that is loaded). The get() methods are there for getting the variables’ values from outside of this class, since the variables have the private modifier (This follows conventions).</p>
<p>Next, there is the get(int id) method:</p>
<p><code>        public static NPCCombatData get(int id) {
                return combatData.get(id);
        }</code></p>
<p>This method returns an instance of the NPCCombatData class for the ID of an NPC. When the data is loaded with the “loadCombatData()” method the instances and NPC ID are put into the map; the instance is then gotten back as and returned in this method (If the combatData map contains the ID that the method is requesting).</p>
<p>The final method is a Constructor to create a new instance of the class that sets all of the variables within it:</p>
<p><code>        public NPCCombatData(int npcID, int maxHit, int attackAnimation, int blockAnimation, int deathAnimation) {
        	this.npcID = npcID;
        	this.maxHit = maxHit;
        	this.attackAnimation = attackAnimation;
        	this.blockAnimation = blockAnimation;
        	this.deathAnimation = deathAnimation;
        }</code></p>
<p>This will be used later on in the tutorial.</p>
<p>The XStreamUtil class:</p>
<p>[code=java]package net.iClarity.util;</p>
<p>import net.iClarity.model.npc.NPCCombatDefinitions;</p>
<p>import com.thoughtworks.xstream.XStream;<br>
import com.thoughtworks.xstream.io.xml.DomDriver;</p>
<p>/**</p>
<ul>
<li>
<p>Aliases the classes to the XML files that they are loading.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public class XStreamUtil {</p>
<p>private static XStream xstream = null;</p>
<p>public static XStream getXStream() {<br>
return xstream;<br>
}</p>
<p>public static void initializeXStream() {<br>
if (getXStream() == null) {<br>
xstream = new XStream(new DomDriver());<br>
xstream.alias(“npcCombatData”, NPCCombatDefinitions.class);<br>
}<br>
}</p>
</li>
</ul>
<p>}[/code]</p>
<p>This class is simple. It contains an XStream instance (Which is equal to ‘null’ currently’), a get() method to return the XStream instance and a method to alias the classes that use XML files.</p>
<pre><code class="lang-auto">xstream = new XStream(new DomDriver());</code></pre>
<p>‘DomDriver’ is the standard XML parser for XStream.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 3: Aliasing the NPCCombatData class and loading the data from the XML file.</span></span></p>
<p>We now need to alias the NPCCombatData class to the XML file that it’s loading data from, and actually load the data.</p>
<p>You can do this by, in your ‘main’ method in the class that the server runs on start-up (most likely ‘Server.java’), calling these:</p>
<p><code>try {
        XStreamUtil.initializeXStream();
        NPCCombatDefinitions.loadCombatDefinitions();
} catch (Exception exception) {
        System.out.println("Exception caught whilst loading XML data:");
        exception.printStackTrace();
}</code></p>
<p>If necessary, you will need to import these classes. I do not know your server structure so you will have to do this yourself.</p>
<p>You can now get data from your NPCCombatData class. You can do this by using these methods:</p>
<p><code>NPCCombatData.get(npcID).getNpcID();
NPCCombatData.get(npcID).getMaxHit();
NPCCombatData.get(npcID).getAttackAnimation();
NPCCombatData.get(npcID).getBlockAnimation();
NPCCombatData.get(npcID).getDeathAnimation();</code></p>
<p>Obviously, replace “npcID” with the ID of the NPC that you want to get the data for (You must have entered the data into the NPCCombatData XML file to get this data).</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 4: Adding more data to the XML file</span></span></p>
<p>You can either do this step manually, by creating another element list containing the elements:</p>
<p><code>        &lt;npcCombatData&gt;
                &lt;npcID&gt;0&lt;/npcID&gt;
                &lt;maxHit&gt;0&lt;/maxHit&gt;
                &lt;attackAnimation&gt;0&lt;/attackAnimation&gt;
                &lt;blockAnimation&gt;0&lt;/blockAnimation&gt;
                &lt;deathAnimation&gt;0&lt;/deathAnimation&gt;
        &lt;/npcCombatData&gt;</code></p>
<p>You can do this via your server by using the constructor in the NPCCombatData class and converting it to XML form.</p>
<p><code>NPCCombatData npcCombatData = new NPCCombatData(npcID, maxHit, attackAnim, blockAnim, deathAnim);
XStreamUtil.getXStream().toXML(npcCombatData);</code></p>
<p>Then writing this to the xml file.</p>
<p>To Summarize:</p>
<p>[ul][li]If you want to create another XML file for loading, simply create a file similar to NPCCombatData. The variables in the class and the tag names in the XML file MUST match otherwise an exception will be thown. You must also alias the class to the XML file by adding “xstream.alias(“tagname”, ClassName.class);” in the initializeXStream() method in the XStream util class.[/li]<br>
[li]You can use the NPCCombatData.get(npcID).getMaxHit() etc. methods to get the data that has been loaded from the XML file.[/li]<br>
[li]You can add data to your xml file using step 4, and possibly create a command or separate program for ease.[/li][/ul]</p>
<p>Thanks for using/reading this tutorial; if you have any problems at all, either post a reply here or PM me for help ;).</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870/1</link>
        <pubDate>Sun, 18 Jul 2010 18:37:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-349870-1</guid>
        <source url="https://forum.moparisthebest.com/t/reading-and-writing-npc-combat-data-to-and-from-an-xml-file/349870.rss">Reading and Writing NPC Combat data to and from an XML file</source>
      </item>
  </channel>
</rss>
