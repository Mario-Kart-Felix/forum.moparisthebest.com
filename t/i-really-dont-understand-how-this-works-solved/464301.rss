<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>I really don&#39;t understand how this works.. [SOLVED]</title>
    <link>https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301</link>
    <description>Well, in the base im using (rs-474) I&#39;ve been trying to add bosses like existing ones, the existing ones added work fine, but when I try and add new ones, it just doesn&#39;t work, so I decided to do some research, to find how the boss classes are linked to the actual npc entity/id I decided to look through the files that making bosses via instances possible, and came across this...


[code]case CUSTOM:
						String packageName = &quot;org.rs2server.rs2.model.combat.npcs.&quot;;
						File[] files = new File(&quot;./data/npcs/&quot;).listFiles();
						for (File f : files) {
							if (!f.getName().endsWith(&quot;.class&quot;)) {
								continue;
							}
							String fileName = packageName + f.getName().substring(0, f.getName().length() - 6);
							String requiredName = packageName + NameUtils.formatName(NPCDefinition.forId(i).getName()).replace(&quot; &quot;, &quot;&quot;).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&quot;`&quot;,&quot;&quot;);
							if (!fileName.equals(requiredName)) {
								continue;
							}
							Class&lt;?&gt; fileClass = Class.forName(fileName);
							if (fileClass.getSuperclass() != AbstractCombatAction.class) {
								continue;
							}
							AbstractCombatAction combatAction = (AbstractCombatAction) fileClass.newInstance();
							def.setCombatAction(combatAction);
						}
						break;
					}
				}
				logger.info(&quot;Loaded &quot; + definitions.size() + &quot; combat NPC definitions.&quot;);
			} else {
				logger.info(&quot;NPC combat definitions not found!&quot;);
			}
		} catch (Exception e) {
			e.printStackTrace();[/code]
The CUSTOM at the top is an attack type for the xml file defining npc combat, and setting it to custom will make it read definitions from the folder containing the boss classes, and for it to be read, the format should contain no spaces, no &#39;, no ` and they should be replaced with no space. But what I don&#39;t seem to understand, is some of the bosses have names that are shared by other npcs, which are defined in an bin file, like for example in real runescape one of those npcs would be used for talking, and for example later in the quest they would be used to fight, and would then have the same name, my question is how does it know which one to get?.. I looked inside the boss files there seems to be no clarification that it finds out from there, and when I name an npc (for example Delrith) which does not share a name afaik, it does not work, even though I declare the attack type CUSTOM in the npc combat definitions xml file.

Of course, that code i posted is not the whole method, and I will post the rest if it is needed and other code if I find anything out.</description>
    
    <lastBuildDate>Wed, 17 Oct 2012 21:51:51 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>I really don&#39;t understand how this works.. [SOLVED]</title>
        <dc:creator><![CDATA[@xVhincex xVhincex]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xvhincex">@xVhincex</a> wrote:</p>
          <blockquote>
              <p>[quote=“drubrkletern, post:3, topic:464301”][quote author=xVhincex link=topic=568191.msg4125754#msg4125754 date=1350368715]<br>
I’m using the exact base as you  <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>I’ll try my best to explain</p>
<p>What that code does is simply loads class files within the specific directory (bin/org/hyperion/rs2/model/combat/npcs/) and applies it to a custom NPC<br>
pardon my english<br>
so like look:</p>
<p>I’ll show you on how to add KBD (since it wasn’t added in Rs2)</p>
<p>I didn’t touch mine so this is how it looks:</p>
<p><code>                        case CUSTOM:
                            String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();
                            for (File f : files) {
                                if (!f.getName().endsWith(".class")) {
                                    continue;
                                }
                                String fileName = packageName + f.getName().substring(0, f.getName().length() - 6);
                                String requiredName = packageName + NameUtils.formatName(NPCDefinition.forId(i).getName()).replace(" ", "");
                                if (!fileName.equals(requiredName)) {
                                    continue;
                                }
                                Class&lt;?&gt; fileClass = Class.forName(fileName);
                                if (fileClass.getSuperclass() != AbstractCombatAction.class) {
                                    continue;
                                }
                                AbstractCombatAction combatAction = (AbstractCombatAction) fileClass.newInstance();
                                def.setCombatAction(combatAction);
                            }
                            break;</code></p>
<p>Just look at the code, replace it with your current</p>
<p>Right here shows where it loads the <span class="bbcode-i">CUSTOM</span> NPC file for it</p>
<p><code>String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();</code></p>
<p>in <span class="bbcode-b">npcCombatDefinitions.xml</span> add</p>
<p><code>&lt;entry&gt;
        &lt;int&gt;50&lt;/int&gt;
        &lt;CombatDefinition&gt;
            &lt;maxHit&gt;73&lt;/maxHit&gt;
            &lt;combatCooldownDelay&gt;5&lt;/combatCooldownDelay&gt;
            &lt;respawnTicks&gt;400&lt;/respawnTicks&gt;
            &lt;aggressive&gt;true&lt;/aggressive&gt;
            &lt;attack&gt;
                &lt;id&gt;80&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/attack&gt;
            &lt;defend&gt;
                &lt;id&gt;90&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/defend&gt;
            &lt;death&gt;
                &lt;id&gt;92&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/death&gt;
            &lt;attackType&gt;CRUSH&lt;/attackType&gt;
            &lt;combatStyle&gt;ACCURATE&lt;/combatStyle&gt;
            &lt;combatActionType&gt;CUSTOM&lt;/combatActionType&gt;
            &lt;skills&gt;
                &lt;entry&gt;
                    &lt;skill&gt;ATTACK&lt;/skill&gt;
                    &lt;int&gt;210&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;DEFENCE&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;MAGIC&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;HITPOINTS&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
            &lt;/skills&gt;
            &lt;bonuses&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
            &lt;/bonuses&gt;
            &lt;constantDrops&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.0&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;536&lt;/id&gt;
                        &lt;count&gt;1&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.5&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;995&lt;/id&gt;
                        &lt;count&gt;5234&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
            &lt;/constantDrops&gt;
            &lt;randomDrops/&gt;
        &lt;/CombatDefinition&gt;
    &lt;/entry&gt;</code></p>
<p>Where you see</p>
<pre><code class="lang-auto"></code></pre>
<p>means it’s <span class="bbcode-b">custom</span>, so therefore it has it’s own class to it under it’s name.</p>
<p>Remember, it loads it from:</p>
<pre><code class="lang-auto"></code></pre>
<p>So, go make a class file called <span class="bbcode-b">KingBlackDragon.java</span> in <span class="bbcode-i">org.hyperion.rs2.model.combat.npcs</span></p>
<p>it HAS to be named that, for any custom NPC you must name the class file after the NPC name with no spaces<br>
example:</p>
<p>[quote]Man : Man.java<br>
King Black Dragon : KingBlackDragon.java<br>
White Knight : WhiteKnight.java[/quote]</p>
<p>now, in the <span class="bbcode-b">KingBlackDragon.java</span>, add this</p>
<p>[code]package org.hyperion.rs2.model.combat.npcs;</p>
<p>import org.hyperion.rs2.model.*;<br>
import org.hyperion.rs2.model.combat.CombatAction;<br>
import org.hyperion.rs2.model.combat.CombatFormulae;<br>
import org.hyperion.rs2.model.combat.CombatState;<br>
import org.hyperion.rs2.model.combat.impl.AbstractCombatAction;<br>
import org.hyperion.rs2.model.content.skills.Prayers;<br>
import org.hyperion.rs2.tickable.Tickable;</p>
<p>import java.util.Random;</p>
<p>/**</p>
<ul>
<li>
<p>KBD Data</p>
</li>
<li>
<p>User: warsaw</p>
</li>
<li>
<p>Date: 4/14/12</p>
</li>
<li>
<p>Time: 6:32 PM<br>
*/<br>
public class KingBlackDragon extends AbstractCombatAction {</p>
<p>/**</p>
<ul>
<li>The singleton instance.<br>
*/<br>
private static final KingBlackDragon INSTANCE = new KingBlackDragon();</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the singleton instance.</li>
<li>
</li>
<li>
<a class="mention" href="/u/return">@return</a> The singleton instance.<br>
*/<br>
public static CombatAction getAction() {<br>
return INSTANCE;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>The random number generator.<br>
*/<br>
private final Random random = new Random();</li>
</ul>
<p>/**</p>
<ul>
<li>Default private constructor.<br>
*/<br>
public KingBlackDragon() {</li>
</ul>
<p>}</p>
<p>private enum CombatStyle {<br>
MELEE,</p>
<pre><code> MAGIC
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public void hit(final Mob attacker, final Mob victim) {<br>
super.hit(attacker, victim);</p>
<pre><code> if (!attacker.isNPC()) {
     return; //this should be an NPC!
 }

 NPC npc = (NPC) attacker;

 CombatStyle style = CombatStyle.MAGIC;

 int maxHit;
 int damage;
 int randomHit;
 int hitDelay;
 boolean blockAnimation;
 final int hit;

 if (attacker.getLocation().isWithinDistance(attacker, victim, 2)) {
     switch (random.nextInt(2)) {
         case 0:
             style = CombatStyle.MELEE;
             break;
         case 1:
             style = CombatStyle.MAGIC;
             break;
     }
 }

 switch (style) {
     case MELEE:
         Animation anim = attacker.getAttackAnimation();
         if (random.nextInt(2) == 1) {
             anim = Animation.create(91);
         }
         attacker.playAnimation(anim);

         hitDelay = 1;
         blockAnimation = true;
         maxHit = npc.getCombatDefinition().getMaxHit();
         damage = damage(maxHit, attacker, victim, attacker.getCombatState().getAttackType(), Skills.ATTACK, Prayers.PROTECT_FROM_MELEE, false, false);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         hit = randomHit;
         break;
     default:
     case MAGIC:
         attacker.playAnimation(Animation.create(83));
         attacker.playGraphics(Graphic.create(1, 0, 100));

         hitDelay = 2;
         blockAnimation = false;
         maxHit = 50;
         damage = damage(maxHit, attacker, victim, CombatState.AttackType.MAGIC, Skills.MAGIC, Prayers.PROTECT_FROM_MAGIC, false, true);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         double dragonfireReduction = CombatFormulae.dragonfireReduction(victim);
         if (dragonfireReduction &gt; 0) {
             randomHit -= (randomHit * dragonfireReduction);
             if (randomHit &lt; 0) {
                 randomHit = 0;
             }
         }
         hit = randomHit;
         break;
 }

 attacker.getCombatState().setAttackDelay(4);
 attacker.getCombatState().setSpellDelay(4);

 World.getWorld().submit(new Tickable(hitDelay) {
     @Override
     public void execute() {
         victim.inflictDamage(new Hit(hit), attacker);
         smite(attacker, victim, hit);
         recoil(attacker, victim, hit);
         this.stop();
     }
 });
 vengeance(attacker, victim, hit, 1);

 victim.getActiveCombatAction().defend(attacker, victim, blockAnimation);
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public int distance(Mob attacker) {<br>
return 7;<br>
}<br>
}<br>
[/code]</p>
</li>
</ul>
<p>Make sure it’s in the package as i said above, because it loads it from <code>bin/org/hyperion/rs2/model/combat/npcs/</code></p>
<p>&amp; There you have it, once you go in-game and ::spawn 50 (KBD), you will see it fighting you with what’s shown in the code in <span class="bbcode-b">KingBlackDragon.java</span><br>
[/quote]<br>
I applied the code to my classes, I started getting errors but went looking into it and found that our packages weren’t the same so I fine tuned it to my needing, and it worked, much thanks friend :)[/quote]</p>
<p>anytime</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/4</link>
        <pubDate>Wed, 17 Oct 2012 21:51:51 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-464301-4</guid>
        <source url="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301.rss">I really don&#39;t understand how this works.. [SOLVED]</source>
      </item>
      <item>
        <title>I really don&#39;t understand how this works.. [SOLVED]</title>
        <dc:creator><![CDATA[@drubrkletern drubrkletern]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/drubrkletern">@drubrkletern</a> wrote:</p>
          <blockquote>
              <p>[quote=“xVhincex, post:2, topic:464301”]I’m using the exact base as you  <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>I’ll try my best to explain</p>
<p>What that code does is simply loads class files within the specific directory (bin/org/hyperion/rs2/model/combat/npcs/) and applies it to a custom NPC<br>
pardon my english<br>
so like look:</p>
<p>I’ll show you on how to add KBD (since it wasn’t added in Rs2)</p>
<p>I didn’t touch mine so this is how it looks:</p>
<p><code>                        case CUSTOM:
                            String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();
                            for (File f : files) {
                                if (!f.getName().endsWith(".class")) {
                                    continue;
                                }
                                String fileName = packageName + f.getName().substring(0, f.getName().length() - 6);
                                String requiredName = packageName + NameUtils.formatName(NPCDefinition.forId(i).getName()).replace(" ", "");
                                if (!fileName.equals(requiredName)) {
                                    continue;
                                }
                                Class&lt;?&gt; fileClass = Class.forName(fileName);
                                if (fileClass.getSuperclass() != AbstractCombatAction.class) {
                                    continue;
                                }
                                AbstractCombatAction combatAction = (AbstractCombatAction) fileClass.newInstance();
                                def.setCombatAction(combatAction);
                            }
                            break;</code></p>
<p>Just look at the code, replace it with your current</p>
<p>Right here shows where it loads the <span class="bbcode-i">CUSTOM</span> NPC file for it</p>
<p><code>String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();</code></p>
<p>in <span class="bbcode-b">npcCombatDefinitions.xml</span> add</p>
<p><code>&lt;entry&gt;
        &lt;int&gt;50&lt;/int&gt;
        &lt;CombatDefinition&gt;
            &lt;maxHit&gt;73&lt;/maxHit&gt;
            &lt;combatCooldownDelay&gt;5&lt;/combatCooldownDelay&gt;
            &lt;respawnTicks&gt;400&lt;/respawnTicks&gt;
            &lt;aggressive&gt;true&lt;/aggressive&gt;
            &lt;attack&gt;
                &lt;id&gt;80&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/attack&gt;
            &lt;defend&gt;
                &lt;id&gt;90&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/defend&gt;
            &lt;death&gt;
                &lt;id&gt;92&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/death&gt;
            &lt;attackType&gt;CRUSH&lt;/attackType&gt;
            &lt;combatStyle&gt;ACCURATE&lt;/combatStyle&gt;
            &lt;combatActionType&gt;CUSTOM&lt;/combatActionType&gt;
            &lt;skills&gt;
                &lt;entry&gt;
                    &lt;skill&gt;ATTACK&lt;/skill&gt;
                    &lt;int&gt;210&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;DEFENCE&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;MAGIC&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;HITPOINTS&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
            &lt;/skills&gt;
            &lt;bonuses&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
            &lt;/bonuses&gt;
            &lt;constantDrops&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.0&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;536&lt;/id&gt;
                        &lt;count&gt;1&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.5&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;995&lt;/id&gt;
                        &lt;count&gt;5234&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
            &lt;/constantDrops&gt;
            &lt;randomDrops/&gt;
        &lt;/CombatDefinition&gt;
    &lt;/entry&gt;</code></p>
<p>Where you see</p>
<pre><code class="lang-auto"></code></pre>
<p>means it’s <span class="bbcode-b">custom</span>, so therefore it has it’s own class to it under it’s name.</p>
<p>Remember, it loads it from:</p>
<pre><code class="lang-auto"></code></pre>
<p>So, go make a class file called <span class="bbcode-b">KingBlackDragon.java</span> in <span class="bbcode-i">org.hyperion.rs2.model.combat.npcs</span></p>
<p>it HAS to be named that, for any custom NPC you must name the class file after the NPC name with no spaces<br>
example:</p>
<p>[quote]Man : Man.java<br>
King Black Dragon : KingBlackDragon.java<br>
White Knight : WhiteKnight.java[/quote]</p>
<p>now, in the <span class="bbcode-b">KingBlackDragon.java</span>, add this</p>
<p>[code]package org.hyperion.rs2.model.combat.npcs;</p>
<p>import org.hyperion.rs2.model.*;<br>
import org.hyperion.rs2.model.combat.CombatAction;<br>
import org.hyperion.rs2.model.combat.CombatFormulae;<br>
import org.hyperion.rs2.model.combat.CombatState;<br>
import org.hyperion.rs2.model.combat.impl.AbstractCombatAction;<br>
import org.hyperion.rs2.model.content.skills.Prayers;<br>
import org.hyperion.rs2.tickable.Tickable;</p>
<p>import java.util.Random;</p>
<p>/**</p>
<ul>
<li>
<p>KBD Data</p>
</li>
<li>
<p>User: warsaw</p>
</li>
<li>
<p>Date: 4/14/12</p>
</li>
<li>
<p>Time: 6:32 PM<br>
*/<br>
public class KingBlackDragon extends AbstractCombatAction {</p>
<p>/**</p>
<ul>
<li>The singleton instance.<br>
*/<br>
private static final KingBlackDragon INSTANCE = new KingBlackDragon();</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the singleton instance.</li>
<li>
</li>
<li>
<a class="mention" href="/u/return">@return</a> The singleton instance.<br>
*/<br>
public static CombatAction getAction() {<br>
return INSTANCE;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>The random number generator.<br>
*/<br>
private final Random random = new Random();</li>
</ul>
<p>/**</p>
<ul>
<li>Default private constructor.<br>
*/<br>
public KingBlackDragon() {</li>
</ul>
<p>}</p>
<p>private enum CombatStyle {<br>
MELEE,</p>
<pre><code> MAGIC
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public void hit(final Mob attacker, final Mob victim) {<br>
super.hit(attacker, victim);</p>
<pre><code> if (!attacker.isNPC()) {
     return; //this should be an NPC!
 }

 NPC npc = (NPC) attacker;

 CombatStyle style = CombatStyle.MAGIC;

 int maxHit;
 int damage;
 int randomHit;
 int hitDelay;
 boolean blockAnimation;
 final int hit;

 if (attacker.getLocation().isWithinDistance(attacker, victim, 2)) {
     switch (random.nextInt(2)) {
         case 0:
             style = CombatStyle.MELEE;
             break;
         case 1:
             style = CombatStyle.MAGIC;
             break;
     }
 }

 switch (style) {
     case MELEE:
         Animation anim = attacker.getAttackAnimation();
         if (random.nextInt(2) == 1) {
             anim = Animation.create(91);
         }
         attacker.playAnimation(anim);

         hitDelay = 1;
         blockAnimation = true;
         maxHit = npc.getCombatDefinition().getMaxHit();
         damage = damage(maxHit, attacker, victim, attacker.getCombatState().getAttackType(), Skills.ATTACK, Prayers.PROTECT_FROM_MELEE, false, false);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         hit = randomHit;
         break;
     default:
     case MAGIC:
         attacker.playAnimation(Animation.create(83));
         attacker.playGraphics(Graphic.create(1, 0, 100));

         hitDelay = 2;
         blockAnimation = false;
         maxHit = 50;
         damage = damage(maxHit, attacker, victim, CombatState.AttackType.MAGIC, Skills.MAGIC, Prayers.PROTECT_FROM_MAGIC, false, true);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         double dragonfireReduction = CombatFormulae.dragonfireReduction(victim);
         if (dragonfireReduction &gt; 0) {
             randomHit -= (randomHit * dragonfireReduction);
             if (randomHit &lt; 0) {
                 randomHit = 0;
             }
         }
         hit = randomHit;
         break;
 }

 attacker.getCombatState().setAttackDelay(4);
 attacker.getCombatState().setSpellDelay(4);

 World.getWorld().submit(new Tickable(hitDelay) {
     @Override
     public void execute() {
         victim.inflictDamage(new Hit(hit), attacker);
         smite(attacker, victim, hit);
         recoil(attacker, victim, hit);
         this.stop();
     }
 });
 vengeance(attacker, victim, hit, 1);

 victim.getActiveCombatAction().defend(attacker, victim, blockAnimation);
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public int distance(Mob attacker) {<br>
return 7;<br>
}<br>
}<br>
[/code]</p>
</li>
</ul>
<p>Make sure it’s in the package as i said above, because it loads it from <code>bin/org/hyperion/rs2/model/combat/npcs/</code></p>
<p>&amp; There you have it, once you go in-game and ::spawn 50 (KBD), you will see it fighting you with what’s shown in the code in <span class="bbcode-b">KingBlackDragon.java</span>[/quote]<br>
I applied the code to my classes, I started getting errors but went looking into it and found that our packages weren’t the same so I fine tuned it to my needing, and it worked, much thanks friend <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/3</link>
        <pubDate>Wed, 17 Oct 2012 02:53:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-464301-3</guid>
        <source url="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301.rss">I really don&#39;t understand how this works.. [SOLVED]</source>
      </item>
      <item>
        <title>I really don&#39;t understand how this works.. [SOLVED]</title>
        <dc:creator><![CDATA[@xVhincex xVhincex]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xvhincex">@xVhincex</a> wrote:</p>
          <blockquote>
              <p>I’m using the exact base as you  <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>I’ll try my best to explain</p>
<p>What that code does is simply loads class files within the specific directory (bin/org/hyperion/rs2/model/combat/npcs/) and applies it to a custom NPC<br>
pardon my english<br>
so like look:</p>
<p>I’ll show you on how to add KBD (since it wasn’t added in Rs2)</p>
<p>I didn’t touch mine so this is how it looks:</p>
<p><code>                        case CUSTOM:
                            String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();
                            for (File f : files) {
                                if (!f.getName().endsWith(".class")) {
                                    continue;
                                }
                                String fileName = packageName + f.getName().substring(0, f.getName().length() - 6);
                                String requiredName = packageName + NameUtils.formatName(NPCDefinition.forId(i).getName()).replace(" ", "");
                                if (!fileName.equals(requiredName)) {
                                    continue;
                                }
                                Class&lt;?&gt; fileClass = Class.forName(fileName);
                                if (fileClass.getSuperclass() != AbstractCombatAction.class) {
                                    continue;
                                }
                                AbstractCombatAction combatAction = (AbstractCombatAction) fileClass.newInstance();
                                def.setCombatAction(combatAction);
                            }
                            break;</code></p>
<p>Just look at the code, replace it with your current</p>
<p>Right here shows where it loads the <span class="bbcode-i">CUSTOM</span> NPC file for it</p>
<p><code>String packageName = "org.hyperion.rs2.model.combat.npcs.";
                            File[] files = new File("bin/org/hyperion/rs2/model/combat/npcs/").listFiles();</code></p>
<p>in <span class="bbcode-b">npcCombatDefinitions.xml</span> add</p>
<p><code>&lt;entry&gt;
        &lt;int&gt;50&lt;/int&gt;
        &lt;CombatDefinition&gt;
            &lt;maxHit&gt;73&lt;/maxHit&gt;
            &lt;combatCooldownDelay&gt;5&lt;/combatCooldownDelay&gt;
            &lt;respawnTicks&gt;400&lt;/respawnTicks&gt;
            &lt;aggressive&gt;true&lt;/aggressive&gt;
            &lt;attack&gt;
                &lt;id&gt;80&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/attack&gt;
            &lt;defend&gt;
                &lt;id&gt;90&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/defend&gt;
            &lt;death&gt;
                &lt;id&gt;92&lt;/id&gt;
                &lt;delay&gt;0&lt;/delay&gt;
            &lt;/death&gt;
            &lt;attackType&gt;CRUSH&lt;/attackType&gt;
            &lt;combatStyle&gt;ACCURATE&lt;/combatStyle&gt;
            &lt;combatActionType&gt;CUSTOM&lt;/combatActionType&gt;
            &lt;skills&gt;
                &lt;entry&gt;
                    &lt;skill&gt;ATTACK&lt;/skill&gt;
                    &lt;int&gt;210&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;DEFENCE&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;MAGIC&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;skill&gt;HITPOINTS&lt;/skill&gt;
                    &lt;int&gt;200&lt;/int&gt;
                &lt;/entry&gt;
            &lt;/skills&gt;
            &lt;bonuses&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;200&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;180&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
                &lt;int&gt;0&lt;/int&gt;
            &lt;/bonuses&gt;
            &lt;constantDrops&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.0&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;536&lt;/id&gt;
                        &lt;count&gt;1&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
                &lt;npcdrop&gt;
                    &lt;frequency&gt;1.5&lt;/frequency&gt;
                    &lt;item&gt;
                        &lt;id&gt;995&lt;/id&gt;
                        &lt;count&gt;5234&lt;/count&gt;
                    &lt;/item&gt;
                &lt;/npcdrop&gt;
            &lt;/constantDrops&gt;
            &lt;randomDrops/&gt;
        &lt;/CombatDefinition&gt;
    &lt;/entry&gt;</code></p>
<p>Where you see</p>
<pre><code class="lang-auto"></code></pre>
<p>means it’s <span class="bbcode-b">custom</span>, so therefore it has it’s own class to it under it’s name.</p>
<p>Remember, it loads it from:</p>
<pre><code class="lang-auto"></code></pre>
<p>So, go make a class file called <span class="bbcode-b">KingBlackDragon.java</span> in <span class="bbcode-i">org.hyperion.rs2.model.combat.npcs</span></p>
<p>it HAS to be named that, for any custom NPC you must name the class file after the NPC name with no spaces<br>
example:</p>
<blockquote>Man : Man.java
King Black Dragon : KingBlackDragon.java
White Knight : WhiteKnight.java</blockquote>
<p>now, in the <span class="bbcode-b">KingBlackDragon.java</span>, add this</p>
<p>[code]package org.hyperion.rs2.model.combat.npcs;</p>
<p>import org.hyperion.rs2.model.*;<br>
import org.hyperion.rs2.model.combat.CombatAction;<br>
import org.hyperion.rs2.model.combat.CombatFormulae;<br>
import org.hyperion.rs2.model.combat.CombatState;<br>
import org.hyperion.rs2.model.combat.impl.AbstractCombatAction;<br>
import org.hyperion.rs2.model.content.skills.Prayers;<br>
import org.hyperion.rs2.tickable.Tickable;</p>
<p>import java.util.Random;</p>
<p>/**</p>
<ul>
<li>
<p>KBD Data</p>
</li>
<li>
<p>User: warsaw</p>
</li>
<li>
<p>Date: 4/14/12</p>
</li>
<li>
<p>Time: 6:32 PM<br>
*/<br>
public class KingBlackDragon extends AbstractCombatAction {</p>
<p>/**</p>
<ul>
<li>The singleton instance.<br>
*/<br>
private static final KingBlackDragon INSTANCE = new KingBlackDragon();</li>
</ul>
<p>/**</p>
<ul>
<li>Gets the singleton instance.</li>
<li>
</li>
<li>
<a class="mention" href="/u/return">@return</a> The singleton instance.<br>
*/<br>
public static CombatAction getAction() {<br>
return INSTANCE;<br>
}</li>
</ul>
<p>/**</p>
<ul>
<li>The random number generator.<br>
*/<br>
private final Random random = new Random();</li>
</ul>
<p>/**</p>
<ul>
<li>Default private constructor.<br>
*/<br>
public KingBlackDragon() {</li>
</ul>
<p>}</p>
<p>private enum CombatStyle {<br>
MELEE,</p>
<pre><code> MAGIC
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public void hit(final Mob attacker, final Mob victim) {<br>
super.hit(attacker, victim);</p>
<pre><code> if (!attacker.isNPC()) {
     return; //this should be an NPC!
 }

 NPC npc = (NPC) attacker;

 CombatStyle style = CombatStyle.MAGIC;

 int maxHit;
 int damage;
 int randomHit;
 int hitDelay;
 boolean blockAnimation;
 final int hit;

 if (attacker.getLocation().isWithinDistance(attacker, victim, 2)) {
     switch (random.nextInt(2)) {
         case 0:
             style = CombatStyle.MELEE;
             break;
         case 1:
             style = CombatStyle.MAGIC;
             break;
     }
 }

 switch (style) {
     case MELEE:
         Animation anim = attacker.getAttackAnimation();
         if (random.nextInt(2) == 1) {
             anim = Animation.create(91);
         }
         attacker.playAnimation(anim);

         hitDelay = 1;
         blockAnimation = true;
         maxHit = npc.getCombatDefinition().getMaxHit();
         damage = damage(maxHit, attacker, victim, attacker.getCombatState().getAttackType(), Skills.ATTACK, Prayers.PROTECT_FROM_MELEE, false, false);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         hit = randomHit;
         break;
     default:
     case MAGIC:
         attacker.playAnimation(Animation.create(83));
         attacker.playGraphics(Graphic.create(1, 0, 100));

         hitDelay = 2;
         blockAnimation = false;
         maxHit = 50;
         damage = damage(maxHit, attacker, victim, CombatState.AttackType.MAGIC, Skills.MAGIC, Prayers.PROTECT_FROM_MAGIC, false, true);
         randomHit = random.nextInt(damage &lt; 1 ? 1 : damage + 1);
         if (randomHit &gt; victim.getSkills().getLevel(Skills.HITPOINTS)) {
             randomHit = victim.getSkills().getLevel(Skills.HITPOINTS);
         }
         double dragonfireReduction = CombatFormulae.dragonfireReduction(victim);
         if (dragonfireReduction &gt; 0) {
             randomHit -= (randomHit * dragonfireReduction);
             if (randomHit &lt; 0) {
                 randomHit = 0;
             }
         }
         hit = randomHit;
         break;
 }

 attacker.getCombatState().setAttackDelay(4);
 attacker.getCombatState().setSpellDelay(4);

 World.getWorld().submit(new Tickable(hitDelay) {
     @Override
     public void execute() {
         victim.inflictDamage(new Hit(hit), attacker);
         smite(attacker, victim, hit);
         recoil(attacker, victim, hit);
         this.stop();
     }
 });
 vengeance(attacker, victim, hit, 1);

 victim.getActiveCombatAction().defend(attacker, victim, blockAnimation);
</code></pre>
<p>}</p>
<p><a class="mention" href="/u/override">@Override</a><br>
public int distance(Mob attacker) {<br>
return 7;<br>
}<br>
}<br>
[/code]</p>
</li>
</ul>
<p>Make sure it’s in the package as i said above, because it loads it from <code>bin/org/hyperion/rs2/model/combat/npcs/</code></p>
<p>&amp; There you have it, once you go in-game and ::spawn 50 (KBD), you will see it fighting you with what’s shown in the code in <span class="bbcode-b">KingBlackDragon.java</span></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/2</link>
        <pubDate>Tue, 16 Oct 2012 06:25:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-464301-2</guid>
        <source url="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301.rss">I really don&#39;t understand how this works.. [SOLVED]</source>
      </item>
      <item>
        <title>I really don&#39;t understand how this works.. [SOLVED]</title>
        <dc:creator><![CDATA[@drubrkletern drubrkletern]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/drubrkletern">@drubrkletern</a> wrote:</p>
          <blockquote>
              <p>Well, in the base im using (rs-474) I’ve been trying to add bosses like existing ones, the existing ones added work fine, but when I try and add new ones, it just doesn’t work, so I decided to do some research, to find how the boss classes are linked to the actual npc entity/id I decided to look through the files that making bosses via instances possible, and came across this…</p>
<p><code>case CUSTOM:
						String packageName = "org.rs2server.rs2.model.combat.npcs.";
						File[] files = new File("./data/npcs/").listFiles();
						for (File f : files) {
							if (!f.getName().endsWith(".class")) {
								continue;
							}
							String fileName = packageName + f.getName().substring(0, f.getName().length() - 6);
							String requiredName = packageName + NameUtils.formatName(NPCDefinition.forId(i).getName()).replace(" ", "").replace("'","").replace("`","");
							if (!fileName.equals(requiredName)) {
								continue;
							}
							Class&lt;?&gt; fileClass = Class.forName(fileName);
							if (fileClass.getSuperclass() != AbstractCombatAction.class) {
								continue;
							}
							AbstractCombatAction combatAction = (AbstractCombatAction) fileClass.newInstance();
							def.setCombatAction(combatAction);
						}
						break;
					}
				}
				logger.info("Loaded " + definitions.size() + " combat NPC definitions.");
			} else {
				logger.info("NPC combat definitions not found!");
			}
		} catch (Exception e) {
			e.printStackTrace();</code><br>
The CUSTOM at the top is an attack type for the xml file defining npc combat, and setting it to custom will make it read definitions from the folder containing the boss classes, and for it to be read, the format should contain no spaces, no ', no ` and they should be replaced with no space. But what I don’t seem to understand, is some of the bosses have names that are shared by other npcs, which are defined in an bin file, like for example in real runescape one of those npcs would be used for talking, and for example later in the quest they would be used to fight, and would then have the same name, my question is how does it know which one to get?.. I looked inside the boss files there seems to be no clarification that it finds out from there, and when I name an npc (for example Delrith) which does not share a name afaik, it does not work, even though I declare the attack type CUSTOM in the npc combat definitions xml file.</p>
<p>Of course, that code i posted is not the whole method, and I will post the rest if it is needed and other code if I find anything out.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301/1</link>
        <pubDate>Tue, 16 Oct 2012 01:48:05 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-464301-1</guid>
        <source url="https://forum.moparisthebest.com/t/i-really-dont-understand-how-this-works-solved/464301.rss">I really don&#39;t understand how this works.. [SOLVED]</source>
      </item>
  </channel>
</rss>
