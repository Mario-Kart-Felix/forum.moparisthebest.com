<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
    <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168</link>
    <description>You may have to read over this a few times before you finally understand.  Don&#39;t be discouraged, we have all been there and done that.

Let&#39;s say we just created a new java file called MyApp.java.  We then wrote a bunch of code in it, and decided to compile it and release it.  When we compile the java to a .class file, the java code gets converted to Bytecode.  When we run a class file, the Bytecode is run by the Java Virtual Machine (or JVM for short).

Bytecode is java&#39;s equivalent of Assembly, which is used in many other languages.

Why is bytecode of any use to us?  Well, we use it all the time with updaters, and even when createing a bot (specifically a Bytecode bot) it is very important to have a basic knowledge of bytecode.

For your ease of use, here are the Javadocs (APIDocs) for BCEL: http://jakarta.apache.org/bcel/apidocs/index.html

BCEL stands for the Bytecode Engineering Library, and we use it edit/add/remove bytecode.  Another option is ASM, but this is much less commonly used.  And another possible option is the Bloat Bytecode Library, DON&#39;T EVER USE IT.  It sucks.

Ok, let&#39;s dive right into this.  Here, I am creating a simple &quot;HelloWorld&quot; class:

[code]public class HelloWorldApp {

	public static void main(String[] args) {

		System.out.println(&quot;Hello World!&quot;);

	}

}[/code]

Now, let&#39;s go ahead and compile this to a class file.  As you remember, when we compile our java code to a class file, all the code is turned into &quot;bytecode&quot;, which we can then edit via BCEL :).

So, once you have your class file, go ahead and open JBE.  Now, let me take a minute to explain the JBE interface.

This is a picture of JBE taken right from the JBE download site:
[img]http://cs.ioc.ee/~ando/jbe/screen.png[/img]

As you can see, the interface really isn&#39;t overly complex.  Let&#39;s start with the &quot;tree menu&quot; we seem at the side.  The options we see in this picture are:

-Constant Pool
-Interfaces
-Fields
-Methods
-Attributes

As well as sub folders of those folders.  Although the main folders are always present, their contents will change depending on the class you open.

Constant Pool:
The constant pool is a table containing all the constant values inside the class.

Interfaces:
Contains all the Interfaces and information regarding them, which are in the class.

Fields:
Contains all the fields and information about them (fields are also known as variables in other languages).

Methods:
Contains all the methods inside the class, and their respected bytecode.

Attributes:
Contains misc information about the class, like the source file, it&#39;s sub classes, etc.


Let&#39;s focus our attention on the &quot;Methods&quot; folder.  This will be our primary one.

When we expand the methods folder, we see all the methods inside of the loaded class, as well as the constructor (which is usually &lt;init&gt;).  If we then expand the folder for that method, we can access its code, or we can expand the code folder, and access more specific code.  For most common uses, we simply expand the method we want, and click on the &quot;[x] code&quot; folder, where &quot;x&quot; may or may not change.

Once we do so, JBE automatically loads all the bytecode from class, into the &quot;Bytecode Viewer&quot;  We can read through the colored bytecode here, and see what all is going on.  We can also see the &quot;Exception Table&quot; tab and the &quot;Misc&quot; tab for other information.  The tab you will use most often, is the &quot;Code Editor&quot; tab.  This is the tab where we can edit, and resave our bytecode.

I have gone ahead and opened our HelloWorldApp class, and I&#39;m now looking at the main method:

[IMG]http://img299.imageshack.us/img299/5669/viewinghelloworldappbz9.png[/img]

Now, let&#39;s talk about instructions.  This method is made up of 4 instructions.  getstatic, LDC, invokevirtual and return.  Unlike java, returns are placed at the end of void methods in bytecode, it simply returns nothing.

The JVM reads bytecode as a stack.  The stack theory basically states that the last one in is the first one out.  We call push to put something in the stack, and pop to get it out.  Here is a diagram example:

[img]http://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Data_stack.svg/200px-Data_stack.svg.png[/img]

Now, back to instructions.  We are now looking at the &quot;bytecode instructions&quot; for our class.  The getstatic initiates the printstream of System.out, the LDC sets the string (which in this case is &quot;Hello World!&quot;) and the invokevirtual invokes println.  Followed by return, to exit the method.

Think of instructions like methods, but on a higher level.  LDC is the instruction to push a string onto the stack, bipush is the instruction to push an int onto the stack, sipush is the instruction to push a short onto the stack, the list goes on and on.

Details for every instruction can be found at http://jakarta.apache.org/bcel/apidocs/index.html , simply Edit -&gt; Find and search for your instruction, it should be there, and should have a nice definition of what it does.

So, let&#39;s build on this idea a little bit.  How can we edit this class to say, for example, &quot;I like computers&quot;, instead of hello world.

We know LDC is responsible for pushing the string &quot;Hello World!&quot; onto the stack, so if we edit the string it pushes, it should print our new string.  Right?

Let&#39;s go ahead and do this.  Go to the &quot;Code Editor&quot; tab, and find where it pushes &quot;Hello World!&quot;.  Since LDC pushes any string, we only need to change the string itself, but remember to keep the quotation marks.  So change it to whatever you want, I did the &quot;I like computers&quot; example.

[b]*** BACKUP YOUR OLD CLASS!  IF YOU MESS SOMETHING UP IT IS ALWAYS IMPORTANT TO HAVE A WORKING BACKUP! **[/b]

Save the method (there is a nice big button in the code editor tab to do so), and run the class.  Well i&#39;ll be, it worked!

Hmm, so this is all great, but in client hacking we don&#39;t want to be bothered to edit all the classes we need via JBE.  It&#39;s much eaiser just to do it via bytecode :).

So, i&#39;ll briefly go over how that would work.

First of all, download the BCEL jar from http://apache.mirror.rafal.ca/jakarta/bcel/binaries/bcel-5.2.zip and make a new project in your IDE.  add the BCEL jar to your classpath, and create a new class (I called mine Main.class).

Here are all the BCEL imports:

[code]import org.apache.*;
import org.apache.bcel.*;
import org.apache.bcel.classfile.*;
import org.apache.bcel.generic.*;
import org.apache.bcel.util.*;
import org.apache.bcel.verifier.*;
import org.apache.bcel.verifier.exc.*;
import org.apache.bcel.verifier.statics.*;
import org.apache.bcel.verifier.structurals.*;[/code]

So, add these to your imports.

Now, let&#39;s talk about what this is going to have to do.  We need to find the LDC, change the value, and dump the class.  Easy peasy :).

Here is the code to do so:

[code]import java.io.IOException;

import org.apache.*;
import org.apache.bcel.*;
import org.apache.bcel.classfile.*;
import org.apache.bcel.generic.*;
import org.apache.bcel.util.*;
import org.apache.bcel.verifier.*;
import org.apache.bcel.verifier.exc.*;
import org.apache.bcel.verifier.statics.*;
import org.apache.bcel.verifier.structurals.*;


public class RenameLDC
{
	private ClassGen cGen;
	
	private void loadClass()
	{		
		try {
			cGen = new ClassGen(new ClassParser(&quot;HelloWorldApp.class&quot;).parse()); //load class into a ClassGen
		} catch (ClassFormatException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	private void modify()
	{
		Method build = null; //will contain the correct method
		
		for(Method m : cGen.getMethods()) //Repeat for all methods in the class
		{
			if(m.getName().equals(&quot;main&quot;)) //If the method&#39;s name is &quot;main&quot;
			{
				build = m; //Set the method into a field
				System.out.println(&quot;Found main method!&quot;);
				break;
			}
		}
		
		ConstantPoolGen cPoolGen = cGen.getConstantPool(); //Get the class&#39; constantpool
		MethodGen methodGen = new MethodGen(build, cGen.getClassName(), cPoolGen); //Create a new MethodGen (the equivilent of createing a barnd new method
		InstructionList iList = methodGen.getInstructionList(); //Create a new list of instructions for our method
		
		InstructionHandle titleLDC = null; //This will hold the LDC instruction
		
		InstructionHandle[] iHandles = iList.getInstructionHandles();
		
		for(int f = 0; f &lt; iHandles.length; f++)  //Loop through each instruction until it finds LDC
		{
			if(iHandles[f].getInstruction() instanceof LDC)  //If it is an LDC
			{
				titleLDC = iHandles[f]; //Set it to a field
				System.out.println(&quot;found LDC&quot;);
				break;
			}
		}
		
		LDC ldcIns = new LDC(cPoolGen.addString(&quot;I like computers&quot;)); //Change the string
		
		titleLDC.setInstruction(ldcIns); //Set the new instruction
		
		iList.setPositions(); //cleanup
		methodGen.setInstructionList(iList); //set the new instructionlist
		methodGen.setMaxStack(); //cleanup
		methodGen.setMaxLocals(); //cleanup
		methodGen.removeLineNumbers(); //cleanup
		
		cGen.replaceMethod(build, methodGen.getMethod()); //replace the old method with our new one
	}
	
	public void dumpClass()
	{
		try 
		{
			cGen.getJavaClass().dump(&quot;HelloWorldApp.class&quot;); //dump to the class
		}
		catch(IOException ex) 
		{
			ex.printStackTrace();
		}
	}
	
	public static void main(String[] args)
	{
		loadClass();
		modify();
		dumpClass();
	}
}[/code]

So, let&#39;s go through all of this.  The first thing it does is load the class via

[code]cGen = new ClassGen(new ClassParser(&quot;HelloWorldApp.class&quot;).parse());[/code]

This parses the file into a ClassGen, which is basically a Class which we can edit.

modify() works by looping through all the methods until it finds the currect one (in this case main), then loops through all the instructions until it finds an &quot;LDC&quot;, then sets the new LDC, cleans it all up, adds the new instructions and then adds the new method.  Then dumpClass() sumps it to the class.

This is only basic searching, and it will only work because there is only one LDC in the class.

However, there is another way.  One a little more efficent.

Remember that the Constant Pool contains the value for every constant in the class.  This means our string would also be stored inside of the constant pool...  So, if we could edit our string directly inside the constant pool, wouldn&#39;t that make life much easier?

This is how we would do that:

[code]ConstantPoolGen cp = classGen.getConstantPool();
		
int theString = cp.lookupUtf8(&quot;Hello World&quot;);
if(theString != -1)
{
	cp.setConstant(theString, new ConstantUtf8(&quot;I like computers!&quot;));
	cPoolGen.setConstant(cp.lookupString(&quot;Moose&quot;), new ConstantString(theString));
}[/code]

Well, I hope you enjoyed this tutorial.  If you have any questions please feel free to post!

Credits go to imafatmess for giving me the constant pool idea.  And yakman, his tutorial is what got me into client hacking.</description>
    
    <lastBuildDate>Fri, 15 Aug 2008 23:50:34 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@Yz85Racer Yz85Racer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/yz85racer">@Yz85Racer</a> wrote:</p>
          <blockquote>
              <p>You need to have 15+ rep to be able to rep someone.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/10</link>
        <pubDate>Fri, 15 Aug 2008 23:50:34 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-10</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@Registered_User Registered User]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/registered_user">@Registered_User</a> wrote:</p>
          <blockquote>
              <p>I really liked this tutorial, I’m just now getting back into Java (and rscheating in general) and I couldn’t understand most of the bytecode tuts at sun because I have very basic knowledge of Java; just enough to script for the current free JBots. This tutorial was short, simple, and to the point. Thanks for the help. If I knew how to rep you on these forums, I would.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/9</link>
        <pubDate>Fri, 15 Aug 2008 23:49:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-9</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>[quote=“hugolord 13, post:7, topic:223168”]Holy shit man nice job![/quote]Thanks man :).  Any questions?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/8</link>
        <pubDate>Mon, 04 Aug 2008 13:43:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-8</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@hugolord_13 hugolord 13]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/hugolord_13">@hugolord_13</a> wrote:</p>
          <blockquote>
              <p>Holy shit man nice job!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/7</link>
        <pubDate>Sat, 02 Aug 2008 00:42:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-7</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>[quote=“Thug-life, post:5, topic:223168”]I wasn’t comparing it to your tutorial.[/quote]Oh, I see.  My bad.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/6</link>
        <pubDate>Fri, 01 Aug 2008 01:58:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-6</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@tL tL]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tl">@tL</a> wrote:</p>
          <blockquote>
              <p>I wasn’t comparing it to your tutorial.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/5</link>
        <pubDate>Fri, 01 Aug 2008 01:44:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-5</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>[quote=“Thug-life, post:3, topic:223168”][quote author=butzie225 link=topic=293125.msg2360031#msg2360031 date=1217543767]<br>
gg man i needed a BCEL tut<br>
[/quote]<a href="http://moparisthebest.com/smf/index.php/topic,160681.0.html" rel="nofollow noopener">http://moparisthebest.com/smf/index.php/topic,160681.0.html</a><br>
Been there for ages =[/quote]Not as noob-friendly in my opinion.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/4</link>
        <pubDate>Fri, 01 Aug 2008 00:57:22 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-4</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@tL tL]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tl">@tL</a> wrote:</p>
          <blockquote>
              <p>[quote=“butzie225, post:2, topic:223168”]gg man i needed a BCEL tut[/quote]<a href="http://moparisthebest.com/smf/index.php/topic,160681.0.html" rel="nofollow noopener">http://moparisthebest.com/smf/index.php/topic,160681.0.html</a><br>
Been there for ages =\</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/3</link>
        <pubDate>Thu, 31 Jul 2008 23:50:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-3</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@butzie225 butzie225]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/butzie225">@butzie225</a> wrote:</p>
          <blockquote>
              <p>gg man i needed a BCEL tut</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/2</link>
        <pubDate>Thu, 31 Jul 2008 22:36:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-2</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
      <item>
        <title>[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</title>
        <dc:creator><![CDATA[@the_bank the bank]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/the_bank">@the_bank</a> wrote:</p>
          <blockquote>
              <p>You may have to read over this a few times before you finally understand.  Don’t be discouraged, we have all been there and done that.</p>
<p>Let’s say we just created a new java file called MyApp.java.  We then wrote a bunch of code in it, and decided to compile it and release it.  When we compile the java to a .class file, the java code gets converted to Bytecode.  When we run a class file, the Bytecode is run by the Java Virtual Machine (or JVM for short).</p>
<p>Bytecode is java’s equivalent of Assembly, which is used in many other languages.</p>
<p>Why is bytecode of any use to us?  Well, we use it all the time with updaters, and even when createing a bot (specifically a Bytecode bot) it is very important to have a basic knowledge of bytecode.</p>
<p>For your ease of use, here are the Javadocs (APIDocs) for BCEL: <a href="http://jakarta.apache.org/bcel/apidocs/index.html" rel="nofollow noopener">http://jakarta.apache.org/bcel/apidocs/index.html</a></p>
<p>BCEL stands for the Bytecode Engineering Library, and we use it edit/add/remove bytecode.  Another option is ASM, but this is much less commonly used.  And another possible option is the Bloat Bytecode Library, DON’T EVER USE IT.  It sucks.</p>
<p>Ok, let’s dive right into this.  Here, I am creating a simple “HelloWorld” class:</p>
<p>[code]public class HelloWorldApp {</p>
<pre><code>public static void main(String[] args) {

	System.out.println("Hello World!");

}
</code></pre>
<p>}[/code]</p>
<p>Now, let’s go ahead and compile this to a class file.  As you remember, when we compile our java code to a class file, all the code is turned into “bytecode”, which we can then edit via BCEL :).</p>
<p>So, once you have your class file, go ahead and open JBE.  Now, let me take a minute to explain the JBE interface.</p>
<p>This is a picture of JBE taken right from the JBE download site:<br>
<div class="lightbox-wrapper"><a class="lightbox" href="http://cs.ioc.ee/~ando/jbe/screen.png" title="screen.png" rel="nofollow noopener"><img src="http://cs.ioc.ee/~ando/jbe/screen.png" alt width="690" height="489"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">screen.png</span><span class="informations">736×522</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div></p>
<p>As you can see, the interface really isn’t overly complex.  Let’s start with the “tree menu” we seem at the side.  The options we see in this picture are:</p>
<p>-Constant Pool<br>
-Interfaces<br>
-Fields<br>
-Methods<br>
-Attributes</p>
<p>As well as sub folders of those folders.  Although the main folders are always present, their contents will change depending on the class you open.</p>
<p>Constant Pool:<br>
The constant pool is a table containing all the constant values inside the class.</p>
<p>Interfaces:<br>
Contains all the Interfaces and information regarding them, which are in the class.</p>
<p>Fields:<br>
Contains all the fields and information about them (fields are also known as variables in other languages).</p>
<p>Methods:<br>
Contains all the methods inside the class, and their respected bytecode.</p>
<p>Attributes:<br>
Contains misc information about the class, like the source file, it’s sub classes, etc.</p>
<p>Let’s focus our attention on the “Methods” folder.  This will be our primary one.</p>
<p>When we expand the methods folder, we see all the methods inside of the loaded class, as well as the constructor (which is usually ).  If we then expand the folder for that method, we can access its code, or we can expand the code folder, and access more specific code.  For most common uses, we simply expand the method we want, and click on the “[x] code” folder, where “x” may or may not change.</p>
<p>Once we do so, JBE automatically loads all the bytecode from class, into the “Bytecode Viewer”  We can read through the colored bytecode here, and see what all is going on.  We can also see the “Exception Table” tab and the “Misc” tab for other information.  The tab you will use most often, is the “Code Editor” tab.  This is the tab where we can edit, and resave our bytecode.</p>
<p>I have gone ahead and opened our HelloWorldApp class, and I’m now looking at the main method:</p>
<p><img src="http://img299.imageshack.us/img299/5669/viewinghelloworldappbz9.png" alt width="" height=""></p>
<p>Now, let’s talk about instructions.  This method is made up of 4 instructions.  getstatic, LDC, invokevirtual and return.  Unlike java, returns are placed at the end of void methods in bytecode, it simply returns nothing.</p>
<p>The JVM reads bytecode as a stack.  The stack theory basically states that the last one in is the first one out.  We call push to put something in the stack, and pop to get it out.  Here is a diagram example:</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Data_stack.svg/200px-Data_stack.svg.png" alt width="200" height="144"></p>
<p>Now, back to instructions.  We are now looking at the “bytecode instructions” for our class.  The getstatic initiates the printstream of System.out, the LDC sets the string (which in this case is “Hello World!”) and the invokevirtual invokes println.  Followed by return, to exit the method.</p>
<p>Think of instructions like methods, but on a higher level.  LDC is the instruction to push a string onto the stack, bipush is the instruction to push an int onto the stack, sipush is the instruction to push a short onto the stack, the list goes on and on.</p>
<p>Details for every instruction can be found at <a href="http://jakarta.apache.org/bcel/apidocs/index.html" rel="nofollow noopener">http://jakarta.apache.org/bcel/apidocs/index.html</a> , simply Edit -&gt; Find and search for your instruction, it should be there, and should have a nice definition of what it does.</p>
<p>So, let’s build on this idea a little bit.  How can we edit this class to say, for example, “I like computers”, instead of hello world.</p>
<p>We know LDC is responsible for pushing the string “Hello World!” onto the stack, so if we edit the string it pushes, it should print our new string.  Right?</p>
<p>Let’s go ahead and do this.  Go to the “Code Editor” tab, and find where it pushes “Hello World!”.  Since LDC pushes any string, we only need to change the string itself, but remember to keep the quotation marks.  So change it to whatever you want, I did the “I like computers” example.</p>
<p><span class="bbcode-b">*** BACKUP YOUR OLD CLASS!  IF YOU MESS SOMETHING UP IT IS ALWAYS IMPORTANT TO HAVE A WORKING BACKUP! **</span></p>
<p>Save the method (there is a nice big button in the code editor tab to do so), and run the class.  Well i’ll be, it worked!</p>
<p>Hmm, so this is all great, but in client hacking we don’t want to be bothered to edit all the classes we need via JBE.  It’s much eaiser just to do it via bytecode :).</p>
<p>So, i’ll briefly go over how that would work.</p>
<p>First of all, download the BCEL jar from <a href="http://apache.mirror.rafal.ca/jakarta/bcel/binaries/bcel-5.2.zip" rel="nofollow noopener">http://apache.mirror.rafal.ca/jakarta/bcel/binaries/bcel-5.2.zip</a> and make a new project in your IDE.  add the BCEL jar to your classpath, and create a new class (I called mine Main.class).</p>
<p>Here are all the BCEL imports:</p>
<p><code>import org.apache.*;
import org.apache.bcel.*;
import org.apache.bcel.classfile.*;
import org.apache.bcel.generic.*;
import org.apache.bcel.util.*;
import org.apache.bcel.verifier.*;
import org.apache.bcel.verifier.exc.*;
import org.apache.bcel.verifier.statics.*;
import org.apache.bcel.verifier.structurals.*;</code></p>
<p>So, add these to your imports.</p>
<p>Now, let’s talk about what this is going to have to do.  We need to find the LDC, change the value, and dump the class.  Easy peasy :).</p>
<p>Here is the code to do so:</p>
<p>[code]import java.io.IOException;</p>
<p>import org.apache.<em>;<br>
import org.apache.bcel.</em>;<br>
import org.apache.bcel.classfile.<em>;<br>
import org.apache.bcel.generic.</em>;<br>
import org.apache.bcel.util.<em>;<br>
import org.apache.bcel.verifier.</em>;<br>
import org.apache.bcel.verifier.exc.<em>;<br>
import org.apache.bcel.verifier.statics.</em>;<br>
import org.apache.bcel.verifier.structurals.*;</p>
<p>public class RenameLDC<br>
{<br>
private ClassGen cGen;</p>
<pre><code>private void loadClass()
{		
	try {
		cGen = new ClassGen(new ClassParser("HelloWorldApp.class").parse()); //load class into a ClassGen
	} catch (ClassFormatException e) {
		e.printStackTrace();
	} catch (IOException e) {
		e.printStackTrace();
	}
}

private void modify()
{
	Method build = null; //will contain the correct method
	
	for(Method m : cGen.getMethods()) //Repeat for all methods in the class
	{
		if(m.getName().equals("main")) //If the method's name is "main"
		{
			build = m; //Set the method into a field
			System.out.println("Found main method!");
			break;
		}
	}
	
	ConstantPoolGen cPoolGen = cGen.getConstantPool(); //Get the class' constantpool
	MethodGen methodGen = new MethodGen(build, cGen.getClassName(), cPoolGen); //Create a new MethodGen (the equivilent of createing a barnd new method
	InstructionList iList = methodGen.getInstructionList(); //Create a new list of instructions for our method
	
	InstructionHandle titleLDC = null; //This will hold the LDC instruction
	
	InstructionHandle[] iHandles = iList.getInstructionHandles();
	
	for(int f = 0; f &lt; iHandles.length; f++)  //Loop through each instruction until it finds LDC
	{
		if(iHandles[f].getInstruction() instanceof LDC)  //If it is an LDC
		{
			titleLDC = iHandles[f]; //Set it to a field
			System.out.println("found LDC");
			break;
		}
	}
	
	LDC ldcIns = new LDC(cPoolGen.addString("I like computers")); //Change the string
	
	titleLDC.setInstruction(ldcIns); //Set the new instruction
	
	iList.setPositions(); //cleanup
	methodGen.setInstructionList(iList); //set the new instructionlist
	methodGen.setMaxStack(); //cleanup
	methodGen.setMaxLocals(); //cleanup
	methodGen.removeLineNumbers(); //cleanup
	
	cGen.replaceMethod(build, methodGen.getMethod()); //replace the old method with our new one
}

public void dumpClass()
{
	try 
	{
		cGen.getJavaClass().dump("HelloWorldApp.class"); //dump to the class
	}
	catch(IOException ex) 
	{
		ex.printStackTrace();
	}
}

public static void main(String[] args)
{
	loadClass();
	modify();
	dumpClass();
}
</code></pre>
<p>}[/code]</p>
<p>So, let’s go through all of this.  The first thing it does is load the class via</p>
<pre><code class="lang-auto">cGen = new ClassGen(new ClassParser("HelloWorldApp.class").parse());</code></pre>
<p>This parses the file into a ClassGen, which is basically a Class which we can edit.</p>
<p>modify() works by looping through all the methods until it finds the currect one (in this case main), then loops through all the instructions until it finds an “LDC”, then sets the new LDC, cleans it all up, adds the new instructions and then adds the new method.  Then dumpClass() sumps it to the class.</p>
<p>This is only basic searching, and it will only work because there is only one LDC in the class.</p>
<p>However, there is another way.  One a little more efficent.</p>
<p>Remember that the Constant Pool contains the value for every constant in the class.  This means our string would also be stored inside of the constant pool…  So, if we could edit our string directly inside the constant pool, wouldn’t that make life much easier?</p>
<p>This is how we would do that:</p>
<p>[code]ConstantPoolGen cp = classGen.getConstantPool();</p>
<p>int theString = cp.lookupUtf8(“Hello World”);<br>
if(theString != -1)<br>
{<br>
cp.setConstant(theString, new ConstantUtf8(“I like computers!”));<br>
cPoolGen.setConstant(cp.lookupString(“Moose”), new ConstantString(theString));<br>
}[/code]</p>
<p>Well, I hope you enjoyed this tutorial.  If you have any questions please feel free to post!</p>
<p>Credits go to imafatmess for giving me the constant pool idea.  And yakman, his tutorial is what got me into client hacking.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168/1</link>
        <pubDate>Thu, 31 Jul 2008 18:11:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-223168-1</guid>
        <source url="https://forum.moparisthebest.com/t/tutorial-bytecode-instructions-an-introduction-to-client-hacking/223168.rss">[Tutorial] Bytecode, Instructions &amp; an Introduction to Client Hacking</source>
      </item>
  </channel>
</rss>
