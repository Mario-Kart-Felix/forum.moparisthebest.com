<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/npc-conversations-interactions-fluent-api/549612 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Npc conversations/interactions - fluent API - Runescape - moparisthebest.com</title>
    <meta name="description" content="Here are the beginnings of a fluent API I&amp;#39;m designing:  

         NpcTalkScriptBuilder builder = new NpcTalkScriptBuilder();
    NpcTalkScript script = builder.bindNpcs(95, 224, 268, 485, 540, 617, 792)
            .exe&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="549612.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Npc conversations/interactions - fluent API&#39;" href="549612.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/npc-conversations-interactions-fluent-api/549612" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/npc-conversations-interactions-fluent-api/549612" />
<meta property="og:title" content="Npc conversations/interactions - fluent API" />
<meta name="twitter:title" content="Npc conversations/interactions - fluent API" />
<meta property="og:description" content="Here are the beginnings of a fluent API I’m designing:           NpcTalkScriptBuilder builder = new NpcTalkScriptBuilder();         NpcTalkScript script = builder.bindNpcs(95, 224, 268, 485, 540, 617, 792)                 .executeImmediately((context) -&gt; {                     Player player = context.getPlayer();                       player.setBusy(true);                 })                 .thenExecuteImmediately((ctx) -&gt; {                     Player player = ctx.getPlayer();                    ..." />
<meta name="twitter:description" content="Here are the beginnings of a fluent API I’m designing:           NpcTalkScriptBuilder builder = new NpcTalkScriptBuilder();         NpcTalkScript script = builder.bindNpcs(95, 224, 268, 485, 540, 617, 792)                 .executeImmediately((context) -&gt; {                     Player player = context.getPlayer();                       player.setBusy(true);                 })                 .thenExecuteImmediately((ctx) -&gt; {                     Player player = ctx.getPlayer();                    ..." />
<meta property="article:published_time" content="2015-02-02T11:35:24+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="next" href="5496124658.html?page=2">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="549612.html">Npc conversations/interactions - fluent API</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T11:35:24Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:08Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Here are the beginnings of a fluent API I’m designing:</p>
<pre><code class="lang-auto">
        NpcTalkScriptBuilder builder = new NpcTalkScriptBuilder();
        NpcTalkScript script = builder.bindNpcs(95, 224, 268, 485, 540, 617, 792)
                .executeImmediately((context) -&gt; {
                    Player player = context.getPlayer();


                    player.setBusy(true);
                })
                .thenExecuteImmediately((ctx) -&gt; {
                    Player player = ctx.getPlayer();
                    Npc npc = ctx.getNpc();


                    player.informOfChatMessage(new ChatMessage(player, npc,
                            "I'd like to access my bank account please"));
                })
                .thenExecuteDelayed(1500, (ctx) -&gt; {
                    Player player = ctx.getPlayer();
                    Npc npc = ctx.getNpc();


                    player.informOfNpcChatMessage(new ChatMessage(npc, player,
                            "Certainly " + (player.getAppearance().isMale() ? "sir" : "miss")));
                })
                .thenExecuteDelayed(1500, (ctx) -&gt; {
                    Player player = ctx.getPlayer();


                    player.setBusy(false);
                    player.setAccessingBank(true);
                    Packets.showBank(player);
                })
                .finaliseScript();</code></pre>
<p>The idea, in a nutshell, is that the scripter is largely abstracted from things like nesting.<br>
It’s early days but this will be recursive, allowing for n-depth option selection. I just need to work out the details.</p>
<p>Thoughts on the use of a fluent API as opposed to the nested solution in RSCD (the worst of them seems to be org.rscdaemon.server.npchandler.Tanner) ??</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T18:31:35Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:10Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>While everyone hates the .bsh system, I think you should look for something with external files so anyone who doesn’t know anything about java can create npcs. If I remember correctly, you’re a fan of ruby? or whatever it is? Or maybe just create your own scripting.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T19:35:06Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:11Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yeah, I think no.</p>
<p>I’m not targeting non-developers. Writing server software isn’t for everyone. If you can’t look at example code or read the documents and manipulate it to do what you want then you aren’t fit to develop it further.<br>
Similarly, if you can’t configure a server to connect to a database and be accessible from outside an intranet then you aren’t fit to run a server either.</p>
<p>The people I want to see use this software, eventually, are capable of both. That’s the target audience here. Also, I don’t see how using a scripting language corrects the problem anyway. This approach, when used in an IDE, gives the user intellisense support while writing the code and also compiler support (i.e., compilation errors that are easy to resolve).</p>
<p>Oh, and I absolutely hate ruby. And scala. I like Lua, but Sinisoul (one of the devs doing the official RS2 server) has been trying to add yielding from scripts (i.e., making the script sleep without actually blocking a thread) without success so far.</p>
<p>Bit disappointed to be honest. I was hoping there’d be more to the feedback than ‘this is too hard for non-programmers’. =\</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T19:42:49Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:12Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I <em>think</em> I understand how it works and it seems easy to use (once you see how it fits together). Aside from the functions shown, which others would exist (in NpcTalkScript)?</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T19:54:16Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:12Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>NpcTalkScript is the result of the finaliseScript() function call. Until that point you’re actually working with an NpcTalkScriptBuilder.</p>
<p>Basically one function in NpcTalkScript - a function that takes an NpcTalkScriptContext (which tracks the player’s current progress through the conversation) and, based on that context, continues from the correct conversation stage.<br>
You can think of NpcTalkScriptBuilder as the means to create a finite state machine that represents a player to npc interaction, and NpcTalkScript as the handle.</p>
<p>As for NpcTalkScriptBuilder, it still needs functions to:</p>
<ol>
<li>Register options.</li>
<li>Register nested options.</li>
<li>Bind code to those options at whatever level (it’s going to be recursive so it can go to any conversation depth).<br>
And probably a few other things that I’ll discover when I try to port existing Npc talk handlers from RSCD. That’s the test at the moment - converting those handlers to use my fluent API, and being satisfied with the resulting code.</li>
</ol>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cres.html'><span itemprop='name'>Cres</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T20:09:20Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:12Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>How about when a conversation branches through options?<br>
nvm* that’s your point 1*</p>
<p>seems nice nevertheless, would continue incase someone decides to make a server that focusses on design and efficiency.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/davidi2.html'><span itemprop='name'>davidi2</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T20:39:06Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:13Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thoughts about using something like groovy to reduce the number of lines needed to create things like this? Java 8 functional interfaces help, but assuming someone was using java 7 this would be a lot longer</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-02T21:09:13Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:13Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#8</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Well, I am just pointing out that the reason lack of development takes place is due to the 2-3 software developers around here are forced to write npcs and other small content which should be done by someone else. The RSC botting community had a few decent java script writers and people eventually got into it for their own benefits which eventually lead to text scripts lol.</p>
<p>I think the best bet would to have a community git or site where people can upload their npcs and other scripted events. There are hundreds of npcs and other entities that are options for future custom content.</p>
<p>I can’t provide any solution atm as I am currently looking into getting rid of the npchandler and looking to have my npc ai system handle all the chat, which I could just point it to the npchandler… hmm Even changing around how the client handles the options : <a href="http://i.gyazo.com/39590ea0e500d738bd58f39cea99b65d.png" rel="nofollow noopener">http://i.gyazo.com/39590ea0e500d738bd58f39cea99b65d.png</a> (which I will be adding the initial npc chat to box)</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T05:26:12Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:19Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#9</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Too much typing, not that different from RSCD</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T06:13:44Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:19Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#10</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="9" data-topic="549612">
<div class="title">
<div class="quote-controls"></div>
 -Nothing:</div>
<blockquote>
<p>Too much typing, not that different from RSCD</p>
</blockquote>
</aside>
<p>The script itself can only be so concise. The one above can actually be written more concisely but I wanted to demonstrate it properly. There also needs to be divisions between the breaks/sleeps within the script because that’s the only way to achieve a pause while also not blocking the thread from doing other work.</p>
<p>EDIT:<br>
Went ahead and did some more work on it.<br>
Revised banker script:</p>
<pre><code class="lang-auto">
        NpcTalkScriptBuilder bankerScriptBuilder = new NpcTalkScriptBuilder();
        bankerScriptBuilder.bindNpcs(95, 224, 268, 485, 540, 617, 792);
        bankerScriptBuilder.executeImmediately((ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();


            p.setBusy(true);
            p.informOfChatMessage(new ChatMessage(p, n, "I'd like to access my bank account please"));
        });
        bankerScriptBuilder.thenExecuteDelayed(1500, (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();


            p.informOfNpcChatMessage(new ChatMessage(n, p,
                    "Certainly " + (p.getAppearance().isMale() ? "sir" : "miss")));
        });
        bankerScriptBuilder.thenExecuteDelayed(1500,
                (ctx) -&gt; {
                    Player p = ctx.getPlayer();


                    p.setBusy(false);
                    p.setAccessingBank(true);
                    Packets.showBank(p);
                });
        NpcTalkScript bankerScript = bankerScriptBuilder.finaliseScript();</code></pre>
<p>Tanner script:</p>
<pre><code class="lang-auto">
        NpcTalkScriptBuilder tannerScriptBuilder = new NpcTalkScriptBuilder();
        tannerScriptBuilder.bindNpcs(172);


        // Set the root options.
        tannerScriptBuilder.addOptions(
                "Can I buy some leather then?",
                "Here's some cow hides, can I buy some leather now?",
                "Leather is rather weak stuff");


        // Add script blocks to be executed before displaying the options.
        tannerScriptBuilder.executeImmediately((ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();


            p.setBusy(true);
            p.informOfNpcChatMessage(new ChatMessage(n, p, "Greeting friend. I'm a manufacturer of leather."));
        }).thenExecuteDelayed(1500, (ctx) -&gt; {
            Player p = ctx.getPlayer();
            p.setBusy(false);
            // Menu with options automatically sent at this point.
        });


        // Add script blocks to be executed if user selects option
        // "Can I buy some leather then?"
        tannerScriptBuilder.executeImmediately("Can I buy some leather then?", (ctx) -&gt; {
            Player p = ctx.getPlayer();
            if (p.isBusy()) throw new PlayerBusyException();


            Npc n = ctx.getNpc();
            String option = ctx.getOption();
            p.informOfChatMessage(new ChatMessage(p, n, option));
            p.setBusy(true);
        }).thenExecuteDelayed(1500, (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();
            p.informOfNpcChatMessage(new ChatMessage(n, p,
                    "I make leather from cow hides."));
        }).thenExecuteDelayed(1500, (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();
            p.informOfNpcChatMessage(new ChatMessage(n, p,
                    "Bring me some of them and a gold coin per hide."));
            n.unblock();
        });


        // Add script blocks to be executed if user selects option
        // "Here's some cow hides, can I buy some leather now?"
        tannerScriptBuilder.executeImmediately("Here's some cow hides, can I buy some leather now?",  (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();


            p.informOfNpcChatMessage(new ChatMessage(n, p, "Okay."));
            n.unblock();
        }).thenExecuteDelayedLoop(500, (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Inventory inventory = p.getInventory();
            InvItem lastHides = inventory.getLast(147);


            try {
                if (lastHides == null) {
                    Packets.sendMessage(p, "You have run out of cow hides.");
                    throw new NpcTalkInterruptedException();
                } else if (inventory.countById(10) &lt; 1) {
                    Packets.sendMessage(p, "You have run out of coins.");
                    throw new NpcTalkInterruptedException();
                } else if (inventory.remove(lastHides) &gt; -1 &amp;&amp; inventory.remove(10, 1) &gt; -1) {
                    inventory.add(new InvItem(148, 1));
                    Packets.sendInventory(p);
                } else {
                    throw new NpcTalkInterruptedException();
                }
            } finally {
                p.setBusy(false);
            }
        });


        // Add script blocks to be executed if user selects option
        // "Leather is rather weak stuff"
        tannerScriptBuilder.executeImmediately("Leather is rather weak stuff", (ctx) -&gt; {
            Player p = ctx.getPlayer();
            Npc n = ctx.getNpc();


            p.setBusy(false);
            n.unblock();
            p.informOfNpcChatMessage(new ChatMessage(n, p,
                    "Well yes, if all you're concerned about is how much it " +
                            "will protect you in a fight."));
        });


        NpcTalkScript tannerScript = tannerScriptBuilder.finaliseScript();</code></pre>
<p>Building the options tree (it goes to any depth):</p>
<pre><code class="lang-auto">
        NpcTalkScriptBuilder deeplyNestedOptions = new NpcTalkScriptBuilder();
        deeplyNestedOptions.bindNpcs(95, 224, 268, 485, 540, 617, 792);
        deeplyNestedOptions.addOptions("Option 1", "Option 2", "Option 3");
        deeplyNestedOptions.addChildOptions("Option 1", "O1C1", "O1C2");
        deeplyNestedOptions.addChildOptions("Option 2", "O2C1", "O2C2");
        deeplyNestedOptions.addChildOptions("O2C2", "O2C2-1", "O2C2-2");
        deeplyNestedOptions.addChildOptions("O2C2-1", "Lol", "Hi");
        deeplyNestedOptions.addChildOptions("Lol", "Noobs", "Okay guy");</code></pre>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/waj.html'><span itemprop='name'>waj</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T16:38:53Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:21Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#11</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>You may ignore Nothing, He seems mad that RSCRevolution is still failing after all the work he put in.</p>
<p>On topic: Looking good Lothy</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imthenull.html'><span itemprop='name'>imthenull</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T17:44:06Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:21Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#12</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Looks cool. This is definitely a step in the right direction as far as npc ai goes. When I get home I’d like to play around with this a little bit and see what I can do. Great job on the project Lothy.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jr_Mafio_865.html'><span itemprop='name'>Jr_Mafio_865</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T18:05:03Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:21Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#13</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Glad to see some development is still being done in this scene. Great job.<br>
Just wondering, do you have any plans with all the work you’re doing, is it actually going to be put up for people to play?</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T19:38:20Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:22Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#14</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m somewhat interested in running a server on a crowd sourcing basis. Basically if the server costs $500 a month to host then I seek $500 of donations. Some small reward or sign of recognition is provided, and once the $500 is hit nobody else can get donator status - it’s a first in first served kind of thing. When donations falls below the amount required to host the server then that’s the end of it.</p>
<p>I have already been approached about this.</p>
<aside class="quote" data-post="12" data-topic="549612">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/forum.moparisthebest.com/imthenull/40/1273_1.png" class="avatar"> imthenull:</div>
<blockquote>
<p>Looks cool. This is definitely a step in the right direction as far as npc ai goes. When I get home I’d like to play around with this a little bit and see what I can do. Great job on the project Lothy.</p>
</blockquote>
</aside>
<p>I can push it to the github if you like. It’s just unfinished at the moment so I’ve held off on doing so.<br>
EDIT: Here’s the commit: <a href="https://github.com/Lothy/elysium-single-threaded/commit/ec07408d9ce0ae888f97e4e7a2a80857687fe32b" rel="nofollow noopener">https://github.com/Lothy/elysium-single-threaded/commit/ec07408d9ce0ae888f97e4e7a2a80857687fe32b</a><br>
The main package for this stuff is org.moparscape.elysium.script.npc. Be sure to check out the corresponding test class (NpcTalkScriptBuilderTests) for the method that demonstrates the banker and tanner scripts being built as showcased above.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jr_Mafio_865.html'><span itemprop='name'>Jr_Mafio_865</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T20:36:56Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:23Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#15</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Lothy, post:14, topic:549612”]I’m somewhat interested in running a server on a crowd sourcing basis. Basically if the server costs $500 a month to host then I seek $500 of donations. Some small reward or sign of recognition is provided, and once the $500 is hit nobody else can get donator status - it’s a first in first served kind of thing. When donations falls below the amount required to host the server then that’s the end of it.</p>
<p>I have already been approached about this.[/quote]<br>
That’s major man! Wish you luck. Will be watching this project closely <img src="../../images/emoji/twitter/winkae52.png?v=5" title=":wink:" class="emoji" alt=":wink:"></p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/imthenull.html'><span itemprop='name'>imthenull</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-03T21:02:47Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:23Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#16</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>thanks. ill definitely check it out.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Nothing1.html'><span itemprop='name'>Nothing1</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-04T14:11:28Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:27Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#17</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Imo unless you can do line per action with a scripting system it is just as useless as RSCDs original, you could very easily shorten that Tanner script to about 30 lines with proper approach…good luck making a quest with this, I can guarantee you that it will be confusing as fuck to read.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Protosstribe.html'><span itemprop='name'>Protosstribe</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-04T21:15:42Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:29Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#18</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Here is my approach to it:</p>
<p>Edit: It supports script stepping and delays, such that you can perform multiple player script updates in a short period of time on one thread. Simply just have a list of players, each one with an active script, then step once per player and game loop (or similar). All step updates should return immediately and not block. The delay step does just that, and the “stage” for the script is not updated until the time has passed. The ScriptContext class handles one Player only, so you need one ScriptContext instance per Player. It also contains the block delay timer and the current stage of the current Script.</p>
<p>Edit 2: I just made it in a few hours. So it’s far from finished at this time. Not even all methods are implemented and works in there. But I made it to see if I could use the same approach I used for a programming language I prototyped before. If anyone is interested in seeing more of this, I perhaps could make it into an actual API, that could be implemented by servers.</p>
<pre><code class="lang-auto">public final class Test {
    public static Script newScript() {
        return
        Script.Builder.newInstance().
            onTalkTo(95, 224, 268, 485, 540, 617, 792).
                youSay("I'd like to access my bank account please").
                delay(1500L).
                npcSay((scriptContext) -&gt; {return "Certainly " + (scriptContext.you().isMale() ? "Sir" : "Miss");}).
                delay(1500L).
                openBank().
            done().
            onTalkTo(0).
                npcSay("Hello, World!").
                delay(1500L).
            done().
        build();
    }
    
    public static void main(String[] args) {
        Player you = new You();
        
        ScriptContext scriptContext = ScriptContext.newInstance(you);
        
        Script script = newScript();
        script.execute(scriptContext);
    }
}</code></pre>
<pre><code class="lang-auto">public interface Message {
    String say(ScriptContext scriptContext);
}</code></pre>
<pre><code class="lang-auto">public interface Player {
    boolean isFemale();
    
    boolean isMale();
}</code></pre>
<pre><code class="lang-auto">public final class You implements Player {
    @Override
    public boolean isFemale() {
        return false;
    }
    
    @Override
    public boolean isMale() {
        return true;
    }
}</code></pre>
<pre><code class="lang-auto">import java.util.concurrent.atomic.AtomicInteger;
import java.util.concurrent.atomic.AtomicLong;

public final class ScriptContext {
    private final AtomicInteger stage = new AtomicInteger(0);
    private final AtomicLong timer = new AtomicLong(0L);
    private final Player you;
    
    private ScriptContext(final Player you) {
        this.you = you;
    }
    
    public boolean isTimerRunning() {
        return timer.get() != 0L;
    }
    
    public int getStage() {
        return stage.get();
    }
    
    public long elapsedTime() {
        return System.currentTimeMillis() - timer.get();
    }
    
    public Player you() {
        return you;
    }
    
    public void startTimer() {
        timer.set(System.currentTimeMillis());
    }
    
    public void stopTimer() {
        timer.set(0L);
    }
    
    public void updateStage() {
        stage.incrementAndGet();
        
        System.out.println("New stage: " + stage.get());
    }
    
    public static ScriptContext newInstance(final Player you) {
        return new ScriptContext(you);
    }
}</code></pre>
<pre><code class="lang-auto">import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;

public final class Script {
    private final List&lt;Node&gt; nodes = new ArrayList&lt;&gt;();
    private final Map&lt;Integer, Integer&gt; ids = new LinkedHashMap&lt;&gt;();
    
    private Script(final Builder builder) {
        this.nodes.addAll(builder.nodes);
        this.ids.putAll(builder.ids);
    }
    
    public boolean step(final ScriptContext scriptContext) {
        boolean hasStepped = false;
        
        Node node = doGetNodeForStage(scriptContext.getStage(), nodes);
        
        if(node != null) {
            hasStepped = node.step(scriptContext);
            
            if(hasStepped) {
                System.out.println(node.getClass().getSimpleName());
                
                scriptContext.updateStage();
            }
            
            hasStepped = true;
        } else {
            scriptContext.updateStage();
            
            hasStepped = false;
        }
        
        return hasStepped;
    }
    
    public void execute(final ScriptContext scriptContext) {
        while(step(scriptContext));
    }
    
    private Node doGetNodeForStage(final int stage, final List&lt;Node&gt; nodes) {
        for(Node node : nodes) {
            if(node.getStage() == stage) {
                return node;
            } else {
                node = doGetNodeForStage(stage, node);
                
                if(node != null) {
                    return node;
                }
            }
        }
        
        return null;
    }
    
    private Node doGetNodeForStage(final int stage, final Node node) {
        if(node.getStage() == stage) {
            return node;
        } else if(node instanceof ScriptNode) {
            ScriptNode scriptNode = ScriptNode.class.cast(node);
            
            List&lt;Node&gt; nodes = scriptNode.script.nodes;
            
            return doGetNodeForStage(stage, nodes);
        } else {
            return null;
        }
    }
    
    public static final class Builder {
        private final AtomicInteger nextStage = new AtomicInteger(0);
        private final Builder parent;
        private final List&lt;Node&gt; nodes = new ArrayList&lt;&gt;();
        private final Map&lt;Integer, Integer&gt; ids = new LinkedHashMap&lt;&gt;();
        
        private Builder(final Builder parent, final int... ids) {
            this.parent = parent;
            
            for(int id : ids) {
                this.ids.put(id, id);
            }
        }
        
        public Builder delay(long millis) {
            nodes.add(new DelayNode(doGetNextStage(), millis));
            
            return this;
        }
        
        public Builder done() {
            if(parent != null) {
                parent.nodes.add(new ScriptNode(doGetNextStage(), build()));
                
                return parent;
            } else {
                return this;
            }
        }
        
        public Builder npcSay(final Message message) {
            nodes.add(new NpcSayNode(doGetNextStage(), message));
            
            return this;
        }
        
        public Builder npcSay(final String message) {
            nodes.add(new NpcSayNode(doGetNextStage(), (scriptContext) -&gt; {return message;}));
            
            return this;
        }
        
        public Builder onTalkTo(final int... ids) {
            return new Builder(this, ids);
        }
        
        public Builder openBank() {
            return this;
        }
        
        public Builder youSay(final String message) {
            return this;
        }
        
        public Script build() {
            return new Script(this);
        }
        
        public static Builder newInstance() {
            return new Builder(null);
        }
        
        private int doGetNextStage() {
            if(parent != null) {
                return parent.doGetNextStage();
            } else {
                return nextStage.getAndIncrement();
            }
        }
    }
    
    private static final class DelayNode implements Node {
        private final int stage;
        private final long millis;
        
        private DelayNode(final int stage, final long millis) {
            this.stage = stage;
            this.millis = millis;
        }
        
        @Override
        public boolean step(final ScriptContext scriptContext) {
            boolean hasStepped = false;
            
            if(scriptContext.isTimerRunning()) {
                hasStepped = scriptContext.elapsedTime() &gt;= millis;
                
                if(hasStepped) {
                    scriptContext.stopTimer();
                }
            } else {
                scriptContext.startTimer();
            }
            
            return hasStepped;
        }
        
        @Override
        public int getStage() {
            return stage;
        }
    }
    
    private static interface Node {
        boolean step(final ScriptContext scriptContext);
        
        int getStage();
    }
    
    private static final class NpcSayNode implements Node {
        private final int stage;
        private final Message message;
        
        private NpcSayNode(final int stage, final Message message) {
            this.stage = stage;
            this.message = message;
        }
        
        @Override
        public boolean step(final ScriptContext scriptContext) {
            System.out.println("Npc says: " + message.say(scriptContext));
            
            return true;
        }
        
        @Override
        public int getStage() {
            return stage;
        }
    }
    
    private static final class ScriptNode implements Node {
        private final int stage;
        private final Script script;
        
        private ScriptNode(final int stage, final Script script) {
            this.stage = stage;
            this.script = script;
        }
        
        @Override
        public boolean step(final ScriptContext scriptContext) {
            return script.step(scriptContext);
        }
        
        @Override
        public int getStage() {
            return stage;
        }
    }
}</code></pre>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Rodgerwilco.html'><span itemprop='name'>Rodgerwilco</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-04T21:44:14Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:29Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#19</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Lol shit, that’s sick.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/lothy.html'><span itemprop='name'>lothy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2015-02-05T06:58:08Z'>
            <time itemprop='dateModified' datetime='2016-08-04T14:19:56Z' class='post-time'>
              August 4, 2016,  2:19pm
            </time>
        <span itemprop='position'>#20</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I like what you’ve done but there’s an important part missing: conversation branching.<br>
Your solution so far only caters for linear interactions.</p>
<p>Also, if you do post something that works, includes conversation branching, and fits within my desired constraints (i.e., must be non-blocking, robust, constant time execution of steps) then I’d love to include it in the git repository.</p>
      </div>

      <meta itemprop='headline' content='Npc conversations/interactions - fluent API'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><b><a rel="next" itemprop="url" href="5496124658.html?page=2">next page →</a></b></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/npc-conversations-interactions-fluent-api/549612 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:07:15 GMT -->
</html>
