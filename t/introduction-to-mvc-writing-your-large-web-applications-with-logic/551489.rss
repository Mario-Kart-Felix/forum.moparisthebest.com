<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Introduction to MVC: Writing your large web applications with logic</title>
    <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489</link>
    <description>Hello Moparscape users,

I was quite surprised when i saw the download section full of small to large projects written in plain old PHP.
Made me want to create this tutorial for all web developers who want to learn something new or want to improve their coding skills as they can better observe and contain their code.
MVC is much Java alike where PHP makes it possible to work with classes and objects.

I do not state that this is the best way of programming but i can say it will save you alot of time when you are building a web application with allot of pages and logic to be handled.
However if you are bulding a RSPS website with nothing more than like 5 pages: this setup should be a waste of time.

[B]What is MVC ?[/B]
In terms it speaks of a Modal (class) a View (template ex:HTML/CSS) and a Controller (class but i prefer plain PHP code in there as i can commit actions depending on what request is send OR URI is requested.)
I&#39;m also going to introduce people to using a one index controller for their web application, and using a templating engine like twig for faster and understandable twig code template rendering.


[SIZE=4]The setup:[/SIZE]Before we begin we will need all of the following resources.
- An editor for both PHP / HTML and CSS code is recommended (May show you errors before you even debug) i use PHPDesigner wich u can find here: [url=http://www.mpsoftware.dk/phpdesigner.php]phpDesigner 8 - PHP Editor &amp; PHP IDE with built-in HTML5, JavaScript, CSS3 editor! | MPSOFTWARE[/url]
- Twig library to implent in our source later: [URL=http://&quot;https://github.com/twigphp/Twig/tags&quot;]https://github.com/twigphp/Twig/tags[/URL] download the latest version and extract[B] /Twig(version)/lib/Twig[/B] somewhere save for later use.
- Autoloading class wich is include in doctrine common files: [URL=http://&quot;https://github.com/doctrine/common&quot;]https://github.com/doctrine/common[/URL] download and extract[B] /common_master/lib/Doctrine[/B] somewhere save.
- Last but not least a session manager to stop session hijackers: [URL=http://&quot;http://mafiasource.be/sessionManager.txt&quot;]http://mafiasource.be/sessionManager.txt[/URL] The one i use feel free to add your own proxies and stuff.


[SIZE=4]Starting off:[/SIZE] in public_html we will now create our application tree for example:
[code]
/app                     Here we keep our application cache, configurations and standard base templates.
/src                      Here we can find our source code where our Models, Views and Controllers will be present maybe even Language packets.
/vendor                An easy way to keep all of our 3rd library files for example doctrine and facebook api (We will not place Twig in there)
/web                    The directory where our front-controller is present (index.php) and we have 2 sub directories: one for web/lib and one for web/public.
/web/lib/              Here we wil upload our extracted Twig map.
/web/public          Where every resource that has to be accessible from the web application is present. (ex: ajax, images, css, bootstrap, js)
.htaccess
robots.txt
sitemap.xml
[/code]


[SIZE=4]Step 1:[/SIZE] Creating the .htacces file to link all browser users to the same page on every request. (our front controller in /web/index.php )
This step is very important, we don&#39;t want our users the browse every single page itself why don&#39;t we create one single page to proccess all of our actions?

So mmediatly in public_html you create a new file (if not already exsist) and name it .htaccess write following code:

[code]
DirectoryIndex /web/index.php
Options -Indexes
&lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{REQUEST_URI} /sitemap.xml #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteRule .* - [S=99999999999999]          #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteCond %{REQUEST_URI} /robots.txt     #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteRule .* - [S=99999999999999]          #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
    RewriteRule ^(.*) - [E=BASE:%1]
    RewriteCond %{ENV:REDIRECT_STATUS} ^$
    RewriteRule ^web\index\.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]
    RewriteRule .? %{ENV:BASE}/web/index.php [L]
&lt;/IfModule&gt;

&lt;IfModule !mod_rewrite.c&gt;
    &lt;IfModule mod_alias.c&gt;
        RedirectMatch 302 ^/$ /web/index.php/
    &lt;/IfModule&gt;
&lt;/IfModule&gt;
[/code]

This code literaly says when the reqquest uri is /sitemap.xml ignore next 99999999999999 lines of code than it checks if the request uri is /robots.txt, and yes you already guessed it.
If none of these matches so any other possible URI, it will direct the user to /web/index.php.


[SIZE=4]Step 2:[/SIZE] Creating the front controller /web/index.php.
In our front-controller we will setup:
- strict error reporting for debuging.
- Make use of the PHP Use statements and implent the autoloading to use the use statements correctly.
- Setup the session manager
- Setup a routing system for router -&gt; controller.

Before we can start writing the index controller we need to make sure we can use the session manager, the autoloading class and the twig engine, to do so please upload the previously saved Doctrine map to [B]/public_html/vendor[/B] you now have: public_html/vendor/Doctrine.
Now for the session Manager you can upload it directly to [B]/public_html/vendor[/B] make sure to save it as a PHP extension and not a TXT (like i uploaded).
At last upload the previously saved Twig map to [B]/public_html/web/lib[/B]

Index.php front controller:
[code]
&lt;?PHP
/**
 * Front controller - all requests  GET / POST are processed here
 * @author Michael Carrein
 **/

//Error reporting
ini_set(&#39;display_errors&#39;,1);
ini_set(&#39;display_startup_errors&#39;,1);
error_reporting(-1);

//Use statements
use Doctrine\Common\ClassLoader;
use app\config\Routing;

/** Session manager  **/
require_once __DIR__.&#39;/../vendor/sessionManager.php&#39;;
SessionManager::sessionStart(&#39;Website name&#39;, 0, &#39;/&#39;, $_SERVER[&#39;HTTP_HOST&#39;], false); // Does the same as session_start(); but in a more secure way. **/

/** Routing &amp; controllers **/
require_once __DIR__.&#39;/../app/config/routing.php&#39;;
$route = new Routing();
if($route-&gt;getController() != FALSE) //If we get a valid controller it will execute following code
{
    define(&quot;DOC_ROOT&quot;, $_SERVER[&#39;DOCUMENT_ROOT&#39;]); 
    
    /** Autoloading with doctrine so we never have to include or require again (Just use statements)**/
    require_once DOC_ROOT . &#39;/vendor/Doctrine/Common/ClassLoader.php&#39;;
    $classLoader = new ClassLoader(&#39;src&#39;   ,   DOC_ROOT);
    $classLoader-&gt;register();
    
    /** Twig engine  **/
    require_once __DIR__.&#39;/lib/Twig/Autoloader.php&#39;;
    Twig_Autoloader::register();
    $loader = new Twig_Loader_Filesystem(DOC_ROOT); //Load Twig templates from root
    $twig = new Twig_Environment($loader, array(
        &#39;cache&#39; =&gt; FALSE //DOC_ROOT . &#39;/app/cache/TwigCompilation/&#39;, //Cache or no cache ?
    ));

    $_SESSION[&#39;DOC_ROOT&#39;] = DOC_ROOT;
    
    /** Get requested controller **/
    if(file_exists(__DIR__.&#39;/../src/Controllers/&#39;.$route-&gt;getController()))
    {
        if($route-&gt;getController() != &quot;notfound.php&quot; &amp;&amp; $route-&gt;getController() != &quot;languageSelect.php&quot;)
        {
            $route-&gt;setPrevRoute(); //Save previous route
        }
        include __DIR__.&#39;/../src/Controllers/&#39;.$route-&gt;getController();
    }
}
[/code]

And again, the user will always be browsing on this page no mather what.
This index file is the only file we will be using require or include functions (PHP) because this is our front-controller and our autoloading class will only be triggered once there&#39;s an exsisting route.
In the rest of the application we can use the use statements to autoload a class instead of require / include every time. (Because when a user reaches another part of the application (Ex. a controller) he requested an exsisting route)
Remember: you can only autoload classes and no plain PHP files.
Important to notice is that every class that needs to be able to be autoloaded is going to get a namespace. This namespace is the directory the class is in. and don&#39;t mis it&#39;s \ instead of / for both namespace and use statements to jump directories.

If you have read the code you saw some incompleted code wich is routing and controllers.


[SIZE=4]Step 3:[/SIZE] Creating the routing class and seting up the routes and controllers.
You might ask yourself what the * are routes?
As we don&#39;t direct our user to every single page anymore we need some kind of routing system te determine wheter a users is loggin in or reading the news or registering ...
Routes are the URI&#39;s requested in our browser as we can create every route ourselfs we can create beautifull SEO applications too.
Example of a route (bold): [url=http://v3.mafiasource.be]http://v3.mafiasource.be[/url][B]/game/summary/info[/B]

Now before we can setup the routes and controllers we need a routing class i have written quite a good routing class for you already:

[code]
&lt;?PHP

namespace app\config;

use src\Data\seoDAO;

/**
 * Routing class
 **/

class Routing
{
    
    private $route;
    
    private $routeName;
    
    private $controller;
    
    public $routeMap = array();
    
    public $prevRoute;
    
    public function __construct() //If class is requested this function is called immediatly
    {
        include __DIR__.&#39;/routes/routes.php&#39;; //Where we define our routes see Step 4 of this tutorial. And yes we use include because an array is not a class and can not be autoloaed.
        
        $this-&gt;routeMap = $applicationRoutes; //Put our defined routes in the routeMap
        /**
         * At the for loop you define from wich directory the routes start.
         * Caution: as we root our web app in public_html/web/ we use $i = 1;
         **/
        $requestURI = explode(&#39;/&#39;, $_SERVER[&#39;REQUEST_URI&#39;]);
        $routes = array();
        for($i = 1; $i &lt; count($requestURI); $i++)
        {
            $val = $requestURI[$i];
            array_push($routes,$val);
        }
        $endRoute = &quot;&quot;;
        foreach($routes AS $value)
        {
            $endRoute .= &#39;/&#39;.$value;
        }
        
        $controller = false;
        
        //Now check wheter a user requested a route defined in routes.php (Step 4)
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if(preg_match(&#39;{^&#39;.$value[&#39;route&#39;].&#39;$}&#39;, $endRoute))
            {
                $controller = $value[&#39;controller&#39;];
                $routeName = $key;
            }
        }
        
	//Now check if the route exsist depending on what controller you retrieve.
        if($controller != false)
        {
	    //Setup page parameters
            $this-&gt;route = $endRoute;
            $this-&gt;controller = $controller;
            $this-&gt;routeName = $routeName;
        }
        else
        {
	    //Generate not found page
            $this-&gt;route = &#39;/notfound&#39;;
            $this-&gt;controller = &#39;notfound.php&#39;;
        }
    }
    
    //Get previous route for redirects $route-&gt;getPrevRoute();
    public function getPrevRoute()
    {
        if(isset($_SESSION[&#39;PREV_ROUTE&#39;]))
        {
            return $_SESSION[&#39;PREV_ROUTE&#39;];
        }
        else
        {
            return $_SESSION[&#39;PREV_ROUTE&#39;] = $_SERVER[&#39;REQUEST_URI&#39;];
        }
    }
    
    //Set prev route happens on every request already
    public function setPrevRoute()
    {
        $_SESSION[&#39;PREV_ROUTE&#39;] = $_SERVER[&#39;REQUEST_URI&#39;];
    }
    
    public function headTo($routeName)
    {
        /**
         * Replaces the header(&#39;Location: &#39;); function now you can use $route-&gt;headTo(&quot;ROUTENAME (see Step 4)&quot;);
         * **/
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if($key == $routeName)
            {
                header(&quot;Location: &quot; . $value[&#39;route&#39;]);
                exit(0);
            }
        }
    }
    
    public function getRouteByRouteName($routeName)
    {
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if($key == $routeName)
            {
                return $value[&#39;route&#39;];
            }
        }
    }
    
    public function getRoute()
    {
        return $this-&gt;route;
    }
    
    public function getRouteName()
    {
        return $this-&gt;routeName;
    }
    
    public function getController()
    {
        return $this-&gt;controller;
    }
}
[/code]

And as you can see in index.php (front controller) you see this belongs in [B]/public_html/app/config[/b] as: routing.php
Now we need to keep in mind that we have aleady setup a routing and if the route doesn&#39;t exsist we throw a not found page, so in step 4 we will create the routes and in step 5 we will create our not found page.


[SIZE=4]Step 4:[/SIZE] Defining the routes in a PHP array file.
For SEO optimalisation many search engines state that you have &quot;beautiful&quot; urls, those urls don&#39;t contain any special characters like &amp;,? wich is common used in form submit.
With our own routing we can setup the routes the way we want it i will give some great examples allong the way.

This array goes into [B]/public_html/app/config/routes[/B] as routes.php:

[code]
&lt;?PHP
        /** 
         * Define all possible routes
         * 
         * @RouteName = The name you want to give the route for ex. $route-&gt;headTo(&quot;@RouteName&quot;);
         * @RoutePath = The requested URI
         * @Controller = The controller to execute when Route matches. (remember in our index.php front controller we have defined the controller map to be at /public_html/src/Controllers there is where we handle our controllers.)
         * 
         * A little example with / (root)
         * Routes with random PHP vals can be found by preg_match(); wich routing already does, here we just need to use the regex. (check example 1 and 2 below)
         **/
        $applicationRoutes =
        array(
            /**
             * @RouteName
             **/
            &#39;home&#39;
            =&gt; 
            array(
                /**
                 * @RoutePath
                 **/
                &#39;route&#39; =&gt; &#39;/&#39;,
                
                /**
                 * @Controller
                 **/
                &#39;controller&#39; =&gt; &#39;index.php&#39;
            ),
	    
	    &#39;index&#39;
	    =&gt;
	    array(
		&#39;route&#39; =&gt; &#39;/index&#39;,
		&#39;controller&#39; =&gt; &#39;index.php&#39;
	    ),

	    &#39;not_found&#39;
            =&gt; 
            array(
                &#39;route&#39; =&gt; &#39;/notfound&#39;,
                &#39;controller&#39; =&gt; &#39;notfound.php&#39;
            )//,
	    
	    //Example 1: Working with page numbers
	    //&#39;news_page&#39;
	    //=&gt;
	    //array(
	    //	&#39;route&#39; =&gt; &#39;/news/page/[1-9][0-9]*&#39;,
	    //	&#39;controller&#39; =&gt; &#39;news.php&#39;
	    //),
	    
	    //Example 2: working with news titels
	    //&#39;news_article&#39;
	    //=&gt;
            //array(
	    //	&#39;route&#39; =&gt; &#39;/news/article/[A-Za-z0-9-]{3,200}&#39;,
	    //	&#39;controller&#39; =&gt; &#39;news_article.php&#39;
	    //)
	);
[/code]

Now it&#39;s up to you to define all routes needed for your web application and link them with the correct controllers.


[SIZE=4]Step 5:[/SIZE] Creating the not found page with 2 sub steps. (Now it&#39;s actualy all about creating the pages)
Gratz you have succesfully finished your setup to start working realy fast and realy productive in the future!

[SIZE=2]Sub step 1:[/SIZE] Creating the controller
Now once we create the controller we can handle every possible action for that page. Depending on what action you do you might get another page..
This is where the view comes in handy.

Our not_found controller wich should be in [B]/public_html/src/Controllers[/B] as notfound.php (Like defined in the routes)

[code]
&lt;?PHP
/*
 * This code are examples of how logic should be processed in the controller using layers wich get autoloader by our Doctrine autoloading class using the use statements.
use src\Business\UserService;

$user = new UserService();
$userProfile = $user-&gt;getUserProfile();

$loggedIn = false;
if($userProfile) $loggedIn = true;
*/

//We don&#39;t want to render our PHP variables inside the template so we simply convert them to Twig variables (wich is actualy a simple array with data) with folowing line of code:
$twigVars = array(&#39;docRoot&#39; =&gt; &quot;http://&quot;.$_SERVER[&#39;HTTP_HOST&#39;].&quot;&quot;,&#39;routing&#39; =&gt; $route);
//Render notfound template and include all variables needed to render the template so for us the $twigVars
echo $twig-&gt;render(&#39;/src/Views/notfound.twig&#39;,$twigVars);
[/code]

Yes, our controller can be as simple as that because we just need to render a template wich says that the page was not found.

[SIZE=2]Sub step 2:[/SIZE] Creating the not_found view. (The html page the user sees)
Now in our view we will be learning nothing more than HTML and a little bit of Twig (for advanced twig options please refer to their website)
Simply create [B]notfound.twig[/B] in [B]/public_html/src/Views[/B] with following code:

[code]
{% extends &quot;/app/Resources/Views/base.twig&quot; %}

{% block content %}
{#
    Example of how if else block works in twig
    {% if loggedIn == true %}
        {% include &quot;/app/Resources/Views/base_ingame_static_nav.twig&quot; %}
    {% else %}
        {% include &quot;/app/Resources/Views/base_outgame_static_nav.twig&quot; %}
    {% endif %}
#}
        &lt;section id=&quot;top&quot; class=&quot;notFound&quot;&gt;
            &lt;div class=&quot;not-found-page&quot;&gt;
                &lt;div class=&quot;container&quot;&gt;
                    &lt;div class=&quot;row not-found-kol&quot;&gt;
                        &lt;div class=&quot;col-md-4&quot;&gt;
                            &lt;img class=&quot;img-rounded img-responsive&quot; alt=&quot;Company Logo&quot; src=&quot;/web/public/images/logo.png&quot;/&gt;
                        &lt;/div&gt;
                        &lt;div class=&quot;col-md-8&quot;&gt;
                            &lt;!--
                            &lt;div class=&quot;not-found&quot;&gt;
                                &lt;div class=&#39;alert alert-warning&#39;&gt;
                                    &lt;h4&gt;&lt;span class=&quot;glyphicon glyphicon-ban-circle&quot;&gt;&lt;/span&gt;Page doens&#39;t exsist!&lt;/h4&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            --&gt;
                            &lt;iframe src=&quot;http://notfound-static.fwebservices.be/404/index.html?&amp;amp;key=c3246892335c83e0a507e07c4f824a45&quot; width=&quot;100%&quot; height=&quot;650&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;
{% endblock content %}
{% block footer %}{% endblock footer %}
[/code]

Note: as you can see my HTML mockup is already styled and has used some bootstrap classes.
It&#39;s totaly up to you to code your HTML the way you want it.
Now the realy IMPORTANT part here is notice the first line of code ?

The not found template actualy extends another template, so in simple terms my not_found content actualy gets included in my base HTML mockup.

Step 6 and final step are comming if someone is willing to reply something.</description>
    
    <lastBuildDate>Thu, 14 May 2015 04:47:37 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="5" data-topic="551489">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/micadev/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> MiCaDev:</div>
<blockquote>
<p>The only problem you can encounter is when you secure forms a mobile user might input a invalid form because the session might end when the user is moving as it’s ip changed.</p>
</blockquote>
</aside>
<p>Yeah, that’s what I meant. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> I don’t like the idea of pinning sessions to IP’s really.</p>
<p>Still, pretty cool, do more! <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/7</link>
        <pubDate>Thu, 14 May 2015 04:47:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-7</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@Pwnd Pwnd]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/pwnd">@Pwnd</a> wrote:</p>
          <blockquote>
              <p>I’m so incredibly glad I gave up PHP</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/6</link>
        <pubDate>Wed, 13 May 2015 15:52:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-6</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@MiCaDev MiCaDev]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/micadev">@MiCaDev</a> wrote:</p>
          <blockquote>
              <p>[quote=“Mopman, post:4, topic:551489”]Cool. Always like to see web dev stuff.</p>
<p>A few things that came to mind when reading.</p>
<p>[ul][li]MVC (<em>Model</em> View Controller) is a paradigm usable in any language or framework.<br>
It’s not really ‘Java alike’, nor is it the only way to have structured code in<br>
PHP or any other language. I can see why you might have chosen to explain it this<br>
way, though.[/li]</p>
<p>[li]The Session Manager idea is bad. In its current form it denies access to 3G/4G<br>
connections for example, which seems a silly idea in 2015’s mobile world.[/li]</p>
<p>[li]Am I confused, or is there no way to differentiate between different verbs in<br>
routes, ie. I cannot route GET /games and POST /games to different controller<br>
actions?[/li]</p>
<p>[li]You have view code in your model for UserService.php. The whole point of<br>
the exercise is so that stuff isn’t in there…[/li][/ul][/quote]</p>
<p>[ul][li]<br>
I agree, i am new to RSPS and saw that Java programming looks allot like PHP OOP now.<br>
[/li]<br>
[li]<br>
The session manager makes me able to connect with 2g, 3g and 4g wich i tested on my mobile though.<br>
The only problem you can encounter is when you secure forms a mobile user might input a invalid form because the session might end when the user is moving as it’s ip changed.<br>
[/li]<br>
[li]<br>
The routes you define have nothing to do with the post or get request, you can however extract data from the URI to use in your controller as a replacement for GET requests.<br>
For myself i would never ever use GET requests in my application.<br>
The post request can be handled in the contoller.<br>
[/li]<br>
[li]<br>
I agree.<br>
[/li][/ul]</p>
<p>Edit: if you would like me to change some stuff at this tutorial please let me know, i’m not always that good at explaining my thoughts.<br>
Thanks!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/5</link>
        <pubDate>Wed, 13 May 2015 13:16:41 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-5</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@Mopman Mopman]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/mopman">@Mopman</a> wrote:</p>
          <blockquote>
              <p>Cool. Always like to see web dev stuff.</p>
<p>A few things that came to mind when reading.</p>
<p>[ul][li]MVC (<em>Model</em> View Controller) is a paradigm usable in any language or framework.<br>
It’s not really ‘Java alike’, nor is it the only way to have structured code in<br>
PHP or any other language. I can see why you might have chosen to explain it this<br>
way, though.[/li]</p>
<p>[li]The Session Manager idea is bad. In its current form it denies access to 3G/4G<br>
connections for example, which seems a silly idea in 2015’s mobile world.[/li]</p>
<p>[li]Am I confused, or is there no way to differentiate between different verbs in<br>
routes, ie. I cannot route GET /games and POST /games to different controller<br>
actions?[/li]</p>
<p>[li]You have view code in your model for UserService.php. The whole point of<br>
the exercise is so that stuff isn’t in there…[/li][/ul]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/4</link>
        <pubDate>Wed, 13 May 2015 13:03:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-4</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@MiCaDev MiCaDev]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/micadev">@MiCaDev</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="551489">
<div class="title">
<div class="quote-controls"></div>
 Vain_:</div>
<blockquote>
<p>replied for more</p>
</blockquote>
</aside>
<p>Thanks mate</p>
<p>[SIZE=4]Step 6:[/SIZE] Creating the base template as required by step 5.2.<br>
Now head over to the [B]/public_html/app/Resources/Views[/B] directory (Create if needed DUH!) and create the file: [B]base.twig[/B]<br>
Note: The code bellow is code of my web application as i said before HTML and CSS is all up to you.</p>
<pre><code class="lang-auto">{% spaceless %}
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;!-- SEO WORD ENKEL TOEGEPAST OP DE OUTGAME PAGINA'S! --&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" /&gt;
        &lt;base href="{{ docRoot }}"/&gt;
        &lt;title&gt;{{ PAGE_TITLE }}&lt;/title&gt;
        &lt;meta property="og:title" content="{{ PAGE_TITLE }}" /&gt; &lt;!-- FB --&gt;
        &lt;meta property="og:type" content="game" /&gt; &lt;!-- FB --&gt;
        &lt;meta property="og:image" content="{{ docRoot }}{{ PAGE_IMAGE }}" /&gt; &lt;!-- FB --&gt;
        &lt;meta property="og:url" content="{{ PAGE_URL }}" /&gt; &lt;!-- FB --&gt;
        &lt;meta property="og:description" content="{{ PAGE_DESCRIPTION }}" /&gt;
        &lt;meta property="og:site_name" content="Mafiasource" /&gt;
        &lt;meta property="DC.title" content="{{ PAGE_TITLE }}" /&gt; 
        &lt;meta property="DC.subject" content="{{ PAGE_SUBJECT }}" /&gt; 
        &lt;meta property="DC.description" content="{{ PAGE_DESCRIPTION }}" /&gt;
        &lt;meta property="DC.format" content="text/html" /&gt;
        &lt;meta property="DC.publisher" content="{{ AUTHOR }}" /&gt;
        &lt;meta property="DC.language" content="nl-BE" /&gt;  
        &lt;meta name="description" content="{{ PAGE_DESCRIPTION }}" /&gt;
        &lt;meta name="keywords" content="{{ PAGE_KEYWORDS }}" /&gt;
        &lt;meta name="google-site-verification" content="1pdpzSKdcZBpNYkkzZ0z3Sqxb9FXcZz4eJmolTUHFU8" /&gt;
        &lt;meta name="geo.region" content="nl-BE" /&gt; 
        &lt;meta name="geo.placename" content="Deerlijk,Belgium" /&gt; 
        &lt;meta name="geo.position" content="50.8683762,3.2712771" /&gt; 
        &lt;meta name="ICBM" content="50.8683762,3.2712771" /&gt;
        &lt;link rel="publisher" href="https://plus.google.com/u/0/117401061808919535014"/&gt;
        &lt;link rel="icon" href="{{ docRoot }}/web/public/images/favicon.ico" type="image/x-icon" /&gt;
        &lt;link rel="shortcut icon" href="{{ docRoot }}/web/public/images/favicon.ico" type="image/x-icon" /&gt;
        &lt;link rel="apple-touch-icon" href="{{ docRoot }}/web/public/images/favicon.ico" /&gt;
        &lt;link href="{{ docRoot }}/web/public/bootstrap/css/bootstrap.min.css" rel="stylesheet" /&gt;
        &lt;link href="{{ docRoot }}/web/public/css/homepage.css" rel="stylesheet" /&gt;
        &lt;link href='http://fonts.googleapis.com/css?family=Pathway+Gothic+One' rel='stylesheet' type='text/css' /&gt;
        &lt;!-- Twig stylesheets --&gt;
        {% block stylesheets %} {% endblock stylesheets %}
    &lt;/head&gt;
    &lt;body&gt;
        &lt;!-- Header --&gt;
        {% block header %}
        &lt;header id="top" class="header"&gt;
            &lt;div class="container"&gt;
                {% block message %}{% endblock message %}
            &lt;/div&gt;
        &lt;/header&gt;
        {% endblock header %}
        &lt;!-- /Header --&gt;
        &lt;!-- Navigation --&gt;
        {% block navigation %}
        &lt;aside id="nav"&gt;
            &lt;nav class="navbar navbar-new" role="navigation"&gt;
                &lt;div class="container"&gt;
                   
                &lt;/div&gt;
            &lt;/nav&gt;
        &lt;/aside&gt;
        {% endblock navigation %}
        &lt;!-- /Navigation --&gt;

        {% block content %}
        {% endblock content %}

        {% block footer %}
        &lt;!-- Footer --&gt;
        &lt;footer&gt;
            &lt;div class="container"&gt;
                &lt;div class="row"&gt;
                    &lt;div class="col-md-6 col-md-offset-3 text-center"&gt;
                        &lt;em&gt;Copyright &amp;copy; 2014 Mafiasource.be&lt;/em&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/footer&gt;
        &lt;!-- /Footer --&gt;
        {% endblock footer %}
        &lt;!-- Bootstrap core JavaScript --&gt;
        &lt;script src="{{ docRoot }}/web/public/js/default/bootstrap.jquery.min.js"&gt;&lt;/script&gt;
        &lt;!-- Google Analytics --&gt;
        &lt;script&gt;
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
          ga('create', 'UA-49957889-1', 'mafiasource.be');
          ga('send', 'pageview');
        &lt;/script&gt;
        &lt;!-- End Google Analytics --&gt;
        &lt;!-- Twig javascripts --&gt;
        {% block javascripts %} {% endblock %}
    &lt;/body&gt;
&lt;/html&gt;
{% endspaceless %}</code></pre>
<p>Now important to know is that in our not found view we extended this above view.<br>
But in our base view we will see something like: block content notice that we also used block content in our not_found view but there we inserted the content we needed.</p>
<p>not_found view inherits from base view while not_found view inserts content in the base view.<br>
Also you see that in our not_found view we used the block footer too, but it’s empty. This means the footer will not be visible on the page not_found.<br>
However if you do add content in the footer block in your not_found view it wil simply replace the base footer.<br>
And this is a great way of templating your HTML / CSS with twig cause you can actualy build HTML programaticly.</p>
<pre><code class="lang-auto">{% %} Are logic statements ex: if else construction, a loop but can also form a block as explained above.
{{ }} Are variables to be printed out (Variables you have defined in the controller with $twigVars().
{# #} Makes comments possible
Also make sure to check out Twigs documentation, you wil get a much better understanding of it all.</code></pre>
<p>In the above base.twig code you see i require some twig varables (ex: {{ PAGE_TITLE }} ) to be printed, if you have followed this tutorial from the beginning you would know how to fix it.<br>
Note that Twig has everything needed to replace PHP for templating! If you realy get stuck with outputing data you are doing it wrong.</p>
<p>Also important is that when you have created the base template it should never be changed again unless you want to change your whole layout.<br>
You can simply build your blocks with standard content like a header and a navigation and a footer but all you ever have to change is the content of the page and the SEO tags of the page.<br>
That’s why i work with the {{ }} print out’s in my header tag. Depending on what page i might get another title, description, keywords, image, og,dc tags …</p>
<p>[SIZE=4]Final step:[/SIZE] Using the Modal in the controller a quick view of what you can do READ AND LEARN.<br>
Remember this ?</p>
<pre><code class="lang-auto">/*
use src\Business\UserService;

$user = new UserService();
$userProfile = $user-&gt;getUserProfile();

$loggedIn = false;
if($userProfile) $loggedIn = true;
*/</code></pre>
<p>That was an example of a controller interacting with it’s modal. Just create the Modal in it’s right directory: [B]/public_html/src/Business[/B] as UserService.php<br>
Now our controller “Uses” this class.<br>
In this class we can handle all our users logic wheter someone is logging in or out, or writing a post or even changing their password.<br>
Note: we have not yet written any HTML form to interact with users so don’t start dreaming.</p>
<p>Now Me Myself and I like to get my business and data seperate.<br>
For that i create another folder in src/ named Data.<br>
Every business class wil have it’s own Data class if the class need’s to interact with a database.</p>
<p>En example of UserService.php could be:</p>
<pre><code class="lang-auto">&lt;?PHP

namespace src\Business;

use src\Data\UserDAO;
use src\Language\Lang;

class UserService
{
    private $data;
    
    public function __construct()
    {
        $this-&gt;data = new UserDAO(); //Get class where data is handled opens connection.
    }
    
    public function __destruct()
    {
        $this-&gt;data = null; //Close connection on destruct.
    }
}</code></pre>
<p>As you can see our Business layer for UserService also uses the UserDAO data class.<br>
In that class there will be all functions to edit, insert, select,… anything related to our database.</p>
<p>Now for the data class in [B]/public_html/src/Data[/B] as UserDAO.php for example:</p>
<pre><code class="lang-auto">&lt;?PHP

namespace src\Data;

use src\Data\config\DBConfig;

//User Data class

class UserDAO extends DBConfig
{
    private $dbh = '';
    
    public function __construct()
    {
        parent::__construct();
        $connection = new DBConfig();
        $this-&gt;dbh = $connection-&gt;con;
    }
    
    public function __destruct()
    {
        $this-&gt;dbh = null;
    }
}</code></pre>
<p>You might think everything is done now but we still have one more class to make wich is connecting to our database.<br>
After that we can start creating functions in the DAO class with PDO in mind (Better way to handle MySQL) You can look it all up on google.</p>
<p>So our DBConfig.php file goes into [B]/public_html/src/Data/config[/B] with following code:</p>
<pre><code class="lang-auto">&lt;?PHP

namespace src\Data\config;

use PDO;

class DBConfig
{
    protected $dbConstring = "mysql:host=DatabaseHost;dbname=DatabaseName";
    protected $dbUser = "DatabaseUser";
    protected $dbPass = "DatabasePass";
    public $con = null;
    public $error;
    
    public function __construct()
    {
        $this-&gt;connect();
    }
    
    public function __destruct()
    {
        $this-&gt;disConnect();
    }
    
    public function connect()
    {
        //Only connect when connection is null to prevent multiple connections and lag.
        if($this-&gt;con == null)
        {
            try
            {
                $this-&gt;con = new PDO($this-&gt;dbConstring,$this-&gt;dbUser,$this-&gt;dbPass);
                $this-&gt;con-&gt;setAttribute(PDO::ERRMODE_SILENT,PDO::ERRMODE_EXCEPTION);
            }
            catch(\PDOException $e)
            {
                $this-&gt;error = $e-&gt;getMessage();
                die('An error occured while connecting to the database. Please try again later.');
            }
        }
    }
    
    public function disConnect()
    {
        $this-&gt;con = null;
    }
}</code></pre>
<p>Congratulations you have have a working MVC pattern.<br>
I have still not explained how to query though so here’s the thing i’m going to check if a username exsist in my database.</p>
<p>The following code goes in the UserService class as a function:</p>
<pre><code class="lang-auto">    public function checkUsernameExsists($username)
    {
        return $this-&gt;data-&gt;checkUsernameExsists($username);
    }</code></pre>
<p>As you can see it returns a function from the data class wich does not exsist yet. Up to us to create the function and the query.</p>
<p>The next code goes into UserDAO class as a function:</p>
<pre><code class="lang-auto">    public function checkUsernameExsists($username)
    {
        $statement = $this-&gt;dbh-&gt;prepare("SELECT `id` FROM `users` WHERE `username` = :username ");
        $statement-&gt;execute(array(':username' =&gt; $username)); //Remember to handle all user input this way to prevent SQL injection!
        if($statement-&gt;fetchColumn() &gt; 0)
        {
            return TRUE;
        }
        else
        {
            return FALSE;
        }
    }</code></pre>
<p>And this is how we query in our application.</p>
<p>So te get back to our not_found controller we can actualy interact with our modal layer, where our modal layer can interact with the database itself with a seperate class.<br>
If we now edit our not_found controller like so:</p>
<pre><code class="lang-auto">&lt;?PHP
use src\Business\UserService;

$user = new UserService();
$username = "MiCa";
$bool = $user-&gt;checkUsernameExsists($username);

//We don't want to render our PHP variables inside the template so we simply convert them to Twig variables (wich is actualy a simple array with data) with folowing line of code:
$twigVars = array('docRoot' =&gt; "http://".$_SERVER['HTTP_HOST']."",'routing' =&gt; $route, 'usernameExsists' =&gt; $bool);
//Render notfound template and include all variables needed to render the template so for us the $twigVars
echo $twig-&gt;render('/src/Views/notfound.twig',$twigVars);</code></pre>
<p>The only variables we can now use in our Twig rendered page are: ‘docRoot’ =&gt; “http://”.$_SERVER[‘HTTP_HOST’]."",‘routing’ =&gt; $route,‘usernmeExsists’ =&gt; $bool  (as listed above)<br>
If we echo them in our notfound.twig page like so:</p>
<pre><code class="lang-auto">{% extends "/app/Resources/Views/base.twig" %}

{% block content %}
        &lt;section id="top" class="notFound"&gt;
            &lt;div class="not-found-page"&gt;
                &lt;div class="container"&gt;
                    {{ docRoot }}&lt;br /&gt;
                    {{ routing.getRoute }}&lt;br /&gt;
                    {% if UsernameExsists %}
                            True
                    {% else %}
                            False
                    {% endif %}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;
{% endblock content %}
{% block footer %}{% endblock footer %}</code></pre>
<p>Now f we browse to our websiteurl.ex/notfound<br>
We will get the right results first line echoes the website url, the second echoes the current route and the last line echoes true or false.<br>
However if you output {{ routing }} it would give you an twig error as you cannot convert a class into a string.<br>
Also good to know is that {{ var|raw }} can output HTML data too.</p>
<p>However if we now just browse to websiteurl.ex or websiteurl.ex/index we will get a PHP error including index.php from Controllers as it does not exsist yet.<br>
But we did setup a route for it already, that’s why it give’s us the error. You could now try browse any other possible url you didn’t setup yet, it would direct you to not found page.<br>
Up to you to code the controller and style the view template (Step 5.1 &amp; Step 5.2). Goodluck!</p>
<p>Thank you for reading this tutorial!<br>
Remember that you now have to power to contain your whole code:</p>
<ul>
<li>If you know whats wrong you now know how to fix it and where to fix it.</li>
<li>No more messy one script editting since it can bug up the rest of your application.</li>
<li>Logic handling with classes and objects. (Java alike)</li>
<li>You can now use the same functions code everywhere you want instead of copy pasting / where eventualy yo get bugs too because of editting one and forgetting the other… (Class functions ex: UserService.php)</li>
</ul>
<p>Is there something wrong with this tutorial or do you need help? Please message me.</p>
<p>My next tutorial will be using objects instead of plain variables, it will teach you to insert data in an object and retrieve it as an object.<br>
It will be based on this tutorial and we wil be making a working user login / register / logout.</p>
<p>Regards,<br>
MiCa</p>
<p>Excuse me for any misspelling.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/3</link>
        <pubDate>Wed, 13 May 2015 11:26:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-3</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@Vain1 Vain_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/vain1">@Vain1</a> wrote:</p>
          <blockquote>
              <p>replied for more</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/2</link>
        <pubDate>Wed, 13 May 2015 01:36:24 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-2</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
      <item>
        <title>Introduction to MVC: Writing your large web applications with logic</title>
        <dc:creator><![CDATA[@MiCaDev MiCaDev]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/micadev">@MiCaDev</a> wrote:</p>
          <blockquote>
              <p>Hello Moparscape users,</p>
<p>I was quite surprised when i saw the download section full of small to large projects written in plain old PHP.<br>
Made me want to create this tutorial for all web developers who want to learn something new or want to improve their coding skills as they can better observe and contain their code.<br>
MVC is much Java alike where PHP makes it possible to work with classes and objects.</p>
<p>I do not state that this is the best way of programming but i can say it will save you alot of time when you are building a web application with allot of pages and logic to be handled.<br>
However if you are bulding a RSPS website with nothing more than like 5 pages: this setup should be a waste of time.</p>
<p>[B]What is MVC ?[/B]<br>
In terms it speaks of a Modal (class) a View (template ex:HTML/CSS) and a Controller (class but i prefer plain PHP code in there as i can commit actions depending on what request is send OR URI is requested.)<br>
I’m also going to introduce people to using a one index controller for their web application, and using a templating engine like twig for faster and understandable twig code template rendering.</p>
<p>[SIZE=4]The setup:[/SIZE]Before we begin we will need all of the following resources.</p>
<ul>
<li>An editor for both PHP / HTML and CSS code is recommended (May show you errors before you even debug) i use PHPDesigner wich u can find here: <a href="http://www.mpsoftware.dk/phpdesigner.php" data-bbcode="true" rel="nofollow noopener">phpDesigner 8 - PHP Editor &amp; PHP IDE with built-in HTML5, JavaScript, CSS3 editor! | MPSOFTWARE</a>
</li>
<li>Twig library to implent in our source later: [URL=http://“<a href="https://github.com/twigphp/Twig/tags" rel="nofollow noopener">https://github.com/twigphp/Twig/tags</a>”]<a href="https://github.com/twigphp/Twig/tags%5B/URL%5D" rel="nofollow noopener">https://github.com/twigphp/Twig/tags[/URL]</a> download the latest version and extract[B] /Twig(version)/lib/Twig[/B] somewhere save for later use.</li>
<li>Autoloading class wich is include in doctrine common files: [URL=http://“<a href="https://github.com/doctrine/common" rel="nofollow noopener">https://github.com/doctrine/common</a>”]<a href="https://github.com/doctrine/common%5B/URL%5D" rel="nofollow noopener">https://github.com/doctrine/common[/URL]</a> download and extract[B] /common_master/lib/Doctrine[/B] somewhere save.</li>
<li>Last but not least a session manager to stop session hijackers: [URL=http://“<a href="http://mafiasource.be/sessionManager.txt" rel="nofollow noopener">http://mafiasource.be/sessionManager.txt</a>”]<a href="http://mafiasource.be/sessionManager.txt%5B/URL%5D" rel="nofollow noopener">http://mafiasource.be/sessionManager.txt[/URL]</a> The one i use feel free to add your own proxies and stuff.</li>
</ul>
<p>[SIZE=4]Starting off:[/SIZE] in public_html we will now create our application tree for example:</p>
<pre><code class="lang-auto">/app                     Here we keep our application cache, configurations and standard base templates.
/src                      Here we can find our source code where our Models, Views and Controllers will be present maybe even Language packets.
/vendor                An easy way to keep all of our 3rd library files for example doctrine and facebook api (We will not place Twig in there)
/web                    The directory where our front-controller is present (index.php) and we have 2 sub directories: one for web/lib and one for web/public.
/web/lib/              Here we wil upload our extracted Twig map.
/web/public          Where every resource that has to be accessible from the web application is present. (ex: ajax, images, css, bootstrap, js)
.htaccess
robots.txt
sitemap.xml</code></pre>
<p>[SIZE=4]Step 1:[/SIZE] Creating the .htacces file to link all browser users to the same page on every request. (our front controller in /web/index.php )<br>
This step is very important, we don’t want our users the browse every single page itself why don’t we create one single page to proccess all of our actions?</p>
<p>So mmediatly in public_html you create a new file (if not already exsist) and name it .htaccess write following code:</p>
<pre><code class="lang-auto">DirectoryIndex /web/index.php
Options -Indexes
&lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{REQUEST_URI} /sitemap.xml #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteRule .* - [S=99999999999999]          #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteCond %{REQUEST_URI} /robots.txt     #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteRule .* - [S=99999999999999]          #These are lines that have to be manualy accessible for SEO optimalisation
    RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
    RewriteRule ^(.*) - [E=BASE:%1]
    RewriteCond %{ENV:REDIRECT_STATUS} ^$
    RewriteRule ^web\index\.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]
    RewriteRule .? %{ENV:BASE}/web/index.php [L]
&lt;/IfModule&gt;

&lt;IfModule !mod_rewrite.c&gt;
    &lt;IfModule mod_alias.c&gt;
        RedirectMatch 302 ^/$ /web/index.php/
    &lt;/IfModule&gt;
&lt;/IfModule&gt;</code></pre>
<p>This code literaly says when the reqquest uri is /sitemap.xml ignore next 99999999999999 lines of code than it checks if the request uri is /robots.txt, and yes you already guessed it.<br>
If none of these matches so any other possible URI, it will direct the user to /web/index.php.</p>
<p>[SIZE=4]Step 2:[/SIZE] Creating the front controller /web/index.php.<br>
In our front-controller we will setup:</p>
<ul>
<li>strict error reporting for debuging.</li>
<li>Make use of the PHP Use statements and implent the autoloading to use the use statements correctly.</li>
<li>Setup the session manager</li>
<li>Setup a routing system for router -&gt; controller.</li>
</ul>
<p>Before we can start writing the index controller we need to make sure we can use the session manager, the autoloading class and the twig engine, to do so please upload the previously saved Doctrine map to [B]/public_html/vendor[/B] you now have: public_html/vendor/Doctrine.<br>
Now for the session Manager you can upload it directly to [B]/public_html/vendor[/B] make sure to save it as a PHP extension and not a TXT (like i uploaded).<br>
At last upload the previously saved Twig map to [B]/public_html/web/lib[/B]</p>
<p>Index.php front controller:</p>
<pre><code class="lang-auto">&lt;?PHP
/**
 * Front controller - all requests  GET / POST are processed here
 * @author Michael Carrein
 **/

//Error reporting
ini_set('display_errors',1);
ini_set('display_startup_errors',1);
error_reporting(-1);

//Use statements
use Doctrine\Common\ClassLoader;
use app\config\Routing;

/** Session manager  **/
require_once __DIR__.'/../vendor/sessionManager.php';
SessionManager::sessionStart('Website name', 0, '/', $_SERVER['HTTP_HOST'], false); // Does the same as session_start(); but in a more secure way. **/

/** Routing &amp; controllers **/
require_once __DIR__.'/../app/config/routing.php';
$route = new Routing();
if($route-&gt;getController() != FALSE) //If we get a valid controller it will execute following code
{
    define("DOC_ROOT", $_SERVER['DOCUMENT_ROOT']); 
    
    /** Autoloading with doctrine so we never have to include or require again (Just use statements)**/
    require_once DOC_ROOT . '/vendor/Doctrine/Common/ClassLoader.php';
    $classLoader = new ClassLoader('src'   ,   DOC_ROOT);
    $classLoader-&gt;register();
    
    /** Twig engine  **/
    require_once __DIR__.'/lib/Twig/Autoloader.php';
    Twig_Autoloader::register();
    $loader = new Twig_Loader_Filesystem(DOC_ROOT); //Load Twig templates from root
    $twig = new Twig_Environment($loader, array(
        'cache' =&gt; FALSE //DOC_ROOT . '/app/cache/TwigCompilation/', //Cache or no cache ?
    ));

    $_SESSION['DOC_ROOT'] = DOC_ROOT;
    
    /** Get requested controller **/
    if(file_exists(__DIR__.'/../src/Controllers/'.$route-&gt;getController()))
    {
        if($route-&gt;getController() != "notfound.php" &amp;&amp; $route-&gt;getController() != "languageSelect.php")
        {
            $route-&gt;setPrevRoute(); //Save previous route
        }
        include __DIR__.'/../src/Controllers/'.$route-&gt;getController();
    }
}</code></pre>
<p>And again, the user will always be browsing on this page no mather what.<br>
This index file is the only file we will be using require or include functions (PHP) because this is our front-controller and our autoloading class will only be triggered once there’s an exsisting route.<br>
In the rest of the application we can use the use statements to autoload a class instead of require / include every time. (Because when a user reaches another part of the application (Ex. a controller) he requested an exsisting route)<br>
Remember: you can only autoload classes and no plain PHP files.<br>
Important to notice is that every class that needs to be able to be autoloaded is going to get a namespace. This namespace is the directory the class is in. and don’t mis it’s \ instead of / for both namespace and use statements to jump directories.</p>
<p>If you have read the code you saw some incompleted code wich is routing and controllers.</p>
<p>[SIZE=4]Step 3:[/SIZE] Creating the routing class and seting up the routes and controllers.<br>
You might ask yourself what the * are routes?<br>
As we don’t direct our user to every single page anymore we need some kind of routing system te determine wheter a users is loggin in or reading the news or registering …<br>
Routes are the URI’s requested in our browser as we can create every route ourselfs we can create beautifull SEO applications too.<br>
Example of a route (bold): <a href="http://v3.mafiasource.be" data-bbcode="true" rel="nofollow noopener">http://v3.mafiasource.be</a>[B]/game/summary/info[/B]</p>
<p>Now before we can setup the routes and controllers we need a routing class i have written quite a good routing class for you already:</p>
<pre><code class="lang-auto">&lt;?PHP

namespace app\config;

use src\Data\seoDAO;

/**
 * Routing class
 **/

class Routing
{
    
    private $route;
    
    private $routeName;
    
    private $controller;
    
    public $routeMap = array();
    
    public $prevRoute;
    
    public function __construct() //If class is requested this function is called immediatly
    {
        include __DIR__.'/routes/routes.php'; //Where we define our routes see Step 4 of this tutorial. And yes we use include because an array is not a class and can not be autoloaed.
        
        $this-&gt;routeMap = $applicationRoutes; //Put our defined routes in the routeMap
        /**
         * At the for loop you define from wich directory the routes start.
         * Caution: as we root our web app in public_html/web/ we use $i = 1;
         **/
        $requestURI = explode('/', $_SERVER['REQUEST_URI']);
        $routes = array();
        for($i = 1; $i &lt; count($requestURI); $i++)
        {
            $val = $requestURI[$i];
            array_push($routes,$val);
        }
        $endRoute = "";
        foreach($routes AS $value)
        {
            $endRoute .= '/'.$value;
        }
        
        $controller = false;
        
        //Now check wheter a user requested a route defined in routes.php (Step 4)
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if(preg_match('{^'.$value['route'].'$}', $endRoute))
            {
                $controller = $value['controller'];
                $routeName = $key;
            }
        }
        
	//Now check if the route exsist depending on what controller you retrieve.
        if($controller != false)
        {
	    //Setup page parameters
            $this-&gt;route = $endRoute;
            $this-&gt;controller = $controller;
            $this-&gt;routeName = $routeName;
        }
        else
        {
	    //Generate not found page
            $this-&gt;route = '/notfound';
            $this-&gt;controller = 'notfound.php';
        }
    }
    
    //Get previous route for redirects $route-&gt;getPrevRoute();
    public function getPrevRoute()
    {
        if(isset($_SESSION['PREV_ROUTE']))
        {
            return $_SESSION['PREV_ROUTE'];
        }
        else
        {
            return $_SESSION['PREV_ROUTE'] = $_SERVER['REQUEST_URI'];
        }
    }
    
    //Set prev route happens on every request already
    public function setPrevRoute()
    {
        $_SESSION['PREV_ROUTE'] = $_SERVER['REQUEST_URI'];
    }
    
    public function headTo($routeName)
    {
        /**
         * Replaces the header('Location: '); function now you can use $route-&gt;headTo("ROUTENAME (see Step 4)");
         * **/
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if($key == $routeName)
            {
                header("Location: " . $value['route']);
                exit(0);
            }
        }
    }
    
    public function getRouteByRouteName($routeName)
    {
        foreach($this-&gt;routeMap AS $key =&gt; $value)
        {
            if($key == $routeName)
            {
                return $value['route'];
            }
        }
    }
    
    public function getRoute()
    {
        return $this-&gt;route;
    }
    
    public function getRouteName()
    {
        return $this-&gt;routeName;
    }
    
    public function getController()
    {
        return $this-&gt;controller;
    }
}</code></pre>
<p>And as you can see in index.php (front controller) you see this belongs in <span class="bbcode-b">/public_html/app/config</span> as: routing.php<br>
Now we need to keep in mind that we have aleady setup a routing and if the route doesn’t exsist we throw a not found page, so in step 4 we will create the routes and in step 5 we will create our not found page.</p>
<p>[SIZE=4]Step 4:[/SIZE] Defining the routes in a PHP array file.<br>
For SEO optimalisation many search engines state that you have “beautiful” urls, those urls don’t contain any special characters like &amp;,? wich is common used in form submit.<br>
With our own routing we can setup the routes the way we want it i will give some great examples allong the way.</p>
<p>This array goes into [B]/public_html/app/config/routes[/B] as routes.php:</p>
<pre><code class="lang-auto">&lt;?PHP
        /** 
         * Define all possible routes
         * 
         * @RouteName = The name you want to give the route for ex. $route-&gt;headTo("@RouteName");
         * @RoutePath = The requested URI
         * @Controller = The controller to execute when Route matches. (remember in our index.php front controller we have defined the controller map to be at /public_html/src/Controllers there is where we handle our controllers.)
         * 
         * A little example with / (root)
         * Routes with random PHP vals can be found by preg_match(); wich routing already does, here we just need to use the regex. (check example 1 and 2 below)
         **/
        $applicationRoutes =
        array(
            /**
             * @RouteName
             **/
            'home'
            =&gt; 
            array(
                /**
                 * @RoutePath
                 **/
                'route' =&gt; '/',
                
                /**
                 * @Controller
                 **/
                'controller' =&gt; 'index.php'
            ),
	    
	    'index'
	    =&gt;
	    array(
		'route' =&gt; '/index',
		'controller' =&gt; 'index.php'
	    ),

	    'not_found'
            =&gt; 
            array(
                'route' =&gt; '/notfound',
                'controller' =&gt; 'notfound.php'
            )//,
	    
	    //Example 1: Working with page numbers
	    //'news_page'
	    //=&gt;
	    //array(
	    //	'route' =&gt; '/news/page/[1-9][0-9]*',
	    //	'controller' =&gt; 'news.php'
	    //),
	    
	    //Example 2: working with news titels
	    //'news_article'
	    //=&gt;
            //array(
	    //	'route' =&gt; '/news/article/[A-Za-z0-9-]{3,200}',
	    //	'controller' =&gt; 'news_article.php'
	    //)
	);</code></pre>
<p>Now it’s up to you to define all routes needed for your web application and link them with the correct controllers.</p>
<p>[SIZE=4]Step 5:[/SIZE] Creating the not found page with 2 sub steps. (Now it’s actualy all about creating the pages)<br>
Gratz you have succesfully finished your setup to start working realy fast and realy productive in the future!</p>
<p>[SIZE=2]Sub step 1:[/SIZE] Creating the controller<br>
Now once we create the controller we can handle every possible action for that page. Depending on what action you do you might get another page…<br>
This is where the view comes in handy.</p>
<p>Our not_found controller wich should be in [B]/public_html/src/Controllers[/B] as notfound.php (Like defined in the routes)</p>
<pre><code class="lang-auto">&lt;?PHP
/*
 * This code are examples of how logic should be processed in the controller using layers wich get autoloader by our Doctrine autoloading class using the use statements.
use src\Business\UserService;

$user = new UserService();
$userProfile = $user-&gt;getUserProfile();

$loggedIn = false;
if($userProfile) $loggedIn = true;
*/

//We don't want to render our PHP variables inside the template so we simply convert them to Twig variables (wich is actualy a simple array with data) with folowing line of code:
$twigVars = array('docRoot' =&gt; "http://".$_SERVER['HTTP_HOST']."",'routing' =&gt; $route);
//Render notfound template and include all variables needed to render the template so for us the $twigVars
echo $twig-&gt;render('/src/Views/notfound.twig',$twigVars);</code></pre>
<p>Yes, our controller can be as simple as that because we just need to render a template wich says that the page was not found.</p>
<p>[SIZE=2]Sub step 2:[/SIZE] Creating the not_found view. (The html page the user sees)<br>
Now in our view we will be learning nothing more than HTML and a little bit of Twig (for advanced twig options please refer to their website)<br>
Simply create [B]notfound.twig[/B] in [B]/public_html/src/Views[/B] with following code:</p>
<pre><code class="lang-auto">{% extends "/app/Resources/Views/base.twig" %}

{% block content %}
{#
    Example of how if else block works in twig
    {% if loggedIn == true %}
        {% include "/app/Resources/Views/base_ingame_static_nav.twig" %}
    {% else %}
        {% include "/app/Resources/Views/base_outgame_static_nav.twig" %}
    {% endif %}
#}
        &lt;section id="top" class="notFound"&gt;
            &lt;div class="not-found-page"&gt;
                &lt;div class="container"&gt;
                    &lt;div class="row not-found-kol"&gt;
                        &lt;div class="col-md-4"&gt;
                            &lt;img class="img-rounded img-responsive" alt="Company Logo" src="/web/public/images/logo.png"/&gt;
                        &lt;/div&gt;
                        &lt;div class="col-md-8"&gt;
                            &lt;!--
                            &lt;div class="not-found"&gt;
                                &lt;div class='alert alert-warning'&gt;
                                    &lt;h4&gt;&lt;span class="glyphicon glyphicon-ban-circle"&gt;&lt;/span&gt;Page doens't exsist!&lt;/h4&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            --&gt;
                            &lt;iframe src="http://notfound-static.fwebservices.be/404/index.html?&amp;amp;key=c3246892335c83e0a507e07c4f824a45" width="100%" height="650" frameborder="0"&gt;&lt;/iframe&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/section&gt;
{% endblock content %}
{% block footer %}{% endblock footer %}</code></pre>
<p>Note: as you can see my HTML mockup is already styled and has used some bootstrap classes.<br>
It’s totaly up to you to code your HTML the way you want it.<br>
Now the realy IMPORTANT part here is notice the first line of code ?</p>
<p>The not found template actualy extends another template, so in simple terms my not_found content actualy gets included in my base HTML mockup.</p>
<p>Step 6 and final step are comming if someone is willing to reply something.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489/1</link>
        <pubDate>Tue, 12 May 2015 12:32:37 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-551489-1</guid>
        <source url="https://forum.moparisthebest.com/t/introduction-to-mvc-writing-your-large-web-applications-with-logic/551489.rss">Introduction to MVC: Writing your large web applications with logic</source>
      </item>
  </channel>
</rss>
