<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Referral System</title>
    <link>https://forum.moparisthebest.com/t/referral-system/546008</link>
    <description>&lt;blockquote&gt;Refer your friends to get 2 mystery boxes for yourself and your friend gets one! Here&#39;s how it works:

1. You get a new 10 digit referral code.
[img]http://puu.sh/aG7Lb/2d9a932c76.png[/img]
Interested in how its generated? Here ya go!
[code]
    private void generateReferralCode() {
        String[] string = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;.split(&quot;&quot;);
        String code = &quot;&quot;;
        for (int i = 0; i &lt; 10; i++) {
            code = code + string[Utils.random(0, string.length - 1)];
        }
        if (!checkReferralCode(code)) {
            generateReferralCode();
            return;
        }
        FileLogger.logData(&quot;referralCodes&quot;, code + &quot; - &quot; + username);
        referralCode = code;
    }
[/code]

2. Tell your friend your code. Wait for them to log in. When they do log in, they&#39;ll see something like this (after designing their character):
[img]http://puu.sh/aG7SX/d28c259674.png[/img]
3. Tell your friend to put the code in this dialogue box.
[img]http://puu.sh/aG7Xm/88aa51165b.png[/img]
4. Enjoy your gifts!
[img]http://puu.sh/aG8bL/bf51874c17.png[/img]&lt;/blockquote&gt;

[i]Please don&#39;t take this as advertising.[/i]

You need this FileLogger system before continuing:
[code=java]
package com.rs.game;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * Provides a lightweight external data logger
 *
 * @author Octave
 * @date 2/1/13
 */

public class FileLogger {

    /**
     * Log file path
     */
    private static final String FILE_PATH = &quot;./data/logs/&quot;;

    /**
     * Formats data before appending to log
     *
     * @param file - File to write data to
     * @param data - Data to written
     * @throws IOException
     */
    public static void logData(String file, String[] data) {
        try {
            writeData(file, formatStringArray(data));
        } catch (Exception e) {
            System.out.println(&quot;Fatal error while logging Data!&quot;);
        }
    }

    public static void logData(String file, String data) {
        try {
            writeData(file, data);
        } catch (Exception e) {
            System.out.println(&quot;Fatal error while logging Data!&quot;);
        }
    }

    /**
     * Format string array to proper log syntax
     *
     * @param origin - string to format
     * @return Array to string, formatted
     */
    private static String formatStringArray(String[] origin) {
        StringBuffer result = new StringBuffer();
        for (int i = 0; i &lt; origin.length; i++) {
            result.append(origin[i] + &quot;\t&quot;);
        }
        String mynewstring = result.toString();
        return mynewstring;
    }

    /**
     * Fetches system time and formats it appropriately
     *
     * @return Formatted time
     */
    private static String getTime() {
        Date getDate = new Date();
        String timeFormat = &quot;M/d/yy hh:mma&quot;;
        SimpleDateFormat sdf = new SimpleDateFormat(timeFormat);
        return &quot;[&quot; + sdf.format(getDate) + &quot;]\t&quot;;
    }

    /**
     * Writes formatted string to text file
     *
     * @param file - File to write data to
     * @param data - Data to written
     * @throws IOException
     */
    private static void writeData(String file, String writable)
            throws IOException {
        FileWriter fw = new FileWriter(FILE_PATH + file + &quot;.txt&quot;, true);
        try {
            fw.write(getTime() + writable);
            fw.write(&quot;\n&quot;);
            fw.close();
        } catch (Exception e) {
            fw.write(&quot;Error processing data: &quot; + e);
        }
    }

    public static void eraseFile(String name) {
        try {
            File file = new File(FILE_PATH + name + &quot;.txt&quot;);
            file.delete();
            System.out.println(name + &quot; logs automatically cleaned.&quot;);
            writeData(name,
                    &quot;\t &lt;----------------- File automatically cleaned -----------------&gt;&quot;);
        } catch (Exception e) {
            System.out.println(&quot;Failed to clean logs.&quot;);
        }
    }

}[/code]

Also, in the data folder, make a new folder called logs.

Anyways, in Player.java, add this anywhere:
[code=java]
    private String referralCode;
    private boolean pendingItems;

    private void generateReferralCode() {
        String[] string = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;.split(&quot;&quot;);
        String code = &quot;&quot;;
        for (int i = 0; i &lt; 10; i++) {
            code = code + string[Utils.random(0, string.length - 1)];
        }
        if (!checkReferralCode(code)) {
            generateReferralCode();
            return;
        }
        FileLogger.logData(&quot;referralCodes&quot;, code + &quot; - &quot; + username);
        referralCode = code;
    }

    public boolean checkReferralCode(String code) {
        try {
            BufferedReader reader = new BufferedReader(new FileReader(&quot;./data/logs/referralCodes.txt&quot;));
            String line = null;
            while ((line = reader.readLine()) != null) {
                if (line.contains(code))
                    return false;
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return true;
    }

    public void setReferralCode(String referralCode) {
        this.referralCode = referralCode;
    }

    public void setPendingItems(boolean pendingItems) {
        this.pendingItems = pendingItems;
    }[/code]

Now go to the run method and add the following:
[code=java]
        if (referralCode == null)
            generateReferralCode();
        if (referralCode != null)
            getPackets().sendGameMessage(&quot;Your referral code is &quot; + referralCode + &quot;.&quot;);
        if (pendingItems) {
            getPackets().sendGameMessage(&quot;You have items waiting for you in the bank.&quot;);
            pendingItems = false;
        }[/code]

Now in WHATEVER HANDLES GIVING THE STARTER, add this:
[code=java]
            getTemporaryAttributtes().put(&quot;referralCode&quot;, Boolean.TRUE);
            getPackets().sendRunScript(109, new Object[]{&quot;Please enter your referal code (leave blank if not referred)&quot;});[/code]

Great, not in WorldPacketsDecoder, find:
[code=java]
            } else if (player.getTemporaryAttributtes().get(&quot;titlecolor&quot;) == true) {[/code]
Above that, add:
[code=java]
            } else if (player.getTemporaryAttributtes().get(&quot;referralCode&quot;) == true) {
                if (value.length() &gt; 14) {
                    player.getDialogueManager().startDialogue(&quot;SimpleMessage&quot;, &quot;That is too long for a referral link!&quot;);
                } else if (!player.checkReferralCode(value)) {
                    try {
                        BufferedReader reader = new BufferedReader(new FileReader(&quot;./data/logs/referralCodes.txt&quot;));
                        String line = null;
                        while ((line = reader.readLine()) != null) {
                            if (line.contains(value)) {
                                String args[] = line.split(&quot; - &quot;);
                                String username = args[1];
                                Player referrer = World.getPlayer(username);
                                if (referrer != null) {
                                    if (referrer.getSession().getIP() == player.getSession().getIP()) {
                                        player.getDialogueManager().startDialogue(&quot;SimpleMessage&quot;, &quot;You can&#39;t refer yourself!&quot;);
                                        return;
                                    }
                                    referrer.getPackets().sendGameMessage(&quot;A player has referred under your name! You have been rewarded two mystery boxes!&quot;);
                                    if (referrer.getInventory().getFreeSlots() &gt; 2) {
                                        referrer.getInventory().addItem(new Item(6199, 2));
                                    } else {
                                        referrer.getBank().addItem(6199, 2, true);
                                        referrer.getPackets().sendGameMessage(&quot;Unable to find space in your inventory. The mystery boxes have been banked.&quot;);
                                    }
                                } else {
                                    username = Utils.formatPlayerNameForProtocol(username);
                                    if (SerializableFilesManager.containsPlayer(username)) {
                                        referrer = SerializableFilesManager.loadPlayer(username);
                                        if (referrer.getLastIP().equals(player.getSession().getIP())) {
                                            player.getDialogueManager().startDialogue(&quot;SimpleMessage&quot;, &quot;You can&#39;t refer yourself!&quot;);
                                            return;
                                        }
                                        referrer.setUsername(username);
                                        referrer.getInventory().setPlayer(referrer);
                                        if (referrer.getInventory().getFreeSlots() &gt; 2) {
                                            referrer.getInventory().addItem(new Item(6199, 2), false);
                                        } else {
                                            referrer.getBank().addItem(6199, 2, true);
                                            referrer.setPendingItems(true);
                                        }
                                        SerializableFilesManager.savePlayer(referrer);
                                    }
                                }
                                break;
                            }
                        }
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    player.getInventory().addItem(new Item(6199));
                    player.getDialogueManager().startDialogue(&quot;Your referral link is valid! You have received a free mystery box and your friend has received 2!&quot;);
                } else {
                    player.getDialogueManager().startDialogue(&quot;SimpleMessage&quot;, &quot;That referral code does not exist!&quot;);
                }[/code]

Alright, now in Inventory.java, find:
[code=java]
    public boolean addItem(Item item) {[/code]
Replace that whole method with this:
[code=java]
    public boolean addItem(Item item, boolean refresh) {
        if (item.getId() &lt; 0
                || item.getAmount() &lt; 0
                || !Utils.itemExists(item.getId()))
            return false;
        if (!player.getControlerManager().canAddInventoryItem(
                item.getId(), item.getAmount()))
            return false;
        Item[] itemsBefore = items.getItemsCopy();
        if (!items.add(item)) {
            items.add(new Item(item.getId(), items.getFreeSlots()));
            player.getPackets().sendGameMessage(
                    &quot;Not enough space in your inventory.&quot;);
            if (!refresh)
                refreshItems(itemsBefore, false);
            else
                refreshItems(itemsBefore);
            return false;
        }
        if (!refresh)
            refreshItems(itemsBefore, false);
        else
            refreshItems(itemsBefore);
        return true;
    }[/code]
Then above that method, add:
[code=java]
    public boolean addItem(Item item) {
        return addItem(item, true);
    }[/code]
Now, find:
[code=java]
    public void refreshItems(Item[] itemsBefore) {[/code]
Replace that whole method with:
[code=java]
    public void refreshItems(Item[] itemsBefore, boolean refresh) {
        int[] changedSlots = new int[itemsBefore.length];
        int count = 0;
        for (int index = 0; index &lt; itemsBefore.length; index++) {
            if (itemsBefore[index] != items.getItems()[index])
                changedSlots[count++] = index;
        }
        int[] finalChangedSlots = new int[count];
        System.arraycopy(changedSlots, 0, finalChangedSlots, 0, count);
        if (refresh)
            refresh(finalChangedSlots);
    }[/code]
Now above that method, add:
[code=java]
    public void refreshItems(Item[] itemsBefore) {
        refreshItems(itemsBefore, true);
    }[/code]

And done! Tell me if I needa add anything else. :)</description>
    
    <lastBuildDate>Sun, 14 Sep 2014 13:57:04 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/referral-system/546008.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:16, topic:546008”][quote author=matzie link=topic=664896.msg4449466#msg4449466 date=1410497217]<br>
And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"><br>
[/quote]</p>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html%5B/quote%5DWoah" rel="nofollow noopener">http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html[/quote]Woah</a>!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/21</link>
        <pubDate>Sun, 14 Sep 2014 13:57:04 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-21</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>[quote=“matzie, post:12, topic:546008”]<code>        private static void writeData(String file, String writable) {
            FileWriter fw = null;
            try {
                fw = new FileWriter(FILE_PATH + file + ".txt", true);
                fw.write(getTime() + writable);
                fw.write("\n");
                fw.close();
            } catch (IOException e) {
                System.err.println("Error processing data: " + e.getMessage());//If you encountered an IO exception, odds are you will be unable write to the file. (hence the IOException)
            } finally {
                try {
                    if (fw != null)
                        fw.close();
                } catch (IOException ioe) {}
            }
        }</code></p>
<p>As far as running this in a separate thread doesnt show much benefit to me. If you were to be loading all of the lines to memory to keep them i would agree. But for a save append i do not see much benefit.[/quote]<br>
disk IO is a blocking opertation not to mention slow. it should really be done on anther thread wherever possible imo</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/20</link>
        <pubDate>Sun, 14 Sep 2014 07:29:26 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-20</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@tyb97 tyb97]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/tyb97">@tyb97</a> wrote:</p>
          <blockquote>
              <p>[quote=“RandQm, post:18, topic:546008”][quote author=AtomicInt_ link=topic=664896.msg4449469#msg4449469 date=1410499663]</p>
<aside class="quote">
<blockquote>
<p>And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"></p>
</blockquote>
</aside>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html</a><br>
[/quote]<br>
I was happy when I saw java finally got this, I always messed shit up because I was used to C# having them.[/quote]<br>
Slowly Java is getting many of the great features C# has to offer…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/19</link>
        <pubDate>Sun, 14 Sep 2014 01:11:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-19</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:16, topic:546008”][quote author=matzie link=topic=664896.msg4449466#msg4449466 date=1410497217]<br>
And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"><br>
[/quote]</p>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html%5B/quote%5D" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html[/quote]</a><br>
I was happy when I saw java finally got this, I always messed shit up because I was used to C# having them.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/18</link>
        <pubDate>Sun, 14 Sep 2014 00:59:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-18</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:16, topic:546008”][quote author=matzie link=topic=664896.msg4449466#msg4449466 date=1410497217]<br>
And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"><br>
[/quote]</p>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html%5B/quote%5D" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html[/quote]</a><br>
Wow my mistake, and omg that is sexy <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/17</link>
        <pubDate>Fri, 12 Sep 2014 05:33:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-17</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="15" data-topic="546008">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/matzie/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> matzie:</div>
<blockquote>
<p>And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"></p>
</blockquote>
</aside>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html" class="onebox" target="_blank" rel="nofollow noopener">http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/16</link>
        <pubDate>Fri, 12 Sep 2014 05:27:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-16</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>And again, if you run into a IOException, you will be unable to close the datastream, leaving the program unable to open it. As far at the part in the try (()) i didn’t know you could even do that <img src="https://forum.moparisthebest.com/images/emoji/twitter/open_mouth.png?v=5" title=":open_mouth:" class="emoji" alt=":open_mouth:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/15</link>
        <pubDate>Fri, 12 Sep 2014 04:46:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-15</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@imthenull imthenull]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/imthenull">@imthenull</a> wrote:</p>
          <blockquote>
              <pre><code class="lang-auto">redundancy at its finest</code></pre>
<p>redundancy at its finest</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/14</link>
        <pubDate>Fri, 12 Sep 2014 03:03:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-14</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>[quote=“matzie, post:12, topic:546008”]<code>        private static void writeData(String file, String writable) {
            FileWriter fw = null;
            try {
                fw = new FileWriter(FILE_PATH + file + ".txt", true);
                fw.write(getTime() + writable);
                fw.write("\n");
                fw.close();
            } catch (IOException e) {
                System.err.println("Error processing data: " + e.getMessage());//If you encountered an IO exception, odds are you will be unable write to the file. (hence the IOException)
            } finally {
                try {
                    if (fw != null)
                        fw.close();
                } catch (IOException ioe) {}
            }
        }</code></p>
<p>As far as running this in a separate thread doesnt show much benefit to me. If you were to be loading all of the lines to memory to keep them i would agree. But for a save append i do not see much benefit.<br>
Loading to hashset/map at startup, checking if user already has a referralcode, and if he doesnt adding it - sounds like a more useful alternative <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> Followed by saving upon program completion and periodic backups.<br>
In that case i would see it being beneficial to use a multi-threaded structure for it.[/quote]</p>
<p>why so redundant?</p>
<p><code>
        private static void writeData(String file, String writable) {
            try (FileWriter fw = new FileWriter(FILE_PATH + file + ".txt", true)) {
                fw.write(getTime() + writable);
                fw.write("\n");
                fw.close();
            } catch (IOException e) {
                System.err.println("Error processing data: " + e.getMessage());
            }
        }</code></p>
<p>effectively the same exact code you posted without all that ugly boilerplate.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/13</link>
        <pubDate>Fri, 12 Sep 2014 02:50:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-13</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p><code>        private static void writeData(String file, String writable) {
            FileWriter fw = null;
            try {
                fw = new FileWriter(FILE_PATH + file + ".txt", true);
                fw.write(getTime() + writable);
                fw.write("\n");
                fw.close();
            } catch (IOException e) {
                System.err.println("Error processing data: " + e.getMessage());//If you encountered an IO exception, odds are you will be unable write to the file. (hence the IOException)
            } finally {
                try {
                    if (fw != null)
                        fw.close();
                } catch (IOException ioe) {}
            }
        }</code></p>
<p>As far as running this in a separate thread doesnt show much benefit to me. If you were to be loading all of the lines to memory to keep them i would agree. But for a save append i do not see much benefit.<br>
Loading to hashset/map at startup, checking if user already has a referralcode, and if he doesnt adding it - sounds like a more useful alternative <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"> Followed by saving upon program completion and periodic backups.<br>
In that case i would see it being beneficial to use a multi-threaded structure for it.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/12</link>
        <pubDate>Thu, 11 Sep 2014 22:25:58 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-12</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>to add on to what he said</p>
<p><code>    private static void writeData(String file, String writable)
            throws IOException {
        FileWriter fw = new FileWriter(FILE_PATH + file + ".txt", true);
        try {
            fw.write(getTime() + writable);
            fw.write("\n");
            fw.close();
        } catch (Exception e) {
            fw.write("Error processing data: " + e);
        }
    }</code></p>
<ol>
<li>you’re wrapping the code within a try-catch statement when you should be doing try-with-resources</li>
<li>you’re catching the exception while writing and then instead of printing the exception you CONTINUE to write to the file after doing that just threw an exception lol that’s going to cause a stackoverflowerror</li>
<li>potential resource leak… if an exception is thrown while writing the filewriter will never be closed. please use a try-with-resources or at the very least a try-catch-finally</li>
<li>this should be done on another thread</li>
</ol>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/11</link>
        <pubDate>Thu, 11 Sep 2014 21:38:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-11</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@matzie matzie]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/matzie">@matzie</a> wrote:</p>
          <blockquote>
              <p>You have a lot of memory managment issues in this ._. As well as a severe bottle-neck design flaw.<br>
1:)<br>
You have recursion mixed with a reading of a file for verification. The recursion alone could cause a stack overflow.<br>
2:)<br>
You are initializing 36 separate strings for 1 character, just use toCharArray(). This will cut your memory use in half at least, and increase process times.</p>
<p>3:)<br>
You call a file read, followed by a recursive statement if it is not valid. That will then add all of the memory allocated for the above objects, to the stack to be removed when (and if) the recursion completes. Linear computations are ALWAYS faster than recursive.</p>
<p>[code]<br>
private void generateReferralCode() {</p>
<pre><code>    char[] string = "abcdefghijklmnopqrstuvwxyz0123456789".toCharArray();

    //You know it will be exactly 10 characters. Save yourself the headache!
    char[] code = new char[10];
    do {
        for (int i = 0; i &lt; 10; i++) {
            code[i] = string[Utils.random(0, string.length - 1)];//all 10 will be modified, and it doesn't require an object wrapper
        }
    } while (!checkReferralCode(new String(code));
    FileLogger.logData("referralCodes", code + " - " + username);
    referralCode = code.toString();
}[/code]
</code></pre>
<p>The code does not look much different, but the work your processor has to do is decreased.</p>
<p>If you would like to create a more efficient version(theorized) yet, Message me and I will introduce the idea to you.</p>
<p>It is very difficult to inform people on efficient programming without sounding like a know-it-all or a prick .-. sk8er i see why everyone rants on you :rolleyes:</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/10</link>
        <pubDate>Wed, 10 Sep 2014 04:57:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-10</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“arham 4, post:8, topic:546008”][quote author=sk8rdude461 link=topic=664896.msg4445046#msg4445046 date=1408317009]<br>
that way people don’t have to convert all their “addItem(item)” 's to “addItem(item, false)”…<br>
[/quote]<br>
Read the snippet again.</p>
<p>Anywho, getters and setters not there because of it all being in one class.</p>
<p>And I agree with your last statement.[/quote]<br>
I must have missed that small part with the second addItem method, my bad on that <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"><br>
I still think there are ways that this could be cleaned but personally, I’m not worried about it. It’s good enough as is, especially compared to all the other 718 referral systems released…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/9</link>
        <pubDate>Tue, 19 Aug 2014 02:17:55 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-9</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="7" data-topic="546008">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/sk8rdude461/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> sk8rdude461:</div>
<blockquote>
<p>that way people don’t have to convert all their “addItem(item)” 's to “addItem(item, false)”…</p>
</blockquote>
</aside>
<p>Read the snippet again.</p>
<p>Anywho, getters and setters not there because of it all being in one class.</p>
<p>And I agree with your last statement.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/8</link>
        <pubDate>Tue, 19 Aug 2014 00:22:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-8</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="6" data-topic="546008">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/ohokay/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> ohokay:</div>
<blockquote>
<p>This could be abused easily. I don’t think you’ve covered how to prevent the cheating, other than an IP check maybe?</p>
</blockquote>
</aside>
<p>^ But I haven’t seen a referral code system you couldn’t abuse, one way or another.</p>
<p>I see minor flaws in the code, they don’t seem to have any impact on how it runs, and I’m sure that the “flaws” are fine how they are.</p>
<p>but like:<br>
I don’t see any getters for the referral code, why not?<br>
You aren’t using the setter for your referral code.</p>
<p>Why replace the addItem(Item) method, just add the second one with the optional boolean argument, that way people don’t have to convert all their “addItem(item)” 's to “addItem(item, false)”…</p>
<p><code>        if (referralCode == null)
            generateReferralCode();
        if (referralCode != null)
            getPackets().sendGameMessage("Your referral code is " + referralCode + ".");</code><br>
Could be</p>
<p><code>
        if (referralCode == null)
            generateReferralCode();
       getPackets().sendGameMessage("Your referral code is " + referralCode + ".");</code><br>
Because the generateReferralCode method should generate one, regardless…</p>
<p>I know I was just nitpicking at minor details. But yeah.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/7</link>
        <pubDate>Sun, 17 Aug 2014 23:10:09 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-7</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <p>This could be abused easily. I don’t think you’ve covered how to prevent the cheating, other than an IP check maybe?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/6</link>
        <pubDate>Sun, 17 Aug 2014 22:54:59 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-6</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="546008">
<div class="title">
<div class="quote-controls"></div>
 lare69:</div>
<blockquote>
<p>the referral code “generator” could be written in like three lines, it’s excessively verbose for no reason</p>
</blockquote>
</aside>
<p><code>
range = [*'0'..'9', *'a'..'z', *'A'..'Z']
Array.new(8){range.sample}.join</code></p>
<p>edit: 1 liner</p>
<p><code>
rand(36**7...36**8).to_s(36)</code></p>
<p>java is sad</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/5</link>
        <pubDate>Sat, 16 Aug 2014 20:35:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-5</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>Or you could just generate a random number for each person (call it a UID if you will) and each UID would be the referral code.</p>
<p>And like lare said, you don’t really need that much code to generate the referral code.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/4</link>
        <pubDate>Sat, 16 Aug 2014 19:58:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-4</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@Death_Style Death Style]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/death_style">@Death_Style</a> wrote:</p>
          <blockquote>
              <p>assuming usernames are unique why wouldn’t you just use the username as the referral code, or convert it into a 10 digit code</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/3</link>
        <pubDate>Sat, 16 Aug 2014 19:47:12 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-3</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>the referral code “generator” could be written in like three lines, it’s excessively verbose for no reason</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/2</link>
        <pubDate>Sat, 16 Aug 2014 18:45:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-2</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
      <item>
        <title>Referral System</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <blockquote>Refer your friends to get 2 mystery boxes for yourself and your friend gets one! Here's how it works:
<ol>
<li>You get a new 10 digit referral code.<br>
<img src="http://puu.sh/aG7Lb/2d9a932c76.png" alt width="" height=""><br>
Interested in how its generated? Here ya go!</li>
</ol>
<pre><code class="lang-auto">    private void generateReferralCode() {
        String[] string = "abcdefghijklmnopqrstuvwxyz0123456789".split("");
        String code = "";
        for (int i = 0; i &lt; 10; i++) {
            code = code + string[Utils.random(0, string.length - 1)];
        }
        if (!checkReferralCode(code)) {
            generateReferralCode();
            return;
        }
        FileLogger.logData("referralCodes", code + " - " + username);
        referralCode = code;
    }</code></pre>
<ol start="2">
<li>Tell your friend your code. Wait for them to log in. When they do log in, they’ll see something like this (after designing their character):<br>
<img src="http://puu.sh/aG7SX/d28c259674.png" alt width="" height="">
</li>
<li>Tell your friend to put the code in this dialogue box.<br>
<img src="http://puu.sh/aG7Xm/88aa51165b.png" alt width="" height="">
</li>
<li>Enjoy your gifts!<br>
<img src="http://puu.sh/aG8bL/bf51874c17.png" alt width="" height="">
</li>
</ol>
</blockquote>

<p><span class="bbcode-i">Please don’t take this as advertising.</span></p>
<p>You need this FileLogger system before continuing:</p>
<p>[code=java]<br>
package com.rs.game;</p>
<p>import java.io.File;<br>
import java.io.FileWriter;<br>
import java.io.IOException;<br>
import java.text.SimpleDateFormat;<br>
import java.util.Date;</p>
<p>/**</p>
<ul>
<li>Provides a lightweight external data logger</li>
<li>
</li>
<li>
<span class="mention">@author</span> Octave</li>
<li>
<a class="mention" href="/u/date">@date</a> 2/1/13<br>
*/</li>
</ul>
<p>public class FileLogger {</p>
<pre><code>/**
 * Log file path
 */
private static final String FILE_PATH = "./data/logs/";

/**
 * Formats data before appending to log
 *
 * @param file - File to write data to
 * @param data - Data to written
 * @throws IOException
 */
public static void logData(String file, String[] data) {
    try {
        writeData(file, formatStringArray(data));
    } catch (Exception e) {
        System.out.println("Fatal error while logging Data!");
    }
}

public static void logData(String file, String data) {
    try {
        writeData(file, data);
    } catch (Exception e) {
        System.out.println("Fatal error while logging Data!");
    }
}

/**
 * Format string array to proper log syntax
 *
 * @param origin - string to format
 * @return Array to string, formatted
 */
private static String formatStringArray(String[] origin) {
    StringBuffer result = new StringBuffer();
    for (int i = 0; i &lt; origin.length; i++) {
        result.append(origin[i] + "\t");
    }
    String mynewstring = result.toString();
    return mynewstring;
}

/**
 * Fetches system time and formats it appropriately
 *
 * @return Formatted time
 */
private static String getTime() {
    Date getDate = new Date();
    String timeFormat = "M/d/yy hh:mma";
    SimpleDateFormat sdf = new SimpleDateFormat(timeFormat);
    return "[" + sdf.format(getDate) + "]\t";
}

/**
 * Writes formatted string to text file
 *
 * @param file - File to write data to
 * @param data - Data to written
 * @throws IOException
 */
private static void writeData(String file, String writable)
        throws IOException {
    FileWriter fw = new FileWriter(FILE_PATH + file + ".txt", true);
    try {
        fw.write(getTime() + writable);
        fw.write("\n");
        fw.close();
    } catch (Exception e) {
        fw.write("Error processing data: " + e);
    }
}

public static void eraseFile(String name) {
    try {
        File file = new File(FILE_PATH + name + ".txt");
        file.delete();
        System.out.println(name + " logs automatically cleaned.");
        writeData(name,
                "\t &lt;----------------- File automatically cleaned -----------------&gt;");
    } catch (Exception e) {
        System.out.println("Failed to clean logs.");
    }
}
</code></pre>
<p>}[/code]</p>
<p>Also, in the data folder, make a new folder called logs.</p>
<p>Anyways, in Player.java, add this anywhere:</p>
<p>[code=java]<br>
private String referralCode;<br>
private boolean pendingItems;</p>
<pre><code>private void generateReferralCode() {
    String[] string = "abcdefghijklmnopqrstuvwxyz0123456789".split("");
    String code = "";
    for (int i = 0; i &lt; 10; i++) {
        code = code + string[Utils.random(0, string.length - 1)];
    }
    if (!checkReferralCode(code)) {
        generateReferralCode();
        return;
    }
    FileLogger.logData("referralCodes", code + " - " + username);
    referralCode = code;
}

public boolean checkReferralCode(String code) {
    try {
        BufferedReader reader = new BufferedReader(new FileReader("./data/logs/referralCodes.txt"));
        String line = null;
        while ((line = reader.readLine()) != null) {
            if (line.contains(code))
                return false;
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
    return true;
}

public void setReferralCode(String referralCode) {
    this.referralCode = referralCode;
}

public void setPendingItems(boolean pendingItems) {
    this.pendingItems = pendingItems;
}[/code]
</code></pre>
<p>Now go to the run method and add the following:</p>
<p><code>
        if (referralCode == null)
            generateReferralCode();
        if (referralCode != null)
            getPackets().sendGameMessage("Your referral code is " + referralCode + ".");
        if (pendingItems) {
            getPackets().sendGameMessage("You have items waiting for you in the bank.");
            pendingItems = false;
        }</code></p>
<p>Now in WHATEVER HANDLES GIVING THE STARTER, add this:</p>
<p><code>
            getTemporaryAttributtes().put("referralCode", Boolean.TRUE);
            getPackets().sendRunScript(109, new Object[]{"Please enter your referal code (leave blank if not referred)"});</code></p>
<p>Great, not in WorldPacketsDecoder, find:</p>
<p><code>
            } else if (player.getTemporaryAttributtes().get("titlecolor") == true) {</code><br>
Above that, add:</p>
<p><code>
            } else if (player.getTemporaryAttributtes().get("referralCode") == true) {
                if (value.length() &gt; 14) {
                    player.getDialogueManager().startDialogue("SimpleMessage", "That is too long for a referral link!");
                } else if (!player.checkReferralCode(value)) {
                    try {
                        BufferedReader reader = new BufferedReader(new FileReader("./data/logs/referralCodes.txt"));
                        String line = null;
                        while ((line = reader.readLine()) != null) {
                            if (line.contains(value)) {
                                String args[] = line.split(" - ");
                                String username = args[1];
                                Player referrer = World.getPlayer(username);
                                if (referrer != null) {
                                    if (referrer.getSession().getIP() == player.getSession().getIP()) {
                                        player.getDialogueManager().startDialogue("SimpleMessage", "You can't refer yourself!");
                                        return;
                                    }
                                    referrer.getPackets().sendGameMessage("A player has referred under your name! You have been rewarded two mystery boxes!");
                                    if (referrer.getInventory().getFreeSlots() &gt; 2) {
                                        referrer.getInventory().addItem(new Item(6199, 2));
                                    } else {
                                        referrer.getBank().addItem(6199, 2, true);
                                        referrer.getPackets().sendGameMessage("Unable to find space in your inventory. The mystery boxes have been banked.");
                                    }
                                } else {
                                    username = Utils.formatPlayerNameForProtocol(username);
                                    if (SerializableFilesManager.containsPlayer(username)) {
                                        referrer = SerializableFilesManager.loadPlayer(username);
                                        if (referrer.getLastIP().equals(player.getSession().getIP())) {
                                            player.getDialogueManager().startDialogue("SimpleMessage", "You can't refer yourself!");
                                            return;
                                        }
                                        referrer.setUsername(username);
                                        referrer.getInventory().setPlayer(referrer);
                                        if (referrer.getInventory().getFreeSlots() &gt; 2) {
                                            referrer.getInventory().addItem(new Item(6199, 2), false);
                                        } else {
                                            referrer.getBank().addItem(6199, 2, true);
                                            referrer.setPendingItems(true);
                                        }
                                        SerializableFilesManager.savePlayer(referrer);
                                    }
                                }
                                break;
                            }
                        }
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    player.getInventory().addItem(new Item(6199));
                    player.getDialogueManager().startDialogue("Your referral link is valid! You have received a free mystery box and your friend has received 2!");
                } else {
                    player.getDialogueManager().startDialogue("SimpleMessage", "That referral code does not exist!");
                }</code></p>
<p>Alright, now in Inventory.java, find:</p>
<p><code>
    public boolean addItem(Item item) {</code><br>
Replace that whole method with this:</p>
<p><code>
    public boolean addItem(Item item, boolean refresh) {
        if (item.getId() &lt; 0
                || item.getAmount() &lt; 0
                || !Utils.itemExists(item.getId()))
            return false;
        if (!player.getControlerManager().canAddInventoryItem(
                item.getId(), item.getAmount()))
            return false;
        Item[] itemsBefore = items.getItemsCopy();
        if (!items.add(item)) {
            items.add(new Item(item.getId(), items.getFreeSlots()));
            player.getPackets().sendGameMessage(
                    "Not enough space in your inventory.");
            if (!refresh)
                refreshItems(itemsBefore, false);
            else
                refreshItems(itemsBefore);
            return false;
        }
        if (!refresh)
            refreshItems(itemsBefore, false);
        else
            refreshItems(itemsBefore);
        return true;
    }</code><br>
Then above that method, add:</p>
<p><code>
    public boolean addItem(Item item) {
        return addItem(item, true);
    }</code><br>
Now, find:</p>
<p><code>
    public void refreshItems(Item[] itemsBefore) {</code><br>
Replace that whole method with:</p>
<p><code>
    public void refreshItems(Item[] itemsBefore, boolean refresh) {
        int[] changedSlots = new int[itemsBefore.length];
        int count = 0;
        for (int index = 0; index &lt; itemsBefore.length; index++) {
            if (itemsBefore[index] != items.getItems()[index])
                changedSlots[count++] = index;
        }
        int[] finalChangedSlots = new int[count];
        System.arraycopy(changedSlots, 0, finalChangedSlots, 0, count);
        if (refresh)
            refresh(finalChangedSlots);
    }</code><br>
Now above that method, add:</p>
<p><code>
    public void refreshItems(Item[] itemsBefore) {
        refreshItems(itemsBefore, true);
    }</code></p>
<p>And done! Tell me if I needa add anything else. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/referral-system/546008/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/referral-system/546008/1</link>
        <pubDate>Sat, 16 Aug 2014 17:52:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-546008-1</guid>
        <source url="https://forum.moparisthebest.com/t/referral-system/546008.rss">Referral System</source>
      </item>
  </channel>
</rss>
