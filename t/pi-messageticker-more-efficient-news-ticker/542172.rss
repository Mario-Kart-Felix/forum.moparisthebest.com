<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
    <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172</link>
    <description>So a lot of servers still use that old message system that runs on the EventManager.
I took the original concept (sending timed messages to a person) and modified it a bit.
Now all the messages (there&#39;s no limit) will load from a single .txt file.
It&#39;s all stored into a HashMap for efficiency.

I&#39;ve never worked with a Map or HashMap before. I would love for someone to help me improve this. I&#39;m sure there are a few areas I screwed up

MessageTicker.java:
[code=java]
package server.model.players.Content;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

import server.Config;
import server.event.CycleEvent;
import server.event.CycleEventContainer;
import server.event.CycleEventHandler;
import server.model.players.Client;
import server.util.Misc;


public class MessageTicker {
	
	public static Map&lt;String, Integer&gt; messages = new HashMap&lt;String, Integer&gt;();
	
	private final static int MSG_TIMER = 1000;// (10 mins) The message timer
	private static int totalMsgs = 0;// How many messages
	private static int lastMsg = 0;// Last message sent
	
	private static String baseMsg = &quot;&lt;shad=15695415&gt;[&quot; + Config.SERVER_NAME + &quot; News]: &quot;;
	
	public static void loadMessages() {
		String data = &quot;&quot;;
		int i = 0;
		try (BufferedReader file = new BufferedReader(new FileReader(&quot;./Data/cfg/TickerMessages.txt&quot;))) {
			
			while((data = file.readLine()) != null) {
				if(data.startsWith(&quot;//&quot;)) {
					// Ignore if it has a &quot;Comment&quot;
				} else {
					messages.put(data.trim(), i);
					i++;
				}
			}
			
		System.out.println(&quot;Loaded &quot; + i + &quot; messages&quot;);
		totalMsgs = i;
		file.close();
		
		} catch(FileNotFoundException fnfe) {
			System.out.println(&quot;Missing Ticker messages file. Add it in: ./Data/cfg/TickerMessages.txt &quot;);
		} catch(Exception e) {
			System.out.println(&quot;Error loading messages.&quot;);
		}
	}

	public static void shoutMsg(final Client c, final boolean order) {
		CycleEventHandler.getSingleton().addEvent(c, new CycleEvent() {

			@Override
			public void execute(CycleEventContainer container) {
				Set set = messages.entrySet();
				Iterator iterator = set.iterator();
			      
				if(totalMsgs &lt;= 0 || !c.tickerStatus) {
					stop();
					return;
				}
				
				if(!order)
					c.msgID = Misc.random(totalMsgs);
				else 
					c.msgID = (lastMsg == totalMsgs ? 0 : lastMsg++);
					
				lastMsg = c.msgID;
				
				try {
				      while(iterator.hasNext()) {
				    	  		Map.Entry ent = (Map.Entry)iterator.next();
				    	  		if((Integer.parseInt(ent.getValue().toString()) == c.msgID))
				    	  			c.sendMessage(baseMsg + ent.getKey().toString());
					      }
				} catch(Exception e) {
					stop();
					set = null;
					iterator = null;
				}
				set = null;
				iterator = null;
			}
			@Override
			public void stop(){
				
			}
		}, MSG_TIMER);
	}
	
}[/code]


Player.java
[code=java]
	public boolean tickerStatus = true;
	public int msgID = 0;[/code]

Server.java
[code=java]
		MessageTicker.loadMessages();[/code]

Client.java (in the init method)
[code=java]
			MessageTicker.shoutMsg(this, false);// Set to true for ordered messages
[/code]

Note: I did not test the ordered message system. 

[b]Optional Loading/Saving[/b]

PlayerSave.java (loadGame method)
[code=java] else if (token.equals(&quot;ticker-lock&quot;)) {
						p.tickerStatus = Boolean.parseBoolean(token2);
					} [/code]
PlayerSave.java (saveGame method)
[code=java]
			characterfile.write(&quot;ticker-lock = &quot;, 0, 14);
			characterfile.write(Boolean.toString(p.tickerStatus), 0, Boolean
					.toString(p.tickerStatus).length());
			characterfile.newLine();[/code]

Make sure to add &quot;TickerMessages.txt&quot; to ./Data/cfg/
The contents are up to you. The message will be displayed exactly as how it&#39;s seen in the text file. Also, if you want to make a comment in the text file (idk why you would) you can go ahead and put // at the start of the line and [b]that line[/b] will be commented. Only works at the start of the line.</description>
    
    <lastBuildDate>Wed, 21 May 2014 00:28:23 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>[quote=“sk8rdude461, post:17, topic:542172”][quote author=arham 4 link=topic=661048.msg4425296#msg4425296 date=1400553560]</p>
<aside class="quote">
<blockquote>
<pre><code class="lang-auto">YoloSwag420_360NoScopeScape News</code></pre>
</blockquote>
</aside>
<p>rofl</p>
<p>[hr]</p>
<p>Unless the txt is refreshed (which would also be bad), I don’t see any reason in using a txt and a hashmap instead of just a simple random with case 1 being TEXT and case 2 being ANOTHER_TEXT, and so on.<br>
[/quote]<br>
It was so the server messages could be easily edited and changed in live time.[/quote]<br>
Ah, ease of use. Alright, I understand now.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/18</link>
        <pubDate>Wed, 21 May 2014 00:28:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-18</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“arham 4, post:15, topic:542172”][quote author=AtomicInt_ link=topic=661048.msg4425272#msg4425272 date=1400543780]</p>
<pre><code class="lang-auto">YoloSwag420_360NoScopeScape News</code></pre>
<p>[/quote]<br>
rofl</p>
<p>[hr]</p>
<p>Unless the txt is refreshed (which would also be bad), I don’t see any reason in using a txt and a hashmap instead of just a simple random with case 1 being TEXT and case 2 being ANOTHER_TEXT, and so on.[/quote]<br>
It was so the server messages could be easily edited and changed in live time.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/17</link>
        <pubDate>Tue, 20 May 2014 20:17:18 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-17</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="14" data-topic="542172">
<div class="title">
<div class="quote-controls"></div>
 AtomicInt_:</div>
<blockquote>
<p><a class="mention" href="/u/justin">@Justin</a> Bieber A queue would also be unnecessary, there is no need to queue anything. Not all sets are un-ordered, btw (linked hash set)</p>
</blockquote>
</aside>
<p>Read my post again and you’ll find I suggest using ArrayList. You guys try to be too smart sometimes…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/16</link>
        <pubDate>Tue, 20 May 2014 06:41:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-16</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@arham_4 arham 4]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/arham_4">@arham_4</a> wrote:</p>
          <blockquote>
              <p>[quote=“AtomicInt_, post:14, topic:542172”]<code>
YoloSwag420_360NoScopeScape News
</code>[/quote]<br>
rofl</p>
<p>[hr]</p>
<p>Unless the txt is refreshed (which would also be bad), I don’t see any reason in using a txt and a hashmap instead of just a simple random with case 1 being TEXT and case 2 being ANOTHER_TEXT, and so on.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/15</link>
        <pubDate>Tue, 20 May 2014 02:39:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-15</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@ExtremeX-Scape Ryley]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/extremex-scape">@ExtremeX-Scape</a> wrote:</p>
          <blockquote>
              <p>Having this per-client is not necessary, a global message with a flag to determine the order would do just fine.</p>
<p>The usage of a map in this situation is not necessary, a set would be preferred.</p>
<p>I redid some of it with some examples and outputs (didn’t have a server to test it on, so it would need some tweaking if you wanted to use it)</p>
<p>[code=java]<br>
import static java.lang.String.format;</p>
<p>import java.io.BufferedReader;<br>
import java.io.IOException;<br>
import java.nio.file.Files;<br>
import java.nio.file.Path;<br>
import java.nio.file.Paths;<br>
import java.util.LinkedHashSet;<br>
import java.util.Random;<br>
import java.util.Set;<br>
import java.util.concurrent.Executors;<br>
import java.util.concurrent.ScheduledExecutorService;<br>
import java.util.concurrent.TimeUnit;<br>
import java.util.logging.Logger;</p>
<p>public class GlobalMessages {</p>
<pre><code>private static final Logger LOGGER = Logger.getGlobal();
private static final String SERVER_NAME = "YoloSwag420_360NoScopeScape";
private static final String MSG_PREFIX = format("&lt;shad=15695415&gt;[%s News]: ", SERVER_NAME);
private static final Random RANDOM = new Random();
private static final ScheduledExecutorService SERVICE = Executors.newSingleThreadScheduledExecutor();

private final Set&lt;String&gt; messages;

private int last;

private GlobalMessages(Set&lt;String&gt; messages) {
this.messages = messages;
}

public GlobalMessages() {
this(new LinkedHashSet&lt;&gt;());
}

public void load() throws IOException {
Path path = Paths.get("data/cfg", "messages.txt");

try (BufferedReader reader = Files.newBufferedReader(path)) {
    String line;
    while ((line = reader.readLine()) != null) {
	/* Don't do anything with comment or empty lines. */
	if (line.startsWith("#") || line.equals("")) {
	    continue;
	}

	/* If the line contains a comment, remove it. */
	if (line.contains("#")) {
	    line = line.substring(0, line.indexOf("#"));
	}

	messages.add(line);
    }
}

LOGGER.info(format("Loaded %d messages!", messages.size()));
}

public void start(boolean ordered) {
final String[] msgs = messages.toArray(new String[messages.size()]);

SERVICE.scheduleAtFixedRate(() -&gt; {
    /* If the message type is ordered and the last message is greater than the size, reset. */
    if (ordered &amp;&amp; last == msgs.length) {
	last = 0;
    }

    /* Determine the next message. */
    int next = ordered ? last++ : random(messages.size());

    System.out.println(MSG_PREFIX + msgs[next]);
}, 0, 15, TimeUnit.MINUTES);
}

private int random(int range) {
return RANDOM.nextInt(range);
}

public static void main(String[] args) throws IOException {
GlobalMessages msgs = new GlobalMessages();
msgs.load();
msgs.start(true);
}
</code></pre>
<p>}[/code]</p>
<p>Messages file:</p>
<p>[code]</p>
<h1>This is a comment</h1>
<p>This is a message # A comment after the message<br>
Another message.<br>
Again<br>
Hey!![/code]</p>
<p>Random output:</p>
<p><code>
INFO: Loaded 4 messages!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message 
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message 
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message </code></p>
<p>Ordered output:</p>
<pre><code class="lang-auto">INFO: Loaded 4 messages!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message 
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message 
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Hey!!
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: This is a message 
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Another message.
&lt;shad=15695415&gt;[YoloSwag420_360NoScopeScape News]: Again</code></pre>
<p><a class="mention" href="/u/justin">@Justin</a> Bieber A queue would also be unnecessary, there is no need to queue anything. Not all sets are un-ordered, btw (linked hash set)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/14</link>
        <pubDate>Mon, 19 May 2014 23:56:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-14</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“Ashi, post:12, topic:542172”][quote author=sk8rdude461 link=topic=661048.msg4425209#msg4425209 date=1400525474]</p>
<aside class="quote">
<blockquote>
<p>You’ll also run into problems with this. It’s not efficient as you think it is.</p>
</blockquote>
</aside>
<p>So just because I didn’t want to deal with you on skype you’re going to try and attack my posts? That’s oddly convenient of you.</p>
<aside class="quote">
<blockquote>
<p>I don’t think the rest of the code will stop executing after an exception is thrown. So either way those objects will become null or using the finally block which would reduce fix that problem.</p>
<p>I wouldn’t worry about using a Collection like DeathsChaos9 said.</p>
<p><span class="bbcode-b">Good job though <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></span></p>
</blockquote>
</aside>
<p>Glad to see you haven’t changed.<br>
[/quote]<br>
That skype thing was some guy praising you telling me how much of a god coder you are. I was unaware he was talking about you. He was very mislead.</p>
<p>And okay if you really want to have that “as long as it works” attitude with me.</p>
<p>By good job I meant nice try but trying to be friendly. If you really want me to bitch about every line of code, I can. If it helps you learn anyway.[/quote]<br>
You can go ahead and complain about whatever lines of code you want. I simply made this to further my understanding of HashMaps.<br>
I also don’t know what all was said about me on skype. I’m sure he was exaggerating it way more than it should have been. I was the only person out of like (supposedly) 5+ people he tried to get to help him to actually get his server up and running. He also had apparently been trying to get a server running for 3 days or so, so that means when I finally got it working he was overjoyed, which also most likely influenced his opinion of me and my work.</p>
<p>[quote=“Justin Bieber, post:11, topic:542172”]Use a queue? Sets are unordered, but you want to maintain ordering of the messages right? If you’re not even dequeueing the messages, then just use an ArrayList. I haven’t done any benchmarks but I’d bet ArrayList is a lot faster than most of the other ADTs for straightforward iteration.</p>
<p>Just use whatever makes most sense… you don’t have to worry about the efficiency of iterating through a set of 10 messages lol.[/quote]</p>
<p>I used an iterator because it was honestly the only solution I found for going through a HashMap. And as stated a second ago, I was trying to learn more about maps.<br>
However, I can’t edit the post since it’s past the time. So there won’t be any updates to this thread regardless of what improvements I make to this system.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/13</link>
        <pubDate>Mon, 19 May 2014 22:16:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-13</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <p>[quote=“sk8rdude461, post:10, topic:542172”][quote author=Ashi link=topic=661048.msg4425206#msg4425206 date=1400524369]<br>
You’ll also run into problems with this. It’s not efficient as you think it is.<br>
[/quote]<br>
So just because I didn’t want to deal with you on skype you’re going to try and attack my posts? That’s oddly convenient of you.</p>
<aside class="quote">
<blockquote>
<p>I don’t think the rest of the code will stop executing after an exception is thrown. So either way those objects will become null or using the finally block which would reduce fix that problem.</p>
<p>I wouldn’t worry about using a Collection like DeathsChaos9 said.</p>
<p><span class="bbcode-b">Good job though <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></span></p>
</blockquote>
</aside>
<p>Glad to see you haven’t changed.[/quote]<br>
That skype thing was some guy praising you telling me how much of a god coder you are. I was unaware he was talking about you. He was very mislead.</p>
<p>And okay if you really want to have that “as long as it works” attitude with me.</p>
<p>By good job I meant nice try but trying to be friendly. If you really want me to bitch about every line of code, I can. If it helps you learn anyway.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/12</link>
        <pubDate>Mon, 19 May 2014 19:23:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-12</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@xx_matty_xx Justin Bieber]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/xx_matty_xx">@xx_matty_xx</a> wrote:</p>
          <blockquote>
              <p>Use a queue? Sets are unordered, but you want to maintain ordering of the messages right? If you’re not even dequeueing the messages, then just use an ArrayList. I haven’t done any benchmarks but I’d bet ArrayList is a lot faster than most of the other ADTs for straightforward iteration.</p>
<p>Just use whatever makes most sense… you don’t have to worry about the efficiency of iterating through a set of 10 messages lol.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/11</link>
        <pubDate>Mon, 19 May 2014 18:53:10 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-11</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="9" data-topic="542172">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/ashi/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Ashi:</div>
<blockquote>
<p>You’ll also run into problems with this. It’s not efficient as you think it is.</p>
</blockquote>
</aside>
<p>So just because I didn’t want to deal with you on skype you’re going to try and attack my posts? That’s oddly convenient of you.</p>
<p>[quote=“Ashi, post:7, topic:542172”]I don’t think the rest of the code will stop executing after an exception is thrown. So either way those objects will become null or using the finally block which would reduce fix that problem.</p>
<p>I wouldn’t worry about using a Collection like DeathsChaos9 said.</p>
<p><span class="bbcode-b">Good job though <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></span>[/quote]</p>
<p>Glad to see you haven’t changed.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/10</link>
        <pubDate>Mon, 19 May 2014 18:51:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-10</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <p>You’ll also run into problems with this. It’s not efficient as you think it is.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/9</link>
        <pubDate>Mon, 19 May 2014 18:32:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-9</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“Ashi, post:7, topic:542172”]You could clean some of this code up e.g.</p>
<p><code> if(data.startsWith("//")) {
                                        // Ignore if it has a "Comment"
                                } else {
                                        messages.put(data.trim(), i);
                                        i++;
                                }</code></p>
<p>change that to</p>
<p><code>if(!data.startsWith("//")) {
     messages.put(data.trim(), i);
     i++;
 }</code></p>
<p>I personally close the stream within the finally block, it’s better to do imo.</p>
<p><code>} catch(Exception e) {
                                        stop();
                                        set = null;
                                        iterator = null;
                                }
                                set = null;
                                iterator = null;</code></p>
<p>I don’t think the rest of the code will stop executing after an exception is thrown. So either way those objects will become null or using the finally block which would reduce fix that problem.</p>
<p>I wouldn’t worry about using a Collection like DeathsChaos9 said.</p>
<p>Good job though :)[/quote]<br>
Yeah I have no idea what I was thinking putting an empty if statement…<br>
Thanks for the feedback though <img src="https://forum.moparisthebest.com/images/emoji/twitter/smiley.png?v=5" title=":smiley:" class="emoji" alt=":smiley:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/8</link>
        <pubDate>Tue, 06 May 2014 23:27:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-8</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@Ashi Ashi]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ashi">@Ashi</a> wrote:</p>
          <blockquote>
              <p>You could clean some of this code up e.g.</p>
<p><code> if(data.startsWith("//")) {
                                        // Ignore if it has a "Comment"
                                } else {
                                        messages.put(data.trim(), i);
                                        i++;
                                }</code></p>
<p>change that to</p>
<p><code>if(!data.startsWith("//")) {
     messages.put(data.trim(), i);
 }
i++</code></p>
<p>I personally close the stream within the finally block, it’s better to do imo.</p>
<p><code>} catch(Exception e) {
                                        stop();
                                        set = null;
                                        iterator = null;
                                }
                                set = null;
                                iterator = null;</code></p>
<p>I don’t think the rest of the code will stop executing after an exception is thrown. So either way those objects will become null or using the finally block which would reduce fix that problem.</p>
<p>I wouldn’t worry about using a Collection like DeathsChaos9 said.</p>
<p>Good job though <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/7</link>
        <pubDate>Tue, 06 May 2014 21:41:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-7</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>[quote=“ohokay, post:5, topic:542172”]I don’t know if this is correct, but I was told that if you’re having to loop through the map like that, perhaps you should redesign the code. Isn’t the map supposed to get the value with a given key and not the other way around.</p>
<pre><code class="lang-auto">                                      while(iterator.hasNext()) {
                                                        Map.Entry ent = (Map.Entry)iterator.next();
                                                        if((Integer.parseInt(ent.getValue().toString()) == c.msgID))
                                                                c.sendMessage(baseMsg + ent.getKey().toString());</code></pre>
<p>BiMap serves the same function I think</p>
<p><a href="https://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/BiMap.html%5B/quote%5D" class="onebox" target="_blank" rel="nofollow noopener">https://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/BiMap.html[/quote]</a><br>
I figured I did something wrong lol. Couldn’t you just swap the key and value (a.k.a so it’d be &lt;Integer, String&gt;)?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/6</link>
        <pubDate>Tue, 06 May 2014 21:22:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-6</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@ohokay ohokay]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ohokay">@ohokay</a> wrote:</p>
          <blockquote>
              <p>I don’t know if this is correct, but I was told that if you’re having to loop through the map like that, perhaps you should redesign the code. Isn’t the map supposed to get the value with a given key and not the other way around.</p>
<pre><code class="lang-auto">                                      while(iterator.hasNext()) {
                                                        Map.Entry ent = (Map.Entry)iterator.next();
                                                        if((Integer.parseInt(ent.getValue().toString()) == c.msgID))
                                                                c.sendMessage(baseMsg + ent.getKey().toString());</code></pre>
<p>BiMap serves the same function I think</p>
<p><a href="https://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/BiMap.html" class="onebox" target="_blank" rel="nofollow noopener">https://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/BiMap.html</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/5</link>
        <pubDate>Tue, 06 May 2014 20:23:53 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-5</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="542172">
<div class="title">
<div class="quote-controls"></div>
 lare69:</div>
<blockquote>
<p>nice job man, one question though: why’d you use a map?</p>
</blockquote>
</aside>
<p>To have a better understanding of em.</p>
<aside class="quote" data-post="3" data-topic="542172">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/deathschaos9/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> DeathsChaos9:</div>
<blockquote>
<p>Agreed. I think if you want to use a collection interface the <a href="http://docs.oracle.com/javase/tutorial/collections/interfaces/set.html" data-bbcode="true" rel="nofollow noopener">Set interface</a> would’ve been a better choice, you’re certainly on the right track though. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
</blockquote>
</aside>
<p>I’ll look at this and maybe I’ll be able to update this tut. (the whole time thing yeah)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/4</link>
        <pubDate>Mon, 05 May 2014 22:48:32 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-4</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@deathschaos9 DeathsChaos9]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/deathschaos9">@deathschaos9</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="542172">
<div class="title">
<div class="quote-controls"></div>
 lare69:</div>
<blockquote>
<p>nice job man, one question though: why’d you use a map?</p>
</blockquote>
</aside>
<p>Agreed. I think if you want to use a collection interface the <a href="http://docs.oracle.com/javase/tutorial/collections/interfaces/set.html" data-bbcode="true">Set interface</a> would’ve been a better choice, you’re certainly on the right track though. <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/3</link>
        <pubDate>Mon, 05 May 2014 22:31:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-3</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>nice job man, one question though: why’d you use a map?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/2</link>
        <pubDate>Mon, 05 May 2014 21:29:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-2</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
      <item>
        <title>[PI] MessageTicker - More efficient &quot;news&quot; ticker</title>
        <dc:creator><![CDATA[@sk8rdude461 sk8rdude461]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/sk8rdude461">@sk8rdude461</a> wrote:</p>
          <blockquote>
              <p>So a lot of servers still use that old message system that runs on the EventManager.<br>
I took the original concept (sending timed messages to a person) and modified it a bit.<br>
Now all the messages (there’s no limit) will load from a single .txt file.<br>
It’s all stored into a HashMap for efficiency.</p>
<p>I’ve never worked with a Map or HashMap before. I would love for someone to help me improve this. I’m sure there are a few areas I screwed up</p>
<p>MessageTicker.java:</p>
<p>[code=java]<br>
package server.model.players.Content;</p>
<p>import java.io.BufferedReader;<br>
import java.io.FileNotFoundException;<br>
import java.io.FileReader;<br>
import java.util.HashMap;<br>
import java.util.Iterator;<br>
import java.util.Map;<br>
import java.util.Set;</p>
<p>import server.Config;<br>
import server.event.CycleEvent;<br>
import server.event.CycleEventContainer;<br>
import server.event.CycleEventHandler;<br>
import server.model.players.Client;<br>
import server.util.Misc;</p>
<p>public class MessageTicker {</p>
<pre><code>public static Map&lt;String, Integer&gt; messages = new HashMap&lt;String, Integer&gt;();

private final static int MSG_TIMER = 1000;// (10 mins) The message timer
private static int totalMsgs = 0;// How many messages
private static int lastMsg = 0;// Last message sent

private static String baseMsg = "&lt;shad=15695415&gt;[" + Config.SERVER_NAME + " News]: ";

public static void loadMessages() {
	String data = "";
	int i = 0;
	try (BufferedReader file = new BufferedReader(new FileReader("./Data/cfg/TickerMessages.txt"))) {
		
		while((data = file.readLine()) != null) {
			if(data.startsWith("//")) {
				// Ignore if it has a "Comment"
			} else {
				messages.put(data.trim(), i);
				i++;
			}
		}
		
	System.out.println("Loaded " + i + " messages");
	totalMsgs = i;
	file.close();
	
	} catch(FileNotFoundException fnfe) {
		System.out.println("Missing Ticker messages file. Add it in: ./Data/cfg/TickerMessages.txt ");
	} catch(Exception e) {
		System.out.println("Error loading messages.");
	}
}

public static void shoutMsg(final Client c, final boolean order) {
	CycleEventHandler.getSingleton().addEvent(c, new CycleEvent() {

		@Override
		public void execute(CycleEventContainer container) {
			Set set = messages.entrySet();
			Iterator iterator = set.iterator();
		      
			if(totalMsgs &lt;= 0 || !c.tickerStatus) {
				stop();
				return;
			}
			
			if(!order)
				c.msgID = Misc.random(totalMsgs);
			else 
				c.msgID = (lastMsg == totalMsgs ? 0 : lastMsg++);
				
			lastMsg = c.msgID;
			
			try {
			      while(iterator.hasNext()) {
			    	  		Map.Entry ent = (Map.Entry)iterator.next();
			    	  		if((Integer.parseInt(ent.getValue().toString()) == c.msgID))
			    	  			c.sendMessage(baseMsg + ent.getKey().toString());
				      }
			} catch(Exception e) {
				stop();
				set = null;
				iterator = null;
			}
			set = null;
			iterator = null;
		}
		@Override
		public void stop(){
			
		}
	}, MSG_TIMER);
}
</code></pre>
<p>}[/code]</p>
<p>Player.java</p>
<p><code>
	public boolean tickerStatus = true;
	public int msgID = 0;</code></p>
<p>Server.java</p>
<p><code>
		MessageTicker.loadMessages();</code></p>
<p>Client.java (in the init method)</p>
<pre><code class="lang-auto">			MessageTicker.shoutMsg(this, false);// Set to true for ordered messages</code></pre>
<p>Note: I did not test the ordered message system.</p>
<p><span class="bbcode-b">Optional Loading/Saving</span></p>
<p>PlayerSave.java (loadGame method)</p>
<p><code> else if (token.equals("ticker-lock")) {
						p.tickerStatus = Boolean.parseBoolean(token2);
					} </code><br>
PlayerSave.java (saveGame method)</p>
<p><code>
			characterfile.write("ticker-lock = ", 0, 14);
			characterfile.write(Boolean.toString(p.tickerStatus), 0, Boolean
					.toString(p.tickerStatus).length());
			characterfile.newLine();</code></p>
<p>Make sure to add “TickerMessages.txt” to ./Data/cfg/<br>
The contents are up to you. The message will be displayed exactly as how it’s seen in the text file. Also, if you want to make a comment in the text file (idk why you would) you can go ahead and put // at the start of the line and <span class="bbcode-b">that line</span> will be commented. Only works at the start of the line.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172/1</link>
        <pubDate>Mon, 14 Apr 2014 22:48:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-542172-1</guid>
        <source url="https://forum.moparisthebest.com/t/pi-messageticker-more-efficient-news-ticker/542172.rss">[PI] MessageTicker - More efficient &quot;news&quot; ticker</source>
      </item>
  </channel>
</rss>
