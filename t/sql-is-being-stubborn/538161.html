<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/sql-is-being-stubborn/538161 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:06:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>SQL is being stubborn - General Programming - moparisthebest.com</title>
    <meta name="description" content="I&amp;#39;m attempting to add a &amp;quot;add news&amp;quot; function to my smf which allows the front page to show it by &amp;quot;ids&amp;quot; once its recorded in the db but I&amp;#39;m getting &amp;quot;Error: Table &amp;#39;mysql.news&amp;#39; doesn&amp;#39;t exist&amp;quot;.  

 &amp;lt;?php
  $dbname = &amp;quot;smf&amp;quot;;
  &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="538161.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;SQL is being stubborn&#39;" href="538161.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161" />
<meta property="og:title" content="SQL is being stubborn" />
<meta name="twitter:title" content="SQL is being stubborn" />
<meta property="og:description" content="I’m attempting to add a “add news” function to my smf which allows the front page to show it by “ids” once its recorded in the db but I’m getting “Error: Table ‘mysql.news’ doesn’t exist”.  &lt;?php   $dbname = &quot;smf&quot;;   $dbuser = &quot;root&quot;;   $dbpass = &quot;&quot;;   $dbhost = &quot;&quot;;    $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());   mysql_select_db($dbname) or die(mysql_error());  if (!$con)   {   die(&#39;Couldnt connect to the database: &#39; . mysql_error());   }mysql_select_db(&quot;mysql&quot;, $con)..." />
<meta name="twitter:description" content="I’m attempting to add a “add news” function to my smf which allows the front page to show it by “ids” once its recorded in the db but I’m getting “Error: Table ‘mysql.news’ doesn’t exist”.  &lt;?php   $dbname = &quot;smf&quot;;   $dbuser = &quot;root&quot;;   $dbpass = &quot;&quot;;   $dbhost = &quot;&quot;;    $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());   mysql_select_db($dbname) or die(mysql_error());  if (!$con)   {   die(&#39;Couldnt connect to the database: &#39; . mysql_error());   }mysql_select_db(&quot;mysql&quot;, $con)..." />
<meta property="article:published_time" content="2014-01-05T20:47:28+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="538161.html">SQL is being stubborn</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/jal_knight.html'><span itemprop='name'>jal_knight</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-05T20:47:28Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:24Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’m attempting to add a “add news” function to my smf which allows the front page to show it by “ids” once its recorded in the db but I’m getting “Error: Table ‘mysql.news’ doesn’t exist”.</p>
<pre><code class="lang-auto">&lt;?php
  $dbname = "smf";
  $dbuser = "root";
  $dbpass = "";
  $dbhost = "";

  $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());
  mysql_select_db($dbname) or die(mysql_error());

if (!$con)
  {
  die('Couldnt connect to the database: ' . mysql_error());
  }mysql_select_db("mysql", $con);</code></pre>
<p>I’m pretty sure the error resides here because when I change</p>
<pre><code class="lang-auto">mysql_select_db("mysql", $con);</code></pre>
<p>to</p>
<pre><code class="lang-auto">mysql_select_db("smf", $con);</code></pre>
<p>I get an error stating the integer for the id is invalid.<br>
I’ve already created the table and have created it correctly so I’m %100 sure that isn’t the issue.</p>
<p>Any ideas?</p>
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Ambokile.html'><span itemprop='name'>Ambokile</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-05T22:46:44Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:27Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Well, you haven’t given us any code that references “news” at all, so we won’t be able to help you until you do so.</p>
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/jal_knight.html'><span itemprop='name'>jal_knight</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-06T03:46:30Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:52Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is what processes the news after its been submitted and the file that I am getting the error from.</p>
<pre><code class="lang-auto">&lt;?php 
//Require header.php
require('header.php'); 
?&gt;
&lt;?PHP
if ($context['user']['is_admin'])
		{
			?&gt;
			
            
            &lt;?php
  $dbname = "";
  $dbuser = "";
  $dbpass = "";
  $dbhost = "";

  $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());
  mysql_select_db($dbname) or die(mysql_error());

if (!$con)
  {
  die('Couldnt connect to the database: ' . mysql_error());
  }mysql_select_db("mysql", $con);
$sql="INSERT INTO news (id, title, date, text)
VALUES
('$_POST[id]','$_POST[title]','$_POST[date]','$_POST[text]')";
if (!mysql_query($sql,$con))
  {
  die('Error: ' . mysql_error());
  }
echo "News item added! Go home to see it!";
mysql_close($con)
?&gt;

            &lt;?php
            		} else {
			echo "We aren't hiding anything here....";
		}
		?&gt;
&lt;?php 
require('footer.php'); 
?&gt;</code></pre>
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Ruby_Forums_Coder.html'><span itemprop='name'>Ruby_Forums_Coder</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-06T03:53:36Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:53Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>First of all, that’s enough with the mysql_ functions, they’ve been deprecated far too long. I understand I wrote a tutorial that had this code base around it a long time ago and I haven’t updated it so that’s mainly my fault.</p>
<p>First off, make use of a configuration file. You never know how far you’d like to expand a site so having a file with variables in it that are used site-wide isn’t a bad idea. It’s also a time saver if for example a client version changes from 0.9 to 1.0 and this is stated on several pages to have [php]$client_version = “0.9”;[/php] inside that file, that way instead of changing 6/7 values you only change one. Make it something like:<br>
[php]</p>
&lt;?php

/**
* Database connection variables
*/

$host = "localhost";
$user = "some_user";
$pass = "some_pass";
$db = "some_db";
[/php]
Then at the very top of a new file type:
[php]
&lt;?php include('config.php');
[/php]

So now that's cleared up what I gather is that you want to have some form of news adding and retrieval system. In one file, hold a form that sends information to an action file. For example: admin_news.php would link to action.admin_news.php or something similar. For the form part, ensure that you include your SSI since you're using SMF. This way you can check if the user is an administrator to show the form or not.
[php]
if($context['user']['is_admin']) {
     // show form
} else {
     header("Location: http://yoursite.com/index.php");
}
[/php]

Understand? Okay, next step.
For your action script, use something similar to this.
[php]
&lt;?php
include('./config.php');
include('/path/to/SSI.php');

if($context['user']['is_admin']) {

$con = new MySQLi($host, $user, $pass, $db);

$poster = $context['user']['name'];
$title = $_POST['title'];
$body = $_POST['body'];
$date = date('jS, F, Y');

if(empty($title)) {
        die("You didn't fill in the required fields.");
}

if(empty($body)) {
        die("You didn't fill in the required fields.");
}
	$stmt = $con-&gt;prepare("INSERT INTO some_table (poster, date, title, body) VALUES (?,?,?,?)");

	$stmt-&gt;bind_param("ssss", $poster, $date, $title, $body);

	$stmt-&gt;execute();

        header("Location: http://yoursite.com/index.php");

} else {

        header("Location: http://yoursite.com/index.php");
}
[/php]

Then retrieval of the posts are easy, just do something like:

[php]
&lt;?php include('./config.php');

$con = new MySQLi($host, $user, $pass, $db);

	$sql = "SELECT * FROM some_table ORDER BY id DESC";

	if($result = $con-&gt;query($sql)) {

		while($row = $result-&gt;fetch_assoc()) {

			echo '.htmlspecialchars($row['title']).'

				<p>'. htmlspecialchars($row['body']) .'</p>

					Posted By: <b>'. $row['poster'] .'</b>

				<br>

					Date: '.$row['date'].';

				}
			}
[/php]


I wrote all of this in the editor so it may be a bit off here and there, but I've used scripts very, very similar to the above and they've worked every time. Just keep at it. You might want to use that code, you might not. It's at your discretion, use it for documentation, ignore it, stick it on your site.

Hope that fixes the problem you were having and improves the code.
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/jal_knight.html'><span itemprop='name'>jal_knight</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-06T03:59:21Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:53Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Ruby, post:4, topic:538161”]First of all, that’s enough with the mysql_ functions, they’ve been deprecated far too long. I understand I wrote a tutorial that had this code base around it a long time ago and I haven’t updated it so that’s mainly my fault.</p>
<p>First off, make use of a configuration file. You never know how far you’d like to expand a site so having a file with variables in it that are used site-wide isn’t a bad idea. It’s also a time saver if for example a client version changes from 0.9 to 1.0 and this is stated on several pages to have [php]$client_version = “0.9”;[/php] inside that file, that way instead of changing 6/7 values you only change one. Make it something like:<br>
[php]</p>
&lt;?php

/**
* Database connection variables
*/

$host = "localhost";
$user = "some_user";
$pass = "some_pass";
$db = "some_db";
[/php]
Then at the very top of a new file type:
[php]
&lt;?php include('config.php');
[/php]

So now that's cleared up what I gather is that you want to have some form of news adding and retrieval system. In one file, hold a form that sends information to an action file. For example: admin_news.php would link to action.admin_news.php or something similar. For the form part, ensure that you include your SSI since you're using SMF. This way you can check if the user is an administrator to show the form or not.
[php]
if($context['user']['is_admin']) {
     // show form
} else {
     header("Location: http://yoursite.com/index.php");
}
[/php]

Understand? Okay, next step.
For your action script, use something similar to this.
[php]
&lt;?php
include('./config.php');
include('/path/to/SSI.php');

if($context['user']['is_admin']) {

$con = new MySQLi($host, $user, $pass, $db);

$poster = $context['user']['name'];
$title = $_POST['title'];
$body = $_POST['body'];
$date = date('jS, F, Y');

if(empty($title)) {
        die("You didn't fill in the required fields.");
}

if(empty($body)) {
        die("You didn't fill in the required fields.");
}
	$stmt = $con-&gt;prepare("INSERT INTO some_table (poster, date, title, body) VALUES (?,?,?,?)");

	$stmt-&gt;bind_param("ssss", $poster, $date, $title, $body);

	$stmt-&gt;execute();

        header("Location: http://yoursite.com/index.php");

} else {

        header("Location: http://yoursite.com/index.php");
}
[/php]

Then retrieval of the posts are easy, just do something like:

[php]
&lt;?php include('./config.php');

$con = new MySQLi($host, $user, $pass, $db);

	$sql = "SELECT * FROM some_table ORDER BY id DESC";

	if($result = $con-&gt;query($sql)) {

		while($row = $result-&gt;fetch_assoc()) {

			echo '.htmlspecialchars($row['title']).'

				<p>'. htmlspecialchars($row['body']) .'</p>

					Posted By: <b>'. $row['poster'] .'</b>

				<br>

					Date: '.$row['date'].';

				}
			}
[/php]


I wrote all of this in the editor so it may be a bit off here and there, but I've used scripts very, very similar to the above and they've worked every time. Just keep at it. You might want to use that code, you might not. It's at your discretion, use it for documentation, ignore it, stick it on your site.

Hope that fixes the problem you were having and improves the code.[/quote]

I knew you were going to slam the answers on to me sooner or later lol.

Thanks man. I appreciate the in depth answer and the foot in the ass.


I do have the if else statements already now I'll read a little more into mysqli so I can understand your example a bit more before I incorporate it.
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Ruby_Forums_Coder.html'><span itemprop='name'>Ruby_Forums_Coder</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-01-06T04:19:15Z'>
            <time itemprop='dateModified' datetime='2016-08-04T11:24:53Z' class='post-time'>
              August 4, 2016, 11:24am
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>All that really contains is prepared statements and very minimal amounts of OOP, there would usually be a full class system etc but because it’s just excerpts I gave you I didn’t bother with all that. MySQLi can be used through procedural functions too e.g mysqli_query but I strongly suggest you learn the way I done it.</p>
<p>Also, I didn’t know if your Skype message was from months ago or today because you we appearing offline or I would’ve just replied on there. Skype’s been messing up time stamps and delivering messages to me for a while now.</p>
      </div>

      <meta itemprop='headline' content='SQL is being stubborn'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/sql-is-being-stubborn/538161 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:06:44 GMT -->
</html>
