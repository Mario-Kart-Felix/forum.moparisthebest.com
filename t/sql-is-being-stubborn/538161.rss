<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>SQL is being stubborn</title>
    <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161</link>
    <description>I&#39;m attempting to add a &quot;add news&quot; function to my smf which allows the front page to show it by &quot;ids&quot; once its recorded in the db but I&#39;m getting &quot;Error: Table &#39;mysql.news&#39; doesn&#39;t exist&quot;. 

[code]
&lt;?php
  $dbname = &quot;smf&quot;;
  $dbuser = &quot;root&quot;;
  $dbpass = &quot;&quot;;
  $dbhost = &quot;&quot;;

  $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());
  mysql_select_db($dbname) or die(mysql_error());

if (!$con)
  {
  die(&#39;Couldnt connect to the database: &#39; . mysql_error());
  }mysql_select_db(&quot;mysql&quot;, $con);
[/code]

I&#39;m pretty sure the error resides here because when I change 
[code]
mysql_select_db(&quot;mysql&quot;, $con);
[/code]
to
[code]
mysql_select_db(&quot;smf&quot;, $con);
[/code]

I get an error stating the integer for the id is invalid.
I&#39;ve already created the table and have created it correctly so I&#39;m %100 sure that isn&#39;t the issue.

 Any ideas?</description>
    
    <lastBuildDate>Mon, 06 Jan 2014 04:19:15 +0000</lastBuildDate>
    <category>General Programming</category>
    <atom:link href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@Ruby_Forums_Coder Ruby]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ruby_forums_coder">@Ruby_Forums_Coder</a> wrote:</p>
          <blockquote>
              <p>All that really contains is prepared statements and very minimal amounts of OOP, there would usually be a full class system etc but because it’s just excerpts I gave you I didn’t bother with all that. MySQLi can be used through procedural functions too e.g mysqli_query but I strongly suggest you learn the way I done it.</p>
<p>Also, I didn’t know if your Skype message was from months ago or today because you we appearing offline or I would’ve just replied on there. Skype’s been messing up time stamps and delivering messages to me for a while now.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/6</link>
        <pubDate>Mon, 06 Jan 2014 04:19:15 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-6</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@jal_knight jal knight]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jal_knight">@jal_knight</a> wrote:</p>
          <blockquote>
              <p>[quote=“Ruby, post:4, topic:538161”]First of all, that’s enough with the mysql_ functions, they’ve been deprecated far too long. I understand I wrote a tutorial that had this code base around it a long time ago and I haven’t updated it so that’s mainly my fault.</p>
<p>First off, make use of a configuration file. You never know how far you’d like to expand a site so having a file with variables in it that are used site-wide isn’t a bad idea. It’s also a time saver if for example a client version changes from 0.9 to 1.0 and this is stated on several pages to have [php]$client_version = “0.9”;[/php] inside that file, that way instead of changing 6/7 values you only change one. Make it something like:<br>
[php]</p>
&lt;?php

/**
* Database connection variables
*/

$host = "localhost";
$user = "some_user";
$pass = "some_pass";
$db = "some_db";
[/php]
Then at the very top of a new file type:
[php]
&lt;?php include('config.php');
[/php]

So now that's cleared up what I gather is that you want to have some form of news adding and retrieval system. In one file, hold a form that sends information to an action file. For example: admin_news.php would link to action.admin_news.php or something similar. For the form part, ensure that you include your SSI since you're using SMF. This way you can check if the user is an administrator to show the form or not.
[php]
if($context['user']['is_admin']) {
     // show form
} else {
     header("Location: http://yoursite.com/index.php");
}
[/php]

Understand? Okay, next step.
For your action script, use something similar to this.
[php]
&lt;?php
include('./config.php');
include('/path/to/SSI.php');

if($context['user']['is_admin']) {

$con = new MySQLi($host, $user, $pass, $db);

$poster = $context['user']['name'];
$title = $_POST['title'];
$body = $_POST['body'];
$date = date('jS, F, Y');

if(empty($title)) {
        die("You didn't fill in the required fields.");
}

if(empty($body)) {
        die("You didn't fill in the required fields.");
}
	$stmt = $con-&gt;prepare("INSERT INTO some_table (poster, date, title, body) VALUES (?,?,?,?)");

	$stmt-&gt;bind_param("ssss", $poster, $date, $title, $body);

	$stmt-&gt;execute();

        header("Location: http://yoursite.com/index.php");

} else {

        header("Location: http://yoursite.com/index.php");
}
[/php]

Then retrieval of the posts are easy, just do something like:

[php]
&lt;?php include('./config.php');

$con = new MySQLi($host, $user, $pass, $db);

	$sql = "SELECT * FROM some_table ORDER BY id DESC";

	if($result = $con-&gt;query($sql)) {

		while($row = $result-&gt;fetch_assoc()) {

			echo '.htmlspecialchars($row['title']).'

				<p>'. htmlspecialchars($row['body']) .'</p>

					Posted By: <b>'. $row['poster'] .'</b>

				<br>

					Date: '.$row['date'].';

				}
			}
[/php]


I wrote all of this in the editor so it may be a bit off here and there, but I've used scripts very, very similar to the above and they've worked every time. Just keep at it. You might want to use that code, you might not. It's at your discretion, use it for documentation, ignore it, stick it on your site.

Hope that fixes the problem you were having and improves the code.[/quote]

I knew you were going to slam the answers on to me sooner or later lol.

Thanks man. I appreciate the in depth answer and the foot in the ass.


I do have the if else statements already now I'll read a little more into mysqli so I can understand your example a bit more before I incorporate it.
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/5</link>
        <pubDate>Mon, 06 Jan 2014 03:59:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-5</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@Ruby_Forums_Coder Ruby]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ruby_forums_coder">@Ruby_Forums_Coder</a> wrote:</p>
          <blockquote>
              <p>First of all, that’s enough with the mysql_ functions, they’ve been deprecated far too long. I understand I wrote a tutorial that had this code base around it a long time ago and I haven’t updated it so that’s mainly my fault.</p>
<p>First off, make use of a configuration file. You never know how far you’d like to expand a site so having a file with variables in it that are used site-wide isn’t a bad idea. It’s also a time saver if for example a client version changes from 0.9 to 1.0 and this is stated on several pages to have [php]$client_version = “0.9”;[/php] inside that file, that way instead of changing 6/7 values you only change one. Make it something like:<br>
[php]</p>
&lt;?php

/**
* Database connection variables
*/

$host = "localhost";
$user = "some_user";
$pass = "some_pass";
$db = "some_db";
[/php]
Then at the very top of a new file type:
[php]
&lt;?php include('config.php');
[/php]

So now that's cleared up what I gather is that you want to have some form of news adding and retrieval system. In one file, hold a form that sends information to an action file. For example: admin_news.php would link to action.admin_news.php or something similar. For the form part, ensure that you include your SSI since you're using SMF. This way you can check if the user is an administrator to show the form or not.
[php]
if($context['user']['is_admin']) {
     // show form
} else {
     header("Location: http://yoursite.com/index.php");
}
[/php]

Understand? Okay, next step.
For your action script, use something similar to this.
[php]
&lt;?php
include('./config.php');
include('/path/to/SSI.php');

if($context['user']['is_admin']) {

$con = new MySQLi($host, $user, $pass, $db);

$poster = $context['user']['name'];
$title = $_POST['title'];
$body = $_POST['body'];
$date = date('jS, F, Y');

if(empty($title)) {
        die("You didn't fill in the required fields.");
}

if(empty($body)) {
        die("You didn't fill in the required fields.");
}
	$stmt = $con-&gt;prepare("INSERT INTO some_table (poster, date, title, body) VALUES (?,?,?,?)");

	$stmt-&gt;bind_param("ssss", $poster, $date, $title, $body);

	$stmt-&gt;execute();

        header("Location: http://yoursite.com/index.php");

} else {

        header("Location: http://yoursite.com/index.php");
}
[/php]

Then retrieval of the posts are easy, just do something like:

[php]
&lt;?php include('./config.php');

$con = new MySQLi($host, $user, $pass, $db);

	$sql = "SELECT * FROM some_table ORDER BY id DESC";

	if($result = $con-&gt;query($sql)) {

		while($row = $result-&gt;fetch_assoc()) {

			echo '.htmlspecialchars($row['title']).'

				<p>'. htmlspecialchars($row['body']) .'</p>

					Posted By: <b>'. $row['poster'] .'</b>

				<br>

					Date: '.$row['date'].';

				}
			}
[/php]


I wrote all of this in the editor so it may be a bit off here and there, but I've used scripts very, very similar to the above and they've worked every time. Just keep at it. You might want to use that code, you might not. It's at your discretion, use it for documentation, ignore it, stick it on your site.

Hope that fixes the problem you were having and improves the code.
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/4</link>
        <pubDate>Mon, 06 Jan 2014 03:53:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-4</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@jal_knight jal knight]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jal_knight">@jal_knight</a> wrote:</p>
          <blockquote>
              <p>This is what processes the news after its been submitted and the file that I am getting the error from.</p>
<pre><code class="lang-auto">&lt;?php 
//Require header.php
require('header.php'); 
?&gt;
&lt;?PHP
if ($context['user']['is_admin'])
		{
			?&gt;
			
            
            &lt;?php
  $dbname = "";
  $dbuser = "";
  $dbpass = "";
  $dbhost = "";

  $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());
  mysql_select_db($dbname) or die(mysql_error());

if (!$con)
  {
  die('Couldnt connect to the database: ' . mysql_error());
  }mysql_select_db("mysql", $con);
$sql="INSERT INTO news (id, title, date, text)
VALUES
('$_POST[id]','$_POST[title]','$_POST[date]','$_POST[text]')";
if (!mysql_query($sql,$con))
  {
  die('Error: ' . mysql_error());
  }
echo "News item added! Go home to see it!";
mysql_close($con)
?&gt;

            &lt;?php
            		} else {
			echo "We aren't hiding anything here....";
		}
		?&gt;
&lt;?php 
require('footer.php'); 
?&gt;</code></pre>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/3</link>
        <pubDate>Mon, 06 Jan 2014 03:46:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-3</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@Ambokile Ambokile]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ambokile">@Ambokile</a> wrote:</p>
          <blockquote>
              <p>Well, you haven’t given us any code that references “news” at all, so we won’t be able to help you until you do so.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/2</link>
        <pubDate>Sun, 05 Jan 2014 22:46:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-2</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
      <item>
        <title>SQL is being stubborn</title>
        <dc:creator><![CDATA[@jal_knight jal knight]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/jal_knight">@jal_knight</a> wrote:</p>
          <blockquote>
              <p>I’m attempting to add a “add news” function to my smf which allows the front page to show it by “ids” once its recorded in the db but I’m getting “Error: Table ‘mysql.news’ doesn’t exist”.</p>
<pre><code class="lang-auto">&lt;?php
  $dbname = "smf";
  $dbuser = "root";
  $dbpass = "";
  $dbhost = "";

  $con = mysql_connect($dbhost, $dbuser, $dbpass) or die(mysql_error());
  mysql_select_db($dbname) or die(mysql_error());

if (!$con)
  {
  die('Couldnt connect to the database: ' . mysql_error());
  }mysql_select_db("mysql", $con);</code></pre>
<p>I’m pretty sure the error resides here because when I change</p>
<pre><code class="lang-auto">mysql_select_db("mysql", $con);</code></pre>
<p>to</p>
<pre><code class="lang-auto">mysql_select_db("smf", $con);</code></pre>
<p>I get an error stating the integer for the id is invalid.<br>
I’ve already created the table and have created it correctly so I’m %100 sure that isn’t the issue.</p>
<p>Any ideas?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161/1</link>
        <pubDate>Sun, 05 Jan 2014 20:47:28 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-538161-1</guid>
        <source url="https://forum.moparisthebest.com/t/sql-is-being-stubborn/538161.rss">SQL is being stubborn</source>
      </item>
  </channel>
</rss>
