<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>(Prototype) Accurate Memory Management System</title>
    <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654</link>
    <description>
[b]Purpose[/b]: It&#39;s to see how much RAM your server is using, and to do anything with the server if your system RAM usage gets too high (Which if it runs too high for too long, can cause hardware problems). So if you&#39;re not around to manage it yourself, the server can handle it for you.


Got bored and made a (somewhat) simple Memory Manager. Originally posted as a snippet. What this does is retrieve the system&#39;s available RAM (in bytes) and converts it to MB. As you can see in this screenshot: [url=http://prntscr.com/rmfet]http://prntscr.com/rmfet[/url] the calculations are accurate. I&#39;m currently using this for my server, and I must say that It&#39;s actually more helpful than it seems. 


This can probably be used for a lot of things and I&#39;ve probably only scratched the surface. Some things could be rewritten for optimization, But i just pretty much got the basics down and left it how it was. We&#39;ll also be building this class one method at a time. If there are any optimizations that can be made, lemme know. As of now, this only prints the memory information. [b]It&#39;s up to you to decide what actions are taken when memory gets too high![/b]


First, we need to make a class, we&#39;re gonna call it MemoryManager (because it will eventually manage your PC&#39;s memory, depending on how you act with it)


[code]package com.rs;


import com.rs.cores.CoresManager;
import com.rs.utils.Logger;
import java.lang.management.ManagementFactory;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.concurrent.TimeUnit;




public class MemoryManager {


// Stuff Goes here


}
[/code]


Now the first thing we&#39;re gonna do is specify how much memory your PC can handle using an integer. You may change this later according to how much RAM your PC has. My VPS has 1023 MB, so i set it to 925 to warn me usage is getting high:


[CODE]private static long MAX_MEMORY = (long) 950.0;[/CODE]


Now that&#39;s done, we&#39;re going to make a few methods. The first one being the one that will tell you how much RAM your SERVER is using (in bytes). This is grabbed from the JVM. 


[CODE]/**
     * Subtracts the server&#39;s free memory from the max available memory
     * to get you the amount being used in total (in bytes)
     */
    public static long getServerMemUsage() {
        return Runtime.getRuntime().maxMemory() - Runtime.getRuntime().freeMemory();
    }
[/CODE]


Now i&#39;ve made an extra unused method for the purpose of seeing how much memory the server can take up, if you choose to implement it or not:
This information is grabbed from the JVM. If no max memory available, then it returns Long.MAX_VALUE instead.


[CODE]/**
     * gets the max memory the server can use (in bytes)
     */
    public static long getServerMaxMemory() {
        return Runtime.getRuntime().maxMemory();
    }


[/CODE]


So now we have some server information we&#39;re gonna jump to your SYSTEM memory information. First thing we&#39;re going to do is retrieve the amount of ram your system has. This method took me a while to find, so dont hate 


[CODE]    /**
     * Gets your computer&#39;s available RAM (in bytes)
     */
    public static long getSystemMemory() {
        return ((com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean()).getTotalPhysicalMemorySize();
    }
[/CODE]


Now it&#39;s counterpart, the method to retrieve the amount of FREE ram your System has:


[CODE]/**
     * Gets your computer&#39;s free RAM (RAM not being used (in bytes))
     */
    public static long getSystemFreeMem() {
        return ((com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean()).getFreePhysicalMemorySize();
    }
[/CODE]


Now after that, we must know how much RAM is being used in total, so we&#39;re going to take the SystemMemory, and subtract out the free memory, giving is the amount that&#39;s been used:


[CODE]/**
     * subtracts the free memory, from the overall memory, to 
     * give you how much is being used (in bytes)
     */
    public static long systemMemoryUsage() {
        return getSystemMemory() - getSystemFreeMem();
    }
[/CODE]


An extra thing that i did was convert all bytes, into megabytes, for the sake of simplicity. So instead of trying to figure out how much bytes are in your amount of RAM, i&#39;ve already made the conversion to Megabytes. These two are for the server:


[CODE]/**
     * @return memory in MB
     */
    public static long serverUsageInMb() {
        return (getServerMemUsage() / 1048576);
    }
    public static long serverMaxMemoryInMb() {
        return (getServerMaxMemory() / 1048576);
    }
[/CODE]


These two are for the System:


[CODE]     /**
     * @return bytes into megabytes
     */
    public static long systemMemoryUsageInMb() {
        return (systemMemoryUsage() / 1048576);
    }
    public static long systemTotalMemoryInMb() {
        return (getSystemMemory() / 1048576);
    }
[/CODE]


Now that we have those, we can make a string which will tell us exactly what&#39;s being used. (two of them actually.) Will tell you the amount of MB being used compare to the max memory you server/system can use. 


[CODE]/**
     * @return the sytem memory information 
     */
    public static String systemMemoryInformation() {
      return &quot;&quot;+ systemMemoryUsageInMb()+&quot;MB/&quot;+ systemTotalMemoryInMb() +&quot;MB&quot;;
    }
    
    /**
     * @return the server memory information
     */
    public static String serverMemoryInformation() {
      return &quot;&quot;+ serverUsageInMb() +&quot;MB/&quot; + serverMaxMemoryInMb() + &quot;MB&quot;;
    } 
[/CODE]


Now the last we need to simply do is add a task to the server which will print out the amount of memory being used, and do anything you specify it to  when it reaches it&#39;s max:


[CODE]     /**
      * Add&#39;s the task to the server for printing information every 3 minutes
      */
    public static void addMemoryManagementTask() {
        CoresManager.slowExecutor.scheduleWithFixedDelay(new Runnable() {
            @Override
            public void run() {
                try {
                    if (systemMemoryUsageInMb() &gt; MAX_MEMORY) {
                        // Do Stuff here maybe?
                        System.err.println(&quot;CRITICAL MEMORY USAGE: &quot;+systemMemoryUsageInMb()+&quot;MB&quot;);
                        return;
                    }
                Logger.log(&quot;&quot;+getDate()+&quot; @ &quot;+getTime()+&quot;&quot;, &quot;System Memory: &quot;+systemMemoryInformation()+&quot; (Server is using &quot;+serverUsageInMb()+&quot;MB)&quot;);
                } catch (Throwable e) {
                    Logger.handle(e);
                }
            }
        }, 0, 3, TimeUnit.MINUTES);
    }
[/CODE]




Now then, After that, there&#39;s a few mediocre methods that will return the time and date. If you dont want to use these, you dont have too, but the getDate and getTime in the task will need to be removed. This calls the calendar and gets the server&#39;s time and date. (derp.)


[CODE] /**
     * @return: the System Time
     */
    public static String getTime() {
    Calendar cal = Calendar.getInstance();
        cal.getTime();
        SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm:ss&quot;);
        return sdf.format(cal.getTime());
    }




    /**
     * @return System Date
     */
    public static String getDate() {
        int day = Calendar.DAY_OF_MONTH;
        String month = Calendar.MONTH == 1 ? &quot;Jan.&quot; : 
                       Calendar.MONTH == 2 ? &quot;Feb.&quot; : 
                       Calendar.MONTH == 3 ? &quot;March&quot; :
                       Calendar.MONTH == 4 ? &quot;April&quot; :
                       Calendar.MONTH == 5 ? &quot;May&quot; :
                       Calendar.MONTH == 6 ? &quot;June&quot; :
                       Calendar.MONTH == 7 ? &quot;July&quot; :
                       Calendar.MONTH == 8 ? &quot;Aug.&quot; :
                       Calendar.MONTH == 9 ? &quot;Sep.&quot; :
                       Calendar.MONTH == 10 ? &quot;Oct.&quot; :
                       Calendar.MONTH == 11 ? &quot;Nov.&quot; :
                       Calendar.MONTH == 12 ? &quot;Dec.&quot; : &quot;&quot;;
        return &quot;&quot;+month+&quot; &quot;+day;
    }
[/CODE]

And in case you want to monitor the ram without having to access the machine while you play:

[code]if (cmd[0].equals(&quot;memory&quot;)) {
                player.getPackets().sendPanelBoxMessage(&quot;Server Memory: &lt;col=00FFFF&gt;&quot;+MemoryManager.serverMemoryInformation()+&quot;&lt;/col&gt;&quot;);
                player.getPackets().sendPanelBoxMessage(&quot;System Memory: &lt;col=00FFFF&gt;&quot;+MemoryManager.systemMemoryInformation()+&quot;&lt;/col&gt;&quot;);
                return true;            }[/code]

And there you have it. Criticism is welcome, as I know this probably could be optimized abit. Feedback Pl0x!</description>
    
    <lastBuildDate>Wed, 13 Feb 2013 06:13:30 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@blackflag1 blackflag_]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/blackflag1">@blackflag1</a> wrote:</p>
          <blockquote>
              <p>[quote=“Clawz fury, post:17, topic:481654”][quote author=relexlawl link=topic=599893.msg4220709#msg4220709 date=1360728809]<br>
Sources such as apollo can handle 2000 players easily with 256mb…<br>
[/quote]<br>
who actually uses apollo lol[/quote]</p>
<p>quite few people on r-s idk about mopar</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/19</link>
        <pubDate>Wed, 13 Feb 2013 06:13:30 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-19</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <p>[quote=“Clawz fury, post:17, topic:481654”][quote author=relexlawl link=topic=599893.msg4220709#msg4220709 date=1360728809]<br>
Sources such as apollo can handle 2000 players easily with 256mb…<br>
[/quote]<br>
who actually uses apollo lol[/quote]</p>
<p>Said such as…Unless you’re using a horrid PI source you would run into a memory problem with 2k players on a low-ram host…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/18</link>
        <pubDate>Wed, 13 Feb 2013 06:10:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-18</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <aside class="quote quote-modified" data-post="16" data-topic="481654">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/relexlawl/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> relexlawl:</div>
<blockquote>
<p>Sources such as apollo can handle 2000 players easily with 256mb…</p>
</blockquote>
</aside>
<p>who actually uses apollo lol</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/17</link>
        <pubDate>Wed, 13 Feb 2013 04:44:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-17</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <p>Sources such as apollo can handle 2000 players easily with 256mb…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/16</link>
        <pubDate>Wed, 13 Feb 2013 04:13:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-16</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p>[quote=“eyeownyew, post:12, topic:481654”]Just saying, anyone who has a server that can use 1gb of ram should quit programming altogether</p>
<p>Decent idea regardless, could be useful for different programs[/quote]</p>
<p>1GB ram is all you need to host a server…If you’re running it in Eclipse or Netbeans it will use an easy 700-800mb.</p>
<aside class="quote" data-post="13" data-topic="481654">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/yesteryear/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Yesteryear:</div>
<blockquote>
<p>There are tools to measure memory pretty accurate. Consider <a href="http://visualvm.java.net/" data-bbcode="true" rel="nofollow noopener">VisualVM</a>. Good job nonetheless.</p>
</blockquote>
</aside>
<p>There might be, assuming that <span class="bbcode-b">everyone</span> has access to download the programs and has the knowledge of what they’re looking at…then yea, would be an alright choice.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/15</link>
        <pubDate>Wed, 13 Feb 2013 01:36:50 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-15</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@relexlawl relexlawl]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relexlawl">@relexlawl</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="8" data-topic="481654">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/fox2007/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Fox2007:</div>
<blockquote>
<p>Glad someone could appreciate it. People on R-S are being fags hatin on it as always. <img src="https://forum.moparisthebest.com/images/emoji/twitter/expressionless.png?v=5" title=":expressionless:" class="emoji" alt=":expressionless:"></p>
</blockquote>
</aside>
<p>I just went through the thread and most, if not everything, they said is correct…You’ve had a lot of smart people (i.e Graham) even post there, but yet you just think of it as hating…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/14</link>
        <pubDate>Fri, 08 Feb 2013 18:35:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-14</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Yesteryear Yesteryear]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/yesteryear">@Yesteryear</a> wrote:</p>
          <blockquote>
              <p>There are tools to measure memory pretty accurate. Consider <a href="http://visualvm.java.net/" data-bbcode="true" rel="nofollow noopener">VisualVM</a>. Good job nonetheless.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/13</link>
        <pubDate>Fri, 08 Feb 2013 17:03:13 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-13</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@eyeownyew Eyeownyew]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/eyeownyew">@eyeownyew</a> wrote:</p>
          <blockquote>
              <p>Just saying, anyone who has a server that can use 1gb of ram should quit programming altogether</p>
<p>Decent idea regardless, could be useful for different programs</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/12</link>
        <pubDate>Fri, 08 Feb 2013 05:26:35 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-12</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p>^ thanks. People are making this out to what it’s not, and its alittle more helpful than you think, especially if you don;t have access or cant get access to certain other resources…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/11</link>
        <pubDate>Fri, 08 Feb 2013 04:40:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-11</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@holylouis holylouis]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/holylouis">@holylouis</a> wrote:</p>
          <blockquote>
              <p>ill consider on using this looks decent</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/10</link>
        <pubDate>Fri, 08 Feb 2013 03:38:38 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-10</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@asshole_rule asshole_rule]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/asshole_rule">@asshole_rule</a> wrote:</p>
          <blockquote>
              <p>is this a joke?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/9</link>
        <pubDate>Thu, 07 Feb 2013 22:53:02 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-9</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p>Glad someone could appreciate it. People on R-S are being fags hatin on it as always. <img src="https://forum.moparisthebest.com/images/emoji/twitter/expressionless.png?v=5" title=":expressionless:" class="emoji" alt=":expressionless:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/8</link>
        <pubDate>Wed, 06 Feb 2013 10:35:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-8</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>wow, nice job fox <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"> using this for my statistics system <img src="https://forum.moparisthebest.com/images/emoji/twitter/slight_smile.png?v=5" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/7</link>
        <pubDate>Wed, 06 Feb 2013 05:09:16 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-7</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p>RiiPiiNFtW, the information is printed through the console. The command isn’t even necessary. It’s just to see what the memory usage is while you’re in-game or unable to access the computer remotely.</p>
<p>Logger.log isnt to log anything to a text file. It’s to print information to the console (or the cmd prompt…).</p>
<p>There’s also quite a few nifty things in the management package, and the runtime package. Stuff like getting the amount of time sinze the JVM was started for that instance O_O (aka Uptime Counter).</p>
<p>[code]<br>
public static long serverUptime() {<br>
return ManagementFactory.getRuntimeMXBean().getUptime();<br>
}</p>
<pre><code>    private static final String FORMAT = "%02d:%02d:%02d";
    public static String formatMs(long ms) {
        return String.format(FORMAT,
          TimeUnit.MILLISECONDS.toHours(ms),
          TimeUnit.MILLISECONDS.toMinutes(ms) - TimeUnit.HOURS.toMinutes(TimeUnit.MILLISECONDS.toHours(ms)),
          TimeUnit.MILLISECONDS.toSeconds(ms) - TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(ms)));
    }[/code]
</code></pre>
<p>Which if used a certain way, can make things look like dis: <a href="http://prntscr.com/rn5yn" rel="nofollow noopener">http://prntscr.com/rn5yn</a></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/6</link>
        <pubDate>Tue, 05 Feb 2013 12:33:20 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-6</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Clawz_fury lare69]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/clawz_fury">@Clawz_fury</a> wrote:</p>
          <blockquote>
              <p>Actually pretty useful, I know what I’m going to do with this. Thanks. Never even knew there was a <span class="bbcode-i">java.lang.management</span> package</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/5</link>
        <pubDate>Tue, 05 Feb 2013 12:27:44 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-5</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@RiiPiiNFtW RiiPiiNFtW]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/riipiinftw">@RiiPiiNFtW</a> wrote:</p>
          <blockquote>
              <p>I did.</p>
<p><code>if (cmd[0].equals("memory")) {
                player.getPackets().sendPanelBoxMessage("Server Memory: &lt;col=00FFFF&gt;"+MemoryManager.serverMemoryInformation()+"&lt;/col&gt;");
                player.getPackets().sendPanelBoxMessage("System Memory: &lt;col=00FFFF&gt;"+MemoryManager.systemMemoryInformation()+"&lt;/col&gt;");
                return true;            }</code></p>
<p>Unless im crazy,  doesn’t work in a CMD prompt.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/4</link>
        <pubDate>Tue, 05 Feb 2013 10:20:45 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-4</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p>It does O_O (Someone didnt actually look at the code &gt;.&gt;)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/3</link>
        <pubDate>Tue, 05 Feb 2013 08:44:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-3</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@RiiPiiNFtW RiiPiiNFtW]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/riipiinftw">@RiiPiiNFtW</a> wrote:</p>
          <blockquote>
              <p>Looks cool, I’d send the memory usage through the command prompt though. Thats just me though. <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/2</link>
        <pubDate>Tue, 05 Feb 2013 08:04:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-2</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
      <item>
        <title>(Prototype) Accurate Memory Management System</title>
        <dc:creator><![CDATA[@Fox2007 Fox2007]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/fox2007">@Fox2007</a> wrote:</p>
          <blockquote>
              <p><span class="bbcode-b">Purpose</span>: It’s to see how much RAM your server is using, and to do anything with the server if your system RAM usage gets too high (Which if it runs too high for too long, can cause hardware problems). So if you’re not around to manage it yourself, the server can handle it for you.</p>
<p>Got bored and made a (somewhat) simple Memory Manager. Originally posted as a snippet. What this does is retrieve the system’s available RAM (in bytes) and converts it to MB. As you can see in this screenshot: <a href="http://prntscr.com/rmfet" data-bbcode="true" rel="nofollow noopener">http://prntscr.com/rmfet</a> the calculations are accurate. I’m currently using this for my server, and I must say that It’s actually more helpful than it seems.</p>
<p>This can probably be used for a lot of things and I’ve probably only scratched the surface. Some things could be rewritten for optimization, But i just pretty much got the basics down and left it how it was. We’ll also be building this class one method at a time. If there are any optimizations that can be made, lemme know. As of now, this only prints the memory information. <span class="bbcode-b">It’s up to you to decide what actions are taken when memory gets too high!</span></p>
<p>First, we need to make a class, we’re gonna call it MemoryManager (because it will eventually manage your PC’s memory, depending on how you act with it)</p>
<p>[code]package com.rs;</p>
<p>import com.rs.cores.CoresManager;<br>
import com.rs.utils.Logger;<br>
import java.lang.management.ManagementFactory;<br>
import java.text.SimpleDateFormat;<br>
import java.util.Calendar;<br>
import java.util.concurrent.TimeUnit;</p>
<p>public class MemoryManager {</p>
<p>// Stuff Goes here</p>
<p>}<br>
[/code]</p>
<p>Now the first thing we’re gonna do is specify how much memory your PC can handle using an integer. You may change this later according to how much RAM your PC has. My VPS has 1023 MB, so i set it to 925 to warn me usage is getting high:</p>
<pre><code class="lang-auto"></code></pre>
<p>Now that’s done, we’re going to make a few methods. The first one being the one that will tell you how much RAM your SERVER is using (in bytes). This is grabbed from the JVM.</p>
<p><code>/**
     * Subtracts the server's free memory from the max available memory
     * to get you the amount being used in total (in bytes)
     */
    public static long getServerMemUsage() {
        return Runtime.getRuntime().maxMemory() - Runtime.getRuntime().freeMemory();
    }
</code></p>
<p>Now i’ve made an extra unused method for the purpose of seeing how much memory the server can take up, if you choose to implement it or not:<br>
This information is grabbed from the JVM. If no max memory available, then it returns Long.MAX_VALUE instead.</p>
<p>[CODE]/**<br>
* gets the max memory the server can use (in bytes)<br>
*/<br>
public static long getServerMaxMemory() {<br>
return Runtime.getRuntime().maxMemory();<br>
}</p>
<p>[/CODE]</p>
<p>So now we have some server information we’re gonna jump to your SYSTEM memory information. First thing we’re going to do is retrieve the amount of ram your system has. This method took me a while to find, so dont hate</p>
<p><code>    /**
     * Gets your computer's available RAM (in bytes)
     */
    public static long getSystemMemory() {
        return ((com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean()).getTotalPhysicalMemorySize();
    }
</code></p>
<p>Now it’s counterpart, the method to retrieve the amount of FREE ram your System has:</p>
<p><code>/**
     * Gets your computer's free RAM (RAM not being used (in bytes))
     */
    public static long getSystemFreeMem() {
        return ((com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean()).getFreePhysicalMemorySize();
    }
</code></p>
<p>Now after that, we must know how much RAM is being used in total, so we’re going to take the SystemMemory, and subtract out the free memory, giving is the amount that’s been used:</p>
<p><code>/**
     * subtracts the free memory, from the overall memory, to 
     * give you how much is being used (in bytes)
     */
    public static long systemMemoryUsage() {
        return getSystemMemory() - getSystemFreeMem();
    }
</code></p>
<p>An extra thing that i did was convert all bytes, into megabytes, for the sake of simplicity. So instead of trying to figure out how much bytes are in your amount of RAM, i’ve already made the conversion to Megabytes. These two are for the server:</p>
<p><code>/**
     * @return memory in MB
     */
    public static long serverUsageInMb() {
        return (getServerMemUsage() / 1048576);
    }
    public static long serverMaxMemoryInMb() {
        return (getServerMaxMemory() / 1048576);
    }
</code></p>
<p>These two are for the System:</p>
<p><code>     /**
     * @return bytes into megabytes
     */
    public static long systemMemoryUsageInMb() {
        return (systemMemoryUsage() / 1048576);
    }
    public static long systemTotalMemoryInMb() {
        return (getSystemMemory() / 1048576);
    }
</code></p>
<p>Now that we have those, we can make a string which will tell us exactly what’s being used. (two of them actually.) Will tell you the amount of MB being used compare to the max memory you server/system can use.</p>
<p>[CODE]/**<br>
* <a class="mention" href="/u/return">@return</a> the sytem memory information<br>
*/<br>
public static String systemMemoryInformation() {<br>
return “”+ systemMemoryUsageInMb()+“MB/”+ systemTotalMemoryInMb() +“MB”;<br>
}</p>
<pre><code>/**
 * @return the server memory information
 */
public static String serverMemoryInformation() {
  return ""+ serverUsageInMb() +"MB/" + serverMaxMemoryInMb() + "MB";
} 
</code></pre>
<p>[/CODE]</p>
<p>Now the last we need to simply do is add a task to the server which will print out the amount of memory being used, and do anything you specify it to  when it reaches it’s max:</p>
<p><code>     /**
      * Add's the task to the server for printing information every 3 minutes
      */
    public static void addMemoryManagementTask() {
        CoresManager.slowExecutor.scheduleWithFixedDelay(new Runnable() {
            @Override
            public void run() {
                try {
                    if (systemMemoryUsageInMb() &gt; MAX_MEMORY) {
                        // Do Stuff here maybe?
                        System.err.println("CRITICAL MEMORY USAGE: "+systemMemoryUsageInMb()+"MB");
                        return;
                    }
                Logger.log(""+getDate()+" @ "+getTime()+"", "System Memory: "+systemMemoryInformation()+" (Server is using "+serverUsageInMb()+"MB)");
                } catch (Throwable e) {
                    Logger.handle(e);
                }
            }
        }, 0, 3, TimeUnit.MINUTES);
    }
</code></p>
<p>Now then, After that, there’s a few mediocre methods that will return the time and date. If you dont want to use these, you dont have too, but the getDate and getTime in the task will need to be removed. This calls the calendar and gets the server’s time and date. (derp.)</p>
<p>[CODE] /**<br>
* <a class="mention" href="/u/return">@return</a>: the System Time<br>
*/<br>
public static String getTime() {<br>
Calendar cal = Calendar.getInstance();<br>
cal.getTime();<br>
SimpleDateFormat sdf = new SimpleDateFormat(“HH:mm:ss”);<br>
return sdf.format(cal.getTime());<br>
}</p>
<pre><code>/**
 * @return System Date
 */
public static String getDate() {
    int day = Calendar.DAY_OF_MONTH;
    String month = Calendar.MONTH == 1 ? "Jan." : 
                   Calendar.MONTH == 2 ? "Feb." : 
                   Calendar.MONTH == 3 ? "March" :
                   Calendar.MONTH == 4 ? "April" :
                   Calendar.MONTH == 5 ? "May" :
                   Calendar.MONTH == 6 ? "June" :
                   Calendar.MONTH == 7 ? "July" :
                   Calendar.MONTH == 8 ? "Aug." :
                   Calendar.MONTH == 9 ? "Sep." :
                   Calendar.MONTH == 10 ? "Oct." :
                   Calendar.MONTH == 11 ? "Nov." :
                   Calendar.MONTH == 12 ? "Dec." : "";
    return ""+month+" "+day;
}
</code></pre>
<p>[/CODE]</p>
<p>And in case you want to monitor the ram without having to access the machine while you play:</p>
<p><code>if (cmd[0].equals("memory")) {
                player.getPackets().sendPanelBoxMessage("Server Memory: &lt;col=00FFFF&gt;"+MemoryManager.serverMemoryInformation()+"&lt;/col&gt;");
                player.getPackets().sendPanelBoxMessage("System Memory: &lt;col=00FFFF&gt;"+MemoryManager.systemMemoryInformation()+"&lt;/col&gt;");
                return true;            }</code></p>
<p>And there you have it. Criticism is welcome, as I know this probably could be optimized abit. Feedback Pl0x!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654/1</link>
        <pubDate>Tue, 05 Feb 2013 06:54:31 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-481654-1</guid>
        <source url="https://forum.moparisthebest.com/t/prototype-accurate-memory-management-system/481654.rss">(Prototype) Accurate Memory Management System</source>
      </item>
  </channel>
</rss>
