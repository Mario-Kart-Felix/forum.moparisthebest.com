<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Dementhium 639: Adding PvP Drops CMON! PLEASE</title>
    <link>https://forum.moparisthebest.com/t/dementhium-639-adding-pvp-drops-cmon-please/535180</link>
    <description>I am trying to recreate the amazing PvP worlds of 2010-11 using dementhium. Things are well until I came across this issue. I am trying to test the PvP Drop system I made. I will show you soon the function that drops the item. I tested it with only the &quot;bones&quot; item, or item 526. The issue is, the bones get dropped yet it drops 28 bones (I believe that something having to do with the inventory is occurring).

The following is the method I used: 

[code=java]public static void dropPvpLow(Player player, Player killer) {
    GroundItemManager.createGroundItem(new GroundItem(killer, 526, 1, player.getLocation(), false));

}[/code]

The following is the GroundItem class&#39;s constructors:

[code=java]  public GroundItem(Player player, Item item, Location location,
                      boolean isPublic) {
        this.item = item;
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
   public GroundItem(Player player, int item, Location location,
                      boolean isPublic) {
        this.item = new Item(item);
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
	public GroundItem(Player player, int item, int amount, Location location,
                      boolean isPublic) {
        this.item = new Item(item, amount);
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
    public GroundItem(Player player, Item item, int x, int y, int z,
                      boolean isPublic) {
        this.item = item;
        this.location = Position.create(x, y, z);
        this.isPublic = isPublic;
        this.player = player;
    }[/code]

And here under this line is the method the dropPvpLow(Player player, Player killer) method is called:

[code=java]	 public static boolean appendDeath(Player player) {
			final Mob killer = player.getCombatExecutor().getLastAttacker();
			Settings settings = new Settings();
	        if(player.getRights() == 2) {
	        	return false;
	        }
	        Container[] keptItems = ItemsKeptOnDeath.getDeathContainers(player);
	        player.getInventory().getContainer().clear();
	        player.getEquipment().getContainer().clear();
	        for (Item item : keptItems[0].toArray()) {
	            if (item != null) {
	                player.getInventory().addItem(item);
	            }
	        }
	        player.getEquipment().refresh();
	        player.getInventory().refresh();
	       
	       

	        if (killer.isPlayer()) {
		 final Player lp = (Player)killer;
		int totalValue = 0;
		int value = -1;
		int i = 0;
			Container cont = new Container(Inventory.SIZE, false);
		ActionSender.sendItems(player, 90, cont, false);
		for (Item item : cont.toArray()) {
			if (item != null) {
				value = item.getDefinition().getStorePrice();//.getExchangePrice();
				totalValue += value * item.getAmount();
			}
			if (value &gt;= 76000 &amp;&amp; settings.ep &gt; 75) {
				dropPvpHigh(player, lp);
				lp.removeEP(Misc.random(8, 30));
			} else {
				dropPvpLow(player, lp);
				lp.removeEP(Misc.random(5, 13));
			}
		}
	        } else {
		        for (Item item : keptItems[1].toArray()) {
		            if (item != null) {
		            	if (!item.getDefinition().isDropable()) {
	                		continue;
	                	}
							if (player.getRights() != 2) {
        							  GraveStoneManager.appendDeath(player, killer);
        						  }
		                GroundItemManager.createGroundItem(new GroundItem(player, item, player.getLocation(), false));
		            }
		        }
	        }
	        return false;
	    }[/code]

I am also open to any suggestions as to how to make this PvP system work based on this code.</description>
    
    <lastBuildDate>Sun, 03 Nov 2013 19:42:06 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/dementhium-639-adding-pvp-drops-cmon-please/535180.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Dementhium 639: Adding PvP Drops CMON! PLEASE</title>
        <dc:creator><![CDATA[@Docent Limits]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/docent">@Docent</a> wrote:</p>
          <blockquote>
              <p>I am trying to recreate the amazing PvP worlds of 2010-11 using dementhium. Things are well until I came across this issue. I am trying to test the PvP Drop system I made. I will show you soon the function that drops the item. I tested it with only the “bones” item, or item 526. The issue is, the bones get dropped yet it drops 28 bones (I believe that something having to do with the inventory is occurring).</p>
<p>The following is the method I used:</p>
<p>[code=java]public static void dropPvpLow(Player player, Player killer) {<br>
GroundItemManager.createGroundItem(new GroundItem(killer, 526, 1, player.getLocation(), false));</p>
<p>}[/code]</p>
<p>The following is the GroundItem class’s constructors:</p>
<p><code>  public GroundItem(Player player, Item item, Location location,
                      boolean isPublic) {
        this.item = item;
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
   public GroundItem(Player player, int item, Location location,
                      boolean isPublic) {
        this.item = new Item(item);
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
	public GroundItem(Player player, int item, int amount, Location location,
                      boolean isPublic) {
        this.item = new Item(item, amount);
        this.location = Position.create(location.getX(), location.getY(), location.getZ());
        this.isPublic = isPublic;
        this.player = player;
    }
    public GroundItem(Player player, Item item, int x, int y, int z,
                      boolean isPublic) {
        this.item = item;
        this.location = Position.create(x, y, z);
        this.isPublic = isPublic;
        this.player = player;
    }</code></p>
<p>And here under this line is the method the dropPvpLow(Player player, Player killer) method is called:</p>
<p>[code=java]	 public static boolean appendDeath(Player player) {<br>
final Mob killer = player.getCombatExecutor().getLastAttacker();<br>
Settings settings = new Settings();<br>
if(player.getRights() == 2) {<br>
return false;<br>
}<br>
Container[] keptItems = ItemsKeptOnDeath.getDeathContainers(player);<br>
player.getInventory().getContainer().clear();<br>
player.getEquipment().getContainer().clear();<br>
for (Item item : keptItems[0].toArray()) {<br>
if (item != null) {<br>
player.getInventory().addItem(item);<br>
}<br>
}<br>
player.getEquipment().refresh();<br>
player.getInventory().refresh();</p>
<pre><code>        if (killer.isPlayer()) {
	 final Player lp = (Player)killer;
	int totalValue = 0;
	int value = -1;
	int i = 0;
		Container cont = new Container(Inventory.SIZE, false);
	ActionSender.sendItems(player, 90, cont, false);
	for (Item item : cont.toArray()) {
		if (item != null) {
			value = item.getDefinition().getStorePrice();//.getExchangePrice();
			totalValue += value * item.getAmount();
		}
		if (value &gt;= 76000 &amp;&amp; settings.ep &gt; 75) {
			dropPvpHigh(player, lp);
			lp.removeEP(Misc.random(8, 30));
		} else {
			dropPvpLow(player, lp);
			lp.removeEP(Misc.random(5, 13));
		}
	}
        } else {
	        for (Item item : keptItems[1].toArray()) {
	            if (item != null) {
	            	if (!item.getDefinition().isDropable()) {
                		continue;
                	}
						if (player.getRights() != 2) {
    							  GraveStoneManager.appendDeath(player, killer);
    						  }
	                GroundItemManager.createGroundItem(new GroundItem(player, item, player.getLocation(), false));
	            }
	        }
        }
        return false;
    }[/code]
</code></pre>
<p>I am also open to any suggestions as to how to make this PvP system work based on this code.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/dementhium-639-adding-pvp-drops-cmon-please/535180/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/dementhium-639-adding-pvp-drops-cmon-please/535180/1</link>
        <pubDate>Sun, 03 Nov 2013 19:42:06 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-535180-1</guid>
        <source url="https://forum.moparisthebest.com/t/dementhium-639-adding-pvp-drops-cmon-please/535180.rss">Dementhium 639: Adding PvP Drops CMON! PLEASE</source>
      </item>
  </channel>
</rss>
