<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Managing Packets with an Array</title>
    <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950</link>
    <description>This tutorial will show you how to replace your current method of managing packets (Usually the &#39;parseIncomingPackets()&#39; method which consists of a large switch-statement, in most Winterlove-based servers) with this better, faster and more efficient method (An array).

Firstly, let me explain the concept of an array.

Arrays are a way to store a list of items. Each slot of an array holds an individual element,
and you can place elements into or change the contents of those slots as you need to. An array can contain any type of element value (primitive types or objects).

[u][b]Tutorial[/b][/u]

[u][b]Step 1: Creating the PacketManager class.[/b][/u]

To start off the tutorial, we will need to create the class that will be managing the packets. You will need to change the packaging of the class and the imports in this tutorial accordingly to the packaging of your server.

[code]package rs2.iClarity.net;

/**
 * Manages Packets.
 * @author Primadude.
 */
public class PacketManager {

}[/code]


[u][b]Step 2: Creating the Interface for the packets.[/b][/u]

We now need to create the interface from which each packet class will be branched (implemented) from.

[code]package net.iClarity.packets;

import net.iClarity.model.Client;

/**
 * Interface for packets.
 * @author Primadude.
 */
public interface PacketHandler {

        /**
         * Handles the packet.
         * @param c The player that the packet is created for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
        public void handlePacket(Client c, int packetType, int packetSize);

}[/code]


Each packet class, implemented off this interface, will contain the &#39;handlePacket&#39; method but will contain the packet content within the method.


[u][b]Step 3: Creating the array, initializing it and assigning it a maximum amount of slots.[/b][/u]

Our PacketManager is currently empty and will not do anything yet, so, we need to declare our array. The array&#39;s type will be an Object of the PacketHandler class.
[code]        /**
         * Array to store packet class data.
         */
        private static PacketHandler[] packetHandler;[/code]

This array does not have any maximum amount of slots set yet, so we need to replace it with:
[code]        /**
         * Array to store packet class data.
         * Maximum packets: 256.
         */
        private static PacketHandler[] packetHandler = new PacketHandler[256];[/code]


The reason for the maximum amount of slots being 256, is because packets are sent in bytes and the maximum value for a byte is 2 ^ 8 (256). The &#39;packetHandler&#39; array is static - this means it does not belong to this class and we will only need to load the packet data once.


[u][b]Step 4: Declaring the method to load the packet data.[/b][/u]

The array now exists, but it does not have any values assigned to it, so we need to declare the method to do so:
[code]	public void loadPackets() {

	}[/code]

We will leave this method for now.


[u][b]Step 5: Declaring the packet executing/processing method.[/b][/u]

We will now declare the method which will execute/process each packet:
[code]        /**
         * Processes the packet.
         * @param c The player to process for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
	public static void executePacket(Client c, int packetType, int packetSize) {
		if (packetType == -1) {
			return;
		}
		if (packetHandler[packetType] != null) {
			try {
				packetHandler[packetType].handlePacket(c, packetType, packetSize);
			} catch(Exception exception) {
				Logger.log(Level.WARNING, &quot;Error thrown whilst processing packets:&quot;);
                                exception.printStackTrace();
                        }
		} else {
                        /**
                         * Logs the packets that arent handled.
                         */
			Logger.info(&quot;Unhandled Packet: [ID = &quot; + packetType + &quot;; Size = &quot;+ packetSize +&quot;]&quot;);
		}
	}[/code]

For this method we will need to import the Client class, the Logger class and the Level class:
[code]import net.iClarity.model.Client;

import java.util.logging.Level;
import java.util.logging.Logger;[/code]

This method that we have just declared calls the &#39;handlePacket&#39; method from the class that is assigned to the specific slot of the type of the packet (If the slot has been assigned a value, if not, the packet data is logged). If an error is thrown whilst processing the packets, it will be caught by the try-catch statement, the error will be logged in the output, and the server will continue to run.


[u][b]Step 6: Assigning data to the array and creating a packet class.[/b][/u]

We now have to add an object of the class to the packet type slot. An example:
[code]packetHandler[103] = new CommandPacket();[/code]

This will assign the 103rd slot (Packet type 103) of the array the CommandPacket Object.

For this you will need to create and import the &#39;packets&#39; package that you should place each packet class (And the PacketHandler interface) into.
[code]import net.iClarity.packets.*;[/code]

Your &#39;loadPackets()&#39; method should now look like this:
[code]        public void loadPackets() {
                packetHandler[103] = new CommandPacket();
        }[/code]

The CommandPacket class does not exist yet so we need to create it:
[code]package net.iClarity.packets;

import net.iClarity.model.Client;

/**
 * The Commands packet.
 * @author Primadude.
 */
public class CommandPacket implements PacketHandler {

        /**
         * Handles the Packet.
         * @param c The player that the packet created for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
	@Override
	public void handlePacket(Client c, int packetType, int packetSize) {
                String command = c.inStream.readString();
	}

}[/code]

This class implements the &#39;PacketHandler&#39; interface. Within the &#39;handlePacket&#39; method is the &#39;command&#39; String which has been assigned a value (The String read from the client). This value is the command that the player types.
Within this method, and for every &#39;handlePacket&#39; method in each packet class, you should add whatever you want to happen when this packet is sent from the client.


[u][b]Step 8: Calling the packets to be processed.[/b][/u]

We will now replace the calling of the &#39;parseIncomingPackets()&#39; method (Or equivalent method) with a calling of the &#39;execute&#39; method within the PacketManager class.
In your &#39;client&#39; method, find the calling &#39;parseIncomingPackets();&#39; and replace it with:
[code]new PacketManager().executePacket(this, packetType, packetSize);[/code]

You will also need to import the &#39;PacketManager&#39; class from within your &#39;client&#39; class (Or equivalent class):
[code]import net.iClarity.net.PacketManager;[/code]


You have now successfully replaced your current packet managing method with this one.

_______________________________________________________________________


Your &#39;PacketManager&#39; class should now look something like this:

[code]package net.iClarity.net;

import net.iClarity.model.Client;
import net.iClarity.packets.*;

import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * Manages Packets.
 * @author Primadude.
 */
public class PacketManager {

        /**
         * Array to store packet class data.
         * Maximum packets: 256.
         */
        private static PacketHandler[] packetHandler = new PacketHandler[256];

        /**
         * Assigns the packet data to the packetHandler array.
         */
	public void loadPackets() {
		packetHandler[103] = new CommandPacket();

	}

        /**
         * Processes the packet.
         * @param c The player to process for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
	public static void executePacket(Client c, int packetType, int packetSize) {
		if (packetType == -1) {
			return;
		}
		if (packetHandler[packetType] != null) {
			try {
				packetHandler[packetType].handlePacket(c, packetType, packetSize);
			} catch(Exception exception) {
				Logger.log(Level.WARNING, &quot;Error thrown whilst processing packets:&quot;);
                                exception.printStackTrace();
                        }
		} else {
                        /**
                         * Logs the packets that arent handled.
                         */
			Logger.info(&quot;Unhandled Packet: [ID = &quot; + packetType + &quot;; Size = &quot;+ packetSize +&quot;]&quot;);
		}
	}

}[/code]



Here is the template for a new Packet class:
[code]package net.iClarity.packets;

import net.iClarity.model.Client;

/**
 * Description of packet.
 * @author Primadude.
 */
public class PacketTemplate implements PacketHandler {

        /**
         * Handles the packet.
         * @param c The player that the packet created for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
	@Override
	public void handlePacket(Client c, int packetType, int packetSize) {

	}

}[/code]</description>
    
    <lastBuildDate>Mon, 19 Dec 2011 11:23:01 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@gara494 gara494]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/gara494">@gara494</a> wrote:</p>
          <blockquote>
              <p>… Just finished two whole days refactoring… Awkz :S</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/21">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/21</link>
        <pubDate>Mon, 19 Dec 2011 11:23:01 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-21</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>By now we’ve realized that this is a bad way to do it anyways <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/20">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/20</link>
        <pubDate>Mon, 19 Dec 2011 06:06:09 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-20</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@gara494 gara494]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/gara494">@gara494</a> wrote:</p>
          <blockquote>
              <p>Sorry for kinda gravedigging, but i have an error i need fixed, or rather a question.</p>
<p>When Loading the packets, how should i go about doing it? I’ve been loading it at the server startup but i had to make the method static. The problem I’m having is the click packet(241) isn’t working. I can’t walk on command, even though that packet is definitely working, as when i click an npc i walk there normally, and the other clickingbutton packets have been bugging up, ie debugging messages not showing up for ClickingMostbuttons(185).</p>
<p>Help is appreciated, thank you.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/19">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/19</link>
        <pubDate>Mon, 19 Dec 2011 02:38:43 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-19</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <p>[quote=“Primadude, post:15, topic:325950”][quote author=relmitos link=topic=422360.msg3103688#msg3103688 date=1263933623]<br>
<a href="http://www.rune-shit.org/showthread.php?t=202992" class="onebox" target="_blank" rel="nofollow noopener">http://www.rune-shit.org/showthread.php?t=202992</a></p>
<p>This seems quite similiar to yours, though poorly explained.<br>
[/quote]</p>
<p>I don’t leech; go somewhere else with your false accusations.[/quote]</p>
<p>I didn’t accuse you of anything. No need to get defensive…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/18">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/18</link>
        <pubDate>Wed, 20 Jan 2010 17:16:56 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-18</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="16" data-topic="325950">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/yz85racer/40/5_513041d5f7104045db30895d3b90af16.png" class="avatar"> Yz85Racer:</div>
<blockquote>
<p>leacher</p>
</blockquote>
</aside>
<p>Lol’d</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/17">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/17</link>
        <pubDate>Wed, 20 Jan 2010 16:36:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-17</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@Yz85Racer Yz85Racer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/yz85racer">@Yz85Racer</a> wrote:</p>
          <blockquote>
              <p>leacher</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/16">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/16</link>
        <pubDate>Wed, 20 Jan 2010 16:06:49 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-16</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>[quote=“relmitos, post:13, topic:325950”]<a href="http://www.rune-shit.org/showthread.php?t=202992" rel="nofollow noopener">http://www.rune-shit.org/showthread.php?t=202992</a></p>
<p>This seems quite similiar to yours, though poorly explained.[/quote]</p>
<p>I don’t leech; go somewhere else with your false accusations.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/15">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/15</link>
        <pubDate>Wed, 20 Jan 2010 15:52:42 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-15</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@badger41 badger41]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/badger41">@badger41</a> wrote:</p>
          <blockquote>
              <p>[quote=“relmitos, post:13, topic:325950”]<a href="http://www.rune-shit.org/showthread.php?t=202992" rel="nofollow noopener">http://www.rune-shit.org/showthread.php?t=202992</a></p>
<p>This seems quite similiar to yours, though poorly explained.[/quote]</p>
<p>lol’d at the way you described r-s and at the same time provided potential evidence of him leeching.<br>
/win</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/14">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/14</link>
        <pubDate>Wed, 20 Jan 2010 05:27:53 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-14</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <p><a href="http://www.rune-shit.org/showthread.php?t=202992" class="onebox" target="_blank" rel="nofollow noopener">http://www.rune-shit.org/showthread.php?t=202992</a></p>
<p>This seems quite similiar to yours, though poorly explained.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/13">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/13</link>
        <pubDate>Tue, 19 Jan 2010 20:40:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-13</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="11" data-topic="325950">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/davidi2/40/2579_1.png" class="avatar"> Davidi2:</div>
<blockquote>
<p>Then why would it say player p when your param is actually client c?</p>
</blockquote>
</aside>
<p>Refactoring. I refactored the class, but forgot to tick the ‘rename comments’ tick box.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/12">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/12</link>
        <pubDate>Tue, 19 Jan 2010 20:34:57 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-12</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>Then why would it say player p when your param is actually client c?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/11">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/11</link>
        <pubDate>Tue, 19 Jan 2010 20:33:47 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-11</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:7, topic:325950”][quote author=relmitos link=topic=422360.msg3103179#msg3103179 date=1263864847]</p>
<pre><code class="lang-auto">* @param p The player that the packet created for.</code></pre>
<p>Where is the “Player p” param in “handlePacket()” ?<br>
[/quote]<br>
he didnt write it he ripped it out of rs2d or hyperion and called it his own, he means Client c[/quote]</p>
<p>No I didn’t, I wrote this myself.</p>
<p>I was originally using a Hashmap, but I was told that arrays were faster than Hashmaps, hence I wrote this for my server a couple months ago.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/10">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/10</link>
        <pubDate>Tue, 19 Jan 2010 20:32:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-10</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@davidi2 Davidi2]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/davidi2">@davidi2</a> wrote:</p>
          <blockquote>
              <p>[quote=“Miss Silabsoft, post:7, topic:325950”][quote author=relmitos link=topic=422360.msg3103179#msg3103179 date=1263864847]</p>
<pre><code class="lang-auto">* @param p The player that the packet created for.</code></pre>
<p>Where is the “Player p” param in “handlePacket()” ?<br>
[/quote]<br>
he didnt write it he ripped it out of rs2d or hyperion and called it his own, he means Client c[/quote]</p>
<p>Primadude, that’s a sad mistake <img src="https://forum.moparisthebest.com/images/emoji/twitter/frowning.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/9">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/9</link>
        <pubDate>Tue, 19 Jan 2010 20:25:23 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-9</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <p>He edited the post right after I mentioned it…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/8</link>
        <pubDate>Tue, 19 Jan 2010 20:22:21 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-8</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@silabsoft RuneAgent]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/silabsoft">@silabsoft</a> wrote:</p>
          <blockquote>
              <p>[quote=“relmitos, post:6, topic:325950”]<code>* @param p The player that the packet created for.</code><br>
Where is the “Player p” param in “handlePacket()” ?[/quote]<br>
he didnt write it he ripped it out of rs2d or hyperion and called it his own, he means Client c</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/7</link>
        <pubDate>Tue, 19 Jan 2010 19:30:28 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-7</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <pre><code class="lang-auto">* @param p The player that the packet created for.</code></pre>
<p>Where is the “Player p” param in “handlePacket()” ?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/6</link>
        <pubDate>Tue, 19 Jan 2010 01:34:07 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-6</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <aside class="quote no-group" data-post="4" data-topic="325950">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/relmitos/40/5_513041d5f7104045db30895d3b90af16.png" class="avatar"> relmitos:</div>
<blockquote>
<p>This is from a Bulby base right?</p>
</blockquote>
</aside>
<p>Nope. I made it for my 317 server a couple months ago.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/5</link>
        <pubDate>Tue, 19 Jan 2010 00:05:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-5</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <p>This is from a Bulby base right?</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/4</link>
        <pubDate>Mon, 18 Jan 2010 22:34:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-4</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@Yz85Racer Yz85Racer]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/yz85racer">@Yz85Racer</a> wrote:</p>
          <blockquote>
              <p>nice package names broh !!!</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/3</link>
        <pubDate>Sun, 17 Jan 2010 02:15:39 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-3</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@relmitos relmitos]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/relmitos">@relmitos</a> wrote:</p>
          <blockquote>
              <p>This is sexy stuff…</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/2</link>
        <pubDate>Sat, 16 Jan 2010 19:22:29 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-2</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
      <item>
        <title>Managing Packets with an Array</title>
        <dc:creator><![CDATA[@primadude Primadude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/primadude">@primadude</a> wrote:</p>
          <blockquote>
              <p>This tutorial will show you how to replace your current method of managing packets (Usually the ‘parseIncomingPackets()’ method which consists of a large switch-statement, in most Winterlove-based servers) with this better, faster and more efficient method (An array).</p>
<p>Firstly, let me explain the concept of an array.</p>
<p>Arrays are a way to store a list of items. Each slot of an array holds an individual element,<br>
and you can place elements into or change the contents of those slots as you need to. An array can contain any type of element value (primitive types or objects).</p>
<p><span class="bbcode-u"><span class="bbcode-b">Tutorial</span></span></p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 1: Creating the PacketManager class.</span></span></p>
<p>To start off the tutorial, we will need to create the class that will be managing the packets. You will need to change the packaging of the class and the imports in this tutorial accordingly to the packaging of your server.</p>
<p>[code]package <a href="http://rs2.iClarity.net" rel="nofollow noopener">rs2.iClarity.net</a>;</p>
<p>/**</p>
<ul>
<li>Manages Packets.</li>
<li>
<span class="mention">@author</span> Primadude.<br>
*/<br>
public class PacketManager {</li>
</ul>
<p>}[/code]</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 2: Creating the Interface for the packets.</span></span></p>
<p>We now need to create the interface from which each packet class will be branched (implemented) from.</p>
<p>[code]package net.iClarity.packets;</p>
<p>import net.iClarity.model.Client;</p>
<p>/**</p>
<ul>
<li>
<p>Interface for packets.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public interface PacketHandler {</p>
<pre><code> /**
  * Handles the packet.
  * @param c The player that the packet is created for.
  * @param packetType The type of the packet.
  * @param packetSize The size of the packet.
  */
 public void handlePacket(Client c, int packetType, int packetSize);
</code></pre>
</li>
</ul>
<p>}[/code]</p>
<p>Each packet class, implemented off this interface, will contain the ‘handlePacket’ method but will contain the packet content within the method.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 3: Creating the array, initializing it and assigning it a maximum amount of slots.</span></span></p>
<p>Our PacketManager is currently empty and will not do anything yet, so, we need to declare our array. The array’s type will be an Object of the PacketHandler class.</p>
<p><code>        /**
         * Array to store packet class data.
         */
        private static PacketHandler[] packetHandler;</code></p>
<p>This array does not have any maximum amount of slots set yet, so we need to replace it with:</p>
<p><code>        /**
         * Array to store packet class data.
         * Maximum packets: 256.
         */
        private static PacketHandler[] packetHandler = new PacketHandler[256];</code></p>
<p>The reason for the maximum amount of slots being 256, is because packets are sent in bytes and the maximum value for a byte is 2 ^ 8 (256). The ‘packetHandler’ array is static - this means it does not belong to this class and we will only need to load the packet data once.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 4: Declaring the method to load the packet data.</span></span></p>
<p>The array now exists, but it does not have any values assigned to it, so we need to declare the method to do so:</p>
<p>[code]	public void loadPackets() {</p>
<pre><code>}[/code]
</code></pre>
<p>We will leave this method for now.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 5: Declaring the packet executing/processing method.</span></span></p>
<p>We will now declare the method which will execute/process each packet:</p>
<p><code>        /**
         * Processes the packet.
         * @param c The player to process for.
         * @param packetType The type of the packet.
         * @param packetSize The size of the packet.
         */
	public static void executePacket(Client c, int packetType, int packetSize) {
		if (packetType == -1) {
			return;
		}
		if (packetHandler[packetType] != null) {
			try {
				packetHandler[packetType].handlePacket(c, packetType, packetSize);
			} catch(Exception exception) {
				Logger.log(Level.WARNING, "Error thrown whilst processing packets:");
                                exception.printStackTrace();
                        }
		} else {
                        /**
                         * Logs the packets that arent handled.
                         */
			Logger.info("Unhandled Packet: [ID = " + packetType + "; Size = "+ packetSize +"]");
		}
	}</code></p>
<p>For this method we will need to import the Client class, the Logger class and the Level class:</p>
<p>[code]import net.iClarity.model.Client;</p>
<p>import java.util.logging.Level;<br>
import java.util.logging.Logger;[/code]</p>
<p>This method that we have just declared calls the ‘handlePacket’ method from the class that is assigned to the specific slot of the type of the packet (If the slot has been assigned a value, if not, the packet data is logged). If an error is thrown whilst processing the packets, it will be caught by the try-catch statement, the error will be logged in the output, and the server will continue to run.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 6: Assigning data to the array and creating a packet class.</span></span></p>
<p>We now have to add an object of the class to the packet type slot. An example:</p>
<pre><code class="lang-auto">packetHandler[103] = new CommandPacket();</code></pre>
<p>This will assign the 103rd slot (Packet type 103) of the array the CommandPacket Object.</p>
<p>For this you will need to create and import the ‘packets’ package that you should place each packet class (And the PacketHandler interface) into.</p>
<pre><code class="lang-auto">import net.iClarity.packets.*;</code></pre>
<p>Your ‘loadPackets()’ method should now look like this:</p>
<p><code>        public void loadPackets() {
                packetHandler[103] = new CommandPacket();
        }</code></p>
<p>The CommandPacket class does not exist yet so we need to create it:</p>
<p>[code]package net.iClarity.packets;</p>
<p>import net.iClarity.model.Client;</p>
<p>/**</p>
<ul>
<li>
<p>The Commands packet.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public class CommandPacket implements PacketHandler {</p>
<pre><code> /**
  * Handles the Packet.
  * @param c The player that the packet created for.
  * @param packetType The type of the packet.
  * @param packetSize The size of the packet.
  */
</code></pre>
<p><a class="mention" href="/u/override">@Override</a><br>
public void handlePacket(Client c, int packetType, int packetSize) {<br>
String command = c.inStream.readString();<br>
}</p>
</li>
</ul>
<p>}[/code]</p>
<p>This class implements the ‘PacketHandler’ interface. Within the ‘handlePacket’ method is the ‘command’ String which has been assigned a value (The String read from the client). This value is the command that the player types.<br>
Within this method, and for every ‘handlePacket’ method in each packet class, you should add whatever you want to happen when this packet is sent from the client.</p>
<p><span class="bbcode-u"><span class="bbcode-b">Step 8: Calling the packets to be processed.</span></span></p>
<p>We will now replace the calling of the ‘parseIncomingPackets()’ method (Or equivalent method) with a calling of the ‘execute’ method within the PacketManager class.<br>
In your ‘client’ method, find the calling ‘parseIncomingPackets();’ and replace it with:</p>
<pre><code class="lang-auto">new PacketManager().executePacket(this, packetType, packetSize);</code></pre>
<p>You will also need to import the ‘PacketManager’ class from within your ‘client’ class (Or equivalent class):</p>
<pre><code class="lang-auto">import net.iClarity.net.PacketManager;</code></pre>
<p>You have now successfully replaced your current packet managing method with this one.</p>
<hr>
<p>Your ‘PacketManager’ class should now look something like this:</p>
<p>[code]package <a href="http://net.iClarity.net" rel="nofollow noopener">net.iClarity.net</a>;</p>
<p>import net.iClarity.model.Client;<br>
import net.iClarity.packets.*;</p>
<p>import java.util.logging.Level;<br>
import java.util.logging.Logger;</p>
<p>/**</p>
<ul>
<li>
<p>Manages Packets.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public class PacketManager {</p>
<pre><code> /**
  * Array to store packet class data.
  * Maximum packets: 256.
  */
 private static PacketHandler[] packetHandler = new PacketHandler[256];

 /**
  * Assigns the packet data to the packetHandler array.
  */
</code></pre>
<p>public void loadPackets() {<br>
packetHandler[103] = new CommandPacket();</p>
<p>}</p>
<pre><code> /**
  * Processes the packet.
  * @param c The player to process for.
  * @param packetType The type of the packet.
  * @param packetSize The size of the packet.
  */
</code></pre>
<p>public static void executePacket(Client c, int packetType, int packetSize) {<br>
if (packetType == -1) {<br>
return;<br>
}<br>
if (packetHandler[packetType] != null) {<br>
try {<br>
packetHandler[packetType].handlePacket(c, packetType, packetSize);<br>
} catch(Exception exception) {<br>
Logger.log(Level.WARNING, “Error thrown whilst processing packets:”);<br>
exception.printStackTrace();<br>
}<br>
} else {<br>
/**<br>
* Logs the packets that arent handled.<br>
*/<br>
Logger.info("Unhandled Packet: [ID = " + packetType + “; Size = “+ packetSize +”]”);<br>
}<br>
}</p>
</li>
</ul>
<p>}[/code]</p>
<p>Here is the template for a new Packet class:</p>
<p>[code]package net.iClarity.packets;</p>
<p>import net.iClarity.model.Client;</p>
<p>/**</p>
<ul>
<li>
<p>Description of packet.</p>
</li>
<li>
<p><span class="mention">@author</span> Primadude.<br>
*/<br>
public class PacketTemplate implements PacketHandler {</p>
<pre><code> /**
  * Handles the packet.
  * @param c The player that the packet created for.
  * @param packetType The type of the packet.
  * @param packetSize The size of the packet.
  */
</code></pre>
<p><a class="mention" href="/u/override">@Override</a><br>
public void handlePacket(Client c, int packetType, int packetSize) {</p>
<p>}</p>
</li>
</ul>
<p>}[/code]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950/1</link>
        <pubDate>Sat, 16 Jan 2010 18:59:48 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-325950-1</guid>
        <source url="https://forum.moparisthebest.com/t/managing-packets-with-an-array/325950.rss">Managing Packets with an Array</source>
      </item>
  </channel>
</rss>
