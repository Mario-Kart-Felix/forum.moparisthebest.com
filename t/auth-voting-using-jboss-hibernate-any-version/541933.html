<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/auth-voting-using-jboss-hibernate-any-version/541933 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 03:54:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Auth Voting using JBoss Hibernate [Any Version] - Runescape - moparisthebest.com</title>
    <meta name="description" content="This tutorial is to show you how to use JBoss Hibernate  and I&amp;#39;m going to be using &amp;#39;auth&amp;#39; voting as an example. The reason I&amp;#39;m basing this around authentication keys is because I&amp;#39;ve seen many people wanting that sort of &amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="541933.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Auth Voting using JBoss Hibernate [Any Version]&#39;" href="541933.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/auth-voting-using-jboss-hibernate-any-version/541933" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/auth-voting-using-jboss-hibernate-any-version/541933" />
<meta property="og:title" content="Auth Voting using JBoss Hibernate [Any Version]" />
<meta name="twitter:title" content="Auth Voting using JBoss Hibernate [Any Version]" />
<meta property="og:description" content="This tutorial is to show you how to use JBoss Hibernate  and I’m going to be using ‘auth’ voting as an example. The reason I’m basing this around authentication keys is because I’ve seen many people wanting that sort of system.  The idea was based around Stuarts work.  [hr]  [size=12pt]Server Sided[/size]  You are going to need to include the Hibernate Libraries which can be downloaded at http://hibernate.org/orm/downloads/ The version this tutorial is using was 4.3.5 Final because that was the ..." />
<meta name="twitter:description" content="This tutorial is to show you how to use JBoss Hibernate  and I’m going to be using ‘auth’ voting as an example. The reason I’m basing this around authentication keys is because I’ve seen many people wanting that sort of system.  The idea was based around Stuarts work.  [hr]  [size=12pt]Server Sided[/size]  You are going to need to include the Hibernate Libraries which can be downloaded at http://hibernate.org/orm/downloads/ The version this tutorial is using was 4.3.5 Final because that was the ..." />
<meta property="article:published_time" content="2014-04-06T16:03:24+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="541933.html">Auth Voting using JBoss Hibernate [Any Version]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Ashi.html'><span itemprop='name'>Ashi</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-06T16:03:24Z'>
            <time itemprop='dateModified' datetime='2016-08-04T12:57:57Z' class='post-time'>
              August 4, 2016, 12:57pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This tutorial is to show you how to use <a href="http://hibernate.org/" data-bbcode="true" rel="nofollow noopener">JBoss Hibernate </a> and I’m going to be using ‘auth’ voting as an example. The reason I’m basing this around authentication keys is because I’ve seen many people wanting that sort of system.</p>
<p>The idea was based around Stuarts work.</p>
<p>[hr]</p>
<p>[size=12pt]<span class="bbcode-u">Server Sided</span>[/size]<br>
You are going to need to include the <span class="bbcode-b">Hibernate Libraries</span> which can be downloaded at <a href="http://hibernate.org/orm/downloads/" rel="nofollow noopener">http://hibernate.org/orm/downloads/</a> The version this tutorial is using was <span class="bbcode-i">4.3.5 Final</span> because that was the current version at the time. You will also need the MySQL connector libraries.</p>
<p>Once you have downloaded that, you need to add them to your project. If you don’t know how to a quick Google search should help you.</p>
<p>As soon as that is all downloaded at setup to be used, you will need to add a few classes and files to your server to get the voting system working.</p>
<p>[HibernateUtil.java]</p>
<pre><code class="lang-auto">import org.hibernate.SessionFactory;
import org.hibernate.boot.registry.StandardServiceRegistryBuilder;
import org.hibernate.cfg.Configuration;
import org.hibernate.service.ServiceRegistry;

public final class HibernateUtil {
	private static SessionFactory sessionFactory = buildSessionFactory();
	private static ServiceRegistry serviceRegistry;

	private static SessionFactory buildSessionFactory() {
		Configuration configuration = new Configuration();
		configuration.configure();
		serviceRegistry = new StandardServiceRegistryBuilder().applySettings(configuration.getProperties()).build();
		sessionFactory = configuration.buildSessionFactory(serviceRegistry);
		return sessionFactory;
	}

	public static SessionFactory getSessionFactory() {
		return sessionFactory;
	}
}</code></pre>
<p>HibernateUtil is a helper class that works as a bridge to allow you to access the needed methods/features of hibernate for our vote system to work.</p>
<p>[Vote.java]</p>
<pre><code class="lang-auto">import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Entity
@Table(name = "vote")
public class Vote {
	private long id;
	
	@Column(name = "username", updatable = false)
	private String username;
	
	@Column(name = "auth", updatable = false)
	private String auth;
	
	@Column(name = "claimed")
	private int claimed = 0;
	
	@Id
	@Column(name = "id")
	public long getId() {
		return id;
	}
	
	public void setId(long id) {
		this.id = id;
	}
	
	public String getUsername() {
		return username;
	}
	
	public String setUsername(String username) {
		return this.username = username;
	}
	
	public String getAuth() {
		return auth;
	}
	
	public String setAuth(String auth) {
		return this.auth = auth;
	}
	
	public int getClaimed() {
		return claimed;
	}
	
	public int setClaimed(int claimed) {
		return this.claimed = claimed;
	}

	public void claim() {
		this.claimed = 1;
                //rewards etc., can go here.
	}
	
}</code></pre>
<p>The vote class is a <span class="bbcode-b">mapping</span> class that allows you to select the table that the vote will be using and the tables colums and fields that correspond to the data we have. A better way to explain this is if you look at:</p>
<pre><code class="lang-auto">@Column(name = "username", updatable = false)
private String username;</code></pre>
<p>What that does is sets the username variable to the username column which is in the mysql database.</p>
<p>[VoteHandler.java]</p>
<pre><code class="lang-auto">import java.util.Iterator;

import org.hibernate.Query;
import org.hibernate.Session;

import com.vote.util.HibernateUtil;

public class VoteHandler {
	private Player player;
	
	public VoteHandler(Player player) {
		this.player = player;
	}
	
	public void claimVote() {
		Session session = HibernateUtil.getSessionFactory().openSession();
		session.beginTransaction();

		try {
			Query query = session.createQuery("FROM Vote WHERE username=:name AND claimed=0");
			query.setParameter("name", player.getUsername());
			Iterator&lt;?&gt; votes = query.iterate();

			while(votes.hasNext()) {
				Vote vote = (Vote) votes.next();
				vote.claim();
				session.update(vote);
			}
		} finally {
			session.getTransaction().commit();
		}
	}
	
	public boolean checkVote(String auth) {
		Session session = HibernateUtil.getSessionFactory().openSession();
		session.beginTransaction();
		try {
			Query query = session.createQuery("FROM Vote WHERE username=:name AND auth=:auth AND claimed=0");
			query.setParameter("name", player.getUsername());
			query.setParameter("auth", auth);
			return query.iterate().hasNext();
		} finally {
			session.getTransaction().commit();
		}
	}
	
}</code></pre>
<p>VoteHandler is used to handle checking and claiming the vote. The checkVote(String auth) does the simple job of searching the database for the user and then checks if the auth entered matches the one in the database. The claimVote() method updates the database and calls the claim() method in Vote.java which is used to claim the vote.</p>
<p>Back to Vote.java - The claim() method sets int claimed to 1, which will also update in the database so when session.update(vote) in the claimVote() method is called it will update the values.</p>
<p>All you have left to do is create a command or process that will take the users input and execute the methods.<br>
An example of how a command may look like in your server may be:</p>
<pre><code class="lang-auto">if (args[0].contains("auth") {
    String auth = args[1].toLowerCase(); //the auth in the database shouldn't have any uppercase letters
    if (player.getVoteHandler().checkVote(auth)) {
       player.getVoteHandler().claimVote();
    } else {
        player.sendMessage("There was an error with claiming your vote. Please check your auth and try again.");
    }
}</code></pre>
<p>Now you just need to initlize the VoteHandler which can be done by adding the following in your Player class.</p>
<pre><code class="lang-auto">VoteHandler handler = new VoteHandler(this);</code></pre>
<p>The last thing you need to do is add <span class="bbcode-b">hibernate.cfg.xml</span> (maybe in the bin directory) - It is for Hibernate to locate the mapping files, find out the database information (name, host etc), and other techy things that you don’t need to worry about.</p>
<p>Just modify the file according to your preferences.</p>
<pre><code class="lang-auto">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
		"-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

&lt;hibernate-configuration&gt;

	&lt;session-factory&gt;
		&lt;!-- Database connection settings --&gt;
		&lt;property name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
		&lt;property name="connection.url"&gt;jdbc:mysql://localhost/hibernate&lt;/property&gt;

		&lt;property name="connection.username"&gt;root&lt;/property&gt;
		&lt;property name="connection.password"&gt;&lt;/property&gt;

		&lt;!-- JDBC connection pool (use the built-in) --&gt;
		&lt;!-- &lt;property name="connection.pool_size"&gt;1&lt;/property&gt; --&gt;

		&lt;!-- SQL dialect --&gt;
		&lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;

		&lt;!-- Enable Hibernate's automatic session context management --&gt;
		&lt;property name="current_session_context_class"&gt;thread&lt;/property&gt;

		&lt;!-- Disable the second-level cache --&gt;
		&lt;property name="cache.provider_class"&gt;org.hibernate.cache.NoCacheProvider&lt;/property&gt;

		&lt;!-- Echo all executed SQL to stdout --&gt;
		&lt;property name="show_sql"&gt;false&lt;/property&gt;

		&lt;!-- Drop and re-create the database schema on startup --&gt;
		&lt;property name="hbm2ddl.auto"&gt;update&lt;/property&gt;

		&lt;!-- Path to Mapping files --&gt;
		&lt;mapping class="com.vote.Vote" /&gt;

	&lt;/session-factory&gt;

&lt;/hibernate-configuration&gt;</code></pre>
<p>That’s all for the server sided stuff!</p>
<p>[hr]</p>
<p>[size=12pt]Website[/size]</p>
<p>[vote.php]</p>
<pre><code class="lang-auto">&lt;?php
	$conn = mysql_connect("localhost", "user", "password") or die (mysql_error());
	mysql_select_db("database", $conn);
	
	function grabIP() {
		foreach (array('HTTP_CLIENT_IP', 'HTTP_X_FORWARDED_FOR', 'HTTP_X_FORWARDED', 'HTTP_X_CLUSTER_CLIENT_IP', 'HTTP_FORWARDED_FOR', 'HTTP_FORWARDED', 'REMOTE_ADDR') as $key){
			if (array_key_exists($key, $_SERVER) === true) {
				foreach (explode(',', $_SERVER[$key]) as $ip){
					$ip = trim($ip);
					if (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE) !== false) {
						return $ip;
					}
				}
			}
		}
	}
	
	function generateAuth() {
		return substr(sha1(mt_rand()), 0, 5);
	}
	
	if(isset($_POST['username'])) {
		$username = $_POST["username"];
		$auth = generateAuth();
		$ip = grabIP();
		mysql_query("INSERT INTO vote (username, auth, ip) VALUES ('$username', '$auth', '$ip')", $conn);
		
		session_start();
		$_SESSION['username'] = $username;
		$_SESSION['auth'] = $auth;
		
		header("Location: success.php");
	}

?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
	&lt;head&gt;
		&lt;meta charset="utf-8"&gt;
		&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
		&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
		&lt;title&gt;Auth Voting&lt;/title&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;form method="post"&gt;
			&lt;input type="text" name="username" id="username" /&gt;
			&lt;input type="submit" value="Enter" name="submit" id="submit" /&gt;
		&lt;/form&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>[success.php]</p>
<pre><code class="lang-auto">&lt;?php
	session_start();
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
	&lt;head&gt;
		&lt;meta charset="utf-8"&gt;
		&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
		&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
		&lt;title&gt;Auth Voting&lt;/title&gt;
	&lt;/head&gt;
	&lt;body&gt;
		Thank you for voting! 
		&lt;br&gt;
		&lt;?php 
			echo $_SESSION['username'] . " your auth is " . $_SESSION['auth'];
		?&gt;
		&lt;br&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>Some may argue that the code here is not brilliant, this is because of my minimal knowledge of PHP. Feel free to change it to what best suits you.</p>
<p>You’re going to need to create a database.<br>
The query you are going to need is:</p>
<pre><code class="lang-auto">CREATE TABLE IF NOT EXISTS `vote` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` text NOT NULL,
  `auth` text NOT NULL,
  `ip` text NOT NULL,
  `claimed` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;</code></pre>
<p>And that’s it!</p>
<p>[hr]</p>
<p>Note: The website sided code is just a skeleton so that you can implement it into an existing vote system. If you are looking for callbacks etc., there are other systems out there and implementing my system will not be hard assuming you know what you are doing.</p>
<p>If you have any questions, just ask.<br>
Enjoy.</p>
      </div>

      <meta itemprop='headline' content='Auth Voting using JBoss Hibernate [Any Version]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Clawz_fury.html'><span itemprop='name'>Clawz_fury</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2014-04-12T19:33:01Z'>
            <time itemprop='dateModified' datetime='2016-08-04T12:59:19Z' class='post-time'>
              August 4, 2016, 12:59pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>change the title to “VOTE4CASH [PI] [EASY SETUP]” if you want comments</p>
      </div>

      <meta itemprop='headline' content='Auth Voting using JBoss Hibernate [Any Version]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/auth-voting-using-jboss-hibernate-any-version/541933 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Aug 2019 03:54:38 GMT -->
</html>
