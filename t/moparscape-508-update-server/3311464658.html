<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/moparscape-508-update-server/331146?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>MoparScape 508 Update Server - Community Inside Talk - moparisthebest.com</title>
    <meta name="description" content="Here are all of the sources I am releasing for MoparScape 4, so far: http://cache.hybridscape.com/MoparScapeSources.jar 

As you can see, there is a 508 Update server that serves up the cache, which works well, except ab&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="3311464658.html?page=2" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;MoparScape 508 Update Server&#39;" href="331146.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/moparscape-508-update-server/331146?page=2" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/moparscape-508-update-server/331146?page=2" />
<meta property="og:title" content="MoparScape 508 Update Server" />
<meta name="twitter:title" content="MoparScape 508 Update Server" />
<meta property="og:description" content="ok i just took a look at a 508 client it appears to request as many as the list has. but will only download up to 100 files at a time So slightly different from fun orb chess. Now this is not 100 seperate files remember it only accepts something like 512 bytes with one pass." />
<meta name="twitter:description" content="ok i just took a look at a 508 client it appears to request as many as the list has. but will only download up to 100 files at a time So slightly different from fun orb chess. Now this is not 100 seperate files remember it only accepts something like 512 bytes with one pass." />
<meta property="article:published_time" content="2010-03-01T03:54:04+00:00" />
<meta property="og:ignore_canonical" content="true" />

      <link rel="prev" href="331146.html">


    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="331146.html">MoparScape 508 Update Server</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/community-inside-talk.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Community Inside Talk</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T03:54:04Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:01:44Z' class='post-time'>
              July 31, 2016,  3:01pm
            </time>
        <span itemprop='position'>#21</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>ok i just took a look at a 508 client it appears to request as many as the list has. but will only download up to 100 files at a time So slightly different from fun orb chess. Now this is not 100 seperate files remember it only accepts something like 512 bytes with one pass.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T04:07:26Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:01:44Z' class='post-time'>
              July 31, 2016,  3:01pm
            </time>
        <span itemprop='position'>#22</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I’ll just set up a queue and I can set the max amount for the queue later.  It is supposed to be sent a byte value of 255 every 512 bytes I send, correct?  This is already handled in the dumping of the files.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T04:08:38Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:01:44Z' class='post-time'>
              July 31, 2016,  3:01pm
            </time>
        <span itemprop='position'>#23</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>yes it is. the byte is discarded.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T05:19:35Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:01:47Z' class='post-time'>
              July 31, 2016,  3:01pm
            </time>
        <span itemprop='position'>#24</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Alright, rewrote v508.OndemandServer to handle multiple requests at once:</p>
<pre><code class="lang-auto">package org.moparscape.userver.v508;

import org.moparscape.userver.Server;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.Socket;
import java.net.URLConnection;

/**
 * Class:OndemandServer
 * User: Silabsoft
 * Date: Jul 6, 2009
 * Time: 2:22:11 PM
 */
public class OndemandServer extends Server {

    public static final String odsPath = "508/%d/%d";
    public static final int clientVersion = 508;
    public static final int concurrentRequests = 10;

    public String[] requests = new String[concurrentRequests];
    public byte[] buffer = new byte[1024];
    public int len;

    public OndemandServer(String defaultLocation) {
        this(defaultLocation, 0);
    }

    public OndemandServer(String defaultLocation, int port) {
        super(defaultLocation, port);
    }

    public OndemandServer(String defaultLocation, String customLocation) {
        this(defaultLocation, 0, customLocation);
    }

    public OndemandServer(String defaultLocation, int port, String customLocation) {
        super(defaultLocation, port, customLocation);
    }

    public void handleConnection(Socket s) throws IOException {
        //System.out.println("ods: new connection to update server");

        boolean identify = false;
        DataOutputStream out = new DataOutputStream(s.getOutputStream());
        DataInputStream in = new DataInputStream(s.getInputStream());
        //s.setSoTimeout(0);
        if (in == null)
            return;
        while (!s.isClosed()) {
            //System.out.println("in loop");
            byte dataType = 0;
            int version = 0;
            if (!identify) {
                //s.setSoTimeout(100);
                //System.out.println("HERE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
                dataType = in.readByte();
                //System.out.println("ANDNOW!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
                //s.setSoTimeout(0);
                version = in.readInt();
                //System.out.println("dataType:" + dataType + " version:" + version);
            }
            if (dataType == 15 &amp;&amp; version == clientVersion) {
                //System.out.println("new client connected to update server");
                out.writeByte(0);
                identify = true;
                in.skip(4);
            } else {
                int type = in.read();
                //System.out.println("type:" + type);
                //               if (type != 0 &amp;&amp; type != 1 &amp;&amp; type != 3)
                //                   System.exit(-433);
                //int hash = ((in.get()&amp; 0xff) &lt;&lt; 16) + ((in.get()&amp; 0xff) &lt;&lt; 8) + (in.get()&amp; 0xff);
                if (type == 0 || type == 1) {
                    //int index = in.read() &amp; 0xff;
                    //int id = in.readShort();
                    int uid = (in.readUnsignedByte() &lt;&lt; 16) + (in.readUnsignedByte() &lt;&lt; 8) + in.readUnsignedByte();
                    int index = uid &gt;&gt; 16;
                    int id = uid &amp; 0xFFFF;

                    if (index == 255 &amp;&amp; id == 255) {
                        // serve update keys
                        URLConnection url = getHttpURLConnection(String.format(odsPath, index, id));

                        // if url is null, custom and default cannot be reached, continue
                        if (url == null) {
                            // unless we want the update keys and may not be connected to the internet
                            // so we server them up if it is that which we are requesting
                            System.out.println("UpdateServer: Update Keys do not exist on server, serving generic ones.");
                            int[] UPDATE_KEYS = {
                                    0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0xd8,
                                    0x84, 0xa1, 0xa1, 0x2b, 0x00, 0x00, 0x00, 0xba,
                                    0x58, 0x64, 0xe8, 0x14, 0x00, 0x00, 0x00, 0x7b,
                                    0xcc, 0xa0, 0x7e, 0x23, 0x00, 0x00, 0x00, 0x48,
                                    0x20, 0x0e, 0xe3, 0x6e, 0x00, 0x00, 0x01, 0x88,
                                    0xec, 0x0d, 0x58, 0xed, 0x00, 0x00, 0x00, 0x71,
                                    0xb9, 0x4c, 0xc0, 0x50, 0x00, 0x00, 0x01, 0x8b,
                                    0x5b, 0x61, 0x79, 0x20, 0x00, 0x00, 0x00, 0x0c,
                                    0x0c, 0x69, 0xb1, 0xc8, 0x00, 0x00, 0x02, 0x31,
                                    0xc8, 0x56, 0x67, 0x52, 0x00, 0x00, 0x00, 0x69,
                                    0x78, 0x17, 0x7b, 0xe2, 0x00, 0x00, 0x00, 0xc3,
                                    0x29, 0x76, 0x27, 0x6a, 0x00, 0x00, 0x00, 0x05,
                                    0x44, 0xe7, 0x75, 0xcb, 0x00, 0x00, 0x00, 0x08,
                                    0x7d, 0x21, 0x80, 0xd5, 0x00, 0x00, 0x01, 0x58,
                                    0xeb, 0x7d, 0x49, 0x8e, 0x00, 0x00, 0x00, 0x0c,
                                    0xf4, 0xdf, 0xd6, 0x4d, 0x00, 0x00, 0x00, 0x18,
                                    0xec, 0x33, 0x31, 0x7e, 0x00, 0x00, 0x00, 0x01,
                                    0xf7, 0x7a, 0x09, 0xe3, 0x00, 0x00, 0x00, 0xd7,
                                    0xe6, 0xa7, 0xa5, 0x18, 0x00, 0x00, 0x00, 0x45,
                                    0xb5, 0x0a, 0xe0, 0x64, 0x00, 0x00, 0x00, 0x75,
                                    0xba, 0xf2, 0xa2, 0xb9, 0x00, 0x00, 0x00, 0x5f,
                                    0x31, 0xff, 0xfd, 0x16, 0x00, 0x00, 0x01, 0x48,
                                    0x03, 0xf5, 0x55, 0xab, 0x00, 0x00, 0x00, 0x1e,
                                    0x85, 0x03, 0x5e, 0xa7, 0x00, 0x00, 0x00, 0x23,
                                    0x4e, 0x81, 0xae, 0x7d, 0x00, 0x00, 0x00, 0x18,
                                    0x67, 0x07, 0x33, 0xe3, 0x00, 0x00, 0x00, 0x14,
                                    0xab, 0x81, 0x05, 0xac, 0x00, 0x00, 0x00, 0x03,
                                    0x24, 0x75, 0x85, 0x14, 0x00, 0x00, 0x00, 0x36
                            };
                            for (int i : UPDATE_KEYS)
                                out.writeByte(i);
                            out.flush();
                            continue;
                        }
                        InputStream data1 = url.getInputStream();

                        // buffer and len are static
                        while ((len = data1.read(buffer)) &gt;= 0)
                            out.write(buffer, 0, len);
                        out.flush();
                        data1.close();

                        // served update keys, so get next request
                        continue;
                    }

                    this.requests[0] = String.format(odsPath, index, id);
                    //System.out.println("request0: " + this.requests[0]);
                    // queue the requests
                    for (int x = 1; x &lt; concurrentRequests; ++x) {
                        //index = in.read() &amp; 0xff;
                        //id = in.readShort();
                        uid = (in.readUnsignedByte() &lt;&lt; 16) + (in.readUnsignedByte() &lt;&lt; 8) + in.readUnsignedByte();
                        index = uid &gt;&gt; 16;
                        id = uid &amp; 0xFFFF;
                        this.requests[x] = String.format(odsPath, index, id);
                        //System.out.println("request" + x + ": " + this.requests[x]);
                    }

                    // serve the requests
                    for (String request : requests) {
                        //System.out.println("request: " + request);
                        URLConnection url = getHttpURLConnection(request);
                        // if url is null, custom and default cannot be reached, continue
                        if (url == null)
                            continue;

                        //int size = url.getContentLength();
                        // if size == -1 it doesn't exist
                        // however this cannot be counted on as a 404 will still send html
                        //System.out.println("size: " + size);
                        InputStream data1 = url.getInputStream();

                        // buffer and len are static
                        while ((len = data1.read(buffer)) &gt;= 0)
                            out.write(buffer, 0, len);
                        data1.close();
                    }
                    out.flush();
                }

            }
        }
    }
}
</code></pre>
<p>Which works well, but now the problem seems to have changed.  The client is now requesting files that aren’t available, and can’t be dumped from the cache that I have (which I believed to be a complete cache).  This is causing the same server exception because the client disconnects when the server tries to skip a file (because it doesn’t have access to it).  This slows everything down quite a bit.  Any ideas for dumping the cache?  Did I do it correctly or is there a better way to do it?  (look in the org.cachedump package)</p>
<p>edit: here are some examples of what it is requesting: <a href="http://pastebin.com/m5VDr7vL">http://pastebin.com/m5VDr7vL</a></p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/system.html'><span itemprop='name'>system</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T19:11:00Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:02:14Z' class='post-time'>
              July 31, 2016,  3:02pm
            </time>
        <span itemprop='position'>#25</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>i wish i could help you, but i don’t know anything about the update protocol/etc.</p>
<p>however, imo you should be using asynchronous io (following the reactor design pattern) with the java.nio.channels package for a better performing server with less manual thread logic. if you need help implementing that, let me know and i can make you an example and/or tell you how it works.</p>
<p>(edit)<br>
as for the invalid requests, are you sure that you’re parsing them properly? maybe it is making valid requests, you just aren’t reading the information correctly. i have no idea whether this is the case, but it certainly is a possibility.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T22:36:21Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:02:26Z' class='post-time'>
              July 31, 2016,  3:02pm
            </time>
        <span itemprop='position'>#26</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Moparisthebest, post:6, topic:331146”][quote author=Metho D link=topic=427511.msg3139998#msg3139998 date=1267403524]<br>
it looks like the client is sending a byte for the priority/‘type’ (one or zero, which you read correctly), and then three bytes, which you read as a short. perhaps that’s causing the problem.<br>
[/quote]<br>
Do you know how those 3 bytes are supposed to be read/interpreted?</p>
<p>Also, does anyone know if there is a way to find out for which index/id that data exists for without bruteforcing it or logging what the client requests?  I apparently haven’t dumped the ENTIRE cache because I thought that the id could only go up to MAX_SHORT, when apparently it can go up to MAX_INT.  (which is taking hours upon hours)[/quote]</p>
<p>how about you just load from cache on the fly??</p>
<p>btw</p>
<p><code>
int uid = (in.readUnsignedByte() &lt;&lt; 16) + (in.readUnsignedByte() &lt;&lt; 8) + in.readUnsignedByte();
int index = uid &gt;&gt; 16;
int id = uid &amp; 0xFFFF;</code><br>
i reallllllllly don’t like the name uid seeing as it’s just a hash.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-01T23:11:22Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:02:27Z' class='post-time'>
              July 31, 2016,  3:02pm
            </time>
        <span itemprop='position'>#27</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“blakeman8192, post:25, topic:331146”]i wish i could help you, but i don’t know anything about the update protocol/etc.</p>
<p>however, imo you should be using asynchronous io (following the reactor design pattern) with the java.nio.channels package for a better performing server with less manual thread logic. if you need help implementing that, let me know and i can make you an example and/or tell you how it works.</p>
<p>(edit)<br>
as for the invalid requests, are you sure that you’re parsing them properly? maybe it is making valid requests, you just aren’t reading the information correctly. i have no idea whether this is the case, but it certainly is a possibility.[/quote]</p>
<p>asynchronous io is overkill for a server handling 1 connection isn’t it?  That is the purpose of this server and why I didn’t want to do it that way.</p>
<p>I am parsing them correctly (notice MethoD revised this a few posts ago) since when I serve the files it accepts them, the problem is it requesting files that don’t exist.  After I revised the 508 server to serve multiple requests at the same time is the only time it started requesting files that don’t exist, silabsoft suspects it is because something was served slightly wrong so she is looking into it.  I’m completely out of ideas.</p>
<p>[quote=“oksuper_, post:26, topic:331146”][quote author=Moparisthebest link=topic=427511.msg3140032#msg3140032 date=1267406040]</p>
<aside class="quote no-group">
<blockquote>
<p>it looks like the client is sending a byte for the priority/‘type’ (one or zero, which you read correctly), and then three bytes, which you read as a short. perhaps that’s causing the problem.</p>
</blockquote>
</aside>
<p>Do you know how those 3 bytes are supposed to be read/interpreted?</p>
<p>Also, does anyone know if there is a way to find out for which index/id that data exists for without bruteforcing it or logging what the client requests?  I apparently haven’t dumped the ENTIRE cache because I thought that the id could only go up to MAX_SHORT, when apparently it can go up to MAX_INT.  (which is taking hours upon hours)<br>
[/quote]</p>
<p>how about you just load from cache on the fly??</p>
<p>btw</p>
<p><code>
int uid = (in.readUnsignedByte() &lt;&lt; 16) + (in.readUnsignedByte() &lt;&lt; 8) + in.readUnsignedByte();
int index = uid &gt;&gt; 16;
int id = uid &amp; 0xFFFF;</code><br>
i reallllllllly don’t like the name uid seeing as it’s just a hash.[/quote]</p>
<p>This update server is running on the client computer, which doesn’t have a cache.  It pulls the cache from a web server, so that’s not an option.</p>
<p>As to the name, a hash is a universal id is it not?  In other words something unique that doesn’t collide with anything else.  Both names seem valid.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Protosstribe.html'><span itemprop='name'>Protosstribe</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-02T07:52:26Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:02:46Z' class='post-time'>
              July 31, 2016,  3:02pm
            </time>
        <span itemprop='position'>#28</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p><a class="mention" href="../../u/moparisthebest.html">@Moparisthebest</a>: I don’t think a hash value is considered to be a unique id, as you cannot guarantee that two distinct representations (of something) would create two distinct hash values. But I guess that would be the ultimate option. Hash values would normally be used to speed up the process of obtaining an object from some table, and sometimes the table could store many objects at the same index (not referring to anything within Java here - just in general).</p>
<p>If you take a look at the java.lang.Object class, it states the following in the Javadocs: “It is not required that if two objects are unequal according to the equals(java.lang.Object) method, then calling the hashCode method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hashtables.”.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-02T10:14:54Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:02:47Z' class='post-time'>
              July 31, 2016,  3:02pm
            </time>
        <span itemprop='position'>#29</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I didn’t want this to be derailed into a ‘hash vs uid’ topic.  But in this implementation, the hash/uid is distinct, there are no collisions.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Jython.html'><span itemprop='name'>Jython</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-02T22:44:45Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:03:09Z' class='post-time'>
              July 31, 2016,  3:03pm
            </time>
        <span itemprop='position'>#30</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>technically a hash is usually a unique id but uid is just a shitty name that passed over from pd’s naming schema (not that it was bad back then… it just grew inadequate :-p trying not to sound ungrateful).</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-18T16:31:12Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:21:41Z' class='post-time'>
              July 31, 2016,  3:21pm
            </time>
        <span itemprop='position'>#31</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>So this problem is still happening handling a single request at a time, and if I try to handle more than one requests at a time, something gets messed up and the client starts requesting pieces that don’t exist.  Any ideas?  Because I’m out of them… <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"></p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/system.html'><span itemprop='name'>system</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-18T16:35:10Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:21:41Z' class='post-time'>
              July 31, 2016,  3:21pm
            </time>
        <span itemprop='position'>#32</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Moparisthebest, post:31, topic:331146”]So this problem is still happening handling a single request at a time, and if I try to handle more than one requests at a time, something gets messed up and the client starts requesting pieces that don’t exist.  Any ideas?  Because I’m out of them… :([/quote]If the requests are being handled concurrently, maybe it’s not letting you open the second file input stream because there’s already another one open on it. Also, are you sure that you’re closing the input streams when you’re done? I’ve had some problems with stuff like that before.</p>
<p>EDIT: try handling requests concurrently via java.util.concurrent.ExecutorService or java.util.concurrent.ThreadPoolExecutor. There are great factory methods in java.util.concurrent.Executors. I think you’re overcomplicating things by having one thread handle multiple requests at the same time. Just have multiple threads handling one request each, or go with a cached thread pool (Executors.newCachedThreadPool()) which scales and reuses, creates, and destroys threads for best performance.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-18T16:36:07Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:21:41Z' class='post-time'>
              July 31, 2016,  3:21pm
            </time>
        <span itemprop='position'>#33</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I have to assume that a peice is messed up as you are serving the files correctly. How to fix this I have no idea.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/moparisthebest.html'><span itemprop='name'>moparisthebest</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-18T16:48:42Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:21:42Z' class='post-time'>
              July 31, 2016,  3:21pm
            </time>
        <span itemprop='position'>#34</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“blakeman8192, post:32, topic:331146”][quote author=Moparisthebest link=topic=427511.msg3154698#msg3154698 date=1268929872]<br>
So this problem is still happening handling a single request at a time, and if I try to handle more than one requests at a time, something gets messed up and the client starts requesting pieces that don’t exist.  Any ideas?  Because I’m out of them… <img src="../../images/emoji/twitter/frowningae52.png?v=5" title=":frowning:" class="emoji" alt=":frowning:"><br>
[/quote]If the requests are being handled concurrently, maybe it’s not letting you open the second file input stream because there’s already another one open on it. Also, are you sure that you’re closing the input streams when you’re done? I’ve had some problems with stuff like that before.</p>
<p>EDIT: try handling requests concurrently via java.util.concurrent.ExecutorService or java.util.concurrent.ThreadPoolExecutor. There are great factory methods in java.util.concurrent.Executors. I think you’re overcomplicating things by having one thread handle multiple requests at the same time. Just have multiple threads handling one request each, or go with a cached thread pool (Executors.newCachedThreadPool()) which scales and reuses, creates, and destroys threads for best performance.[/quote]</p>
<p>I tried making multiple threads to handle each request at the same time (look further up in the thread).  But that is the wrong way to do it, (as Silabsoft said), they send multiple requests at the same time, and then you can send the responses back in the same order before reading more requests.  (look at the current 317 update server, I use this exact same method and it works perfectly)</p>
<aside class="quote no-group" data-post="33" data-topic="331146">
<div class="title">
<div class="quote-controls"></div>
 Miss Silabsoft:</div>
<blockquote>
<p>I have to assume that a peice is messed up as you are serving the files correctly. How to fix this I have no idea.</p>
</blockquote>
</aside>
<p>You were looking at / rewriting how I dump the cache.  Does it look wrong in any way?</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-03-18T17:53:34Z'>
            <time itemprop='dateModified' datetime='2016-07-31T15:21:47Z' class='post-time'>
              July 31, 2016,  3:21pm
            </time>
        <span itemprop='position'>#35</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>no it does not.</p>
      </div>

      <meta itemprop='headline' content='MoparScape 508 Update Server'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>

  <div role='navigation' itemscope itemtype='http://schema.org/SiteNavigationElement' class="topic-body crawler-post">
      <span itemprop='name'><a rel="prev" itemprop="url" href="331146.html">← previous page</a></span>
  </div>





    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/moparscape-508-update-server/331146?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:12 GMT -->
</html>
