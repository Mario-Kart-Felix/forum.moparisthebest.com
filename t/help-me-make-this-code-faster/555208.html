<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/help-me-make-this-code-faster/555208 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>Help me make this code faster! - General Programming - moparisthebest.com</title>
    <meta name="description" content="Hi, I have a Java assignment. The code I currently have is too slow and I need to implement a faster solution.  

The code: [code=java] if (readqueue_size &amp;gt; 0) { 

        int lastReadTrack = DiskSim.block_to_track(blk);&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="555208.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Help me make this code faster!&#39;" href="555208.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/help-me-make-this-code-faster/555208" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/help-me-make-this-code-faster/555208" />
<meta property="og:title" content="Help me make this code faster!" />
<meta name="twitter:title" content="Help me make this code faster!" />
<meta property="og:description" content="Hi, I have a Java assignment. The code I currently have is too slow and I need to implement a faster solution.  The code:  [code=java] if (readqueue_size &gt; 0) {          int lastReadTrack = DiskSim.block_to_track(blk);          /*          * The distance is set to max_value for the first iteration to          * complete, to ensure the first blk is not the closest          */         int distance = Integer.MAX_VALUE;         int closestDistance = 0;          for (int i = readqueue_tail; i &lt; readq..." />
<meta name="twitter:description" content="Hi, I have a Java assignment. The code I currently have is too slow and I need to implement a faster solution.  The code:  [code=java] if (readqueue_size &gt; 0) {          int lastReadTrack = DiskSim.block_to_track(blk);          /*          * The distance is set to max_value for the first iteration to          * complete, to ensure the first blk is not the closest          */         int distance = Integer.MAX_VALUE;         int closestDistance = 0;          for (int i = readqueue_tail; i &lt; readq..." />
<meta property="article:published_time" content="2016-04-16T17:11:05+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="555208.html">Help me make this code faster!</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/general-programming.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>General Programming</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/my-swagger.html'><span itemprop='name'>my-swagger</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T17:11:05Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:04Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hi, I have a Java assignment. The code I currently have is too slow and I need to implement a faster solution.</p>
<p>The code:</p>
<p>[code=java] if (readqueue_size &gt; 0) {</p>
<pre><code>        int lastReadTrack = DiskSim.block_to_track(blk);

        /*
         * The distance is set to max_value for the first iteration to
         * complete, to ensure the first blk is not the closest
         */
        int distance = Integer.MAX_VALUE;
        int closestDistance = 0;

        for (int i = readqueue_tail; i &lt; readqueue_head; i++) {
            int val = lastReadTrack - DiskSim.block_to_track(readqueue[i].blk);
            closestDistance = (val &lt; 0) ? -val : val;

            while (distance &gt; closestDistance) {
                distance = closestDistance;

                int prevTailBlock = readqueue[readqueue_tail].blk;
                BRequest prevTailReq = readqueue[readqueue_tail].req;

                readqueue[readqueue_tail].blk = readqueue[i].blk;
                readqueue[readqueue_tail].req = readqueue[i].req;

                readqueue[i].blk = prevTailBlock;
                readqueue[i].req = prevTailReq;
            }
        }[/code]
</code></pre>
<p>I need to rewrite it, so it’s faster. Anybody know what I could do?</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Pwnd.html'><span itemprop='name'>Pwnd</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T17:26:56Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:04Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>closestDistance = (val &lt; 0) ? -val : val;</p>
<p>Math.abs?</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/my-swagger.html'><span itemprop='name'>my-swagger</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T17:39:08Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:04Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>[quote=“Pwnd, post:2, topic:555208”]closestDistance = (val &lt; 0) ? -val : val;</p>
<p>Math.abs?[/quote]</p>
<p>I’m not allowed to use any Java classes or foreach loops. Forgot to mention that, sorry.<br>
Integer.MAX_VALUE, I can’t even use that. That will be changed soon.</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/justaguy.html'><span itemprop='name'>justaguy</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T19:47:31Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:04Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This is why Java isn’t used for things like (what I assume to be a simulation of) native disk IO – it’s just too slow. We can start with some obvious optimizations though.</p>
<p>Branching is slow and bit manipulation is fast, so let’s do that for abs (see <a href="http://stackoverflow.com/a/12041874/3229983" data-bbcode="true" rel="nofollow noopener">here</a> how it works):</p>
<pre><code class="lang-auto"></code></pre>
<p>It could probably be simplified further but the point is to remove the branching.</p>
<p>Why are you using a while loop? You check to see if <code>distance</code> is strictly greater than <code>closestDistance</code>, if it is, you assign the former to the latter, then the loop’s condition will always be false since distance == closestDistance and they will remain constant in the loop body.</p>
<p>You should cache your reads from <code>readqueue[...]</code>.</p>
<p>[hr]</p>
<p>The best optimizations will be from refactoring the algorithm itself, not from those small optimizations, which is hard to do with such a small and incomplete code sample. Are you sure this is where the bottleneck is? What about <code>DiskSim.block_to_track</code>? Objects in Java are not just structs with some pointers; there’s lots involved in calling methods. Might be worth using a tool to find some hot spots.</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>

          <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
          </div>

  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/my-swagger.html'><span itemprop='name'>my-swagger</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-16T20:50:39Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:04Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#5</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Yeah, you’re right. It is a sim of naive disk IO and the assignment is for disk scheduling. Java and erlang are the only programming languages that we learn in the core modules however we have special classes for C, C++, etc. Classes such as DiskSim and all the arrays available are provided. I’d give you the whole source code but it would be pointless (imo).</p>
<p>Here’s the complete method:</p>
<pre><code class="lang-auto">public void readcomplete(int blk, BRequest req) {
        if (blk &gt;= 0) {
            /* give the block read back to the high-level system */
            DiskSim.highlevel_didread(blk, req);
        }

        if (readqueue_size &gt; 0) {

            int lastReadTrack = DiskSim.block_to_track(blk);

            /*
             * The distance is set to max_value for the first iteration to
             * complete, to ensure the first blk is not the closest
             */
            int distance = Integer.MAX_VALUE;
            int closestDistance = 0;

            for (int i = readqueue_tail; i &lt; readqueue_head; i++) {
                int val = lastReadTrack - DiskSim.block_to_track(readqueue[i].blk);
                closestDistance = (val &lt; 0) ? -val : val;

                while (distance &gt; closestDistance) {
                    distance = closestDistance;

                    int prevTailBlock = readqueue[readqueue_tail].blk;
                    BRequest prevTailReq = readqueue[readqueue_tail].req;

                    readqueue[readqueue_tail].blk = readqueue[i].blk;
                    readqueue[readqueue_tail].req = readqueue[i].req;

                    readqueue[i].blk = prevTailBlock;
                    readqueue[i].req = prevTailReq;
                }
            }

            /*
             * still got requests to service, dispatch the next block request
             * (at tail)
             */
            DiskSim.disk_readblock(readqueue[readqueue_tail].blk, readqueue[readqueue_tail].req);

            /* increment tail pointer, modulo buffer size */
            readqueue_tail = (readqueue_tail + 1) % DiskSim.MAXREQUESTS;
            readqueue_size--;
        }
    }</code></pre>
<p>The code I posted on thread was what I added. The assignments task is to modify readcomplete method only. What I had to do was implement a disk scheduling algo. E.g. SSTF, Scan, C-Scan or whatever I can find/create that is better. When running the application you get a type of score to see how well your implentation performed. So far I’m getting 700-1000 which is good but not A grade. I need the score to be 500-600 or less.</p>
<p>“If there are errors in your code that cause incorrect blocks to be read, the simulation framework will emit various errors as it runs. These generally indicate serious problems with your scheduling algorithm — i.e. it is reading or returning the wrong blocks.” So far that code I showed was my implementation of SSTF.</p>
<p>Regards to the Math.abs justaguy, thank you for that. Very helpful. The while loop was a meh, blame my lack of understanding.</p>
<p>Thanks for the comments.</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/xx_matty_xx.html'><span itemprop='name'>xx_matty_xx</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-17T07:45:27Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:05Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#6</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>It sounds like you’re being scored on the number of DiskSim calls you have to make? So you need to reduce that number by using a better scheduling algorithm, not optimising bits of slow java. What scores do you get with the different types of algorithm?</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="1" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/my-swagger.html'><span itemprop='name'>my-swagger</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2016-04-17T13:02:35Z'>
            <time itemprop='dateModified' datetime='2016-08-04T17:54:06Z' class='post-time'>
              August 4, 2016,  5:54pm
            </time>
        <span itemprop='position'>#7</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <aside class="quote" data-post="6" data-topic="555208">
<div class="title">
<div class="quote-controls"></div>
 Justin Bieber:</div>
<blockquote>
<p>It sounds like you’re being scored on the number of DiskSim calls you have to make? So you need to reduce that number by using a better scheduling algorithm, not optimising bits of slow java. What scores do you get with the different types of algorithm?</p>
</blockquote>
</aside>
<p>Lol yes, this is the fastest I’m getting. Everything else I’ve tried is slower then 700 and google shows that SSTF is the fastest. My lecturer said that if it’s too slow find another algo or do something myself to make it faster.</p>
      </div>

      <meta itemprop='headline' content='Help me make this code faster!'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/help-me-make-this-code-faster/555208 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 03 Aug 2019 20:05:06 GMT -->
</html>
