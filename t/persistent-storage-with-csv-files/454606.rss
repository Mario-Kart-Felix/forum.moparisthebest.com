<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Persistent Storage with CSV files</title>
    <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606</link>
    <description>[size=18pt][b]Persistent Storage with CSV files[/b][/size]

Hello All!

First let me introduce myself, my name is Meiscooldude, I&#39;ve been on these forums forever; however I post quite rarely.

[b]Description:[/b] Today we are going to go over Persistent Storage using [i]CSVs[/i], what they are, how to use them, benefits of using them, and how we can use them in our code. We will focus strongly on how we can create reliable code to interface with them, and what our options are when certain errors arise.

[b]Technological Requirements:[/b] Java Development Kit 7u3 [earlier versions should work]

[b]Skill Requirements:[/b] You will have to know some basics about programming, including for-loops, while-loops, creating new classes, finals, etc etc.

[hr]


[b]What is a CSV?[/b]

[i][b]Wikipedia Definition:[/b][/i] A [b]comma-separated values[/b] (CSV) file stores tabular data (numbers and text) in plain-text form. Plain text means that the file is a sequence of characters, with no data that has to be interpreted instead, as binary numbers. A CSV file consists of any number of records, separated by line breaks of some kind; each record consists of fields, separated by some other character or string, most commonly a literal comma or tab [[b]Note:[/b] [i]We will be using a colon for this tutorial[/i]]. Usually, all records have an identical sequence of fields.


[b]What does a CSV file look like?[/b]

Because CSV files are used to store tabular data, it often looks just like a table. Here is the source to a CSV file used to store item definitions, followed by a formatted table of its contents. [[b]Note[/b]: [i]The example CSV along with CSV files we will use throughout this tutorial will contain header information. It is important to note that header information isn&#39;t necessary for a valid CSV file.[/i]]

[code]ID:Name:Description:Value
1:Tool kit:These could be handy.:55
2:Cannonball:Ammo for the Dwarf Cannon.:5
3:Nulodion&#39;s notes:Construction notes for Dwarf cannon ammo.:0
4:Ammo mold:Used to make cannon ammunition.:5
5:Instruction manual:An old note book.:0[/code]

[table]
[tr]
[td]ID[/td]
[td]Name[/td]
[td]Description[/td]
[td]Value[/td]
[/tr]
[tr]
[td]1[/td]
[td]Tool kit[/td]
[td]These could be handy.[/td]
[td]55[/td]
[/tr]
[tr]
[td]2[/td]
[td]Cannon Ball[/td]
[td]Ammo for the Dwarf Cannon.[/td]
[td]5[/td]
[/tr]
[tr]
[td]3[/td]
[td]Nulodion&#39;s notes[/td]
[td]Construction notes for Dwarf cannon ammo.[/td]
[td]0[/td]
[/tr]
[tr]
[td]4[/td]
[td]Ammo mould[/td]
[td]Used to make cannon ammunition.[/td]
[td]17[/td]
[/tr]
[tr]
[td]6[/td]
[td]Instruction Manual[/td]
[td]An old note book.[/td]
[td]10[/td]
[/tr]
[/table]


[b]What are the benefits of using CSV files?[/b]

Using CSV files to store records can have a lot of benefits, probably the best reason to choose to use CSV files is ease of implementation. Because of this ease of implementation you can save tons of time that would be spent storing records in other [perhaps more modern] means of persistent storage. Several developers and companies have capitalized on this ease of implementation, resulting in a large amount of third party applications supporting CSV file types. This allows you to manipulate, sort, analyze your data in applications such as Microsoft Excel, or Open Office Calc.


[b]How can we use CSVs in our code?[/b]

A specific example of when CSVs might be great [in RSPS] is when you first load all your item definitions and shop definitions. In fact, a lot of servers already use files very similar to CSVs to do these very operations. 

[[b]Note:[/b] [i]Anytime you need to load a large set of relatively static records on a simple system, CSV files are your friends. If you find yourself constantly adding and removing records to and from a CSV file, you should consider moving onto other means of storage.[/i]]

[hr]


[size=15pt][b]&#39;Items.csv&#39; Case Study[/b][/size]


In this case study we will be creating the code to save and load information involving &#39;Item&#39; data from a CSV file, focusing strongly on code reliability.

We will assume the following code:

[Code]
public class CaseStudy
{
    public static void
    main(String[] args)
    {
    	//TODO: Test out item loading and saving.
    }
}

//This class will handle saving and loading from the CSV file, most of our work will be done in here.
public class ItemDir
{
	/**
	 * The method used for saving provided item data to a csv file.
	 *
	 *	@param itemsToSave	The enumerated list of items to save to 
	 *						a csv file.
	 */
	public static void
	SaveItemData (Item[]  itemsToSave)
	{
		//ToBeImplemented
	}
	
	/**
	 * Method used for loading item data from a csv file.
	 */
	public static Item[]
	LoadItemData ()
	{
		//ToBeImplemented
		throw new UnsupportedOperationException ();
	}
	
	
	private static final char DELIMITER = &#39;:&#39;;
	
	private static final String ITEM_CSV_FILE_NAME = &quot;Items.csv&quot;;
	
	private static final String HEADER_ITEM_ID = &quot;ID&quot;;
	private static final String HEADER_ITEM_NAME = &quot;Name&quot;;
	private static final String HEADER_ITEM_DESCRIPTION = &quot;Description&quot;;
	private static final String HEADER_ITEM_VALUE = &quot;Value&quot;;
}

//This is our simple Item definition. 
class Item
{
	public
	Item (int id, String name, String description, double value)
	{
		ID = id;
		Name = name;
		Description = description;
		Value = value;
	}
	
	public int ID;
	public String Name;
	public String Description;
	public double Value;
}[/Code]


[size=13pt][b]File Output[/b][/size]

The method [i]SaveItemData (Item[] itemsToSave)[/i] handles our applications output to CSV logic. We are going to focus this subsection of this tutorial here.

Lets talk out what this method should do. It takes an array of Items as an argument, then tries to save it to a csv file. Pretty simple, but lets expand on that. 

First of all, we of course need to check to ensure the provided argument is valid. Chances are, if a piece of code tries to save a null there might be a problem behind it. So lets add a check for null, and throw an exception should [i]itemsToSave[/i] be null. After we verify the provided argument is valid we need to go ahead and create our CSV file (Because we are doing a file operation, we need to catch any exceptions that might be thrown.) After we create our file, we want to write header information. Lets do these three things now. [[b]Note:[/b] [i]I explain each operation in more detail in the comments.[/i]]

[code]	/**
	 * The method used for saving provided item data to a csv file.
	 *
	 *	@param itemsToSave	The enumerated list of items to save to 
	 *						a csv file.
	 */
	public static void
	SaveItemData (Item[]  itemsToSave) throws FileNotFoundException
	{
		//For this instance, we can assume that providing null
		//is bad behavior, and could represent errors long before
		//this method gets called.
		if (itemsToSave == null)
			throw new IllegalArgumentException (&quot;itemsToSave cannot be null&quot;);
		
		try
		{
			PrintStream  printStream;
			
			//Create a PrintStream for the file with the name of the value of ITEM_CSV_FILE_NAME.
			//Note: This will overwrite the file if it already exists. [this is desired]
			printStream = new PrintStream (ITEM_CSV_FILE_NAME);
			
			//Write header info.
			//
			//String.format is similar to printf in C. For further reading:
			//http://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html
			printStream.println(String.format (OUT_FORMAT, DELIMITER,
									HEADER_ITEM_ID,
									HEADER_ITEM_NAME,
									HEADER_ITEM_DESCRIPTION,
									HEADER_ITEM_VALUE));
			
		}
		catch (Exception e)
		{
			//Go ahead and printout the exception to the error stream.
			System.err.println(e);
		}
	}[/code]


Easy as Pie! 

Now, after we have written our header information, we can go ahead and write out actual data! To do that we simply need to loop thru each [i]Item [/i]object in our [i]itemsToSave [/i]parameter, check if its null (if it is, skip it), then print it out on a new line (formatting it the same way we did with the header). After that, we need to close our PrintStream, and then we can call it good! Lets go ahead and do this.


[b]Finished File Output Code:[/b]
[code]    public static void
    main(String[] args)
    {
    	ItemDir.SaveItemData(new Item[] {
    		new Item(1, &quot;TestItem&quot;, &quot;Description&quot;, 52),
    		new Item(2, &quot;SecondItem&quot;, &quot;OtherDescription&quot;, 35)
    	});
    }

	/**
	 * The method used for saving provided item data to a csv file.
	 *
	 *	@param itemsToSave	The enumerated list of items to save to 
	 *						a csv file.
	 */
	public static void
	SaveItemData (Item[]  itemsToSave)
	{
		//For this instance, we can assume that providing null
		//is bad behavior, and could represent errors long before
		//this method gets called.
		if (itemsToSave == null)
			throw new IllegalArgumentException (&quot;itemsToSave cannot be null&quot;);
		
		try
		{
			PrintStream  printStream;
			
			//Create a PrintStream for the file with the name of the value of ITEM_CSV_FILE_NAME.
			//Note: This will overwrite the file if it already exists. [this is desired]
			printStream = new PrintStream (ITEM_CSV_FILE_NAME);
			
			//Write header info.
			//
			//String.format is similar to printf in C. For further reading:
			//http://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html
			printStream.println(String.format (OUT_FORMAT, DELIMITER,
											   HEADER_ITEM_ID,
											   HEADER_ITEM_NAME,
											   HEADER_ITEM_DESCRIPTION,
											   HEADER_ITEM_VALUE));
			
			//Foreach Item in itemsToSave
			for(Item item : itemsToSave)
			{
				//Check to see if the current Item is null, 
				//if so, continue to the next.
				if (item == null)
					continue;
				
				//Print a new line out to the file describing
				//the current item.
				printStream.println(String.format (OUT_FORMAT, DELIMITER,
										item.ID,
										item.Name,
										item.Description,
										item.Value));
			}
			
			//Close the PrintStream
			printStream.close();
		}
		catch (Exception e)
		{
			//Go ahead and printout the exception to the error stream.
			System.err.println(e);
		}
	}[/code]


Executing that should give you a CSV file named &quot;Items.csv&quot; that opens very nicely with Microsoft Excel, or Open Office Calc. It should look something like this:

[code]ID:Name:Description:Value
1:TestItem:Description:52.0
2:SecondItem:OtherDescription:35.0[/code]

[table]
[tr]
[td]ID[/td]
[td]Name[/td]
[td]Description[/td]
[td]Value[/td]
[/tr]
[tr]
[td]1[/td]
[td]TestItem[/td]
[td]Description[/td]
[td]52[/td]
[/tr]
[tr]
[td]2[/td]
[td]SecondItem[/td]
[td]OtherDescription[/td]
[td]35[/td]
[/tr]
[/table]



[size=13pt][b]File Input[/b][/size]

File input will be a little more difficult than File output (or at least i will go into more depth.) 

The method of interest for this subsection is [i]LoadItemData ()[/i]. So, well spend most of our time in there.

Lets talk it out again how this method is going to work. Well, to put it in simplest terms, its going to open a file, and read each row and create Items as it goes. Once again, sounds pretty simple, but lets expand on that.

Since users might be manipulating these CSV files in Excel or Calc, we need the reading in of these files to be very robust. Here are our desired requirements: [b][i]Column order and Row order [with the exception of the header] shouldn&#39;t matter,  Invalid data type errors [String where an Int should be] in the file should be reported giving both Line Numbers and Column Number to provide the user with an easy way find errors without hand checking it, and an invalid row shouldn&#39;t force all the other rows to not load. [/i][/b] That&#39;s a pretty nice list. Lets get started shall we?

First thing we want to do is of course open up our CSV file. Lets go ahead and do that.

[code]	/**
	 * Method used for loading item data from a csv file.
	 */
	public static Item[]
	LoadItemData () throws FileNotFoundException
	{

		Scanner  inputScanner;
		
		//Create a Scanner for the file with the name of the value of ITEM_CSV_FILE_NAME.
		inputScanner = new Scanner (new File (ITEM_CSV_FILE_NAME));
			
	}[/code]


Next, because of our robustivity requirements, specifically column order not mattering, we need to keep track of which column is where [keep an index value for each]. We will also need to report on columns missing [end import attempts should a column be missing] and keep track of how many lines we&#39;ve read from the file [to report errors on certain lines].

So, after we read the header line, we will need to split it by our delimiter (colon), then we will need to figure out the index of each individual header column. To do this, I will create a very simple helper method [[i]IndexOf(String[], String)[/i]] for finding a strings index in an array of strings. Lets use our helper method to help us find the index of each individual column header, while reporting of missing columns [and aborting import on missing column].

Lets do this now.

[code]	/**
	 * Method used for loading item data from a csv file.
	 */
	public static Item[]
	LoadItemData () throws FileNotFoundException
	{

		Scanner  inputScanner;
		
		//Create a Scanner for the file with the name of the value of ITEM_CSV_FILE_NAME.
		//If a FileNotFoundException is thrown, let the calling
		//method deal with it.
		inputScanner = new Scanner (new File (ITEM_CSV_FILE_NAME));

		//Lets create some variables for keeping track of
		//which column is where.
		//
		//I&#39;m going to post fix these with &#39;idx&#39; standing for
		//index... commonly this method uses &#39;ord&#39; instead
		//standing for Ordinal, however, to keep things
		//out of the field of set theory, lets stay with &#39;idx&#39;
		int  id_idx,
			 name_idx,
			 description_idx,
			 value_idx;
		
		
		//We need a variable to keep track of lines read
		//from the CSV file.
		int  currentLine = 1;
		
		//Lets create a variable for keeping track of which
		//columnName we are on.
		String  columnName = &quot;&quot;;
		
		
		//Lets create a variable for keeping track of what
		//is in the current line read from the CSV.
		String  lineString = &quot;&quot;;
		
		//Lets create a variable for keeping track of
		//the rows values once a line is split by the
		//delimiter.
		String[]  lineData = null;
		
		try
		{
			//Read the first line of the CSV
			lineString = inputScanner.nextLine();
			
			
			//Check to see if the line contained data.
			if (lineString == null || lineString.equals(&quot;&quot;))
			{
				throw new IOException (&quot;Cannot find header information&quot;);
			}
			
			//Split the first line based on the delimiter.
			lineData = lineString.split(DELIMITER);
			
			//Find the index of each column header.
			//
			//Note: I&#39;m setting column name to HEADER_ITEM_ID at
			//the same time that i&#39;m calling this method. This
			//is just short hand instead of the two lines:
			//
			//columnName = HEADER_ITEM_ID;
			//id_idx = IndexOf (lineData, columnName = HEADER_ITEM_ID);
			//
			id_idx = IndexOf (lineData, columnName = HEADER_ITEM_ID);
			name_idx = IndexOf (lineData, columnName = HEADER_ITEM_NAME);
			description_idx = IndexOf (lineData, columnName = HEADER_ITEM_DESCRIPTION);
			value_idx = IndexOf (lineData, columnName = HEADER_ITEM_VALUE);
		}
		catch (ArrayIndexOutOfBoundsException iob)
		{
			
			System.err.println(&quot;Cannot find column with name &quot; + columnName);
			
			//rethrow the exception, because we just
			//wanted log some debug information
			//stating that a column wasn&#39;t found.
			throw iob;
		}
		
	}
	
	
	
	/**
	 *
	 * Finds a strings index inside an array.
	 * &lt;p/&gt;
	 * Throws an exception if the string isn&#39;t found.
	 *
	 */
	private static int
	IndexOf (String[] array, String str)
	{
		for (int i = 0; i &lt; array.length; i++)
		{
			if (array[i].equals(str))
				return i;
		}
		
		throw new ArrayIndexOutOfBoundsException (&quot;The name specified is not a valid column name&quot;);
	}[/code]


Pretty freaking sweet if you ask me!

So, now that we have our header information loaded in correctly, its time to use it!

First thing is first, we need a way to store all these items. I&#39;m choosing just your average run of the mill ArrayList. We also need to remember to keep count of lines. Then we&#39;ll have to go through line by line, parsing our Item data as we go. We will also report on line and column location should we encounter an error. Then we need to return the results to our user.

[code]
		//Generic list for storing Item objects.
		List&lt;Item&gt;  itemList = new ArrayList&lt;Item&gt; ();
		
		//Loop through each row
		while(inputScanner.hasNextLine())
		{
			//Continue to count lines.
			currentLine++;
			
			//Varaible for storing ItemID
			int Id, currentIdx = -1;
			
			//Variables for stroing Name and Description
			String Name, Description;
			
			//Variable for stroing Value
			double  Value;
			
			//Read the next row.
			lineString = inputScanner.nextLine();
			
			//Split the line by the delimiter.
			lineData = lineString.split(Character.toString(DELIMITER));
			
			try
			{
				//Note: This is where the *_idx variables
				//show their awesomeness, order of the columns
				//doesn&#39;t matter!
				
				//Attempt to parse the ID column for this row.
				Id = Integer.parseInt(lineData[currentIdx = id_idx]);
				
				//Read in the name and description fields from the row.
				Name = lineData[currentIdx = name_idx];
				Description = lineData[currentIdx = description_idx];
				
				//Read in the value field.
				Value = Double.parseDouble(lineData[currentIdx = value_idx]);
				
				//Add the newly read item to the list of current ones.
				itemList.add(new Item(Id, Name, Description, Value));
			}
			catch (Exception e)
			{
				//Printing out line numer and column number 
				//to make it easier for the user to fix.
				System.err.println(&quot;Error on line &quot; + currentLine +
								   &quot; column &quot; + currentIdx);
			}
		}
		
		//Return the results.
		return itemList.toArray(new Item[itemList.size()]);[/code]

[hr]

[size=6pt]
I make no guarantee on the code provided. There are a few instances of exceptions not being handled, perhaps a logic error or two [wrote this really late], and random C# practices here n there.. [/size]</description>
    
    <lastBuildDate>Sat, 18 Aug 2012 19:46:00 +0000</lastBuildDate>
    <category>Runescape</category>
    <atom:link href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@meiscooldude meiscooldude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/meiscooldude">@meiscooldude</a> wrote:</p>
          <blockquote>
              <p>Key word, “typically”</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/8">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/8</link>
        <pubDate>Sat, 18 Aug 2012 19:46:00 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-8</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@Advocatus Advocatus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/advocatus">@Advocatus</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="6" data-topic="454606">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/user_avatar/forum.moparisthebest.com/meiscooldude/40/205_1.png" class="avatar"> meiscooldude:</div>
<blockquote>
<p>3.with the records divided into fields separated by delimiters (typically a single reserved character such as comma, semicolon, or tab; sometimes the delimiter may include optional spaces),</p>
</blockquote>
</aside>
<p>a colon isn’t a semicolon. Also if you use tabs its considered .tsv (tab separated values)</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/7">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/7</link>
        <pubDate>Sat, 18 Aug 2012 18:51:36 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-7</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@meiscooldude meiscooldude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/meiscooldude">@meiscooldude</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="5" data-topic="454606">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/advocatus/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> Advocatus:</div>
<blockquote>
<p>csv = comma separated values not colon separated values.</p>
</blockquote>
</aside>
<p>Yes, however the delimiter is substitutable with other characters.</p>
<p>“CSV” is not a single, well-defined format (although see RFC 4180 for one definition that is commonly used). Rather, in practice the term “CSV” refers to any file that:</p>
<p>1.is plain text using a character set such as ASCII, Unicode, EBCDIC, or Shift JIS,<br>
2.consists of records (typically one record per line),<br>
3.with the records divided into fields separated by delimiters (typically a single reserved character such as comma, semicolon, or tab; sometimes the delimiter may include optional spaces),<br>
4.where every record has the same sequence of fields.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/6">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/6</link>
        <pubDate>Sat, 18 Aug 2012 14:44:08 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-6</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@Advocatus Advocatus]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/advocatus">@Advocatus</a> wrote:</p>
          <blockquote>
              <p>csv = comma separated values not colon separated values.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/5">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/5</link>
        <pubDate>Sat, 18 Aug 2012 14:12:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-5</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@Ruby_Forums_Coder Ruby]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/ruby_forums_coder">@Ruby_Forums_Coder</a> wrote:</p>
          <blockquote>
              <p>Glad to see you actually posting meiscooldude <img src="https://forum.moparisthebest.com/images/emoji/twitter/stuck_out_tongue.png?v=5" title=":stuck_out_tongue:" class="emoji" alt=":stuck_out_tongue:"></p>
<p>Great tutorial and well explained, I expected nothing less.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/4">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/4</link>
        <pubDate>Sat, 18 Aug 2012 01:11:14 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-4</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@meiscooldude meiscooldude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/meiscooldude">@meiscooldude</a> wrote:</p>
          <blockquote>
              <aside class="quote" data-post="2" data-topic="454606">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="https://forum.moparisthebest.com/letter_avatar/randqm/40/5_e05bb34c421432ee4d40de30c10af3e5.png" class="avatar"> RandQm:</div>
<blockquote>
<p>Q: What would be the advantages &amp; disadvantages when using this for rsps development, over the current popular way xml</p>
</blockquote>
</aside>
<p>Probably speed for one. However, xml has higher reliability compared to CSVs, and is usually my preferred method.</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/3">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/3</link>
        <pubDate>Fri, 17 Aug 2012 14:40:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-3</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@RandQm RandQm]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/randqm">@RandQm</a> wrote:</p>
          <blockquote>
              <p>Never heard about this,<br>
I might give it a try to use this as learning purpose. I kinda like it</p>
<p>edit:<br>
Q: What would be the advantages &amp; disadvantages when using this for rsps development, over the current popular way xml</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/2">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/2</link>
        <pubDate>Fri, 17 Aug 2012 14:25:11 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-2</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
      <item>
        <title>Persistent Storage with CSV files</title>
        <dc:creator><![CDATA[@meiscooldude meiscooldude]]></dc:creator>
        <description><![CDATA[
          <p><a href="https://forum.moparisthebest.com/u/meiscooldude">@meiscooldude</a> wrote:</p>
          <blockquote>
              <p>[size=18pt]<span class="bbcode-b">Persistent Storage with CSV files</span>[/size]</p>
<p>Hello All!</p>
<p>First let me introduce myself, my name is Meiscooldude, I’ve been on these forums forever; however I post quite rarely.</p>
<p><span class="bbcode-b">Description:</span> Today we are going to go over Persistent Storage using <span class="bbcode-i">CSVs</span>, what they are, how to use them, benefits of using them, and how we can use them in our code. We will focus strongly on how we can create reliable code to interface with them, and what our options are when certain errors arise.</p>
<p><span class="bbcode-b">Technological Requirements:</span> Java Development Kit 7u3 [earlier versions should work]</p>
<p><span class="bbcode-b">Skill Requirements:</span> You will have to know some basics about programming, including for-loops, while-loops, creating new classes, finals, etc etc.</p>
<p>[hr]</p>
<p><span class="bbcode-b">What is a CSV?</span></p>
<p><span class="bbcode-i"><span class="bbcode-b">Wikipedia Definition:</span></span> A <span class="bbcode-b">comma-separated values</span> (CSV) file stores tabular data (numbers and text) in plain-text form. Plain text means that the file is a sequence of characters, with no data that has to be interpreted instead, as binary numbers. A CSV file consists of any number of records, separated by line breaks of some kind; each record consists of fields, separated by some other character or string, most commonly a literal comma or tab [<span class="bbcode-b">Note:</span> <span class="bbcode-i">We will be using a colon for this tutorial</span>]. Usually, all records have an identical sequence of fields.</p>
<p><span class="bbcode-b">What does a CSV file look like?</span></p>
<p>Because CSV files are used to store tabular data, it often looks just like a table. Here is the source to a CSV file used to store item definitions, followed by a formatted table of its contents. [<span class="bbcode-b">Note</span>: <span class="bbcode-i">The example CSV along with CSV files we will use throughout this tutorial will contain header information. It is important to note that header information isn’t necessary for a valid CSV file.</span>]</p>
<p><code>ID:Name:Description:Value
1:Tool kit:These could be handy.:55
2:Cannonball:Ammo for the Dwarf Cannon.:5
3:Nulodion's notes:Construction notes for Dwarf cannon ammo.:0
4:Ammo mold:Used to make cannon ammunition.:5
5:Instruction manual:An old note book.:0</code></p>
<p>[table]<br>
[tr]<br>
[td]ID[/td]<br>
[td]Name[/td]<br>
[td]Description[/td]<br>
[td]Value[/td]<br>
[/tr]<br>
[tr]<br>
[td]1[/td]<br>
[td]Tool kit[/td]<br>
[td]These could be handy.[/td]<br>
[td]55[/td]<br>
[/tr]<br>
[tr]<br>
[td]2[/td]<br>
[td]Cannon Ball[/td]<br>
[td]Ammo for the Dwarf Cannon.[/td]<br>
[td]5[/td]<br>
[/tr]<br>
[tr]<br>
[td]3[/td]<br>
[td]Nulodion’s notes[/td]<br>
[td]Construction notes for Dwarf cannon ammo.[/td]<br>
[td]0[/td]<br>
[/tr]<br>
[tr]<br>
[td]4[/td]<br>
[td]Ammo mould[/td]<br>
[td]Used to make cannon ammunition.[/td]<br>
[td]17[/td]<br>
[/tr]<br>
[tr]<br>
[td]6[/td]<br>
[td]Instruction Manual[/td]<br>
[td]An old note book.[/td]<br>
[td]10[/td]<br>
[/tr]<br>
[/table]</p>
<p><span class="bbcode-b">What are the benefits of using CSV files?</span></p>
<p>Using CSV files to store records can have a lot of benefits, probably the best reason to choose to use CSV files is ease of implementation. Because of this ease of implementation you can save tons of time that would be spent storing records in other [perhaps more modern] means of persistent storage. Several developers and companies have capitalized on this ease of implementation, resulting in a large amount of third party applications supporting CSV file types. This allows you to manipulate, sort, analyze your data in applications such as Microsoft Excel, or Open Office Calc.</p>
<p><span class="bbcode-b">How can we use CSVs in our code?</span></p>
<p>A specific example of when CSVs might be great [in RSPS] is when you first load all your item definitions and shop definitions. In fact, a lot of servers already use files very similar to CSVs to do these very operations.</p>
<p>[<span class="bbcode-b">Note:</span> <span class="bbcode-i">Anytime you need to load a large set of relatively static records on a simple system, CSV files are your friends. If you find yourself constantly adding and removing records to and from a CSV file, you should consider moving onto other means of storage.</span>]</p>
<p>[hr]</p>
<p>[size=15pt]<span class="bbcode-b">‘Items.csv’ Case Study</span>[/size]</p>
<p>In this case study we will be creating the code to save and load information involving ‘Item’ data from a CSV file, focusing strongly on code reliability.</p>
<p>We will assume the following code:</p>
<p>[Code]<br>
public class CaseStudy<br>
{<br>
public static void<br>
main(String[] args)<br>
{<br>
//TODO: Test out item loading and saving.<br>
}<br>
}</p>
<p>//This class will handle saving and loading from the CSV file, most of our work will be done in here.<br>
public class ItemDir<br>
{<br>
/**<br>
* The method used for saving provided item data to a csv file.<br>
*<br>
*	<a class="mention" href="/u/param">@param</a> itemsToSave	The enumerated list of items to save to<br>
*						a csv file.<br>
*/<br>
public static void<br>
SaveItemData (Item[]  itemsToSave)<br>
{<br>
//ToBeImplemented<br>
}</p>
<pre><code>/**
 * Method used for loading item data from a csv file.
 */
public static Item[]
LoadItemData ()
{
	//ToBeImplemented
	throw new UnsupportedOperationException ();
}


private static final char DELIMITER = ':';

private static final String ITEM_CSV_FILE_NAME = "Items.csv";

private static final String HEADER_ITEM_ID = "ID";
private static final String HEADER_ITEM_NAME = "Name";
private static final String HEADER_ITEM_DESCRIPTION = "Description";
private static final String HEADER_ITEM_VALUE = "Value";
</code></pre>
<p>}</p>
<p>//This is our simple Item definition.<br>
class Item<br>
{<br>
public<br>
Item (int id, String name, String description, double value)<br>
{<br>
ID = id;<br>
Name = name;<br>
Description = description;<br>
Value = value;<br>
}</p>
<pre><code>public int ID;
public String Name;
public String Description;
public double Value;
</code></pre>
<p>}[/Code]</p>
<p>[size=13pt]<span class="bbcode-b">File Output</span>[/size]</p>
<p>The method <span class="bbcode-i">SaveItemData (Item[] itemsToSave)</span> handles our applications output to CSV logic. We are going to focus this subsection of this tutorial here.</p>
<p>Lets talk out what this method should do. It takes an array of Items as an argument, then tries to save it to a csv file. Pretty simple, but lets expand on that.</p>
<p>First of all, we of course need to check to ensure the provided argument is valid. Chances are, if a piece of code tries to save a null there might be a problem behind it. So lets add a check for null, and throw an exception should <span class="bbcode-i">itemsToSave</span> be null. After we verify the provided argument is valid we need to go ahead and create our CSV file (Because we are doing a file operation, we need to catch any exceptions that might be thrown.) After we create our file, we want to write header information. Lets do these three things now. [<span class="bbcode-b">Note:</span> <span class="bbcode-i">I explain each operation in more detail in the comments.</span>]</p>
<p>[code]	/**<br>
* The method used for saving provided item data to a csv file.<br>
*<br>
*	<a class="mention" href="/u/param">@param</a> itemsToSave	The enumerated list of items to save to<br>
*						a csv file.<br>
*/<br>
public static void<br>
SaveItemData (Item[]  itemsToSave) throws FileNotFoundException<br>
{<br>
//For this instance, we can assume that providing null<br>
//is bad behavior, and could represent errors long before<br>
//this method gets called.<br>
if (itemsToSave == null)<br>
throw new IllegalArgumentException (“itemsToSave cannot be null”);</p>
<pre><code>	try
	{
		PrintStream  printStream;
		
		//Create a PrintStream for the file with the name of the value of ITEM_CSV_FILE_NAME.
		//Note: This will overwrite the file if it already exists. [this is desired]
		printStream = new PrintStream (ITEM_CSV_FILE_NAME);
		
		//Write header info.
		//
		//String.format is similar to printf in C. For further reading:
		//http://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html
		printStream.println(String.format (OUT_FORMAT, DELIMITER,
								HEADER_ITEM_ID,
								HEADER_ITEM_NAME,
								HEADER_ITEM_DESCRIPTION,
								HEADER_ITEM_VALUE));
		
	}
	catch (Exception e)
	{
		//Go ahead and printout the exception to the error stream.
		System.err.println(e);
	}
}[/code]
</code></pre>
<p>Easy as Pie!</p>
<p>Now, after we have written our header information, we can go ahead and write out actual data! To do that we simply need to loop thru each <span class="bbcode-i">Item </span>object in our <span class="bbcode-i">itemsToSave </span>parameter, check if its null (if it is, skip it), then print it out on a new line (formatting it the same way we did with the header). After that, we need to close our PrintStream, and then we can call it good! Lets go ahead and do this.</p>
<p><span class="bbcode-b">Finished File Output Code:</span></p>
<p>[code]    public static void<br>
main(String[] args)<br>
{<br>
ItemDir.SaveItemData(new Item[] {<br>
new Item(1, “TestItem”, “Description”, 52),<br>
new Item(2, “SecondItem”, “OtherDescription”, 35)<br>
});<br>
}</p>
<pre><code>/**
 * The method used for saving provided item data to a csv file.
 *
 *	@param itemsToSave	The enumerated list of items to save to 
 *						a csv file.
 */
public static void
SaveItemData (Item[]  itemsToSave)
{
	//For this instance, we can assume that providing null
	//is bad behavior, and could represent errors long before
	//this method gets called.
	if (itemsToSave == null)
		throw new IllegalArgumentException ("itemsToSave cannot be null");
	
	try
	{
		PrintStream  printStream;
		
		//Create a PrintStream for the file with the name of the value of ITEM_CSV_FILE_NAME.
		//Note: This will overwrite the file if it already exists. [this is desired]
		printStream = new PrintStream (ITEM_CSV_FILE_NAME);
		
		//Write header info.
		//
		//String.format is similar to printf in C. For further reading:
		//http://docs.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html
		printStream.println(String.format (OUT_FORMAT, DELIMITER,
										   HEADER_ITEM_ID,
										   HEADER_ITEM_NAME,
										   HEADER_ITEM_DESCRIPTION,
										   HEADER_ITEM_VALUE));
		
		//Foreach Item in itemsToSave
		for(Item item : itemsToSave)
		{
			//Check to see if the current Item is null, 
			//if so, continue to the next.
			if (item == null)
				continue;
			
			//Print a new line out to the file describing
			//the current item.
			printStream.println(String.format (OUT_FORMAT, DELIMITER,
									item.ID,
									item.Name,
									item.Description,
									item.Value));
		}
		
		//Close the PrintStream
		printStream.close();
	}
	catch (Exception e)
	{
		//Go ahead and printout the exception to the error stream.
		System.err.println(e);
	}
}[/code]
</code></pre>
<p>Executing that should give you a CSV file named “Items.csv” that opens very nicely with Microsoft Excel, or Open Office Calc. It should look something like this:</p>
<p><code>ID:Name:Description:Value
1:TestItem:Description:52.0
2:SecondItem:OtherDescription:35.0</code></p>
<p>[table]<br>
[tr]<br>
[td]ID[/td]<br>
[td]Name[/td]<br>
[td]Description[/td]<br>
[td]Value[/td]<br>
[/tr]<br>
[tr]<br>
[td]1[/td]<br>
[td]TestItem[/td]<br>
[td]Description[/td]<br>
[td]52[/td]<br>
[/tr]<br>
[tr]<br>
[td]2[/td]<br>
[td]SecondItem[/td]<br>
[td]OtherDescription[/td]<br>
[td]35[/td]<br>
[/tr]<br>
[/table]</p>
<p>[size=13pt]<span class="bbcode-b">File Input</span>[/size]</p>
<p>File input will be a little more difficult than File output (or at least i will go into more depth.)</p>
<p>The method of interest for this subsection is <span class="bbcode-i">LoadItemData ()</span>. So, well spend most of our time in there.</p>
<p>Lets talk it out again how this method is going to work. Well, to put it in simplest terms, its going to open a file, and read each row and create Items as it goes. Once again, sounds pretty simple, but lets expand on that.</p>
<p>Since users might be manipulating these CSV files in Excel or Calc, we need the reading in of these files to be very robust. Here are our desired requirements: <span class="bbcode-b"><span class="bbcode-i">Column order and Row order [with the exception of the header] shouldn’t matter,  Invalid data type errors [String where an Int should be] in the file should be reported giving both Line Numbers and Column Number to provide the user with an easy way find errors without hand checking it, and an invalid row shouldn’t force all the other rows to not load. </span></span> That’s a pretty nice list. Lets get started shall we?</p>
<p>First thing we want to do is of course open up our CSV file. Lets go ahead and do that.</p>
<p>[code]	/**<br>
* Method used for loading item data from a csv file.<br>
*/<br>
public static Item[]<br>
LoadItemData () throws FileNotFoundException<br>
{</p>
<pre><code>	Scanner  inputScanner;
	
	//Create a Scanner for the file with the name of the value of ITEM_CSV_FILE_NAME.
	inputScanner = new Scanner (new File (ITEM_CSV_FILE_NAME));
		
}[/code]
</code></pre>
<p>Next, because of our robustivity requirements, specifically column order not mattering, we need to keep track of which column is where [keep an index value for each]. We will also need to report on columns missing [end import attempts should a column be missing] and keep track of how many lines we’ve read from the file [to report errors on certain lines].</p>
<p>So, after we read the header line, we will need to split it by our delimiter (colon), then we will need to figure out the index of each individual header column. To do this, I will create a very simple helper method [<span class="bbcode-i">IndexOf(String[], String)</span>] for finding a strings index in an array of strings. Lets use our helper method to help us find the index of each individual column header, while reporting of missing columns [and aborting import on missing column].</p>
<p>Lets do this now.</p>
<p>[code]	/**<br>
* Method used for loading item data from a csv file.<br>
*/<br>
public static Item[]<br>
LoadItemData () throws FileNotFoundException<br>
{</p>
<pre><code>	Scanner  inputScanner;
	
	//Create a Scanner for the file with the name of the value of ITEM_CSV_FILE_NAME.
	//If a FileNotFoundException is thrown, let the calling
	//method deal with it.
	inputScanner = new Scanner (new File (ITEM_CSV_FILE_NAME));

	//Lets create some variables for keeping track of
	//which column is where.
	//
	//I'm going to post fix these with 'idx' standing for
	//index... commonly this method uses 'ord' instead
	//standing for Ordinal, however, to keep things
	//out of the field of set theory, lets stay with 'idx'
	int  id_idx,
		 name_idx,
		 description_idx,
		 value_idx;
	
	
	//We need a variable to keep track of lines read
	//from the CSV file.
	int  currentLine = 1;
	
	//Lets create a variable for keeping track of which
	//columnName we are on.
	String  columnName = "";
	
	
	//Lets create a variable for keeping track of what
	//is in the current line read from the CSV.
	String  lineString = "";
	
	//Lets create a variable for keeping track of
	//the rows values once a line is split by the
	//delimiter.
	String[]  lineData = null;
	
	try
	{
		//Read the first line of the CSV
		lineString = inputScanner.nextLine();
		
		
		//Check to see if the line contained data.
		if (lineString == null || lineString.equals(""))
		{
			throw new IOException ("Cannot find header information");
		}
		
		//Split the first line based on the delimiter.
		lineData = lineString.split(DELIMITER);
		
		//Find the index of each column header.
		//
		//Note: I'm setting column name to HEADER_ITEM_ID at
		//the same time that i'm calling this method. This
		//is just short hand instead of the two lines:
		//
		//columnName = HEADER_ITEM_ID;
		//id_idx = IndexOf (lineData, columnName = HEADER_ITEM_ID);
		//
		id_idx = IndexOf (lineData, columnName = HEADER_ITEM_ID);
		name_idx = IndexOf (lineData, columnName = HEADER_ITEM_NAME);
		description_idx = IndexOf (lineData, columnName = HEADER_ITEM_DESCRIPTION);
		value_idx = IndexOf (lineData, columnName = HEADER_ITEM_VALUE);
	}
	catch (ArrayIndexOutOfBoundsException iob)
	{
		
		System.err.println("Cannot find column with name " + columnName);
		
		//rethrow the exception, because we just
		//wanted log some debug information
		//stating that a column wasn't found.
		throw iob;
	}
	
}



/**
 *
 * Finds a strings index inside an array.
 * &lt;p/&gt;
 * Throws an exception if the string isn't found.
 *
 */
private static int
IndexOf (String[] array, String str)
{
	for (int i = 0; i &lt; array.length; i++)
	{
		if (array[i].equals(str))
			return i;
	}
	
	throw new ArrayIndexOutOfBoundsException ("The name specified is not a valid column name");
}[/code]
</code></pre>
<p>Pretty freaking sweet if you ask me!</p>
<p>So, now that we have our header information loaded in correctly, its time to use it!</p>
<p>First thing is first, we need a way to store all these items. I’m choosing just your average run of the mill ArrayList. We also need to remember to keep count of lines. Then we’ll have to go through line by line, parsing our Item data as we go. We will also report on line and column location should we encounter an error. Then we need to return the results to our user.</p>
<p>[code]<br>
//Generic list for storing Item objects.<br>
List  itemList = new ArrayList ();</p>
<pre><code>	//Loop through each row
	while(inputScanner.hasNextLine())
	{
		//Continue to count lines.
		currentLine++;
		
		//Varaible for storing ItemID
		int Id, currentIdx = -1;
		
		//Variables for stroing Name and Description
		String Name, Description;
		
		//Variable for stroing Value
		double  Value;
		
		//Read the next row.
		lineString = inputScanner.nextLine();
		
		//Split the line by the delimiter.
		lineData = lineString.split(Character.toString(DELIMITER));
		
		try
		{
			//Note: This is where the *_idx variables
			//show their awesomeness, order of the columns
			//doesn't matter!
			
			//Attempt to parse the ID column for this row.
			Id = Integer.parseInt(lineData[currentIdx = id_idx]);
			
			//Read in the name and description fields from the row.
			Name = lineData[currentIdx = name_idx];
			Description = lineData[currentIdx = description_idx];
			
			//Read in the value field.
			Value = Double.parseDouble(lineData[currentIdx = value_idx]);
			
			//Add the newly read item to the list of current ones.
			itemList.add(new Item(Id, Name, Description, Value));
		}
		catch (Exception e)
		{
			//Printing out line numer and column number 
			//to make it easier for the user to fix.
			System.err.println("Error on line " + currentLine +
							   " column " + currentIdx);
		}
	}
	
	//Return the results.
	return itemList.toArray(new Item[itemList.size()]);[/code]
</code></pre>
<p>[hr]</p>
<p>[size=6pt]<br>
I make no guarantee on the code provided. There are a few instances of exceptions not being handled, perhaps a logic error or two [wrote this really late], and random C# practices here n there… [/size]</p>
          </blockquote>
          <p><a href="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/1">Read full topic</a></p>
        ]]></description>
        <link>https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606/1</link>
        <pubDate>Fri, 17 Aug 2012 07:52:03 +0000</pubDate>
        <guid isPermaLink="false">forum.moparisthebest.com-post-454606-1</guid>
        <source url="https://forum.moparisthebest.com/t/persistent-storage-with-csv-files/454606.rss">Persistent Storage with CSV files</source>
      </item>
  </channel>
</rss>
