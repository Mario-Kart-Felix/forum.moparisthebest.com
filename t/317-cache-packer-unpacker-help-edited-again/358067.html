<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from forum.moparisthebest.com/t/317-cache-packer-unpacker-help-edited-again/358067 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 14:00:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <title>317 Cache packer &amp; unpacker help. [Edited again] - Runescape - moparisthebest.com</title>
    <meta name="description" content="Thanks to the help of c|p I&amp;#39;ve decided to retry this.

 

I&amp;#39;ve managed to get the length of all the index files.

 

 Game Data length: 54

 

Models length: 83646

 

Cache2 length: 5814

 

Music length: 3684

 

Cache&amp;hellip;">
    <meta name="generator" content="Discourse 2.3.2 - https://github.com/discourse/discourse version c587df7e2a03c2962f4c8cefd6f03969bb87d525">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/2X/1/1f0dc167bcf798bdbd70b03bf0fd1bc836e54e1a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff_2_180x180.png">
<meta name="theme-color" content="#0088cc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="358067.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://forum.moparisthebest.com","potentialAction":{"@type":"SearchAction","target":"https://forum.moparisthebest.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="moparisthebest.com Search">

      <link href="../../stylesheets/desktop_1_ec9f75e3d0b2a904642ce53663991837b70cda3334fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="../../stylesheets/desktop_theme_2_6707e7ee46ac9f2f0510c29ddd10e8f6ce21c1ae34fc.css?__ws=forum.moparisthebest.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    
    
      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;317 Cache packer &amp; unpacker help. [Edited again]&#39;" href="358067.rss" />
  <meta property="og:site_name" content="moparisthebest.com" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:image" content="https://forum.moparisthebest.com/uploads/default/original/2X/4/41fecb6185fddc2758aeba68c3f8c9c78e26e4ff.png" />
<meta property="og:url" content="https://forum.moparisthebest.com/t/317-cache-packer-unpacker-help-edited-again/358067" />
<meta name="twitter:url" content="https://forum.moparisthebest.com/t/317-cache-packer-unpacker-help-edited-again/358067" />
<meta property="og:title" content="317 Cache packer &amp; unpacker help. [Edited again]" />
<meta name="twitter:title" content="317 Cache packer &amp; unpacker help. [Edited again]" />
<meta property="og:description" content="Thanks to the help of c|p I’ve decided to retry this.  I’ve managed to get the length of all the index files.  Game Data length: 54 Models length: 83646 Cache2 length: 5814 Music length: 3684 Cache4 length: 8004 Which also means that they should contain these amount of files. Game Data files: 9 Models files: 13941 Cache2 files: 969 Music files: 614 Cache4 files: 1334 (I hope this is right). Now I’m reading the whole of the index file like so;      public byte[] readIndex() {         try {       ..." />
<meta name="twitter:description" content="Thanks to the help of c|p I’ve decided to retry this.  I’ve managed to get the length of all the index files.  Game Data length: 54 Models length: 83646 Cache2 length: 5814 Music length: 3684 Cache4 length: 8004 Which also means that they should contain these amount of files. Game Data files: 9 Models files: 13941 Cache2 files: 969 Music files: 614 Cache4 files: 1334 (I hope this is right). Now I’m reading the whole of the index file like so;      public byte[] readIndex() {         try {       ..." />
<meta property="article:published_time" content="2010-08-31T21:51:31+00:00" />
<meta property="og:ignore_canonical" content="true" />



    
  </head>
  <body class="crawler">
    
    <header>
      <a href="../../index.html">
          <img src="../../uploads/default/original/2X/3/37bba8fb3bd06c372ab54fa72ec38bf9f8f40b37.gif" alt="moparisthebest.com" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1 class="crawler-topic-title">
  <a href="358067.html">317 Cache packer &amp; unpacker help. [Edited again]</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="../../c/games.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Games</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="../../c/games/runescape.html" itemprop="url" class='badge-wrapper bullet'>
        <span class="badge-category-bg"></span>
        <span itemprop="title" class='category-title'>Runescape</span>
      </a>
    </div>
</div>





  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Epic_Steve.html'><span itemprop='name'>Epic_Steve</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-08-31T21:51:31Z'>
            <time itemprop='dateModified' datetime='2016-07-31T19:01:23Z' class='post-time'>
              July 31, 2016,  7:01pm
            </time>
        <span itemprop='position'>#1</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks to the help of c|p I’ve decided to retry this.<br>
I’ve managed to get the length of all the index files.</p>
<blockquote>Game Data length: 54
Models length: 83646
Cache2 length: 5814
Music length: 3684
Cache4 length: 8004</blockquote>
Which also means that they should contain these amount of files.
<blockquote>Game Data files: 9
Models files: 13941
Cache2 files: 969
Music files: 614
Cache4 files: 1334</blockquote>
(I hope this is right).
<p>Now I’m reading the whole of the index file like so;</p>
<pre><code class="lang-auto">    public byte[] readIndex() {
        try {
            byte[] readB = new byte[length];
            main_cache_idx.readFully(readB);
            return readB;
        } catch (IOException ex) {
            Logger.getLogger(Cache.class.getName()).log(Level.SEVERE, null, ex);
        }
        return null;
    }</code></pre>
<p>I get this. (I used the shortest cache section as an example.)</p>
<p>main_cache_idx0 - Game Data</p>
<blockquote>[0, 0, 0, 0, 0, 0, 0, -41, 121, 0, 0, 1, 7, 36, 126, 0, 0, 111, 2, -49, -124, 0, 2, 11, 1, -58, 11, 0, 2, -19, 1, 79, -123, 0, 5, -93, 3, 85, -83, 0, 3, -121, 0, 53, -79, 0, 5, 7, 3, 68, 47, 0, 5, 34]</blockquote>
<p>How can I tell what is the first chunk index and what is the length of each stored system?*</p>
<blockquote>an index file contains the length and first chunk index of each stored system.</blockquote>
      </div>

      <meta itemprop='headline' content='317 Cache packer &amp; unpacker help. [Edited again]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/silabsoft.html'><span itemprop='name'>silabsoft</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-09-20T09:59:28Z'>
            <time itemprop='dateModified' datetime='2016-07-31T23:57:12Z' class='post-time'>
              July 31, 2016, 11:57pm
            </time>
        <span itemprop='position'>#2</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>where is the question?</p>
      </div>

      <meta itemprop='headline' content='317 Cache packer &amp; unpacker help. [Edited again]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Cheese_Police.html'><span itemprop='name'>Cheese_Police</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-09-20T13:23:41Z'>
            <time itemprop='dateModified' datetime='2016-07-31T23:57:24Z' class='post-time'>
              July 31, 2016, 11:57pm
            </time>
        <span itemprop='position'>#3</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>using the naming in the client i am assuming you are using…</p>
<p>the class ‘Decompressor’ is the outermost layer of the cache, ie the actual index file and data file of a given file store.  each sub system is stored in chunks of 512 bytes.  an index file contains the length and first chunk index of each stored system.  in the data file, every 520 bytes corresponds to a different chunk.  the first 8 bytes contains which entry within the store it belongs to, how many chunks it has, the next chunk to read, and the store it belongs to.  the next 512 bytes is the actual data of the entry.  chunks are read until all of the data is read.  a full chunk is used if the data it contains is not 512 bytes long (that is, padded with 0).</p>
<p>the class ‘StreamLoader’ is next and is reminiscent of a file system.  it keeps individual entries, their sizes (deflated and inflated), and positions within the actual data it is associated.  if the deflated size of the file system does not match its inflated size, then the entire blob is compressed.  if it does, then each individual entry is compressed.</p>
<p>unpacking:</p>
<ol>
<li>obtain length and first chunk of the file system you want to read from the index of the corresponding file store.</li>
<li>read first chunk and continue until length bytes have been read from the data of the corresponding file store (in rt3, all file stores use the same data file).</li>
<li>obtain the inflated size and deflated size of the file system.  decompress the whole thing if they dont match.</li>
<li>obtain the amount of files the file system contains.</li>
<li>read the identifier, deflated size, and inflated size for each file and keep track of their positions.</li>
</ol>
<p>manipulate the file system.  if you add or remove a file, you must maintain it accordingly.</p>
<p>packing:</p>
<ol>
<li>write the amount of files, followed by the identifier, inflated size, and deflated size for every file to a buffer.<br>
2a.  if the entire blob is compressed, append the data of every file to the buffer and compress the whole thing.<br>
2b.  if not, append the compressed data for each file.</li>
<li>prepend the file system’s inflated size and deflated size to the buffer.</li>
<li>start a new chunk or reuse a chunk in the data file.  every 512 bytes of the buffer must be written to a separate chunk with the appropriate header.</li>
<li>overwrite or add the length and first chunk of the file system to the file store’s index.</li>
</ol>
<p>given you have eyes, you should be more than capable enough of reading the code in the client to figure out the rest.</p>
      </div>

      <meta itemprop='headline' content='317 Cache packer &amp; unpacker help. [Edited again]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
      <div class='crawler-post-meta'>
        <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a itemprop="url" href='../../u/Epic_Steve.html'><span itemprop='name'>Epic_Steve</span></a>
          
        </span>

        <span class="crawler-post-infos">
            <meta itemprop='datePublished' content='2010-09-22T23:41:16Z'>
            <time itemprop='dateModified' datetime='2016-07-31T23:59:46Z' class='post-time'>
              July 31, 2016, 11:59pm
            </time>
        <span itemprop='position'>#4</span>
        </span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks for the help, c|p.</p>
      </div>

      <meta itemprop='headline' content='317 Cache packer &amp; unpacker help. [Edited again]'>

      <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
         <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
         <meta itemprop="userInteractionCount" content="0" />
         <span class='post-likes'></span>
       </div>

       <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
          <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
          <meta itemprop="userInteractionCount" content="0" />
        </div>


  </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <ul>
        <li itemprop="name"><a href='../../index.html' itemprop="url">Home </a></li>
        <li itemprop="name"><a href='../../categories.html' itemprop="url">Categories </a></li>
        <li itemprop="name"><a href='../../guidelines.html' itemprop="url">FAQ/Guidelines </a></li>
        <li itemprop="name"><a href='../../tos.html' itemprop="url">Terms of Service </a></li>
        <li itemprop="name"><a href='../../privacy.html' itemprop="url">Privacy Policy </a></li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org/">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  </body>
  

<!-- Mirrored from forum.moparisthebest.com/t/317-cache-packer-unpacker-help-edited-again/358067 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 Aug 2019 14:00:15 GMT -->
</html>
